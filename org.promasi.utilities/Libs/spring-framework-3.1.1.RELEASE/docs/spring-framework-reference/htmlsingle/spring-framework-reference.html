<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Reference Documentation</title><link rel="stylesheet" href="css/stylesheet.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"><!--Begin Google Analytics code--><script type="text/javascript">
			var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
			document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		</script><script type="text/javascript">
			var pageTracker = _gat._getTracker("UA-2728886-3");
			pageTracker._setDomainName("none");
			pageTracker._setAllowLinker(true);
			pageTracker._trackPageview();
		</script><!--End Google Analytics code--></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><div><span class="productname">Spring Framework<br></span></div><div><h1 class="title"><a name="d0e1"></a>Reference Documentation</h1></div><div><p class="releaseinfo">3.1</p></div><div><p class="copyright">Copyright &copy; 2004-2011 Rod Johnson, Juergen Hoeller, Keith Donald, Colin Sampaleanu,
      Rob Harrop, Alef Arendsen, Thomas Risberg, Darren Davison, Dmitriy
      Kopylenko, Mark Pollack, Thierry Templier, Erwin Vervaet, Portia Tung,
      Ben Hale, Adrian Colyer, John Lewis, Costin Leau, Mark Fisher, Sam
      Brannen, Ramnivas Laddad, Arjen Poutsma, Chris Beams, Tareq Abedrabbo,
      Andy Clement, Dave Syer, Oliver Gierke, Rossen Stoyanchev</p></div><div><div class="legalnotice"><a name="d0e153"></a><p>Copies of this document may be made for your own use and for
      distribution to others, provided that you do not charge any fee for such
      copies and further provided that each copy contains this Copyright
      Notice, whether distributed in print or electronically.</p></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="part"><a href="#spring-introduction">I. Overview of Spring Framework</a></span></dt><dd><dl><dt><span class="chapter"><a href="#overview">1. Introduction to Spring Framework</a></span></dt><dd><dl><dt><span class="section"><a href="#overview-dependency-injection">1.1. Dependency Injection and Inversion of Control</a></span></dt><dt><span class="section"><a href="#overview-modules">1.2. Modules</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e281">1.2.1. Core Container</a></span></dt><dt><span class="section"><a href="#d0e320">1.2.2. Data Access/Integration</a></span></dt><dt><span class="section"><a href="#d0e369">1.2.3. Web</a></span></dt><dt><span class="section"><a href="#d0e405">1.2.4. AOP and Instrumentation</a></span></dt><dt><span class="section"><a href="#d0e428">1.2.5. Test</a></span></dt></dl></dd><dt><span class="section"><a href="#overview-usagescenarios">1.3. Usage scenarios</a></span></dt><dd><dl><dt><span class="section"><a href="#dependency-management">1.3.1. Dependency Management and Naming Conventions</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e682">1.3.1.1. Spring Dependencies and Depending on Spring</a></span></dt><dt><span class="section"><a href="#d0e689">1.3.1.2. Maven Dependency Management</a></span></dt><dt><span class="section"><a href="#d0e724">1.3.1.3. Ivy Dependency Management</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e748">1.3.2. Logging</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e772">1.3.2.1. Not Using Commons Logging</a></span></dt><dt><span class="section"><a href="#d0e792">1.3.2.2. Using SLF4J</a></span></dt><dt><span class="section"><a href="#d0e831">1.3.2.3. Using Log4J</a></span></dt></dl></dd></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#spring-whats-new">II. What's New in Spring 3</a></span></dt><dd><dl><dt><span class="chapter"><a href="#new-in-3.0">2. New Features and Enhancements in Spring 3.0</a></span></dt><dd><dl><dt><span class="section"><a href="#new-in-3.0-intro">2.1. Java 5</a></span></dt><dt><span class="section"><a href="#new-in-3.0-improved-docs">2.2. Improved documentation</a></span></dt><dt><span class="section"><a href="#new-in-3.0-new-tutorial">2.3. New articles and tutorials</a></span></dt><dt><span class="section"><a href="#new-in-3.0-modules-build">2.4. New module organization and build system</a></span></dt><dt><span class="section"><a href="#new-in-3.0-features-overview">2.5. Overview of new features</a></span></dt><dd><dl><dt><span class="section"><a href="#new-feature-java5">2.5.1. Core APIs updated for Java 5</a></span></dt><dt><span class="section"><a href="#new-feature-el">2.5.2. Spring Expression Language</a></span></dt><dt><span class="section"><a href="#new-feature-java-config">2.5.3. The Inversion of Control (IoC) container</a></span></dt><dd><dl><dt><span class="section"><a href="#new-java-configuration">2.5.3.1. Java based bean metadata</a></span></dt><dt><span class="section"><a href="#d0e1151">2.5.3.2. Defining bean metadata within components</a></span></dt></dl></dd><dt><span class="section"><a href="#new-feature-convert-and-format">2.5.4. General purpose type conversion system and field formatting
      system</a></span></dt><dt><span class="section"><a href="#new-feature-oxm">2.5.5. The Data Tier</a></span></dt><dt><span class="section"><a href="#new-feature-rest">2.5.6. The Web Tier</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1193">2.5.6.1. Comprehensive REST support</a></span></dt><dt><span class="section"><a href="#d0e1226">2.5.6.2. @MVC additions</a></span></dt></dl></dd><dt><span class="section"><a href="#new-feature-validation">2.5.7. Declarative model validation</a></span></dt><dt><span class="section"><a href="#new-feature-jee-6">2.5.8. Early support for Java EE 6</a></span></dt><dt><span class="section"><a href="#new-feature-embedded-databases">2.5.9. Support for embedded databases</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#new-in-3.1">3. New Features and Enhancements in Spring 3.1</a></span></dt><dd><dl><dt><span class="section"><a href="#new-in-3.1-features-overview">3.1. Overview of new features</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1281">3.1.1. Cache Abstraction</a></span></dt><dt><span class="section"><a href="#d0e1293">3.1.2. Bean Definition Profiles</a></span></dt><dt><span class="section"><a href="#d0e1313">3.1.3. Environment Abstraction</a></span></dt><dt><span class="section"><a href="#d0e1325">3.1.4. PropertySource Abstraction</a></span></dt><dt><span class="section"><a href="#d0e1343">3.1.5. Code equivalents for Spring's XML namespaces</a></span></dt><dt><span class="section"><a href="#d0e1385">3.1.6. Support for Hibernate 4.x</a></span></dt><dt><span class="section"><a href="#d0e1392">3.1.7. TestContext framework support for @Configuration classes and bean
      definition profiles</a></span></dt><dt><span class="section"><a href="#d0e1454">3.1.8. c: namespace for more concise constructor injection</a></span></dt><dt><span class="section"><a href="#d0e1461">3.1.9. Support for injection against non-standard JavaBeans
      setters</a></span></dt><dt><span class="section"><a href="#d0e1466">3.1.10. Support for Servlet 3 code-based configuration of Servlet
      Container</a></span></dt><dt><span class="section"><a href="#d0e1488">3.1.11. Support for Servlet 3 MultipartResolver</a></span></dt><dt><span class="section"><a href="#d0e1495">3.1.12. JPA EntityManagerFactory bootstrapping without
      persistence.xml</a></span></dt><dt><span class="section"><a href="#d0e1515">3.1.13. New HandlerMethod-based Support Classes For Annotated Controller
      Processing</a></span></dt><dt><span class="section"><a href="#d0e1589">3.1.14. "consumes" and "produces" conditions in
      @RequestMapping</a></span></dt><dt><span class="section"><a href="#d0e1605">3.1.15. Flash Attributes and
      RedirectAttributes</a></span></dt><dt><span class="section"><a href="#d0e1627">3.1.16. URI Template Variable Enhancements</a></span></dt><dt><span class="section"><a href="#d0e1654">3.1.17. @Valid On
      @RequestBody Controller Method Arguments</a></span></dt><dt><span class="section"><a href="#d0e1682">3.1.18. @RequestPart Annotation On
      Controller Method Arguments</a></span></dt><dt><span class="section"><a href="#d0e1693">3.1.19. UriComponentsBuilder and UriComponents</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#spring-core">III. Core Technologies</a></span></dt><dd><dl><dt><span class="chapter"><a href="#beans">4. The IoC container</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-introduction">4.1. Introduction to the Spring IoC container and beans</a></span></dt><dt><span class="section"><a href="#beans-basics">4.2. Container overview</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-metadata">4.2.1. Configuration metadata</a></span></dt><dt><span class="section"><a href="#beans-factory-instantiation">4.2.2. Instantiating a container</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-xml-import">4.2.2.1. Composing XML-based configuration metadata</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-client">4.2.3. Using the container</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-definition">4.3. Bean overview</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-beanname">4.3.1. Naming beans</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-beanname-alias">4.3.1.1. Aliasing a bean outside the bean definition</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-class">4.3.2. Instantiating beans</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-class-ctor">4.3.2.1. Instantiation with a constructor</a></span></dt><dt><span class="section"><a href="#beans-factory-class-static-factory-method">4.3.2.2. Instantiation with a static factory method</a></span></dt><dt><span class="section"><a href="#beans-factory-class-instance-factory-method">4.3.2.3. Instantiation using an instance factory method</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#beans-dependencies">4.4. Dependencies</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-collaborators">4.4.1. Dependency injection</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-constructor-injection">4.4.1.1. Constructor-based dependency injection</a></span></dt><dt><span class="section"><a href="#beans-setter-injection">4.4.1.2. Setter-based dependency injection</a></span></dt><dt><span class="section"><a href="#d0e2778">4.4.1.3. Dependency resolution process</a></span></dt><dt><span class="section"><a href="#beans-some-examples">4.4.1.4. Examples of dependency injection</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-properties-detailed">4.4.2. Dependencies and configuration in detail</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-value-element">4.4.2.1. Straight values (primitives, Strings, and so
        on)</a></span></dt><dt><span class="section"><a href="#beans-ref-element">4.4.2.2. References to other beans (collaborators)</a></span></dt><dt><span class="section"><a href="#beans-inner-beans">4.4.2.3. Inner beans</a></span></dt><dt><span class="section"><a href="#beans-collection-elements">4.4.2.4. Collections</a></span></dt><dt><span class="section"><a href="#beans-null-element">4.4.2.5. Null and empty string values</a></span></dt><dt><span class="section"><a href="#beans-p-namespace">4.4.2.6. XML shortcut with the p-namespace</a></span></dt><dt><span class="section"><a href="#beans-c-namespace">4.4.2.7. XML shortcut with the c-namespace</a></span></dt><dt><span class="section"><a href="#beans-compound-property-names">4.4.2.8. Compound property names</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-dependson">4.4.3. Using depends-on</a></span></dt><dt><span class="section"><a href="#beans-factory-lazy-init">4.4.4. Lazy-initialized
      beans</a></span></dt><dt><span class="section"><a href="#beans-factory-autowire">4.4.5. Autowiring collaborators</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-autowired-exceptions">4.4.5.1. Limitations and disadvantages of autowiring</a></span></dt><dt><span class="section"><a href="#beans-factory-autowire-candidate">4.4.5.2. Excluding a bean from autowiring</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-method-injection">4.4.6. Method injection</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-lookup-method-injection">4.4.6.1. Lookup method injection</a></span></dt><dt><span class="section"><a href="#beans-factory-arbitrary-method-replacement">4.4.6.2. Arbitrary method replacement</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#beans-factory-scopes">4.5. Bean scopes</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-scopes-singleton">4.5.1. The singleton scope</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-prototype">4.5.2. The prototype scope</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-sing-prot-interaction">4.5.3. Singleton beans with prototype-bean dependencies</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-other">4.5.4. Request, session, and global session scopes</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-scopes-other-web-configuration">4.5.4.1. Initial web configuration</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-request">4.5.4.2. Request scope</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-session">4.5.4.3. Session scope</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-global-session">4.5.4.4. Global session scope</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-other-injection">4.5.4.5. Scoped beans as dependencies</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-scopes-custom">4.5.5. Custom scopes</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-scopes-custom-creating">4.5.5.1. Creating a custom scope</a></span></dt><dt><span class="section"><a href="#beans-factory-scopes-custom-using">4.5.5.2. Using a custom scope</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#beans-factory-nature">4.6. Customizing the nature of a bean</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-lifecycle">4.6.1. Lifecycle callbacks</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-lifecycle-initializingbean">4.6.1.1. Initialization callbacks</a></span></dt><dt><span class="section"><a href="#beans-factory-lifecycle-disposablebean">4.6.1.2. Destruction callbacks</a></span></dt><dt><span class="section"><a href="#beans-factory-lifecycle-default-init-destroy-methods">4.6.1.3. Default initialization and destroy methods</a></span></dt><dt><span class="section"><a href="#beans-factory-lifecycle-combined-effects">4.6.1.4. Combining lifecycle mechanisms</a></span></dt><dt><span class="section"><a href="#beans-factory-lifecycle-processor">4.6.1.5. Startup and shutdown callbacks</a></span></dt><dt><span class="section"><a href="#beans-factory-shutdown">4.6.1.6. Shutting down the Spring IoC container gracefully in non-web
        applications</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-aware">4.6.2. ApplicationContextAware and
      BeanNameAware</a></span></dt><dt><span class="section"><a href="#aware-list">4.6.3. Other Aware interfaces</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-child-bean-definitions">4.7. Bean definition inheritance</a></span></dt><dt><span class="section"><a href="#beans-factory-extension">4.8. Container Extension Points</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-extension-bpp">4.8.1. Customizing beans using a
      BeanPostProcessor</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-extension-bpp-examples-hw">4.8.1.1. Example: Hello World,
        BeanPostProcessor-style</a></span></dt><dt><span class="section"><a href="#beans-factory-extension-bpp-examples-rabpp">4.8.1.2. Example: The
        RequiredAnnotationBeanPostProcessor</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-extension-factory-postprocessors">4.8.2. Customizing configuration metadata with a
      BeanFactoryPostProcessor</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-factory-placeholderconfigurer">4.8.2.1. Example: the
        PropertyPlaceholderConfigurer</a></span></dt><dt><span class="section"><a href="#beans-factory-overrideconfigurer">4.8.2.2. Example: the
        PropertyOverrideConfigurer</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-factory-extension-factorybean">4.8.3. Customizing instantiation logic with a
      FactoryBean</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-annotation-config">4.9. Annotation-based container configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-required-annotation">4.9.1. @Required</a></span></dt><dt><span class="section"><a href="#beans-autowired-annotation">4.9.2. @Autowired</a></span></dt><dt><span class="section"><a href="#beans-autowired-annotation-qualifiers">4.9.3. Fine-tuning annotation-based autowiring with qualifiers</a></span></dt><dt><span class="section"><a href="#beans-custom-autowire-configurer">4.9.4. CustomAutowireConfigurer</a></span></dt><dt><span class="section"><a href="#beans-resource-annotation">4.9.5. @Resource</a></span></dt><dt><span class="section"><a href="#beans-postconstruct-and-predestroy-annotations">4.9.6. @PostConstruct and
      @PreDestroy</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-classpath-scanning">4.10. Classpath scanning and managed components</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-stereotype-annotations">4.10.1. @Component and further stereotype
      annotations</a></span></dt><dt><span class="section"><a href="#beans-scanning-autodetection">4.10.2. Automatically detecting classes and registering bean
      definitions</a></span></dt><dt><span class="section"><a href="#beans-scanning-filters">4.10.3. Using filters to customize scanning</a></span></dt><dt><span class="section"><a href="#beans-factorybeans-annotations">4.10.4. Defining bean metadata within components</a></span></dt><dt><span class="section"><a href="#beans-scanning-name-generator">4.10.5. Naming autodetected components</a></span></dt><dt><span class="section"><a href="#beans-scanning-scope-resolver">4.10.6. Providing a scope for autodetected components</a></span></dt><dt><span class="section"><a href="#beans-scanning-qualifiers">4.10.7. Providing qualifier metadata with annotations</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-standard-annotations">4.11. Using JSR 330 Standard Annotations</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-inject-named">4.11.1. Dependency Injection with @Inject and @Named</a></span></dt><dt><span class="section"><a href="#beans-named">4.11.2. @Named: a standard equivalent to the @Component annotation</a></span></dt><dt><span class="section"><a href="#beans-standard-annotations-limitations">4.11.3. Limitations of the standard approach</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-java">4.12. Java-based container configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-java-basic-concepts">4.12.1. Basic concepts: @Configuration and
      @Bean</a></span></dt><dt><span class="section"><a href="#beans-java-instantiating-container">4.12.2. Instantiating the Spring container using
      AnnotationConfigApplicationContext</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-java-instantiating-container-contstructor">4.12.2.1. Simple construction</a></span></dt><dt><span class="section"><a href="#beans-java-instantiating-container-register">4.12.2.2. Building the container programmatically using
        register(Class&lt;?&gt;...)</a></span></dt><dt><span class="section"><a href="#beans-java-instantiating-container-scan">4.12.2.3. Enabling component scanning with
        scan(String...)</a></span></dt><dt><span class="section"><a href="#beans-java-instantiating-container-web">4.12.2.4. Support for web applications with
        AnnotationConfigWebApplicationContext</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-java-composing-configuration-classes">4.12.3. Composing Java-based configurations</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-java-using-import">4.12.3.1. Using the @Import annotation</a></span></dt><dt><span class="section"><a href="#beans-java-combining">4.12.3.2. Combining Java and XML configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-java-bean-annotation">4.12.4. Using the @Bean annotation</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-java-declaring-a-bean">4.12.4.1. Declaring a bean</a></span></dt><dt><span class="section"><a href="#beans-java-injecting-dependencies">4.12.4.2. Injecting dependencies</a></span></dt><dt><span class="section"><a href="#beans-java-lifecycle-callbacks">4.12.4.3. Receiving lifecycle callbacks</a></span></dt><dt><span class="section"><a href="#beans-java-specifying-bean-scope">4.12.4.4. Specifying bean scope</a></span></dt><dt><span class="section"><a href="#beans-java-customizing-bean-naming">4.12.4.5. Customizing bean naming</a></span></dt><dt><span class="section"><a href="#beans-java-bean-aliasing">4.12.4.6. Bean aliasing</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-java-further-information-java-config">4.12.5. Further information about how Java-based configuration works
      internally</a></span></dt></dl></dd><dt><span class="section"><a href="#context-load-time-weaver">4.13. Registering a LoadTimeWeaver</a></span></dt><dt><span class="section"><a href="#context-introduction">4.14. Additional Capabilities of the
    ApplicationContext</a></span></dt><dd><dl><dt><span class="section"><a href="#context-functionality-messagesource">4.14.1. Internationalization using
      MessageSource</a></span></dt><dt><span class="section"><a href="#context-functionality-events">4.14.2. Standard and Custom Events</a></span></dt><dt><span class="section"><a href="#context-functionality-resources">4.14.3. Convenient access to low-level resources</a></span></dt><dt><span class="section"><a href="#context-create">4.14.4. Convenient ApplicationContext
      instantiation for web applications</a></span></dt><dt><span class="section"><a href="#d0e9544">4.14.5. Deploying a Spring ApplicationContext as a J2EE RAR file</a></span></dt></dl></dd><dt><span class="section"><a href="#beans-beanfactory">4.15. The BeanFactory</a></span></dt><dd><dl><dt><span class="section"><a href="#context-introduction-ctx-vs-beanfactory">4.15.1. BeanFactory or
        ApplicationContext?</a></span></dt><dt><span class="section"><a href="#beans-servicelocator">4.15.2. Glue code and the evil singleton</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#resources">5. Resources</a></span></dt><dd><dl><dt><span class="section"><a href="#resources-introduction">5.1. Introduction</a></span></dt><dt><span class="section"><a href="#resources-resource">5.2. The Resource interface</a></span></dt><dt><span class="section"><a href="#resources-implementations">5.3. Built-in Resource implementations</a></span></dt><dd><dl><dt><span class="section"><a href="#resources-implementations-urlresource">5.3.1. UrlResource</a></span></dt><dt><span class="section"><a href="#resources-implementations-classpathresource">5.3.2. ClassPathResource</a></span></dt><dt><span class="section"><a href="#resources-implementations-filesystemresource">5.3.3. FileSystemResource</a></span></dt><dt><span class="section"><a href="#resources-implementations-servletcontextresource">5.3.4. ServletContextResource</a></span></dt><dt><span class="section"><a href="#resources-implementations-inputstreamresource">5.3.5. InputStreamResource</a></span></dt><dt><span class="section"><a href="#resources-implementations-bytearrayresource">5.3.6. ByteArrayResource</a></span></dt></dl></dd><dt><span class="section"><a href="#resources-resourceloader">5.4. The ResourceLoader</a></span></dt><dt><span class="section"><a href="#resources-resourceloaderaware">5.5. The ResourceLoaderAware interface</a></span></dt><dt><span class="section"><a href="#resources-as-dependencies">5.6. Resources as dependencies</a></span></dt><dt><span class="section"><a href="#resources-app-ctx">5.7. Application contexts and Resource paths</a></span></dt><dd><dl><dt><span class="section"><a href="#resources-app-ctx-construction">5.7.1. Constructing application contexts</a></span></dt><dd><dl><dt><span class="section"><a href="#resources-app-ctx-classpathxml">5.7.1.1. Constructing ClassPathXmlApplicationContext instances - shortcuts</a></span></dt></dl></dd><dt><span class="section"><a href="#resources-app-ctx-wildcards-in-resource-paths">5.7.2. Wildcards in application context constructor resource paths</a></span></dt><dd><dl><dt><span class="section"><a href="#resources-app-ctx-ant-patterns-in-paths">5.7.2.1. Ant-style Patterns</a></span></dt><dt><span class="section"><a href="#resources-classpath-wildcards">5.7.2.2. The classpath*: prefix</a></span></dt><dt><span class="section"><a href="#resources-wildcards-in-path-other-stuff">5.7.2.3. Other notes relating to wildcards</a></span></dt></dl></dd><dt><span class="section"><a href="#resources-filesystemresource-caveats">5.7.3. FileSystemResource caveats</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#validation">6. Validation, Data Binding, and Type Conversion</a></span></dt><dd><dl><dt><span class="section"><a href="#validation-introduction">6.1. Introduction</a></span></dt><dt><span class="section"><a href="#validator">6.2. Validation using Spring's Validator
      interface</a></span></dt><dt><span class="section"><a href="#validation-conversion">6.3. Resolving codes to error messages</a></span></dt><dt><span class="section"><a href="#beans-beans">6.4. Bean manipulation and the
      BeanWrapper</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-beans-conventions">6.4.1. Setting and getting basic and nested properties</a></span></dt><dt><span class="section"><a href="#beans-beans-conversion">6.4.2. Built-in PropertyEditor
        implementations</a></span></dt><dd><dl><dt><span class="section"><a href="#beans-beans-conversion-customeditor-registration">6.4.2.1. Registering additional custom
          PropertyEditors</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#core-convert">6.5. Spring 3 Type Conversion</a></span></dt><dd><dl><dt><span class="section"><a href="#core-convert-Converter-API">6.5.1. Converter SPI</a></span></dt><dt><span class="section"><a href="#core-convert-ConverterFactory-SPI">6.5.2. ConverterFactory</a></span></dt><dt><span class="section"><a href="#core-convert-GenericConverter-SPI">6.5.3. GenericConverter</a></span></dt><dd><dl><dt><span class="section"><a href="#core-convert-ConditionalGenericConverter-SPI">6.5.3.1. ConditionalGenericConverter</a></span></dt></dl></dd><dt><span class="section"><a href="#core-convert-ConversionService-API">6.5.4. ConversionService API</a></span></dt><dt><span class="section"><a href="#core-convert-Spring-config">6.5.5. Configuring a ConversionService</a></span></dt><dt><span class="section"><a href="#core-convert-programmatic-usage">6.5.6. Using a ConversionService programatically</a></span></dt></dl></dd><dt><span class="section"><a href="#format">6.6. Spring 3 Field Formatting</a></span></dt><dd><dl><dt><span class="section"><a href="#format-Formatter-SPI">6.6.1. Formatter SPI</a></span></dt><dt><span class="section"><a href="#format-CustomFormatAnnotations">6.6.2. Annotation-driven Formatting</a></span></dt><dd><dl><dt><span class="section"><a href="#format-annotations-api">6.6.2.1. Format Annotation API</a></span></dt></dl></dd><dt><span class="section"><a href="#format-FormatterRegistry-SPI">6.6.3. FormatterRegistry SPI</a></span></dt><dt><span class="section"><a href="#format-FormatterRegistrar-SPI">6.6.4. FormatterRegistrar SPI</a></span></dt><dt><span class="section"><a href="#format-configuring-FormattingConversionService">6.6.5. Configuring Formatting in Spring MVC</a></span></dt></dl></dd><dt><span class="section"><a href="#validation-beanvalidation">6.7. Spring 3 Validation</a></span></dt><dd><dl><dt><span class="section"><a href="#validation-beanvalidation-overview">6.7.1. Overview of the JSR-303 Bean Validation API</a></span></dt><dt><span class="section"><a href="#validation-beanvalidation-spring">6.7.2. Configuring a Bean Validation Implementation</a></span></dt><dd><dl><dt><span class="section"><a href="#validation-beanvalidation-spring-inject">6.7.2.1. Injecting a Validator</a></span></dt><dt><span class="section"><a href="#validation-beanvalidation-spring-constraints">6.7.2.2. Configuring Custom Constraints</a></span></dt><dt><span class="section"><a href="#validation-beanvalidation-spring-other">6.7.2.3. Additional Configuration Options</a></span></dt></dl></dd><dt><span class="section"><a href="#validation-binder">6.7.3. Configuring a DataBinder</a></span></dt><dt><span class="section"><a href="#validation-mvc">6.7.4. Spring MVC 3 Validation</a></span></dt><dd><dl><dt><span class="section"><a href="#validation-mvc-triggering">6.7.4.1. Triggering @Controller Input Validation</a></span></dt><dt><span class="section"><a href="#validation-mvc-configuring">6.7.4.2. Configuring a Validator for use by Spring MVC</a></span></dt><dt><span class="section"><a href="#validation-mvc-jsr303">6.7.4.3. Configuring a JSR-303 Validator for use by Spring MVC</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#expressions">7. Spring Expression Language (SpEL)</a></span></dt><dd><dl><dt><span class="section"><a href="#expressions-intro">7.1. Introduction</a></span></dt><dt><span class="section"><a href="#expressions-features">7.2. Feature Overview</a></span></dt><dt><span class="section"><a href="#expressions-evaluation">7.3. Expression Evaluation using Spring's Expression Interface</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12545">7.3.1. The EvaluationContext interface</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12600">7.3.1.1. Type Conversion</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#expressions-beandef">7.4. Expression support for defining bean definitions</a></span></dt><dd><dl><dt><span class="section"><a href="#expressions-beandef-xml-based">7.4.1. XML based configuration</a></span></dt><dt><span class="section"><a href="#expressions-beandef-annotation-based">7.4.2. Annotation-based configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#expressions-language-ref">7.5. Language Reference</a></span></dt><dd><dl><dt><span class="section"><a href="#expressions-ref-literal">7.5.1. Literal expressions</a></span></dt><dt><span class="section"><a href="#d0e12686">7.5.2. Properties, Arrays, Lists, Maps, Indexers</a></span></dt><dt><span class="section"><a href="#d0e12704">7.5.3. Inline lists</a></span></dt><dt><span class="section"><a href="#d0e12713">7.5.4. Array construction</a></span></dt><dt><span class="section"><a href="#d0e12722">7.5.5. Methods</a></span></dt><dt><span class="section"><a href="#d0e12729">7.5.6. Operators</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12732">7.5.6.1. Relational operators</a></span></dt><dt><span class="section"><a href="#d0e12745">7.5.6.2. Logical operators</a></span></dt><dt><span class="section"><a href="#d0e12753">7.5.6.3. Mathematical operators</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12761">7.5.7. Assignment</a></span></dt><dt><span class="section"><a href="#d0e12775">7.5.8. Types</a></span></dt><dt><span class="section"><a href="#d0e12791">7.5.9. Constructors</a></span></dt><dt><span class="section"><a href="#expressions-ref-variables">7.5.10. Variables</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12805">7.5.10.1. The #this and #root variables</a></span></dt></dl></dd><dt><span class="section"><a href="#expressions-ref-functions">7.5.11. Functions</a></span></dt><dt><span class="section"><a href="#d0e12831">7.5.12. Bean references</a></span></dt><dt><span class="section"><a href="#d0e12838">7.5.13. Ternary Operator (If-Then-Else)</a></span></dt><dt><span class="section"><a href="#d0e12851">7.5.14. The Elvis Operator</a></span></dt><dt><span class="section"><a href="#d0e12869">7.5.15. Safe Navigation operator</a></span></dt><dt><span class="section"><a href="#d0e12895">7.5.16. Collection Selection</a></span></dt><dt><span class="section"><a href="#d0e12924">7.5.17. Collection Projection</a></span></dt><dt><span class="section"><a href="#d0e12939">7.5.18. Expression templating</a></span></dt></dl></dd><dt><span class="section"><a href="#expressions-example-classes">7.6. Classes used in the examples</a></span></dt></dl></dd><dt><span class="chapter"><a href="#aop">8. Aspect Oriented Programming with Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-introduction">8.1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-introduction-defn">8.1.1. AOP concepts</a></span></dt><dt><span class="section"><a href="#aop-introduction-spring-defn">8.1.2. Spring AOP capabilities and goals</a></span></dt><dt><span class="section"><a href="#aop-introduction-proxies">8.1.3. AOP Proxies</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-ataspectj">8.2. @AspectJ support</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-aspectj-support">8.2.1. Enabling @AspectJ Support</a></span></dt><dt><span class="section"><a href="#aop-at-aspectj">8.2.2. Declaring an aspect</a></span></dt><dt><span class="section"><a href="#aop-pointcuts">8.2.3. Declaring a pointcut</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-pointcuts-designators">8.2.3.1. Supported Pointcut Designators</a></span></dt><dt><span class="section"><a href="#aop-pointcuts-combining">8.2.3.2. Combining pointcut expressions</a></span></dt><dt><span class="section"><a href="#aop-common-pointcuts">8.2.3.3. Sharing common pointcut definitions</a></span></dt><dt><span class="section"><a href="#aop-pointcuts-examples">8.2.3.4. Examples</a></span></dt><dt><span class="section"><a href="#writing-good-pointcuts">8.2.3.5. Writing good pointcuts</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-advice">8.2.4. Declaring advice</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-advice-before">8.2.4.1. Before advice</a></span></dt><dt><span class="section"><a href="#aop-advice-after-returning">8.2.4.2. After returning advice</a></span></dt><dt><span class="section"><a href="#aop-advice-after-throwing">8.2.4.3. After throwing advice</a></span></dt><dt><span class="section"><a href="#aop-advice-after-finally">8.2.4.4. After (finally) advice</a></span></dt><dt><span class="section"><a href="#aop-ataspectj-around-advice">8.2.4.5. Around advice</a></span></dt><dt><span class="section"><a href="#aop-ataspectj-advice-params">8.2.4.6. Advice parameters</a></span></dt><dt><span class="section"><a href="#aop-ataspectj-advice-ordering">8.2.4.7. Advice ordering</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-introductions">8.2.5. Introductions</a></span></dt><dt><span class="section"><a href="#aop-instantiation-models">8.2.6. Aspect instantiation models</a></span></dt><dt><span class="section"><a href="#aop-ataspectj-example">8.2.7. Example</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-schema">8.3. Schema-based AOP support</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-schema-declaring-an-aspect">8.3.1. Declaring an aspect</a></span></dt><dt><span class="section"><a href="#aop-schema-pointcuts">8.3.2. Declaring a pointcut</a></span></dt><dt><span class="section"><a href="#aop-schema-advice">8.3.3. Declaring advice</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-schema-advice-before">8.3.3.1. Before advice</a></span></dt><dt><span class="section"><a href="#aop-schema-advice-after-returning">8.3.3.2. After returning advice</a></span></dt><dt><span class="section"><a href="#aop-schema-advice-after-throwing">8.3.3.3. After throwing advice</a></span></dt><dt><span class="section"><a href="#aop-schema-advice-after-finally">8.3.3.4. After (finally) advice</a></span></dt><dt><span class="section"><a href="#aop-schema-advice-around">8.3.3.5. Around advice</a></span></dt><dt><span class="section"><a href="#aop-schema-params">8.3.3.6. Advice parameters</a></span></dt><dt><span class="section"><a href="#aop-ordering">8.3.3.7. Advice ordering</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-schema-introductions">8.3.4. Introductions</a></span></dt><dt><span class="section"><a href="#aop-schema-instatiation-models">8.3.5. Aspect instantiation models</a></span></dt><dt><span class="section"><a href="#aop-schema-advisors">8.3.6. Advisors</a></span></dt><dt><span class="section"><a href="#aop-schema-example">8.3.7. Example</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-choosing">8.4. Choosing which AOP declaration style to use</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-spring-or-aspectj">8.4.1. Spring AOP or full AspectJ?</a></span></dt><dt><span class="section"><a href="#aop-ataspectj-or-xml">8.4.2. @AspectJ or XML for Spring AOP?</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-mixing-styles">8.5. Mixing aspect types</a></span></dt><dt><span class="section"><a href="#aop-proxying">8.6. Proxying mechanisms</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-understanding-aop-proxies">8.6.1. Understanding AOP proxies</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-aspectj-programmatic">8.7. Programmatic creation of @AspectJ Proxies</a></span></dt><dt><span class="section"><a href="#aop-using-aspectj">8.8. Using AspectJ with Spring applications</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-atconfigurable">8.8.1. Using AspectJ to dependency inject domain objects with
      Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-configurable-testing">8.8.1.1. Unit testing @Configurable
        objects</a></span></dt><dt><span class="section"><a href="#aop-configurable-container">8.8.1.2. Working with multiple application contexts</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-ajlib-other">8.8.2. Other Spring aspects for AspectJ</a></span></dt><dt><span class="section"><a href="#aop-aj-configure">8.8.3. Configuring AspectJ aspects using Spring IoC</a></span></dt><dt><span class="section"><a href="#aop-aj-ltw">8.8.4. Load-time weaving with AspectJ in the Spring Framework</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-aj-ltw-first-example">8.8.4.1. A first example</a></span></dt><dt><span class="section"><a href="#aop-aj-ltw-the-aspects">8.8.4.2. Aspects</a></span></dt><dt><span class="section"><a href="#aop-aj-ltw-aop_dot_xml">8.8.4.3. 'META-INF/aop.xml'</a></span></dt><dt><span class="section"><a href="#aop-aj-ltw-libraries">8.8.4.4. Required libraries (JARS)</a></span></dt><dt><span class="section"><a href="#aop-aj-ltw-spring">8.8.4.5. Spring configuration</a></span></dt><dt><span class="section"><a href="#aop-aj-ltw-environments">8.8.4.6. Environment-specific configuration</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#aop-resources">8.9. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#aop-api">9. Spring AOP APIs</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-api-introduction">9.1. Introduction</a></span></dt><dt><span class="section"><a href="#aop-api-pointcuts">9.2. Pointcut API in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-api-concepts">9.2.1. Concepts</a></span></dt><dt><span class="section"><a href="#aop-api-pointcut-ops">9.2.2. Operations on pointcuts</a></span></dt><dt><span class="section"><a href="#aop-api-pointcuts-aspectj">9.2.3. AspectJ expression pointcuts</a></span></dt><dt><span class="section"><a href="#aop-api-pointcuts-impls">9.2.4. Convenience pointcut implementations</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-api-pointcuts-static">9.2.4.1. Static pointcuts</a></span></dt><dt><span class="section"><a href="#aop-api-pointcuts-dynamic">9.2.4.2. Dynamic pointcuts</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-api-pointcuts-superclasses">9.2.5. Pointcut superclasses</a></span></dt><dt><span class="section"><a href="#aop-api-pointcuts-custom">9.2.6. Custom pointcuts</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-api-advice">9.3. Advice API in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-api-advice-lifecycle">9.3.1. Advice lifecycles</a></span></dt><dt><span class="section"><a href="#aop-api-advice-types">9.3.2. Advice types in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-api-advice-around">9.3.2.1. Interception around advice</a></span></dt><dt><span class="section"><a href="#aop-api-advice-before">9.3.2.2. Before advice</a></span></dt><dt><span class="section"><a href="#aop-api-advice-throws">9.3.2.3. Throws advice</a></span></dt><dt><span class="section"><a href="#aop-api-advice-after-returning">9.3.2.4. After Returning advice</a></span></dt><dt><span class="section"><a href="#aop-api-advice-introduction">9.3.2.5. Introduction advice</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#aop-api-advisor">9.4. Advisor API in Spring</a></span></dt><dt><span class="section"><a href="#aop-pfb">9.5. Using the ProxyFactoryBean to create AOP proxies</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-pfb-1">9.5.1. Basics</a></span></dt><dt><span class="section"><a href="#aop-pfb-2">9.5.2. JavaBean properties</a></span></dt><dt><span class="section"><a href="#aop-pfb-proxy-types">9.5.3. JDK- and CGLIB-based proxies</a></span></dt><dt><span class="section"><a href="#aop-api-proxying-intf">9.5.4. Proxying interfaces</a></span></dt><dt><span class="section"><a href="#aop-api-proxying-class">9.5.5. Proxying classes</a></span></dt><dt><span class="section"><a href="#aop-global-advisors">9.5.6. Using 'global' advisors</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-concise-proxy">9.6. Concise proxy definitions</a></span></dt><dt><span class="section"><a href="#aop-prog">9.7. Creating AOP proxies programmatically with the ProxyFactory</a></span></dt><dt><span class="section"><a href="#aop-api-advised">9.8. Manipulating advised objects</a></span></dt><dt><span class="section"><a href="#aop-autoproxy">9.9. Using the "autoproxy" facility</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-autoproxy-choices">9.9.1. Autoproxy bean definitions</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-api-autoproxy">9.9.1.1. BeanNameAutoProxyCreator</a></span></dt><dt><span class="section"><a href="#aop-api-autoproxy-default">9.9.1.2. DefaultAdvisorAutoProxyCreator</a></span></dt><dt><span class="section"><a href="#aop-api-autoproxy-abstract">9.9.1.3. AbstractAdvisorAutoProxyCreator</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-autoproxy-metadata">9.9.2. Using metadata-driven auto-proxying</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-targetsource">9.10. Using TargetSources</a></span></dt><dd><dl><dt><span class="section"><a href="#aop-ts-swap">9.10.1. Hot swappable target sources</a></span></dt><dt><span class="section"><a href="#aop-ts-pool">9.10.2. Pooling target sources</a></span></dt><dt><span class="section"><a href="#aop-ts-prototype">9.10.3. Prototype target sources</a></span></dt><dt><span class="section"><a href="#aop-ts-threadlocal">9.10.4. ThreadLocal target sources</a></span></dt></dl></dd><dt><span class="section"><a href="#aop-extensibility">9.11. Defining new Advice types</a></span></dt><dt><span class="section"><a href="#aop-api-resources">9.12. Further resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#testing">10. Testing</a></span></dt><dd><dl><dt><span class="section"><a href="#testing-introduction">10.1. Introduction to Spring Testing</a></span></dt><dt><span class="section"><a href="#unit-testing">10.2. Unit Testing</a></span></dt><dd><dl><dt><span class="section"><a href="#mock-objects">10.2.1. Mock Objects</a></span></dt><dd><dl><dt><span class="section"><a href="#mock-objects-jndi">10.2.1.1. JNDI</a></span></dt><dt><span class="section"><a href="#mock-objects-servlet">10.2.1.2. Servlet API</a></span></dt><dt><span class="section"><a href="#mock-objects-portlet">10.2.1.3. Portlet API</a></span></dt></dl></dd><dt><span class="section"><a href="#unit-testing-support-classes">10.2.2. Unit Testing support Classes</a></span></dt><dd><dl><dt><span class="section"><a href="#unit-testing-utilities">10.2.2.1. General utilities</a></span></dt><dt><span class="section"><a href="#unit-testing-spring-mvc">10.2.2.2. Spring MVC</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#integration-testing">10.3. Integration Testing</a></span></dt><dd><dl><dt><span class="section"><a href="#integration-testing-overview">10.3.1. Overview</a></span></dt><dt><span class="section"><a href="#integration-testing-goals">10.3.2. Goals of Integration Testing</a></span></dt><dd><dl><dt><span class="section"><a href="#testing-ctx-management">10.3.2.1. Context management and caching</a></span></dt><dt><span class="section"><a href="#testing-fixture-di">10.3.2.2. Dependency Injection of test fixtures</a></span></dt><dt><span class="section"><a href="#testing-tx">10.3.2.3. Transaction management</a></span></dt><dt><span class="section"><a href="#testing-support-classes">10.3.2.4. Support classes for integration testing</a></span></dt></dl></dd><dt><span class="section"><a href="#integration-testing-support-jdbc">10.3.3. JDBC Testing Support</a></span></dt><dt><span class="section"><a href="#integration-testing-annotations">10.3.4. Annotations</a></span></dt><dd><dl><dt><span class="section"><a href="#integration-testing-annotations-spring">10.3.4.1. Spring Testing Annotations</a></span></dt><dt><span class="section"><a href="#integration-testing-annotations-standard">10.3.4.2. Standard Annotation Support</a></span></dt><dt><span class="section"><a href="#integration-testing-annotations-junit">10.3.4.3. Spring JUnit Testing Annotations</a></span></dt></dl></dd><dt><span class="section"><a href="#testcontext-framework">10.3.5. Spring TestContext Framework</a></span></dt><dd><dl><dt><span class="section"><a href="#testcontext-key-abstractions">10.3.5.1. Key abstractions</a></span></dt><dt><span class="section"><a href="#testcontext-ctx-management">10.3.5.2. Context management</a></span></dt><dt><span class="section"><a href="#testcontext-fixture-di">10.3.5.3. Dependency injection of test fixtures</a></span></dt><dt><span class="section"><a href="#testcontext-tx">10.3.5.4. Transaction management</a></span></dt><dt><span class="section"><a href="#testcontext-support-classes">10.3.5.5. TestContext support classes</a></span></dt></dl></dd><dt><span class="section"><a href="#testing-examples-petclinic">10.3.6. PetClinic Example</a></span></dt></dl></dd><dt><span class="section"><a href="#testing-resources">10.4. Further Resources</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#spring-data-tier">IV. Data Access</a></span></dt><dd><dl><dt><span class="chapter"><a href="#transaction">11. Transaction Management</a></span></dt><dd><dl><dt><span class="section"><a href="#transaction-intro">11.1. Introduction to Spring Framework transaction management</a></span></dt><dt><span class="section"><a href="#transaction-motivation">11.2. Advantages of the Spring Framework's transaction support model</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e20593">11.2.1. Global transactions</a></span></dt><dt><span class="section"><a href="#d0e20618">11.2.2. Local transactions</a></span></dt><dt><span class="section"><a href="#d0e20623">11.2.3. Spring Framework's consistent programming model</a></span></dt></dl></dd><dt><span class="section"><a href="#transaction-strategies">11.3. Understanding the Spring Framework transaction abstraction</a></span></dt><dt><span class="section"><a href="#tx-resource-synchronization">11.4. Synchronizing resources with transactions</a></span></dt><dd><dl><dt><span class="section"><a href="#tx-resource-synchronization-high">11.4.1. High-level synchronization approach</a></span></dt><dt><span class="section"><a href="#tx-resource-synchronization-low">11.4.2. Low-level synchronization approach</a></span></dt><dt><span class="section"><a href="#tx-resource-synchronization-tadsp">11.4.3. TransactionAwareDataSourceProxy</a></span></dt></dl></dd><dt><span class="section"><a href="#transaction-declarative">11.5. Declarative transaction management</a></span></dt><dd><dl><dt><span class="section"><a href="#tx-decl-explained">11.5.1. Understanding the Spring Framework's declarative transaction
      implementation</a></span></dt><dt><span class="section"><a href="#transaction-declarative-first-example">11.5.2. Example of declarative transaction implementation</a></span></dt><dt><span class="section"><a href="#transaction-declarative-rolling-back">11.5.3. Rolling back a declarative transaction</a></span></dt><dt><span class="section"><a href="#transaction-declarative-diff-tx">11.5.4. Configuring different transactional semantics for different
      beans</a></span></dt><dt><span class="section"><a href="#transaction-declarative-txadvice-settings">11.5.5. &lt;tx:advice/&gt; settings</a></span></dt><dt><span class="section"><a href="#transaction-declarative-annotations">11.5.6. Using @Transactional</a></span></dt><dd><dl><dt><span class="section"><a href="#transaction-declarative-attransactional-settings">11.5.6.1. @Transactional settings</a></span></dt><dt><span class="section"><a href="#tx-multiple-tx-mgrs-with-attransactional">11.5.6.2. Multiple Transaction Managers with @Transactional</a></span></dt><dt><span class="section"><a href="#tx-custom-attributes">11.5.6.3. Custom shortcut annotations</a></span></dt></dl></dd><dt><span class="section"><a href="#tx-propagation">11.5.7. Transaction propagation</a></span></dt><dd><dl><dt><span class="section"><a href="#tx-propagation-required">11.5.7.1. Required</a></span></dt><dt><span class="section"><a href="#tx-propagation-requires_new">11.5.7.2. RequiresNew</a></span></dt><dt><span class="section"><a href="#tx-propagation-nested">11.5.7.3. Nested</a></span></dt></dl></dd><dt><span class="section"><a href="#transaction-declarative-applying-more-than-just-tx-advice">11.5.8. Advising transactional operations</a></span></dt><dt><span class="section"><a href="#transaction-declarative-aspectj">11.5.9. Using @Transactional with
      AspectJ</a></span></dt></dl></dd><dt><span class="section"><a href="#transaction-programmatic">11.6. Programmatic transaction management</a></span></dt><dd><dl><dt><span class="section"><a href="#tx-prog-template">11.6.1. Using the TransactionTemplate</a></span></dt><dd><dl><dt><span class="section"><a href="#tx-prog-template-settings">11.6.1.1. Specifying transaction settings</a></span></dt></dl></dd><dt><span class="section"><a href="#transaction-programmatic-ptm">11.6.2. Using the
      PlatformTransactionManager</a></span></dt></dl></dd><dt><span class="section"><a href="#tx-decl-vs-prog">11.7. Choosing between programmatic and declarative transaction
    management</a></span></dt><dt><span class="section"><a href="#transaction-application-server-integration">11.8. Application server-specific integration</a></span></dt><dd><dl><dt><span class="section"><a href="#transaction-application-server-integration-websphere">11.8.1. IBM WebSphere</a></span></dt><dt><span class="section"><a href="#transaction-application-server-integration-weblogic">11.8.2. BEA WebLogic Server</a></span></dt><dt><span class="section"><a href="#transaction-application-server-integration-oc4j">11.8.3. Oracle OC4J</a></span></dt></dl></dd><dt><span class="section"><a href="#transaction-solutions-to-common-problems">11.9. Solutions to common problems</a></span></dt><dd><dl><dt><span class="section"><a href="#transaction-solutions-to-common-problems-wrong-ptm">11.9.1. Use of the wrong transaction manager for a specific
      DataSource</a></span></dt></dl></dd><dt><span class="section"><a href="#transaction-resources">11.10. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#dao">12. DAO support</a></span></dt><dd><dl><dt><span class="section"><a href="#dao-introduction">12.1. Introduction</a></span></dt><dt><span class="section"><a href="#dao-exceptions">12.2. Consistent exception hierarchy</a></span></dt><dt><span class="section"><a href="#dao-annotations">12.3. Annotations used for configuring DAO or Repository classes</a></span></dt></dl></dd><dt><span class="chapter"><a href="#jdbc">13. Data access with JDBC</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-introduction">13.1. Introduction to Spring Framework JDBC</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-choose-style">13.1.1. Choosing an approach for JDBC database access</a></span></dt><dt><span class="section"><a href="#jdbc-packages">13.1.2. Package hierarchy</a></span></dt></dl></dd><dt><span class="section"><a href="#jdbc-core">13.2. Using the JDBC core classes to control basic JDBC processing and
    error handling</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-JdbcTemplate">13.2.1. JdbcTemplate</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-JdbcTemplate-examples">13.2.1.1. Examples of JdbcTemplate class usage</a></span></dt><dt><span class="section"><a href="#jdbc-JdbcTemplate-idioms">13.2.1.2. JdbcTemplate best practices</a></span></dt></dl></dd><dt><span class="section"><a href="#jdbc-NamedParameterJdbcTemplate">13.2.2. NamedParameterJdbcTemplate</a></span></dt><dt><span class="section"><a href="#jdbc-SimpleJdbcTemplate">13.2.3. SimpleJdbcTemplate</a></span></dt><dt><span class="section"><a href="#jdbc-SQLExceptionTranslator">13.2.4. SQLExceptionTranslator</a></span></dt><dt><span class="section"><a href="#jdbc-statements-executing">13.2.5. Executing statements</a></span></dt><dt><span class="section"><a href="#jdbc-statements-querying">13.2.6. Running queries</a></span></dt><dt><span class="section"><a href="#jdbc-updates">13.2.7. Updating the database</a></span></dt><dt><span class="section"><a href="#jdbc-auto-genereted-keys">13.2.8. Retrieving auto-generated keys</a></span></dt></dl></dd><dt><span class="section"><a href="#jdbc-connections">13.3. Controlling database connections</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-datasource">13.3.1. DataSource</a></span></dt><dt><span class="section"><a href="#jdbc-DataSourceUtils">13.3.2. DataSourceUtils</a></span></dt><dt><span class="section"><a href="#jdbc-SmartDataSource">13.3.3. SmartDataSource</a></span></dt><dt><span class="section"><a href="#jdbc-AbstractDataSource">13.3.4. AbstractDataSource</a></span></dt><dt><span class="section"><a href="#jdbc-SingleConnectionDataSource">13.3.5. SingleConnectionDataSource</a></span></dt><dt><span class="section"><a href="#jdbc-DriverManagerDataSource">13.3.6. DriverManagerDataSource</a></span></dt><dt><span class="section"><a href="#jdbc-TransactionAwareDataSourceProxy">13.3.7. TransactionAwareDataSourceProxy</a></span></dt><dt><span class="section"><a href="#jdbc-DataSourceTransactionManager">13.3.8. DataSourceTransactionManager</a></span></dt><dt><span class="section"><a href="#jdbc-NativeJdbcExtractor">13.3.9. NativeJdbcExtractor</a></span></dt></dl></dd><dt><span class="section"><a href="#jdbc-advanced-jdbc">13.4. JDBC batch operations</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-batch-classic">13.4.1. Basic batch operations with the JdbcTemplate</a></span></dt><dt><span class="section"><a href="#jdbc-batch-list">13.4.2. Batch operations with a List of objects</a></span></dt><dt><span class="section"><a href="#jdbc-batch-multi">13.4.3. Batch operations with multiple batches</a></span></dt></dl></dd><dt><span class="section"><a href="#jdbc-simple-jdbc">13.5. Simplifying JDBC operations with the SimpleJdbc classes</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-simple-jdbc-insert-1">13.5.1. Inserting data using SimpleJdbcInsert</a></span></dt><dt><span class="section"><a href="#jdbc-simple-jdbc-insert-2">13.5.2. Retrieving auto-generated keys using SimpleJdbcInsert</a></span></dt><dt><span class="section"><a href="#jdbc-simple-jdbc-insert-3">13.5.3. Specifying columns for a SimpleJdbcInsert</a></span></dt><dt><span class="section"><a href="#jdbc-simple-jdbc-parameters">13.5.4. Using SqlParameterSource to provide parameter values</a></span></dt><dt><span class="section"><a href="#jdbc-simple-jdbc-call-1">13.5.5. Calling a stored procedure with SimpleJdbcCall</a></span></dt><dt><span class="section"><a href="#jdbc-simple-jdbc-call-2">13.5.6. Explicitly declaring parameters to use for a
      SimpleJdbcCall</a></span></dt><dt><span class="section"><a href="#jdbc-params">13.5.7. How to define SqlParameters</a></span></dt><dt><span class="section"><a href="#jdbc-simple-jdbc-call-3">13.5.8. Calling a stored function using SimpleJdbcCall</a></span></dt><dt><span class="section"><a href="#jdbc-simple-jdbc-call-4">13.5.9. Returning ResultSet/REF Cursor from a SimpleJdbcCall</a></span></dt></dl></dd><dt><span class="section"><a href="#jdbc-object">13.6. Modeling JDBC operations as Java objects</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-SqlQuery">13.6.1. SqlQuery</a></span></dt><dt><span class="section"><a href="#jdbc-MappingSqlQuery">13.6.2. MappingSqlQuery</a></span></dt><dt><span class="section"><a href="#jdbc-SqlUpdate">13.6.3. SqlUpdate</a></span></dt><dt><span class="section"><a href="#jdbc-StoredProcedure">13.6.4. StoredProcedure</a></span></dt></dl></dd><dt><span class="section"><a href="#jdbc-parameter-handling">13.7. Common problems with parameter and data value handling</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-type-information">13.7.1. Providing SQL type information for parameters</a></span></dt><dt><span class="section"><a href="#jdbc-lob">13.7.2. Handling BLOB and CLOB objects</a></span></dt><dt><span class="section"><a href="#jdbc-in-clause">13.7.3. Passing in lists of values for IN clause</a></span></dt><dt><span class="section"><a href="#jdbc-complex-types">13.7.4. Handling complex types for stored procedure calls</a></span></dt></dl></dd><dt><span class="section"><a href="#jdbc-embedded-database-support">13.8. Embedded database support</a></span></dt><dd><dl><dt><span class="section"><a href="#jdbc-why-embedded-database">13.8.1. Why use an embedded database?</a></span></dt><dt><span class="section"><a href="#jdbc-embedded-database-xml">13.8.2. Creating an embedded database instance using Spring XML</a></span></dt><dt><span class="section"><a href="#jdbc-embedded-database-java">13.8.3. Creating an embedded database instance programmatically</a></span></dt><dt><span class="section"><a href="#jdbc-embedded-database-extension">13.8.4. Extending the embedded database support</a></span></dt><dt><span class="section"><a href="#jdbc-embedded-database-using-HSQL">13.8.5. Using HSQL</a></span></dt><dt><span class="section"><a href="#jdbc-embedded-database-using-H2">13.8.6. Using H2</a></span></dt><dt><span class="section"><a href="#jdbc-embedded-database-using-Derby">13.8.7. Using Derby</a></span></dt><dt><span class="section"><a href="#jdbc-embedded-database-dao-testing">13.8.8. Testing data access logic with an embedded database</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e25689">13.9. Initializing a DataSource</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25703">13.9.1. Initializing a database instance using Spring XML</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25767">13.9.1.1. Initialization of Other Components that Depend on the
        Database</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#orm">14. Object Relational Mapping (ORM) Data Access</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-introduction">14.1. Introduction to ORM with Spring</a></span></dt><dt><span class="section"><a href="#orm-general">14.2. General ORM integration considerations</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-resource-mngmnt">14.2.1. Resource and transaction management</a></span></dt><dt><span class="section"><a href="#orm-exception-translation">14.2.2. Exception translation</a></span></dt></dl></dd><dt><span class="section"><a href="#orm-hibernate">14.3. Hibernate</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-session-factory-setup">14.3.1. SessionFactory setup in a Spring
      container</a></span></dt><dt><span class="section"><a href="#orm-hibernate-straight">14.3.2. Implementing DAOs based on plain Hibernate 3 API</a></span></dt><dt><span class="section"><a href="#orm-hibernate-tx-declarative">14.3.3. Declarative transaction demarcation</a></span></dt><dt><span class="section"><a href="#orm-hibernate-tx-programmatic">14.3.4. Programmatic transaction demarcation</a></span></dt><dt><span class="section"><a href="#orm-hibernate-tx-strategies">14.3.5. Transaction management strategies</a></span></dt><dt><span class="section"><a href="#orm-hibernate-resources">14.3.6. Comparing container-managed and locally defined resources</a></span></dt><dt><span class="section"><a href="#orm-hibernate-invalid-jdbc-access-error">14.3.7. Spurious application server warnings with Hibernate</a></span></dt></dl></dd><dt><span class="section"><a href="#orm-jdo">14.4. JDO</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-jdo-setup">14.4.1. PersistenceManagerFactory
      setup</a></span></dt><dt><span class="section"><a href="#orm-jdo-daos-straight">14.4.2. Implementing DAOs based on the plain JDO API</a></span></dt><dt><span class="section"><a href="#orm-jdo-tx">14.4.3. Transaction management</a></span></dt><dt><span class="section"><a href="#orm-jdo-dialect">14.4.4. JdoDialect</a></span></dt></dl></dd><dt><span class="section"><a href="#orm-jpa">14.5. JPA</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-jpa-setup">14.5.1. Three options for JPA setup in a Spring environment</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-jpa-setup-lemfb">14.5.1.1. LocalEntityManagerFactoryBean</a></span></dt><dt><span class="section"><a href="#orm-jpa-setup-jndi">14.5.1.2. Obtaining an EntityManagerFactory from
        JNDI</a></span></dt><dt><span class="section"><a href="#orm-jpa-setup-lcemfb">14.5.1.3. LocalContainerEntityManagerFactoryBean</a></span></dt><dt><span class="section"><a href="#orm-jpa-multiple-pu">14.5.1.4. Dealing with multiple persistence units</a></span></dt></dl></dd><dt><span class="section"><a href="#orm-jpa-straight">14.5.2. Implementing DAOs based on plain JPA</a></span></dt><dt><span class="section"><a href="#orm-jpa-tx">14.5.3. Transaction Management</a></span></dt><dt><span class="section"><a href="#orm-jpa-dialect">14.5.4. JpaDialect</a></span></dt></dl></dd><dt><span class="section"><a href="#orm-ibatis">14.6. iBATIS SQL Maps</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-ibatis-setup">14.6.1. Setting up the SqlMapClient</a></span></dt><dt><span class="section"><a href="#orm-ibatis-template">14.6.2. Using SqlMapClientTemplate and
      SqlMapClientDaoSupport</a></span></dt><dt><span class="section"><a href="#orm-ibatis-straight">14.6.3. Implementing DAOs based on plain iBATIS API</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#oxm">15. Marshalling XML using O/X Mappers</a></span></dt><dd><dl><dt><span class="section"><a href="#oxm-introduction">15.1. Introduction</a></span></dt><dt><span class="section"><a href="#oxm-marshaller-unmarshaller">15.2. Marshaller and Unmarshaller</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e27536">15.2.1. Marshaller</a></span></dt><dt><span class="section"><a href="#d0e27604">15.2.2. Unmarshaller</a></span></dt><dt><span class="section"><a href="#d0e27678">15.2.3. XmlMappingException</a></span></dt></dl></dd><dt><span class="section"><a href="#oxm-usage">15.3. Using Marshaller and Unmarshaller</a></span></dt><dt><span class="section"><a href="#d0e27769">15.4. XML Schema-based Configuration</a></span></dt><dt><span class="section"><a href="#oxm-jaxb">15.5. JAXB</a></span></dt><dd><dl><dt><span class="section"><a href="#oxm-jaxb2">15.5.1. Jaxb2Marshaller</a></span></dt><dd><dl><dt><span class="section"><a href="#oxm-jaxb2-xsd">15.5.1.1. XML Schema-based Configuration</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#oxm-castor">15.6. Castor</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e27916">15.6.1. CastorMarshaller</a></span></dt><dt><span class="section"><a href="#d0e27932">15.6.2. Mapping</a></span></dt></dl></dd><dt><span class="section"><a href="#oxm-xmlbeans">15.7. XMLBeans</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e27965">15.7.1. XmlBeansMarshaller</a></span></dt><dd><dl><dt><span class="section"><a href="#oxm-xmlbeans-xsd">15.7.1.1. XML Schema-based Configuration</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#oxm-jibx">15.8. JiBX</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e28057">15.8.1. JibxMarshaller</a></span></dt><dd><dl><dt><span class="section"><a href="#oxm-jibx-xsd">15.8.1.1. XML Schema-based Configuration</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#oxm-xstream">15.9. XStream</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e28162">15.9.1. XStreamMarshaller</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#spring-web">V. The Web</a></span></dt><dd><dl><dt><span class="chapter"><a href="#mvc">16. Web MVC framework</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-introduction">16.1. Introduction to Spring Web MVC framework</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-features">16.1.1. Features of Spring Web MVC</a></span></dt><dt><span class="section"><a href="#mvc-introduction-pluggability">16.1.2. Pluggability of other MVC implementations</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-servlet">16.2. The DispatcherServlet</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-servlet-special-bean-types">16.2.1. Special Bean Types In the WebApplicationContext</a></span></dt><dt><span class="section"><a href="#mvc-servlet-config">16.2.2. Default DispatcherServlet Configuration</a></span></dt><dt><span class="section"><a href="#mvc-servlet-sequence">16.2.3. DispatcherServlet Processing Sequence</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-controller">16.3. Implementing Controllers</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-ann-controller">16.3.1. Defining a controller with
      @Controller</a></span></dt><dt><span class="section"><a href="#mvc-ann-requestmapping">16.3.2. Mapping Requests With
      @RequestMapping</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-ann-requestmapping-31-vs-30">16.3.2.1. New Support Classes for @RequestMapping methods in Spring MVC 3.1</a></span></dt><dt><span class="section"><a href="#mvc-ann-requestmapping-uri-templates">16.3.2.2. URI Template Patterns</a></span></dt><dt><span class="section"><a href="#mvc-ann-requestmapping-uri-templates-regex">16.3.2.3. URI Template Patterns with Regular Expressions</a></span></dt><dt><span class="section"><a href="#mvc-ann-requestmapping-patterns">16.3.2.4. Path Patterns</a></span></dt><dt><span class="section"><a href="#mvc-ann-requestmapping-consumes">16.3.2.5. Consumable Media Types</a></span></dt><dt><span class="section"><a href="#mvc-ann-requestmapping-produces">16.3.2.6. Producible Media Types</a></span></dt><dt><span class="section"><a href="#mvc-ann-requestmapping-params-and-headers">16.3.2.7. Request Parameters and Header Values</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-ann-methods">16.3.3. Defining @RequestMapping handler
      methods</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-ann-arguments">16.3.3.1. Supported method argument types</a></span></dt><dt><span class="section"><a href="#mvc-ann-return-types">16.3.3.2. Supported method return types</a></span></dt><dt><span class="section"><a href="#mvc-ann-requestparam">16.3.3.3. Binding request parameters to method parameters with
        @RequestParam</a></span></dt><dt><span class="section"><a href="#mvc-ann-requestbody">16.3.3.4. Mapping the request body with the @RequestBody
        annotation</a></span></dt><dt><span class="section"><a href="#mvc-ann-responsebody">16.3.3.5. Mapping the response body with the
        @ResponseBody annotation</a></span></dt><dt><span class="section"><a href="#mvc-ann-httpentity">16.3.3.6. Using HttpEntity&lt;?&gt;</a></span></dt><dt><span class="section"><a href="#mvc-ann-modelattrib-methods">16.3.3.7. Using @ModelAttribute on a
        method</a></span></dt><dt><span class="section"><a href="#mvc-ann-modelattrib-method-args">16.3.3.8. Using @ModelAttribute on a
        method argument</a></span></dt><dt><span class="section"><a href="#mvc-ann-sessionattrib">16.3.3.9. Using @SessionAttributes to store model
        attributes in the HTTP session between requests</a></span></dt><dt><span class="section"><a href="#mvc-ann-redirect-attributes">16.3.3.10. Specifying redirect and flash attributes</a></span></dt><dt><span class="section"><a href="#mvc-ann-form-urlencoded-data">16.3.3.11. Working with
        "application/x-www-form-urlencoded" data</a></span></dt><dt><span class="section"><a href="#mvc-ann-cookievalue">16.3.3.12. Mapping cookie values with the @CookieValue annotation</a></span></dt><dt><span class="section"><a href="#mvc-ann-requestheader">16.3.3.13. Mapping request header attributes with the @RequestHeader
        annotation</a></span></dt><dt><span class="section"><a href="#mvc-ann-typeconversion">16.3.3.14. Method Parameters And Type Conversion</a></span></dt><dt><span class="section"><a href="#mvc-ann-webdatabinder">16.3.3.15. Customizing WebDataBinder
        initialization</a></span></dt><dt><span class="section"><a href="#mvc-ann-lastmodified">16.3.3.16. Support for the 'Last-Modified' Response Header To Facilitate
        Content Caching</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#mvc-handlermapping">16.4. Handler mappings</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-handlermapping-interceptor">16.4.1. Intercepting requests with a
      HandlerInterceptor</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-viewresolver">16.5. Resolving views</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-viewresolver-resolver">16.5.1. Resolving views with the
      ViewResolver interface</a></span></dt><dt><span class="section"><a href="#mvc-viewresolver-chaining">16.5.2. Chaining ViewResolvers</a></span></dt><dt><span class="section"><a href="#mvc-redirecting">16.5.3. Redirecting to views</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-redirecting-redirect-view">16.5.3.1. RedirectView</a></span></dt><dt><span class="section"><a href="#mvc-redirecting-redirect-prefix">16.5.3.2. The redirect: prefix</a></span></dt><dt><span class="section"><a href="#mvc-redirecting-forward-prefix">16.5.3.3. The forward: prefix</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-multiple-representations">16.5.4. ContentNegotiatingViewResolver</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-flash-attributes">16.6. Using flash attributes</a></span></dt><dt><span class="section"><a href="#mvc-construct-encode-uri">16.7. Building URIs</a></span></dt><dt><span class="section"><a href="#mvc-localeresolver">16.8. Using locales</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-localeresolver-acceptheader">16.8.1. AcceptHeaderLocaleResolver</a></span></dt><dt><span class="section"><a href="#mvc-localeresolver-cookie">16.8.2. CookieLocaleResolver</a></span></dt><dt><span class="section"><a href="#mvc-localeresolver-session">16.8.3. SessionLocaleResolver</a></span></dt><dt><span class="section"><a href="#mvc-localeresolver-interceptor">16.8.4. LocaleChangeInterceptor</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-themeresolver">16.9. Using themes</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-themeresolver-introduction">16.9.1. Overview of themes</a></span></dt><dt><span class="section"><a href="#mvc-themeresolver-defining">16.9.2. Defining themes</a></span></dt><dt><span class="section"><a href="#mvc-themeresolver-resolving">16.9.3. Theme resolvers</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-multipart">16.10. Spring's multipart (file upload) support</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-multipart-introduction">16.10.1. Introduction</a></span></dt><dt><span class="section"><a href="#mvc-multipart-resolver-commons">16.10.2. Using a MultipartResolver with
      Commons FileUpload</a></span></dt><dt><span class="section"><a href="#mvc-multipart-resolver-standard">16.10.3. Using a MultipartResolver with
      Servlet 3.0</a></span></dt><dt><span class="section"><a href="#mvc-multipart-forms">16.10.4. Handling a file upload in a form</a></span></dt><dt><span class="section"><a href="#mvc-multipart-forms-non-browsers">16.10.5. Handling a file upload request from programmatic clients</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-exceptionhandlers">16.11. Handling exceptions</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e32002">16.11.1. HandlerExceptionResolver</a></span></dt><dt><span class="section"><a href="#mvc-ann-exceptionhandler">16.11.2. @ExceptionHandler</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-coc">16.12. Convention over configuration support</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-coc-ccnhm">16.12.1. The Controller
      ControllerClassNameHandlerMapping</a></span></dt><dt><span class="section"><a href="#mvc-coc-modelmap">16.12.2. The Model ModelMap
      (ModelAndView)</a></span></dt><dt><span class="section"><a href="#mvc-coc-r2vnt">16.12.3. The View -
      RequestToViewNameTranslator</a></span></dt></dl></dd><dt><span class="section"><a href="#mvc-etag">16.13. ETag support</a></span></dt><dt><span class="section"><a href="#mvc-config">16.14. Configuring Spring MVC</a></span></dt><dd><dl><dt><span class="section"><a href="#mvc-config-enable">16.14.1. Enabling MVC Java Config or the MVC XML Namespace</a></span></dt><dt><span class="section"><a href="#mvc-config-customize">16.14.2. Customizing the Provided Configuration</a></span></dt><dt><span class="section"><a href="#mvc-config-interceptors">16.14.3. Configuring Interceptors</a></span></dt><dt><span class="section"><a href="#mvc-config-view-controller">16.14.4. Configuring View Controllers</a></span></dt><dt><span class="section"><a href="#mvc-config-static-resources">16.14.5. Configuring Serving of Resources</a></span></dt><dt><span class="section"><a href="#mvc-default-servlet-handler">16.14.6. mvc:default-servlet-handler</a></span></dt><dt><span class="section"><a href="#mvc-resources">16.14.7. More Spring Web MVC Resources</a></span></dt><dt><span class="section"><a href="#mvc-config-advanced-java">16.14.8. Advanced Customizations with MVC Java Config</a></span></dt><dt><span class="section"><a href="#mvc-config-advanced-xml">16.14.9. Advanced Customizations with the MVC Namespace</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#view">17. View technologies</a></span></dt><dd><dl><dt><span class="section"><a href="#view-introduction">17.1. Introduction</a></span></dt><dt><span class="section"><a href="#view-jsp">17.2. JSP &amp; JSTL</a></span></dt><dd><dl><dt><span class="section"><a href="#view-jsp-resolver">17.2.1. View resolvers</a></span></dt><dt><span class="section"><a href="#view-jsp-jstl">17.2.2. 'Plain-old' JSPs versus JSTL</a></span></dt><dt><span class="section"><a href="#view-jsp-tags">17.2.3. Additional tags facilitating development</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib">17.2.4. Using Spring's form tag library</a></span></dt><dd><dl><dt><span class="section"><a href="#view-jsp-formtaglib-configuration">17.2.4.1. Configuration</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-formtag">17.2.4.2. The form tag</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-inputtag">17.2.4.3. The input tag</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-checkboxtag">17.2.4.4. The checkbox tag</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-checkboxestag">17.2.4.5. The checkboxes tag</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-radiobuttontag">17.2.4.6. The radiobutton tag</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-radiobuttonstag">17.2.4.7. The radiobuttons tag</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-passwordtag">17.2.4.8. The password tag</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-selecttag">17.2.4.9. The select tag</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-optiontag">17.2.4.10. The option tag</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-optionstag">17.2.4.11. The options tag</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-textAreatag">17.2.4.12. The textarea tag</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-hiddeninputtag">17.2.4.13. The hidden tag</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-errorstag">17.2.4.14. The errors tag</a></span></dt><dt><span class="section"><a href="#rest-method-conversion">17.2.4.15. HTTP Method Conversion</a></span></dt><dt><span class="section"><a href="#view-jsp-formtaglib-html5">17.2.4.16. HTML5 Tags</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#view-tiles">17.3. Tiles</a></span></dt><dd><dl><dt><span class="section"><a href="#view-tiles-dependencies">17.3.1. Dependencies</a></span></dt><dt><span class="section"><a href="#view-tiles-integrate">17.3.2. How to integrate Tiles</a></span></dt><dd><dl><dt><span class="section"><a href="#view-tiles-url">17.3.2.1. 
          UrlBasedViewResolver
        </a></span></dt><dt><span class="section"><a href="#view-tiles-resource">17.3.2.2. 
          ResourceBundleViewResolver
        </a></span></dt><dt><span class="section"><a href="#view-tiles-preparer">17.3.2.3. SimpleSpringPreparerFactory and
        SpringBeanPreparerFactory</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#view-velocity">17.4. Velocity &amp; FreeMarker</a></span></dt><dd><dl><dt><span class="section"><a href="#view-velocity-dependencies">17.4.1. Dependencies</a></span></dt><dt><span class="section"><a href="#view-velocity-contextconfig">17.4.2. Context configuration</a></span></dt><dt><span class="section"><a href="#view-velocity-createtemplates">17.4.3. Creating templates</a></span></dt><dt><span class="section"><a href="#view-velocity-advancedconfig">17.4.4. Advanced configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#view-velocity-example-velocityproperties">17.4.4.1. velocity.properties</a></span></dt><dt><span class="section"><a href="#views-freemarker">17.4.4.2. FreeMarker</a></span></dt></dl></dd><dt><span class="section"><a href="#view-velocity-forms">17.4.5. Bind support and form handling</a></span></dt><dd><dl><dt><span class="section"><a href="#view-bind-macros">17.4.5.1. The bind macros</a></span></dt><dt><span class="section"><a href="#view-simple-binding">17.4.5.2. Simple binding</a></span></dt><dt><span class="section"><a href="#views-form-macros">17.4.5.3. Form input generation macros</a></span></dt><dt><span class="section"><a href="#views-form-macros-html-escaping">17.4.5.4. HTML escaping and XHTML compliance</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#view-xslt">17.5. XSLT</a></span></dt><dd><dl><dt><span class="section"><a href="#view-xslt-firstwords">17.5.1. My First Words</a></span></dt><dd><dl><dt><span class="section"><a href="#view-xslt-beandefs">17.5.1.1. Bean definitions</a></span></dt><dt><span class="section"><a href="#view-xslt-controllercode">17.5.1.2. Standard MVC controller code</a></span></dt><dt><span class="section"><a href="#view-xslt-subclassing">17.5.1.3. Convert the model data to XML</a></span></dt><dt><span class="section"><a href="#view-xslt-viewdefinitions">17.5.1.4. Defining the view properties</a></span></dt><dt><span class="section"><a href="#view-xslt-transforming">17.5.1.5. Document transformation</a></span></dt></dl></dd><dt><span class="section"><a href="#view-xslt-summary">17.5.2. Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#view-document">17.6. Document views (PDF/Excel)</a></span></dt><dd><dl><dt><span class="section"><a href="#view-document-intro">17.6.1. Introduction</a></span></dt><dt><span class="section"><a href="#view-document-config">17.6.2. Configuration and setup</a></span></dt><dd><dl><dt><span class="section"><a href="#view-document-configviews">17.6.2.1. Document view definitions</a></span></dt><dt><span class="section"><a href="#view-document-configcontroller">17.6.2.2. Controller code</a></span></dt><dt><span class="section"><a href="#view-document-configsubclasses">17.6.2.3. Subclassing for Excel views</a></span></dt><dt><span class="section"><a href="#view-document-configsubclasspdf">17.6.2.4. Subclassing for PDF views</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#view-jasper-reports">17.7. JasperReports</a></span></dt><dd><dl><dt><span class="section"><a href="#view-jasper-reports-dependencies">17.7.1. Dependencies</a></span></dt><dt><span class="section"><a href="#view-jasper-reports-configuration">17.7.2. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#view-jasper-reports-configuration-resolver">17.7.2.1. Configuring the
        ViewResolver</a></span></dt><dt><span class="section"><a href="#view-jasper-reports-configuration-views">17.7.2.2. Configuring the Views</a></span></dt><dt><span class="section"><a href="#view-jasper-reports-configuration-report-files">17.7.2.3. About Report Files</a></span></dt><dt><span class="section"><a href="#view-jasper-reports-configuration-multiformat-view">17.7.2.4. Using
        JasperReportsMultiFormatView</a></span></dt></dl></dd><dt><span class="section"><a href="#view-jasper-reports-model">17.7.3. Populating the ModelAndView</a></span></dt><dt><span class="section"><a href="#view-jasper-reports-subreports">17.7.4. Working with Sub-Reports</a></span></dt><dd><dl><dt><span class="section"><a href="#view-jasper-reports-subreports-config-reports">17.7.4.1. Configuring Sub-Report Files</a></span></dt><dt><span class="section"><a href="#view-jasper-reports-subreports-config-datasources">17.7.4.2. Configuring Sub-Report Data Sources</a></span></dt></dl></dd><dt><span class="section"><a href="#view-jasper-reports-exporter-parameters">17.7.5. Configuring Exporter Parameters</a></span></dt></dl></dd><dt><span class="section"><a href="#view-feeds">17.8. Feed Views</a></span></dt><dt><span class="section"><a href="#view-xml-marshalling">17.9. XML Marshalling View</a></span></dt><dt><span class="section"><a href="#view-json-mapping">17.10. JSON Mapping View</a></span></dt></dl></dd><dt><span class="chapter"><a href="#web-integration">18. Integrating with other web frameworks</a></span></dt><dd><dl><dt><span class="section"><a href="#intro">18.1. Introduction</a></span></dt><dt><span class="section"><a href="#web-integration-common">18.2. Common configuration</a></span></dt><dt><span class="section"><a href="#jsf">18.3. JavaServer Faces 1.1 and 1.2</a></span></dt><dd><dl><dt><span class="section"><a href="#jsf-delegatingvariableresolver">18.3.1. DelegatingVariableResolver (JSF 1.1/1.2)</a></span></dt><dt><span class="section"><a href="#jsf-springbeanvariableresolver">18.3.2. SpringBeanVariableResolver (JSF 1.1/1.2)</a></span></dt><dt><span class="section"><a href="#jsf-springbeanfaceselresolver">18.3.3. SpringBeanFacesELResolver (JSF 1.2+)</a></span></dt><dt><span class="section"><a href="#jsf-facescontextutils">18.3.4. FacesContextUtils</a></span></dt></dl></dd><dt><span class="section"><a href="#struts">18.4. Apache Struts 1.x and 2.x</a></span></dt><dd><dl><dt><span class="section"><a href="#struts-contextloaderplugin">18.4.1. ContextLoaderPlugin</a></span></dt><dd><dl><dt><span class="section"><a href="#struts-delegatingrequestprocessor">18.4.1.1. DelegatingRequestProcessor</a></span></dt><dt><span class="section"><a href="#struts-delegatingactionproxy">18.4.1.2. DelegatingActionProxy</a></span></dt></dl></dd><dt><span class="section"><a href="#struts-actionsupport">18.4.2. ActionSupport Classes</a></span></dt></dl></dd><dt><span class="section"><a href="#webwork">18.5. WebWork 2.x</a></span></dt><dt><span class="section"><a href="#tapestry">18.6. Tapestry 3.x and 4.x</a></span></dt><dd><dl><dt><span class="section"><a href="#tapestry-di">18.6.1. Injecting Spring-managed beans</a></span></dt><dd><dl><dt><span class="section"><a href="#tapestry-pre4-style-di">18.6.1.1. Dependency Injecting Spring Beans into Tapestry pages</a></span></dt><dt><span class="section"><a href="#tapestry-componentdefs">18.6.1.2. Component definition files</a></span></dt><dt><span class="section"><a href="#tapestry-getters">18.6.1.3. Adding abstract accessors</a></span></dt><dt><span class="section"><a href="#tapestry-4-style-di">18.6.1.4. Dependency Injecting Spring Beans into Tapestry pages -
        Tapestry 4.x style</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#web-integration-resources">18.7. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#portlet">19. Portlet MVC Framework</a></span></dt><dd><dl><dt><span class="section"><a href="#portlet-introduction">19.1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#portlet-introduction-controller">19.1.1. Controllers - The C in MVC</a></span></dt><dt><span class="section"><a href="#portlet-introduction-view">19.1.2. Views - The V in MVC</a></span></dt><dt><span class="section"><a href="#portlet-introduction-scope">19.1.3. Web-scoped beans</a></span></dt></dl></dd><dt><span class="section"><a href="#portlet-dispatcher">19.2. The DispatcherPortlet</a></span></dt><dt><span class="section"><a href="#portlet-viewservlet">19.3. The ViewRendererServlet</a></span></dt><dt><span class="section"><a href="#portlet-controller">19.4. Controllers</a></span></dt><dd><dl><dt><span class="section"><a href="#portlet-controller-abstractcontroller">19.4.1. AbstractController and PortletContentGenerator</a></span></dt><dt><span class="section"><a href="#portlet-controller-simple">19.4.2. Other simple controllers</a></span></dt><dt><span class="section"><a href="#portlet-controller-command">19.4.3. Command Controllers</a></span></dt><dt><span class="section"><a href="#portlet-controller-wrapping">19.4.4. PortletWrappingController</a></span></dt></dl></dd><dt><span class="section"><a href="#portlet-handlermapping">19.5. Handler mappings</a></span></dt><dd><dl><dt><span class="section"><a href="#portlet-handlermapping-portletmode">19.5.1. PortletModeHandlerMapping</a></span></dt><dt><span class="section"><a href="#portlet-handlermapping-parameter">19.5.2. ParameterHandlerMapping</a></span></dt><dt><span class="section"><a href="#portlet-handlermapping-portletmodeparameter">19.5.3. PortletModeParameterHandlerMapping</a></span></dt><dt><span class="section"><a href="#portlet-handlermapping-interceptor">19.5.4. Adding HandlerInterceptors</a></span></dt><dt><span class="section"><a href="#portlet-handlermapping-interceptoradapter">19.5.5. HandlerInterceptorAdapter</a></span></dt><dt><span class="section"><a href="#portlet-handlermapping-parameterinterceptor">19.5.6. ParameterMappingInterceptor</a></span></dt></dl></dd><dt><span class="section"><a href="#portlet-viewresolver">19.6. Views and resolving them</a></span></dt><dt><span class="section"><a href="#portlet-multipart">19.7. Multipart (file upload) support</a></span></dt><dd><dl><dt><span class="section"><a href="#portlet-multipart-resolver">19.7.1. Using the PortletMultipartResolver</a></span></dt><dt><span class="section"><a href="#portlet-multipart-forms">19.7.2. Handling a file upload in a form</a></span></dt></dl></dd><dt><span class="section"><a href="#portlet-exceptionresolver">19.8. Handling exceptions</a></span></dt><dt><span class="section"><a href="#portlet-annotation">19.9. Annotation-based controller configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#portlet-ann-setup">19.9.1. Setting up the dispatcher for annotation support</a></span></dt><dt><span class="section"><a href="#portlet-ann-controller">19.9.2. Defining a controller with
      @Controller</a></span></dt><dt><span class="section"><a href="#portlet-ann-requestmapping">19.9.3. Mapping requests with
      @RequestMapping</a></span></dt><dt><span class="section"><a href="#portlet-ann-requestmapping-arguments">19.9.4. Supported handler method arguments</a></span></dt><dt><span class="section"><a href="#portlet-ann-requestparam">19.9.5. Binding request parameters to method parameters with
      @RequestParam</a></span></dt><dt><span class="section"><a href="#portlet-ann-modelattrib">19.9.6. Providing a link to data from the model with
      @ModelAttribute</a></span></dt><dt><span class="section"><a href="#portlet-ann-sessionattrib">19.9.7. Specifying attributes to store in a Session with
      @SessionAttributes</a></span></dt><dt><span class="section"><a href="#portlet-ann-webdatabinder">19.9.8. Customizing WebDataBinder
      initialization</a></span></dt><dd><dl><dt><span class="section"><a href="#portlet-ann-initbinder">19.9.8.1. Customizing data binding with
        @InitBinder</a></span></dt><dt><span class="section"><a href="#portlet-ann-webbindinginitializer">19.9.8.2. Configuring a custom
        WebBindingInitializer</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#portlet-deployment">19.10. Portlet application deployment</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#spring-integration">VI. Integration</a></span></dt><dd><dl><dt><span class="chapter"><a href="#remoting">20. Remoting and web services using Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#remoting-introduction">20.1. Introduction</a></span></dt><dt><span class="section"><a href="#remoting-rmi">20.2. Exposing services using RMI</a></span></dt><dd><dl><dt><span class="section"><a href="#remoting-rmi-server">20.2.1. Exporting the service using the
      RmiServiceExporter</a></span></dt><dt><span class="section"><a href="#remoting-rmi-client">20.2.2. Linking in the service at the client</a></span></dt></dl></dd><dt><span class="section"><a href="#remoting-caucho-protocols">20.3. Using Hessian or Burlap to remotely call services via HTTP</a></span></dt><dd><dl><dt><span class="section"><a href="#remoting-caucho-protocols-hessian">20.3.1. Wiring up the DispatcherServlet for
      Hessian and co.</a></span></dt><dt><span class="section"><a href="#remoting-caucho-protocols-hessian-server">20.3.2. Exposing your beans by using the
      HessianServiceExporter</a></span></dt><dt><span class="section"><a href="#remoting-caucho-protocols-hessian-client">20.3.3. Linking in the service on the client</a></span></dt><dt><span class="section"><a href="#remoting-caucho-protocols-burlap">20.3.4. Using Burlap</a></span></dt><dt><span class="section"><a href="#remoting-caucho-protocols-security">20.3.5. Applying HTTP basic authentication to a service exposed through
      Hessian or Burlap</a></span></dt></dl></dd><dt><span class="section"><a href="#remoting-httpinvoker">20.4. Exposing services using HTTP invokers</a></span></dt><dd><dl><dt><span class="section"><a href="#remoting-httpinvoker-server">20.4.1. Exposing the service object</a></span></dt><dt><span class="section"><a href="#remoting-httpinvoker-client">20.4.2. Linking in the service at the client</a></span></dt></dl></dd><dt><span class="section"><a href="#remoting-web-services">20.5. Web services</a></span></dt><dd><dl><dt><span class="section"><a href="#remoting-web-services-jaxrpc-export">20.5.1. Exposing servlet-based web services using JAX-RPC</a></span></dt><dt><span class="section"><a href="#remoting-web-services-jaxrpc-access">20.5.2. Accessing web services using JAX-RPC</a></span></dt><dt><span class="section"><a href="#remoting-web-services-jaxrpc-mapping-registration">20.5.3. Registering JAX-RPC Bean Mappings</a></span></dt><dt><span class="section"><a href="#remoting-web-services-jaxrpc-handler-registration">20.5.4. Registering your own JAX-RPC Handler</a></span></dt><dt><span class="section"><a href="#remoting-web-services-jaxws-export-servlet">20.5.5. Exposing servlet-based web services using JAX-WS</a></span></dt><dt><span class="section"><a href="#remoting-web-services-jaxws-export-standalone">20.5.6. Exporting standalone web services using JAX-WS</a></span></dt><dt><span class="section"><a href="#remoting-web-services-jaxws-export-ri">20.5.7. Exporting web services using the JAX-WS RI's Spring
      support</a></span></dt><dt><span class="section"><a href="#remoting-web-services-jaxws-access">20.5.8. Accessing web services using JAX-WS</a></span></dt></dl></dd><dt><span class="section"><a href="#remoting-jms">20.6. JMS</a></span></dt><dd><dl><dt><span class="section"><a href="#remoting-jms-server">20.6.1. Server-side configuration</a></span></dt><dt><span class="section"><a href="#remoting-jms-client">20.6.2. Client-side configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#remoting-autodection-remote-interfaces">20.7. Auto-detection is not implemented for remote interfaces</a></span></dt><dt><span class="section"><a href="#remoting-considerations">20.8. Considerations when choosing a technology</a></span></dt><dt><span class="section"><a href="#rest-client-access">20.9. Accessing RESTful services on the Client</a></span></dt><dd><dl><dt><span class="section"><a href="#rest-resttemplate">20.9.1. RestTemplate</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e38897">20.9.1.1. Working with the URI</a></span></dt><dt><span class="section"><a href="#d0e38946">20.9.1.2. Dealing with request and response headers</a></span></dt></dl></dd><dt><span class="section"><a href="#rest-message-conversion">20.9.2. HTTP Message Conversion</a></span></dt><dd><dl><dt><span class="section"><a href="#rest-string-converter">20.9.2.1. StringHttpMessageConverter</a></span></dt><dt><span class="section"><a href="#rest-form-converter">20.9.2.2. FormHttpMessageConverter</a></span></dt><dt><span class="section"><a href="#rest-byte-converter">20.9.2.3. ByteArrayHttpMessageConverter</a></span></dt><dt><span class="section"><a href="#rest-marhsalling-converter">20.9.2.4. MarshallingHttpMessageConverter</a></span></dt><dt><span class="section"><a href="#rest-mapping-json-converter">20.9.2.5. MappingJacksonHttpMessageConverter</a></span></dt><dt><span class="section"><a href="#rest-source-converter">20.9.2.6. SourceHttpMessageConverter</a></span></dt><dt><span class="section"><a href="#rest-buffered-image-converter">20.9.2.7. BufferedImageHttpMessageConverter</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#ejb">21. Enterprise JavaBeans (EJB) integration</a></span></dt><dd><dl><dt><span class="section"><a href="#ejb-introduction">21.1. Introduction</a></span></dt><dt><span class="section"><a href="#ejb-access">21.2. Accessing EJBs</a></span></dt><dd><dl><dt><span class="section"><a href="#ejb-access-concepts">21.2.1. Concepts</a></span></dt><dt><span class="section"><a href="#ejb-access-local">21.2.2. Accessing local SLSBs</a></span></dt><dt><span class="section"><a href="#ejb-access-remote">21.2.3. Accessing remote SLSBs</a></span></dt><dt><span class="section"><a href="#ejb-access-ejb2-ejb3">21.2.4. Accessing EJB 2.x SLSBs versus EJB 3 SLSBs</a></span></dt></dl></dd><dt><span class="section"><a href="#ejb-implementation">21.3. Using Spring's EJB implementation support classes</a></span></dt><dd><dl><dt><span class="section"><a href="#ejb-implementation-ejb2">21.3.1. EJB 2.x base classes</a></span></dt><dt><span class="section"><a href="#ejb-implementation-ejb3">21.3.2. EJB 3 injection interceptor</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#jms">22. JMS (Java Message Service)</a></span></dt><dd><dl><dt><span class="section"><a href="#jms-introduction">22.1. Introduction</a></span></dt><dt><span class="section"><a href="#jms-using">22.2. Using Spring JMS</a></span></dt><dd><dl><dt><span class="section"><a href="#jms-jmstemplate">22.2.1. JmsTemplate</a></span></dt><dt><span class="section"><a href="#jms-connections">22.2.2. Connections</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e39676">22.2.2.1. Caching Messaging Resources</a></span></dt><dt><span class="section"><a href="#d0e39685">22.2.2.2. SingleConnectionFactory</a></span></dt><dt><span class="section"><a href="#d0e39714">22.2.2.3. CachingConnectionFactory</a></span></dt></dl></dd><dt><span class="section"><a href="#jms-destinations">22.2.3. Destination Management</a></span></dt><dt><span class="section"><a href="#jms-mdp">22.2.4. Message Listener Containers</a></span></dt><dd><dl><dt><span class="section"><a href="#jms-mdp-simple">22.2.4.1. SimpleMessageListenerContainer</a></span></dt><dt><span class="section"><a href="#jms-mdp-default">22.2.4.2. DefaultMessageListenerContainer</a></span></dt></dl></dd><dt><span class="section"><a href="#jms-tx">22.2.5. Transaction management</a></span></dt></dl></dd><dt><span class="section"><a href="#jms-sending">22.3. Sending a Message</a></span></dt><dd><dl><dt><span class="section"><a href="#jms-msg-conversion">22.3.1. Using Message Converters</a></span></dt><dt><span class="section"><a href="#jms-callbacks">22.3.2. SessionCallback and
      ProducerCallback</a></span></dt></dl></dd><dt><span class="section"><a href="#jms-receiving">22.4. Receiving a message</a></span></dt><dd><dl><dt><span class="section"><a href="#jms-receiving-sync">22.4.1. Synchronous Reception</a></span></dt><dt><span class="section"><a href="#jms-asynchronousMessageReception">22.4.2. Asynchronous Reception - Message-Driven POJOs</a></span></dt><dt><span class="section"><a href="#jms-receiving-async-session-aware-message-listener">22.4.3. The SessionAwareMessageListener
      interface</a></span></dt><dt><span class="section"><a href="#jms-receiving-async-message-listener-adapter">22.4.4. The MessageListenerAdapter</a></span></dt><dt><span class="section"><a href="#jms-tx-participation">22.4.5. Processing messages within transactions</a></span></dt></dl></dd><dt><span class="section"><a href="#jms-jca-message-endpoint-manager">22.5. Support for JCA Message Endpoints</a></span></dt><dt><span class="section"><a href="#jms-namespace">22.6. JMS Namespace Support</a></span></dt></dl></dd><dt><span class="chapter"><a href="#jmx">23. JMX</a></span></dt><dd><dl><dt><span class="section"><a href="#jmx-introduction">23.1. Introduction</a></span></dt><dt><span class="section"><a href="#jmx-exporting">23.2. Exporting your beans to JMX</a></span></dt><dd><dl><dt><span class="section"><a href="#jmx-exporting-mbeanserver">23.2.1. Creating an MBeanServer</a></span></dt><dt><span class="section"><a href="#jmx-mbean-server">23.2.2. Reusing an existing MBeanServer</a></span></dt><dt><span class="section"><a href="#jmx-exporting-lazy">23.2.3. Lazy-initialized MBeans</a></span></dt><dt><span class="section"><a href="#jmx-exporting-auto">23.2.4. Automatic registration of MBeans</a></span></dt><dt><span class="section"><a href="#jmx-exporting-registration-behavior">23.2.5. Controlling the registration behavior</a></span></dt></dl></dd><dt><span class="section"><a href="#jmx-interface">23.3. Controlling the management interface of your beans</a></span></dt><dd><dl><dt><span class="section"><a href="#jmx-interface-assembler">23.3.1. The MBeanInfoAssembler
      Interface</a></span></dt><dt><span class="section"><a href="#jmx-interface-metadata">23.3.2. Using Source-Level Metadata (JDK 5.0 annotations)</a></span></dt><dt><span class="section"><a href="#jmx-interface-metadata-types">23.3.3. Source-Level Metadata Types</a></span></dt><dt><span class="section"><a href="#jmx-interface-autodetect">23.3.4. The AutodetectCapableMBeanInfoAssembler
      interface</a></span></dt><dt><span class="section"><a href="#jmx-interface-java">23.3.5. Defining management interfaces using Java interfaces</a></span></dt><dt><span class="section"><a href="#jmx-interface-methodnames">23.3.6. Using
      MethodNameBasedMBeanInfoAssembler</a></span></dt></dl></dd><dt><span class="section"><a href="#jmx-naming">23.4. Controlling the ObjectNames for your beans</a></span></dt><dd><dl><dt><span class="section"><a href="#jmx-naming-properties">23.4.1. Reading ObjectNames from Properties</a></span></dt><dt><span class="section"><a href="#jmx-naming-metadata">23.4.2. Using the MetadataNamingStrategy</a></span></dt><dt><span class="section"><a href="#jmx-context-mbeanexport">23.4.3. The &lt;context:mbean-export/&gt; element</a></span></dt></dl></dd><dt><span class="section"><a href="#jmx-jsr160">23.5. JSR-160 Connectors</a></span></dt><dd><dl><dt><span class="section"><a href="#jmx-jsr160-server">23.5.1. Server-side Connectors</a></span></dt><dt><span class="section"><a href="#jmx-jsr160-client">23.5.2. Client-side Connectors</a></span></dt><dt><span class="section"><a href="#jmx-jsr160-protocols">23.5.3. JMX over Burlap/Hessian/SOAP</a></span></dt></dl></dd><dt><span class="section"><a href="#jmx-proxy">23.6. Accessing MBeans via Proxies</a></span></dt><dt><span class="section"><a href="#jmx-notifications">23.7. Notifications</a></span></dt><dd><dl><dt><span class="section"><a href="#jmx-notifications-listeners">23.7.1. Registering Listeners for Notifications</a></span></dt><dt><span class="section"><a href="#jmx-notifications-publishing">23.7.2. Publishing Notifications</a></span></dt></dl></dd><dt><span class="section"><a href="#jmx-resources">23.8. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#cci">24. JCA CCI</a></span></dt><dd><dl><dt><span class="section"><a href="#cci-introduction">24.1. Introduction</a></span></dt><dt><span class="section"><a href="#cci-config">24.2. Configuring CCI</a></span></dt><dd><dl><dt><span class="section"><a href="#cci-config-connector">24.2.1. Connector configuration</a></span></dt><dt><span class="section"><a href="#cci-config-connectionfactory">24.2.2. ConnectionFactory configuration in
      Spring</a></span></dt><dt><span class="section"><a href="#cci-config-cci-connections">24.2.3. Configuring CCI connections</a></span></dt><dt><span class="section"><a href="#cci-config-single-connection">24.2.4. Using a single CCI connection</a></span></dt></dl></dd><dt><span class="section"><a href="#cci-using">24.3. Using Spring's CCI access support</a></span></dt><dd><dl><dt><span class="section"><a href="#cci-record-creator">24.3.1. Record conversion</a></span></dt><dt><span class="section"><a href="#cci-using-template">24.3.2. The CciTemplate</a></span></dt><dt><span class="section"><a href="#cci-using-dao">24.3.3. DAO support</a></span></dt><dt><span class="section"><a href="#automatic-output-generation">24.3.4. Automatic output record generation</a></span></dt><dt><span class="section"><a href="#template-summary">24.3.5. Summary</a></span></dt><dt><span class="section"><a href="#cci-straight">24.3.6. Using a CCI Connection and
      Interaction directly</a></span></dt><dt><span class="section"><a href="#cci-template-example">24.3.7. Example for CciTemplate usage</a></span></dt></dl></dd><dt><span class="section"><a href="#cci-object">24.4. Modeling CCI access as operation objects</a></span></dt><dd><dl><dt><span class="section"><a href="#cci-object-mapping-record">24.4.1. MappingRecordOperation</a></span></dt><dt><span class="section"><a href="#cci-object-mapping-comm-area">24.4.2. MappingCommAreaOperation</a></span></dt><dt><span class="section"><a href="#cci-automatic-record-gen">24.4.3. Automatic output record generation</a></span></dt><dt><span class="section"><a href="#cci-object-summary">24.4.4. Summary</a></span></dt><dt><span class="section"><a href="#cci-objects-mappring-record-example">24.4.5. Example for MappingRecordOperation
      usage</a></span></dt><dt><span class="section"><a href="#cci-objects-mapping-comm-area-example">24.4.6. Example for MappingCommAreaOperation
      usage</a></span></dt></dl></dd><dt><span class="section"><a href="#cci-tx">24.5. Transactions</a></span></dt></dl></dd><dt><span class="chapter"><a href="#mail">25. Email</a></span></dt><dd><dl><dt><span class="section"><a href="#mail-introduction">25.1. Introduction</a></span></dt><dt><span class="section"><a href="#mail-usage">25.2. Usage</a></span></dt><dd><dl><dt><span class="section"><a href="#mail-usage-simple">25.2.1. Basic MailSender and SimpleMailMessage usage</a></span></dt><dt><span class="section"><a href="#mail-usage-mime">25.2.2. Using the JavaMailSender and the MimeMessagePreparator</a></span></dt></dl></dd><dt><span class="section"><a href="#mail-javamail-mime">25.3. Using the JavaMail MimeMessageHelper</a></span></dt><dd><dl><dt><span class="section"><a href="#mail-javamail-mime-attachments">25.3.1. Sending attachments and inline resources</a></span></dt><dd><dl><dt><span class="section"><a href="#mail-javamail-mime-attachments-attachment">25.3.1.1. Attachments</a></span></dt><dt><span class="section"><a href="#mail-javamail-mime-attachments-inline">25.3.1.2. Inline resources</a></span></dt></dl></dd><dt><span class="section"><a href="#mail-templates">25.3.2. Creating email content using a templating library</a></span></dt><dd><dl><dt><span class="section"><a href="#mail-templates-example">25.3.2.1. A Velocity-based example</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#scheduling">26. Task Execution and Scheduling</a></span></dt><dd><dl><dt><span class="section"><a href="#scheduling-introduction">26.1. Introduction</a></span></dt><dt><span class="section"><a href="#scheduling-task-executor">26.2. The Spring TaskExecutor
    abstraction</a></span></dt><dd><dl><dt><span class="section"><a href="#scheduling-task-executor-types">26.2.1. TaskExecutor types</a></span></dt><dt><span class="section"><a href="#scheduling-task-executor-usage">26.2.2. Using a TaskExecutor</a></span></dt></dl></dd><dt><span class="section"><a href="#scheduling-task-scheduler">26.3. The Spring TaskScheduler
    abstraction</a></span></dt><dd><dl><dt><span class="section"><a href="#scheduling-trigger-interface">26.3.1. The Trigger interface</a></span></dt><dt><span class="section"><a href="#scheduling-trigger-implementations">26.3.2. Trigger implementations</a></span></dt><dt><span class="section"><a href="#scheduling-task-scheduler-implementations">26.3.3. TaskScheduler
      implementations</a></span></dt></dl></dd><dt><span class="section"><a href="#scheduling-task-namespace">26.4. The Task Namespace</a></span></dt><dd><dl><dt><span class="section"><a href="#scheduling-task-namespace-scheduler">26.4.1. The 'scheduler' element</a></span></dt><dt><span class="section"><a href="#scheduling-task-namespace-executor">26.4.2. The 'executor' element</a></span></dt><dt><span class="section"><a href="#scheduling-task-namespace-scheduled-tasks">26.4.3. The 'scheduled-tasks' element</a></span></dt></dl></dd><dt><span class="section"><a href="#scheduling-annotation-support">26.5. Annotation Support for Scheduling and Asynchronous
    Execution</a></span></dt><dd><dl><dt><span class="section"><a href="#scheduling-annotation-support-scheduled">26.5.1. The @Scheduled Annotation</a></span></dt><dt><span class="section"><a href="#scheduling-annotation-support-async">26.5.2. The @Async Annotation</a></span></dt><dt><span class="section"><a href="#scheduling-annotation-support-namespace">26.5.3. The &lt;annotation-driven&gt; Element</a></span></dt></dl></dd><dt><span class="section"><a href="#scheduling-quartz">26.6. Using the Quartz Scheduler</a></span></dt><dd><dl><dt><span class="section"><a href="#scheduling-quartz-jobdetail">26.6.1. Using the JobDetailBean</a></span></dt><dt><span class="section"><a href="#scheduling-quartz-method-invoking-job">26.6.2. Using the
      MethodInvokingJobDetailFactoryBean</a></span></dt><dt><span class="section"><a href="#scheduling-quartz-cron">26.6.3. Wiring up jobs using triggers and the
      SchedulerFactoryBean</a></span></dt></dl></dd><dt><span class="section"><a href="#scheduling-jdk-timer">26.7. Using JDK Timer support</a></span></dt><dd><dl><dt><span class="section"><a href="#scheduling-jdk-timer-creating">26.7.1. Creating custom timers</a></span></dt><dt><span class="section"><a href="#scheduling-jdk-timer-method-invoking-task">26.7.2. Using the
      MethodInvokingTimerTaskFactoryBean</a></span></dt><dt><span class="section"><a href="#scheduling-jdk-timer-factory-bean">26.7.3. Wrapping up: setting up the tasks using the
      TimerFactoryBean</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#dynamic-language">27. Dynamic language support</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic-language-introduction">27.1. Introduction</a></span></dt><dt><span class="section"><a href="#dynamic-language-a-first-example">27.2. A first example</a></span></dt><dt><span class="section"><a href="#dynamic-language-beans">27.3. Defining beans that are backed by dynamic languages</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic-language-beans-concepts">27.3.1. Common concepts</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic-language-beans-concepts-xml-language-element">27.3.1.1. The &lt;lang:language/&gt; element</a></span></dt><dt><span class="section"><a href="#dynamic-language-refreshable-beans">27.3.1.2. Refreshable beans</a></span></dt><dt><span class="section"><a href="#dynamic-language-beans-inline">27.3.1.3. Inline dynamic language source files</a></span></dt><dt><span class="section"><a href="#dynamic-language-beans-ctor-injection">27.3.1.4. Understanding Constructor Injection in the context of dynamic-language-backed beans</a></span></dt></dl></dd><dt><span class="section"><a href="#dynamic-language-beans-jruby">27.3.2. JRuby beans</a></span></dt><dt><span class="section"><a href="#dynamic-language-beans-groovy">27.3.3. Groovy beans</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic-language-beans-groovy-customizer">27.3.3.1. Customising Groovy objects via a callback</a></span></dt></dl></dd><dt><span class="section"><a href="#dynamic-language-beans-bsh">27.3.4. BeanShell beans</a></span></dt></dl></dd><dt><span class="section"><a href="#dynamic-language-scenarios">27.4. Scenarios</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic-language-scenarios-controllers">27.4.1. Scripted Spring MVC Controllers</a></span></dt><dt><span class="section"><a href="#dynamic-language-scenarios-validators">27.4.2. Scripted Validators</a></span></dt></dl></dd><dt><span class="section"><a href="#dynamic-language-final-notes">27.5. Bits and bobs</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic-language-final-notes-aop">27.5.1. AOP - advising scripted beans</a></span></dt><dt><span class="section"><a href="#dynamic-language-final-notes-scopes">27.5.2. Scoping</a></span></dt></dl></dd><dt><span class="section"><a href="#dynamic-language-resources">27.6. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="#cache">28. Cache Abstraction</a></span></dt><dd><dl><dt><span class="section"><a href="#cache-introduction">28.1. Introduction</a></span></dt><dt><span class="section"><a href="#cache-strategies">28.2. Understanding the cache abstraction</a></span></dt><dt><span class="section"><a href="#cache-annotations">28.3. Declarative annotation-based caching</a></span></dt><dd><dl><dt><span class="section"><a href="#cache-annotations-cacheable">28.3.1. @Cacheable annotation</a></span></dt><dd><dl><dt><span class="section"><a href="#cache-annotations-cacheable-default-key">28.3.1.1. Default Key Generation</a></span></dt><dt><span class="section"><a href="#cache-annotations-cacheable-key">28.3.1.2. Custom Key Generation Declaration</a></span></dt><dt><span class="section"><a href="#cache-annotations-cacheable-condition">28.3.1.3. Conditional caching</a></span></dt><dt><span class="section"><a href="#cache-spel-context">28.3.1.4. Available caching SpEL evaluation context</a></span></dt></dl></dd><dt><span class="section"><a href="#cache-annotations-put">28.3.2. @CachePut annotation</a></span></dt><dt><span class="section"><a href="#cache-annotations-evict">28.3.3. @CacheEvict annotation</a></span></dt><dt><span class="section"><a href="#cache-annotations-caching">28.3.4. @Caching annotation</a></span></dt><dt><span class="section"><a href="#cache-annotation-enable">28.3.5. Enable caching annotations</a></span></dt><dt><span class="section"><a href="#cache-annotation-stereotype">28.3.6. Using custom annotations</a></span></dt></dl></dd><dt><span class="section"><a href="#cache-declarative-xml">28.4. Declarative XML-based caching</a></span></dt><dt><span class="section"><a href="#cache-store-configuration">28.5. Configuring the cache storage</a></span></dt><dd><dl><dt><span class="section"><a href="#cache-store-configuration-jdk">28.5.1. JDK ConcurrentMap-based Cache</a></span></dt><dt><span class="section"><a href="#cache-store-configuration-ehcache">28.5.2. Ehcache-based Cache</a></span></dt><dt><span class="section"><a href="#cache-store-configuration-noop">28.5.3. Dealing with caches without a backing store</a></span></dt></dl></dd><dt><span class="section"><a href="#cache-plug">28.6. Plugging-in different back-end caches</a></span></dt><dt><span class="section"><a href="#cache-specific-config">28.7. How can I set the TTL/TTI/Eviction policy/XXX feature?</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#spring-appendices">VII. Appendices</a></span></dt><dd><dl><dt><span class="appendix"><a href="#classic-spring">A. Classic Spring Usage</a></span></dt><dd><dl><dt><span class="section"><a href="#classic-spring-orm">A.1. Classic ORM usage</a></span></dt><dd><dl><dt><span class="section"><a href="#classic-spring-hibernate">A.1.1. Hibernate</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-hibernate-template">A.1.1.1. The HibernateTemplate</a></span></dt><dt><span class="section"><a href="#orm-hibernate-daos">A.1.1.2. Implementing Spring-based DAOs without callbacks</a></span></dt></dl></dd><dt><span class="section"><a href="#classic-spring-jdo">A.1.2. JDO</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-jdo-template">A.1.2.1. JdoTemplate and
        JdoDaoSupport</a></span></dt></dl></dd><dt><span class="section"><a href="#classic-spring-jpa">A.1.3. JPA</a></span></dt><dd><dl><dt><span class="section"><a href="#orm-jpa-template">A.1.3.1. JpaTemplate and
        JpaDaoSupport</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#clasic-spring-mvc">A.2. Classic Spring MVC</a></span></dt><dt><span class="section"><a href="#d0e46579">A.3. JMS Usage</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e46597">A.3.1. JmsTemplate</a></span></dt><dt><span class="section"><a href="#d0e46617">A.3.2. Asynchronous Message Reception </a></span></dt><dt><span class="section"><a href="#d0e46636">A.3.3. Connections</a></span></dt><dt><span class="section"><a href="#d0e46671">A.3.4. Transaction Management</a></span></dt></dl></dd></dl></dd><dt><span class="appendix"><a href="#classic-aop-spring">B. Classic Spring AOP Usage</a></span></dt><dd><dl><dt><span class="section"><a href="#classic-aop-api-pointcuts">B.1. Pointcut API in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#classic-aop-api-concepts">B.1.1. Concepts</a></span></dt><dt><span class="section"><a href="#classic-aop-api-pointcut-ops">B.1.2. Operations on pointcuts</a></span></dt><dt><span class="section"><a href="#classic-aop-api-pointcuts-aspectj">B.1.3. AspectJ expression pointcuts</a></span></dt><dt><span class="section"><a href="#classic-aop-api-pointcuts-impls">B.1.4. Convenience pointcut implementations</a></span></dt><dd><dl><dt><span class="section"><a href="#classic-aop-api-pointcuts-static">B.1.4.1. Static pointcuts</a></span></dt><dt><span class="section"><a href="#classic-aop-api-pointcuts-dynamic">B.1.4.2. Dynamic pointcuts</a></span></dt></dl></dd><dt><span class="section"><a href="#classic-aop-api-pointcuts-superclasses">B.1.5. Pointcut superclasses</a></span></dt><dt><span class="section"><a href="#classic-aop-api-pointcuts-custom">B.1.6. Custom pointcuts</a></span></dt></dl></dd><dt><span class="section"><a href="#classic-aop-api-advice">B.2. Advice API in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#classic-aop-api-advice-lifecycle">B.2.1. Advice lifecycles</a></span></dt><dt><span class="section"><a href="#classic-aop-api-advice-types">B.2.2. Advice types in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#classic-aop-api-advice-around">B.2.2.1. Interception around advice</a></span></dt><dt><span class="section"><a href="#classic-aop-api-advice-before">B.2.2.2. Before advice</a></span></dt><dt><span class="section"><a href="#classic-aop-api-advice-throws">B.2.2.3. Throws advice</a></span></dt><dt><span class="section"><a href="#classic-aop-api-advice-after-returning">B.2.2.4. After Returning advice</a></span></dt><dt><span class="section"><a href="#classic-aop-api-advice-introduction">B.2.2.5. Introduction advice</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#classic-aop-api-advisor">B.3. Advisor API in Spring</a></span></dt><dt><span class="section"><a href="#classic-aop-pfb">B.4. Using the ProxyFactoryBean to create AOP proxies</a></span></dt><dd><dl><dt><span class="section"><a href="#classic-aop-pfb-1">B.4.1. Basics</a></span></dt><dt><span class="section"><a href="#classic-aop-pfb-2">B.4.2. JavaBean properties</a></span></dt><dt><span class="section"><a href="#classic-aop-pfb-proxy-types">B.4.3. JDK- and CGLIB-based proxies</a></span></dt><dt><span class="section"><a href="#classic-aop-api-proxying-intf">B.4.4. Proxying interfaces</a></span></dt><dt><span class="section"><a href="#classic-aop-api-proxying-class">B.4.5. Proxying classes</a></span></dt><dt><span class="section"><a href="#classic-aop-global-advisors">B.4.6. Using 'global' advisors</a></span></dt></dl></dd><dt><span class="section"><a href="#classic-aop-concise-proxy">B.5. Concise proxy definitions</a></span></dt><dt><span class="section"><a href="#classic-aop-prog">B.6. Creating AOP proxies programmatically with the ProxyFactory</a></span></dt><dt><span class="section"><a href="#classic-aop-api-advised">B.7. Manipulating advised objects</a></span></dt><dt><span class="section"><a href="#classic-aop-autoproxy">B.8. Using the "autoproxy" facility</a></span></dt><dd><dl><dt><span class="section"><a href="#classic-aop-autoproxy-choices">B.8.1. Autoproxy bean definitions</a></span></dt><dd><dl><dt><span class="section"><a href="#classic-aop-api-autoproxy">B.8.1.1. BeanNameAutoProxyCreator</a></span></dt><dt><span class="section"><a href="#classic-aop-api-autoproxy-default">B.8.1.2. DefaultAdvisorAutoProxyCreator</a></span></dt><dt><span class="section"><a href="#classic-aop-api-autoproxy-abstract">B.8.1.3. AbstractAdvisorAutoProxyCreator</a></span></dt></dl></dd><dt><span class="section"><a href="#classic-aop-autoproxy-metadata">B.8.2. Using metadata-driven auto-proxying</a></span></dt></dl></dd><dt><span class="section"><a href="#classic-aop-targetsource">B.9. Using TargetSources</a></span></dt><dd><dl><dt><span class="section"><a href="#classic-aop-ts-swap">B.9.1. Hot swappable target sources</a></span></dt><dt><span class="section"><a href="#classic-aop-ts-pool">B.9.2. Pooling target sources</a></span></dt><dt><span class="section"><a href="#classic-aop-ts-prototype">B.9.3. Prototype target sources</a></span></dt><dt><span class="section"><a href="#classic-aop-ts-threadlocal">B.9.4. ThreadLocal target sources</a></span></dt></dl></dd><dt><span class="section"><a href="#classic-aop-extensibility">B.10. Defining new Advice types</a></span></dt><dt><span class="section"><a href="#classic-aop-api-resources">B.11. Further resources</a></span></dt></dl></dd><dt><span class="appendix"><a href="#xsd-config">C. XML Schema-based configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#xsd-config-introduction">C.1. Introduction</a></span></dt><dt><span class="section"><a href="#xsd-config-body">C.2. XML Schema-based configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#xsd-config-body-referencing">C.2.1. Referencing the schemas</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-util">C.2.2. The util schema</a></span></dt><dd><dl><dt><span class="section"><a href="#xsd-config-body-schemas-util-constant">C.2.2.1. &lt;util:constant/&gt;</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-util-property-path">C.2.2.2. &lt;util:property-path/&gt;</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-util-properties">C.2.2.3. &lt;util:properties/&gt;</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-util-list">C.2.2.4. &lt;util:list/&gt;</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-util-map">C.2.2.5. &lt;util:map/&gt;</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-util-set">C.2.2.6. &lt;util:set/&gt;</a></span></dt></dl></dd><dt><span class="section"><a href="#xsd-config-body-schemas-jee">C.2.3. The jee schema</a></span></dt><dd><dl><dt><span class="section"><a href="#xsd-config-body-schemas-jee-jndi-lookup">C.2.3.1. &lt;jee:jndi-lookup/&gt; (simple)</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-jee-jndi-lookup-environment-single">C.2.3.2. &lt;jee:jndi-lookup/&gt; (with single JNDI environment setting)</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-jee-jndi-lookup-evironment-multiple">C.2.3.3. &lt;jee:jndi-lookup/&gt; (with multiple JNDI environment settings)</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-jee-jndi-lookup-complex">C.2.3.4. &lt;jee:jndi-lookup/&gt; (complex)</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-jee-local-slsb">C.2.3.5. &lt;jee:local-slsb/&gt; (simple)</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-jee-local-slsb-complex">C.2.3.6. &lt;jee:local-slsb/&gt; (complex)</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-jee-remote-slsb">C.2.3.7. &lt;jee:remote-slsb/&gt;</a></span></dt></dl></dd><dt><span class="section"><a href="#xsd-config-body-schemas-lang">C.2.4. The lang schema</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-jms">C.2.5. The jms schema</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-tx">C.2.6. The tx (transaction) schema</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-aop">C.2.7. The aop schema</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-context">C.2.8. The context schema</a></span></dt><dd><dl><dt><span class="section"><a href="#xsd-config-body-schemas-context-pphc">C.2.8.1. &lt;property-placeholder/&gt;</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-context-ac">C.2.8.2. &lt;annotation-config/&gt;</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-context-component-scan">C.2.8.3. &lt;component-scan/&gt;</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-context-ltw">C.2.8.4. &lt;load-time-weaver/&gt;</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-context-sc">C.2.8.5. &lt;spring-configured/&gt;</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-context-mbe">C.2.8.6. &lt;mbean-export/&gt;</a></span></dt></dl></dd><dt><span class="section"><a href="#xsd-config-body-schemas-tool">C.2.9. The tool schema</a></span></dt><dt><span class="section"><a href="#xsd-config-body-schemas-beans">C.2.10. The beans schema</a></span></dt></dl></dd></dl></dd><dt><span class="appendix"><a href="#extensible-xml">D. Extensible XML authoring</a></span></dt><dd><dl><dt><span class="section"><a href="#extensible-xml-introduction">D.1. Introduction</a></span></dt><dt><span class="section"><a href="#extensible-xml-schema">D.2. Authoring the schema</a></span></dt><dt><span class="section"><a href="#extensible-xml-namespacehandler">D.3. Coding a NamespaceHandler</a></span></dt><dt><span class="section"><a href="#extensible-xml-parser">D.4. Coding a BeanDefinitionParser</a></span></dt><dt><span class="section"><a href="#extensible-xml-registration">D.5. Registering the handler and the schema</a></span></dt><dd><dl><dt><span class="section"><a href="#extensible-xml-registration-spring-handlers">D.5.1. 'META-INF/spring.handlers'</a></span></dt><dt><span class="section"><a href="#extensible-xml-registration-spring-schemas">D.5.2. 'META-INF/spring.schemas'</a></span></dt></dl></dd><dt><span class="section"><a href="#extensible-xml-using">D.6. Using a custom extension in your Spring XML configuration</a></span></dt><dt><span class="section"><a href="#extensible-xml-meat">D.7. Meatier examples</a></span></dt><dd><dl><dt><span class="section"><a href="#extensible-xml-custom-nested">D.7.1. Nesting custom tags within custom tags</a></span></dt><dt><span class="section"><a href="#extensible-xml-custom-just-attributes">D.7.2. Custom attributes on 'normal' elements</a></span></dt></dl></dd><dt><span class="section"><a href="#extensible-xml-resources">D.8. Further Resources</a></span></dt></dl></dd><dt><span class="appendix"><a href="#springbeansdtd">E. spring-beans-2.0.dtd</a></span></dt><dt><span class="appendix"><a href="#spring.tld">F. spring.tld</a></span></dt><dd><dl><dt><span class="section"><a href="#spring.tld-intro">F.1. Introduction</a></span></dt><dt><span class="section"><a href="#spring.tld.bind">F.2. The bind tag</a></span></dt><dt><span class="section"><a href="#spring.tld.escapeBody">F.3. The escapeBody tag</a></span></dt><dt><span class="section"><a href="#spring.tld.hasBindErrors">F.4. The hasBindErrors tag</a></span></dt><dt><span class="section"><a href="#spring.tld.htmlEscape">F.5. The htmlEscape tag</a></span></dt><dt><span class="section"><a href="#spring.tld.message">F.6. The message tag</a></span></dt><dt><span class="section"><a href="#spring.tld.nestedPath">F.7. The nestedPath tag</a></span></dt><dt><span class="section"><a href="#spring.tld.theme">F.8. The theme tag</a></span></dt><dt><span class="section"><a href="#spring.tld.transform">F.9. The transform tag</a></span></dt><dt><span class="section"><a href="#spring.tld.url">F.10. The url tag</a></span></dt><dt><span class="section"><a href="#spring.tld.eval">F.11. The eval tag</a></span></dt></dl></dd><dt><span class="appendix"><a href="#spring-form.tld">G. spring-form.tld</a></span></dt><dd><dl><dt><span class="section"><a href="#spring-form.tld-intro">G.1. Introduction</a></span></dt><dt><span class="section"><a href="#spring-form.tld.checkbox">G.2. The checkbox tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.checkboxes">G.3. The checkboxes tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.errors">G.4. The errors tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.form">G.5. The form tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.hidden">G.6. The hidden tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.input">G.7. The input tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.label">G.8. The label tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.option">G.9. The option tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.options">G.10. The options tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.password">G.11. The password tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.radiobutton">G.12. The radiobutton tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.radiobuttons">G.13. The radiobuttons tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.select">G.14. The select tag</a></span></dt><dt><span class="section"><a href="#spring-form.tld.textarea">G.15. The textarea tag</a></span></dt></dl></dd></dl></dd></dl></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="spring-introduction"></a>Part&nbsp;I.&nbsp;Overview of Spring Framework</h1></div></div></div><div class="partintro" lang="en"><div></div><p>The Spring Framework is a lightweight solution and a potential
      one-stop-shop for building your enterprise-ready applications. However,
      Spring is modular, allowing you to use only those parts that you need,
      without having to bring in the rest. You can use the IoC container, with
      Struts on top, but you can also use only the <a class="link" href="#orm-hibernate" title="14.3&nbsp;Hibernate">Hibernate integration code</a> or the <a class="link" href="#jdbc-introduction" title="13.1&nbsp;Introduction to Spring Framework JDBC">JDBC abstraction layer</a>. The Spring
      Framework supports declarative transaction management, remote access to
      your logic through RMI or web services, and various options for
      persisting your data. It offers a full-featured <a class="link" href="#mvc-introduction" title="16.1&nbsp;Introduction to Spring Web MVC framework">MVC framework</a>, and enables you to
      integrate <a class="link" href="#aop-introduction" title="8.1&nbsp;Introduction">AOP</a> transparently into
      your software.</p><p>Spring is designed to be non-intrusive, meaning that your domain
      logic code generally has no dependencies on the framework itself. In
      your integration layer (such as the data access layer), some
      dependencies on the data access technology and the Spring libraries will
      exist. However, it should be easy to isolate these dependencies from the
      rest of your code base.</p><p>This document is a reference guide to Spring Framework features.
      If you have any requests, comments, or questions on this document,
      please post them on the user mailing list or on the support forums at
      <a class="ulink" href="http://forum.springsource.org/" target="_top">http://forum.springsource.org/</a>.</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>1.&nbsp;Introduction to Spring Framework</h2></div></div></div><p>Spring Framework is a Java platform that provides comprehensive
  infrastructure support for developing Java applications. Spring handles the
  infrastructure so you can focus on your application.</p><p>Spring enables you to build applications from &#8220;plain old Java objects&#8221;
  (POJOs) and to apply enterprise services non-invasively to POJOs. This
  capability applies to the Java SE programming model and to full and partial
  Java EE.</p><p>Examples of how you, as an application developer, can use the Spring
  platform advantage:</p><div class="itemizedlist"><ul type="disc"><li><p>Make a Java method execute in a database transaction without
      having to deal with transaction APIs.</p></li><li><p>Make a local Java method a remote procedure without having to deal
      with remote APIs.</p></li><li><p>Make a local Java method a management operation without having to
      deal with JMX APIs.</p></li><li><p>Make a local Java method a message handler without having to deal
      with JMS APIs.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="overview-dependency-injection"></a>1.1&nbsp;Dependency Injection and Inversion of Control</h2></div></div></div><div class="sidebar"><a name="background-ioc"></a><p class="title"><b>Background</b></p><p>&#8220;<span class="quote"><span class="emphasis"><em>The question is, what aspect of control are
      [they] inverting?</em></span></span>&#8221; Martin Fowler posed this question
      about Inversion of Control (IoC) on his site in 2004. Fowler suggested
      renaming the principle to make it more self-explanatory and came up with
      <em class="firstterm">Dependency Injection</em>.</p><p>For insight into IoC and DI, refer to Fowler's article at <a class="ulink" href="http://martinfowler.com/articles/injection.html" target="_top">http://martinfowler.com/articles/injection.html</a>.</p></div><p>Java applications -- a loose term that runs the gamut from
    constrained applets to n-tier server-side enterprise applications --
    typically consist of objects that collaborate to form the application
    proper. Thus the objects in an application have
    <span class="emphasis"><em>dependencies</em></span> on each other.</p><p>Although the Java platform provides a wealth of application
    development functionality, it lacks the means to organize the basic
    building blocks into a coherent whole, leaving that task to architects and
    developers. True, you can use design patterns such as
    <em class="firstterm">Factory</em>, <em class="firstterm">Abstract Factory</em>,
    <em class="firstterm">Builder</em>, <em class="firstterm">Decorator</em>, and
    <em class="firstterm">Service Locator</em> to compose the various classes and
    object instances that make up an application. However, these patterns are
    simply that: best practices given a name, with a description of what the
    pattern does, where to apply it, the problems it addresses, and so forth.
    Patterns are formalized best practices that <span class="emphasis"><em>you must implement
    yourself</em></span> in your application.</p><p>The Spring Framework <span class="emphasis"><em>Inversion of Control</em></span> (IoC)
    component addresses this concern by providing a formalized means of
    composing disparate components into a fully working application ready for
    use. The
    Spring Framework codifies formalized design patterns as first-class
    objects that you can integrate into your own application(s). Numerous
    organizations and institutions use the Spring Framework in this manner to
    engineer robust, <span class="emphasis"><em>maintainable</em></span> applications.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="overview-modules"></a>1.2&nbsp;Modules</h2></div></div></div><p>The Spring Framework consists of features organized into about 20
    modules. These modules are grouped into Core Container, Data
    Access/Integration, Web, AOP (Aspect Oriented Programming),
    Instrumentation, and Test, as shown in the following diagram.</p><div class="mediaobject" align="center"><img src="images/spring-overview.png" align="middle"><div class="caption"><p>Overview of the Spring Framework</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e281"></a>1.2.1&nbsp;Core Container</h3></div></div></div><p>The <a class="link" href="#beans-introduction" title="4.1&nbsp;Introduction to the Spring IoC container and beans"><span class="emphasis"><em>Core
      Container</em></span></a> consists of the Core, Beans, Context, and
      Expression Language modules.</p><p>The <a class="link" href="#beans-introduction" title="4.1&nbsp;Introduction to the Spring IoC container and beans"><span class="emphasis"><em>Core and
      Beans</em></span></a> modules provide the fundamental parts of the
      framework, including the IoC and Dependency Injection features. The
      <code class="classname">BeanFactory</code> is a sophisticated implementation of
      the factory pattern. It removes the need for programmatic singletons and
      allows you to decouple the configuration and specification of
      dependencies from your actual program logic.</p><p>The <a class="link" href="#context-introduction" title="4.14&nbsp;Additional Capabilities of the ApplicationContext"><span class="emphasis"><em>Context</em></span></a>
      module builds on the solid base provided by the <a class="link" href="#beans-introduction" title="4.1&nbsp;Introduction to the Spring IoC container and beans"><span class="emphasis"><em>Core and Beans</em></span></a>
      modules: it is a means to access objects in a framework-style manner
      that is similar to a JNDI registry. The Context module inherits its
      features from the Beans module and adds support for internationalization
      (using, for example, resource bundles), event-propagation,
      resource-loading, and the transparent creation of contexts by, for
      example, a servlet container. The Context module also supports Java EE
      features such as EJB, JMX ,and basic remoting. The
      <code class="classname">ApplicationContext</code> interface is the focal point
      of the Context module.</p><p>The <a class="link" href="#expressions" title="7.&nbsp;Spring Expression Language (SpEL)"><span class="emphasis"><em>Expression
      Language</em></span></a> module provides
      a powerful expression language for querying and manipulating an object
      graph at runtime. It is an extension of the unified expression language
      (unified EL) as specified in the JSP 2.1 specification. The language
      supports setting and getting property values, property assignment,
      method invocation, accessing the context of arrays, collections and
      indexers, logical and arithmetic operators, named variables, and
      retrieval of objects by name from Spring's IoC container. It also
      supports list projection and selection as well as common list
      aggregations.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e320"></a>1.2.2&nbsp;Data Access/Integration</h3></div></div></div><p>The <span class="emphasis"><em>Data Access/Integration</em></span> layer consists of
      the JDBC, ORM, OXM, JMS and Transaction modules.</p><p>The <a class="link" href="#jdbc-introduction" title="13.1&nbsp;Introduction to Spring Framework JDBC">JDBC</a> module provides
      a JDBC-abstraction layer that removes the need to do tedious JDBC coding
      and parsing of database-vendor specific error codes.</p><p>The <a class="link" href="#orm-introduction" title="14.1&nbsp;Introduction to ORM with Spring"><span class="emphasis"><em>ORM</em></span></a> module
      provides integration layers for popular object-relational mapping APIs,
      including <a class="link" href="#orm-jpa" title="14.5&nbsp;JPA">JPA</a>, <a class="link" href="#orm-jdo" title="14.4&nbsp;JDO">JDO</a>, <a class="link" href="#orm-hibernate" title="14.3&nbsp;Hibernate">Hibernate</a>, and <a class="link" href="#orm-ibatis" title="14.6&nbsp;iBATIS SQL Maps">iBatis</a>. Using the ORM package you can use
      all of these O/R-mapping frameworks in combination with all of the other
      features Spring offers, such as the simple declarative transaction
      management feature mentioned previously.</p><p>The <a class="link" href="#oxm" title="15.&nbsp;Marshalling XML using O/X Mappers">OXM</a> module provides an abstraction
      layer that supports Object/XML mapping implementations for JAXB, Castor,
      XMLBeans, JiBX and XStream.</p><p>The Java Messaging Service (<a class="link" href="#jms" title="22.&nbsp;JMS (Java Message Service)">JMS</a>) module
      contains features for producing and consuming messages.</p><p>The <a class="link" href="#transaction" title="11.&nbsp;Transaction Management">Transaction</a> module supports
      programmatic and declarative transaction management for classes that
      implement special interfaces and for <span class="emphasis"><em>all your POJOs (plain old
      Java objects)</em></span>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e369"></a>1.2.3&nbsp;Web</h3></div></div></div><p>The <span class="emphasis"><em>Web</em></span> layer consists of the Web,
      Web-Servlet, Web-Struts, and Web-Portlet modules.</p><p>Spring's <span class="emphasis"><em>Web</em></span> module provides basic
      web-oriented integration features such as multipart file-upload
      functionality and the initialization of the IoC container using servlet
      listeners and a web-oriented application context. It also contains the
      web-related parts of Spring's remoting support.</p><p>The <span class="emphasis"><em>Web-Servlet</em></span> module contains Spring's
      model-view-controller (<a class="link" href="#mvc-introduction" title="16.1&nbsp;Introduction to Spring Web MVC framework"><span class="emphasis"><em>MVC</em></span></a>)
      implementation for web applications. Spring's MVC framework provides a
      clean separation between domain model code and web forms, and integrates
      with all the other features of the Spring Framework.</p><p>The <span class="emphasis"><em>Web-Struts</em></span> module contains the support
      classes for integrating a classic Struts web tier within a Spring
      application. Note that this support is now deprecated as of Spring 3.0.
      Consider migrating your application to Struts 2.0 and its Spring
      integration or to a Spring MVC solution.</p><p>The <span class="emphasis"><em>Web-Portlet</em></span> module provides the MVC
      implementation to be used in a portlet environment and mirrors the
      functionality of Web-Servlet module.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e405"></a>1.2.4&nbsp;AOP and Instrumentation</h3></div></div></div><p>Spring's <a class="link" href="#aop-introduction" title="8.1&nbsp;Introduction"><span class="emphasis"><em>AOP</em></span></a> module
      provides an <span class="emphasis"><em>AOP Alliance</em></span>-compliant aspect-oriented
      programming implementation allowing you to define, for example,
      method-interceptors and pointcuts to cleanly decouple code that
      implements functionality that should be separated. Using source-level
      metadata functionality, you can also incorporate behavioral information
      into your code, in a manner similar to that of .NET attributes.</p><p>The separate <span class="emphasis"><em>Aspects</em></span> module provides
      integration with AspectJ.</p><p>The <span class="emphasis"><em>Instrumentation</em></span> module provides class
      instrumentation support and classloader implementations to be used in
      certain application servers.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e428"></a>1.2.5&nbsp;Test</h3></div></div></div><p>The <span class="emphasis"><em>Test</em></span> module supports the testing of
      Spring components with JUnit or TestNG. It provides consistent loading
      of Spring ApplicationContexts and caching of those contexts. It also
      provides mock objects that you can use to test your code in
      isolation.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="overview-usagescenarios"></a>1.3&nbsp;Usage scenarios</h2></div></div></div><p>The building blocks described previously make Spring a logical
    choice in many scenarios, from applets to full-fledged enterprise
    applications that use Spring's transaction management functionality and
    web framework integration.</p><div class="mediaobject" align="center"><img src="images/overview-full.png" align="middle"><div class="caption"><p>Typical full-fledged Spring web
        application</p></div></div><p>Spring's <a class="link" href="#transaction-declarative" title="11.5&nbsp;Declarative transaction management">declarative
    transaction management features</a> make the web application fully
    transactional, just as it would be if you used EJB container-managed
    transactions. All your custom business logic can be implemented with
    simple POJOs and managed by Spring's IoC container. Additional services
    include support for sending email and validation that is independent of
    the web layer, which lets you choose where to execute validation rules.
    Spring's ORM support is integrated with JPA, Hibernate, JDO and iBatis;
    for example, when using Hibernate, you can continue to use your existing
    mapping files and standard Hibernate
    <code class="interfacename">SessionFactory</code> configuration. Form
    controllers seamlessly integrate the web-layer with the domain model,
    removing the need for <code class="classname">ActionForms</code> or other classes
    that transform HTTP parameters to values for your domain model.</p><div class="mediaobject" align="center"><img src="images/overview-thirdparty-web.png" align="middle"><div class="caption"><p>Spring middle-tier using a third-party web
        framework</p></div></div><p>Sometimes circumstances do not allow you to completely switch to a
    different framework. The Spring Framework does <span class="emphasis"><em>not</em></span>
    force you to use everything within it; it is not an
    <span class="emphasis"><em>all-or-nothing</em></span> solution. Existing front-ends built
    with WebWork, Struts, Tapestry, or other UI frameworks can be integrated
    with a Spring-based middle-tier, which allows you to use Spring
    transaction features. You simply need to wire up your business logic using
    an <code class="classname">ApplicationContext</code> and use a
    <code class="classname">WebApplicationContext </code>to integrate your web
    layer.</p><div class="mediaobject" align="center"><img src="images/overview-remoting.png" align="middle"><div class="caption"><p>Remoting usage scenario</p></div></div><p>When you need to access existing code through web services, you can
    use Spring's <code class="literal">Hessian-</code>, <code class="literal">Burlap-</code>,
    <code class="literal">Rmi-</code> or <code class="classname">JaxRpcProxyFactory</code>
    classes. Enabling remote access to existing applications is not
    difficult.</p><div class="mediaobject" align="center"><img src="images/overview-ejb.png" align="middle"><div class="caption"><p>EJBs - Wrapping existing POJOs</p></div></div><p>The Spring Framework also provides an <a class="link" href="#ejb" title="21.&nbsp;Enterprise JavaBeans (EJB) integration">access and
    abstraction layer</a> for Enterprise JavaBeans, enabling you to reuse
    your existing POJOs and wrap them in stateless session beans for use in
    scalable, fail-safe web applications that might need declarative
    security.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dependency-management"></a>1.3.1&nbsp;Dependency Management and Naming Conventions</h3></div></div></div><p>Dependency management and dependency injection are different
      things. To get those nice features of Spring into your application (like
      dependency injection) you need to assemble all the libraries needed (jar
      files) and get them onto your classpath at runtime, and possibly at
      compile time. These dependencies are not virtual components that are
      injected, but physical resources in a file system (typically). The
      process of dependency management involves locating those resources,
      storing them and adding them to classpaths. Dependencies can be direct
      (e.g. my application depends on Spring at runtime), or indirect (e.g. my
      application depends on <code class="code">commons-dbcp</code> which depends on
      <code class="code">commons-pool</code>). The indirect dependencies are also known as
      "transitive" and it is those dependencies that are hardest to identify
      and manage.</p><p>If you are going to use Spring you need to get a copy of the jar
      libraries that comprise the pieces of Spring that you need. To make this
      easier Spring is packaged as a set of modules that separate the
      dependencies as much as possible, so for example if you don't want to
      write a web application you don't need the spring-web modules. To refer
      to Spring library modules in this guide we use a shorthand naming
      convention <code class="code">spring-*</code> or <code class="code">spring-*.jar,</code> where "*"
      represents the short name for the module (e.g. <code class="code">spring-core</code>,
      <code class="code">spring-webmvc</code>, <code class="code">spring-jms</code>, etc.). The actual
      jar file name that you use may be in this form (see below) or it may
      not, and normally it also has a version number in the file name (e.g.
      <code class="code">spring-core-3.0.0.RELEASE.jar</code>).</p><p>In general, Spring publishes its artifacts to four different
      places:</p><div class="itemizedlist"><ul type="disc"><li><p>On the community download site <a class="ulink" href="http://www.springsource.org/downloads/community" target="_top">http://www.springsource.org/downloads/community</a>.
            Here you find all the Spring jars bundled together into a zip file
            for easy download. The names of the jars here since version 3.0
            are in the form
            <code class="code">org.springframework.*-&lt;version&gt;.jar</code>.</p></li><li><p>Maven Central, which is the default repository that Maven
            queries, and does not require any special configuration to use.
            Many of the common libraries that Spring depends on also are
            available from Maven Central and a large section of the Spring
            community uses Maven for dependency management, so this is
            convenient for them. The names of the jars here are in the form
            <code class="code">spring-*-&lt;version&gt;.jar</code> and the Maven groupId is
            <code class="code">org.springframework</code>.</p></li><li><p>The Enterprise Bundle Repository (EBR), which is run by
            SpringSource and also hosts all the libraries that integrate with
            Spring. Both Maven and Ivy repositories are available here for all
            Spring jars and their dependencies, plus a large number of other
            common libraries that people use in applications with Spring. Both
            full releases and also milestones and development snapshots are
            deployed here. The names of the jar files are in the same form as
            the community download
            (<code class="code">org.springframework.*-&lt;version&gt;.jar</code>), and the
            dependencies are also in this "long" form, with external libraries
            (not from SpringSource) having the prefix
            <code class="code">com.springsource</code>. See the <a class="ulink" href="http://www.springsource.com/repository/app/faq" target="_top">FAQ</a>
            for more information.</p></li><li><p>In a public Maven repository hosted on Amazon S3 for
            development snapshots and milestone releases (a copy of the final
            releases is also held here). The jar file names are in the same
            form as Maven Central, so this is a useful place to get
            development versions of Spring to use with other libraries depoyed
            in Maven Central.</p></li></ul></div><p>So the first thing you need to decide is how to manage your
      dependencies: most people use an automated system like Maven or Ivy, but
      you can also do it manually by downloading all the jars yourself. When
      obtaining Spring with Maven or Ivy you have then to decide which place
      you'll get it from. In general, if you care about OSGi, use the EBR,
      since it houses OSGi compatible artifacts for all of Spring's
      dependencies, such as Hibernate and Freemarker. If OSGi does not matter
      to you, either place works, though there are some pros and cons between
      them. In general, pick one place or the other for your project; do not
      mix them. This is particularly important since EBR artifacts necessarily
      use a different naming convention than Maven Central artifacts.</p><div class="table"><a name="d0e591"></a><p class="title"><b>Table&nbsp;1.1.&nbsp;Comparison of Maven Central and SpringSource EBR
          Repositories</b></p><div class="table-contents"><table summary="Comparison of Maven Central and SpringSource EBR&#xA;          Repositories" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Feature</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Maven Central</th><th style="border-bottom: 1.0pt solid ; ">EBR</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">OSGi Compatible</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Not explicit</td><td style="border-bottom: 1.0pt solid ; ">Yes</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Number of Artifacts</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Tens of thousands; all kinds</td><td style="border-bottom: 1.0pt solid ; ">Hundreds; those that Spring integrates with</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Consistent Naming Conventions</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">No</td><td style="border-bottom: 1.0pt solid ; ">Yes</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Naming Convention: GroupId</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Varies. Newer artifacts often use domain name, e.g.
                org.slf4j. Older ones often just use the artifact name, e.g.
                log4j.</td><td style="border-bottom: 1.0pt solid ; ">Domain name of origin or main package root, e.g.
                org.springframework</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Naming Convention: ArtifactId</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Varies. Generally the project or module name, using a
                hyphen "-" separator, e.g. spring-core, logj4.</td><td style="border-bottom: 1.0pt solid ; ">Bundle Symbolic Name, derived from the main package
                root, e.g. org.springframework.beans. If the jar had to be
                patched to ensure OSGi compliance then com.springsource is
                appended, e.g. com.springsource.org.apache.log4j</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Naming Convention: Version</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Varies. Many new artifacts use m.m.m or m.m.m.X (with
                m=digit, X=text). Older ones use m.m. Some neither. Ordering
                is defined but not often relied on, so not strictly
                reliable.</td><td style="border-bottom: 1.0pt solid ; ">OSGi version number m.m.m.X, e.g. 3.0.0.RC3. The text
                qualifier imposes alphabetic ordering on versions with the
                same numeric values.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Publishing</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Usually automatic via rsync or source control updates.
                Project authors can upload individual jars to JIRA.</td><td style="border-bottom: 1.0pt solid ; ">Manual (JIRA processed by SpringSource)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Quality Assurance</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">By policy. Accuracy is responsibility of
                authors.</td><td style="border-bottom: 1.0pt solid ; ">Extensive for OSGi manifest, Maven POM and Ivy
                metadata. QA performed by Spring team.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Hosting</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Contegix. Funded by Sonatype with several
                mirrors.</td><td style="border-bottom: 1.0pt solid ; ">S3 funded by SpringSource.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Search Utilities</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Various</td><td style="border-bottom: 1.0pt solid ; "><a class="ulink" href="http://www.springsource.com/repository" target="_top">http://www.springsource.com/repository</a></td></tr><tr><td style="border-right: 1.0pt solid ; ">Integration with SpringSource Tools</td><td style="border-right: 1.0pt solid ; ">Integration through STS with Maven dependency
                management</td><td style="">Extensive integration through STS with Maven, Roo,
                CloudFoundry</td></tr></tbody></table></div></div><p><br class="table-break"></p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e682"></a>1.3.1.1&nbsp;Spring Dependencies and Depending on Spring</h4></div></div></div><p>Although Spring provides integration and support for a huge
        range of enterprise and other external tools, it intentionally keeps
        its mandatory dependencies to an absolute minimum: you shouldn't have
        to locate and download (even automatically) a large number of jar
        libraries in order to use Spring for simple use cases. For basic
        dependency injection there is only one mandatory external dependency,
        and that is for logging (see below for a more detailed description of
        logging options).</p><p>Next we outline the basic steps needed to configure an
        application that depends on Spring, first with Maven and then with
        Ivy. In all cases, if anything is unclear, refer to the documentation
        of your dependency management system, or look at some sample code -
        Spring itself uses Ivy to manage dependencies when it is building, and
        our samples mostly use Maven.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e689"></a>1.3.1.2&nbsp;Maven Dependency Management</h4></div></div></div><p>If you are using Maven for dependency management you don't even
        need to supply the logging dependency explicitly. For example, to
        create an application context and use dependency injection to
        configure an application, your Maven dependencies will look like
        this:</p><pre class="programlisting">&lt;dependencies&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
      &lt;version&gt;3.0.0.RELEASE&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
   &lt;/dependency&gt;
&lt;/dependencies&gt; </pre><p>That's it. Note the scope can be declared as runtime if you
        don't need to compile against Spring APIs, which is typically the case
        for basic dependency injection use cases.</p><p>We used the Maven Central naming conventions in the example
        above, so that works with Maven Central or the SpringSource S3 Maven
        repository. To use the S3 Maven repository (e.g. for milestones or
        developer snaphots), you need to specify the repository location in
        your Maven configuration. For full releases:</p><pre class="programlisting">&lt;repositories&gt;
   &lt;repository&gt;
      &lt;id&gt;com.springsource.repository.maven.release&lt;/id&gt;
      &lt;url&gt;http://maven.springframework.org/release/&lt;/url&gt;
      &lt;snapshots&gt;&lt;enabled&gt;false&lt;/enabled&gt;&lt;/snapshots&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;</pre><p>For milestones:</p><pre class="programlisting">&lt;repositories&gt;
   &lt;repository&gt;
      &lt;id&gt;com.springsource.repository.maven.milestone&lt;/id&gt;
      &lt;url&gt;http://maven.springframework.org/milestone/&lt;/url&gt;
      &lt;snapshots&gt;&lt;enabled&gt;false&lt;/enabled&gt;&lt;/snapshots&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;</pre><p>And for snapshots:</p><pre class="programlisting">&lt;repositories&gt;
   &lt;repository&gt;
      &lt;id&gt;com.springsource.repository.maven.snapshot&lt;/id&gt;
      &lt;url&gt;http://maven.springframework.org/snapshot/&lt;/url&gt;
      &lt;snapshots&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/snapshots&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;</pre><p>To use the SpringSource EBR you would need to use a different
        naming convention for the dependencies. The names are usually easy to
        guess, e.g. in this case it is:</p><pre class="programlisting">&lt;dependencies&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;org.springframework.context&lt;/artifactId&gt;
      &lt;version&gt;3.0.0.RELEASE&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
   &lt;/dependency&gt;
&lt;/dependencies&gt;</pre><p>You also need to declare the location of the repository
        explicitly (only the URL is important):</p><pre class="programlisting">&lt;repositories&gt;
   &lt;repository&gt;
      &lt;id&gt;com.springsource.repository.bundles.release&lt;/id&gt;
      &lt;url&gt;http://repository.springsource.com/maven/bundles/release/&lt;/url&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;</pre><p>If you are managing your dependencies by hand, the URL in the
        repository declaration above is not browseable, but there is a user
        interface at <a class="ulink" href="http://www.springsource.com/repository" target="_top">http://www.springsource.com/repository</a>
        that can be used to search for and download dependencies. It also has
        handy snippets of Maven and Ivy configuration that you can copy and
        paste if you are using those tools.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e724"></a>1.3.1.3&nbsp;Ivy Dependency Management</h4></div></div></div><p>If you prefer to use <a class="ulink" href="http://ant.apache.org/ivy" target="_top">Ivy</a> to manage dependencies
        then there are similar names and configuration options. </p><p>To configure Ivy to point to the SpringSource EBR add the
        following resolvers to your
        <code class="filename">ivysettings.xml</code>:</p><pre class="programlisting">&lt;resolvers&gt;
  
  &lt;url name="com.springsource.repository.bundles.release"&gt;

    &lt;ivy pattern="http://repository.springsource.com/ivy/bundles/release/
      [organisation]/[module]/[revision]/[artifact]-[revision].[ext]" /&gt;
    &lt;artifact pattern="http://repository.springsource.com/ivy/bundles/release/
      [organisation]/[module]/[revision]/[artifact]-[revision].[ext]" /&gt;

  &lt;/url&gt;

  &lt;url name="com.springsource.repository.bundles.external"&gt;

    &lt;ivy pattern="http://repository.springsource.com/ivy/bundles/external/
       [organisation]/[module]/[revision]/[artifact]-[revision].[ext]" /&gt;
    &lt;artifact pattern="http://repository.springsource.com/ivy/bundles/external/
       [organisation]/[module]/[revision]/[artifact]-[revision].[ext]" /&gt; 

  &lt;/url&gt;

&lt;/resolvers&gt;</pre><p>The XML above is not valid because the lines are too long - if
        you copy-paste then remove the extra line endings in the middle of the
        url patterns.</p><p>Once Ivy is configured to look in the EBR adding a dependency is
        easy. Simply pull up the details page for the bundle in question in
        the repository browser and you'll find an Ivy snippet ready for you to
        include in your dependencies section. For example (in
        <code class="filename">ivy.xml</code>): </p><pre class="programlisting">&lt;dependency org="org.springframework" 
      name="org.springframework.core" rev="3.0.0.RELEASE" conf="compile-&gt;runtime"/&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e748"></a>1.3.2&nbsp;Logging</h3></div></div></div><p>Logging is a very important dependency for Spring because a) it is
      the only mandatory external dependency, b) everyone likes to see some
      output from the tools they are using, and c) Spring integrates with lots
      of other tools all of which have also made a choice of logging
      dependency. One of the goals of an application developer is often to
      have unified logging configured in a central place for the whole
      application, including all external components. This is more difficult
      than it might have been since there are so many choices of logging
      framework.</p><p>The mandatory logging dependency in Spring is the Jakarta Commons
      Logging API (JCL). We compile against JCL and we also make JCL
      <code class="classname">Log</code> objects visible for classes that extend the
      Spring Framework. It's important to users that all versions of Spring
      use the same logging library: migration is easy because backwards
      compatibility is preserved even with applications that extend Spring.
      The way we do this is to make one of the modules in Spring depend
      explicitly on <code class="code">commons-logging</code> (the canonical implementation
      of JCL), and then make all the other modules depend on that at compile
      time. If you are using Maven for example, and wondering where you picked
      up the dependency on <code class="code">commons-logging</code>, then it is from
      Spring and specifically from the central module called
      <code class="code">spring-core</code>.</p><p>The nice thing about <code class="code">commons-logging</code> is that you
      don't need anything else to make your application work. It has a runtime
      discovery algorithm that looks for other logging frameworks in well
      known places on the classpath and uses one that it thinks is appropriate
      (or you can tell it which one if you need to). If nothing else is
      available you get pretty nice looking logs just from the JDK
      (java.util.logging or JUL for short). You should find that your Spring
      application works and logs happily to the console out of the box in most
      situations, and that's important.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e772"></a>1.3.2.1&nbsp;Not Using Commons Logging</h4></div></div></div><p>Unfortunately, the runtime discovery algorithm in
        <code class="code">commons-logging</code>, while convenient for the end-user, is
        problematic. If we could turn back the clock and start Spring now
        as a new project it would use a different logging dependency. The
        first choice would probably be the Simple Logging Facade for Java (<a class="ulink" href="http://www.slf4j.org" target="_top">SLF4J</a>), which is also used by a lot
        of other tools that people use with Spring inside their
        applications.</p><p>Switching off <code class="code">commons-logging</code> is easy: just make
        sure it isn't on the classpath at runtime. In Maven terms you exclude
        the dependency, and because of the way that the Spring dependencies
        are declared, you only have to do that once.</p><pre class="programlisting">&lt;dependencies&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
      &lt;version&gt;3.0.0.RELEASE&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
      &lt;exclusions&gt;
         &lt;exclusion&gt;
            &lt;groupId&gt;commons-logging&lt;/groupId&gt;
            &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
         &lt;/exclusion&gt;
      &lt;/exclusions&gt;
   &lt;/dependency&gt;
&lt;/dependencies&gt; </pre><p>Now this application is probably broken because there is no
        implementation of the JCL API on the classpath, so to fix it a new one
        has to be provided. In the next section we show you how to provide an
        alternative implementation of JCL using SLF4J as an example.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e792"></a>1.3.2.2&nbsp;Using SLF4J</h4></div></div></div></div><p>SLF4J is a cleaner dependency and more efficient at runtime than
      <code class="code">commons-logging</code> because it uses compile-time bindings
      instead of runtime discovery of the other logging frameworks it
      integrates. This also means that you have to be more explicit about what
      you want to happen at runtime, and declare it or configure it
      accordingly. SLF4J provides bindings to many common logging frameworks,
      so you can usually choose one that you already use, and bind to that for
      configuration and management.</p><p>SLF4J provides bindings to many common logging frameworks,
      including JCL, and it also does the reverse: bridges between other
      logging frameworks and itself. So to use SLF4J with Spring you need to
      replace the <code class="code">commons-logging</code> dependency with the SLF4J-JCL
      bridge. Once you have done that then logging calls from within Spring
      will be translated into logging calls to the SLF4J API, so if other
      libraries in your application use that API, then you have a single place
      to configure and manage logging.</p><p>A common choice might be to bridge Spring to SLF4J, and then
      provide explicit binding from SLF4J to Log4J. You need to supply 4
      dependencies (and exclude the existing <code class="code">commons-logging</code>):
      the bridge, the SLF4J API, the binding to Log4J, and the Log4J
      implementation itself. In Maven you would do that like this</p><pre class="programlisting">&lt;dependencies&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
      &lt;version&gt;3.0.0.RELEASE&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
      &lt;exclusions&gt;
         &lt;exclusion&gt;
            &lt;groupId&gt;commons-logging&lt;/groupId&gt;
            &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
         &lt;/exclusion&gt;
      &lt;/exclusions&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
      &lt;artifactId&gt;jcl-over-slf4j&lt;/artifactId&gt;
      &lt;version&gt;1.5.8&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
      &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
      &lt;version&gt;1.5.8&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
      &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
      &lt;version&gt;1.5.8&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;log4j&lt;/groupId&gt;
      &lt;artifactId&gt;log4j&lt;/artifactId&gt;
      &lt;version&gt;1.2.14&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
   &lt;/dependency&gt;
&lt;/dependencies&gt; </pre><p>That might seem like a lot of dependencies just to get some
      logging. Well it is, but it <span class="emphasis"><em>is</em></span> optional, and it
      should behave better than the vanilla <code class="code">commons-logging</code> with
      respect to classloader issues, notably if you are in a strict container
      like an OSGi platform. Allegedly there is also a performance benefit
      because the bindings are at compile-time not runtime.</p><p>A more common choice amongst SLF4J users, which uses fewer steps
      and generates fewer dependencies, is to bind directly to <a class="ulink" href="http://logback.qos.ch" target="_top">Logback</a>. This removes the extra
      binding step because Logback implements SLF4J directly, so you only need
      to depend on two libaries not four (<code class="code">jcl-over-slf4j</code> and
      <code class="code">logback</code>). If you do that you might also need to exlude the
      slf4j-api dependency from other external dependencies (not Spring),
      because you only want one version of that API on the classpath.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e831"></a>1.3.2.3&nbsp;Using Log4J</h4></div></div></div><p>Many people use <a class="ulink" href="http://logging.apache.org/log4j" target="_top">Log4j</a> as a logging
        framework for configuration and management purposes. It's efficient
        and well-established, and in fact it's what we use at runtime when we
        build and test Spring. Spring also provides some utilities for
        configuring and initializing Log4j, so it has an optional compile-time
        dependency on Log4j in some modules.</p><p>To make Log4j work with the default JCL dependency
        (<code class="code">commons-logging</code>) all you need to do is put Log4j on the
        classpath, and provide it with a configuration file
        (<code class="code">log4j.properties</code> or <code class="code">log4j.xml</code> in the root
        of the classpath). So for Maven users this is your dependency
        declaration:</p><pre class="programlisting">&lt;dependencies&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
      &lt;version&gt;3.0.0.RELEASE&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;log4j&lt;/groupId&gt;
      &lt;artifactId&gt;log4j&lt;/artifactId&gt;
      &lt;version&gt;1.2.14&lt;/version&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
   &lt;/dependency&gt;
&lt;/dependencies&gt; </pre><p>And here's a sample log4j.properties for logging to the
        console:</p><pre class="programlisting">log4j.rootCategory=INFO, stdout

log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%d{ABSOLUTE} %5p %t %c{2}:%L - %m%n

log4j.category.org.springframework.beans.factory=DEBUG</pre><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="d0e856"></a>Runtime Containers with Native JCL</h5></div></div></div><p>Many people run their Spring applications in a container that
          itself provides an implementation of JCL. IBM Websphere Application
          Server (WAS) is the archetype. This often causes problems, and
          unfortunately there is no silver bullet solution; simply excluding
          <code class="code">commons-logging</code> from your application is not enough in
          most situations.</p><p>To be clear about this: the problems reported are usually not
          with JCL per se, or even with <code class="code">commons-logging</code>: rather
          they are to do with binding <code class="code">commons-logging</code> to another
          framework (often Log4J). This can fail because
          <code class="code">commons-logging</code> changed the way they do the runtime
          discovery in between the older versions (1.0) found in some
          containers and the modern versions that most people use now (1.1).
          Spring does not use any unusual parts of the JCL API, so nothing
          breaks there, but as soon as Spring or your application tries to do
          any logging you can find that the bindings to Log4J are not
          working.</p><p>In such cases with WAS the easiest thing to do is to invert
          the class loader hierarchy (IBM calls it "parent last") so that the
          application controls the JCL dependency, not the container. That
          option isn't always open, but there are plenty of other suggestions
          in the public domain for alternative approaches, and your mileage
          may vary depending on the exact version and feature set of the
          container.</p></div></div></div></div></div></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="spring-whats-new"></a>Part&nbsp;II.&nbsp;What's New in Spring 3</h1></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="new-in-3.0"></a>2.&nbsp;New Features and Enhancements in Spring 3.0</h2></div></div></div><p>If you have been using the Spring Framework for some time, you will be
  aware that Spring has undergone two major revisions: Spring 2.0, released in
  October 2006, and Spring 2.5, released in November 2007. It is now time for
  a third overhaul resulting in Spring 3.0.</p><div class="sidebar"><a name="new-in-3.0-intro-java"></a><p class="title"><b>Java SE and Java EE Support</b></p><p>The Spring Framework is now based on Java 5, and Java 6 is fully
    supported.</p><p>Furthermore, Spring is compatible with J2EE 1.4 and Java EE 5, while
    at the same time introducing some early support for Java EE 6.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-3.0-intro"></a>2.1&nbsp;Java 5</h2></div></div></div><p>The entire framework code has been revised to take advantage of Java
    5 features like generics, varargs and other language improvements. We have
    done our best to still keep the code backwards compatible. We now have
    consistent use of generic Collections and Maps, consistent use of generic
    FactoryBeans, and also consistent resolution of bridge methods in the
    Spring AOP API. Generic ApplicationListeners automatically receive
    specific event types only. All callback interfaces such as
    TransactionCallback and HibernateCallback declare a generic result value
    now. Overall, the Spring core codebase is now freshly revised and
    optimized for Java 5.</p><p>Spring's TaskExecutor abstraction has been updated for close
    integration with Java 5's java.util.concurrent facilities. We provide
    first-class support for Callables and Futures now, as well as
    ExecutorService adapters, ThreadFactory integration, etc. This has been
    aligned with JSR-236 (Concurrency Utilities for Java EE 6) as far as
    possible. Furthermore, we provide support for asynchronous method
    invocations through the use of the new @Async annotation (or EJB 3.1's
    @Asynchronous annotation).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-3.0-improved-docs"></a>2.2&nbsp;Improved documentation</h2></div></div></div><p>The Spring reference documentation has also substantially been
    updated to reflect all of the changes and new features for Spring 3.0.
    While every effort has been made to ensure that there are no errors in
    this documentation, some errors may nevertheless have crept in. If you do
    spot any typos or even more serious errors, and you can spare a few cycles
    during lunch, please do bring the error to the attention of the Spring
    team by <a class="ulink" href="http://jira.springframework.org/" target="_top">raising an
    issue</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-3.0-new-tutorial"></a>2.3&nbsp;New articles and tutorials</h2></div></div></div><p>
		There are many excellent articles and tutorials that show how to get started with Spring 3 features.
		Read them at the <a class="ulink" href="http://www.springsource.org/documentation" target="_top">Spring Documentation</a> page.
	  </p><p><a name="new-in-3.0-samples"></a>
	  The samples have been improved and updated to take advantage of the new features in Spring 3.
	  Additionally, the samples have been moved out of the source tree into a dedicated SVN 
	  <a class="ulink" href="https://anonsvn.springframework.org/svn/spring-samples/" target="_top">repository</a> available at:</p><p>
	  <code class="literal">https://anonsvn.springframework.org/svn/spring-samples/</code>
	  </p><p>As such, the samples are no longer distributed alongside Spring 3 and need to be downloaded separately from the repository mentioned above. However, this documentation
	  will continue to refer to some samples (in particular Petclinic) to illustrate various features.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">For more information on Subversion (or in short SVN), see the project homepage at:
      <code class="literal">http://subversion.apache.org/</code></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-3.0-modules-build"></a>2.4&nbsp;New module organization and build system</h2></div></div></div><p>The framework modules have been revised and are now managed
    separately with one source-tree per module jar:</p><div class="itemizedlist"><ul type="disc"><li><p>org.springframework.aop</p></li><li><p>org.springframework.beans</p></li><li><p>org.springframework.context</p></li><li><p>org.springframework.context.support</p></li><li><p>org.springframework.expression</p></li><li><p>org.springframework.instrument</p></li><li><p>org.springframework.jdbc</p></li><li><p>org.springframework.jms</p></li><li><p>org.springframework.orm</p></li><li><p>org.springframework.oxm</p></li><li><p>org.springframework.test</p></li><li><p>org.springframework.transaction</p></li><li><p>org.springframework.web</p></li><li><p>org.springframework.web.portlet</p></li><li><p>org.springframework.web.servlet</p></li><li><p>org.springframework.web.struts</p></li></ul></div><div class="sidebar"><a name="new-in-3.0-intro-spring-jar"></a><p class="title"><b>Note:</b></p><p>The spring.jar artifact that contained almost the entire framework
      is no longer provided.</p></div><p>We are now using a new Spring build system as known from Spring Web
    Flow 2.0. This gives us:</p><div class="itemizedlist"><ul type="disc"><li><p>Ivy-based "Spring Build" system</p></li><li><p>consistent deployment procedure</p></li><li><p>consistent dependency management</p></li><li><p>consistent generation of OSGi manifests</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-3.0-features-overview"></a>2.5&nbsp;Overview of new features</h2></div></div></div><p>This is a list of new features for Spring 3.0. We will cover these
    features in more detail later in this section.</p><div class="itemizedlist"><ul type="disc"><li><p>Spring Expression Language</p></li><li><p>IoC enhancements/Java based bean metadata</p></li><li><p>General-purpose type conversion system and field formatting
        system</p></li><li><p>Object to XML mapping functionality (OXM) moved from Spring Web
        Services project</p></li><li><p>Comprehensive REST support</p></li><li><p>@MVC additions</p></li><li><p>Declarative model validation</p></li><li><p>Early support for Java EE 6</p></li><li><p>Embedded database support</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-feature-java5"></a>2.5.1&nbsp;Core APIs updated for Java 5</h3></div></div></div><p>BeanFactory interface returns typed bean instances as far as
      possible: </p><div class="itemizedlist"><ul type="disc"><li><p>T getBean(Class&lt;T&gt; requiredType)</p></li><li><p>T getBean(String name, Class&lt;T&gt; requiredType)</p></li><li><p>Map&lt;String, T&gt; getBeansOfType(Class&lt;T&gt;
            type)</p></li></ul></div><p>Spring's TaskExecutor interface now extends
      <code class="classname">java.util.concurrent.Executor</code>: </p><div class="itemizedlist"><ul type="disc"><li><p>extended AsyncTaskExecutor supports standard Callables with
            Futures</p></li></ul></div><p>New Java 5 based converter API and SPI: </p><div class="itemizedlist"><ul type="disc"><li><p>stateless ConversionService and Converters</p></li><li><p>superseding standard JDK PropertyEditors</p></li></ul></div><p>Typed ApplicationListener&lt;E&gt;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-feature-el"></a>2.5.2&nbsp;Spring Expression Language</h3></div></div></div><p>Spring introduces an expression language which is similar to
      Unified EL in its syntax but offers significantly more features. The
      expression language can be used when defining XML and Annotation based
      bean definitions and also serves as the foundation for expression
      language support across the Spring portfolio. Details of this new
      functionality can be found in the chapter <a class="link" href="#expressions" title="7.&nbsp;Spring Expression Language (SpEL)">Spring Expression Language (SpEL).</a></p><p>The Spring Expression Language was created to provide the Spring
      community a single, well supported expression language that can be used
      across all the products in the Spring portfolio. Its language features
      are driven by the requirements of the projects in the Spring portfolio,
      including tooling requirements for code completion support within the
      Eclipse based <a class="ulink" href="http://www.springsource.com/products/sts" target="_top">SpringSource
      Tool Suite</a>.</p><p>The following is an example of how the Expression Language can be
      used to configure some properties of a database setup </p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mycompany.RewardsTestDatabase"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"databaseName"</span>
        <span class="hl-attribute">value</span>=<span class="hl-value">"#{systemProperties.databaseName}"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"keyGenerator"</span>
        <span class="hl-attribute">value</span>=<span class="hl-value">"#{strategyBean.databaseKeyGenerator}"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
</pre><p>This functionality is also available if you prefer to configure
      your components using annotations: </p><pre class="programlisting">@Repository 
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RewardsTestDatabase {

    @Value(<span class="hl-string">"#{systemProperties.databaseName}"</span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDatabaseName(String dbName) { &#8230; }

    @Value(<span class="hl-string">"#{strategyBean.databaseKeyGenerator}"</span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setKeyGenerator(KeyGenerator kg) { &#8230; }
}
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-feature-java-config"></a>2.5.3&nbsp;The Inversion of Control (IoC) container</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="new-java-configuration"></a>2.5.3.1&nbsp;Java based bean metadata</h4></div></div></div><p>Some core features from the <a class="ulink" href="http://www.springsource.org/javaconfig" target="_top">JavaConfig</a>
        project have been added to the Spring Framework now. This means that
        the following annotations are now directly supported: </p><div class="itemizedlist"><ul type="disc"><li><p>@Configuration</p></li><li><p>@Bean</p></li><li><p>@DependsOn</p></li><li><p>@Primary</p></li><li><p>@Lazy</p></li><li><p>@Import</p></li><li><p>@ImportResource</p></li><li><p>@Value</p></li></ul></div><p>Here is an example of a Java class providing basic configuration
        using the new JavaConfig features: </p><pre class="programlisting"><span class="hl-keyword">package</span> org.example.config;

@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
    <span class="hl-keyword">private</span> @Value(<span class="hl-string">"#{jdbcProperties.url}"</span>) String jdbcUrl;
    <span class="hl-keyword">private</span> @Value(<span class="hl-string">"#{jdbcProperties.username}"</span>) String username;
    <span class="hl-keyword">private</span> @Value(<span class="hl-string">"#{jdbcProperties.password}"</span>) String password;

    @Bean
    <span class="hl-keyword">public</span> FooService fooService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> FooServiceImpl(fooRepository());
    }

    @Bean
    <span class="hl-keyword">public</span> FooRepository fooRepository() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> HibernateFooRepository(sessionFactory());
    }

    @Bean
    <span class="hl-keyword">public</span> SessionFactory sessionFactory() {
        <span class="hl-comment">// wire up a session factory</span>
        AnnotationSessionFactoryBean asFactoryBean = 
            <span class="hl-keyword">new</span> AnnotationSessionFactoryBean();
        asFactoryBean.setDataSource(dataSource());
        <span class="hl-comment">// additional config</span>
        <span class="hl-keyword">return</span> asFactoryBean.getObject();
    }

    @Bean
    <span class="hl-keyword">public</span> DataSource dataSource() { 
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> DriverManagerDataSource(jdbcUrl, username, password);
    }
}
</pre><p> To get this to work you need to add the following component
        scanning entry in your minimal application context XML file.
        </p><pre class="programlisting">&lt;<span class="hl-tag">context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.example.config"</span>/&gt;
&lt;<span class="hl-tag">util:properties</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jdbcProperties"</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:org/example/config/jdbc.properties"</span>/&gt;
        </pre><p>
        Or you can bootstrap a <code class="literal">@Configuration</code> class directly using
        <code class="literal">AnnotationConfigApplicationContext</code>:
        </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(AppConfig.<span class="hl-keyword">class</span>);
    FooService fooService = ctx.getBean(FooService.<span class="hl-keyword">class</span>);
    fooService.doStuff();
}</pre><p>
        See <a class="xref" href="#beans-java-instantiating-container" title="4.12.2&nbsp;Instantiating the Spring container using AnnotationConfigApplicationContext">Section&nbsp;4.12.2, &#8220;Instantiating the Spring container using
      AnnotationConfigApplicationContext&#8221;</a> for full information on
        <code class="literal">AnnotationConfigApplicationContext</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1151"></a>2.5.3.2&nbsp;Defining bean metadata within components</h4></div></div></div><p><code class="literal">@Bean</code> annotated methods are also supported
        inside Spring components. They contribute a factory bean definition to
        the container. See <a class="link" href="#beans-factorybeans-annotations" title="4.10.4&nbsp;Defining bean metadata within components">Defining bean metadata within
        components</a> for more information</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-feature-convert-and-format"></a>2.5.4&nbsp;General purpose type conversion system and field formatting
      system</h3></div></div></div><p>A general purpose <a class="link" href="#core-convert" title="6.5&nbsp;Spring 3 Type Conversion">type conversion
      system</a> has been introduced. The system is currently used by SpEL
      for type conversion, and may also be used by a Spring Container and DataBinder when
      binding bean property values.</p><p>In addition, a <a class="link" href="#format" title="6.6&nbsp;Spring 3 Field Formatting">formatter</a> SPI
      has been introduced for formatting field values. This SPI provides
      a simpler and more robust alternative to JavaBean PropertyEditors for use in client
      environments such as Spring MVC.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-feature-oxm"></a>2.5.5&nbsp;The Data Tier</h3></div></div></div><p>Object to XML mapping functionality (OXM) from the Spring Web
      Services project has been moved to the core Spring Framework now. The
      functionality is found in the <code class="literal">org.springframework.oxm</code>
      package. More information on the use of the <code class="literal">OXM</code>
      module can be found in the <a class="link" href="#oxm" title="15.&nbsp;Marshalling XML using O/X Mappers">Marshalling XML using O/X
      Mappers</a> chapter.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-feature-rest"></a>2.5.6&nbsp;The Web Tier</h3></div></div></div><p>The most exciting new feature for the Web Tier is the support for
      building RESTful web services and web applications. There are also some
      new annotations that can be used in any web application.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1193"></a>2.5.6.1&nbsp;Comprehensive REST support</h4></div></div></div><p>Server-side support for building RESTful applications has been
        provided as an extension of the existing annotation driven MVC web
        framework. Client-side support is provided by the
        <code class="classname">RestTemplate</code> class in the spirit of other
        template classes such as <code class="classname">JdbcTemplate</code> and
        <code class="classname">JmsTemplate</code>. Both server and client side REST
        functionality make use of
        <code class="interfacename">HttpConverter</code>s to facilitate the
        conversion between objects and their representation in HTTP requests
        and responses.</p><p>The <code class="classname">MarshallingHttpMessageConverter</code> uses
        the <span class="emphasis"><em>Object to XML mapping</em></span> functionality mentioned
        earlier.</p><p>Refer to the sections on <a class="link" href="#mvc" title="16.&nbsp;Web MVC framework">MVC</a> and <a class="link" href="#rest-resttemplate" title="20.9.1&nbsp;RestTemplate">the RestTemplate</a> for more
        information.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1226"></a>2.5.6.2&nbsp;@MVC additions</h4></div></div></div><p>A <code class="literal">mvc</code> namespace has been introduced that greatly simplifies Spring MVC configuration.</p><p>Additional annotations such as
        <code class="classname">@CookieValue</code> and
        <code class="classname">@RequestHeaders</code> have been added. See <a class="link" href="#mvc-ann-cookievalue" title="16.3.3.12&nbsp;Mapping cookie values with the @CookieValue annotation">Mapping cookie values with the
        @CookieValue annotation</a> and <a class="link" href="#mvc-ann-requestheader" title="16.3.3.13&nbsp;Mapping request header attributes with the @RequestHeader annotation">Mapping request header attributes with
        the @RequestHeader annotation</a> for more information.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-feature-validation"></a>2.5.7&nbsp;Declarative model validation</h3></div></div></div><p>Several <a class="link" href="#validation-beanvalidation" title="6.7&nbsp;Spring 3 Validation">validation enhancements</a>,
      including JSR 303 support that uses Hibernate Validator as the default provider.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-feature-jee-6"></a>2.5.8&nbsp;Early support for Java EE 6</h3></div></div></div><p>We provide support for asynchronous method invocations through the
      use of the new @Async annotation (or EJB 3.1's @Asynchronous
      annotation).</p><p>JSR 303, JSF 2.0, JPA 2.0, etc</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-feature-embedded-databases"></a>2.5.9&nbsp;Support for embedded databases</h3></div></div></div><p>Convenient support for <a class="link" href="#jdbc-embedded-database-support" title="13.8&nbsp;Embedded database support">embedded Java database
      engines</a>, including HSQL, H2, and Derby, is now provided.</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="new-in-3.1"></a>3.&nbsp;New Features and Enhancements in Spring 3.1</h2></div></div></div><p>Building on the support introduced in Spring 3.0, Spring 3.1 is
  currently under development, and at the time of this writing Spring 3.1 RC1
  is being prepared for release.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-in-3.1-features-overview"></a>3.1&nbsp;Overview of new features</h2></div></div></div><p>This is a list of new features for Spring 3.1. Most features do not
    yet have dedicated reference documentation but do have Javadoc. In such
    cases, fully-qualified class names are given.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1281"></a>3.1.1&nbsp;Cache Abstraction</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><a class="xref" href="#cache" title="28.&nbsp;Cache Abstraction">Chapter&nbsp;28, <i>Cache Abstraction</i></a></p></li><li><p><a class="ulink" href="http://blog.springsource.com/2011/02/23/spring-3-1-m1-caching/" target="_top">
          Cache Abstraction</a> (SpringSource team blog)</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1293"></a>3.1.2&nbsp;Bean Definition Profiles</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><a class="ulink" href="http://blog.springsource.com/2011/02/11/spring-framework-3-1-m1-released/" target="_top">
          XML profiles</a> (SpringSource Team Blog)</p></li><li><p><a class="ulink" href="http://blog.springsource.com/2011/02/14/spring-3-1-m1-introducing-profile/" target="_top">
          Introducing @Profile</a> (SpringSource Team Blog)</p></li><li><p>See org.springframework.context.annotation.Configuration
          Javadoc</p></li><li><p>See org.springframework.context.annotation.Profile
          Javadoc</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1313"></a>3.1.3&nbsp;Environment Abstraction</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><a class="ulink" href="http://blog.springsource.com/2011/02/11/spring-framework-3-1-m1-released/" target="_top">
          Environment Abstraction</a> (SpringSource Team Blog)</p></li><li><p>See org.springframework.core.env.Environment Javadoc</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1325"></a>3.1.4&nbsp;PropertySource Abstraction</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><a class="ulink" href="http://blog.springsource.com/2011/02/15/spring-3-1-m1-unified-property-management/" target="_top">
          Unified Property Management</a> (SpringSource Team Blog)</p></li><li><p>See org.springframework.core.env.Environment Javadoc</p></li><li><p>See org.springframework.core.env.PropertySource Javadoc</p></li><li><p>See org.springframework.context.annotation.PropertySource
          Javadoc</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1343"></a>3.1.5&nbsp;Code equivalents for Spring's XML namespaces</h3></div></div></div><p>Code-based equivalents to popular Spring XML namespace elements
      &lt;context:component-scan/&gt;, &lt;tx:annotation-driven/&gt;
      and &lt;mvc:annotation-driven&gt; have been developed, most in the
      form of <code class="interfacename">@Enable</code> annotations. These are
      designed for use in conjunction with Spring's
      <code class="interfacename">@Configuration</code> classes, which were
      introduced in Spring 3.0.</p><div class="itemizedlist"><ul type="disc"><li><p>See org.springframework.context.annotation.Configuration
          Javadoc</p></li><li><p>See org.springframework.context.annotation.ComponentScan
          Javadoc</p></li><li><p>See
          org.springframework.transaction.annotation.EnableTransactionManagement
          Javadoc</p></li><li><p>See
          org.springframework.cache.annotation.EnableCaching Javadoc</p></li><li><p>See org.springframework.web.servlet.config.annotation.EnableWebMvc
          Javadoc</p></li><li><p>See org.springframework.scheduling.annotation.EnableScheduling
          Javadoc</p></li><li><p>See org.springframework.scheduling.annotation.EnableAsync
          Javadoc</p></li><li><p>See
          org.springframework.context.annotation.EnableAspectJAutoProxy
          Javadoc</p></li><li><p>See
          org.springframework.context.annotation.EnableLoadTimeWeaving
          Javadoc</p></li><li><p>See
          org.springframework.beans.factory.aspectj.EnableSpringConfigured
          Javadoc</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1385"></a>3.1.6&nbsp;Support for Hibernate 4.x</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>See Javadoc for classes within the new
          org.springframework.orm.hibernate4 package</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1392"></a>3.1.7&nbsp;TestContext framework support for @Configuration classes and bean
      definition profiles</h3></div></div></div><p>The <code class="interfacename">@ContextConfiguration</code>
      annotation now supports supplying
      <code class="interfacename">@Configuration</code> classes for configuring
      the Spring <code class="classname">TestContext</code>. In addition, a new
      <code class="interfacename">@ActiveProfiles</code> annotation has been
      introduced to support declarative configuration of active bean
      definition profiles in <code class="interfacename">ApplicationContext</code>
      integration tests.</p><div class="itemizedlist"><ul type="disc"><li><p><a class="ulink" href="http://blog.springsource.com/2011/06/21/spring-3-1-m2-testing-with-configuration-classes-and-profiles/" target="_top">Spring
          3.1 M2: Testing with @Configuration Classes and Profiles</a>
          (SpringSource Team Blog)</p></li><li><p>See <a class="xref" href="#testcontext-framework" title="10.3.5&nbsp;Spring TestContext Framework">Section&nbsp;10.3.5, &#8220;Spring TestContext Framework&#8221;</a></p></li><li><p>See <a class="xref" href="#testcontext-ctx-management-javaconfig" title="Context configuration with @Configuration classes">the section called &#8220;Context configuration with @Configuration classes&#8221;</a>
          and
          <code class="interfacename">org.springframework.test.context.ContextConfiguration</code>
          Javadoc</p></li><li><p>See
          <code class="interfacename">org.springframework.test.context.ActiveProfiles</code>
          Javadoc</p></li><li><p>See
          <code class="interfacename">org.springframework.test.context.SmartContextLoader</code>
          Javadoc</p></li><li><p>See
          <code class="interfacename">org.springframework.test.context.support.DelegatingSmartContextLoader</code>
          Javadoc</p></li><li><p>See
          <code class="interfacename">org.springframework.test.context.support.AnnotationConfigContextLoader</code>
          Javadoc</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1454"></a>3.1.8&nbsp;c: namespace for more concise constructor injection</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><a class="xref" href="#beans-c-namespace" title="4.4.2.7&nbsp;XML shortcut with the c-namespace">Section&nbsp;4.4.2.7, &#8220;XML shortcut with the c-namespace&#8221;</a></p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1461"></a>3.1.9&nbsp;Support for injection against non-standard JavaBeans
      setters</h3></div></div></div><p>Prior to Spring 3.1, in order to inject against a property method
      it had to conform strictly to JavaBeans property signature rules, namely
      that any 'setter' method must be void-returning. It is now possible in
      Spring XML to specify setter methods that return any object type. This
      is useful when considering designing APIs for method-chaining, where
      setter methods return a reference to 'this'.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1466"></a>3.1.10&nbsp;Support for Servlet 3 code-based configuration of Servlet
      Container</h3></div></div></div><p>The new <code class="interfacename">WebApplicationInitializer</code>
      builds atop Servlet 3.0's
      <code class="interfacename">ServletContainerInitializer</code> support to
      provide a programmatic alternative to the traditional web.xml.</p><div class="itemizedlist"><ul type="disc"><li><p>See org.springframework.web.WebApplicationInitializer
          Javadoc</p></li><li><p><a class="ulink" href="http://bit.ly/lrDHja" target="_top">Diff from Spring's
          Greenhouse reference application</a> demonstrating migration
          from web.xml to
          <code class="interfacename">WebApplicationInitializer</code></p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1488"></a>3.1.11&nbsp;Support for Servlet 3 MultipartResolver</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>See
          org.springframework.web.multipart.support.StandardServletMultipartResolver
          Javadoc</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1495"></a>3.1.12&nbsp;JPA EntityManagerFactory bootstrapping without
      persistence.xml</h3></div></div></div><p>In standard JPA, persistence units get defined through
      <code class="literal">META-INF/persistence.xml</code> files in specific jar files
      which will in turn get searched for <code class="literal">@Entity</code> classes.
      In many cases, persistence.xml does not contain more than a unit name
      and relies on defaults and/or external setup for all other concerns
      (such as the DataSource to use, etc). For that reason, Spring 3.1
      provides an alternative:
      <code class="classname">LocalContainerEntityManagerFactoryBean</code> accepts a
      'packagesToScan' property, specifying base packages to scan for
      <code class="literal">@Entity</code> classes. This is analogous to
      <code class="classname">AnnotationSessionFactoryBean</code>'s property of the
      same name for native Hibernate setup, and also to Spring's
      component-scan feature for regular Spring beans. Effectively, this
      allows for XML-free JPA setup at the mere expense of specifying a base
      package for entity scanning: a particularly fine match for Spring
      applications which rely on component scanning for Spring beans as well,
      possibly even bootstrapped using a code-based Servlet 3.0
      initializer.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1515"></a>3.1.13&nbsp;New HandlerMethod-based Support Classes For Annotated Controller
      Processing</h3></div></div></div><p>Spring 3.1 introduces a new set of support classes for processing
      requests with annotated controllers:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">RequestMappingHandlerMapping</code></p></li><li><p><code class="classname">RequestMappingHandlerAdapter</code></p></li><li><p><code class="classname">ExceptionHandlerExceptionResolver</code></p></li></ul></div><p>These classes are a replacement for the existing:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">DefaultAnnotationHandlerMapping</code></p></li><li><p><code class="classname">AnnotationMethodHandlerAdapter</code></p></li><li><p><code class="classname">AnnotationMethodHandlerExceptionResolver</code></p></li></ul></div><p>The new classes were developed in response to many requests to
      make annotation controller support classes more customizable and open
      for extension. Whereas previously you could configure a custom annotated
      controller method argument resolver, with the new support classes you
      can customize the processing for any supported method argument or return
      value type.</p><div class="itemizedlist"><ul type="disc"><li><p>See
          org.springframework.web.method.support.HandlerMethodArgumentResolver
          Javadoc</p></li><li><p>See
          org.springframework.web.method.support.HandlerMethodReturnValueHandler
          Javadoc</p></li></ul></div><p>A second notable difference is the introduction of a
      <code class="classname">HandlerMethod</code> abstraction to represent an
      <span class="interface">@RequestMapping</span> method. This abstraction is used
      throughout by the new support classes as the <code class="literal">handler</code>
      instance. For example a <code class="classname">HandlerInterceptor</code> can
      cast the <code class="literal">handler</code> from <code class="classname">Object</code>
      to <code class="classname">HandlerMethod</code> and get access to the target
      controller method, its annotations, etc.</p><p>The new classes are enabled by default by the MVC namespace and by
      Java-based configuration via <span class="interface">@EnableWebMvc</span>. The
      existing classes will continue to be available but use of the new
      classes is recommended going forward.</p><p>See <a class="xref" href="#mvc-ann-requestmapping-31-vs-30" title="16.3.2.1&nbsp;New Support Classes for @RequestMapping methods in Spring MVC 3.1">Section&nbsp;16.3.2.1, &#8220;New Support Classes for @RequestMapping methods in Spring MVC 3.1&#8221;</a> for additional
      details and a list of features not available with the new support classes.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1589"></a>3.1.14&nbsp;"consumes" and "produces" conditions in
      <span class="interface">@RequestMapping</span></h3></div></div></div><p>Improved support for specifying media types consumed by a method
      through the <code class="literal">'Content-Type'</code> header as well as for
      producible types specified through the <code class="literal">'Accept'</code>
      header. See <a class="xref" href="#mvc-ann-requestmapping-consumes" title="16.3.2.5&nbsp;Consumable Media Types">Section&nbsp;16.3.2.5, &#8220;Consumable Media Types&#8221;</a> and <a class="xref" href="#mvc-ann-requestmapping-produces" title="16.3.2.6&nbsp;Producible Media Types">Section&nbsp;16.3.2.6, &#8220;Producible Media Types&#8221;</a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1605"></a>3.1.15&nbsp;Flash Attributes and
      <code class="interfacename">RedirectAttributes</code></h3></div></div></div><p>Flash attributes can now be stored in a
      <code class="classname">FlashMap</code> and saved in the HTTP session to survive
      a redirect. For an overview of the general support for flash attributes
      in Spring MVC see <a class="xref" href="#mvc-flash-attributes" title="16.6&nbsp;Using flash attributes">Section&nbsp;16.6, &#8220;Using flash attributes&#8221;</a>.</p><p>In annotated controllers, an
      <code class="interfacename">@RequestMapping</code> method can add flash
      attributes by declaring a method argument of type
      <code class="interfacename">RedirectAttributes</code>. This method argument
      can now also be used to get precise control over the attributes used in
      a redirect scenario. See <a class="xref" href="#mvc-ann-redirect-attributes" title="16.3.3.10&nbsp;Specifying redirect and flash attributes">Section&nbsp;16.3.3.10, &#8220;Specifying redirect and flash attributes&#8221;</a>
      for more details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1627"></a>3.1.16&nbsp;URI Template Variable Enhancements</h3></div></div></div><p>URI template variables from the current request are used in more
      places: </p><div class="itemizedlist"><ul type="disc"><li><p>URI template variables are used in addition to request
            parameters when binding a request to
            <code class="interfacename">@ModelAttribute</code> method
            arguments.</p></li><li><p>@PathVariable method argument values are merged into the
            model before rendering, except in views that generate content in
            an automated fashion such as JSON serialization or XML
            marshalling.</p></li><li><p>A redirect string can contain placeholders for URI variables
            (e.g. <code class="literal">"redirect:/blog/{year}/{month}"</code>). When
            expanding the placeholders, URI template variables from the
            current request are automatically considered.</p></li><li><p>An <code class="interfacename">@ModelAttribute</code> method
            argument can be instantiated from a URI template variable provided
            there is a registered Converter or PropertyEditor to convert from
            a String to the target object type.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1654"></a>3.1.17&nbsp;<code class="interfacename">@Valid</code> On
      <span class="interface">@RequestBody</span> Controller Method Arguments</h3></div></div></div><p>An <span class="interface">@RequestBody</span> method argument can be
      annotated with <span class="interface">@Valid</span> to invoke automatic
      validation similar to the support for
      <span class="interface">@ModelAttribute</span> method arguments. A resulting
      <code class="classname">MethodArgumentNotValidException</code> is handled in the
      <code class="classname">DefaultHandlerExceptionResolver</code> and results in a
      <code class="literal">400</code> response code.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1682"></a>3.1.18&nbsp;<code class="interfacename">@RequestPart</code> Annotation On
      Controller Method Arguments</h3></div></div></div><p>This new annotation provides access to the content of a
      "multipart/form-data" request part. See <a class="xref" href="#mvc-multipart-forms-non-browsers" title="16.10.5&nbsp;Handling a file upload request from programmatic clients">Section&nbsp;16.10.5, &#8220;Handling a file upload request from programmatic clients&#8221;</a> and <a class="xref" href="#mvc-multipart" title="16.10&nbsp;Spring's multipart (file upload) support">Section&nbsp;16.10, &#8220;Spring's multipart (file upload) support&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1693"></a>3.1.19&nbsp;<code class="classname">UriComponentsBuilder</code> and <code class="classname">UriComponents</code></h3></div></div></div><p>A new <code class="classname">UriComponents</code> class has been added,
      which is an immutable container of URI components providing
      access to all contained URI components.
      A nenw <code class="classname">UriComponentsBuilder</code> class is also
      provided to help create <code class="classname">UriComponents</code> instances.
      Together the two classes give fine-grained control over all
      aspects of preparing a URI including construction, expansion
      from URI template variables, and encoding.</p><p>In most cases the new classes can be used as a more flexible
      alternative to the existing <code class="classname">UriTemplate</code>
      especially since <code class="classname">UriTemplate</code> relies on those
      same classes internally.
      </p><p>A <code class="classname">ServletUriComponentsBuilder</code> sub-class
      provides static factory methods to copy information from
      a Servlet request. See <a class="xref" href="#mvc-construct-encode-uri" title="16.7&nbsp;Building URIs">Section&nbsp;16.7, &#8220;Building URIs&#8221;</a>.
      </p></div></div></div></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="spring-core"></a>Part&nbsp;III.&nbsp;Core Technologies</h1></div></div></div><div class="partintro" lang="en"><div></div><p>This part of the reference documentation covers all of those
      technologies that are absolutely integral to the Spring
      Framework.</p><p>Foremost amongst these is the Spring Framework's Inversion of
      Control (IoC) container. A thorough treatment of the Spring Framework's
      IoC container is closely followed by comprehensive coverage of Spring's
      Aspect-Oriented Programming (AOP) technologies. The Spring Framework has
      its own AOP framework, which is conceptually easy to understand, and
      which successfully addresses the 80% sweet spot of AOP requirements in
      Java enterprise programming.</p><p>Coverage of Spring's integration with AspectJ (currently the
      richest - in terms of features - and certainly most mature AOP
      implementation in the Java enterprise space) is also provided.</p><p>Finally, the adoption of the test-driven-development (TDD)
      approach to software development is certainly advocated by the Spring
      team, and so coverage of Spring's support for integration testing is
      covered (alongside best practices for unit testing). The Spring team has
      found that the correct use of IoC certainly does make both unit and
      integration testing easier (in that the presence of setter methods and
      appropriate constructors on classes makes them easier to wire together
      in a test without having to set up service locator registries and
      suchlike)... the chapter dedicated solely to testing will hopefully
      convince you of this as well.</p><div class="itemizedlist"><ul type="disc"><li><p><a class="xref" href="#beans" title="4.&nbsp;The IoC container">Chapter&nbsp;4, <i>The IoC container</i></a></p></li><li><p><a class="xref" href="#resources" title="5.&nbsp;Resources">Chapter&nbsp;5, <i>Resources</i></a></p></li><li><p><a class="xref" href="#validation" title="6.&nbsp;Validation, Data Binding, and Type Conversion">Chapter&nbsp;6, <i>Validation, Data Binding, and Type Conversion</i></a></p></li><li><p><a class="xref" href="#expressions" title="7.&nbsp;Spring Expression Language (SpEL)">Chapter&nbsp;7, <i>Spring Expression Language (SpEL)</i></a></p></li><li><p><a class="xref" href="#aop" title="8.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;8, <i>Aspect Oriented Programming with Spring</i></a></p></li><li><p><a class="xref" href="#aop-api" title="9.&nbsp;Spring AOP APIs">Chapter&nbsp;9, <i>Spring AOP APIs</i></a></p></li><li><p><a class="xref" href="#testing" title="10.&nbsp;Testing">Chapter&nbsp;10, <i>Testing</i></a></p></li></ul></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="beans"></a>4.&nbsp;The IoC container</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-introduction"></a>4.1&nbsp;Introduction to the Spring IoC container and beans</h2></div></div></div><p>This chapter covers the Spring Framework implementation of the
      Inversion of Control (IoC) <sup>[<a name="d0e1768" href="#ftn.d0e1768" class="footnote">1</a>]</sup>principle. IoC is also known as <span class="emphasis"><em>dependency
      injection</em></span> (DI). It is a process whereby objects define their
      dependencies, that is, the other objects they work with, only through
      constructor arguments, arguments to a factory method, or properties that
      are set on the object instance after it is constructed or returned from a
      factory method. The container then <span class="emphasis"><em>injects</em></span> those
      dependencies when it creates the bean. This process is fundamentally the
      inverse, hence the name <span class="emphasis"><em>Inversion of Control</em></span> (IoC),
      of the bean itself controlling the instantiation or location of its
      dependencies by using direct construction of classes, or a mechanism such
      as the <span class="emphasis"><em>Service Locator</em></span> pattern.</p><p>The <code class="literal">org.springframework.beans</code> and
      <code class="literal">org.springframework.context</code> packages are the basis for
      Spring Framework's IoC container. The <code class="interfacename"><a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/beans/factory/BeanFactory.html" target="_top">BeanFactory</a></code> interface provides an advanced
      configuration mechanism capable of managing any type of object.
      <code class="literal"><a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/ApplicationContext.html" target="_top">ApplicationContext</a></code> is a sub-interface of
      <code class="interfacename">BeanFactory.</code> It adds easier integration
      with Spring's AOP features; message resource handling (for use in
      internationalization), event publication; and application-layer specific
      contexts such as the <code class="interfacename">WebApplicationContext</code>
      for use in web applications.</p><p>In short, the <code class="interfacename">BeanFactory</code> provides the
      configuration framework and basic functionality, and the
      <code class="interfacename">ApplicationContext</code> adds more
      enterprise-specific functionality. The
      <code class="interfacename">ApplicationContext</code> is a complete superset
      of the <code class="interfacename">BeanFactory</code>, and is used exclusively
      in this chapter in descriptions of Spring's IoC container.
      For
      more information on using the <code class="classname">BeanFactory</code> instead
      of the <code class="classname">ApplicationContext,</code> refer to <a class="xref" href="#beans-beanfactory" title="4.15&nbsp;The BeanFactory">Section&nbsp;4.15, &#8220;The BeanFactory&#8221;</a>.</p><p>In Spring, the objects that form the backbone of your application and
      that are managed by the Spring IoC <em class="firstterm">container</em> are
      called <em class="firstterm">beans</em>. A bean is an object that is
      instantiated, assembled, and otherwise managed by a Spring IoC container.
      Otherwise, a bean is simply one of many objects in your application.
      Beans, and the <em class="firstterm">dependencies</em> among them, are
      reflected in the <em class="firstterm">configuration metadata</em> used by a
      container.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-basics"></a>4.2&nbsp;Container overview</h2></div></div></div><p>The interface
      <code class="classname">org.springframework.context.ApplicationContext</code>
      represents the Spring IoC container and is responsible for instantiating,
      configuring, and assembling the aforementioned beans. The container gets
      its instructions on what objects to instantiate, configure, and assemble
      by reading configuration metadata. The configuration metadata is
      represented in XML, Java annotations, or Java code. It allows you to
      express the objects that compose your application and the rich
      interdependencies between such objects.</p><p>Several implementations of the
      <code class="classname">ApplicationContext</code> interface are supplied
      out-of-the-box with Spring. In standalone applications it is common to
      create an instance of <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html" target="_top"><code class="classname">ClassPathXmlApplicationContext</code></a> or <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/support/FileSystemXmlApplicationContext.html" target="_top"><code class="classname">FileSystemXmlApplicationContext</code></a>.
       While XML has been the traditional format
      for defining configuration metadata you can instruct the container to use
      Java annotations or code as the metadata format by providng a small amount
      of XML configuration to declaratively enable support for these additional
      metadata formats.</p><p>In most application scenarios, explicit user code is not required to
      instantiate one or more instances of a Spring IoC container. For example,
      in a web application scenario, a simple eight (or so) lines of boilerplate
      J2EE web descriptor XML in the <code class="literal">web.xml</code> file of the
      application will typically suffice (see <a class="xref" href="#context-create" title="4.14.4&nbsp;Convenient ApplicationContext instantiation for web applications">Section&nbsp;4.14.4, &#8220;Convenient ApplicationContext
      instantiation for web applications&#8221;</a>).
      If you are using the <a class="ulink" href="http://www.springsource.com/produts/sts" target="_top">SpringSource Tool Suite</a> Eclipse-powered development environment
      or <a class="ulink" href="http://www.springsource.org/roo" target="_top">Spring Roo</a> this
      boilerplate configuration can be easily created with few mouse clicks or
      keystrokes.</p><p>The following diagram is a high-level view of how Spring works. Your
      application classes are combined with configuration metadata so that after
      the <code class="classname">ApplicationContext</code> is created and initialized,
      you have a fully configured and executable system or application.</p><div class="mediaobject" align="center"><img src="images/container-magic.png" align="middle"><div class="caption"><p>The Spring IoC container</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-metadata"></a>4.2.1&nbsp;Configuration metadata</h3></div></div></div><p>As the preceding diagram shows, the Spring IoC container consumes a
        form of <span class="emphasis"><em>configuration metadata</em></span>; this configuration
        metadata represents how you as an application developer tell the Spring
        container to instantiate, configure, and assemble the objects in your
        application.</p><p>Configuration metadata is traditionally supplied in a simple and
        intuitive XML format, which is what most of this chapter uses to convey
        key concepts and features of the Spring IoC container.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>XML-based metadata is <span class="emphasis"><em>not</em></span> the only allowed
          form of configuration metadata. The Spring IoC container itself is
          <span class="emphasis"><em>totally</em></span> decoupled from the format in which this
          configuration metadata is actually written.</p></td></tr></table></div><p>For information about using other forms of metadata with the Spring
        container, see:</p><div class="itemizedlist"><ul type="disc"><li><p><a class="link" href="#beans-annotation-config" title="4.9&nbsp;Annotation-based container configuration">Annotation-based
            configuration</a>: Spring 2.5 introduced support for
            annotation-based configuration metadata.</p></li><li><p><a class="link" href="#beans-java" title="4.12&nbsp;Java-based container configuration">Java-based configuration</a>:
            Starting with Spring 3.0, many features provided by the <a class="ulink" href="http://www.springsource.org/javaconfig" target="_top">Spring JavaConfig
            project</a> became part of the core Spring Framework. Thus you
            can define beans external to your application classes by using Java
            rather than XML files. To use these new features, see the
            <code class="interfacename">@Configuration</code>, <code class="interfacename">@Bean,
            @Import</code> and
            <code class="interfacename">@DependsOn</code> annotations.</p></li></ul></div><p>Spring configuration consists of at least one and typically more
        than one bean definition that the container must manage. XML-based
        configuration metadata shows these beans configured as
        <code class="literal">&lt;bean/&gt;</code> elements inside a top-level
        <code class="literal">&lt;beans/&gt;</code> element.</p><p>These bean definitions correspond to the actual objects that make up
        your application. Typically you define service layer objects, data
        access objects (DAOs), presentation objects such as Struts
        <code class="interfacename">Action</code> instances, infrastructure objects
        such as Hibernate <code class="interfacename">SessionFactories</code>, JMS
        <code class="interfacename">Queues</code>, and so forth. Typically one does
        not configure fine-grained domain objects in the container, because it
        is usually the responsibility of DAOs and business logic to create and
        load domain objects. However, you can use Spring's integration with
        AspectJ to configure objects that have been created outside the control
        of an IoC container. See <a class="link" href="#aop-atconfigurable" title="8.8.1&nbsp;Using AspectJ to dependency inject domain objects with Spring">Using
        AspectJ to dependency-inject domain objects with Spring</a>.</p><p>The following example shows the basic structure of XML-based
        configuration metadata:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>&gt;
    &lt;<span class="hl-comment">!-- collaborators and configuration for this bean go here --</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>&gt;
    &lt;<span class="hl-comment">!-- collaborators and configuration for this bean go here --</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-comment">!-- more bean definitions go here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The <code class="literal">id</code> attribute is a string that you use to
        identify the individual bean definition. The <code class="literal">class</code>
        attribute defines the type of the bean and uses the fully qualified
        classname. The value of the id attribute refers to collaborating
        objects. The XML for referring to collaborating objects is not shown in
        this example; see <a class="link" href="#beans-dependencies" title="4.4&nbsp;Dependencies">Dependencies</a>
        for more information.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-instantiation"></a>4.2.2&nbsp;Instantiating a container</h3></div></div></div><p>Instantiating a Spring IoC container is straightforward. The
        location path or paths supplied to an
        <code class="interfacename">ApplicationContext</code> constructor are
        actually resource strings that allow the container to load configuration
        metadata from a variety of external resources such as the local file
        system, from the Java <code class="literal">CLASSPATH</code>, and so on.</p><pre class="programlisting">ApplicationContext context =
    <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-keyword">new</span> String[] {<span class="hl-string">"services.xml"</span>, <span class="hl-string">"daos.xml"</span>});</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>After you learn about Spring's IoC container, you may want to know
          more about Spring's <code class="interfacename">Resource</code>
          abstraction, as described in <a class="xref" href="#resources" title="5.&nbsp;Resources">Chapter&nbsp;5, <i>Resources</i></a>, which
          provides a convenient mechanism for reading an InputSream from
          locations defined in a URI syntax. In particular,
          <code class="classname">Resource</code> paths are used to construct
          applications contexts as described in <a class="xref" href="#resources-app-ctx" title="5.7&nbsp;Application contexts and Resource paths">Section&nbsp;5.7, &#8220;Application contexts and Resource paths&#8221;</a>.</p></td></tr></table></div><p>The following example shows the service layer objects
        <code class="literal">(services.xml)</code> configuration file:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

  &lt;<span class="hl-comment">!-- services --</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"petStore"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.jpetstore.services.PetStoreServiceImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accountDao"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountDao"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"itemDao"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"itemDao"</span>/&gt;
    &lt;<span class="hl-comment">!-- additional collaborators and configuration for this bean go here --</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-comment">!-- more bean definitions for services go here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;
</pre><p>The following example shows the data access objects
        <code class="literal">daos.xml</code> file:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountDao"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.jpetstore.dao.ibatis.SqlMapAccountDao"</span>&gt;
    &lt;<span class="hl-comment">!-- additional collaborators and configuration for this bean go here --</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"itemDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.jpetstore.dao.ibatis.SqlMapItemDao"</span>&gt;
    &lt;<span class="hl-comment">!-- additional collaborators and configuration for this bean go here --</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-comment">!-- more bean definitions for data access objects go here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>In the preceding example, the service layer consists of the class
        <code class="classname">PetStoreServiceImpl</code>, and two data access objects
        of the type <code class="classname">SqlMapAccountDao</code> and SqlMapItemDao
        are based on the <a class="ulink" href="http://ibatis.apache.org/" target="_top">iBatis</a>
        Object/Relational mapping framework. The <code class="literal">property
        name</code> element refers to the name of the JavaBean property, and
        the <code class="literal">ref</code> element refers to the name of another bean
        definition. This linkage between id and ref elements expresses the
        dependency between collaborating objects. For details of configuring an
        object's dependencies, see <a class="link" href="#beans-dependencies" title="4.4&nbsp;Dependencies">Dependencies</a>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-xml-import"></a>4.2.2.1&nbsp;Composing XML-based configuration metadata</h4></div></div></div><p>It can be useful to have bean definitions span multiple XML files.
          Often each individual XML configuration file represents a logical
          layer or module in your architecture.</p><p>You can use the application context constructor to load bean
          definitions from all these XML fragments. This constructor takes
          multiple <code class="interfacename">Resource</code> locations, as was
          shown in the previous section. Alternatively, use one or more
          occurrences of the <code class="literal">&lt;import/&gt;</code> element to load
          bean definitions from another file or files. For example:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

    &lt;<span class="hl-tag">import</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"services.xml"</span>/&gt;
    &lt;<span class="hl-tag">import</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"resources/messageSource.xml"</span>/&gt;
    &lt;<span class="hl-tag">import</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"/resources/themeSource.xml"</span>/&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bean1"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>/&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bean2"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>In the preceding example, external bean definitions are loaded
          from three files, <code class="literal">services.xml</code>,
          <code class="literal">messageSource.xml</code>, and
          <code class="literal">themeSource.xml</code>. All location paths are relative to
          the definition file doing the importing, so
          <code class="literal">services.xml</code> must be in the same directory or
          classpath location as the file doing the importing, while
          <code class="literal">messageSource.xml</code> and
          <code class="literal">themeSource.xml</code> must be in a
          <code class="literal">resources</code> location below the location of the
          importing file. As you can see, a leading slash is ignored, but given
          that these paths are relative, it is better form not to use the slash
          at all. The contents of the files being imported, including the top
          level <code class="literal">&lt;beans/&gt;</code> element, must be valid XML
          bean definitions according to the Spring Schema or DTD.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>It is possible, but not recommended, to reference files in
            parent directories using a relative "../" path. Doing so creates a
            dependency on a file that is outside the current application. In
            particular, this reference is not recommended for "classpath:" URLs
            (for example, "classpath:../services.xml"), where the runtime
            resolution process chooses the "nearest" classpath root and then
            looks into its parent directory. Classpath configuration changes may
            lead to the choice of a different, incorrect directory.</p><p>You can always use fully qualified resource locations instead of
            relative paths: for example, "file:C:/config/services.xml" or
            "classpath:/config/services.xml". However, be aware that you are
            coupling your application's configuration to specific absolute
            locations. It is generally preferable to keep an indirection for
            such absolute locations, for example, through "${...}" placeholders
            that are resolved against JVM system properties at runtime.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-client"></a>4.2.3&nbsp;Using the container</h3></div></div></div><p>The <code class="interfacename">ApplicationContext</code> is the
        interface for an advanced factory capable of maintaining a registry of
        different beans and their dependencies. Using the method <code class="methodname">T
        getBean(Stringname, Class&lt;T&gt; requiredType)</code> you can
        retrieve instances of your beans.</p><p>The <code class="interfacename">ApplicationContext</code> enables you to
        read bean definitions and access them as follows:</p><pre class="programlisting"><span class="hl-comment">// create and configure beans</span>
ApplicationContext context =
    <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-keyword">new</span> String[] {<span class="hl-string">"services.xml"</span>, <span class="hl-string">"daos.xml"</span>});

<span class="hl-comment">// retrieve configured instance</span>
PetStoreServiceImpl service = context.getBean(<span class="hl-string">"petStore"</span>, PetStoreServiceImpl.<span class="hl-keyword">class</span>);

<span class="hl-comment">// use configured instance</span>
List userList service.getUsernameList();
</pre><p>You use <code class="methodname">getBean()</code> to retrieve instances of
        your beans. The <code class="interfacename">ApplicationContext</code>
        interface has a few other methods for retrieving beans, but ideally your
        application code should never use them. Indeed, your application code
        should have no calls to the <code class="methodname">getBean()</code> method at
        all, and thus no dependency on Spring APIs at all. For example, Spring's
        integration with web frameworks provides for dependency injection for
        various web framework classes such as controllers and JSF-managed
        beans.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-definition"></a>4.3&nbsp;Bean overview</h2></div></div></div><p>A Spring IoC container manages one or more <span class="emphasis"><em>beans</em></span>.
      These beans are created with the configuration metadata that you supply to
      the container, for example, in the form of XML
      <code class="literal">&lt;bean/&gt;</code> definitions.</p><p>Within the container itself, these bean definitions are represented as
      <code class="interfacename">BeanDefinition</code> objects, which contain
      (among other information) the following metadata:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>A package-qualified class name:</em></span> typically the
          actual implementation class of the bean being defined.</p></li><li><p>Bean behavioral configuration elements, which state how the bean
          should behave in the container (scope, lifecycle callbacks, and so
          forth).</p></li><li><p>References to other beans that are needed for the bean to do its
          work; these references are also called
          <span class="emphasis"><em>collaborators</em></span> or
          <span class="emphasis"><em>dependencies</em></span>.</p></li><li><p>Other configuration settings to set in the newly created object,
          for example, the number of connections to use in a bean that manages a
          connection pool, or the size limit of the pool.</p></li></ul></div><p>This metadata translates to a set of properties that make up each bean
      definition.</p><div class="table"><a name="beans-factory-bean-definition-tbl"></a><p class="title"><b>Table&nbsp;4.1.&nbsp;The bean definition</b></p><div class="table-contents"><table summary="The bean definition" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Property</th><th style="border-bottom: 1.0pt solid ; ">Explained in...</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">class</td><td style="border-bottom: 1.0pt solid ; "><p> <a class="xref" href="#beans-factory-class" title="4.3.2&nbsp;Instantiating beans">Section&nbsp;4.3.2, &#8220;Instantiating beans&#8221;</a> </p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">name</td><td style="border-bottom: 1.0pt solid ; "><p> <a class="xref" href="#beans-beanname" title="4.3.1&nbsp;Naming beans">Section&nbsp;4.3.1, &#8220;Naming beans&#8221;</a> </p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">scope</td><td style="border-bottom: 1.0pt solid ; "><p> <a class="xref" href="#beans-factory-scopes" title="4.5&nbsp;Bean scopes">Section&nbsp;4.5, &#8220;Bean scopes&#8221;</a> </p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">constructor arguments</td><td style="border-bottom: 1.0pt solid ; "><p> <a class="xref" href="#beans-factory-collaborators" title="4.4.1&nbsp;Dependency injection">Section&nbsp;4.4.1, &#8220;Dependency injection&#8221;</a>
              </p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">properties</td><td style="border-bottom: 1.0pt solid ; "><p> <a class="xref" href="#beans-factory-collaborators" title="4.4.1&nbsp;Dependency injection">Section&nbsp;4.4.1, &#8220;Dependency injection&#8221;</a>
              </p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">autowiring mode</td><td style="border-bottom: 1.0pt solid ; "><p> <a class="xref" href="#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators">Section&nbsp;4.4.5, &#8220;Autowiring collaborators&#8221;</a>
              </p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">lazy-initialization mode</td><td style="border-bottom: 1.0pt solid ; "><p> <a class="xref" href="#beans-factory-lazy-init" title="4.4.4&nbsp;Lazy-initialized beans">Section&nbsp;4.4.4, &#8220;Lazy-initialized
      beans&#8221;</a>
              </p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">initialization method</td><td style="border-bottom: 1.0pt solid ; "><p> <a class="xref" href="#beans-factory-lifecycle-initializingbean" title="4.6.1.1&nbsp;Initialization callbacks">Section&nbsp;4.6.1.1, &#8220;Initialization callbacks&#8221;</a>
              </p></td></tr><tr><td style="border-right: 1.0pt solid ; ">destruction method</td><td style=""><p> <a class="xref" href="#beans-factory-lifecycle-disposablebean" title="4.6.1.2&nbsp;Destruction callbacks">Section&nbsp;4.6.1.2, &#8220;Destruction callbacks&#8221;</a> </p></td></tr></tbody></table></div></div><br class="table-break"><p>In addition to bean definitions that contain information on how to
      create a specific bean, the
      <code class="interfacename">ApplicationContext</code> implementations also
      permit the registration of existing objects that are created outside the
      container, by users. This is done by accessing the ApplicationContext's
      BeanFactory via the method <code class="methodname">getBeanFactory()</code> which
      returns the BeanFactory implementation
      <code class="classname">DefaultListableBeanFactory</code>.
      <code class="classname">DefaultListableBeanFactory</code> supports this
      registration through the methods
      <code class="methodname">registerSingleton(..)</code> and
      <code class="methodname">registerBeanDefinition(..)</code>. However, typical
      applications work solely with beans defined through metadata bean
      definitions.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-beanname"></a>4.3.1&nbsp;Naming beans</h3></div></div></div><p>Every bean has one or more identifiers. These identifiers must be
        unique within the container that hosts the bean. A bean usually has only
        one identifier, but if it requires more than one, the extra ones can be
        considered aliases.</p><p>In XML-based configuration metadata, you use the
        <code class="literal">id</code> and/or <code class="literal">name</code> attributes to
        specify the bean identifier(s). The <code class="literal">id</code> attribute
        allows you to specify exactly one id.  Conventionally these names are
        alphanumeric ('myBean', 'fooService', etc), but may special characters
        as well.  If you want to introduce other aliases to the bean, you can
        also specify them in the <code class="literal">name</code> attribute, separated by
        a comma (<code class="literal">,</code>), semicolon (<code class="literal">;</code>), or
        white space.  As a historical note, in versions prior to Spring 3.1, the
        <code class="literal">id</code> attribute was typed as an
        <code class="literal">xsd:ID</code>, which constrained possible characters.  As of
        3.1, it is now <code class="literal">xsd:string</code>.  Note that bean id
        uniqueness is still enforced by the container, though no longer by XML
        parsers.</p><p>You are not required to supply a name or id for a bean. If no name
        or id is supplied explicitly, the container generates a unique name for
        that bean. However, if you want to refer to that bean by name, through
        the use of the <code class="literal">ref</code> element or <a class="link" href="#beans-servicelocator" title="4.15.2&nbsp;Glue code and the evil singleton">Service Locator</a> style lookup,
        you must provide a name. Motivations for not supplying a name are
        related to using <a class="link" href="#beans-inner-beans" title="4.4.2.3&nbsp;Inner beans">inner beans</a>
        and <a class="link" href="#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators">autowiring
        collaborators</a>.</p><div class="sidebar"><p class="title"><b>Bean naming conventions</b></p><p>The convention is to use the standard Java convention for instance
          field names when naming beans. That is, bean names start with a
          lowercase letter, and are camel-cased from then on. Examples of such
          names would be (without quotes) <code class="literal">'accountManager'</code>,
          <code class="literal">'accountService'</code>, <code class="literal">'userDao'</code>,
          <code class="literal">'loginController'</code>, and so forth.</p><p>Naming beans consistently makes your configuration easier to read
          and understand, and if you are using Spring AOP it helps a lot when
          applying advice to a set of beans related by name.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-beanname-alias"></a>4.3.1.1&nbsp;Aliasing a bean outside the bean definition</h4></div></div></div><p>In a bean definition itself, you can supply more than one name for
          the bean, by using a combination of up to one name specified by the
          <code class="literal">id</code> attribute, and any number of other names in the
          <code class="literal">name</code> attribute. These names can be equivalent
          aliases to the same bean, and are useful for some situations, such as
          allowing each component in an application to refer to a common
          dependency by using a bean name that is specific to that component
          itself.</p><p>Specifying all aliases where the bean is actually defined is not
          always adequate, however. It is sometimes desirable to introduce an
          alias for a bean that is defined elsewhere. This is commonly the case
          in large systems where configuration is split amongst each subsystem,
          each subsystem having its own set of object definitions. In XML-based
          configuration metadata, you can use the
          <code class="literal">&lt;alias/&gt;</code> element to accomplish this.</p><pre class="programlisting">&lt;<span class="hl-tag">alias</span> <span class="hl-attribute">name</span>=<span class="hl-value">"fromName"</span> <span class="hl-attribute">alias</span>=<span class="hl-value">"toName"</span>/&gt;</pre><p>In this case, a bean in the same container which is named
          <code class="literal">fromName</code>, may also after the use of this alias
          definition, be referred to as <code class="literal">toName</code>.</p><p>For example, the configuration metadata for subsystem A may refer
          to a DataSource via the name 'subsystemA-dataSource. The configuration
          metadata for subsystem B may refer to a DataSource via the name
          'subsystemB-dataSource'. When composing the main application that uses
          both these subsystems the main application refers to the DataSource
          via the name 'myApp-dataSource'. To have all three names refer to the
          same object you add to the MyApp configuration metadata the following
          aliases definitions:</p><pre class="programlisting">&lt;<span class="hl-tag">alias</span> <span class="hl-attribute">name</span>=<span class="hl-value">"subsystemA-dataSource"</span> <span class="hl-attribute">alias</span>=<span class="hl-value">"subsystemB-dataSource"</span>/&gt;
&lt;<span class="hl-tag">alias</span> <span class="hl-attribute">name</span>=<span class="hl-value">"subsystemA-dataSource"</span> <span class="hl-attribute">alias</span>=<span class="hl-value">"myApp-dataSource"</span> /&gt;</pre><p>Now each component and the main application can refer to the
          dataSource through a name that is unique and guaranteed not to clash
          with any other definition (effectively creating a namespace), yet they
          refer to the same bean.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-class"></a>4.3.2&nbsp;Instantiating beans</h3></div></div></div><p>A bean definition essentially is a recipe for creating one or more
        objects. The container looks at the recipe for a named bean when asked,
        and uses the configuration metadata encapsulated by that bean definition
        to create (or acquire) an actual object.</p><p>If you use XML-based configuration metadata, you specify the type
        (or class) of object that is to be instantiated in the
        <code class="literal">class</code> attribute of the
        <code class="literal">&lt;bean/&gt;</code> element. This <code class="literal">class</code>
        attribute, which internally is a <code class="classname">Class</code> property
        on a <code class="interfacename">BeanDefinition</code> instance, is usually
        mandatory. (For exceptions, see <a class="xref" href="#beans-factory-class-instance-factory-method" title="4.3.2.3&nbsp;Instantiation using an instance factory method">Section&nbsp;4.3.2.3, &#8220;Instantiation using an instance factory method&#8221;</a> and <a class="xref" href="#beans-child-bean-definitions" title="4.7&nbsp;Bean definition inheritance">Section&nbsp;4.7, &#8220;Bean definition inheritance&#8221;</a>.) You use the
        <code class="classname">Class</code> property in one of two ways: </p><div class="itemizedlist"><ul type="disc"><li><p>Typically, to specify the bean class to be constructed in the
            case where the container itself directly creates the bean by calling
            its constructor reflectively, somewhat equivalent to Java code using
            the <code class="code">new</code> operator.</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>To specify the actual class containing the
            <code class="literal">static</code> factory method that will be invoked to
            create the object, in the less common case where the container
            invokes a <code class="literal">static</code>, <span class="emphasis"><em>factory</em></span>
            method on a class to create the bean. The object type returned from
            the invocation of the <code class="literal">static</code> factory method may
            be the same class or another class entirely.</p></li></ul></div><div class="sidebar"><p class="title"><b>Inner class names</b></p><p>If you want to configure a bean definition for a
          <code class="literal">static</code> nested class, you have to use the
          <span class="emphasis"><em>binary</em></span> name of the inner class.</p><p>For example, if you have a class called <code class="classname">Foo</code>
          in the <code class="literal">com.example</code> package, and this
          <code class="classname">Foo</code> class has a <code class="literal">static</code> inner
          class called <code class="classname">Bar</code>, the value of the
          <code class="literal">'class'</code> attribute on a bean definition would
          be...</p><p><code class="classname">com.example.Foo$Bar</code></p><p>Notice the use of the <code class="literal">$</code> character in the name
          to separate the inner class name from the outer class name.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-class-ctor"></a>4.3.2.1&nbsp;Instantiation with a constructor</h4></div></div></div><p>When you create a bean by the constructor approach, all normal
          classes are usable by and compatible with Spring. That is, the class
          being developed does not need to implement any specific interfaces or
          to be coded in a specific fashion. Simply specifying the bean class
          should suffice. However, depending on what type of IoC you use for
          that specific bean, you may need a default (empty) constructor.</p><p>The Spring IoC container can manage virtually
          <span class="emphasis"><em>any</em></span> class you want it to manage; it is not
          limited to managing true JavaBeans. Most Spring users prefer actual
          JavaBeans with only a default (no-argument) constructor and
          appropriate setters and getters modeled after the properties in the
          container. You can also have more exotic non-bean-style classes in
          your container. If, for example, you need to use a legacy connection
          pool that absolutely does not adhere to the JavaBean specification,
          Spring can manage it as well.</p><p>With XML-based configuration metadata you can specify your bean
          class as follows:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"anotherExample"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBeanTwo"</span>/&gt;</pre><p>For details about the mechanism for supplying arguments to the
          constructor (if required) and setting object instance properties after
          the object is constructed, see <a class="link" href="#beans-factory-collaborators" title="4.4.1&nbsp;Dependency injection">Injecting
          Dependencies</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-class-static-factory-method"></a>4.3.2.2&nbsp;Instantiation with a static factory method</h4></div></div></div><p>When defining a bean that you create with a static factory method,
          you use the <code class="literal">class</code> attribute to specify the class
          containing the <code class="literal">static</code> factory method and an
          attribute named <code class="literal">factory-method</code> to specify the name
          of the factory method itself. You should be able to call this method
          (with optional arguments as described later) and return a live object,
          which subsequently is treated as if it had been created through a
          constructor. One use for such a bean definition is to call
          <code class="literal">static</code> factories in legacy code.</p><p>The following bean definition specifies that the bean will be
          created by calling a factory-method. The definition does not specify
          the type (class) of the returned object, only the class containing the
          factory method. In this example, the
          <code class="methodname">createInstance()</code> method must be a
          <span class="emphasis"><em>static</em></span> method.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"clientService"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ClientService"</span>
      <span class="hl-attribute">factory-method</span>=<span class="hl-value">"createInstance"</span>/&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ClientService {
  <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> ClientService clientService = <span class="hl-keyword">new</span> ClientService();
  <span class="hl-keyword">private</span> ClientService() {}

  <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> ClientService createInstance() {
    <span class="hl-keyword">return</span> clientService;
  }
}</pre><p>For details about the mechanism for supplying (optional) arguments
          to the factory method and setting object instance properties after the
          object is returned from the factory, see <a class="link" href="#beans-factory-properties-detailed" title="4.4.2&nbsp;Dependencies and configuration in detail">Dependencies and
          configuration in detail</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-class-instance-factory-method"></a>4.3.2.3&nbsp;Instantiation using an instance factory method</h4></div></div></div><p>Similar to instantiation through a <a class="link" href="#beans-factory-class-static-factory-method" title="4.3.2.2&nbsp;Instantiation with a static factory method">static factory
          method</a>, instantiation with an instance factory method invokes a
          non-static method of an existing bean from the container to create a
          new bean. To use this mechanism, leave the <code class="literal">class
          </code>attribute empty, and in the <code class="literal">factory-bean</code>
          attribute, specify the name of a bean in the current (or
          parent/ancestor) container that contains the instance method that is
          to be invoked to create the object. Set the name of the factory method
          itself with the <code class="literal">factory-method</code> attribute.</p><pre class="programlisting">&lt;<span class="hl-comment">!-- the factory bean, which contains a method called createInstance() --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceLocator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.DefaultServiceLocator"</span>&gt;
  &lt;<span class="hl-comment">!-- inject any dependencies required by this locator bean --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-comment">!-- the bean to be created via the factory bean --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"clientService"</span>
      <span class="hl-attribute">factory-bean</span>=<span class="hl-value">"serviceLocator"</span>
      <span class="hl-attribute">factory-method</span>=<span class="hl-value">"createClientServiceInstance"</span>/&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultServiceLocator {
  <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> ClientService clientService = <span class="hl-keyword">new</span> ClientServiceImpl();
  <span class="hl-keyword">private</span> DefaultServiceLocator() {}

  <span class="hl-keyword">public</span> ClientService createClientServiceInstance() {
    <span class="hl-keyword">return</span> clientService;
  }
}</pre><p>One factory class can also hold more than one factory method as
          shown here:</p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceLocator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.DefaultServiceLocator"</span>&gt;
  &lt;<span class="hl-comment">!-- inject any dependencies required by this locator bean --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"clientService"</span>
      <span class="hl-attribute">factory-bean</span>=<span class="hl-value">"serviceLocator"</span>
      <span class="hl-attribute">factory-method</span>=<span class="hl-value">"createClientServiceInstance"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span>
      <span class="hl-attribute">factory-bean</span>=<span class="hl-value">"serviceLocator"</span>
      <span class="hl-attribute">factory-method</span>=<span class="hl-value">"createAccountServiceInstance"</span>/&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultServiceLocator {
  <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> ClientService clientService = <span class="hl-keyword">new</span> ClientServiceImpl();
  <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> AccountService accountService = <span class="hl-keyword">new</span> AccountServiceImpl();

  <span class="hl-keyword">private</span> DefaultServiceLocator() {}

  <span class="hl-keyword">public</span> ClientService createClientServiceInstance() {
    <span class="hl-keyword">return</span> clientService;
  }

  <span class="hl-keyword">public</span> AccountService createAccountServiceInstance() {
    <span class="hl-keyword">return</span> accountService;
  }
}</pre><p>This approach shows that the factory bean itself can be managed
          and configured through dependency injection (DI). See <a class="link" href="#beans-factory-properties-detailed" title="4.4.2&nbsp;Dependencies and configuration in detail"></a><a class="link" href="#beans-factory-properties-detailed" title="4.4.2&nbsp;Dependencies and configuration in detail">Dependencies and
          configuration in detail</a><a class="link" href="#beans-factory-properties-detailed" title="4.4.2&nbsp;Dependencies and configuration in detail">.</a></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In Spring documentation,<span class="emphasis"><em> factory bean</em></span>
            refers to a bean that is configured in the Spring container that
            will create objects through an <a class="link" href="#beans-factory-class-instance-factory-method" title="4.3.2.3&nbsp;Instantiation using an instance factory method">instance</a> or <a class="link" href="#beans-factory-class-static-factory-method" title="4.3.2.2&nbsp;Instantiation with a static factory method">static</a>
            factory method. By contrast,
            <code class="interfacename">FactoryBean</code> (notice the
            capitalization) refers to a Spring-specific <a class="link" href="#beans-factory-extension-factorybean" title="4.8.3&nbsp;Customizing instantiation logic with a FactoryBean">
            <code class="interfacename">FactoryBean</code> </a>.</p></td></tr></table></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-dependencies"></a>4.4&nbsp;Dependencies</h2></div></div></div><p>A typical enterprise application does not consist of a single object (or
    bean in the Spring parlance). Even the simplest application has a few
    objects that work together to present what the end-user sees as a coherent
    application. This next section explains how you go from defining a number of
    bean definitions that stand alone to a fully realized application where
    objects collaborate to achieve a goal.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-collaborators"></a>4.4.1&nbsp;Dependency injection</h3></div></div></div><p><span class="emphasis"><em>Dependency injection</em></span> (DI) is a process whereby
      objects define their dependencies, that is, the other objects they work
      with, only through constructor arguments, arguments to a factory method,
      or properties that are set on the object instance after it is constructed
      or returned from a factory method. The container then
      <span class="emphasis"><em>injects</em></span> those dependencies when it creates the bean.
      This process is fundamentally the inverse, hence the name
      <span class="emphasis"><em>Inversion of Control</em></span> (IoC), of the bean itself
      controlling the instantiation or location of its dependencies on its own
      by using direct construction of classes, or the <span class="emphasis"><em>Service
      Locator</em></span> pattern.</p><p>Code is cleaner with the DI principle and decoupling is more effective
      when objects are provided with their dependencies. The object does not
      look up its dependencies, and does not know the location or class of the
      dependencies. As such, your classes become easier to test, in particular
      when the dependencies are on interfaces or abstract base classes, which
      allow for stub or mock implementations to be used in unit tests.</p><p>DI exists in two major variants, <a class="link" href="#beans-constructor-injection" title="4.4.1.1&nbsp;Constructor-based dependency injection">Constructor-based dependency
      injection</a> and <a class="link" href="#beans-setter-injection" title="4.4.1.2&nbsp;Setter-based dependency injection">Setter-based
      dependency injection</a>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-constructor-injection"></a>4.4.1.1&nbsp;Constructor-based dependency injection</h4></div></div></div><p><span class="emphasis"><em>Constructor-based</em></span> DI is accomplished by the
        container invoking a constructor with a number of arguments, each
        representing a dependency. Calling a <code class="literal">static</code> factory
        method with specific arguments to construct the bean is nearly
        equivalent, and this discussion treats arguments to a constructor and to
        a <code class="literal">static</code> factory method similarly. The following
        example shows a class that can only be dependency-injected with
        constructor injection. Notice that there is nothing
        <span class="emphasis"><em>special</em></span> about this class, it is a POJO that has no
        dependencies on container specific interfaces, base classes or
        annotations.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

  <span class="hl-comment">// the SimpleMovieLister has a dependency on a MovieFinder</span>
  <span class="hl-keyword">private</span> MovieFinder movieFinder;

  <span class="hl-comment">// a constructor so that the Spring container can 'inject' a MovieFinder</span>
  <span class="hl-keyword">public</span> SimpleMovieLister(MovieFinder movieFinder) {
      <span class="hl-keyword">this</span>.movieFinder = movieFinder;
  }

  <span class="hl-comment">// business logic that actually 'uses' the injected MovieFinder is omitted...</span>
}</pre><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-factory-ctor-arguments-resolution"></a>Constructor argument resolution</h5></div></div></div><p>Constructor argument resolution matching occurs using the
          argument's type. If no potential ambiguity exists in the constructor
          arguments of a bean definition, then the order in which the
          constructor arguments are defined in a bean definition is the order in
          which those arguments are supplied to the appropriate constructor when
          the bean is being instantiated. Consider the following class:</p><pre class="programlisting"><span class="hl-keyword">package</span> x.y;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Foo {

  <span class="hl-keyword">public</span> Foo(Bar bar, Baz baz) {
      <span class="hl-comment">// ...</span>
  }
}</pre><p>No potential ambiguity exists, assuming that
          <code class="classname">Bar</code> and <code class="classname">Baz</code> classes are
          not related by inheritance. Thus the following configuration works
          fine, and you do not need to specify the constructor argument indexes
          and/or types explicitly in the
          <code class="literal">&lt;constructor-arg/&gt;</code> element.</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Foo"</span>&gt;
      &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"bar"</span>/&gt;
      &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"baz"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bar"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Bar"</span>/&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"baz"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Baz"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>When another bean is referenced, the type is known, and matching
          can occur (as was the case with the preceding example). When a simple
          type is used, such as
          <code class="literal">&lt;value&gt;true&lt;value&gt;</code>, Spring cannot
          determine the type of the value, and so cannot match by type without
          help. Consider the following class:</p><pre class="programlisting"><span class="hl-keyword">package</span> examples;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

  <span class="hl-comment">// No. of years to the calculate the Ultimate Answer</span>
  <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> years;

  <span class="hl-comment">// The Answer to Life, the Universe, and Everything</span>
  <span class="hl-keyword">private</span> String ultimateAnswer;

  <span class="hl-keyword">public</span> ExampleBean(<span class="hl-keyword">int</span> years, String ultimateAnswer) {
      <span class="hl-keyword">this</span>.years = years;
      <span class="hl-keyword">this</span>.ultimateAnswer = ultimateAnswer;
  }
}</pre><div class="section" lang="en"><div class="titlepage"><div><div><h6 class="title"><a name="beans-factory-ctor-arguments-type"></a>Constructor argument type matching</h6></div></div></div><p>In the preceding scenario, the container
            <span class="emphasis"><em>can</em></span> use type matching with simple types if you
            explicitly specify the type of the constructor argument using the
            <code class="literal">type</code> attribute. For example:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span>&gt;
&lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">type</span>=<span class="hl-value">"int"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"7500000"</span>/&gt;
&lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">type</span>=<span class="hl-value">"java.lang.String"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"42"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h6 class="title"><a name="beans-factory-ctor-arguments-index"></a>Constructor argument index</h6></div></div></div><p>Use the <code class="literal">index</code> attribute to specify explicitly
            the index of constructor arguments. For example:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span>&gt;
&lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">index</span>=<span class="hl-value">"0"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"7500000"</span>/&gt;
&lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">index</span>=<span class="hl-value">"1"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"42"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>In addition to resolving the ambiguity of multiple simple
            values, specifying an index resolves ambiguity where a constructor
            has two arguments of the same type. Note that the <span class="emphasis"><em>index is
            0 based</em></span>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h6 class="title"><a name="beans-factory-ctor-arguments-name"></a>Constructor argument name</h6></div></div></div><p>As of Spring 3.0 you can also use the constructor parameter
          name for value disambiguation:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span>&gt;
&lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">name</span>=<span class="hl-value">"years"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"7500000"</span>/&gt;
&lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ultimateanswer"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"42"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Keep in mind that to make this work out of the box your code
          must be compiled with the debug flag enabled so that Spring can
          look up the parameter name from the constructor. If you can't compile
          your code with debug flag (or don't want to) you can use
          <code class="interfacename"><a class="ulink" href="http://download.oracle.com/javase/6/docs/api/java/beans/ConstructorProperties.html" target="_top">@ConstructorProperties</a></code>
          JDK annotation to explicitly name your constructor arguments. The
          sample class would then have to look as follows:</p><pre class="programlisting"><span class="hl-keyword">package</span> examples;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

  <span class="hl-comment">// Fields omitted</span>

  @ConstructorProperties({<span class="hl-string">"years"</span>, <span class="hl-string">"ultimateAnswer"</span>})
  <span class="hl-keyword">public</span> ExampleBean(<span class="hl-keyword">int</span> years, String ultimateAnswer) {
      <span class="hl-keyword">this</span>.years = years;
      <span class="hl-keyword">this</span>.ultimateAnswer = ultimateAnswer;
  }
}</pre></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-setter-injection"></a>4.4.1.2&nbsp;Setter-based dependency injection</h4></div></div></div><p><span class="emphasis"><em>Setter-based</em></span> DI is accomplished by the
        container calling setter methods on your beans after invoking a
        no-argument constructor or no-argument <code class="literal">static</code> factory
        method to instantiate your bean.</p><p>The following example shows a class that can only be
        dependency-injected using pure setter injection. This class is
        conventional Java. It is a POJO that has no dependencies on container
        specific interfaces, base classes or annotations.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

  <span class="hl-comment">// the SimpleMovieLister has a dependency on the MovieFinder</span>
  <span class="hl-keyword">private</span> MovieFinder movieFinder;

  <span class="hl-comment">// a setter method so that the Spring container can 'inject' a MovieFinder</span>
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
      <span class="hl-keyword">this</span>.movieFinder = movieFinder;
  }

  <span class="hl-comment">// business logic that actually 'uses' the injected MovieFinder is omitted...</span>
}</pre><p>The <code class="interfacename">ApplicationContext</code> supports
        constructor- and setter-based DI for the beans it manages. It also
        supports setter-based DI after some dependencies are already injected
        through the constructor approach. You configure the dependencies in the
        form of a <code class="interfacename">BeanDefinition</code>, which you use
        with <code class="interfacename">PropertyEditor</code> instances to convert
        properties from one format to another. However, most Spring users do not
        work with these classes directly (programmatically), but rather with an
        XML definition file that is then converted internally into instances of
        these classes, and used to load an entire Spring IoC container
        instance.</p><div class="sidebar"><p class="title"><b>Constructor-based or setter-based DI?</b></p><p>Since you can mix both, Constructor- and Setter-based DI, it is a
          good rule of thumb to use constructor arguments for mandatory
          dependencies and setters for optional dependencies. Note that the use
          of a <a class="link" href="#beans-required-annotation" title="4.9.1&nbsp;@Required">@Required</a>
          annotation on a setter can be used to make setters required
          dependencies.</p><p>The Spring team generally advocates setter injection, because
          large numbers of constructor arguments can get unwieldy, especially
          when properties are optional. Setter methods also make objects of that
          class amenable to reconfiguration or re-injection later. Management
          through <a class="link" href="#jmx" title="23.&nbsp;JMX">JMX MBeans</a> is a compelling use
          case.</p><p>Some purists favor constructor-based injection. Supplying all
          object dependencies means that the object is always returned to client
          (calling) code in a totally initialized state. The disadvantage is
          that the object becomes less amenable to reconfiguration and
          re-injection.</p><p>Use the DI that makes the most sense for a particular class.
          Sometimes, when dealing with third-party classes to which you do not
          have the source, the choice is made for you. A legacy class may not
          expose any setter methods, and so constructor injection is the only
          available DI.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2778"></a>4.4.1.3&nbsp;Dependency resolution process</h4></div></div></div><p>The container performs bean dependency resolution as follows:</p><div class="orderedlist"><ol type="1"><li><p>The <code class="interfacename">ApplicationContext</code> is created
            and initialized with configuration metadata that describes all the
            beans. Configuration metadata can be specified via XML, Java code or
            annotations.</p></li><li><p>For each bean, its dependencies are expressed in the form of
            properties, constructor arguments, or arguments to the
            static-factory method if you are using that instead of a normal
            constructor. These dependencies are provided to the bean,
            <span class="emphasis"><em>when the bean is actually created</em></span>.</p></li><li><p>Each property or constructor argument is an actual definition of
            the value to set, or a reference to another bean in the
            container.</p></li><li><p>Each property or constructor argument which is a value is
            converted from its specified format to the actual type of that
            property or constructor argument. By default Spring can convert a
            value supplied in string format to all built-in types, such as
            <code class="literal">int</code>, <code class="literal">long</code>,
            <code class="literal">String</code>, <code class="literal">boolean</code>, etc.</p></li></ol></div><p>The Spring container validates the configuration of each bean as the
        container is created, including the validation of whether bean reference
        properties refer to valid beans. However, the bean properties themselves
        are not set until the bean <span class="emphasis"><em>is actually created</em></span>.
        Beans that are singleton-scoped and set to be pre-instantiated (the
        default) are created when the container is created. Scopes are defined
        in <a class="xref" href="#beans-factory-scopes" title="4.5&nbsp;Bean scopes">Section&nbsp;4.5, &#8220;Bean scopes&#8221;</a> Otherwise, the bean is created
        only when it is requested. Creation of a bean potentially causes a graph
        of beans to be created, as the bean's dependencies and its dependencies'
        dependencies (and so on) are created and assigned.</p><div class="sidebar"><p class="title"><b>Circular dependencies</b></p><p>If you use predominantly constructor injection, it is possible to
          create an unresolvable circular dependency scenario.</p><p>For example: Class A requires an instance of class B through
          constructor injection, and class B requires an instance of class A
          through constructor injection. If you configure beans for classes A
          and B to be injected into each other, the Spring IoC container detects
          this circular reference at runtime, and throws a
          <code class="classname">BeanCurrentlyInCreationException</code>.</p><p>One possible solution is to edit the source code of some classes
          to be configured by setters rather than constructors. Alternatively,
          avoid constructor injection and use setter injection only. In other
          words, although it is not recommended, you can configure circular
          dependencies with setter injection.</p><p>Unlike the <span class="emphasis"><em>typical</em></span> case (with no circular
          dependencies), a circular dependency between bean A and bean B forces
          one of the beans to be injected into the other prior to being fully
          initialized itself (a classic chicken/egg scenario).</p></div><p>You can generally trust Spring to do the right thing. It detects
        configuration problems, such as references to non-existent beans and
        circular dependencies, at container load-time. Spring sets properties
        and resolves dependencies as late as possible, when the bean is actually
        created. This means that a Spring container which has loaded correctly
        can later generate an exception when you request an object if there is a
        problem creating that object or one of its dependencies. For example,
        the bean throws an exception as a result of a missing or invalid
        property. This potentially delayed visibility of some configuration
        issues is why <code class="interfacename">ApplicationContext</code>
        implementations by default pre-instantiate singleton beans. At the cost
        of some upfront time and memory to create these beans before they are
        actually needed, you discover configuration issues when the
        <code class="interfacename">ApplicationContext</code> is created, not later.
        You can still override this default behavior so that singleton beans
        will lazy-initialize, rather than be pre-instantiated.</p><p>If no circular dependencies exist, when one or more collaborating
        beans are being injected into a dependent bean, each collaborating bean
        is <span class="emphasis"><em>totally</em></span> configured prior to being injected into
        the dependent bean. This means that if bean A has a dependency on bean
        B, the Spring IoC container completely configures bean B prior to
        invoking the setter method on bean A. In other words, the bean is
        instantiated (if not a pre-instantiated singleton), its dependencies are
        set, and the relevant lifecycle methods (such as a <a class="link" href="#beans-factory-lifecycle-initializingbean" title="4.6.1.1&nbsp;Initialization callbacks">configured init
        method</a> or the <a class="link" href="#beans-factory-lifecycle-initializingbean" title="4.6.1.1&nbsp;Initialization callbacks">InitializingBean
        callback method</a>) are invoked.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-some-examples"></a>4.4.1.4&nbsp;Examples of dependency injection</h4></div></div></div><p>The following example uses XML-based configuration metadata for
        setter-based DI. A small part of a Spring XML configuration file
        specifies some bean definitions:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span>&gt;

&lt;<span class="hl-comment">!-- setter injection using the nested &lt;ref/&gt; element --</span>&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beanOne"</span>&gt;&lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"anotherExampleBean"</span>/&gt;&lt;<span class="hl-tag">/property</span>&gt;

&lt;<span class="hl-comment">!-- setter injection using the neater 'ref' attribute --</span>&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beanTwo"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"yetAnotherBean"</span>/&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"integerProperty"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anotherExampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.AnotherBean"</span>/&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"yetAnotherBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.YetAnotherBean"</span>/&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

  <span class="hl-keyword">private</span> AnotherBean beanOne;
  <span class="hl-keyword">private</span> YetAnotherBean beanTwo;
  <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> i;

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBeanOne(AnotherBean beanOne) {
      <span class="hl-keyword">this</span>.beanOne = beanOne;
  }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBeanTwo(YetAnotherBean beanTwo) {
      <span class="hl-keyword">this</span>.beanTwo = beanTwo;
  }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setIntegerProperty(<span class="hl-keyword">int</span> i) {
      <span class="hl-keyword">this</span>.i = i;
  }
}</pre><p>In the preceding example, setters are declared to match against the
        properties specified in the XML file. The following example uses
        constructor-based DI:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span>&gt;

&lt;<span class="hl-comment">!-- constructor injection using the nested &lt;ref/&gt; element --</span>&gt;
&lt;<span class="hl-tag">constructor-arg</span>&gt;
  &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"anotherExampleBean"</span>/&gt;
&lt;<span class="hl-tag">/constructor-arg</span>&gt;

&lt;<span class="hl-comment">!-- constructor injection using the neater 'ref' attribute --</span>&gt;
&lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"yetAnotherBean"</span>/&gt;

&lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">type</span>=<span class="hl-value">"int"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anotherExampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.AnotherBean"</span>/&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"yetAnotherBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.YetAnotherBean"</span>/&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

  <span class="hl-keyword">private</span> AnotherBean beanOne;
  <span class="hl-keyword">private</span> YetAnotherBean beanTwo;
  <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> i;

  <span class="hl-keyword">public</span> ExampleBean(
      AnotherBean anotherBean, YetAnotherBean yetAnotherBean, <span class="hl-keyword">int</span> i) {
      <span class="hl-keyword">this</span>.beanOne = anotherBean;
      <span class="hl-keyword">this</span>.beanTwo = yetAnotherBean;
      <span class="hl-keyword">this</span>.i = i;
  }
}</pre><p>The constructor arguments specified in the bean definition will be
        used as arguments to the constructor of the
        <code class="classname">ExampleBean</code>.</p><p>Now consider a variant of this example, where instead of using a
        constructor, Spring is told to call a <code class="literal">static</code> factory
        method to return an instance of the object:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span>
    <span class="hl-attribute">factory-method</span>=<span class="hl-value">"createInstance"</span>&gt;
&lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"anotherExampleBean"</span>/&gt;
&lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"yetAnotherBean"</span>/&gt;
&lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anotherExampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.AnotherBean"</span>/&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"yetAnotherBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.YetAnotherBean"</span>/&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

  <span class="hl-comment">// a private constructor</span>
  <span class="hl-keyword">private</span> ExampleBean(...) {
    ...
  }
  
  <span class="hl-comment">// a static factory method; the arguments to this method can be</span>
  <span class="hl-comment">// considered the dependencies of the bean that is returned,</span>
  <span class="hl-comment">// regardless of how those arguments are actually used.</span>
  <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> ExampleBean createInstance (
          AnotherBean anotherBean, YetAnotherBean yetAnotherBean, <span class="hl-keyword">int</span> i) {

      ExampleBean eb = <span class="hl-keyword">new</span> ExampleBean (...);
      <span class="hl-comment">// some other operations...</span>
      <span class="hl-keyword">return</span> eb;
  }
}</pre><p>Arguments to the <code class="literal">static</code> factory method are
        supplied via <code class="literal">&lt;constructor-arg/&gt;</code> elements,
        exactly the same as if a constructor had actually been used. The type of
        the class being returned by the factory method does not have to be of
        the same type as the class that contains the <code class="literal">static</code>
        factory method, although in this example it is. An instance (non-static)
        factory method would be used in an essentially identical fashion (aside
        from the use of the <code class="literal">factory-bean</code> attribute instead of
        the <code class="literal">class</code> attribute), so details will not be
        discussed here.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-properties-detailed"></a>4.4.2&nbsp;Dependencies and configuration in detail</h3></div></div></div><p>As mentioned in the previous section, you can define bean properties
      and constructor arguments as references to other managed beans
      (collaborators), or as values defined inline. Spring's XML-based
      configuration metadata supports sub-element types within its
      <code class="literal">&lt;property/&gt;</code> and
      <code class="literal">&lt;constructor-arg/&gt;</code> elements for this
      purpose.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-value-element"></a>4.4.2.1&nbsp;Straight values (primitives, <code class="literal">Strings</code>, and so
        on)</h4></div></div></div><p>The <code class="literal">value</code> attribute of the
        <code class="literal">&lt;property/&gt;</code> element specifies a property or
        constructor argument as a human-readable string representation. <a class="link" href="#beans-beans-conversion" title="6.4.2&nbsp;Built-in PropertyEditor implementations">As mentioned previously</a>,
        JavaBeans <code class="literal">PropertyEditors</code> are used to convert these
        string values from a <code class="classname">String</code> to the actual type of
        the property or argument.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myDataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>&gt;

&lt;<span class="hl-comment">!-- results in a setDriverClassName(String) call --</span>&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.mysql.jdbc.Driver"</span>/&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc:mysql://localhost:3306/mydb"</span>/&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"root"</span>/&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"masterkaoli"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The following example uses the <a class="link" href="#beans-p-namespace" title="4.4.2.6&nbsp;XML shortcut with the p-namespace">p-namespace</a> for even more succinct XML configuration.</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">"http://www.springframework.org/schema/p"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
     http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myDataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span>
      <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>
      <span class="hl-attribute">p:driverClassName</span>=<span class="hl-value">"com.mysql.jdbc.Driver"</span>
      <span class="hl-attribute">p:url</span>=<span class="hl-value">"jdbc:mysql://localhost:3306/mydb"</span>
      <span class="hl-attribute">p:username</span>=<span class="hl-value">"root"</span>
      <span class="hl-attribute">p:password</span>=<span class="hl-value">"masterkaoli"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;

</pre><p>The preceding XML is more succinct; however, typos are discovered at
        runtime rather than design time, unless you use an IDE such as <a class="ulink" href="http://www.jetbrains.com/idea/" target="_top">IntelliJ IDEA</a> or the <a class="ulink" href="http://www.springsource.com/products/sts" target="_top">SpringSource Tool
        Suite</a> (STS) that support automatic property completion when you
        create bean definitions. Such IDE assistance is highly
        recommended.</p><p>You can also configure a <code class="classname">java.util.Properties</code>
        instance as:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mappings"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;

 &lt;<span class="hl-comment">!-- typed as a java.util.Properties --</span>&gt;
 &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"properties"</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;
       jdbc.driver.className=com.mysql.jdbc.Driver
       jdbc.url=jdbc:mysql://localhost:3306/mydb
    &lt;<span class="hl-tag">/value</span>&gt;
 &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The Spring container converts the text inside the
        <code class="literal">&lt;value/&gt;</code> element into a
        <code class="classname">java.util.Properties</code> instance by using the
        JavaBeans <code class="interfacename">PropertyEditor</code> mechanism. This
        is a nice shortcut, and is one of a few places where the Spring team do
        favor the use of the nested <code class="literal">&lt;value/&gt;</code> element
        over the <code class="literal">value</code> attribute style.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-idref-element"></a>The <code class="literal">idref</code> element</h5></div></div></div><p>The <code class="literal">idref</code> element is simply an error-proof way
          to pass the <span class="emphasis"><em>id</em></span> (string value - not a reference)
          of another bean in the container to a
          <code class="literal">&lt;constructor-arg/&gt;</code> or
          <code class="literal">&lt;property/&gt;</code> element.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"theTargetBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"theClientBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetName"</span>&gt;
      &lt;<span class="hl-tag">idref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"theTargetBean"</span> /&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The above bean definition snippet is <span class="emphasis"><em>exactly</em></span>
          equivalent (at runtime) to the following snippet:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"theTargetBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span> /&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"client"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"theTargetBean"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The first form is preferable to the second, because using the
          <code class="literal">idref</code> tag allows the container to validate
          <span class="emphasis"><em>at deployment time</em></span> that the referenced, named
          bean actually exists. In the second variation, no validation is
          performed on the value that is passed to the
          <code class="literal">targetName</code> property of the
          <code class="literal">client</code> bean. Typos are only discovered (with most
          likely fatal results) when the <code class="literal">client</code> bean is
          actually instantiated. If the <code class="literal">client</code> bean is a
          <a class="link" href="#beans-factory-scopes" title="4.5&nbsp;Bean scopes">prototype</a> bean, this typo
          and the resulting exception may only be discovered long after the
          container is deployed.</p><p>Additionally, if the referenced bean is in the same XML unit, and
          the bean name is the bean <span class="emphasis"><em>id</em></span>, you can use the
          <code class="literal">local</code> attribute, which allows the XML parser itself
          to validate the bean id earlier, at XML document parse time.</p><pre class="programlisting">&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetName"</span>&gt;
 &lt;<span class="hl-comment">!-- a bean with id 'theTargetBean' must exist; otherwise an exception will be thrown --</span>&gt;
 &lt;<span class="hl-tag">idref</span> <span class="hl-attribute">local</span>=<span class="hl-value">"theTargetBean"</span>/&gt;
&lt;<span class="hl-tag">/property</span>&gt;</pre><p>A common place (at least in versions earlier than Spring 2.0)
          where the &lt;idref/&gt; element brings value is in the configuration
          of <a class="link" href="#aop-pfb-1" title="9.5.1&nbsp;Basics">AOP interceptors</a> in a
          <code class="classname">ProxyFactoryBean</code> bean definition. Using
          &lt;idref/&gt; elements when you specify the interceptor names
          prevents you from misspelling an interceptor id.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-ref-element"></a>4.4.2.2&nbsp;References to other beans (collaborators)</h4></div></div></div><p>The <code class="literal">ref</code> element is the final element inside a
        <code class="literal">&lt;constructor-arg/&gt;</code> or
        <code class="literal">&lt;property/&gt;</code> definition element. Here you set
        the value of the specified property of a bean to be a reference to
        another bean (a collaborator) managed by the container. The referenced
        bean is a dependency of the bean whose property will be set, and it is
        initialized on demand as needed before the property is set. (If the
        collaborator is a singleton bean, it may be initialized already by the
        container.) All references are ultimately a reference to another object.
        Scoping and validation depend on whether you specify the id/name of the
        other object through the
        <code class="literal">bean,<code class="literal">local,</code></code> or
        <code class="literal">parent</code> attributes.</p><p>Specifying the target bean through the <code class="literal">bean</code>
        attribute of the <code class="literal">&lt;ref/&gt;</code> tag is the most general
        form, and allows creation of a reference to any bean in the same
        container or parent container, regardless of whether it is in the same
        XML file. The value of the <code class="literal">bean</code> attribute may be the
        same as the <code class="literal">id</code> attribute of the target bean, or as
        one of the values in the <code class="literal">name</code> attribute of the target
        bean.</p><pre class="programlisting">&lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"someBean"</span>/&gt;</pre><p>Specifying the target bean through the <code class="literal">local</code>
        attribute leverages the ability of the XML parser to validate XML id
        references within the same file. The value of the
        <code class="literal">local</code> attribute must be the same as the
        <code class="literal">id</code> attribute of the target bean. The XML parser
        issues an error if no matching element is found in the same file. As
        such, using the local variant is the best choice (in order to know about
        errors as early as possible) if the target bean is in the same XML
        file.</p><pre class="programlisting">&lt;<span class="hl-tag">ref</span> <span class="hl-attribute">local</span>=<span class="hl-value">"someBean"</span>/&gt;</pre><p>Specifying the target bean through the <code class="literal">parent</code>
        attribute creates a reference to a bean that is in a parent container of
        the current container. The value of the <code class="literal">parent</code>
        attribute may be the same as either the <code class="literal">id</code> attribute
        of the target bean, or one of the values in the <code class="literal">name</code>
        attribute of the target bean, and the target bean must be in a parent
        container of the current one. You use this bean reference variant mainly
        when you have a hierarchy of containers and you want to wrap an existing
        bean in a parent container with a proxy that will have the same name as
        the parent bean.</p><pre class="programlisting">&lt;<span class="hl-comment">!-- in the parent context --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.SimpleAccountService"</span>&gt;
  &lt;<span class="hl-comment">!-- insert dependencies as required as here --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><pre class="programlisting">&lt;<span class="hl-comment">!-- in the child (descendant) context --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span>  <span class="hl-attribute">&lt;--</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">name</span> <span class="hl-attribute">is</span> <span class="hl-attribute">the</span> <span class="hl-attribute">same</span> <span class="hl-attribute">as</span> <span class="hl-attribute">the</span> <span class="hl-attribute">parent</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">--&gt;</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span>&gt;
        &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"accountService"</span>/&gt;  &lt;<span class="hl-comment">!-- notice how we refer to the parent bean --</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-comment">!-- insert other configuration and dependencies as required here --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-inner-beans"></a>4.4.2.3&nbsp;Inner beans</h4></div></div></div><p>A <code class="literal">&lt;bean/&gt;</code> element inside the
        <code class="literal">&lt;property/&gt;</code> or
        <code class="literal">&lt;constructor-arg/&gt;</code> elements defines a so-called
        <em class="firstterm">inner bean</em>.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"outer"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>&gt;
&lt;<span class="hl-comment">!-- instead of using a reference to a target bean, simply define the target bean inline --</span>&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.Person"</span>&gt; &lt;<span class="hl-comment">!-- this is the inner bean --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Fiona Apple"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"25"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>An inner bean definition does not require a defined id or name; the
        container ignores these values. It also ignores the
        <code class="literal">scope</code> flag. Inner beans are
        <span class="emphasis"><em>always</em></span> anonymous and they are
        <span class="emphasis"><em>always</em></span> scoped as <a class="link" href="#beans-factory-scopes-prototype" title="4.5.2&nbsp;The prototype scope">prototypes</a>. It is
        <span class="emphasis"><em>not</em></span> possible to inject inner beans into
        collaborating beans other than into the enclosing bean.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-collection-elements"></a>4.4.2.4&nbsp;Collections</h4></div></div></div><p>In the <code class="literal">&lt;list/&gt;</code>,
        <code class="literal">&lt;set/&gt;</code>, <code class="literal">&lt;map/&gt;</code>, and
        <code class="literal">&lt;props/&gt;</code> elements, you set the properties and
        arguments of the Java <code class="interfacename">Collection</code> types
        <code class="interfacename">List</code>, <code class="interfacename">Set</code>,
        <code class="interfacename">Map</code>, and
        <code class="interfacename">Properties</code>, respectively.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"moreComplexObject"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.ComplexObject"</span>&gt;
&lt;<span class="hl-comment">!-- results in a setAdminEmails(java.util.Properties) call --</span>&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"adminEmails"</span>&gt;
  &lt;<span class="hl-tag">props</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"administrator"</span>&gt;administrator@example.org&lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"support"</span>&gt;support@example.org&lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"development"</span>&gt;development@example.org&lt;<span class="hl-tag">/prop</span>&gt;
  &lt;<span class="hl-tag">/props</span>&gt;
&lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-comment">!-- results in a setSomeList(java.util.List) call --</span>&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someList"</span>&gt;
  &lt;<span class="hl-tag">list</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;a list element followed by a reference&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"myDataSource"</span> /&gt;
  &lt;<span class="hl-tag">/list</span>&gt;
&lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-comment">!-- results in a setSomeMap(java.util.Map) call --</span>&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someMap"</span>&gt;
  &lt;<span class="hl-tag">map</span>&gt;
      &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"an entry"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"just some string"</span>/&gt;
      &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span> =<span class="hl-value">"a ref"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"myDataSource"</span>/&gt;
  &lt;<span class="hl-tag">/map</span>&gt;
&lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-comment">!-- results in a setSomeSet(java.util.Set) call --</span>&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someSet"</span>&gt;
  &lt;<span class="hl-tag">set</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;just some string&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"myDataSource"</span> /&gt;
  &lt;<span class="hl-tag">/set</span>&gt;
&lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p><span class="emphasis"><em>The value of a map key or value, or a set value, can also
        again be any of the following elements:</em></span></p><pre class="programlisting">bean | ref | idref | list | set | map | props | value | null</pre><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-collection-elements-merging"></a>Collection merging</h5></div></div></div><p>As of Spring 2.0, the container supports the
          <span class="emphasis"><em>merging</em></span> of collections. An application developer
          can define a parent-style <code class="literal">&lt;list/&gt;</code>,
          <code class="literal">&lt;map/&gt;</code>, <code class="literal">&lt;set/&gt;</code> or
          <code class="literal">&lt;props/&gt;</code> element, and have child-style
          <code class="literal">&lt;list/&gt;</code>, <code class="literal">&lt;map/&gt;</code>,
          <code class="literal">&lt;set/&gt;</code> or <code class="literal">&lt;props/&gt;</code>
          elements inherit and override values from the parent collection. That
          is, the child collection's values are the result of merging the
          elements of the parent and child collections, with the child's
          collection elements overriding values specified in the parent
          collection.</p><p><span class="emphasis"><em>This section on merging discusses the parent-child bean
          mechanism. Readers unfamiliar with parent and child bean definitions
          may wish to read the <a class="link" href="#beans-child-bean-definitions" title="4.7&nbsp;Bean definition inheritance">relevant section</a> before continuing.</em></span></p><p>The following example demonstrates collection merging:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"parent"</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.ComplexObject"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"adminEmails"</span>&gt;
      &lt;<span class="hl-tag">props</span>&gt;
          &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"administrator"</span>&gt;administrator@example.com&lt;<span class="hl-tag">/prop</span>&gt;
          &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"support"</span>&gt;support@example.com&lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">/props</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"child"</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"parent"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"adminEmails"</span>&gt;
      &lt;<span class="hl-comment">!-- the merge is specified on the *child* collection definition --</span>&gt;
      &lt;<span class="hl-tag">props</span> <span class="hl-attribute">merge</span>=<span class="hl-value">"true"</span>&gt;
          &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"sales"</span>&gt;sales@example.com&lt;<span class="hl-tag">/prop</span>&gt;
          &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"support"</span>&gt;support@example.co.uk&lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">/props</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">beans</span>&gt;</pre><p>Notice the use of the <code class="literal">merge=true</code> attribute on
          the <code class="literal">&lt;props/&gt;</code> element of the
          <code class="literal">adminEmails</code> property of the
          <code class="literal">child</code> bean definition. When the
          <code class="literal">child</code> bean is resolved and instantiated by the
          container, the resulting instance has an
          <code class="literal">adminEmails</code> <code class="classname">Properties</code>
          collection that contains the result of the merging of the child's
          <code class="literal">adminEmails</code> collection with the parent's
          <code class="literal">adminEmails</code> collection.</p><pre class="programlisting">administrator=administrator@example.com
sales=sales@example.com
support=support@example.co.uk</pre><p>The child <code class="classname">Properties</code> collection's value set
          inherits all property elements from the parent
          <code class="literal">&lt;props/&gt;</code>, and the child's value for the
          <code class="literal">support</code> value overrides the value in the parent
          collection.</p><p>This merging behavior applies similarly to the
          <code class="literal">&lt;list/&gt;</code>, <code class="literal">&lt;map/&gt;</code>, and
          <code class="literal">&lt;set/&gt;</code> collection types. In the specific case
          of the <code class="literal">&lt;list/&gt;</code> element, the semantics
          associated with the <code class="classname">List</code> collection type, that
          is, the notion of an <code class="literal">ordered</code> collection of values,
          is maintained; the parent's values precede all of the child list's
          values. In the case of the <code class="interfacename">Map</code>,
          <code class="interfacename">Set</code>, and
          <code class="interfacename">Properties</code> collection types, no
          ordering exists. Hence no ordering semantics are in effect for the
          collection types that underlie the associated
          <code class="interfacename">Map</code>,
          <code class="interfacename">Set</code>, and
          <code class="interfacename">Properties</code> implementation types that
          the container uses internally.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="d0e3409"></a>Limitations of collection merging</h5></div></div></div><p>You cannot merge different collection types (such as a
          <code class="interfacename">Map</code> and a
          <code class="interfacename">List</code>), and if you do attempt to do so
          an appropriate <code class="classname">Exception</code> is thrown. The
          <code class="literal">merge</code> attribute must be specified on the lower,
          inherited, child definition; specifying the <code class="literal">merge</code>
          attribute on a parent collection definition is redundant and will not
          result in the desired merging. The merging feature is available only
          in Spring 2.0 and later.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-collection-elements-strongly-typed"></a>Strongly-typed collection (Java 5+ only)</h5></div></div></div><p>In Java 5 and later, you can use strongly typed collections (using
          generic types). That is, it is possible to declare a
          <code class="interfacename">Collection</code> type such that it can only
          contain <code class="classname">String</code> elements (for example). If you
          are using Spring to dependency-inject a strongly-typed
          <code class="interfacename">Collection</code> into a bean, you can take
          advantage of Spring's type-conversion support such that the elements
          of your strongly-typed <code class="interfacename">Collection</code>
          instances are converted to the appropriate type prior to being added
          to the <code class="interfacename">Collection</code>.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Foo {

  <span class="hl-keyword">private</span> Map&lt;String, Float&gt; accounts;

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAccounts(Map&lt;String, Float&gt; accounts) {
      <span class="hl-keyword">this</span>.accounts = accounts;
  }
}</pre><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Foo"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accounts"</span>&gt;
          &lt;<span class="hl-tag">map</span>&gt;
              &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"one"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"9.99"</span>/&gt;
              &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"two"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"2.75"</span>/&gt;
              &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"six"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"3.99"</span>/&gt;
          &lt;<span class="hl-tag">/map</span>&gt;
      &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>When the <code class="literal">accounts</code> property of the
          <code class="literal">foo</code> bean is prepared for injection, the generics
          information about the element type of the strongly-typed
          <code class="classname">Map&lt;String, Float&gt;</code> is available by
          reflection. Thus Spring's type conversion infrastructure recognizes
          the various value elements as being of type
          <code class="classname">Float</code>, and the string values <code class="literal">9.99,
          2.75</code>, and <code class="literal">3.99</code> are converted into an
          actual <code class="classname">Float</code> type.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-null-element"></a>4.4.2.5&nbsp;Null and empty string values</h4></div></div></div><p>Spring
        treats empty arguments for properties and the like as empty
        <code class="literal">Strings</code>. The following XML-based configuration
        metadata snippet sets the email property to the empty
        <code class="classname">String</code> value ("")</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ExampleBean"</span>&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"email"</span> <span class="hl-attribute">value</span>=<span class="hl-value">""</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The preceding example is equivalent to the following Java code:
        <code class="methodname">exampleBean.setEmail("")</code>. The
        <code class="literal">&lt;null/&gt;</code> element handles <code class="literal">null</code>
        values. For example:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ExampleBean"</span>&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"email"</span>&gt;&lt;<span class="hl-tag">null</span>/&gt;&lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The above configuration is equivalent to the following Java code:
        <code class="methodname">exampleBean.setEmail(null)</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-p-namespace"></a>4.4.2.6&nbsp;XML shortcut with the p-namespace</h4></div></div></div><p>The p-namespace enables you to use the <code class="literal">bean</code>
        element's attributes, instead of nested
        <code class="literal">&lt;property/&gt;</code> elements, to describe your property
        values and/or collaborating beans.</p><p>Spring 2.0 and later supports extensible configuration formats <a class="link" href="#xsd-config" title="Appendix&nbsp;C.&nbsp;XML Schema-based configuration">with namespaces</a>, which are based on an XML
        Schema definition. The <code class="literal">beans</code> configuration format
        discussed in this chapter is defined in an XML Schema document. However,
        the p-namespace is not defined in an XSD file and exists only in the
        core of Spring.</p><p>The following example shows two XML snippets that resolve to the
        same result: The first uses standard XML format and the second uses the
        p-namespace.</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">"http://www.springframework.org/schema/p"</span>
  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"classic"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.ExampleBean"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"email"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"foo@bar.com"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"p-namespace"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.ExampleBean"</span>
        <span class="hl-attribute">p:email</span>=<span class="hl-value">"foo@bar.com"</span>/&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The example shows an attribute in the p-namespace called email in
        the bean definition. This tells Spring to include a property
        declaration. As previously mentioned, the p-namespace does not have a
        schema definition, so you can set the name of the attribute to the
        property name.</p><p>This next example includes two more bean definitions that both have
        a reference to another bean:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">"http://www.springframework.org/schema/p"</span>
  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"john-classic"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.Person"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"John Doe"</span>/&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"spouse"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"jane"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"john-modern"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.Person"</span>
      <span class="hl-attribute">p:name</span>=<span class="hl-value">"John Doe"</span>
      <span class="hl-attribute">p:spouse-ref</span>=<span class="hl-value">"jane"</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jane"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.Person"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Jane Doe"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>As you can see, this example includes not only a property value
        using the p-namespace, but also uses a special format to declare
        property references. Whereas the first bean definition uses
        <code class="literal">&lt;property name="spouse" ref="jane"/&gt;</code> to create
        a reference from bean <code class="literal">john</code> to bean
        <code class="literal">jane</code>, the second bean definition uses
        <code class="literal">p:spouse-ref="jane"</code> as an attribute to do the exact
        same thing. In this case <code class="literal">spouse</code> is the property name,
        whereas the <code class="literal">-ref</code> part indicates that this is not a
        straight value but rather a reference to another bean.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The p-namespace is not as flexible as the standard XML format. For
          example, the format for declaring property references clashes with
          properties that end in <code class="literal">Ref</code>, whereas the standard
          XML format does not. We recommend that you choose your approach
          carefully and communicate this to your team members, to avoid
          producing XML documents that use all three approaches at the same
          time.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-c-namespace"></a>4.4.2.7&nbsp;XML shortcut with the c-namespace</h4></div></div></div><p>Similar to the <a class="xref" href="#beans-p-namespace" title="4.4.2.6&nbsp;XML shortcut with the p-namespace">Section&nbsp;4.4.2.6, &#8220;XML shortcut with the p-namespace&#8221;</a>, the <span class="emphasis"><em>c-namespace</em></span>, newly introduced in Spring 3.1, 
      allows usage of inlined attributes for configuring the constructor arguments rather then nested <code class="literal">constructor-arg</code>
      elements.</p><p>Let's review the examples from <a class="xref" href="#beans-constructor-injection" title="4.4.1.1&nbsp;Constructor-based dependency injection">Section&nbsp;4.4.1.1, &#8220;Constructor-based dependency injection&#8221;</a> with the <code class="literal">c</code> namespace:</p><pre class="programlisting">&lt;beans xmlns=<span class="hl-string">"http://www.springframework.org/schema/beans"</span>
  xmlns:xsi=<span class="hl-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
  xmlns:c=<span class="hl-string">"http://www.springframework.org/schema/c"</span>
  xsi:schemaLocation=<span class="hl-string">"http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;
      
  &lt;bean id=<span class="hl-string">"bar"</span> <span class="hl-keyword">class</span>=<span class="hl-string">"x.y.Bar"</span>/&gt;
  &lt;bean id=<span class="hl-string">"baz"</span> <span class="hl-keyword">class</span>=<span class="hl-string">"x.y.Baz"</span>/&gt;

  &lt;-- <span class="hl-string">'traditional'</span> declaration --&gt;      
  &lt;bean id=<span class="hl-string">"foo"</span> <span class="hl-keyword">class</span>=<span class="hl-string">"x.y.Foo"</span>&gt;
      &lt;constructor-arg ref=<span class="hl-string">"bar"</span>/&gt;
      &lt;constructor-arg ref=<span class="hl-string">"baz"</span>/&gt;
      &lt;constructor-arg value=<span class="hl-string">"foo@bar.com"</span>/&gt;
  &lt;/bean&gt;

  &lt;-- <span class="hl-string">'c-namespace'</span> declaration --&gt;
  &lt;bean id=<span class="hl-string">"foo"</span> <span class="hl-keyword">class</span>=<span class="hl-string">"x.y.Foo"</span> c:bar-ref=<span class="hl-string">"bar"</span> c:baz-ref=<span class="hl-string">"baz"</span> c:email=<span class="hl-string">"foo@bar.com"</span>&gt;

&lt;/beans&gt;</pre><p>The <code class="literal">c:</code> namespace uses the same conventions as the <code class="literal">p:</code> one (trailing <code class="literal">-ref</code> for bean references)
	  for setting the constructor arguments by their names. And just as well, it needs to be declared even though it is not defined in an XSD schema
	  (but it exists inside the Spring core).</p><p>For the rare cases where the constructor argument names are not available (usually if the bytecode was compiled without debugging information), one can
	  use fallback to the argument indexes:</p><pre class="programlisting">&lt;-- <span class="hl-string">'c-namespace'</span> index declaration --&gt;
&lt;bean id=<span class="hl-string">"foo"</span> <span class="hl-keyword">class</span>=<span class="hl-string">"x.y.Foo"</span> c:_0-ref=<span class="hl-string">"bar"</span> c:_1-ref=<span class="hl-string">"baz"</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">Due to the XML grammar, the index notation requires the presence of the leading <span class="emphasis"><em>_</em></span> as XML attribute names cannot start
      with a number (even though some IDE allow it).</td></tr></table></div><p>In practice, the constructor resolution <a class="link" href="#beans-factory-ctor-arguments-resolution" title="Constructor argument resolution">mechanism</a> is quite efficient in matching arguments so 
	  unless one really needs to, we recommend using the name notation through-out your configuration.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-compound-property-names"></a>4.4.2.8&nbsp;Compound property names</h4></div></div></div><p>You can use compound or nested property names when you set bean
        properties, as long as all components of the path except the final
        property name are not <code class="literal">null</code>. Consider the following
        bean definition.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"foo.Bar"</span>&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"fred.bob.sammy"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"123"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The <code class="literal">foo</code> bean has a <code class="literal">fred</code>
        property, which has a <code class="literal">bob</code> property, which has a
        <code class="literal">sammy</code> property, and that final
        <code class="literal">sammy</code> property is being set to the value
        <code class="literal">123</code>. In order for this to work, the
        <code class="literal">fred</code> property of <code class="literal">foo</code>, and the
        <code class="literal">bob</code> property of <code class="literal">fred</code> must not be
        <code class="literal">null</code> after the bean is constructed, or a
        <code class="exceptionname">NullPointerException</code> is thrown.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-dependson"></a>4.4.3&nbsp;Using <code class="literal">depends-on</code></h3></div></div></div><p>If a bean is a dependency of another that usually means that one bean
      is set as a property of another. Typically you accomplish this with the
      <a class="link" href="#beans-ref-element" title="4.4.2.2&nbsp;References to other beans (collaborators)"><code class="literal">&lt;ref/&gt;</code>
      element</a> in XML-based configuration metadata. However, sometimes
      dependencies between beans are less direct; for example, a static
      initializer in a class needs to be triggered, such as database driver
      registration. The <code class="literal">depends-on</code> attribute can explicitly
      force one or more beans to be initialized before the bean using this
      element is initialized. The following example uses the
      <code class="literal">depends-on</code> attribute to express a dependency on a
      single bean:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"beanOne"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ExampleBean"</span> <span class="hl-attribute">depends-on</span>=<span class="hl-value">"manager"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"manager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ManagerBean"</span> /&gt;</pre><p>To express a dependency on multiple beans, supply a list of bean names
      as the value of the <code class="literal">depends-on</code> attribute, with commas,
      whitespace and semicolons, used as valid delimiters:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"beanOne"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ExampleBean"</span> <span class="hl-attribute">depends-on</span>=<span class="hl-value">"manager,accountDao"</span>&gt;
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"manager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"manager"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"manager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ManagerBean"</span> /&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.jdbc.JdbcAccountDao"</span> /&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">depends-on</code> attribute in the bean definition
        can specify both an initialization time dependency and, in the case of
        <a class="link" href="#beans-factory-scopes-singleton" title="4.5.1&nbsp;The singleton scope">singleton</a> beans
        only, a corresponding destroy time dependency. Dependent beans that
        define a <code class="literal">depends-on</code> relationship with a given bean
        are destroyed first, prior to the given bean itself being destroyed.
        Thus <code class="literal">depends-on</code> can also control shutdown
        order.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-lazy-init"></a>4.4.4&nbsp;Lazy-initialized
      beans</h3></div></div></div><p>By default,<code class="interfacename"> ApplicationContext</code>
      implementations eagerly create and configure all <a class="link" href="#beans-factory-scopes-singleton" title="4.5.1&nbsp;The singleton scope">singleton</a> beans as part of
      the initialization process. Generally, this pre-instantiation is
      desirable, because errors in the configuration or surrounding environment
      are discovered immediately, as opposed to hours or even days later. When
      this behavior is <span class="emphasis"><em>not</em></span> desirable, you can prevent
      pre-instantiation of a singleton bean by marking the bean definition as
      lazy-initialized. A lazy-initialized bean tells the IoC container to
      create a bean instance when it is first requested, rather than at
      startup.</p><p>In XML, this behavior is controlled by the
      <code class="literal">lazy-init</code> attribute on the
      <code class="literal">&lt;bean/&gt;</code> element; for example:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"lazy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.ExpensiveToCreateBean"</span> <span class="hl-attribute">lazy-init</span>=<span class="hl-value">"true"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"not.lazy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.AnotherBean"</span>/&gt;</pre><p>When the preceding configuration is consumed by an
      <code class="interfacename">ApplicationContext</code>, the bean named
      <code class="literal">lazy</code> is not eagerly pre-instantiated when the
      <code class="interfacename">ApplicationContext</code> is starting up, whereas
      the <code class="literal">not.lazy</code> bean is eagerly pre-instantiated.</p><p>However, when a lazy-initialized bean is a dependency of a singleton
      bean that is <span class="emphasis"><em>not</em></span> lazy-initialized, the
      <code class="interfacename">ApplicationContext</code> creates the
      lazy-initialized bean at startup, because it must satisfy the singleton's
      dependencies. The lazy-initialized bean is injected into a singleton bean
      elsewhere that is not lazy-initialized.</p><p>You can also control lazy-initialization at the container level by
      using the <code class="literal">default-lazy-init</code> attribute on the
      <code class="literal">&lt;beans/&gt;</code> element; for example:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">default-lazy-init</span>=<span class="hl-value">"true"</span>&gt;
  &lt;<span class="hl-comment">!-- no beans will be pre-instantiated... --</span>&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-autowire"></a>4.4.5&nbsp;Autowiring collaborators</h3></div></div></div><p>The Spring container can <span class="emphasis"><em>autowire</em></span> relationships
      between collaborating beans. You can allow Spring to resolve collaborators
      (other beans) automatically for your bean by inspecting the contents of
      the <code class="interfacename">ApplicationContext</code>. Autowiring has the
      following advantages:</p><div class="itemizedlist"><ul type="disc"><li><p>Autowiring can significantly reduce the need to specify properties
          or constructor arguments. (Other mechanisms such as a bean template
          <a class="link" href="#beans-child-bean-definitions" title="4.7&nbsp;Bean definition inheritance">discussed elsewhere in
          this chapter</a> are also valuable in this regard.)</p></li><li><p>Autowiring can update a configuration as your objects evolve. For
          example, if you need to add a dependency to a class, that dependency
          can be satisfied automatically without you needing to modify the
          configuration. Thus autowiring can be especially useful during
          development, without negating the option of switching to explicit
          wiring when the code base becomes more stable.</p></li></ul></div><p> When using XML-based configuration metadata<sup>[<a name="d0e3795" href="#ftn.d0e3795" class="footnote">2</a>]</sup>, you specify autowire mode for a bean definition with the
      <code class="literal">autowire</code> attribute of the
      <code class="literal">&lt;bean/&gt;</code> element. The autowiring functionality has
      five modes. You specify autowiring <span class="emphasis"><em>per</em></span> bean and thus
      can choose which ones to autowire.</p><div class="table"><a name="beans-factory-autowiring-modes-tbl"></a><p class="title"><b>Table&nbsp;4.2.&nbsp;Autowiring modes</b></p><div class="table-contents"><table summary="Autowiring modes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Mode</th><th style="border-bottom: 1.0pt solid ; ">Explanation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">no</td><td style="border-bottom: 1.0pt solid ; "><p>(Default) No autowiring. Bean references must be
              defined via a <code class="literal">ref</code> element. Changing the default
              setting is not recommended for larger deployments, because
              specifying collaborators explicitly gives greater control and
              clarity. To some extent, it documents the structure of a
              system.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">byName</td><td style="border-bottom: 1.0pt solid ; "><p>Autowiring by property name. Spring looks for a bean
              with the same name as the property that needs to be autowired. For
              example, if a bean definition is set to autowire by name, and it
              contains a <span class="emphasis"><em>master</em></span> property (that is, it has a
              <span class="emphasis"><em>setMaster(..)</em></span> method), Spring looks for a
              bean definition named <code class="literal">master</code>, and uses it to
              set the property.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">byType</td><td style="border-bottom: 1.0pt solid ; "><p>Allows a property to be autowired if exactly one bean
              of the property type exists in the container. If more than one
              exists, a fatal exception is thrown, which indicates that you may
              not use <span class="emphasis"><em>byType</em></span> autowiring for that bean. If
              there are no matching beans, nothing happens; the property is not
              set.</p></td></tr><tr><td style="border-right: 1.0pt solid ; ">constructor</td><td style=""><p>Analogous to <span class="emphasis"><em>byType</em></span>, but applies
              to constructor arguments. If there is not exactly one bean of the
              constructor argument type in the container, a fatal error is
              raised.</p></td></tr></tbody></table></div></div><br class="table-break"><p>With <span class="emphasis"><em>byType</em></span> or <span class="emphasis"><em>constructor</em></span>
      autowiring mode, you can wire arrays and typed-collections. In such cases
      <span class="emphasis"><em>all</em></span> autowire candidates within the container that
      match the expected type are provided to satisfy the dependency. You can
      autowire strongly-typed Maps if the expected key type is
      <code class="classname">String</code>. An autowired Maps values will consist of
      all bean instances that match the expected type, and the Maps keys will
      contain the corresponding bean names.</p><p>You can combine autowire behavior with dependency checking, which is
      performed after autowiring completes.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-autowired-exceptions"></a>4.4.5.1&nbsp;Limitations and disadvantages of autowiring</h4></div></div></div><p>Autowiring works best when it is used consistently across a project.
        If autowiring is not used in general, it might be confusing to
        developers to use it to wire only one or two bean definitions.</p><p>Consider the limitations and disadvantages of autowiring:</p><div class="itemizedlist"><ul type="disc"><li><p>Explicit dependencies in <code class="literal">property</code> and
            <code class="literal">constructor-arg</code> settings always override
            autowiring. You cannot autowire so-called
            <span class="emphasis"><em>simple</em></span> properties such as primitives,
            <code class="classname">Strings</code>, and <code class="classname">Classes</code>
            (and arrays of such simple properties). This limitation is
            by-design.</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>Autowiring is less exact than explicit wiring. Although, as
            noted in the above table, Spring is careful to avoid guessing in
            case of ambiguity that might have unexpected results, the
            relationships between your Spring-managed objects are no longer
            documented explicitly.</p></li><li><p>Wiring information may not be available to tools that may
            generate documentation from a Spring container.</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>Multiple bean definitions within the container may match the
            type specified by the setter method or constructor argument to be
            autowired. For arrays, collections, or Maps, this is not necessarily
            a problem. However for dependencies that expect a single value, this
            ambiguity is not arbitrarily resolved. If no unique bean definition
            is available, an exception is thrown.</p></li></ul></div><p>In the latter scenario, you have several options:</p><div class="itemizedlist"><ul type="disc"><li><p>Abandon autowiring in favor of explicit wiring.</p></li><li><p>Avoid autowiring for a bean definition by setting its
            <code class="literal">autowire-candidate</code> attributes to
            <code class="literal">false</code> as described in the next section.</p></li><li><p>Designate a single bean definition as the
            <span class="emphasis"><em>primary</em></span> candidate by setting the
            <code class="literal">primary</code> attribute of its
            <code class="literal">&lt;bean/&gt;</code> element to
            <code class="literal">true</code>.</p></li><li><p>If you are using Java 5 or later, implement the more
            fine-grained control available with annotation-based configuration,
            as described in <a class="xref" href="#beans-annotation-config" title="4.9&nbsp;Annotation-based container configuration">Section&nbsp;4.9, &#8220;Annotation-based container configuration&#8221;</a>.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-autowire-candidate"></a>4.4.5.2&nbsp;Excluding a bean from autowiring</h4></div></div></div><p>On a per-bean basis, you can exclude a bean from autowiring. In
        Spring's XML format, set the <code class="literal">autowire-candidate</code>
        attribute of the <code class="literal">&lt;bean/&gt;</code> element to
        <code class="literal">false</code>; the container makes that specific bean
        definition unavailable to the autowiring infrastructure (including
        annotation style configurations such as <a class="link" href="#beans-autowired-annotation" title="4.9.2&nbsp;@Autowired"><code class="interfacename">@Autowired</code></a>).</p><p>You can also limit autowire candidates based on pattern-matching
        against bean names. The top-level <code class="literal">&lt;beans/&gt;</code>
        element accepts one or more patterns within its
        <code class="literal">default-autowire-candidates</code> attribute. For example,
        to limit autowire candidate status to any bean whose name ends with
        <span class="emphasis"><em>Repository,</em></span> provide a value of *Repository. To
        provide multiple patterns, define them in a comma-separated list. An
        explicit value of <code class="literal">true</code> or <code class="literal">false</code>
        for a bean definitions <code class="literal">autowire-candidate</code> attribute
        always takes precedence, and for such beans, the pattern matching rules
        do not apply.</p><p>These techniques are useful for beans that you never want to be
        injected into other beans by autowiring. It does not mean that an
        excluded bean cannot itself be configured using autowiring. Rather, the
        bean itself is not a candidate for autowiring other beans.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-method-injection"></a>4.4.6&nbsp;Method injection</h3></div></div></div><p>In most application scenarios, most beans in the container are <a class="link" href="#beans-factory-scopes-singleton" title="4.5.1&nbsp;The singleton scope">singletons</a>. When a
      singleton bean needs to collaborate with another singleton bean, or a
      non-singleton bean needs to collaborate with another non-singleton bean,
      you typically handle the dependency by defining one bean as a property of
      the other. A problem arises when the bean lifecycles are different.
      Suppose singleton bean A needs to use non-singleton (prototype) bean B,
      perhaps on each method invocation on A. The container only creates the
      singleton bean A once, and thus only gets one opportunity to set the
      properties. The container cannot provide bean A with a new instance of
      bean B every time one is needed.</p><p>A solution is to forego some inversion of control. You can <a class="link" href="#beans-factory-aware" title="4.6.2&nbsp;ApplicationContextAware and BeanNameAware">make bean A aware of the container</a> by
      implementing the <code class="interfacename">ApplicationContextAware</code>
      interface, and by <a class="link" href="#beans-factory-client" title="4.2.3&nbsp;Using the container">making a
      getBean("B") call to the container</a> ask for (a typically new) bean B
      instance every time bean A needs it. The following is an example of this
      approach:</p><pre class="programlisting"><span class="hl-comment">// a class that uses a stateful Command-style class to perform some processing</span>
<span class="hl-keyword">package</span> fiona.apple;

<span class="hl-comment">// Spring-API imports</span>
<span class="hl-keyword">import</span> org.springframework.beans.BeansException;
<span class="hl-keyword">import</span> org.springframework.context.ApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.ApplicationContextAware;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CommandManager <span class="hl-keyword">implements</span> ApplicationContextAware {

 <span class="hl-keyword">private</span> ApplicationContext applicationContext;

 <span class="hl-keyword">public</span> Object process(Map commandState) {
    <span class="hl-comment">// grab a new instance of the appropriate Command</span>
    Command command = createCommand();
    <span class="hl-comment">// set the state on the (hopefully brand new) Command instance</span>
    command.setState(commandState);
    <span class="hl-keyword">return</span> command.execute();
 }

 <span class="hl-keyword">protected</span> Command createCommand() {
    <span class="hl-comment">// notice the Spring API dependency!</span>
    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.applicationContext.getBean(<span class="hl-string">"command"</span>, Command.<span class="hl-keyword">class</span>);
 }

 <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setApplicationContext(ApplicationContext applicationContext)
                                                                  <span class="hl-keyword">throws</span> BeansException {
    <span class="hl-keyword">this</span>.applicationContext = applicationContext;
 }
}</pre><p>The preceding is not desirable, because the business code is aware of
      and coupled to the Spring Framework. Method Injection, a somewhat advanced
      feature of the Spring IoC container, allows this use case to be handled in
      a clean
      fashion.</p><div class="sidebar"><p class="title"><b></b></p><p>You can read more about the motivation for Method Injection in
        <a class="ulink" href="http://blog.springsource.com/2004/08/06/method-injection/" target="_top">this blog entry</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lookup-method-injection"></a>4.4.6.1&nbsp;Lookup method injection</h4></div></div></div><p>Lookup method injection is the ability of the container to override
        methods on <span class="emphasis"><em>container managed beans</em></span>, to return the
        lookup result for another named bean in the container. The lookup
        typically involves a prototype bean as in the scenario described in the
        preceding section. The Spring Framework implements this method injection
        by using bytecode generation from the CGLIB library to generate
        dynamically a subclass that overrides the
        method.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>For this dynamic subclassing to work, you must have the CGLIB
          jar(s) in your classpath. The class that the Spring container will
          subclass cannot be <code class="literal">final</code>, and the method to be
          overridden cannot be <code class="literal">final</code> either. Also, testing a
          class that has an <code class="literal">abstract</code> method requires you to
          subclass the class yourself and to supply a stub implementation of the
          <code class="literal">abstract</code> method. Finally, objects that have been
          the target of method injection cannot be serialized.</p></td></tr></table></div><p>Looking at the <code class="classname">CommandManager</code> class in the
        previous code snippet, you see that the Spring container will
        dynamically override the implementation of the
        <code class="methodname">createCommand()</code> method. Your
        <code class="classname">CommandManager</code> class will not have any Spring
        dependencies, as can be seen in the reworked example:</p><pre class="programlisting"><span class="hl-keyword">package</span> fiona.apple;

<span class="hl-comment">// no more Spring imports! </span>

<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> CommandManager {

 <span class="hl-keyword">public</span> Object process(Object commandState) {
    <span class="hl-comment">// grab a new instance of the appropriate Command interface</span>
    Command command = createCommand();
    <span class="hl-comment">// set the state on the (hopefully brand new) Command instance</span>
    command.setState(commandState);
    <span class="hl-keyword">return</span> command.execute();
 }

  <span class="hl-comment">// okay... but where is the implementation of this method?</span>
 <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Command createCommand();
}</pre><p>In the client class containing the method to be injected (the
        <code class="classname">CommandManager</code> in this case), the method to be
        injected requires a signature of the following form:</p><pre class="programlisting">&lt;<span class="hl-tag">public|protected</span>&gt; [abstract] &lt;<span class="hl-tag">return-type</span>&gt; theMethodName(no-arguments);</pre><p>If the method is <code class="literal">abstract</code>, the
        dynamically-generated subclass implements the method. Otherwise, the
        dynamically-generated subclass overrides the concrete method defined in
        the original class. For example:</p><pre class="programlisting">&lt;<span class="hl-comment">!-- a stateful bean deployed as a prototype (non-singleton) --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"command"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"fiona.apple.AsyncCommand"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span>&gt;
&lt;<span class="hl-comment">!-- inject dependencies here as required --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-comment">!-- commandProcessor uses statefulCommandHelper --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"commandManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"fiona.apple.CommandManager"</span>&gt;
&lt;<span class="hl-tag">lookup-method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"createCommand"</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"command"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The bean identified as <span class="emphasis"><em>commandManager</em></span> calls its
        own method <code class="methodname">createCommand()</code> whenever it needs a
        new instance of the <span class="emphasis"><em>command</em></span> bean. You must be
        careful to deploy the <code class="literal">command</code> bean as a prototype, if
        that is actually what is needed. If it is deployed as a <a class="link" href="#beans-factory-scopes-singleton" title="4.5.1&nbsp;The singleton scope">singleton</a>, the same
        instance of the <code class="literal">command</code> bean is returned each
        time.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The interested reader may also find the
          <code class="classname">ServiceLocatorFactoryBean</code> (in the
          <code class="literal">org.springframework.beans.factory.config</code> package)
          to be of use. The approach used in ServiceLocatorFactoryBean is
          similar to that of another utility class,
          <code class="classname">ObjectFactoryCreatingFactoryBean</code>, but it allows
          you to specify your own lookup interface as opposed to a
          Spring-specific lookup interface. Consult the JavaDocs for these
          classes as well as this <a class="ulink" href="http://blog.arendsen.net/index.php/2006/10/05/on-the-servicelocatorfactorybean-dlas-and-the-sustainability-of-code-and-design/" target="_top">blog entry</a> for additional information
          ServiceLocatorFactoryBean.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-arbitrary-method-replacement"></a>4.4.6.2&nbsp;Arbitrary method replacement</h4></div></div></div><p>A less useful form of method injection than lookup method Injection
        is the ability to replace arbitrary methods in a managed bean with
        another method implementation. Users may safely skip the rest of this
        section until the functionality is actually
        needed.</p><p>With XML-based configuration metadata, you can use the
        <code class="literal">replaced-method</code> element to replace an existing method
        implementation with another, for a deployed bean. Consider the following
        class, with a method computeValue, which we want to override:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyValueCalculator {

<span class="hl-keyword">public</span> String computeValue(String input) {
  <span class="hl-comment">// some real code...</span>
}

<span class="hl-comment">// some other methods...</span>

}</pre><p>A class implementing the
        <code class="interfacename">org.springframework.beans.factory.support.MethodReplacer</code>
        interface provides the new method definition.</p><pre class="programlisting"><span class="hl-comment">/** meant to be used to override the existing computeValue(String)
  implementation in MyValueCalculator
*/</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ReplacementComputeValue <span class="hl-keyword">implements</span> MethodReplacer {

  <span class="hl-keyword">public</span> Object reimplement(Object o, Method m, Object[] args) <span class="hl-keyword">throws</span> Throwable {
      <span class="hl-comment">// get the input value, work with it, and return a computed result</span>
      String input = (String) args[0];
      ...
      <span class="hl-keyword">return</span> ...;
  }
}</pre><p>The bean definition to deploy the original class and specify the
        method override would look like this:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myValueCalculator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.z.MyValueCalculator"</span>&gt;

&lt;<span class="hl-comment">!-- arbitrary method replacement --</span>&gt;
&lt;<span class="hl-tag">replaced-method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"computeValue"</span> <span class="hl-attribute">replacer</span>=<span class="hl-value">"replacementComputeValue"</span>&gt;
  &lt;<span class="hl-tag">arg-type</span>&gt;String&lt;<span class="hl-tag">/arg-type</span>&gt;
&lt;<span class="hl-tag">/replaced-method</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"replacementComputeValue"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"a.b.c.ReplacementComputeValue"</span>/&gt;</pre><p>You can use one or more contained
        <code class="literal">&lt;arg-type/&gt;</code> elements within the
        <code class="literal">&lt;replaced-method/&gt;</code> element to indicate the
        method signature of the method being overridden. The signature for the
        arguments is necessary only if the method is overloaded and multiple
        variants exist within the class. For convenience, the type string for an
        argument may be a substring of the fully qualified type name. For
        example, the following all match
        <code class="classname">java.lang.String</code>:</p><pre class="programlisting">    java.lang.String
  String
  Str</pre><p>Because the number of arguments is often enough to distinguish
        between each possible choice, this shortcut can save a lot of typing, by
        allowing you to type only the shortest string that will match an
        argument type.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-factory-scopes"></a>4.5&nbsp;Bean scopes</h2></div></div></div><p>When you create a bean definition, you create a
    <span class="emphasis"><em>recipe</em></span> for creating actual instances of the class
    defined by that bean definition. The idea that a bean definition is a recipe
    is important, because it means that, as with a class, you can create many
    object instances from a single recipe.</p><p>You can control not only the various dependencies and configuration
    values that are to be plugged into an object that is created from a
    particular bean definition, but also the <em class="firstterm">scope</em> of the
    objects created from a particular bean definition. This approach is powerful
    and flexible in that you can <span class="emphasis"><em>choose</em></span> the scope of the
    objects you create through configuration instead of having to bake in the
    scope of an object at the Java class level. Beans can be defined to be
    deployed in one of a number of scopes: out of the box, the Spring Framework
    supports five scopes, three of which are available only if you use a
    web-aware <code class="interfacename">ApplicationContext</code>.</p><p>The following scopes are supported out of the box. You can also create
    <a class="link" href="#beans-factory-scopes-custom" title="4.5.5&nbsp;Custom scopes">a custom scope.</a></p><div class="table"><a name="beans-factory-scopes-tbl"></a><p class="title"><b>Table&nbsp;4.3.&nbsp;Bean scopes</b></p><div class="table-contents"><table summary="Bean scopes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Scope</th><th style="border-bottom: 1.0pt solid ; " align="center">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p> <a class="link" href="#beans-factory-scopes-singleton" title="4.5.1&nbsp;The singleton scope">singleton</a> </p></td><td style="border-bottom: 1.0pt solid ; "><p>(Default) Scopes a single bean definition to a single
            object instance per Spring IoC container.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p> <a class="link" href="#beans-factory-scopes-prototype" title="4.5.2&nbsp;The prototype scope">prototype</a> </p></td><td style="border-bottom: 1.0pt solid ; "><p>Scopes a single bean definition to any number of object
            instances.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p> <a class="link" href="#beans-factory-scopes-request" title="4.5.4.2&nbsp;Request scope">request</a> </p></td><td style="border-bottom: 1.0pt solid ; "><p>Scopes a single bean definition to the lifecycle of a
            single HTTP request; that is, each HTTP request has its own instance
            of a bean created off the back of a single bean definition. Only
            valid in the context of a web-aware Spring
            <code class="interfacename">ApplicationContext</code>.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p> <a class="link" href="#beans-factory-scopes-session" title="4.5.4.3&nbsp;Session scope">session</a> </p></td><td style="border-bottom: 1.0pt solid ; "><p>Scopes a single bean definition to the lifecycle of an
            HTTP <code class="interfacename">Session</code>. Only valid in the
            context of a web-aware Spring
            <code class="interfacename">ApplicationContext</code>.</p></td></tr><tr><td style="border-right: 1.0pt solid ; "><p> <a class="link" href="#beans-factory-scopes-global-session" title="4.5.4.4&nbsp;Global session scope">global session</a> </p></td><td style=""><p>Scopes a single bean definition to the lifecycle of a
            global HTTP <code class="interfacename">Session</code>. Typically only
            valid when used in a portlet context. Only valid in the context of a
            web-aware Spring
            <code class="interfacename">ApplicationContext</code>.</p></td></tr></tbody></table></div></div><br class="table-break"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Thread-scoped beans"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Thread-scoped beans</th></tr><tr><td align="left" valign="top"><p>As of Spring 3.0, a <span class="emphasis"><em>thread scope</em></span> is available,
      but is not registered by default. For more information, see the
      documentation for <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/support/SimpleThreadScope.html" target="_top">SimpleThreadScope</a>. For instructions on how to register this or
      any other custom scope, see <a class="xref" href="#beans-factory-scopes-custom-using" title="4.5.5.2&nbsp;Using a custom scope">Section&nbsp;4.5.5.2, &#8220;Using a custom scope&#8221;</a>.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-singleton"></a>4.5.1&nbsp;The singleton scope</h3></div></div></div><p>Only one <span class="emphasis"><em>shared</em></span> instance of a singleton bean is
      managed, and all requests for beans with an id or ids matching that bean
      definition result in that one specific bean instance being returned by the
      Spring container.</p><p>To put it another way, when you define a bean definition and it is
      scoped as a singleton, the Spring IoC container creates <span class="emphasis"><em>exactly
      one</em></span> instance of the object defined by that bean definition.
      This single instance is stored in a cache of such singleton beans, and
      <span class="emphasis"><em>all subsequent requests and references</em></span> for that named
      bean return the cached object.</p><div class="mediaobject" align="center"><img src="images/singleton.png" align="middle"></div><p>Spring's concept of a singleton bean differs from the Singleton
      pattern as defined in the Gang of Four (GoF) patterns book. The GoF
      Singleton hard-codes the scope of an object such that one <span class="emphasis"><em>and
      only one</em></span> instance of a particular class is created<span class="emphasis"><em>
      per <code class="classname">ClassLoader</code></em></span>. The scope of the Spring
      singleton is best described as <span class="emphasis"><em>per container and per
      bean</em></span>. This means that if you define one bean for a particular
      class in a single Spring container, then the Spring container creates one
      <span class="emphasis"><em>and only one</em></span> instance of the class defined by that
      bean definition. <span class="emphasis"><em>The singleton scope is the default scope in
      Spring</em></span>. To define a bean as a singleton in XML, you would
      write, for example:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.DefaultAccountService"</span>/&gt;

&lt;<span class="hl-comment">!-- the following is equivalent, though redundant (singleton scope is the default) --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.DefaultAccountService"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"singleton"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-prototype"></a>4.5.2&nbsp;The prototype scope</h3></div></div></div><p>The non-singleton, prototype scope of bean deployment results in the
      <span class="emphasis"><em>creation of a new bean instance</em></span> every time a request
      for that specific bean is made. That is, the bean is injected into another
      bean or you request it through a <code class="literal">getBean()</code> method call
      on the container. As a rule, use the prototype scope for all stateful
      beans and the singleton scope for stateless beans.</p><p>The following diagram illustrates the Spring prototype scope.
      <span class="emphasis"><em>A data access object (DAO) is not typically configured as a
      prototype, because a typical DAO does not hold any conversational state;
      it was just easier for this author to reuse the core of the singleton
      diagram.</em></span></p><div class="mediaobject" align="center"><img src="images/prototype.png" align="middle"></div><p>The following example defines a bean as a prototype in XML:</p><pre class="programlisting">&lt;<span class="hl-comment">!-- using spring-beans-2.0.dtd --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.DefaultAccountService"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span>/&gt;</pre><p>In contrast to the other scopes, Spring does not manage the complete
      lifecycle of a prototype bean: the container instantiates, configures, and
      otherwise assembles a prototype object, and hands it to the client, with
      no further record of that prototype instance. Thus, although
      <span class="emphasis"><em>initialization</em></span> lifecycle callback methods are called
      on all objects regardless of scope, in the case of prototypes, configured
      <span class="emphasis"><em>destruction</em></span> lifecycle callbacks are
      <span class="emphasis"><em>not</em></span> called. The client code must clean up
      prototype-scoped objects and release expensive resources that the
      prototype bean(s) are holding. To get the Spring container to release
      resources held by prototype-scoped beans, try using a custom <a class="link" href="#beans-factory-extension-bpp" title="4.8.1&nbsp;Customizing beans using a BeanPostProcessor">bean post-processor</a>, which
      holds a reference to beans that need to be cleaned up.</p><p>In some respects, the Spring container's role in regard to a
      prototype-scoped bean is a replacement for the Java <code class="literal">new</code>
      operator. All lifecycle management past that point must be handled by the
      client. (For details on the lifecycle of a bean in the Spring container,
      see <a class="xref" href="#beans-factory-lifecycle" title="4.6.1&nbsp;Lifecycle callbacks">Section&nbsp;4.6.1, &#8220;Lifecycle callbacks&#8221;</a>.)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-sing-prot-interaction"></a>4.5.3&nbsp;Singleton beans with prototype-bean dependencies</h3></div></div></div><p>When you use singleton-scoped beans with dependencies on prototype
      beans, be aware that <span class="emphasis"><em>dependencies are resolved at instantiation
      time</em></span>. Thus if you dependency-inject a prototype-scoped bean
      into a singleton-scoped bean, a new prototype bean is instantiated and
      then dependency-injected into the singleton bean. The prototype instance
      is the sole instance that is ever supplied to the singleton-scoped
      bean.</p><p>However, suppose you want the singleton-scoped bean to acquire a new
      instance of the prototype-scoped bean repeatedly at runtime. You cannot
      dependency-inject a prototype-scoped bean into your singleton bean,
      because that injection occurs only <span class="emphasis"><em>once</em></span>, when the
      Spring container is instantiating the singleton bean and resolving and
      injecting its dependencies. If you need a new instance of a prototype bean
      at runtime more than once, see <a class="xref" href="#beans-factory-method-injection" title="4.4.6&nbsp;Method injection">Section&nbsp;4.4.6, &#8220;Method injection&#8221;</a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-other"></a>4.5.4&nbsp;Request, session, and global session scopes</h3></div></div></div><p>The <code class="literal">request</code>, <code class="literal">session</code>, and
      <code class="literal">global session</code> scopes are <span class="emphasis"><em>only</em></span>
      available if you use a web-aware Spring
      <code class="interfacename">ApplicationContext</code> implementation (such as
      <code class="classname">XmlWebApplicationContext</code>). If you use these scopes
      with regular Spring IoC containers such as the
      <code class="classname">ClassPathXmlApplicationContext</code>, you get an
      <code class="classname">IllegalStateException</code> complaining about an unknown
      bean scope.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-other-web-configuration"></a>4.5.4.1&nbsp;Initial web configuration</h4></div></div></div><p>To support the scoping of beans at the <code class="literal">request</code>,
        <code class="literal">session</code>, and <code class="literal">global session</code> levels
        (web-scoped beans), some minor initial configuration is required before
        you define your beans. (This initial setup is <span class="emphasis"><em>not</em></span>
        required for the standard scopes, singleton and prototype.)</p><p>How you accomplish this initial setup depends on your particular
        Servlet environment..</p><p>If you access scoped beans within Spring Web MVC, in effect, within
        a request that is processed by the Spring
        <code class="classname">DispatcherServlet</code>, or
        <code class="classname">DispatcherPortlet</code>, then no special setup is
        necessary: <code class="classname">DispatcherServlet</code> and
        <code class="classname">DispatcherPortlet</code> already expose all relevant
        state.</p><p>If you use a Servlet 2.4+ web container, with requests processed
        outside of Spring's DispatcherServlet (for example, when using JSF or
        Struts), you need to add the following
        <code class="interfacename">javax.servlet.ServletRequestListener</code> to
        the declarations in your web applications <code class="literal">web.xml</code>
        file:</p><pre class="programlisting">&lt;<span class="hl-tag">web-app</span>&gt;
...
&lt;<span class="hl-tag">listener</span>&gt;
  &lt;<span class="hl-tag">listener-class</span>&gt;
      org.springframework.web.context.request.RequestContextListener
  &lt;<span class="hl-tag">/listener-class</span>&gt;
&lt;<span class="hl-tag">/listener</span>&gt;
...
&lt;<span class="hl-tag">/web-app</span>&gt;</pre><p>If you use an older web container (Servlet 2.3), use the provided
        <code class="interfacename">javax.servlet.Filter</code> implementation. The
        following snippet of XML configuration must be included in the
        <code class="literal">web.xml</code> file of your web application if you want to
        access web-scoped beans in requests outside of Spring's
        DispatcherServlet on a Servlet 2.3 container. (The filter mapping
        depends on the surrounding web application configuration, so you must
        change it as appropriate.)</p><pre class="programlisting">&lt;<span class="hl-tag">web-app</span>&gt;
..
&lt;<span class="hl-tag">filter</span>&gt;
  &lt;<span class="hl-tag">filter-name</span>&gt;requestContextFilter&lt;<span class="hl-tag">/filter-name</span>&gt;
  &lt;<span class="hl-tag">filter-class</span>&gt;org.springframework.web.filter.RequestContextFilter&lt;<span class="hl-tag">/filter-class</span>&gt;
&lt;<span class="hl-tag">/filter</span>&gt;
&lt;<span class="hl-tag">filter-mapping</span>&gt;
  &lt;<span class="hl-tag">filter-name</span>&gt;requestContextFilter&lt;<span class="hl-tag">/filter-name</span>&gt;
  &lt;<span class="hl-tag">url-pattern</span>&gt;/*&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/filter-mapping</span>&gt;
...
&lt;<span class="hl-tag">/web-app</span>&gt;</pre><p><code class="classname">DispatcherServlet</code>,
        <code class="classname">RequestContextListener</code> and
        <code class="classname">RequestContextFilter</code> all do exactly the same
        thing, namely bind the HTTP request object to the
        <code class="classname">Thread</code> that is servicing that request. This makes
        beans that are request- and session-scoped available further down the
        call chain.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-request"></a>4.5.4.2&nbsp;Request scope</h4></div></div></div><p>Consider the following bean definition:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"loginAction"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.LoginAction"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"request"</span>/&gt;</pre><p>The Spring container creates a new instance of the
        <code class="classname">LoginAction</code> bean by using the
        <code class="literal">loginAction</code> bean definition for each and every HTTP
        request. That is, the <code class="literal">loginAction</code> bean is scoped at
        the HTTP request level. You can change the internal state of the
        instance that is created as much as you want, because other instances
        created from the same <code class="literal">loginAction</code> bean definition
        will not see these changes in state; they are particular to an
        individual request. When the request completes processing, the bean that
        is scoped to the request is discarded.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-session"></a>4.5.4.3&nbsp;Session scope</h4></div></div></div><p>Consider the following bean definition:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserPreferences"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span>/&gt;</pre><p>The Spring container creates a new instance of the
        <code class="classname">UserPreferences</code> bean by using the
        <code class="literal">userPreferences</code> bean definition for the lifetime of a
        single HTTP <code class="interfacename">Session</code>. In other words, the
        <code class="literal">userPreferences</code> bean is effectively scoped at the
        HTTP <code class="interfacename">Session</code> level. As with
        <code class="literal">request-scoped</code> beans, you can change the internal
        state of the instance that is created as much as you want, knowing that
        other HTTP <code class="interfacename">Session</code> instances that are
        also using instances created from the same
        <code class="literal">userPreferences</code> bean definition do not see these
        changes in state, because they are particular to an individual HTTP
        <code class="interfacename">Session</code>. When the HTTP
        <code class="interfacename">Session</code> is eventually discarded, the bean
        that is scoped to that particular HTTP
        <code class="interfacename">Session</code> is also discarded.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-global-session"></a>4.5.4.4&nbsp;Global session scope</h4></div></div></div><p>Consider the following bean definition:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserPreferences"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"globalSession"</span>/&gt;</pre><p>The <code class="literal">global session</code> scope is similar to the
        standard HTTP <code class="interfacename">Session</code> scope (<a class="link" href="#beans-factory-scopes-session" title="4.5.4.3&nbsp;Session scope">described above</a>), and
        applies only in the context of portlet-based web applications. The
        portlet specification defines the notion of a global
        <code class="interfacename">Session</code> that is shared among all portlets
        that make up a single portlet web application. Beans defined at the
        <code class="literal">global session</code> scope are scoped (or bound) to the
        lifetime of the global portlet
        <code class="interfacename">Session</code>.</p><p>If you write a standard Servlet-based web application and you define
        one or more beans as having <code class="literal">global session</code> scope, the
        standard HTTP <code class="interfacename">Session</code> scope is used, and
        no error is raised.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-other-injection"></a>4.5.4.5&nbsp;Scoped beans as dependencies</h4></div></div></div><p>The Spring IoC container manages not only the instantiation of your
        objects (beans), but also the wiring up of collaborators (or
        dependencies). If you want to inject (for example) an HTTP request
        scoped bean into another bean, you must inject an AOP proxy in place of
        the scoped bean. That is, you need to inject a proxy object that exposes
        the same public interface as the scoped object but that can also
        retrieve the real, target object from the relevant scope (for example,
        an HTTP request) and delegate method calls onto the real object.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You <span class="emphasis"><em>do not</em></span> need to use the
          <code class="literal">&lt;aop:scoped-proxy/&gt;</code> in conjunction with beans
          that are scoped as <code class="literal">singletons</code> or
          <code class="literal">prototypes</code>. If you try to create a scoped proxy for
          a singleton bean, the
          <code class="exceptionname">BeanCreationException</code> is raised.</p></td></tr></table></div><p>The configuration in the following example is only one line, but it
        is important to understand the &#8220;<span class="quote">why</span>&#8221; as well as the
        &#8220;<span class="quote">how</span>&#8221; behind it.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
         http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
         http://www.springframework.org/schema/aop
         http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;

  &lt;<span class="hl-comment">!-- an HTTP Session-scoped bean exposed as a proxy --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserPreferences"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span>&gt;

        &lt;<span class="hl-comment">!-- instructs the container to proxy the surrounding bean --</span>&gt;
        &lt;<span class="hl-tag">aop:scoped-proxy</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-comment">!-- a singleton-scoped bean injected with a proxy to the above bean --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.SimpleUserService"</span>&gt;

      &lt;<span class="hl-comment">!-- a reference to the proxied userPreferences bean --</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"userPreferences"</span>/&gt;

  &lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">/beans</span>&gt;
</pre><p>To create such a proxy, you insert a child
        <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element into a scoped bean
        definition.
        (If
        you choose class-based proxying, you also need the CGLIB library in your
        classpath. See <a class="xref" href="#beans-factory-scopes-other-injection-proxies" title="Choosing the type of proxy to create">the section called &#8220;Choosing the type of proxy to create&#8221;</a> and <a class="xref" href="#xsd-config" title="Appendix&nbsp;C.&nbsp;XML Schema-based configuration">Appendix&nbsp;C, <i>XML Schema-based configuration</i></a>.) Why do definitions of beans scoped at the
        <code class="literal">request</code>, <code class="literal">session</code>,
        <code class="literal">globalSession</code> and custom-scope levels require the
        <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element ? Let's examine the
        following singleton bean definition and contrast it with what you need
        to define for the aforementioned scopes. (The following
        <code class="literal">userPreferences</code> bean definition as it stands is
        <span class="emphasis"><em>incomplete.)</em></span></p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserPreferences"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserManager"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"userPreferences"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>In the preceding example, the singleton bean
        <code class="literal">userManager</code> is injected with a reference to the HTTP
        <code class="interfacename">Session</code>-scoped bean
        <code class="literal">userPreferences</code>. The salient point here is that the
        <code class="literal">userManager</code> bean is a singleton: it will be
        instantiated <span class="emphasis"><em>exactly once</em></span> per container, and its
        dependencies (in this case only one, the
        <code class="literal">userPreferences</code> bean) are also injected only once.
        This means that the <code class="literal">userManager</code> bean will only
        operate on the exact same <code class="literal">userPreferences</code> object,
        that is, the one that it was originally injected with.</p><p>This is <span class="emphasis"><em>not</em></span> the behavior you want when
        injecting a shorter-lived scoped bean into a longer-lived scoped bean,
        for example injecting an HTTP
        <code class="interfacename">Session</code>-scoped collaborating bean as a
        dependency into singleton bean. Rather, you need a single
        <code class="literal">userManager</code> object, and for the lifetime of an HTTP
        <code class="interfacename">Session</code>, you need a
        <code class="literal">userPreferences</code> object that is specific to said HTTP
        <code class="interfacename">Session</code>. Thus the container creates an
        object that exposes the exact same public interface as the
        <code class="classname">UserPreferences</code> class (ideally an object that
        <span class="emphasis"><em>is a</em></span> <code class="classname">UserPreferences</code>
        instance) which can fetch the real
        <code class="classname">UserPreferences</code> object from the scoping mechanism
        (HTTP request, <code class="interfacename">Session</code>, etc.). The
        container injects this proxy object into the
        <code class="literal">userManager</code> bean, which is unaware that this
        <code class="classname">UserPreferences</code> reference is a proxy. In this
        example, when a <code class="interfacename">UserManager</code> instance
        invokes a method on the dependency-injected
        <code class="classname">UserPreferences</code> object, it actually is invoking a
        method on the proxy. The proxy then fetches the real
        <code class="classname">UserPreferences</code> object from (in this case) the
        HTTP <code class="interfacename">Session</code>, and delegates the method
        invocation onto the retrieved real
        <code class="classname">UserPreferences</code> object.</p><p>Thus you need the following, correct and complete, configuration
        when injecting <code class="literal">request-</code>, <code class="literal">session-</code>,
        and <code class="literal">globalSession-scoped</code> beans into collaborating
        objects:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserPreferences"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span>&gt;
  &lt;<span class="hl-tag">aop:scoped-proxy</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserManager"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"userPreferences"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-factory-scopes-other-injection-proxies"></a>Choosing the type of proxy to create</h5></div></div></div><p>By default, when the Spring container creates a proxy for a bean
          that is marked up with the
          <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element, <span class="emphasis"><em>a
          CGLIB-based class proxy is created</em></span>. This means that you
          need to have the CGLIB library in the classpath of your
          application.</p><p><span class="emphasis"><em>Note: CGLIB proxies only intercept public method
          calls!</em></span> Do not call non-public methods on such a proxy; they
          will not be delegated to the scoped target object.</p><p>Alternatively, you can configure the Spring container to create
          standard JDK interface-based proxies for such scoped beans, by
          specifying <code class="literal">false</code> for the value of the
          <code class="literal">proxy-target-class</code> attribute of the
          <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element. Using JDK
          interface-based proxies means that you do not need additional
          libraries in your application classpath to effect such proxying.
          However, it also means that the class of the scoped bean must
          implement at least one interface, and <span class="emphasis"><em>that all</em></span>
          collaborators into which the scoped bean is injected must reference
          the bean through one of its interfaces.</p><pre class="programlisting">&lt;<span class="hl-comment">!-- DefaultUserPreferences implements the UserPreferences interface --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.DefaultUserPreferences"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span>&gt;
  &lt;<span class="hl-tag">aop:scoped-proxy</span> <span class="hl-attribute">proxy-target-class</span>=<span class="hl-value">"false"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserManager"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"userPreferences"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>For more detailed information about choosing class-based or
          interface-based proxying, see <a class="xref" href="#aop-proxying" title="8.6&nbsp;Proxying mechanisms">Section&nbsp;8.6, &#8220;Proxying mechanisms&#8221;</a>.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-custom"></a>4.5.5&nbsp;Custom scopes</h3></div></div></div><p>As of Spring 2.0, the bean scoping mechanism is extensible. You can
      define your own scopes, or even redefine existing scopes, although the
      latter is considered bad practice and you <span class="emphasis"><em>cannot</em></span>
      override the built-in <code class="literal">singleton</code> and
      <code class="literal">prototype</code> scopes.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-custom-creating"></a>4.5.5.1&nbsp;Creating a custom scope</h4></div></div></div><p>To integrate your custom scope(s) into the Spring container, you
        need to implement the
        <code class="interfacename">org.springframework.beans.factory.config.Scope</code>
        interface, which is described in this section. For an idea of how to
        implement your own scopes, see the <code class="interfacename">Scope</code>
        implementations that are supplied with the Spring Framework itself and
        the <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/beans/factory/config/Scope.html" target="_top">Scope Javadoc</a>, which explains the methods you need to implement
        in more detail.</p><p>The <code class="literal">Scope</code> interface has four methods to get
        objects from the scope, remove them from the scope, and allow them to be
        destroyed.</p><p>The following method returns the object from the underlying scope.
        The session scope implementation, for example, returns the
        session-scoped bean (and if it does not exist, the method returns a new
        instance of the bean, after having bound it to the session for future
        reference).</p><pre class="programlisting">Object get(String name, ObjectFactory objectFactory)</pre><p>The following method removes the object from the underlying scope.
        The session scope implementation for example, removes the session-scoped
        bean from the underlying session. The object should be returned, but you
        can return null if the object with the specified name is not
        found.</p><pre class="programlisting">Object remove(String name)</pre><p>The following method registers the callbacks the scope should
        execute when it is destroyed or when the specified object in the scope
        is destroyed. Refer to the Javadoc or a Spring scope implementation for
        more information on destruction callbacks.</p><pre class="programlisting"><span class="hl-keyword">void</span> registerDestructionCallback(String name, Runnable destructionCallback)</pre><p>The following method obtains the conversation identifier for the
        underlying scope. This identifier is different for each scope. For a
        session scoped implementation, this identifier can be the session
        identifier.</p><pre class="programlisting">String getConversationId()</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-custom-using"></a>4.5.5.2&nbsp;Using a custom scope</h4></div></div></div><p>After you write and test one or more custom
        <code class="interfacename">Scope</code> implementations, you need to make
        the Spring container aware of your new scope(s). The following method is
        the central method to register a new
        <code class="interfacename">Scope</code> with the Spring container:</p><pre class="programlisting"><span class="hl-keyword">void</span> registerScope(String scopeName, Scope scope);</pre><p>This method is declared on the
        <code class="interfacename">ConfigurableBeanFactory</code> interface, which
        is available on most of the concrete
        <code class="interfacename">ApplicationContext</code> implementations that
        ship with Spring via the BeanFactory property.</p><p>The first argument to the <code class="methodname">registerScope(..)</code>
        method is the unique name associated with a scope; examples of such
        names in the Spring container itself are <code class="literal">singleton</code>
        and <code class="literal">prototype</code>. The second argument to the
        <code class="methodname">registerScope(..)</code> method is an actual instance
        of the custom <code class="interfacename">Scope</code> implementation that
        you wish to register and use.</p><p>Suppose that you write your custom
        <code class="interfacename">Scope</code> implementation, and then register
        it as below.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The example below uses <code class="literal">SimpleThreadScope</code> which
          is included with Spring, but not registered by default. The
          instructions would be the same for your own custom
          <code class="literal">Scope</code> implementations.</p></td></tr></table></div><pre class="programlisting">
Scope threadScope = <span class="hl-keyword">new</span> SimpleThreadScope();
beanFactory.registerScope(<span class="hl-string">"thread"</span>, threadScope);</pre><p>You then create bean definitions that adhere to the scoping rules of
        your custom <code class="interfacename">Scope</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"thread"</span>&gt;</pre><p>With a custom <code class="interfacename">Scope</code> implementation,
        you are not limited to programmatic registration of the scope. You can
        also do the <code class="interfacename">Scope</code> registration
        declaratively, using the <code class="classname">CustomScopeConfigurer</code>
        class:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
         http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
         http://www.springframework.org/schema/aop
         http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.CustomScopeConfigurer"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"scopes"</span>&gt;
          &lt;<span class="hl-tag">map</span>&gt;
              &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"thread"</span>&gt;
                  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.support.SimpleThreadScope"</span>/&gt;
              &lt;<span class="hl-tag">/entry</span>&gt;
          &lt;<span class="hl-tag">/map</span>&gt;
      &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bar"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Bar"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"thread"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Rick"</span>/&gt;
      &lt;<span class="hl-tag">aop:scoped-proxy</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Foo"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bar"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"bar"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>When you place &lt;aop:scoped-proxy/&gt; in a
          <code class="interfacename">FactoryBean</code> implementation, it is the
          factory bean itself that is scoped, not the object returned from
          <code class="methodname">getObject()</code>.</p></td></tr></table></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-factory-nature"></a>4.6&nbsp;Customizing the nature of a bean</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-lifecycle"></a>4.6.1&nbsp;Lifecycle callbacks</h3></div></div></div><p>To interact with the container's management of the bean lifecycle, you
      can implement the Spring <code class="interfacename">InitializingBean</code>
      and <code class="interfacename">DisposableBean</code> interfaces. The
      container calls <code class="methodname">afterPropertiesSet()</code> for the
      former and <code class="methodname">destroy()</code> for the latter to allow the
      bean to perform certain actions upon initialization and destruction of
      your beans. You can also achieve the same integration with the container
      without coupling your classes to Spring interfaces through the use of
      init-method and destroy method object definition metadata.</p><p>Internally, the Spring Framework uses
      <code class="interfacename">BeanPostProcessor</code> implementations to
      process any callback interfaces it can find and call the appropriate
      methods. If you need custom features or other lifecycle behavior Spring
      does not offer out-of-the-box, you can implement a
      <code class="interfacename">BeanPostProcessor</code> yourself. For more
      information, see <a class="xref" href="#beans-factory-extension" title="4.8&nbsp;Container Extension Points">Section&nbsp;4.8, &#8220;Container Extension Points&#8221;</a>.</p><p>In addition to the initialization and destruction callbacks,
      Spring-managed objects may also implement the
      <code class="interfacename">Lifecycle</code> interface so that those objects
      can participate in the startup and shutdown process as driven by the
      container's own lifecycle.</p><p>The lifecycle callback interfaces are described in this
      section.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lifecycle-initializingbean"></a>4.6.1.1&nbsp;Initialization callbacks</h4></div></div></div><p>The
        <code class="interfacename">org.springframework.beans.factory.InitializingBean</code>
        interface allows a bean to perform initialization work after all
        necessary properties on the bean have been set by the container. The
        <code class="interfacename">InitializingBean</code> interface specifies a
        single method:</p><pre class="programlisting"><span class="hl-keyword">void</span> afterPropertiesSet() <span class="hl-keyword">throws</span> Exception;</pre><p>It is recommended that you do not use the
        <code class="interfacename">InitializingBean</code> interface because it
        unnecessarily couples the code to Spring. Alternatively, specify a POJO
        initialization method. In the case of XML-based configuration metadata,
        you use the <code class="literal">init-method</code> attribute to specify the name
        of the method that has a void no-argument signature. For example, the
        following definition:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleInitBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span> <span class="hl-attribute">init-method</span>=<span class="hl-value">"init"</span>/&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init() {
      <span class="hl-comment">// do some initialization work</span>
  }
}</pre><p>...is exactly the same as...</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleInitBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.AnotherExampleBean"</span>/&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AnotherExampleBean <span class="hl-keyword">implements</span> InitializingBean {

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterPropertiesSet() {
      <span class="hl-comment">// do some initialization work</span>
  }
}</pre><p>... but does not couple the code to Spring.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lifecycle-disposablebean"></a>4.6.1.2&nbsp;Destruction callbacks</h4></div></div></div><p>Implementing the
        <code class="interfacename">org.springframework.beans.factory.DisposableBean</code>
        interface allows a bean to get a callback when the container containing
        it is destroyed. The <code class="interfacename">DisposableBean</code>
        interface specifies a single method:</p><pre class="programlisting"><span class="hl-keyword">void</span> destroy() <span class="hl-keyword">throws</span> Exception;</pre><p>It is recommended that you do not use the
        <code class="interfacename">DisposableBean</code> callback interface because
        it unnecessarily couples the code to Spring. Alternatively, specify a
        generic method that is supported by bean definitions. With XML-based
        configuration metadata, you use the <code class="literal">destroy-method</code>
        attribute on the <code class="literal">&lt;bean/&gt;</code>. For example, the
        following definition:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleInitBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"cleanup"</span>/&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> cleanup() {
      <span class="hl-comment">// do some destruction work (like releasing pooled connections)</span>
  }
}</pre><p>...is exactly the same as...</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleInitBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.AnotherExampleBean"</span>/&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AnotherExampleBean <span class="hl-keyword">implements</span> DisposableBean {

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> destroy() {
      <span class="hl-comment">// do some destruction work (like releasing pooled connections)</span>
  }
}</pre><p>... but does not couple the code to Spring.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lifecycle-default-init-destroy-methods"></a>4.6.1.3&nbsp;Default initialization and destroy methods</h4></div></div></div><p>When you write initialization and destroy method callbacks that do
        not use the Spring-specific
        <code class="interfacename">InitializingBean</code> and
        <code class="interfacename">DisposableBean</code> callback interfaces, you
        typically write methods with names such as <code class="literal">init()</code>,
        <code class="literal">initialize()</code>, <code class="literal">dispose()</code>, and so
        on. Ideally, the names of such lifecycle callback methods are
        standardized across a project so that all developers use the same method
        names and ensure consistency.</p><p>You can configure the Spring container to <code class="literal">look</code>
        for named initialization and destroy callback method names on
        <span class="emphasis"><em>every</em></span> bean. This means that you, as an application
        developer, can write your application classes and use an initialization
        callback called <code class="literal">init()</code>, without having to configure
        an <code class="literal">init-method="init"</code> attribute with each bean
        definition. The Spring IoC container calls that method when the bean is
        created (and in accordance with the standard lifecycle callback contract
        described previously). This feature also enforces a consistent naming
        convention for initialization and destroy method callbacks.</p><p>Suppose that your initialization callback methods are named
        <code class="literal">init()</code> and destroy callback methods are named
        <code class="literal">destroy()</code>. Your class will resemble the class in the
        following example.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultBlogService <span class="hl-keyword">implements</span> BlogService {

  <span class="hl-keyword">private</span> BlogDao blogDao;

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBlogDao(BlogDao blogDao) {
      <span class="hl-keyword">this</span>.blogDao = blogDao;
  }

  <span class="hl-comment">// this is (unsurprisingly) the initialization callback method</span>
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init() {
      <span class="hl-keyword">if</span> (<span class="hl-keyword">this</span>.blogDao == null) {
          <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> IllegalStateException(<span class="hl-string">"The [blogDao] property must be set."</span>);
      }
  }
}</pre><pre class="programlisting">&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">default-init-method</span>=<span class="hl-value">"init"</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"blogService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.DefaultBlogService"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"blogDao"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"blogDao"</span> /&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The presence of the <code class="literal">default-init-method</code> attribute
        on the top-level <code class="literal">&lt;beans/&gt;</code> element attribute
        causes the Spring IoC container to recognize a method called
        <code class="literal">init</code> on beans as the initialization method callback.
        When a bean is created and assembled, if the bean class has such a
        method, it is invoked at the appropriate time.</p><p>You configure destroy method callbacks similarly (in XML, that is)
        by using the <code class="literal">default-destroy-method</code> attribute on the
        top-level <code class="literal">&lt;beans/&gt;</code> element.</p><p>Where existing bean classes already have callback methods that are
        named at variance with the convention, you can override the default by
        specifying (in XML, that is) the method name using the
        <code class="literal">init-method</code> and <code class="literal">destroy-method</code>
        attributes of the &lt;bean/&gt; itself.</p><p>The Spring container guarantees that a configured initialization
        callback is called immediately after a bean is supplied with all
        dependencies. Thus the initialization callback is called on the raw bean
        reference, which means that AOP interceptors and so forth are not yet
        applied to the bean. A target bean is fully created
        <span class="emphasis"><em>first</em></span>, <span class="emphasis"><em>then</em></span> an AOP proxy (for
        example) with its interceptor chain is applied. If the target bean and
        the proxy are defined separately, your code can even interact with the
        raw target bean, bypassing the proxy. Hence, it would be inconsistent to
        apply the interceptors to the init method, because doing so would couple
        the lifecycle of the target bean with its proxy/interceptors and leave
        strange semantics when your code interacts directly to the raw target
        bean.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lifecycle-combined-effects"></a>4.6.1.4&nbsp;Combining lifecycle mechanisms</h4></div></div></div><p>As of Spring 2.5, you have three options for controlling bean
        lifecycle behavior: the <a class="link" href="#beans-factory-lifecycle-initializingbean" title="4.6.1.1&nbsp;Initialization callbacks"><code class="interfacename">InitializingBean</code></a> and <a class="link" href="#beans-factory-lifecycle-disposablebean" title="4.6.1.2&nbsp;Destruction callbacks"><code class="interfacename">DisposableBean</code></a> callback
        interfaces; custom <code class="literal">init()</code> and
        <code class="literal">destroy()</code> methods; and the <a class="link" href="#beans-postconstruct-and-predestroy-annotations" title="4.9.6&nbsp;@PostConstruct and @PreDestroy"><code class="interfacename">@PostConstruct</code> and
        <code class="interfacename">@PreDestroy</code> annotations</a>. You can
        combine these mechanisms to control a given bean.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If multiple lifecycle mechanisms are configured for a bean, and
          each mechanism is configured with a different method name, then each
          configured method is executed in the order listed below. However, if
          the same method name is configured - for example,
          <code class="literal">init()</code> for an initialization method - for more than
          one of these lifecycle mechanisms, that method is executed once, as
          explained in the preceding section.</p></td></tr></table></div><p>Multiple lifecycle mechanisms configured for the same bean, with
        different initialization methods, are called as follows:</p><div class="itemizedlist"><ul type="disc"><li><p>Methods annotated with
            <code class="interfacename">@PostConstruct</code></p></li><li><p><code class="literal">afterPropertiesSet()</code> as defined by the
            <code class="interfacename">InitializingBean</code> callback
            interface</p></li><li><p>A custom configured <code class="literal">init()</code> method</p></li></ul></div><p>Destroy methods are called in the same order:</p><div class="itemizedlist"><ul type="disc"><li><p>Methods annotated with
            <code class="interfacename">@PreDestroy</code></p></li><li><p><code class="literal">destroy()</code> as defined by the
            <code class="interfacename">DisposableBean</code> callback
            interface</p></li><li><p>A custom configured <code class="literal">destroy()</code> method</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lifecycle-processor"></a>4.6.1.5&nbsp;Startup and shutdown callbacks</h4></div></div></div><p>The <code class="interfacename">Lifecycle</code> interface defines the
        essential methods for any object that has its own lifecycle requirements
        (e.g. starts and stops some background process):</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Lifecycle {

  <span class="hl-keyword">void</span> start();

  <span class="hl-keyword">void</span> stop();

  <span class="hl-keyword">boolean</span> isRunning();

}</pre><p>Any Spring-managed object may implement that interface. Then, when
        the ApplicationContext itself starts and stops, it will cascade those
        calls to all Lifecycle implementations defined within that context. It
        does this by delegating to a
        <code class="interfacename">LifecycleProcessor</code>:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> LifecycleProcessor <span class="hl-keyword">extends</span> Lifecycle {

  <span class="hl-keyword">void</span> onRefresh();

  <span class="hl-keyword">void</span> onClose();

}</pre><p>Notice that the <code class="interfacename">LifecycleProcessor</code> is
        itself an extension of the <code class="interfacename">Lifecycle</code>
        interface. It also adds two other methods for reacting to the context
        being refreshed and closed.</p><p>The order of startup and shutdown invocations can be important. If a
        "depends-on" relationship exists between any two objects, the dependent
        side will start <span class="emphasis"><em>after</em></span> its dependency, and it will
        stop <span class="emphasis"><em>before</em></span> its dependency. However, at times the
        direct dependencies are unknown. You may only know that objects of a
        certain type should start prior to objects of another type. In those
        cases, the <code class="interfacename">SmartLifecycle</code> interface
        defines another option, namely the <code class="methodname">getPhase()</code>
        method as defined on its super-interface,
        <code class="interfacename">Phased</code>.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Phased {

  <span class="hl-keyword">int</span> getPhase();

}


<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> SmartLifecycle <span class="hl-keyword">extends</span> Lifecycle, Phased {

  <span class="hl-keyword">boolean</span> isAutoStartup();

  <span class="hl-keyword">void</span> stop(Runnable callback);

}</pre><p>When starting, the objects with the lowest phase start first, and
        when stopping, the reverse order is followed. Therefore, an object that
        implements <code class="interfacename">SmartLifecycle</code> and whose
        getPhase() method returns <code class="literal">Integer.MIN_VALUE</code> would be
        among the first to start and the last to stop. At the other end of the
        spectrum, a phase value of <code class="literal">Integer.MAX_VALUE</code> would
        indicate that the object should be started last and stopped first
        (likely because it depends on other processes to be running). When
        considering the phase value, it's also important to know that the
        default phase for any "normal" <code class="interfacename">Lifecycle</code>
        object that does not implement
        <code class="interfacename">SmartLifecycle</code> would be 0. Therefore, any
        negative phase value would indicate that an object should start before
        those standard components (and stop after them), and vice versa for any
        positive phase value.</p><p>As you can see the stop method defined by
        <code class="interfacename">SmartLifecycle</code> accepts a callback. Any
        implementation <span class="emphasis"><em>must</em></span> invoke that callback's run()
        method after that implementation's shutdown process is complete. That
        enables asynchronous shutdown where necessary since the default
        implementation of the <code class="interfacename">LifecycleProcessor</code>
        interface, <code class="classname">DefaultLifecycleProcessor</code>, will wait
        up to its timeout value for the group of objects within each phase to
        invoke that callback. The default per-phase timeout is 30 seconds. You
        can override the default lifecycle processor instance by defining a bean
        named "lifecycleProcessor" within the context. If you only want to
        modify the timeout, then defining the following would be
        sufficient:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"lifecycleProcessor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.support.DefaultLifecycleProcessor"</span>&gt;
  &lt;<span class="hl-comment">!-- timeout value in milliseconds --</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"timeoutPerShutdownPhase"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"10000"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>As mentioned, the <code class="interfacename">LifecycleProcessor</code>
        interface defines callback methods for the refreshing and closing of the
        context as well. The latter will simply drive the shutdown process as if
        stop() had been called explicitly, but it will happen when the context
        is closing. The 'refresh' callback on the other hand enables another
        feature of <code class="interfacename">SmartLifecycle</code> beans. When the
        context is refreshed (after all objects have been instantiated and
        initialized), that callback will be invoked, and at that point the
        default lifecycle processor will check the boolean value returned by
        each <code class="interfacename">SmartLifecycle</code> object's
        <code class="methodname">isAutoStartup()</code> method. If "true", then that
        object will be started at that point rather than waiting for an explicit
        invocation of the context's or its own start() method (unlike the
        context refresh, the context start does not happen automatically for a
        standard context implementation). The "phase" value as well as any
        "depends-on" relationships will determine the startup order in the same
        way as described above.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-shutdown"></a>4.6.1.6&nbsp;Shutting down the Spring IoC container gracefully in non-web
        applications</h4></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>This section applies only to non-web applications. Spring's
          web-based <code class="interfacename">ApplicationContext</code>
          implementations already have code in place to shut down the Spring IoC
          container gracefully when the relevant web application is shut
          down.</p></td></tr></table></div><p>If you are using Spring's IoC container in a non-web application
        environment; for example, in a rich client desktop environment; you
        register a shutdown hook with the JVM. Doing so ensures a graceful
        shutdown and calls the relevant destroy methods on your singleton beans
        so that all resources are released. Of course, you must still configure
        and implement these destroy callbacks correctly.</p><p>To register a shutdown hook, you call the
        <code class="methodname">registerShutdownHook()</code> method that is declared
        on the <code class="classname">AbstractApplicationContext</code> class:</p><pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.context.support.AbstractApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Boot {

  <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) <span class="hl-keyword">throws</span> Exception {
      AbstractApplicationContext ctx
          = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-keyword">new</span> String []{<span class="hl-string">"beans.xml"</span>});

      <span class="hl-comment">// add a shutdown hook for the above context... </span>
      ctx.registerShutdownHook();

      <span class="hl-comment">// app runs here...</span>

      <span class="hl-comment">// main method exits, hook is called prior to the app shutting down...</span>
  }
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-aware"></a>4.6.2&nbsp;<code class="interfacename">ApplicationContextAware</code> and
      <code class="interfacename">BeanNameAware</code></h3></div></div></div><p>When an <code class="interfacename">ApplicationContext</code> creates a
      class that implements the
      <code class="interfacename">org.springframework.context.ApplicationContextAware</code>
      interface, the class is provided with a reference to that
      <code class="interfacename">ApplicationContext</code>.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ApplicationContextAware {

  <span class="hl-keyword">void</span> setApplicationContext(ApplicationContext applicationContext) <span class="hl-keyword">throws</span> BeansException;
}</pre><p>Thus beans can manipulate programmatically the
      <code class="interfacename">ApplicationContext</code> that created them,
      through the <code class="interfacename">ApplicationContext</code> interface,
      or by casting the reference to a known subclass of this interface, such as
      <code class="classname">ConfigurableApplicationContext</code>, which exposes
      additional functionality. One use would be the programmatic retrieval of
      other beans. Sometimes this capability is useful; however, in general you
      should avoid it, because it couples the code to Spring and does not follow
      the Inversion of Control style, where collaborators are provided to beans
      as properties. Other methods of the ApplicationContext provide access to
      file resources, publishing application events, and accessing a
      MessageSource. These additional features are described in <a class="xref" href="#context-introduction" title="4.14&nbsp;Additional Capabilities of the ApplicationContext">Section&nbsp;4.14, &#8220;Additional Capabilities of the
    ApplicationContext&#8221;</a></p><p>As of Spring 2.5, autowiring is another alternative to obtain
      reference to the <code class="interfacename">ApplicationContext</code>. The
      "traditional" <code class="literal">constructor</code> and <code class="literal">byType</code>
      autowiring modes (as described in <a class="xref" href="#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators">Section&nbsp;4.4.5, &#8220;Autowiring collaborators&#8221;</a>) can provide a dependency of type
      <code class="interfacename">ApplicationContext</code> for a constructor
      argument or setter method parameter, respectively. For more flexibility,
      including the ability to autowire fields and multiple parameter methods,
      use the new annotation-based autowiring features. If you do, the
      <code class="interfacename">ApplicationFactory</code> is autowired into a
      field, constructor argument, or method parameter that is expecting the
      <code class="interfacename">BeanFactory</code> type if the field, constructor,
      or method in question carries the
      <code class="interfacename">@Autowired</code> annotation. For more
      information, see <a class="xref" href="#beans-autowired-annotation" title="4.9.2&nbsp;@Autowired">Section&nbsp;4.9.2, &#8220;@Autowired&#8221;</a>.</p><p>When an ApplicationContext creates a class that implements the
      <code class="interfacename">org.springframework.beans.factory.BeanNameAware</code>
      interface, the class is provided with a reference to the name defined in
      its associated object definition.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> BeanNameAware {

  <span class="hl-keyword">void</span> setBeanName(string name) <span class="hl-keyword">throws</span> BeansException;
}</pre><p>The callback is invoked after population of normal bean properties but
      before an initialization callback such as
      <code class="interfacename">InitializingBean</code>s
      <span class="emphasis"><em>afterPropertiesSet</em></span> or a custom init-method.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aware-list"></a>4.6.3&nbsp;Other <code class="interfacename">Aware</code> interfaces</h3></div></div></div><p>Besides <code class="interfacename">ApplicationContextAware</code> and
      <code class="interfacename">BeanNameAware</code> discussed above, Spring
      offers a range of
      <span class="emphasis"><em><code class="interfacename">Aware</code></em></span> interfaces that
      allow beans to indicate to the container that they require a certain
      <span class="emphasis"><em>infrastructure</em></span> dependency. The most important
      <code class="interfacename">Aware</code> interfaces are summarized below - as
      a general rule, the name is a good indication of the dependency
      type:</p><div class="table"><a name="beans-factory-nature-aware-list"></a><p class="title"><b>Table&nbsp;4.4.&nbsp;<code class="interfacename">Aware</code> interfaces</b></p><div class="table-contents"><table summary="Aware interfaces" width="100%" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="left"><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Name</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Injected Dependency</th><th style="border-bottom: 1.0pt solid ; ">Explained in...</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="classname">ApplicationContextAware</code></p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p>Declaring
              <code class="interfacename">ApplicationContext</code></p></td><td style="border-bottom: 1.0pt solid ; "><p><a class="xref" href="#beans-factory-aware" title="4.6.2&nbsp;ApplicationContextAware and BeanNameAware">Section&nbsp;4.6.2, &#8220;ApplicationContextAware and
      BeanNameAware&#8221;</a></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="classname">ApplicationEventPublisherAware</code></p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p>Event publisher of the enclosing
              <code class="interfacename">ApplicationContext</code></p></td><td style="border-bottom: 1.0pt solid ; "><p><a class="xref" href="#context-introduction" title="4.14&nbsp;Additional Capabilities of the ApplicationContext">Section&nbsp;4.14, &#8220;Additional Capabilities of the
    ApplicationContext&#8221;</a></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="classname">BeanClassLoaderAware</code></p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p>Class loader used to load the bean
              classes.</p></td><td style="border-bottom: 1.0pt solid ; "><p><a class="xref" href="#beans-factory-class" title="4.3.2&nbsp;Instantiating beans">Section&nbsp;4.3.2, &#8220;Instantiating beans&#8221;</a></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="classname">BeanFactoryAware</code></p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p>Declaring
              <code class="interfacename">BeanFactory</code></p></td><td style="border-bottom: 1.0pt solid ; "><p><a class="xref" href="#beans-factory-aware" title="4.6.2&nbsp;ApplicationContextAware and BeanNameAware">Section&nbsp;4.6.2, &#8220;ApplicationContextAware and
      BeanNameAware&#8221;</a></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="classname">BeanNameAware</code></p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p>Name of the declaring bean</p></td><td style="border-bottom: 1.0pt solid ; "><p><a class="xref" href="#beans-factory-aware" title="4.6.2&nbsp;ApplicationContextAware and BeanNameAware">Section&nbsp;4.6.2, &#8220;ApplicationContextAware and
      BeanNameAware&#8221;</a></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="classname">BootstrapContextAware</code></p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p>Resource adapter
              <code class="interfacename">BootstrapContext</code> the container runs
              in. Typically available only in JCA aware
              <code class="interfacename">ApplicationContext</code>s</p></td><td style="border-bottom: 1.0pt solid ; "><p><a class="xref" href="#cci" title="24.&nbsp;JCA CCI">Chapter&nbsp;24, <i>JCA CCI</i></a></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="classname">LoadTimeWeaverAware</code></p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p>Defined <span class="emphasis"><em>weaver</em></span> for processing
              class definition at load time</p></td><td style="border-bottom: 1.0pt solid ; "><p><a class="xref" href="#aop-aj-ltw" title="8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;8.8.4, &#8220;Load-time weaving with AspectJ in the Spring Framework&#8221;</a></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="classname">MessageSourceAware</code></p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p>Configured strategy for resolving messages (with
              support for parametrization and
              internationalization)</p></td><td style="border-bottom: 1.0pt solid ; "><p><a class="xref" href="#context-introduction" title="4.14&nbsp;Additional Capabilities of the ApplicationContext">Section&nbsp;4.14, &#8220;Additional Capabilities of the
    ApplicationContext&#8221;</a></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="classname">NotificationPublisherAware</code></p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p>Spring JMX notification publisher</p></td><td style="border-bottom: 1.0pt solid ; "><p><a class="xref" href="#jmx-notifications" title="23.7&nbsp;Notifications">Section&nbsp;23.7, &#8220;Notifications&#8221;</a></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="classname">PortletConfigAware</code></p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p>Current <code class="interfacename">PortletConfig</code>
              the container runs in. Valid only in a web-aware Spring
              <code class="interfacename">ApplicationContext</code></p></td><td style="border-bottom: 1.0pt solid ; "><p><a class="xref" href="#portlet" title="19.&nbsp;Portlet MVC Framework">Chapter&nbsp;19, <i>Portlet MVC Framework</i></a></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="classname">PortletContextAware</code></p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p>Current <code class="interfacename">PortletContext</code>
              the container runs in. Valid only in a web-aware Spring
              <code class="interfacename">ApplicationContext</code></p></td><td style="border-bottom: 1.0pt solid ; "><p><a class="xref" href="#portlet" title="19.&nbsp;Portlet MVC Framework">Chapter&nbsp;19, <i>Portlet MVC Framework</i></a></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="classname">ResourceLoaderAware</code></p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p>Configured loader for low-level access to
              resources</p></td><td style="border-bottom: 1.0pt solid ; "><p><a class="xref" href="#resources" title="5.&nbsp;Resources">Chapter&nbsp;5, <i>Resources</i></a></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="classname">ServletConfigAware</code></p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p>Current <code class="interfacename">ServletConfig</code>
              the container runs in. Valid only in a web-aware Spring
              <code class="interfacename">ApplicationContext</code></p></td><td style="border-bottom: 1.0pt solid ; "><p><a class="xref" href="#mvc" title="16.&nbsp;Web MVC framework">Chapter&nbsp;16, <i>Web MVC framework</i></a></p></td></tr><tr><td style="border-right: 1.0pt solid ; " align="left"><p><code class="classname">ServletContextAware</code></p></td><td style="border-right: 1.0pt solid ; "><p>Current <code class="interfacename">ServletContext</code>
              the container runs in. Valid only in a web-aware Spring
              <code class="interfacename">ApplicationContext</code></p></td><td style=""><p><a class="xref" href="#mvc" title="16.&nbsp;Web MVC framework">Chapter&nbsp;16, <i>Web MVC framework</i></a></p></td></tr></tbody></table></div></div><br class="table-break"><p>Note again that usage of these interfaces ties your code to the Spring
      API and does not follow the Inversion of Control style. As such, they are
      recommended for infrastructure beans that require programmatic access to
      the container.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-child-bean-definitions"></a>4.7&nbsp;Bean definition inheritance</h2></div></div></div><p>A bean definition can contain a lot of configuration information,
      including constructor arguments, property values, and container-specific
      information such as initialization method, static factory method name, and
      so on. A child bean definition inherits configuration data from a parent
      definition. The child definition can override some values, or add others,
      as needed. Using parent and child bean definitions can save a lot of
      typing. Effectively, this is a form of templating.</p><p>If you work with an <code class="interfacename">ApplicationContext</code>
      interface programmatically, child bean definitions are represented by the
      <code class="classname">ChildBeanDefinition</code> class. Most users do not work
      with them on this level, instead configuring bean definitions
      declaratively in something like the
      <code class="classname">ClassPathXmlApplicationContext</code>. When you use
      XML-based configuration metadata, you indicate a child bean definition by
      using the <code class="literal">parent</code> attribute, specifying the parent bean
      as the value of this attribute.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"inheritedTestBean"</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">"true"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.TestBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"parent"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"inheritsWithDifferentClass"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.DerivedTestBean"</span>
      <span class="hl-attribute">parent</span>=<span class="hl-value">"inheritedTestBean"</span> <span class="hl-attribute">init-method</span>=<span class="hl-value">"initialize"</span>&gt;

  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"override"</span>/&gt;
  &lt;<span class="hl-comment">!-- the age property value of 1 will be inherited from  parent --</span>&gt;

&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>A child bean definition uses the bean class from the parent definition
      if none is specified, but can also override it. In the latter case, the
      child bean class must be compatible with the parent, that is, it must
      accept the parent's property values.</p><p>A child bean definition inherits constructor argument values, property
      values, and method overrides from the parent, with the option to add new
      values. Any initialization method, destroy method, and/or
      <code class="literal">static</code> factory method settings that you specify will
      override the corresponding parent settings.</p><p>The remaining settings are <span class="emphasis"><em>always</em></span> taken from the
      child definition: <span class="emphasis"><em>depends on</em></span>, <span class="emphasis"><em>autowire
      mode</em></span>, <span class="emphasis"><em>dependency check</em></span>,
      <span class="emphasis"><em>singleton</em></span>, <span class="emphasis"><em>scope</em></span>, <span class="emphasis"><em>lazy
      init</em></span>.</p><p>The preceding example explicitly marks the parent bean definition as
      abstract by using the <code class="literal">abstract</code> attribute. If the parent
      definition does not specify a class, explicitly marking the parent bean
      definition as <code class="literal">abstract</code> is required, as follows:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"inheritedTestBeanWithoutClass"</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">"true"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"parent"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"inheritsWithClass"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.DerivedTestBean"</span>
    <span class="hl-attribute">parent</span>=<span class="hl-value">"inheritedTestBeanWithoutClass"</span> <span class="hl-attribute">init-method</span>=<span class="hl-value">"initialize"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"override"</span>/&gt;
  &lt;<span class="hl-comment">!-- age will inherit the value of 1 from the parent bean definition--</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The parent bean cannot be instantiated on its own because it is
      incomplete, and it is also explicitly marked as
      <code class="literal">abstract</code>. When a definition is
      <code class="literal">abstract</code> like this, it is usable only as a pure
      template bean definition that serves as a parent definition for child
      definitions. Trying to use such an <code class="literal">abstract</code> parent bean
      on its own, by referring to it as a ref property of another bean or doing
      an explicit <code class="methodname">getBean()</code> call with the parent bean
      id, returns an error. Similarly, the container's internal
      <code class="methodname">preInstantiateSingletons()</code> method ignores bean
      definitions that are defined as abstract.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">ApplicationContext</code> pre-instantiates all
        singletons by default. Therefore, it is important (at least for
        singleton beans) that if you have a (parent) bean definition which you
        intend to use only as a template, and this definition specifies a class,
        you must make sure to set the <span class="emphasis"><em>abstract</em></span> attribute to
        <span class="emphasis"><em>true</em></span>, otherwise the application context will
        actually (attempt to) pre-instantiate the <code class="literal">abstract</code>
        bean.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-factory-extension"></a>4.8&nbsp;Container Extension Points</h2></div></div></div><p>Typically, an application developer does not need to subclass
    <code class="interfacename">ApplicationContext</code> implementation classes.
    Instead, the Spring IoC container can be extended by plugging in
    implementations of special integration interfaces. The next few sections
    describe these integration interfaces.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-extension-bpp"></a>4.8.1&nbsp;Customizing beans using a
      <code class="interfacename">BeanPostProcessor</code></h3></div></div></div><p>The <code class="interfacename">BeanPostProcessor</code> interface defines
      <em class="firstterm">callback methods</em> that you can implement to provide
      your own (or override the container's default) instantiation logic,
      dependency-resolution logic, and so forth. If you want to implement some
      custom logic after the Spring container finishes instantiating,
      configuring, and initializing a bean, you can plug in one or
      more <code class="interfacename">BeanPostProcessor</code>
      implementations.</p><p>You can configure multiple <code class="literal">BeanPostProcessor</code>
      instances, and you can control the order in which these
      <code class="literal">BeanPostProcessor</code>s execute by setting the
      <code class="literal">order</code> property. You can set this property only if the
      <code class="interfacename">BeanPostProcessor</code> implements the
      <code class="interfacename">Ordered</code> interface; if you write your own
      <code class="interfacename">BeanPostProcessor</code> you should consider
      implementing the <code class="interfacename">Ordered</code> interface too. For
      further details, consult the Javadoc for the
      <code class="interfacename">BeanPostProcessor</code> and
      <code class="interfacename">Ordered</code> interfaces. See also the note below on
      <a class="link" href="#beans-factory-programmatically-registering-beanpostprocessors">
      programmatic registration of <code class="interfacename">BeanPostProcessors</code>
      </a></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">BeanPostProcessor</code>s operate on bean (or object)
        <span class="emphasis"><em>instances</em></span>; that is to say, the Spring IoC container
        instantiates a bean instance and <span class="emphasis"><em>then</em></span>
        <code class="literal">BeanPostProcessor</code>s do their work.</p><p><code class="literal">BeanPostProcessor</code>s are scoped
        <span class="emphasis"><em>per-container</em></span>. This is only relevant if you are
        using container hierarchies. If you define a
        <code class="interfacename">BeanPostProcessor</code> in one container, it
        will <span class="emphasis"><em>only</em></span> post-process the beans in that
        container. In other words, beans that are defined in one container are not
        post-processed by a <code class="literal">BeanPostProcessor</code> defined in another
        container, even if both containers are part of the same hierarchy.</p><p>To change the actual bean definition (i.e., the
        <span class="emphasis"><em>blueprint</em></span> that defines the bean), you instead need to use a
        <code class="interfacename">BeanFactoryPostProcessor</code> as described
        in <a class="xref" href="#beans-factory-extension-factory-postprocessors" title="4.8.2&nbsp;Customizing configuration metadata with a BeanFactoryPostProcessor">Section&nbsp;4.8.2, &#8220;Customizing configuration metadata with a
      BeanFactoryPostProcessor&#8221;</a>.</p></td></tr></table></div><p>The
      <code class="interfacename">org.springframework.beans.factory.config.BeanPostProcessor</code>
      interface consists of exactly two callback methods. When such a class is
      registered as a post-processor with the container, for each bean instance
      that is created by the container, the post-processor gets a callback from
      the container both <span class="emphasis"><em>before</em></span> container initialization
      methods (such as InitializingBean's <span class="emphasis"><em>afterPropertiesSet()</em></span>
      and any declared init method) are called as well as <span class="emphasis"><em>after</em></span>
      any bean initialization callbacks. The post-processor can take
      any action with the bean instance, including ignoring the callback
      completely. A bean post-processor typically checks for callback
      interfaces or may wrap a bean with a proxy. Some Spring AOP
      infrastructure classes are implemented as bean post-processors in order
      to provide proxy-wrapping logic.</p><p>An <code class="interfacename">ApplicationContext</code>
      <span class="emphasis"><em>automatically detects</em></span> any beans that are defined in
      the configuration metadata which implement the
      <code class="interfacename">BeanPostProcessor</code> interface. The
      <code class="interfacename">ApplicationContext</code> registers these beans as
      post-processors so that they can be called later upon bean creation.
      Bean post-processors can be deployed in the container just like any other
      beans.</p><a name="beans-factory-programmatically-registering-beanpostprocessors"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Programmatically registering BeanPostProcessors&#xA;        "><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Programmatically registering BeanPostProcessors
        </th></tr><tr><td align="left" valign="top"><p>
         While the recommended approach for <code class="interfacename">BeanPostProcessor
         </code> registration is through <code class="interfacename">ApplicationContext
         </code> auto-detection (as described above), it is also
         possible to register them <span class="emphasis"><em>programmatically</em></span>
         against a <code class="interfacename">ConfigurableBeanFactory</code> using the
         <code class="methodname">addBeanPostProcessor</code> method. This can be useful
         when needing to evaluate conditional logic before registration, or even
         for copying bean post processors across contexts in a hierarchy.  Note
         however that <code class="interfacename">BeanPostProcessors</code> added
         programmatically <span class="emphasis"><em>do not respect the <code class="interfacename">Ordered
         </code> interface</em></span>. Here it is the <span class="emphasis"><em>order of
         registration</em></span> that dictates the order of execution.  Note also
         that <code class="interfacename">BeanPostProcessors</code> registered
         programmatically are always processed before those registered through
         auto-detection, regardless of any explicit ordering.
      </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: BeanPostProcessors and AOP&#xA;        auto-proxying"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">BeanPostProcessors and AOP
        auto-proxying</th></tr><tr><td align="left" valign="top"><p>Classes that implement the
        <code class="interfacename">BeanPostProcessor</code> interface are
        <span class="emphasis"><em>special</em></span> and are treated differently by the
        container. All <code class="interfacename">BeanPostProcessors</code>
        <span class="emphasis"><em>and beans that they reference directly</em></span> are
        instantiated on startup, as part of the special startup phase of the
        <code class="interfacename">ApplicationContext</code>. Next, all
        <code class="interfacename">BeanPostProcessors</code> are registered in a
        sorted fashion and applied to all further beans in the container.
        Because AOP auto-proxying is implemented as a
        <code class="interfacename">BeanPostProcessor</code> itself, neither
        <code class="interfacename">BeanPostProcessors</code> nor the beans they reference
        directly are eligible for auto-proxying, and thus do not have aspects woven
        into them.</p><p>For any such bean, you should see an informational log message:
        &#8220;<span class="quote"><span class="emphasis"><em>Bean foo is not eligible for getting processed by all
        BeanPostProcessor interfaces (for example: not eligible for
        auto-proxying)</em></span></span>&#8221;.</p></td></tr></table></div><p>The following examples show how to write, register, and use
      <code class="literal">BeanPostProcessors</code> in an
      <code class="interfacename">ApplicationContext</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-extension-bpp-examples-hw"></a>4.8.1.1&nbsp;Example: Hello World,
        <code class="interfacename">BeanPostProcessor</code>-style</h4></div></div></div><p>This first example illustrates basic usage. The example shows a
        custom <code class="interfacename">BeanPostProcessor</code> implementation
        that invokes the <code class="methodname">toString()</code> method of each bean
        as it is created by the container and prints the resulting string to the
        system console.</p><p>Find below the custom
        <code class="interfacename">BeanPostProcessor</code> implementation class
        definition:</p><pre class="programlisting"><span class="hl-keyword">package</span> scripting;

<span class="hl-keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;
<span class="hl-keyword">import</span> org.springframework.beans.BeansException;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> InstantiationTracingBeanPostProcessor <span class="hl-keyword">implements</span> BeanPostProcessor {

  <span class="hl-comment">// simply return the instantiated bean as-is</span>
  <span class="hl-keyword">public</span> Object postProcessBeforeInitialization(Object bean, String beanName)
                                                                     <span class="hl-keyword">throws</span> BeansException {
      <span class="hl-keyword">return</span> bean; <span class="hl-comment">// we could potentially return any object reference here...</span>
  }

  <span class="hl-keyword">public</span> Object postProcessAfterInitialization(Object bean, String beanName)
                                                                     <span class="hl-keyword">throws</span> BeansException {
      System.out.println(<span class="hl-string">"Bean '"</span> + beanName + <span class="hl-string">"' created : "</span> + bean.toString());
      <span class="hl-keyword">return</span> bean;
  }
}</pre><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xmlns:lang</span>=<span class="hl-value">"http://www.springframework.org/schema/lang"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
         http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
         http://www.springframework.org/schema/lang
         http://www.springframework.org/schema/lang/spring-lang-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messenger"</span>
        <span class="hl-attribute">script-source</span>=<span class="hl-value">"classpath:org/springframework/scripting/groovy/Messenger.groovy"</span>&gt;
      &lt;<span class="hl-tag">lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"message"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Fiona Apple Is Just So Dreamy."</span>/&gt;
  &lt;<span class="hl-tag">/lang:groovy</span>&gt;

  &lt;<span class="hl-comment">!--
      when the above bean (messenger) is instantiated, this custom
      BeanPostProcessor implementation will output the fact to the system console
   --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"scripting.InstantiationTracingBeanPostProcessor"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Notice how the
        <code class="classname">InstantiationTracingBeanPostProcessor</code> is simply
        defined. It does not even have a name, and because it is a bean it can
        be dependency-injected just like any other bean. (The preceding
        configuration also defines a bean that is backed by a Groovy script. The
        Spring 2.0 dynamic language support is detailed in the chapter entitled
        <a class="xref" href="#dynamic-language" title="27.&nbsp;Dynamic language support">Chapter&nbsp;27, <i>Dynamic language support</i></a>.)</p><p>The following simple Java application executes the preceding code and
        configuration:</p><pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.context.ApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;
<span class="hl-keyword">import</span> org.springframework.scripting.Messenger;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Boot {

  <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) <span class="hl-keyword">throws</span> Exception {
      ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"scripting/beans.xml"</span>);
      Messenger messenger = (Messenger) ctx.getBean(<span class="hl-string">"messenger"</span>);
      System.out.println(messenger);
  }
}</pre><p>The output of the preceding application resembles the
        following:</p><pre class="programlisting">Bean 'messenger' created : org.springframework.scripting.groovy.GroovyMessenger@272961
org.springframework.scripting.groovy.GroovyMessenger@272961</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-extension-bpp-examples-rabpp"></a>4.8.1.2&nbsp;Example: The
        <code class="classname">RequiredAnnotationBeanPostProcessor</code></h4></div></div></div><p>Using callback interfaces or annotations in conjunction with a
        custom <code class="interfacename">BeanPostProcessor</code> implementation
        is a common means of extending the Spring IoC container. An example is
        Spring's <code class="classname">RequiredAnnotationBeanPostProcessor</code> &#8212; a
        <code class="interfacename">BeanPostProcessor</code> implementation that
        ships with the Spring distribution which ensures that JavaBean
        properties on beans that are marked with an (arbitrary) annotation are
        actually (configured to be) dependency-injected with a value.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-extension-factory-postprocessors"></a>4.8.2&nbsp;Customizing configuration metadata with a
      <code class="interfacename">BeanFactoryPostProcessor</code></h3></div></div></div><p>The next extension point that we will look at is the
      <code class="interfacename">org.springframework.beans.factory.config.BeanFactoryPostProcessor</code>.
      The semantics of this interface are similar to those of the
      <code class="interfacename">BeanPostProcessor</code>, with one major
      difference: <code class="literal">BeanFactoryPostProcessor</code>s operate on the
      <span class="emphasis"><em>bean configuration metadata</em></span>; that is, the Spring IoC
      container allows <code class="literal">BeanFactoryPostProcessors</code> to read the
      configuration metadata and potentially change it
      <span class="emphasis"><em>before</em></span> the container instantiates any beans other
      than <code class="literal">BeanFactoryPostProcessors</code>.</p><p>You can configure multiple
      <code class="literal">BeanFactoryPostProcessors</code>, and you can control the order in
      which these <code class="literal">BeanFactoryPostProcessors</code> execute by
      setting the <code class="literal">order</code> property. However, you can only set
      this property if the
      <code class="interfacename">BeanFactoryPostProcessor</code> implements the
      <code class="interfacename">Ordered</code> interface. If you write your own
      <code class="interfacename">BeanFactoryPostProcessor</code>, you should
      consider implementing the <code class="interfacename">Ordered</code> interface
      too. Consult the Javadoc for the
      <code class="interfacename">BeanFactoryPostProcessor</code> and
      <code class="interfacename">Ordered</code> interfaces for more details.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you want to change the actual bean <span class="emphasis"><em>instances</em></span>
        (i.e., the objects that are created from the configuration metadata), then you
        instead need to use a <code class="interfacename">BeanPostProcessor</code>
        (described above in <a class="xref" href="#beans-factory-extension-bpp" title="4.8.1&nbsp;Customizing beans using a BeanPostProcessor">Section&nbsp;4.8.1, &#8220;Customizing beans using a
      BeanPostProcessor&#8221;</a>). While
        it is technically possible to work with bean instances within a
        <code class="interfacename">BeanFactoryPostProcessor</code> (e.g., using
        <code class="methodname">BeanFactory.getBean()</code>), doing so causes
        premature bean instantiation, violating the standard container lifecycle.
        This may cause negative side effects such as bypassing bean post
        processing.</p><p>Also, <code class="literal">BeanFactoryPostProcessors</code> are scoped
        <span class="emphasis"><em>per-container</em></span>. This is only relevant if you are
        using container hierarchies. If you define a
        <code class="interfacename">BeanFactoryPostProcessor</code> in one
        container, it will <span class="emphasis"><em>only</em></span> be applied to the bean
        definitions in that container. Bean definitions in one container
        will not be post-processed by
        <code class="literal">BeanFactoryPostProcessors</code> in another container, even
        if both containers are part of the same hierarchy.</p></td></tr></table></div><p>A bean factory post-processor is executed automatically when it is
      declared inside an <code class="interfacename">ApplicationContext</code>,
      in order to apply changes to the configuration metadata that define the
      container. Spring includes a number of predefined bean factory
      post-processors, such as <code class="classname">PropertyOverrideConfigurer</code>
      and <code class="classname">PropertyPlaceholderConfigurer</code>. A custom
      <code class="interfacename">BeanFactoryPostProcessor</code> can also be used,
      for example, to register custom property editors.</p><a name="beans-factory-autodetect-beanfactorypostprocessors"></a><p>An <code class="interfacename">ApplicationContext</code> automatically
      detects any beans that are deployed into it that implement the
      <code class="interfacename">BeanFactoryPostProcessor</code> interface. It
      uses these beans as bean factory post-processors, at the
      appropriate time. You can deploy these post-processor beans as you
      would any other bean.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>As with <code class="interfacename">BeanPostProcessor</code>s, you typically
        do not want to configure <code class="interfacename">BeanFactoryPostProcessor</code>s
        for lazy initialization. If no other bean references a
        <code class="interfacename">Bean(Factory)PostProcessor</code>,
        that post-processor will not get instantiated at all. Thus, marking it for
        lazy initialization will be ignored, and the 
        <code class="interfacename">Bean(Factory)PostProcessor</code> will be
        instantiated eagerly even if you set the <code class="literal">default-lazy-init</code>
        attribute to <code class="literal">true</code> on the declaration of your
        <code class="code">&lt;beans /&gt;</code> element.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-placeholderconfigurer"></a>4.8.2.1&nbsp;Example: the
        <code class="interfacename">PropertyPlaceholderConfigurer</code></h4></div></div></div><p>You use the
        <code class="interfacename">PropertyPlaceholderConfigurer</code> to
        externalize property values from a bean definition in a separate
        file using the standard Java <code class="classname">Properties</code> format.
        Doing so enables the person deploying an application to customize
        environment-specific properties such as database URLs and passwords,
        without the complexity or risk of modifying the main XML definition file
        or files for the container.</p><p>Consider the following XML-based configuration metadata fragment,
        where a <code class="interfacename">DataSource</code> with placeholder
        values is defined. The example shows properties configured from an
        external <code class="classname">Properties</code> file. At runtime, a
        <code class="classname">PropertyPlaceholderConfigurer</code> is applied to the
        metadata that will replace some properties of the DataSource. The values
        to replace are specified as <span class="emphasis"><em>placeholders</em></span> of the form
        ${property-name} which follows the Ant / log4j / JSP EL style.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"locations"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"classpath:com/foo/jdbc.properties"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.driverClassName}"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The actual values come from another file in the standard Java
        <code class="classname">Properties</code> format:</p><pre class="programlisting">jdbc.driverClassName=org.hsqldb.jdbcDriver
jdbc.url=jdbc:hsqldb:hsql://production:9002
jdbc.username=sa
jdbc.password=root</pre><p>Therefore, the string <code class="literal">${jdbc.username}</code> is replaced
        at runtime with the value 'sa', and the same applies for other placeholder
        values that match keys in the properties file. The
        <code class="classname">PropertyPlaceholderConfigurer</code> checks for
        placeholders in most properties and attributes of a bean definition.
        Furthermore, the placeholder prefix and suffix can be customized.</p><p>With the <code class="literal">context</code> namespace introduced in Spring
        2.5, it is possible to configure property placeholders with a dedicated
        configuration element. One or more locations can be provided as a
        comma-separated list in the <code class="literal">location</code>
        attribute.</p><pre class="programlisting">&lt;<span class="hl-tag">context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:com/foo/jdbc.properties"</span>/&gt;</pre><p>The <code class="classname">PropertyPlaceholderConfigurer</code> not only
        looks for properties in the <code class="classname">Properties</code> file
        you specify. By default it also checks against the Java
        <code class="classname">System</code> properties if it cannot find a property
        in the specified properties files. You can customize this behavior by setting the
        <code class="literal">systemPropertiesMode</code> property of the configurer with
        one of the following three supported integer values:
        
        
        </p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>never</em></span> (0): Never check system properties</p></li><li><p><span class="emphasis"><em>fallback</em></span> (1): Check system properties if not resolvable in the specified properties files. This is the default.</p></li><li><p><span class="emphasis"><em>override</em></span> (2): Check system properties first, before trying the specified properties files. This allows system properties to override any other property source.</p></li></ul></div><p>
        Consult the Javadoc for the <code class="classname">PropertyPlaceholderConfigurer</code>
        for more information.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Class name substitution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Class name substitution</th></tr><tr><td align="left" valign="top"><p>You can use the
          <code class="classname">PropertyPlaceholderConfigurer</code> to substitute
          class names, which is sometimes useful when you have to pick a
          particular implementation class at runtime. For example:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"locations"</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;classpath:com/foo/strategy.properties&lt;<span class="hl-tag">/value</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"properties"</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;custom.strategy.class=com.foo.DefaultStrategy&lt;<span class="hl-tag">/value</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceStrategy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"${custom.strategy.class}"</span>/&gt;</pre><p>If the class cannot be resolved at runtime to a valid class,
          resolution of the bean fails when it is about to be created, which is
          during the <code class="methodname">preInstantiateSingletons()</code> phase
          of an <code class="interfacename">ApplicationContext</code> for a
          non-lazy-init bean.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-overrideconfigurer"></a>4.8.2.2&nbsp;Example: the
        <code class="classname">PropertyOverrideConfigurer</code></h4></div></div></div><p>The <code class="classname">PropertyOverrideConfigurer</code>, another bean
        factory post-processor, resembles the
        <code class="interfacename">PropertyPlaceholderConfigurer</code>, but unlike
        the latter, the original definitions can have default values or no
        values at all for bean properties. If an overriding
        <code class="classname">Properties</code> file does not have an entry for a
        certain bean property, the default context definition is used.</p><p>Note that the bean definition is <span class="emphasis"><em>not</em></span> aware of
        being overridden, so it is not immediately obvious from the XML
        definition file that the override configurer is being used. In case of
        multiple <code class="classname">PropertyOverrideConfigurer</code> instances
        that define different values for the same bean property, the last one
        wins, due to the overriding mechanism.</p><p>Properties file configuration lines take this format:</p><pre class="programlisting">beanName.property=value</pre><p>For example:</p><pre class="programlisting">dataSource.driverClassName=com.mysql.jdbc.Driver
dataSource.url=jdbc:mysql:mydb</pre><p>This example file can be used with a container definition that
        contains a bean called <span class="emphasis"><em>dataSource</em></span>, which has
        <span class="emphasis"><em>driver</em></span> and <span class="emphasis"><em>url</em></span>
        properties.</p><p>Compound property names are also supported, as long as every
        component of the path except the final property being overridden is
        already non-null (presumably initialized by the constructors). In this
        example...</p><pre class="programlisting">foo.fred.bob.sammy=123</pre><p>... the <code class="literal">sammy</code> property of the
        <code class="literal">bob</code> property of the <code class="literal">fred</code> property
        of the <code class="literal">foo</code> bean is set to the scalar value
        <code class="literal">123</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Specified override values are always <span class="emphasis"><em>literal</em></span>
          values; they are not translated into bean references. This convention
          also applies when the original value in the XML bean definition
          specifies a bean reference.</p></td></tr></table></div><p>With the <code class="literal">context</code> namespace introduced in Spring
        2.5, it is possible to configure property overriding with a dedicated
        configuration element:</p><pre class="programlisting">&lt;<span class="hl-tag">context:property-override</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:override.properties"</span>/&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-extension-factorybean"></a>4.8.3&nbsp;Customizing instantiation logic with a
      <code class="interfacename">FactoryBean</code></h3></div></div></div><p>Implement the
      <code class="interfacename">org.springframework.beans.factory.FactoryBean</code>
      interface for objects that <span class="emphasis"><em>are themselves
      factories</em></span>.</p><p>The <code class="interfacename">FactoryBean</code> interface is a point of
      pluggability into the Spring IoC container's instantiation logic. If you
      have complex initialization code that is better expressed in Java as
      opposed to a (potentially) verbose amount of XML, you can create your own
      <code class="interfacename">FactoryBean</code>, write the complex
      initialization inside that class, and then plug your custom
      <code class="interfacename">FactoryBean</code> into the container.</p><p>The <code class="interfacename">FactoryBean</code> interface provides
      three methods:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="methodname">Object getObject()</code>: returns an instance
          of the object this factory creates. The instance can possibly be
          shared, depending on whether this factory returns singletons or
          prototypes.</p></li><li><p><code class="methodname">boolean isSingleton()</code>: returns
          <code class="literal">true</code> if this
          <code class="interfacename">FactoryBean</code> returns singletons,
          <code class="literal">false</code> otherwise.</p></li><li><p><code class="methodname">Class getObjectType()</code>: returns the object
          type returned by the <code class="methodname">getObject()</code> method or
          <code class="literal">null</code> if the type is not known in advance.</p></li></ul></div><p>The <code class="interfacename">FactoryBean</code> concept and interface
      is used in a number of places within the Spring Framework; more than 50
      implementations of the <code class="interfacename">FactoryBean</code>
      interface ship with Spring itself.</p><p>When you need to ask a container for an actual
      <code class="interfacename">FactoryBean</code> instance itself instead of the bean
      it produces, preface the bean's id with the ampersand symbol
      (<code class="literal">&amp;</code>) when calling the
      <code class="methodname">getBean()</code> method of the
      <code class="interfacename">ApplicationContext</code>. So for a given
      <code class="interfacename">FactoryBean</code> with an id of
      <code class="literal">myBean</code>, invoking <code class="literal">getBean("myBean")</code>
      on the container returns the product of the
      <code class="interfacename">FactoryBean</code>; whereas, invoking
      <code class="literal">getBean("&amp;myBean")</code> returns the
      <code class="interfacename">FactoryBean</code> instance
      itself.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-annotation-config"></a>4.9&nbsp;Annotation-based container configuration</h2></div></div></div><div class="sidebar"><p class="title"><b>Are annotations better than XML for configuring Spring?</b></p><p>The introduction of annotation-based configurations raised the
      question of whether this approach is 'better' than XML. The short answer
      is <span class="emphasis"><em>it depends</em></span>. The long answer is that each approach
      has its pros and cons, and usually it is up to the developer to decide
      which strategy suits her better. Due to the way they are defined,
      annotations provide a lot of context in their declaration, leading to
      shorter and more concise configuration. However, XML excels at wiring up
      components without touching their source code or recompiling them. Some
      developers prefer having the wiring close to the source while others argue
      that annotated classes are no longer POJOs and, furthermore, that the
      configuration becomes decentralized and harder to control.</p><p>No matter the choice, Spring can accommodate both styles and even mix
      them together. It's worth pointing out that through its <a class="link" href="#beans-java" title="4.12&nbsp;Java-based container configuration">JavaConfig</a> option, Spring allows annotations
      to be used in a non-invasive way, without touching the target components
      source code and that in terms of tooling, all configuration styles are
      supported by the <a class="ulink" href="http://www.springsource.com/products/sts" target="_top">SpringSource Tool Suite</a>.</p></div><p>An alternative to XML setups is provided by annotation-based
    configuration which rely on the bytecode metadata for wiring up components
    instead of angle-bracket declarations. Instead of using XML to describe a
    bean wiring, the developer moves the configuration into the component class
    itself by using annotations on the relevant class, method, or field
    declaration. As mentioned in <a class="xref" href="#beans-factory-extension-bpp-examples-rabpp" title="4.8.1.2&nbsp;Example: The RequiredAnnotationBeanPostProcessor">Section&nbsp;4.8.1.2, &#8220;Example: The
        RequiredAnnotationBeanPostProcessor&#8221;</a>, using a
    <code class="interfacename">BeanPostProcessor</code> in conjunction with
    annotations is a common means of extending the Spring IoC container. For
    example, Spring 2.0 introduced the possibility of enforcing required
    properties with the <a class="link" href="#beans-required-annotation" title="4.9.1&nbsp;@Required">@Required</a> annotation. Spring 2.5 made it possible to follow
    that same general approach to drive Spring's dependency injection.
    Essentially, the <code class="interfacename">@Autowired</code> annotation
    provides the same capabilities as described in <a class="xref" href="#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators">Section&nbsp;4.4.5, &#8220;Autowiring collaborators&#8221;</a> but with more fine-grained control and
    wider applicability. Spring 2.5 also added support for JSR-250 annotations
    such as <code class="interfacename">@PostConstruct</code>, and
    <code class="interfacename">@PreDestroy</code>. Spring 3.0 added support for
    JSR-330 (Dependency Injection for Java) annotations contained in the
    javax.inject package such as <code class="classname">@Inject</code> and
    <code class="literal"> @Named</code>. Details about those annotations can be found in the <a class="link" href="#beans-standard-annotations" title="4.11&nbsp;Using JSR 330 Standard Annotations">relevant section</a>. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"> Annotation injection is performed
    <span class="emphasis"><em>before</em></span> XML injection, thus the latter configuration
    will override the former for properties wired through both approaches.
    </td></tr></table></div><p> As always, you can register them as individual bean definitions, but
    they can also be implicitly registered by including the following tag in an
    XML-based Spring configuration (notice the inclusion of the
    <code class="literal">context</code> namespace):</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
         http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
         http://www.springframework.org/schema/context
         http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;

   &lt;<span class="hl-tag">context:annotation-config</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>(The implicitly registered post-processors include <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/beans/factory/annotation/AutowiredAnnotationBeanPostProcessor.html" target="_top"><code class="classname">AutowiredAnnotationBeanPostProcessor</code></a>, <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/annotation/CommonAnnotationBeanPostProcessor.html" target="_top"><code class="classname">CommonAnnotationBeanPostProcessor</code></a>, <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/orm/jpa/support/PersistenceAnnotationBeanPostProcessor.html" target="_top"><code class="classname">PersistenceAnnotationBeanPostProcessor</code></a>, as
    well as the aforementioned <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/beans/factory/annotation/RequiredAnnotationBeanPostProcessor.html" target="_top"><code class="classname">RequiredAnnotationBeanPostProcessor</code></a>.)</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">&lt;context:annotation-config/&gt;</code> only looks for
      annotations on beans in the same application context in which it is
      defined. This means that, if you put
      <code class="literal">&lt;context:annotation-config/&gt;</code> in a
      <code class="interfacename">WebApplicationContext</code> for a
      <code class="classname">DispatcherServlet</code>, it only checks for
      <code class="interfacename">@Autowired</code> beans in your controllers, and
      not your services. See <a class="xref" href="#mvc-servlet" title="16.2&nbsp;The DispatcherServlet">Section&nbsp;16.2, &#8220;The DispatcherServlet&#8221;</a> for more
      information.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-required-annotation"></a>4.9.1&nbsp;<code class="interfacename">@Required</code></h3></div></div></div><p>The <code class="interfacename">@Required</code> annotation applies to
      bean property setter methods, as in the following example:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

  <span class="hl-keyword">private</span> MovieFinder movieFinder;

  @Required
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
      <span class="hl-keyword">this</span>.movieFinder = movieFinder;
  }

  <span class="hl-comment">// ...</span>
}</pre><p>This annotation simply indicates that the affected bean property must
      be populated at configuration time, through an explicit property value in
      a bean definition or through autowiring. The container throws an exception
      if the affected bean property has not been populated; this allows for
      eager and explicit failure, avoiding
      <code class="classname">NullPointerException</code>s or the like later on. It is
      still recommended that you put assertions into the bean class itself, for
      example, into an init method. Doing so enforces those required references
      and values even when you use the class outside of a container.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-autowired-annotation"></a>4.9.2&nbsp;<code class="interfacename">@Autowired</code></h3></div></div></div><p>As expected, you can apply the
      <code class="interfacename">@Autowired</code> annotation to "traditional"
      setter methods:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

  <span class="hl-keyword">private</span> MovieFinder movieFinder;

  @Autowired
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
      <span class="hl-keyword">this</span>.movieFinder = movieFinder;
  }

  <span class="hl-comment">// ...</span>
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>JSR 330's @Inject annotation can be used in place of Spring's
        <code class="interfacename">@Autowired</code> annotation in the examples below. See <a class="link" href="#beans-standard-annotations" title="4.11&nbsp;Using JSR 330 Standard Annotations">here</a> for more details</p></td></tr></table></div><p>You can also apply the annotation to methods with arbitrary names
      and/or multiple arguments:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

  <span class="hl-keyword">private</span> MovieCatalog movieCatalog;

  <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

  @Autowired
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> prepare(MovieCatalog movieCatalog,
                      CustomerPreferenceDao customerPreferenceDao) {
      <span class="hl-keyword">this</span>.movieCatalog = movieCatalog;
      <span class="hl-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;
  }

  <span class="hl-comment">// ...</span>
}</pre><p>You can apply <code class="interfacename">@Autowired</code> to
      constructors and fields:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

  @Autowired
  <span class="hl-keyword">private</span> MovieCatalog movieCatalog;

  <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

  @Autowired
  <span class="hl-keyword">public</span> MovieRecommender(CustomerPreferenceDao customerPreferenceDao) {
      <span class="hl-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;
  }

  <span class="hl-comment">// ...</span>
}</pre><p>It is also possible to provide <span class="emphasis"><em>all</em></span> beans of a
      particular type from the <code class="interfacename">ApplicationContext</code>
      by adding the annotation to a field or method that expects an array of
      that type:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

  @Autowired
  <span class="hl-keyword">private</span> MovieCatalog[] movieCatalogs;

  <span class="hl-comment">// ...</span>
}</pre><p>The same applies for typed collections:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

  <span class="hl-keyword">private</span> Set&lt;MovieCatalog&gt; movieCatalogs;

  @Autowired
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieCatalogs(Set&lt;MovieCatalog&gt; movieCatalogs) {
      <span class="hl-keyword">this</span>.movieCatalogs = movieCatalogs;
  }

  <span class="hl-comment">// ...</span>
}</pre><p>Even typed Maps can be autowired as long as the expected key type is
      <code class="classname">String</code>. The Map values will contain all beans of
      the expected type, and the keys will contain the corresponding bean
      names:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

  <span class="hl-keyword">private</span> Map&lt;String, MovieCatalog&gt; movieCatalogs;

  @Autowired
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieCatalogs(Map&lt;String, MovieCatalog&gt; movieCatalogs) {
      <span class="hl-keyword">this</span>.movieCatalogs = movieCatalogs;
  }

  <span class="hl-comment">// ...</span>
}</pre><p>By default, the autowiring fails whenever <span class="emphasis"><em>zero</em></span>
      candidate beans are available; the default behavior is to treat annotated
      methods, constructors, and fields as indicating
      <span class="emphasis"><em>required</em></span> dependencies. This behavior can be changed
      as demonstrated below.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

  <span class="hl-keyword">private</span> MovieFinder movieFinder;

  @Autowired(required=false)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
      <span class="hl-keyword">this</span>.movieFinder = movieFinder;
  }

  <span class="hl-comment">// ...</span>
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Only <span class="emphasis"><em>one annotated constructor per-class</em></span> can be
        marked as <span class="emphasis"><em>required</em></span>, but multiple non-required
        constructors can be annotated. In that case, each is considered among
        the candidates and Spring uses the <span class="emphasis"><em>greediest</em></span>
        constructor whose dependencies can be satisfied, that is the constructor
        that has the largest number of arguments.</p><p><code class="interfacename">@Autowired</code>'s
        <span class="emphasis"><em>required</em></span> attribute is recommended over the
        <code class="interfacename">@Required</code> annotation. The
        <span class="emphasis"><em>required</em></span> attribute indicates that the property is
        not required for autowiring purposes, the property is ignored if it
        cannot be autowired. <code class="interfacename">@Required</code>, on the
        other hand, is stronger in that it enforces the property that was set by
        any means supported by the container. If no value is injected, a
        corresponding exception is raised.</p></td></tr></table></div><p>You can also use <code class="interfacename">@Autowired</code> for
      interfaces that are well-known resolvable dependencies:
      <code class="interfacename">BeanFactory</code>,
      <code class="interfacename">ApplicationContext</code>,
      <code class="interfacename">Environment</code>,
      <code class="interfacename">ResourceLoader</code>,
      <code class="interfacename">ApplicationEventPublisher</code>, and
      <code class="interfacename">MessageSource</code>. These interfaces and their
      extended interfaces, such as
      <code class="interfacename">ConfigurableApplicationContext</code> or
      <code class="interfacename">ResourcePatternResolver</code>, are automatically
      resolved, with no special setup necessary.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

  @Autowired
  <span class="hl-keyword">private</span> ApplicationContext context;

  <span class="hl-keyword">public</span> MovieRecommender() {
  }

  <span class="hl-comment">// ...</span>
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
        <code class="interfacename">@Autowired</code>,
        <code class="interfacename">@Inject</code>,
        <code class="interfacename">@Resource</code>, and
        <code class="interfacename">@Value</code> annotations are handled by a
        Spring <code class="interfacename">BeanPostProcessor</code> implementations
        which in turn means that you <span class="emphasis"><em>cannot</em></span>
        apply these annotations within your own
        <code class="classname">BeanPostProcessor</code> or
        <code class="classname">BeanFactoryPostProcessor</code> types (if any). These
        types must be 'wired up' explicitly via XML or using a Spring
        <code class="interfacename">@Bean</code> method.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-autowired-annotation-qualifiers"></a>4.9.3&nbsp;Fine-tuning annotation-based autowiring with qualifiers</h3></div></div></div><p>Because autowiring by type may lead to multiple candidates, it is
      often necessary to have more control over the selection process. One way
      to accomplish this is with Spring's
      <code class="interfacename">@Qualifier</code> annotation. You can associate
      qualifier values with specific arguments, narrowing the set of type
      matches so that a specific bean is chosen for each argument. In the
      simplest case, this can be a plain descriptive value:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

  @Autowired
  @Qualifier(<span class="hl-string">"main"</span>)
  <span class="hl-keyword">private</span> MovieCatalog movieCatalog;

  <span class="hl-comment">// ...</span>
}</pre><p>The <code class="interfacename">@Qualifier</code> annotation can also be
      specified on individual constructor arguments or method parameters:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

  <span class="hl-keyword">private</span> MovieCatalog movieCatalog;

  <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

  @Autowired
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> prepare(@Qualifier(<span class="hl-string">"main"</span>) MovieCatalog movieCatalog,
                      CustomerPreferenceDao customerPreferenceDao) {
      <span class="hl-keyword">this</span>.movieCatalog = movieCatalog;
      <span class="hl-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;
  }

  <span class="hl-comment">// ...</span>
}</pre><p>The corresponding bean definitions appear as follows. The bean with
      qualifier value "main" is wired with the constructor argument that is
      qualified with the same value.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
      http://www.springframework.org/schema/context
      http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">context:annotation-config</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span>&gt;
      &lt;<span class="hl-tag">qualifier</span> <span class="hl-attribute">value</span>=<span class="hl-value">"main"</span>/&gt;
      &lt;<span class="hl-comment">!-- inject any dependencies required by this bean --</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span>&gt;
      &lt;<span class="hl-tag">qualifier</span> <span class="hl-attribute">value</span>=<span class="hl-value">"action"</span>/&gt;
      &lt;<span class="hl-comment">!-- inject any dependencies required by this bean --</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"movieRecommender"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.MovieRecommender"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;
</pre><p>For a fallback match, the bean name is considered a default qualifier
      value. Thus you can define the bean with an id "main" instead of the
      nested qualifier element, leading to the same matching result. However,
      although you can use this convention to refer to specific beans by name,
      <code class="interfacename">@Autowired</code> is fundamentally about
      type-driven injection with optional semantic qualifiers. This means that
      qualifier values, even with the bean name fallback, always have narrowing
      semantics within the set of type matches; they do not semantically express
      a reference to a unique bean id. Good qualifier values are "main" or
      "EMEA" or "persistent", expressing characteristics of a specific component
      that are independent from the bean id, which may be auto-generated in case
      of an anonymous bean definition like the one in the preceding
      example.</p><p>Qualifiers also apply to typed collections, as discussed above, for
      example, to <code class="literal">Set&lt;MovieCatalog&gt;</code>. In this case, all
      matching beans according to the declared qualifiers are injected as a
      collection. This implies that qualifiers do not have to be unique; they
      rather simply constitute filtering criteria. For example, you can define
      multiple <code class="classname">MovieCatalog</code> beans with the same qualifier
      value "action"; all of which would be injected into a
      <code class="literal">Set&lt;MovieCatalog&gt;</code> annotated with
      <code class="literal">@Qualifier("action")</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you intend to express annotation-driven injection by name, do not
        primarily use <code class="interfacename">@Autowired</code>, even if is
        technically capable of referring to a bean name through
        <code class="interfacename">@Qualifier</code> values. Instead, use the
        JSR-250 <code class="interfacename">@Resource</code> annotation, which is
        semantically defined to identify a specific target component by its
        unique name, with the declared type being irrelevant for the matching
        process.</p><p>As a specific consequence of this semantic difference, beans that
        are themselves defined as a collection or map type cannot be injected
        through <code class="interfacename">@Autowired</code>, because type matching
        is not properly applicable to them. Use
        <code class="interfacename">@Resource</code> for such beans, referring to
        the specific collection or map bean by unique name.</p><p><code class="interfacename">@Autowired</code> applies to fields,
        constructors, and multi-argument methods, allowing for narrowing through
        qualifier annotations at the parameter level. By contrast,
        <code class="interfacename">@Resource</code> is supported only for fields
        and bean property setter methods with a single argument. As a
        consequence, stick with qualifiers if your injection target is a
        constructor or a multi-argument method.</p></td></tr></table></div><p>You can create your own custom qualifier annotations. Simply define an
      annotation and provide the <code class="interfacename">@Qualifier</code>
      annotation within your definition:</p><pre class="programlisting">@Target({ElementType.FIELD, ElementType.PARAMETER})
@Retention(RetentionPolicy.RUNTIME)
@Qualifier
<span class="hl-keyword">public</span> @<span class="hl-keyword">interface</span> Genre {

  String value();
}</pre><p>Then you can provide the custom qualifier on autowired fields and
      parameters:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

  @Autowired
  @Genre(<span class="hl-string">"Action"</span>)
  <span class="hl-keyword">private</span> MovieCatalog actionCatalog;

  <span class="hl-keyword">private</span> MovieCatalog comedyCatalog;

  @Autowired
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setComedyCatalog(@Genre(<span class="hl-string">"Comedy"</span>) MovieCatalog comedyCatalog) {
      <span class="hl-keyword">this</span>.comedyCatalog = comedyCatalog;
  }

  <span class="hl-comment">// ...</span>
}</pre><p>Next, provide the information for the candidate bean definitions. You
      can add <code class="literal">&lt;qualifier/&gt;</code> tags as sub-elements of the
      <code class="literal">&lt;bean/&gt;</code> tag and then specify the
      <code class="literal">type</code> and <code class="literal">value</code> to match your custom
      qualifier annotations. The type is matched against the fully-qualified
      class name of the annotation. Or, as a convenience if no risk of
      conflicting names exists, you can use the short class name. Both
      approaches are demonstrated in the following example.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
      http://www.springframework.org/schema/context
      http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">context:annotation-config</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span>&gt;
      &lt;<span class="hl-tag">qualifier</span> <span class="hl-attribute">type</span>=<span class="hl-value">"Genre"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Action"</span>/&gt;
      &lt;<span class="hl-comment">!-- inject any dependencies required by this bean --</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span>&gt;
      &lt;<span class="hl-tag">qualifier</span> <span class="hl-attribute">type</span>=<span class="hl-value">"example.Genre"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Comedy"</span>/&gt;
      &lt;<span class="hl-comment">!-- inject any dependencies required by this bean --</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"movieRecommender"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.MovieRecommender"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;
</pre><p>In <a class="xref" href="#beans-classpath-scanning" title="4.10&nbsp;Classpath scanning and managed components">Section&nbsp;4.10, &#8220;Classpath scanning and managed components&#8221;</a>, you will see an
      annotation-based alternative to providing the qualifier metadata in XML.
      Specifically, see <a class="xref" href="#beans-scanning-qualifiers" title="4.10.7&nbsp;Providing qualifier metadata with annotations">Section&nbsp;4.10.7, &#8220;Providing qualifier metadata with annotations&#8221;</a>.</p><p>In some cases, it may be sufficient to use an annotation without a
      value. This may be useful when the annotation serves a more generic
      purpose and can be applied across several different types of dependencies.
      For example, you may provide an <span class="emphasis"><em>offline</em></span> catalog that
      would be searched when no Internet connection is available. First define
      the simple annotation:</p><pre class="programlisting">@Target({ElementType.FIELD, ElementType.PARAMETER})
@Retention(RetentionPolicy.RUNTIME)
@Qualifier
<span class="hl-keyword">public</span> @<span class="hl-keyword">interface</span> Offline {

}</pre><p>Then add the annotation to the field or property to be
      autowired:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

  @Autowired
  @Offline
  <span class="hl-keyword">private</span> MovieCatalog offlineCatalog;

  <span class="hl-comment">// ...</span>
}</pre><p>Now the bean definition only needs a qualifier
      <code class="literal">type</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span>&gt;
  &lt;<span class="hl-tag">qualifier</span> <span class="hl-attribute">type</span>=<span class="hl-value">"Offline"</span>/&gt;
  &lt;<span class="hl-comment">!-- inject any dependencies required by this bean --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>You can also define custom qualifier annotations that accept named
      attributes in addition to or instead of the simple
      <code class="literal">value</code> attribute. If multiple attribute values are then
      specified on a field or parameter to be autowired, a bean definition must
      match <span class="emphasis"><em>all</em></span> such attribute values to be considered an
      autowire candidate. As an example, consider the following annotation
      definition:</p><pre class="programlisting">@Target({ElementType.FIELD, ElementType.PARAMETER})
@Retention(RetentionPolicy.RUNTIME)
@Qualifier
<span class="hl-keyword">public</span> @<span class="hl-keyword">interface</span> MovieQualifier {

  String genre();

  Format format();
}</pre><p>In this case <code class="literal">Format</code> is an enum:</p><pre class="programlisting"><span class="hl-keyword">public</span> enum Format {

  VHS, DVD, BLURAY
}</pre><p>The fields to be autowired are annotated with the custom qualifier and
      include values for both attributes: <code class="literal">genre</code> and
      <code class="literal">format</code>.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

  @Autowired
  @MovieQualifier(format=Format.VHS, genre=<span class="hl-string">"Action"</span>)
  <span class="hl-keyword">private</span> MovieCatalog actionVhsCatalog;

  @Autowired
  @MovieQualifier(format=Format.VHS, genre=<span class="hl-string">"Comedy"</span>)
  <span class="hl-keyword">private</span> MovieCatalog comedyVhsCatalog;

  @Autowired
  @MovieQualifier(format=Format.DVD, genre=<span class="hl-string">"Action"</span>)
  <span class="hl-keyword">private</span> MovieCatalog actionDvdCatalog;

  @Autowired
  @MovieQualifier(format=Format.BLURAY, genre=<span class="hl-string">"Comedy"</span>)
  <span class="hl-keyword">private</span> MovieCatalog comedyBluRayCatalog;

  <span class="hl-comment">// ...</span>
}</pre><p>Finally, the bean definitions should contain matching qualifier
      values. This example also demonstrates that bean <span class="emphasis"><em>meta</em></span>
      attributes may be used instead of the
      <code class="literal">&lt;qualifier/&gt;</code> sub-elements. If available, the
      <code class="literal">&lt;qualifier/&gt;</code> and its attributes take precedence,
      but the autowiring mechanism falls back on the values provided within the
      <code class="literal">&lt;meta/&gt;</code> tags if no such qualifier is present, as
      in the last two bean definitions in the following example.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
      http://www.springframework.org/schema/context
      http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">context:annotation-config</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span>&gt;
      &lt;<span class="hl-tag">qualifier</span> <span class="hl-attribute">type</span>=<span class="hl-value">"MovieQualifier"</span>&gt;
          &lt;<span class="hl-tag">attribute</span> <span class="hl-attribute">key</span>=<span class="hl-value">"format"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"VHS"</span>/&gt;
          &lt;<span class="hl-tag">attribute</span> <span class="hl-attribute">key</span>=<span class="hl-value">"genre"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Action"</span>/&gt;
      &lt;<span class="hl-tag">/qualifier</span>&gt;
      &lt;<span class="hl-comment">!-- inject any dependencies required by this bean --</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span>&gt;
      &lt;<span class="hl-tag">qualifier</span> <span class="hl-attribute">type</span>=<span class="hl-value">"MovieQualifier"</span>&gt;
          &lt;<span class="hl-tag">attribute</span> <span class="hl-attribute">key</span>=<span class="hl-value">"format"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"VHS"</span>/&gt;
          &lt;<span class="hl-tag">attribute</span> <span class="hl-attribute">key</span>=<span class="hl-value">"genre"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Comedy"</span>/&gt;
      &lt;<span class="hl-tag">/qualifier</span>&gt;
      &lt;<span class="hl-comment">!-- inject any dependencies required by this bean --</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span>&gt;
      &lt;<span class="hl-tag">meta</span> <span class="hl-attribute">key</span>=<span class="hl-value">"format"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"DVD"</span>/&gt;
      &lt;<span class="hl-tag">meta</span> <span class="hl-attribute">key</span>=<span class="hl-value">"genre"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Action"</span>/&gt;
      &lt;<span class="hl-comment">!-- inject any dependencies required by this bean --</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span>&gt;
      &lt;<span class="hl-tag">meta</span> <span class="hl-attribute">key</span>=<span class="hl-value">"format"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"BLURAY"</span>/&gt;
      &lt;<span class="hl-tag">meta</span> <span class="hl-attribute">key</span>=<span class="hl-value">"genre"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Comedy"</span>/&gt;
      &lt;<span class="hl-comment">!-- inject any dependencies required by this bean --</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-custom-autowire-configurer"></a>4.9.4&nbsp;<code class="classname">CustomAutowireConfigurer</code></h3></div></div></div><p>The <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/beans/factory/annotation/CustomAutowireConfigurer.html" target="_top"><code class="classname">CustomAutowireConfigurer</code></a> is a
      <code class="interfacename">BeanFactoryPostProcessor</code> that enables you
      to register your own custom qualifier annotation types even if they are
      not annotated with Spring's <code class="interfacename">@Qualifier</code>
      annotation.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"customAutowireConfigurer"</span>
     <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.annotation.CustomAutowireConfigurer"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"customQualifierTypes"</span>&gt;
      &lt;<span class="hl-tag">set</span>&gt;
          &lt;<span class="hl-tag">value</span>&gt;example.CustomQualifier&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">/set</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The particular implementation of
      <code class="interfacename">AutowireCandidateResolver</code> that is activated
      for the application context depends on the Java version. In versions
      earlier than Java 5, the qualifier annotations are not supported, and
      therefore autowire candidates are solely determined by the
      <code class="literal">autowire-candidate</code> value of each bean definition as
      well as by any <code class="literal">default-autowire-candidates</code> pattern(s)
      available on the <code class="literal">&lt;beans/&gt;</code> element. In Java 5 or
      later, the presence of <code class="interfacename">@Qualifier</code>
      annotations and any custom annotations registered with the
      <code class="classname">CustomAutowireConfigurer</code> will also play a
      role.</p><p>Regardless of the Java version, when multiple beans qualify as
      autowire candidates, the determination of a "primary" candidate is the
      same: if exactly one bean definition among the candidates has a
      <code class="literal">primary</code> attribute set to <code class="literal">true</code>, it
      will be selected.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-resource-annotation"></a>4.9.5&nbsp;<code class="interfacename">@Resource</code></h3></div></div></div><p>Spring also supports injection using the JSR-250
      <code class="interfacename">@Resource</code> annotation on fields or bean
      property setter methods. This is a common pattern in Java EE 5 and 6, for
      example in JSF 1.2 managed beans or JAX-WS 2.0 endpoints. Spring supports
      this pattern for Spring-managed objects as well.</p><p><code class="interfacename">@Resource</code> takes a name attribute, and
      by default Spring interprets that value as the bean name to be injected.
      In other words, it follows <span class="emphasis"><em>by-name</em></span> semantics, as
      demonstrated in this example:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

  <span class="hl-keyword">private</span> MovieFinder movieFinder;

  @Resource(name=<span class="hl-string">"myMovieFinder"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
      <span class="hl-keyword">this</span>.movieFinder = movieFinder;
  }
}</pre><p>If no name is specified explicitly, the default name is derived from
      the field name or setter method. In case of a field, it takes the field
      name; in case of a setter method, it takes the bean property name. So the
      following example is going to have the bean with name "movieFinder"
      injected into its setter method:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

  <span class="hl-keyword">private</span> MovieFinder movieFinder;

  @Resource
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
      <span class="hl-keyword">this</span>.movieFinder = movieFinder;
  }
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The name provided with the annotation is resolved as a bean name by
        the <code class="interfacename">ApplicationContext</code> of which the
        <code class="classname">CommonAnnotationBeanPostProcessor</code> is aware. The
        names can be resolved through JNDI if you configure Spring's <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/jndi/support/SimpleJndiBeanFactory.html" target="_top"><code class="classname">SimpleJndiBeanFactory</code></a> explicitly.
        However, it is recommended that you rely on the default behavior and
        simply use Spring's JNDI lookup capabilities to preserve the level of
        indirection.</p></td></tr></table></div><p>In the exclusive case of <code class="interfacename">@Resource</code>
      usage with no explicit name specified, and similar to
      <code class="interfacename">@Autowired</code>,
      <code class="interfacename">@Resource</code> finds a primary type match
      instead of a specific named bean and resolves well-known resolvable
      dependencies: the
      <code class="interfacename">BeanFactory</code><code class="interfacename">,
      ApplicationContext,</code><code class="interfacename"> ResourceLoader,
      ApplicationEventPublisher</code>, and
      <code class="interfacename">MessageSource</code> interfaces.</p><p>Thus in the following example, the
      <code class="literal">customerPreferenceDao</code> field first looks for a bean
      named customerPreferenceDao, then falls back to a primary type match for
      the type <code class="classname">CustomerPreferenceDao</code>. The "context" field
      is injected based on the known resolvable dependency type
      <code class="interfacename">ApplicationContext</code>.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

  @Resource
  <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

  @Resource
  <span class="hl-keyword">private</span> ApplicationContext context;

  <span class="hl-keyword">public</span> MovieRecommender() {
  }

  <span class="hl-comment">// ...</span>
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-postconstruct-and-predestroy-annotations"></a>4.9.6&nbsp;<code class="interfacename">@PostConstruct</code> and
      <code class="interfacename">@PreDestroy</code></h3></div></div></div><p>The <code class="classname">CommonAnnotationBeanPostProcessor</code> not only
      recognizes the <code class="interfacename">@Resource</code> annotation but
      also the JSR-250 <span class="emphasis"><em>lifecycle</em></span> annotations. Introduced in
      Spring 2.5, the support for these annotations offers yet another
      alternative to those described in <a class="link" href="#beans-factory-lifecycle-initializingbean" title="4.6.1.1&nbsp;Initialization callbacks">initialization
      callbacks</a> and <a class="link" href="#beans-factory-lifecycle-disposablebean" title="4.6.1.2&nbsp;Destruction callbacks">destruction
      callbacks</a>. Provided that the
      <code class="classname">CommonAnnotationBeanPostProcessor</code> is registered
      within the Spring <code class="interfacename">ApplicationContext</code>, a
      method carrying one of these annotations is invoked at the same point in
      the lifecycle as the corresponding Spring lifecycle interface method or
      explicitly declared callback method. In the example below, the cache will
      be pre-populated upon initialization and cleared upon destruction.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CachingMovieLister {

  @PostConstruct
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> populateMovieCache() {
      <span class="hl-comment">// populates the movie cache upon initialization...</span>
  }

  @PreDestroy
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> clearMovieCache() {
      <span class="hl-comment">// clears the movie cache upon destruction...</span>
  }
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>For details about the effects of combining various lifecycle
        mechanisms, see <a class="xref" href="#beans-factory-lifecycle-combined-effects" title="4.6.1.4&nbsp;Combining lifecycle mechanisms">Section&nbsp;4.6.1.4, &#8220;Combining lifecycle mechanisms&#8221;</a>.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-classpath-scanning"></a>4.10&nbsp;Classpath scanning and managed components</h2></div></div></div><p>Most examples in this chapter use XML to specify the configuration
    metadata that produces each <code class="interfacename">BeanDefinition</code>
    within the Spring container. The previous section
    (<a class="xref" href="#beans-annotation-config" title="4.9&nbsp;Annotation-based container configuration">Section&nbsp;4.9, &#8220;Annotation-based container configuration&#8221;</a>) demonstrates how to provide a
    lot of the configuration metadata through source-level annotations. Even
    in those examples, however, the "base" bean definitions are explicitly
    defined in the XML file, while the annotations only drive the dependency
    injection. This section describes an option for implicitly detecting the
    <span class="emphasis"><em>candidate components</em></span> by scanning the classpath.
    Candidate components are classes that match against a filter criteria and
    have a corresponding bean definition registered with the container. This
    removes the need to use XML to perform bean registration, instead you can
    use annotations (for example @Component), AspectJ type expressions, or your
    own custom filter criteria to select which classes will have bean
    definitions registered with the container.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Starting with Spring 3.0, many features provided by the <a class="ulink" href="http://www.springsource.org/javaconfig" target="_top">Spring JavaConfig
      project</a> are part of the core Spring Framework. This allows you to
      define beans using Java rather than using the traditional XML files. Take
      a look at the <code class="interfacename">@Configuration</code>,
      <code class="interfacename">@Bean</code>,
      <code class="interfacename">@Import</code>, and
      <code class="interfacename">@DependsOn</code> annotations for examples of how
      to use these new features.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-stereotype-annotations"></a>4.10.1&nbsp;<code class="interfacename">@Component</code> and further stereotype
      annotations</h3></div></div></div><p>In Spring 2.0 and later, the
      <code class="interfacename">@Repository</code> annotation is a marker for any
      class that fulfills the role or <span class="emphasis"><em>stereotype</em></span> (also
      known as Data Access Object or DAO) of a repository. Among the uses of
      this marker is the automatic translation of exceptions as described in
      <a class="xref" href="#orm-exception-translation" title="14.2.2&nbsp;Exception translation">Section&nbsp;14.2.2, &#8220;Exception translation&#8221;</a>.</p><p>Spring 2.5 introduces further stereotype annotations:
      <code class="interfacename">@Component</code>,
      <code class="interfacename">@Service</code>, and
      <code class="interfacename">@Controller</code>.
      <code class="interfacename">@Component</code> is a generic stereotype for any
      Spring-managed component. <code class="interfacename">@Repository</code>,
      <code class="interfacename">@Service</code>, and
      <code class="interfacename">@Controller</code> are specializations of
      <code class="interfacename">@Component</code> for more specific use cases, for
      example, in the persistence, service, and presentation layers,
      respectively. Therefore, you can annotate your component classes with
      <code class="interfacename">@Component</code>, but by annotating them with
      <code class="interfacename">@Repository</code>,
      <code class="interfacename">@Service</code>, or
      <code class="interfacename">@Controller</code> instead, your classes are more
      properly suited for processing by tools or associating with aspects. For
      example, these stereotype annotations make ideal targets for pointcuts. It
      is also possible that <code class="interfacename">@Repository</code>,
      <code class="interfacename">@Service</code>, and
      <code class="interfacename">@Controller</code> may carry additional semantics
      in future releases of the Spring Framework. Thus, if you are choosing
      between using <code class="interfacename">@Component</code> or
      <code class="interfacename">@Service</code> for your service layer,
      <code class="interfacename">@Service</code> is clearly the better choice.
      Similarly, as stated above, <code class="interfacename">@Repository</code> is
      already supported as a marker for automatic exception translation in your
      persistence layer.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-scanning-autodetection"></a>4.10.2&nbsp;Automatically detecting classes and registering bean
      definitions</h3></div></div></div><p>Spring can automatically detect stereotyped classes and register
      corresponding <code class="interfacename">BeanDefinition</code>s with the
      <code class="interfacename">ApplicationContext</code>. For example, the
      following two classes are eligible for such autodetection:</p><pre class="programlisting">@Service
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

  <span class="hl-keyword">private</span> MovieFinder movieFinder;

  @Autowired
  <span class="hl-keyword">public</span> SimpleMovieLister(MovieFinder movieFinder) {
      <span class="hl-keyword">this</span>.movieFinder = movieFinder;
  }
}</pre><pre class="programlisting">@Repository
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JpaMovieFinder <span class="hl-keyword">implements</span> MovieFinder {
  <span class="hl-comment">// implementation elided for clarity</span>
}</pre><p>To autodetect these classes and register the corresponding beans, you
      need to include the following element in XML, where the base-package
      element is a common parent package for the two classes. (Alternatively,
      you can specify a comma-separated list that includes the parent package of
      each class.)</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
         http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
         http://www.springframework.org/schema/context
         http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;

   &lt;<span class="hl-tag">context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.example"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The scanning of classpath packages requires the presence of
        corresponding directory entries in the classpath. When you build JARs
        with Ant, make sure that you do <span class="emphasis"><em>not</em></span> activate the
        files-only switch of the JAR task.</p></td></tr></table></div><p>Furthermore, the
      <code class="interfacename">AutowiredAnnotationBeanPostProcessor</code> and
      <code class="interfacename">CommonAnnotationBeanPostProcessor</code> are both
      included implicitly when you use the component-scan element. That means
      that the two components are autodetected <span class="emphasis"><em>and</em></span> wired
      together - all without any bean configuration metadata provided in
      XML.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can disable the registration of
        <code class="interfacename">AutowiredAnnotationBeanPostProcessor</code> and
        <code class="interfacename">CommonAnnotationBeanPostProcessor</code> by
        including the <span class="emphasis"><em>annotation-config</em></span> attribute with a
        value of false.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-scanning-filters"></a>4.10.3&nbsp;Using filters to customize scanning</h3></div></div></div><p>By default, classes annotated with
      <code class="interfacename">@Component</code>,
      <code class="interfacename">@Repository</code>,
      <code class="interfacename">@Service</code>,
      <code class="interfacename">@Controller</code>, or a custom annotation that
      itself is annotated with <code class="interfacename">@Component</code> are the
      only detected candidate components. However, you can modify and extend
      this behavior simply by applying custom filters. Add them as
      <span class="emphasis"><em>include-filter</em></span> or <span class="emphasis"><em>exclude-filter</em></span>
      sub-elements of the <code class="literal">component-scan</code> element. Each filter
      element requires the <code class="literal">type</code> and
      <code class="literal">expression</code> attributes. The following table describes
      the filtering options.</p><div class="table"><a name="beans-scanning-filters-tbl"></a><p class="title"><b>Table&nbsp;4.5.&nbsp;Filter Types</b></p><div class="table-contents"><table summary="Filter Types" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Filter Type</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Example Expression</th><th style="border-bottom: 1.0pt solid ; ">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">annotation</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">org.example.SomeAnnotation</code></td><td style="border-bottom: 1.0pt solid ; ">An annotation to be present at the type level in target
              components.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">assignable</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">org.example.SomeClass</code></td><td style="border-bottom: 1.0pt solid ; ">A class (or interface) that the target components are
              assignable to (extend/implement).</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">aspectj</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">org.example..*Service+</code></td><td style="border-bottom: 1.0pt solid ; ">An AspectJ type expression to be matched by the target
              components.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">regex</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">org\.example\.Default.*</code></td><td style="border-bottom: 1.0pt solid ; ">A regex expression to be matched by the target components
              class names.</td></tr><tr><td style="border-right: 1.0pt solid ; ">custom</td><td style="border-right: 1.0pt solid ; "><code class="literal">org.example.MyTypeFilter</code></td><td style="">A custom implementation of the
              <code class="interfacename">org.springframework.core.type
              .TypeFilter</code> interface.</td></tr></tbody></table></div></div><br class="table-break"><p>The following example shows the XML configuration ignoring all
      <code class="interfacename">@Repository</code> annotations and using "stub"
      repositories instead.</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

   &lt;<span class="hl-tag">context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.example"</span>&gt;
      &lt;<span class="hl-tag">context:include-filter</span> <span class="hl-attribute">type</span>=<span class="hl-value">"regex"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">".*Stub.*Repository"</span>/&gt;
      &lt;<span class="hl-tag">context:exclude-filter</span> <span class="hl-attribute">type</span>=<span class="hl-value">"annotation"</span>
                              <span class="hl-attribute">expression</span>=<span class="hl-value">"org.springframework.stereotype.Repository"</span>/&gt;
   &lt;<span class="hl-tag">/context:component-scan</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can also disable the default filters by providing
        <span class="emphasis"><em>use-default-filters="false"</em></span> as an attribute of the
        &lt;component-scan/&gt; element. This will in effect disable automatic
        detection of classes annotated with
        <code class="interfacename">@Component</code>,
        <code class="interfacename">@Repository</code>,
        <code class="interfacename">@Service</code>, or
        <code class="interfacename">@Controller</code>.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factorybeans-annotations"></a>4.10.4&nbsp;Defining bean metadata within components</h3></div></div></div><p>Spring components can also contribute bean definition metadata to the
      container. You do this with the same <code class="literal">@Bean</code> annotation
      used to define bean metadata within <code class="literal">@Configuration</code>
      annotated classes. Here is a simple example:</p><pre class="programlisting">@Component
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FactoryMethodComponent {

  @Bean @Qualifier(<span class="hl-string">"public"</span>)
  <span class="hl-keyword">public</span> TestBean publicInstance() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TestBean(<span class="hl-string">"publicInstance"</span>);
  }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doWork() {
      <span class="hl-comment">// Component method implementation omitted</span>
  }
}</pre><p>This class is a Spring component that has application-specific code
      contained in its <code class="methodname">doWork()</code> method. However, it
      also contributes a bean definition that has a factory method referring to
      the method <code class="methodname">publicInstance()</code>. The
      <code class="literal">@Bean</code> annotation identifies the factory method and
      other bean definition properties, such as a qualifier value through the
      <code class="classname">@Qualifier</code> annotation. Other method level
      annotations that can be specified are <code class="literal">@Scope</code>,
      <code class="literal">@Lazy</code>, and custom qualifier annotations. Autowired
      fields and methods are supported as previously discussed, with additional
      support for autowiring of <code class="literal">@Bean</code> methods:</p><pre class="programlisting">@Component
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FactoryMethodComponent {

  <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">int</span> i;

  @Bean @Qualifier(<span class="hl-string">"public"</span>)
  <span class="hl-keyword">public</span> TestBean publicInstance() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TestBean(<span class="hl-string">"publicInstance"</span>);
  }

  <span class="hl-comment">// use of a custom qualifier and autowiring of method parameters</span>

  @Bean
  <span class="hl-keyword">protected</span> TestBean protectedInstance(@Qualifier(<span class="hl-string">"public"</span>) TestBean spouse,
                                       @Value(<span class="hl-string">"#{privateInstance.age}"</span>) String country) {
      TestBean tb = <span class="hl-keyword">new</span> TestBean(<span class="hl-string">"protectedInstance"</span>, 1);
      tb.setSpouse(tb);
      tb.setCountry(country);
      <span class="hl-keyword">return</span> tb;
  }

  @Bean @Scope(BeanDefinition.SCOPE_SINGLETON)
  <span class="hl-keyword">private</span> TestBean privateInstance() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TestBean(<span class="hl-string">"privateInstance"</span>, i++);
  }

  @Bean @Scope(value = WebApplicationContext.SCOPE_SESSION,
               proxyMode = ScopedProxyMode.TARGET_CLASS)
  <span class="hl-keyword">public</span> TestBean requestScopedInstance() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TestBean(<span class="hl-string">"requestScopedInstance"</span>, 3);
  }
}
</pre><p>The example autowires the <code class="classname">String</code> method
      parameter <code class="literal">country</code> to the value of the
      <code class="literal">Age</code> property on another bean named
      <code class="literal">privateInstance</code>. A Spring Expression Language element
      defines the value of the property through the notation <code class="literal">#{
      &lt;expression&gt; }</code>. For <code class="literal">@Value</code> annotations,
      an expression resolver is preconfigured to look for bean names when
      resolving expression text.</p><p>The <code class="literal">@Bean</code> methods in a Spring component are
      processed differently than their counterparts inside a Spring
      <code class="literal">@Configuration</code> class. The difference is that
      <code class="literal">@Component</code> classes are not enhanced with CGLIB to
      intercept the invocation of methods and fields. CGLIB proxying is the
      means by which invoking methods or fields within
      <code class="literal">@Configuration</code> classes <code class="literal">@Bean</code> methods
      create bean metadata references to collaborating objects. Methods are
      <span class="emphasis"><em>not</em></span> invoked with normal Java semantics. In contrast,
      calling a method or field within a <code class="literal">@Component</code> classes
      <code class="literal">@Bean</code> method <span class="emphasis"><em>has</em></span> standard Java
      semantics.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-scanning-name-generator"></a>4.10.5&nbsp;Naming autodetected components</h3></div></div></div><p>When a component is autodetected as part of the scanning process, its
      bean name is generated by the
      <code class="interfacename">BeanNameGenerator</code> strategy known to that
      scanner. By default, any Spring stereotype annotation
      (<code class="interfacename">@Component</code>,
      <code class="interfacename">@Repository</code>,
      <code class="interfacename">@Service</code>, and
      <code class="interfacename">@Controller</code>) that contains a
      <code class="literal">name</code> value will thereby provide that name to the
      corresponding bean definition.</p><p>If such an annotation contains no <code class="literal">name</code> value or for
      any other detected component (such as those discovered by custom filters),
      the default bean name generator returns the uncapitalized non-qualified
      class name. For example, if the following two components were detected,
      the names would be myMovieLister and movieFinderImpl:</p><pre class="programlisting">@Service(<span class="hl-string">"myMovieLister"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {
  <span class="hl-comment">// ...</span>
}</pre><pre class="programlisting">@Repository
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieFinderImpl <span class="hl-keyword">implements</span> MovieFinder {
  <span class="hl-comment">// ...</span>
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you do not want to rely on the default bean-naming strategy, you
        can provide a custom bean-naming strategy. First, implement the <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/beans/factory/support/BeanNameGenerator.html" target="_top"><code class="interfacename">BeanNameGenerator</code></a> interface, and
        be sure to include a default no-arg constructor. Then, provide the
        fully-qualified class name when configuring the scanner:</p></td></tr></table></div><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

   &lt;<span class="hl-tag">context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.example"</span>
                           <span class="hl-attribute">name-generator</span>=<span class="hl-value">"org.example.MyNameGenerator"</span> /&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>As a general rule, consider specifying the name with the annotation
      whenever other components may be making explicit references to it. On the
      other hand, the auto-generated names are adequate whenever the container
      is responsible for wiring.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-scanning-scope-resolver"></a>4.10.6&nbsp;Providing a scope for autodetected components</h3></div></div></div><p>As with Spring-managed components in general, the default and most
      common scope for autodetected components is singleton. However, sometimes
      you need other scopes, which Spring 2.5 provides with a new
      <code class="interfacename">@Scope</code> annotation. Simply provide the name
      of the scope within the annotation:</p><pre class="programlisting">@Scope(<span class="hl-string">"prototype"</span>)
@Repository
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieFinderImpl <span class="hl-keyword">implements</span> MovieFinder {
  <span class="hl-comment">// ...</span>
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>To provide a custom strategy for scope resolution rather than
        relying on the annotation-based approach, implement the <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/annotation/ScopeMetadataResolver.html" target="_top"><code class="interfacename">ScopeMetadataResolver</code></a> interface,
        and be sure to include a default no-arg constructor. Then, provide the
        fully-qualified class name when configuring the scanner:</p></td></tr></table></div><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

   &lt;<span class="hl-tag">context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.example"</span>
                           <span class="hl-attribute">scope-resolver</span>=<span class="hl-value">"org.example.MyScopeResolver"</span> /&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>When using certain non-singleton scopes, it may be necessary to
      generate proxies for the scoped objects. The reasoning is described in
      <a class="xref" href="#beans-factory-scopes-other-injection" title="4.5.4.5&nbsp;Scoped beans as dependencies">Section&nbsp;4.5.4.5, &#8220;Scoped beans as dependencies&#8221;</a>. For this purpose,
      a <span class="emphasis"><em>scoped-proxy</em></span> attribute is available on the
      component-scan element. The three possible values are: no, interfaces, and
      targetClass. For example, the following configuration will result in
      standard JDK dynamic proxies:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

   &lt;<span class="hl-tag">context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.example"</span>
                           <span class="hl-attribute">scoped-proxy</span>=<span class="hl-value">"interfaces"</span> /&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-scanning-qualifiers"></a>4.10.7&nbsp;Providing qualifier metadata with annotations</h3></div></div></div><p>The <code class="interfacename">@Qualifier</code> annotation is discussed
      in <a class="xref" href="#beans-autowired-annotation-qualifiers" title="4.9.3&nbsp;Fine-tuning annotation-based autowiring with qualifiers">Section&nbsp;4.9.3, &#8220;Fine-tuning annotation-based autowiring with qualifiers&#8221;</a>. The examples
      in that section demonstrate the use of the
      <code class="interfacename">@Qualifier</code> annotation and custom qualifier
      annotations to provide fine-grained control when you resolve autowire
      candidates. Because those examples were based on XML bean definitions, the
      qualifier metadata was provided on the candidate bean definitions using
      the <code class="literal">qualifier</code> or <code class="literal">meta</code> sub-elements
      of the <code class="literal">bean</code> element in the XML. When relying upon
      classpath scanning for autodetection of components, you provide the
      qualifier metadata with type-level annotations on the candidate class. The
      following three examples demonstrate this technique:</p><pre class="programlisting">@Component
@Qualifier(<span class="hl-string">"Action"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ActionMovieCatalog <span class="hl-keyword">implements</span> MovieCatalog {
  <span class="hl-comment">// ...</span>
}</pre><pre class="programlisting">@Component
@Genre(<span class="hl-string">"Action"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ActionMovieCatalog <span class="hl-keyword">implements</span> MovieCatalog {
  <span class="hl-comment">// ...</span>
}</pre><pre class="programlisting">@Component
@Offline
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CachingMovieCatalog <span class="hl-keyword">implements</span> MovieCatalog {
  <span class="hl-comment">// ...</span>
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>As with most annotation-based alternatives, keep in mind that the
        annotation metadata is bound to the class definition itself, while the
        use of XML allows for multiple beans <span class="emphasis"><em>of the same
        type</em></span> to provide variations in their qualifier metadata,
        because that metadata is provided per-instance rather than
        per-class.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-standard-annotations"></a>4.11&nbsp;Using JSR 330 Standard Annotations</h2></div></div></div><p>Starting with Spring 3.0, Spring offers support for JSR-330 standard annotations (Dependency Injection).
  Those annotations are scanned in the same way as the Spring annotations. You just need to have the relevant jars in your classpath.
  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
      If you are using Maven, the <code class="interfacename">javax.inject</code> artifact is available
      in the standard Maven repository
      (<a class="ulink" href="http://repo1.maven.org/maven2/javax/inject/javax.inject/1/" target="_top">http://repo1.maven.org/maven2/javax/inject/javax.inject/1/</a>).
      You can add the following dependency to your file pom.xml:
  	</p><pre class="programlisting">
&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;javax.inject&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;javax.inject&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;1&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt;</pre></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-inject-named"></a>4.11.1&nbsp;Dependency Injection with <code class="interfacename">@Inject</code> and <code class="interfacename">@Named</code></h3></div></div></div><p>Instead of <code class="interfacename">@Autowired</code>,
      <code class="interfacename">@javax.inject.Inject</code> may be used as follows:

    </p><pre class="programlisting"><span class="hl-keyword">import</span> javax.inject.Inject;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

  <span class="hl-keyword">private</span> MovieFinder movieFinder;

  @Inject
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
      <span class="hl-keyword">this</span>.movieFinder = movieFinder;
  }
  <span class="hl-comment">// ...</span>
}</pre><p>
    </p><p>As with <code class="interfacename">@Autowired</code>, it is possible to use <code class="interfacename">@Inject</code>
	at the class-level, field-level, method-level and constructor-argument level.

	If you would like to use a qualified name for the dependency that should be injected,
	you should use the <code class="interfacename">@Named</code> annotation as follows:

    </p><pre class="programlisting"><span class="hl-keyword">import</span> javax.inject.Inject;
<span class="hl-keyword">import</span> javax.inject.Named;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

  <span class="hl-keyword">private</span> MovieFinder movieFinder;

  @Inject
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(@Named(<span class="hl-string">"main"</span>) MovieFinder movieFinder) {
      <span class="hl-keyword">this</span>.movieFinder = movieFinder;
  }
  <span class="hl-comment">// ...</span>
}</pre><p>	
	
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-named"></a>4.11.2&nbsp;<code class="interfacename">@Named</code>: a standard equivalent to the <code class="interfacename">@Component</code> annotation</h3></div></div></div><p>
    Instead of <code class="interfacename">@Component</code>, <code class="interfacename">@javax.inject.Named</code> may be used as follows:
        </p><pre class="programlisting"><span class="hl-keyword">import</span> javax.inject.Inject;
<span class="hl-keyword">import</span> javax.inject.Named;
  
@Named(<span class="hl-string">"movieListener"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

  <span class="hl-keyword">private</span> MovieFinder movieFinder;

  @Inject
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
      <span class="hl-keyword">this</span>.movieFinder = movieFinder;
  }
  <span class="hl-comment">// ...</span>
}</pre><p>	
</p><p>
It is very common to use <code class="interfacename">@Component</code> without
specifying a name for the component. <code class="interfacename">@Named</code>
can be used in a similar fashion:

    </p><pre class="programlisting"><span class="hl-keyword">import</span> javax.inject.Inject;
<span class="hl-keyword">import</span> javax.inject.Named;
  
@Named
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

  <span class="hl-keyword">private</span> MovieFinder movieFinder;

  @Inject
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
      <span class="hl-keyword">this</span>.movieFinder = movieFinder;
  }
  <span class="hl-comment">// ...</span>
}</pre><p>
</p><p>
When using <code class="interfacename">@Named</code>, it is possible to use
component-scanning in the exact same way as when using Spring annotations:

    </p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
    &lt;<span class="hl-tag">context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.example"</span>/&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>	
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-standard-annotations-limitations"></a>4.11.3&nbsp;Limitations of the standard approach</h3></div></div></div><p>When working with standard annotations, it is important to know that
	some significant features are not available as shown in the table below:</p><div class="table"><a name="annotations-comparison"></a><p class="title"><b>Table&nbsp;4.6.&nbsp;Spring annotations vs. standard annotations</b></p><div class="table-contents"><table summary="Spring annotations vs. standard annotations" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Spring</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">javax.inject.*</th><th style="border-bottom: 1.0pt solid ; ">javax.inject restrictions / comments</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">@Autowired</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">@Inject</td><td style="border-bottom: 1.0pt solid ; ">@Inject has no 'required' attribute</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">@Component</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">@Named</td><td style="border-bottom: 1.0pt solid ; ">&#8212;</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">@Scope("singleton")</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">@Singleton</td><td style="border-bottom: 1.0pt solid ; ">
                	<p>
                		The JSR-330 default scope is like Spring's <code class="interfacename">prototype</code>.
                		However, in order to keep it consistent with Spring's general defaults,
                		a JSR-330 bean declared in the Spring container is a
                		<code class="interfacename">singleton</code> by default. In order to use a
                		scope other than <code class="interfacename">singleton</code>, you should use Spring's
                		<code class="interfacename">@Scope</code> annotation.
                	</p>
                	<p>
                		<code class="interfacename">javax.inject</code> also provides a
                		<a class="ulink" href="http://download.oracle.com/javaee/6/api/javax/inject/Scope.html" target="_top">@Scope</a> annotation.
                		Nevertheless, this one is only intended to be used for creating your own annotations.
                	</p>
                </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">@Qualifier</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">@Named</td><td style="border-bottom: 1.0pt solid ; ">&#8212;</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">@Value</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">&#8212;</td><td style="border-bottom: 1.0pt solid ; ">no equivalent</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">@Required</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">&#8212;</td><td style="border-bottom: 1.0pt solid ; ">no equivalent</td></tr><tr><td style="border-right: 1.0pt solid ; ">@Lazy</td><td style="border-right: 1.0pt solid ; ">&#8212;</td><td style="">no equivalent</td></tr></tbody></table></div></div><p><br class="table-break">
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-java"></a>4.12&nbsp;Java-based container configuration</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-java-basic-concepts"></a>4.12.1&nbsp;Basic concepts: <code class="literal">@Configuration</code> and
      <code class="literal">@Bean</code></h3></div></div></div><p>The central artifact in Spring's new Java-configuration support is the
      <code class="interfacename">@Configuration</code>-annotated class. These
      classes consist principally of
      <code class="interfacename">@Bean</code>-annotated methods that define
      instantiation, configuration, and initialization logic for objects to be
      managed by the Spring IoC container.</p><p>Annotating a class with the
      <code class="interfacename">@Configuration</code> indicates that the class can
      be used by the Spring IoC container as a source of bean definitions. The
      simplest possible <code class="interfacename">@Configuration</code> class
      would read as follows:
      </p><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
  @Bean
  <span class="hl-keyword">public</span> MyService myService() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> MyServiceImpl();
  }
}</pre><p>For those more familiar with Spring <code class="literal">&lt;beans/&gt;</code>
      XML, the <code class="literal">AppConfig</code> class above would be equivalent to:
      </p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.acme.services.MyServiceImpl"</span>/&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>
      As you can see, the <code class="literal">@Bean</code> annotation plays the same
      role as the <code class="literal">&lt;bean/&gt;</code> element. The
      <code class="literal">@Bean</code> annotation will be discussed in depth in the
      sections below. First, however, we'll cover the various ways of creating a
      spring container using Java-based configuration.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-java-instantiating-container"></a>4.12.2&nbsp;Instantiating the Spring container using
      <code class="literal">AnnotationConfigApplicationContext</code></h3></div></div></div><p>The sections below document Spring's
      <code class="literal">AnnotationConfigApplicationContext</code>, new in Spring 3.0.
      This versatile <code class="literal">ApplicationContext</code> implementation is
      capable of accepting not only <code class="literal">@Configuration</code> classes as
      input, but also plain <code class="literal">@Component</code> classes and classes
      annotated with JSR-330 metadata.</p><p>When <code class="literal">@Configuration</code> classes are provided as input,
      the <code class="literal">@Configuration</code> class itself is registered as a bean
      definition, and all declared <code class="literal">@Bean</code> methods within the
      class are also registered as bean definitions.</p><p>When <code class="literal">@Component</code> and JSR-330 classes are provided,
      they are registered as bean definitions, and it is assumed that DI
      metadata such as <code class="literal">@Autowired</code> or
      <code class="literal">@Inject</code> are used within those classes where
      necessary.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-instantiating-container-contstructor"></a>4.12.2.1&nbsp;Simple construction</h4></div></div></div><p>In much the same way that Spring XML files are used as input when
        instantiating a <code class="literal">ClassPathXmlApplicationContext</code>,
        <code class="literal">@Configuration</code> classes may be used as input when
        instantiating an <code class="literal">AnnotationConfigApplicationContext</code>.
        This allows for completely XML-free usage of the Spring container:
        </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
  ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(AppConfig.<span class="hl-keyword">class</span>);
  MyService myService = ctx.getBean(MyService.<span class="hl-keyword">class</span>);
  myService.doStuff();
}</pre><p>
        As mentioned above,
        <code class="literal">AnnotationConfigApplicationContext</code> is not limited to
        working only with <code class="literal">@Configuration</code> classes. Any
        <code class="literal">@Component</code> or JSR-330 annotated class may be supplied
        as input to the constructor. For example:
        </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
  ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(MyServiceImpl.<span class="hl-keyword">class</span>, Dependency1.<span class="hl-keyword">class</span>, Dependency2.<span class="hl-keyword">class</span>);
  MyService myService = ctx.getBean(MyService.<span class="hl-keyword">class</span>);
  myService.doStuff();
}</pre><p>
        The above assumes that <code class="literal">MyServiceImpl</code>,
        <code class="literal">Dependency1</code> and <code class="literal">Dependency2</code> use
        Spring dependency injection annotations such as
        <code class="literal">@Autowired</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-instantiating-container-register"></a>4.12.2.2&nbsp;Building the container programmatically using
        <code class="literal">register(Class&lt;?&gt;...)</code></h4></div></div></div><p>An <code class="literal">AnnotationConfigApplicationContext</code> may be
        instantiated using a no-arg constructor and then configured using the
        <code class="literal">register()</code> method. This approach is particularly
        useful when programmatically building an
        <code class="literal">AnnotationConfigApplicationContext</code>.
        </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
  AnnotationConfigApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext();
  ctx.register(AppConfig.<span class="hl-keyword">class</span>, OtherConfig.<span class="hl-keyword">class</span>);
  ctx.register(AdditionalConfig.<span class="hl-keyword">class</span>);
  ctx.refresh();
  MyService myService = ctx.getBean(MyService.<span class="hl-keyword">class</span>);
  myService.doStuff();
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-instantiating-container-scan"></a>4.12.2.3&nbsp;Enabling component scanning with
        <code class="literal">scan(String...)</code></h4></div></div></div><p>Experienced Spring users will be familiar with the following
        commonly-used XML declaration from Spring's <code class="literal">context:</code>
        namespace
        </p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
  &lt;<span class="hl-tag">context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"com.acme"</span>/&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>
        In the example above, the <code class="literal">com.acme</code> package will be
        scanned, looking for any <code class="literal">@Component</code>-annotated
        classes, and those classes will be registered as Spring bean definitions
        within the container.
        <code class="literal">AnnotationConfigApplicationContext</code> exposes the
        <code class="literal">scan(String...)</code> method to allow for the same
        component-scanning
        functionality:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
  AnnotationConfigApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext();
  ctx.scan(<span class="hl-string">"com.acme"</span>);
  ctx.refresh();
  MyService myService = ctx.getBean(MyService.<span class="hl-keyword">class</span>);
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Remember that <code class="literal">@Configuration</code> classes are
          meta-annotated with <code class="literal">@Component</code>, so they are
          candidates for component-scanning! In the example above, assuming that
          <code class="literal">AppConfig</code> is declared within the
          <code class="literal">com.acme</code> package (or any package underneath), it
          will be picked up during the call to <code class="literal">scan()</code>, and
          upon <code class="literal">refresh()</code> all its <code class="literal">@Bean</code>
          methods will be processed and registered as bean definitions within
          the container.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-instantiating-container-web"></a>4.12.2.4&nbsp;Support for web applications with
        <code class="literal">AnnotationConfigWebApplicationContext</code></h4></div></div></div><p>A <code class="literal">WebApplicationContext</code> variant of
        <code class="literal">AnnotationConfigApplicationContext</code> is available with
        <code class="literal">AnnotationConfigWebApplicationContext</code>. This
        implementation may be used when configuring the Spring
        <code class="literal">ContextLoaderListener</code> servlet listener, Spring MVC
        <code class="literal">DispatcherServlet</code>, etc. What follows is a
        <code class="literal">web.xml</code> snippet that configures a typical Spring MVC
        web application. Note the use of the <code class="literal">contextClass</code>
        context-param and init-param:
        </p><pre class="programlisting">
&lt;<span class="hl-tag">web-app</span>&gt;
  &lt;<span class="hl-comment">!-- Configure ContextLoaderListener to use AnnotationConfigWebApplicationContext
       instead of the default XmlWebApplicationContext --</span>&gt;
  &lt;<span class="hl-tag">context-param</span>&gt;
      &lt;<span class="hl-tag">param-name</span>&gt;contextClass&lt;<span class="hl-tag">/param-name</span>&gt;
      &lt;<span class="hl-tag">param-value</span>&gt;
          org.springframework.web.context.support.AnnotationConfigWebApplicationContext
      &lt;<span class="hl-tag">/param-value</span>&gt;
  &lt;<span class="hl-tag">/context-param</span>&gt;

  &lt;<span class="hl-comment">!-- Configuration locations must consist of one or more comma- or space-delimited
       fully-qualified @Configuration classes. Fully-qualified packages may also be
       specified for component-scanning --</span>&gt;
  &lt;<span class="hl-tag">context-param</span>&gt;
      &lt;<span class="hl-tag">param-name</span>&gt;contextConfigLocation&lt;<span class="hl-tag">/param-name</span>&gt;
      &lt;<span class="hl-tag">param-value</span>&gt;com.acme.AppConfig&lt;<span class="hl-tag">/param-value</span>&gt;
  &lt;<span class="hl-tag">/context-param</span>&gt;

  &lt;<span class="hl-comment">!-- Bootstrap the root application context as usual using ContextLoaderListener --</span>&gt;
  &lt;<span class="hl-tag">listener</span>&gt;
      &lt;<span class="hl-tag">listener-class</span>&gt;org.springframework.web.context.ContextLoaderListener&lt;<span class="hl-tag">/listener-class</span>&gt;
  &lt;<span class="hl-tag">/listener</span>&gt;

  &lt;<span class="hl-comment">!-- Declare a Spring MVC DispatcherServlet as usual --</span>&gt;
  &lt;<span class="hl-tag">servlet</span>&gt;
      &lt;<span class="hl-tag">servlet-name</span>&gt;dispatcher&lt;<span class="hl-tag">/servlet-name</span>&gt;
      &lt;<span class="hl-tag">servlet-class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
      &lt;<span class="hl-comment">!-- Configure DispatcherServlet to use AnnotationConfigWebApplicationContext
           instead of the default XmlWebApplicationContext --</span>&gt;
      &lt;<span class="hl-tag">init-param</span>&gt;
          &lt;<span class="hl-tag">param-name</span>&gt;contextClass&lt;<span class="hl-tag">/param-name</span>&gt;
          &lt;<span class="hl-tag">param-value</span>&gt;
              org.springframework.web.context.support.AnnotationConfigWebApplicationContext
          &lt;<span class="hl-tag">/param-value</span>&gt;
      &lt;<span class="hl-tag">/init-param</span>&gt;
      &lt;<span class="hl-comment">!-- Again, config locations must consist of one or more comma- or space-delimited
           and fully-qualified @Configuration classes --</span>&gt;
      &lt;<span class="hl-tag">init-param</span>&gt;
          &lt;<span class="hl-tag">param-name</span>&gt;contextConfigLocation&lt;<span class="hl-tag">/param-name</span>&gt;
          &lt;<span class="hl-tag">param-value</span>&gt;com.acme.web.MvcConfig&lt;<span class="hl-tag">/param-value</span>&gt;
      &lt;<span class="hl-tag">/init-param</span>&gt;
  &lt;<span class="hl-tag">/servlet</span>&gt;

  &lt;<span class="hl-comment">!-- map all requests for /app/* to the dispatcher servlet --</span>&gt;
  &lt;<span class="hl-tag">servlet-mapping</span>&gt;
      &lt;<span class="hl-tag">servlet-name</span>&gt;dispatcher&lt;<span class="hl-tag">/servlet-name</span>&gt;
      &lt;<span class="hl-tag">url-pattern</span>&gt;/app/*&lt;<span class="hl-tag">/url-pattern</span>&gt;
  &lt;<span class="hl-tag">/servlet-mapping</span>&gt;
&lt;<span class="hl-tag">/web-app</span>&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-java-composing-configuration-classes"></a>4.12.3&nbsp;Composing Java-based configurations</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-using-import"></a>4.12.3.1&nbsp;Using the <code class="literal">@Import</code> annotation</h4></div></div></div><p>Much as the <code class="literal">&lt;import/&gt;</code> element is used
        within Spring XML files to aid in modularizing configurations, the
        <code class="literal">@Import</code> annotation allows for loading
        <code class="literal">@Bean</code> definitions from another configuration
        class:</p><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConfigA {
  <span class="hl-keyword">public</span> @Bean A a() { <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> A(); }
}

@Configuration
@Import(ConfigA.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConfigB {
  <span class="hl-keyword">public</span> @Bean B b() { <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> B(); }
}</pre><p>
        Now, rather than needing to specify both
        <code class="literal">ConfigA.class</code> and <code class="literal">ConfigB.class</code>
        when instantiating the context, only <code class="literal">ConfigB</code> needs to
        be supplied
        explicitly:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
  ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(ConfigB.<span class="hl-keyword">class</span>);

  <span class="hl-comment">// now both beans A and B will be available...</span>
  A a = ctx.getBean(A.<span class="hl-keyword">class</span>);
  B b = ctx.getBean(B.<span class="hl-keyword">class</span>);
}</pre><p>
        This approach simplifies container instantiation, as only one class
        needs to be dealt with, rather than requiring the developer to remember
        a potentially large number of <code class="literal">@Configuration</code> classes
        during construction.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-java-injecting-imported-beans"></a>Injecting dependencies on imported <code class="literal">@Bean</code>
          definitions</h5></div></div></div><p>The example above works, but is simplistic. In most practical
          scenarios, beans will have dependencies on one another across
          configuration classes. When using XML, this is not an issue, per se,
          because there is no compiler involved, and one can simply declare
          <code class="literal">ref="someBean"</code> and trust that Spring will work it
          out during container initialization. Of course, when using
          <code class="literal">@Configuration</code> classes, the Java compiler places
          constraints on the configuration model, in that references to other
          beans must be valid Java syntax.</p><p>Fortunately, solving this problem is simple. Remember that
          <code class="literal">@Configuration</code> classes are ultimately just another
          bean in the container - this means that they can take advantage of
          <code class="literal">@Autowired</code> injection metadata just like any other
          bean!</p><p>Let's consider a more real-world scenario with several
          <code class="literal">@Configuration</code> classes, each depending on beans
          declared in the
          others:</p><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServiceConfig {
  <span class="hl-keyword">private</span> @Autowired AccountRepository accountRepository;

  <span class="hl-keyword">public</span> @Bean TransferService transferService() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl(accountRepository);
  }
}

@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RepositoryConfig {
  <span class="hl-keyword">private</span> @Autowired DataSource dataSource;

  <span class="hl-keyword">public</span> @Bean AccountRepository accountRepository() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> JdbcAccountRepository(dataSource);
  }
}

@Configuration
@Import({ServiceConfig.<span class="hl-keyword">class</span>, RepositoryConfig.<span class="hl-keyword">class</span>})
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SystemTestConfig {
  <span class="hl-keyword">public</span> @Bean DataSource dataSource() { <span class="hl-comment">/* return new DataSource */</span> }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
  ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(SystemTestConfig.<span class="hl-keyword">class</span>);
  <span class="hl-comment">// everything wires up across configuration classes...</span>
  TransferService transferService = ctx.getBean(TransferService.<span class="hl-keyword">class</span>);
  transferService.transfer(100.00, <span class="hl-string">"A123"</span>, <span class="hl-string">"C456"</span>);
}</pre><div class="section" lang="en"><div class="titlepage"><div><div><h6 class="title"><a name="beans-java-injecting-imported-beans-fq"></a>Fully-qualifying imported beans for ease of navigation</h6></div></div></div><p>In the scenario above, using <code class="literal">@Autowired</code> works
            well and provides the desired modularity, but determining exactly
            where the autowired bean definitions are declared is still somewhat
            ambiguous. For example, as a developer looking at
            <code class="literal">ServiceConfig</code>, how do you know exactly where the
            <code class="literal">@Autowired AccountRepository</code> bean is declared?
            It's not explicit in the code, and this may be just fine. Remember
            that the <a class="ulink" href="http://www.springsource.com/products/sts" target="_top">SpringSource Tool Suite</a> provides tooling that can render
            graphs showing how everything is wired up - that may be all you
            need. Also, your Java IDE can easily find all declarations and uses
            of the <code class="literal">AccountRepository</code> type, and will quickly
            show you the location of <code class="literal">@Bean</code> methods that
            return that type.</p><p>In cases where this ambiguity is not acceptable and you wish to
            have direct navigation from within your IDE from one
            <code class="literal">@Configuration</code> class to another, consider
            autowiring the configuration classes themselves:
            </p><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServiceConfig {
  <span class="hl-keyword">private</span> @Autowired RepositoryConfig repositoryConfig;

  <span class="hl-keyword">public</span> @Bean TransferService transferService() {
      <span class="hl-comment">// navigate 'through' the config class to the @Bean method!</span>
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl(repositoryConfig.accountRepository());
  }
}</pre><p>
            In the situation above, it is completely explicit where
            <code class="literal">AccountRepository</code> is defined. However,
            <code class="literal">ServiceConfig</code> is now tightly coupled to
            <code class="literal">RepositoryConfig</code>; that's the tradeoff. This tight
            coupling can be somewhat mitigated by using interface-based or
            abstract class-based <code class="literal">@Configuration</code> classes.
            Consider the following:
            </p><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServiceConfig {
  <span class="hl-keyword">private</span> @Autowired RepositoryConfig repositoryConfig;

  <span class="hl-keyword">public</span> @Bean TransferService transferService() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl(repositoryConfig.accountRepository());
  }
}

@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> RepositoryConfig {
  @Bean AccountRepository accountRepository();
}

@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultRepositoryConfig <span class="hl-keyword">implements</span> RepositoryConfig {
  <span class="hl-keyword">public</span> @Bean AccountRepository accountRepository() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> JdbcAccountRepository(...);
  }
}

@Configuration
@Import({ServiceConfig.<span class="hl-keyword">class</span>, DefaultRepositoryConfig.<span class="hl-keyword">class</span>}) <span class="hl-comment">// import the concrete config!</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SystemTestConfig {
  <span class="hl-keyword">public</span> @Bean DataSource dataSource() { <span class="hl-comment">/* return DataSource */</span> }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
  ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(SystemTestConfig.<span class="hl-keyword">class</span>);
  TransferService transferService = ctx.getBean(TransferService.<span class="hl-keyword">class</span>);
  transferService.transfer(100.00, <span class="hl-string">"A123"</span>, <span class="hl-string">"C456"</span>);
}</pre><p>
            Now <code class="literal">ServiceConfig</code> is loosely coupled with respect
            to the concrete <code class="literal">DefaultRepositoryConfig</code>, and
            built-in IDE tooling is still useful: it will be easy for the
            developer to get a type hierarchy of
            <code class="literal">RepositoryConfig</code> implementations. In this way,
            navigating <code class="literal">@Configuration</code> classes and their
            dependencies becomes no different than the usual process of
            navigating interface-based code.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-combining"></a>4.12.3.2&nbsp;Combining Java and XML configuration</h4></div></div></div><p>Spring's <code class="literal">@Configuration</code> class support does not
        aim to be a 100% complete replacement for Spring XML. Some facilities
        such as Spring XML namespaces remain an ideal way to configure the
        container. In cases where XML is convenient or necessary, you have a
        choice: either instantiate the container in an "XML-centric" way using,
        for example, <code class="literal">ClassPathXmlApplicationContext</code>, or in a
        "Java-centric" fashion using
        <code class="literal">AnnotationConfigApplicationContext</code> and the
        <code class="literal">@ImportResource</code> annotation to import XML as
        needed.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-java-combining-xml-centric"></a>XML-centric use of <code class="literal">@Configuration</code>
          classes</h5></div></div></div><p>It may be preferable to bootstrap the Spring container from XML
          and include <code class="literal">@Configuration</code> classes in an ad-hoc
          fashion. For example, in a large existing codebase that uses Spring
          XML, it will be easier to create <code class="literal">@Configuration</code>
          classes on an as-needed basis and include them from the existing XML
          files. Below you'll find the options for using
          <code class="literal">@Configuration</code> classes in this kind of
          "XML-centric" situation.</p><div class="section" lang="en"><div class="titlepage"><div><div><h6 class="title"><a name="beans-java-combining-xml-centric-declare-as-bean"></a>Declaring <code class="literal">@Configuration</code> classes as plain
            Spring <code class="literal">&lt;bean/&gt;</code> elements</h6></div></div></div><p>Remember that <code class="literal">@Configuration</code> classes are
            ultimately just bean definitions in the container. In this example,
            we create a <code class="literal">@Configuration</code> class named
            <code class="literal">AppConfig</code> and include it within
            <code class="literal">system-test-config.xml</code> as a
            <code class="literal">&lt;bean/&gt;</code>definition. Because
            <code class="literal">&lt;context:annotation-config/&gt;</code> is switched
            on, the container will recognize the
            <code class="literal">@Configuration</code> annotation, and process the
            <code class="literal">@Bean</code> methods declared in
            <code class="literal">AppConfig</code>
            properly.</p><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
  <span class="hl-keyword">private</span> @Autowired DataSource dataSource;

  <span class="hl-keyword">public</span> @Bean AccountRepository accountRepository() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> JdbcAccountRepository(dataSource);
  }

  <span class="hl-keyword">public</span> @Bean TransferService transferService() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferService(accountRepository());
  }
}</pre><p>
            </p><pre class="programlisting">system-test-config.xml
&lt;<span class="hl-tag">beans</span>&gt;
  &lt;<span class="hl-comment">!-- enable processing of annotations such as @Autowired and @Configuration --</span>&gt;
  &lt;<span class="hl-tag">context:annotation-config</span>/&gt;
  &lt;<span class="hl-tag">context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:/com/acme/jdbc.properties"</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.acme.AppConfig"</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span>/&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span>/&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>
            </p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">jdbc.properties</span></em>
jdbc.url=jdbc:hsqldb:hsql://localhost/xdb
jdbc.username=sa
jdbc.password=</pre><p>
            </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
  ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"classpath:/com/acme/system-test-config.xml"</span>);
  TransferService transferService = ctx.getBean(TransferService.<span class="hl-keyword">class</span>);
  <span class="hl-comment">// ...</span>
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In <code class="literal">system-test-config.xml</code> above, the
              <code class="literal">AppConfig&lt;bean/&gt;</code> does not declare an
              <code class="literal">id</code> element. While it would be acceptable to do
              so, it is unnecessary given that no other bean will ever refer to
              it, and it is unlikely that it will be explicitly fetched from the
              container by name. Likewise with the <code class="literal">DataSource</code>
              bean - it is only ever autowired by type, so an explicit bean id
              is not strictly required.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h6 class="title"><a name="beans-java-combining-xml-centric-component-scan"></a>Using <code class="literal">&lt;context:component-scan/&gt;</code> to
            pick up <code class="literal">@Configuration</code> classes</h6></div></div></div><p>Because <code class="literal">@Configuration</code> is meta-annotated with
            <code class="literal">@Component</code>,
            <code class="literal">@Configuration</code>-annotated classes are
            automatically candidates for component scanning. Using the same
            scenario as above, we can redefine
            <code class="literal">system-test-config.xml</code> to take advantage of
            component-scanning. Note that in this case, we don't need to
            explicitly declare
            <code class="literal">&lt;context:annotation-config/&gt;</code>, because
            <code class="literal">&lt;context:component-scan/&gt;</code> enables all the
            same
            functionality.</p><pre class="programlisting">system-test-config.xml
&lt;<span class="hl-tag">beans</span>&gt;
  &lt;<span class="hl-comment">!-- picks up and registers AppConfig as a bean definition --</span>&gt;
  &lt;<span class="hl-tag">context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"com.acme"</span>/&gt;
  &lt;<span class="hl-tag">context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:/com/acme/jdbc.properties"</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span>/&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span>/&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-java-combining-java-centric"></a><code class="literal">@Configuration</code> class-centric use of XML with
          <code class="literal">@ImportResource</code></h5></div></div></div><p>In applications where <code class="literal">@Configuration</code> classes
          are the primary mechanism for configuring the container, it will still
          likely be necessary to use at least some XML. In these scenarios,
          simply use <code class="literal">@ImportResource</code> and define only as much
          XML as is needed. Doing so achieves a "Java-centric" approach to
          configuring the container and keeps XML to a bare minimum.
          </p><pre class="programlisting">@Configuration
@ImportResource(<span class="hl-string">"classpath:/com/acme/properties-config.xml"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
  <span class="hl-keyword">private</span> @Value(<span class="hl-string">"${jdbc.url}"</span>) String url;
  <span class="hl-keyword">private</span> @Value(<span class="hl-string">"${jdbc.username}"</span>) String username;
  <span class="hl-keyword">private</span> @Value(<span class="hl-string">"${jdbc.password}"</span>) String password;

  <span class="hl-keyword">public</span> @Bean DataSource dataSource() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> DriverManagerDataSource(url, username, password);
  }
}</pre><p>
          </p><pre class="programlisting">properties-config.xml
&lt;<span class="hl-tag">beans</span>&gt;
  &lt;<span class="hl-tag">context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:/com/acme/jdbc.properties"</span>/&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>
          </p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">jdbc.properties</span></em>
jdbc.url=jdbc:hsqldb:hsql://localhost/xdb
jdbc.username=sa
jdbc.password=</pre><p>
          </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
  ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(AppConfig.<span class="hl-keyword">class</span>);
  TransferService transferService = ctx.getBean(TransferService.<span class="hl-keyword">class</span>);
  <span class="hl-comment">// ...</span>
}</pre></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-java-bean-annotation"></a>4.12.4&nbsp;Using the <code class="interfacename">@Bean</code> annotation</h3></div></div></div><p><code class="interfacename">@Bean</code> is a method-level annotation and
      a direct analog of the XML <code class="code">&lt;bean/&gt;</code> element. The
      annotation supports some of the attributes offered by
      <code class="code">&lt;bean/&gt;</code>, such as: <code class="code"><a class="link" href="#beans-factory-lifecycle-initializingbean" title="4.6.1.1&nbsp;Initialization callbacks">init-method</a></code>, <code class="code"><a class="link" href="#beans-factory-lifecycle-disposablebean" title="4.6.1.2&nbsp;Destruction callbacks">destroy-method</a></code>, <code class="code"><a class="link" href="#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators">autowiring</a></code> and
      <code class="code">name</code>.</p><p>You can use the <code class="interfacename">@Bean</code> annotation in a
      <code class="interfacename">@Configuration</code>-annotated or in a
      <code class="interfacename">@Component</code>-annotated class.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-declaring-a-bean"></a>4.12.4.1&nbsp;Declaring a bean</h4></div></div></div><p>To declare a bean, simply annotate a method with the
        <code class="interfacename">@Bean</code> annotation. You use this method to
        register a bean definition within an <code class="code">ApplicationContext</code> of
        the type specified as the method's return value. By default, the bean
        name will be the same as the method name. The following is a simple
        example of a <code class="interfacename">@Bean</code> method declaration:
        </p><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

  @Bean
  <span class="hl-keyword">public</span> TransferService transferService() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl();
  }

}</pre><p>The preceding configuration is exactly equivalent to the following
        Spring XML:
        </p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transferService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.acme.TransferServiceImpl"</span>/&gt;
&lt;<span class="hl-tag">/beans</span>&gt;                </pre><p>Both declarations make a bean named <code class="code">transferService</code>
        available in the <code class="code">ApplicationContext</code>, bound to an object
        instance of type <code class="code">TransferServiceImpl</code>:
        </p><pre class="programlisting">
transferService -&gt; com.acme.TransferServiceImpl
              </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-injecting-dependencies"></a>4.12.4.2&nbsp;Injecting dependencies</h4></div></div></div><p>When <code class="interfacename">@Bean</code>s have dependencies on one
        another, expressing that dependency is as simple as having one bean
        method call another:
        </p><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

  @Bean
  <span class="hl-keyword">public</span> Foo foo() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo(bar());
  }

  @Bean
  <span class="hl-keyword">public</span> Bar bar() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Bar();
  }

}                </pre><p>In the example above, the <code class="code">foo</code> bean receives a reference
        to <code class="code"> bar</code> via constructor injection.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-lifecycle-callbacks"></a>4.12.4.3&nbsp;Receiving lifecycle callbacks</h4></div></div></div><p>Beans declared in a
        <code class="interfacename">@Configuration</code>-annotated class support
        the regular lifecycle callbacks. Any classes defined with the
        <code class="literal">@Bean</code> annotation can use the
        <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code>
        annotations from JSR-250, see <a class="link" href="#beans-postconstruct-and-predestroy-annotations" title="4.9.6&nbsp;@PostConstruct and @PreDestroy">JSR-250
        annotations</a> for further details.</p><p>The regular Spring <a class="link" href="#beans-factory-nature" title="4.6&nbsp;Customizing the nature of a bean">lifecycle</a> callbacks are fully supported as well. If a bean
        implements <code class="code">InitializingBean</code>, <code class="code">DisposableBean</code>,
        or <code class="code">Lifecycle</code>, their respective methods are called by the
        container.</p><p>The standard set of <code class="code">*Aware</code> interfaces such as
        <code class="code"><a class="link" href="#beans-beanfactory" title="4.15&nbsp;The BeanFactory">BeanFactoryAware</a></code>,
        <code class="code"><a class="link" href="#beans-factory-aware" title="4.6.2&nbsp;ApplicationContextAware and BeanNameAware">BeanNameAware</a></code>,
        <code class="code"><a class="link" href="#context-functionality-messagesource" title="4.14.1&nbsp;Internationalization using MessageSource">MessageSourceAware</a></code>, <code class="code"><a class="link" href="#beans-factory-aware" title="4.6.2&nbsp;ApplicationContextAware and BeanNameAware">ApplicationContextAware</a></code>, and
        so on are also fully supported.</p><p>The <code class="interfacename">@Bean</code> annotation supports
        specifying arbitrary initialization and destruction callback methods,
        much like Spring XML's <code class="code">init-method</code> and
        <code class="code">destroy-method</code> attributes on the <code class="code">bean</code> element:
        </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Foo {
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init() {
      <span class="hl-comment">// initialization logic</span>
  }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Bar {
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> cleanup() {
      <span class="hl-comment">// destruction logic</span>
  }
}

@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
  @Bean(initMethod = <span class="hl-string">"init"</span>)
  <span class="hl-keyword">public</span> Foo foo() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo();
  }
  @Bean(destroyMethod = <span class="hl-string">"cleanup"</span>)
  <span class="hl-keyword">public</span> Bar bar() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Bar();
  }
}
</pre><p>Of course, in the case of <code class="code">Foo</code> above, it would be
        equally as valid to call the <code class="code">init()</code> method directly during
        construction:
        </p><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
  @Bean
  <span class="hl-keyword">public</span> Foo foo() {
      Foo foo = <span class="hl-keyword">new</span> Foo();
      foo.init();
      <span class="hl-keyword">return</span> foo;
  }

  <span class="hl-comment">// ...</span>
}                    </pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>When you work directly in Java, you can do anything you like with
          your objects and do not always need to rely on the container
          lifecycle!</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-specifying-bean-scope"></a>4.12.4.4&nbsp;Specifying bean scope</h4></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-java-available-scopes"></a>Using the <code class="interfacename">@Scope</code>
          annotation</h5></div></div></div><p>You can specify that your beans defined with the
          <code class="interfacename">@Bean</code> annotation should have a specific
          scope. You can use any of the standard scopes specified in the <a class="link" href="#beans-factory-scopes" title="4.5&nbsp;Bean scopes">Bean Scopes</a> section.</p><p>The default scope is <code class="literal">singleton</code>, but you can
          override this with the <code class="interfacename">@Scope</code>
          annotation:
          </p><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyConfiguration {
  @Bean
  @Scope(<span class="hl-string">"prototype"</span>)
  <span class="hl-keyword">public</span> Encryptor encryptor() {
      <span class="hl-comment">// ...</span>
  }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-java-scoped-proxy"></a><code class="code">@Scope and scoped-proxy</code></h5></div></div></div><p>Spring offers a convenient way of working with scoped dependencies
          through <a class="link" href="#beans-factory-scopes-other-injection" title="4.5.4.5&nbsp;Scoped beans as dependencies">scoped
          proxies</a>. The easiest way to create such a proxy when using the
          XML configuration is the <code class="code">&lt;aop:scoped-proxy/&gt;</code>
          element. Configuring your beans in Java with a @Scope annotation
          offers equivalent support with the proxyMode attribute. The default is
          no proxy (<code class="varname">ScopedProxyMode.NO</code>), but you can specify
          <code class="classname">ScopedProxyMode.TARGET_CLASS</code> or
          <code class="classname">ScopedProxyMode.INTERFACES</code>.</p><p>If you port the scoped proxy example from the XML reference
          documentation (see preceding link) to our
          <code class="interfacename">@Bean</code> using Java, it would look like
          the following:
          </p><pre class="programlisting"><span class="hl-comment">// an HTTP Session-scoped bean exposed as a proxy</span>
@Bean
@Scope(value = <span class="hl-string">"session"</span>, proxyMode = ScopedProxyMode.TARGET_CLASS)
<span class="hl-keyword">public</span> UserPreferences userPreferences() {
 <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> UserPreferences();
}

@Bean
<span class="hl-keyword">public</span> Service userService() {
 UserService service = <span class="hl-keyword">new</span> SimpleUserService();
 <span class="hl-comment">// a reference to the proxied userPreferences bean</span>
 service.setUserPreferences(userPreferences());
 <span class="hl-keyword">return</span> service;
}                </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-java-method-injection"></a>Lookup method injection</h5></div></div></div><p>As noted earlier, <a class="link" href="#beans-factory-method-injection" title="4.4.6&nbsp;Method injection">lookup method injection</a> is an advanced feature that you should
          use rarely. It is useful in cases where a singleton-scoped bean has a
          dependency on a prototype-scoped bean. Using Java for this type of
          configuration provides a natural means for implementing this pattern.
          </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> CommandManager {
  <span class="hl-keyword">public</span> Object process(Object commandState) {
      <span class="hl-comment">// grab a new instance of the appropriate Command interface</span>
      Command command = createCommand();

      <span class="hl-comment">// set the state on the (hopefully brand new) Command instance</span>
      command.setState(commandState);
      <span class="hl-keyword">return</span> command.execute();
  }

  <span class="hl-comment">// okay... but where is the implementation of this method?</span>
  <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Command createCommand();
}                   </pre><p>Using Java-configuration support , you can create a subclass of
          <code class="code">CommandManager</code> where the abstract
          <code class="code">createCommand()</code> method is overridden in such a way that
          it looks up a new (prototype) command object:
          </p><pre class="programlisting">@Bean
@Scope(<span class="hl-string">"prototype"</span>)
<span class="hl-keyword">public</span> AsyncCommand asyncCommand() {
  AsyncCommand command = <span class="hl-keyword">new</span> AsyncCommand();
  <span class="hl-comment">// inject dependencies here as required</span>
  <span class="hl-keyword">return</span> command;
}

@Bean
<span class="hl-keyword">public</span> CommandManager commandManager() {
  <span class="hl-comment">// return new anonymous implementation of CommandManager with command() overridden</span>
  <span class="hl-comment">// to return a new prototype Command object</span>
  <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> CommandManager() {
      <span class="hl-keyword">protected</span> Command createCommand() {
          <span class="hl-keyword">return</span> asyncCommand();
      }
  }
}                    </pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-customizing-bean-naming"></a>4.12.4.5&nbsp;Customizing bean naming</h4></div></div></div><p>By default, configuration classes use a
        <code class="interfacename">@Bean</code> method's name as the name of the
        resulting bean. This functionality can be overridden, however, with the
        <code class="code">name</code> attribute.
        </p><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

  @Bean(name = <span class="hl-string">"myFoo"</span>)
  <span class="hl-keyword">public</span> Foo foo() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo();
  }

}        </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-bean-aliasing"></a>4.12.4.6&nbsp;Bean aliasing</h4></div></div></div><p>As discussed in <a class="xref" href="#beans-beanname" title="4.3.1&nbsp;Naming beans">Section&nbsp;4.3.1, &#8220;Naming beans&#8221;</a>, it is sometimes
        desirable to give a single bean multiple names, otherwise known as
        <span class="emphasis"><em>bean aliasing</em></span>. The <code class="literal">name</code>
        attribute of the <code class="literal">@Bean</code> annotation accepts a String
        array for this purpose.
        </p><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

  @Bean(name = { <span class="hl-string">"dataSource"</span>, <span class="hl-string">"subsystemA-dataSource"</span>, <span class="hl-string">"subsystemB-dataSource"</span> })
  <span class="hl-keyword">public</span> DataSource dataSource() {
      <span class="hl-comment">// instantiate, configure and return DataSource bean...</span>
  }

}        </pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-java-further-information-java-config"></a>4.12.5&nbsp;Further information about how Java-based configuration works
      internally</h3></div></div></div><p>The following example shows a <code class="literal">@Bean</code> annotated
      method being called twice:</p><pre class="programlisting">
@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

  @Bean
  <span class="hl-keyword">public</span> ClientService clientService1() {
    ClientServiceImpl clientService = <span class="hl-keyword">new</span> ClientServiceImpl();
    clientService.setClientDao(clientDao());
    <span class="hl-keyword">return</span> clientService;
  }
  @Bean
  <span class="hl-keyword">public</span> ClientService clientService2() {
    ClientServiceImpl clientService = <span class="hl-keyword">new</span> ClientServiceImpl();
    clientService.setClientDao(clientDao());
    <span class="hl-keyword">return</span> clientService;
  }

  @Bean
  <span class="hl-keyword">public</span> ClientDao clientDao() {
    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ClientDaoImpl();
  }
}
    </pre><p> <code class="methodname">clientDao()</code> has been called once in
      <code class="methodname">clientService1()</code> and once in
      <code class="methodname">clientService2()</code>. Since this method creates a new
      instance of <code class="classname">ClientDaoImpl</code> and returns it, you would
      normally expect having 2 instances (one for each service). That definitely
      would be problematic: in Spring, instantiated beans have a
      <code class="literal">singleton</code> scope by default. This is where the magic
      comes in: All <code class="literal">@Configuration</code> classes are subclassed at
      startup-time with <code class="literal">CGLIB</code>. In the subclass, the child
      method checks the container first for any cached (scoped) beans before it
      calls the parent method and creates a new instance. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p> The behavior could be different according to the scope of your
        bean. We are talking about singletons here. </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p> Beware that, in order for JavaConfig to work, you must include the
        CGLIB jar in your list of dependencies. </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p> There are a few restrictions due to the fact that CGLIB dynamically
        adds features at startup-time: </p><div class="itemizedlist"><ul type="disc"><li><p>Configuration classes should not be final</p></li><li><p>They should have a constructor with no arguments</p></li></ul></div><p> </p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="context-load-time-weaver"></a>4.13&nbsp;Registering a <code class="interfacename">LoadTimeWeaver</code></h2></div></div></div><p>The <code class="literal">context</code> namespace introduced in Spring 2.5
      provides a <code class="literal">load-time-weaver</code>
      element.</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

     &lt;<span class="hl-tag">context:load-time-weaver</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Adding this element to an XML-based Spring configuration file
      activates a Spring <code class="interfacename">LoadTimeWeaver</code> for the
      <code class="interfacename">ApplicationContext</code>. Any bean within that
      <code class="interfacename">ApplicationContext</code> may implement
      <code class="interfacename">LoadTimeWeaverAware</code>, thereby receiving a
      reference to the load-time weaver instance. This is particularly useful in
      combination with <a class="link" href="#orm-jpa" title="14.5&nbsp;JPA">Spring's JPA support</a> where
      load-time weaving may be necessary for JPA class transformation. Consult
      the <code class="classname">LocalContainerEntityManagerFactoryBean</code> Javadoc
      for more detail. For more on AspectJ load-time weaving, see <a class="xref" href="#aop-aj-ltw" title="8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;8.8.4, &#8220;Load-time weaving with AspectJ in the Spring Framework&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="context-introduction"></a>4.14&nbsp;Additional Capabilities of the
    <code class="interfacename">ApplicationContext</code></h2></div></div></div><p>As was discussed in the chapter introduction, the
    <code class="literal">org.springframework.beans.factory</code> package provides basic
    functionality for managing and manipulating beans, including in a
    programmatic way. The <code class="literal">org.springframework.context</code> package
    adds the <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/ApplicationContext.html" target="_top"><code class="interfacename">ApplicationContext</code></a> interface, which
    extends the <code class="interfacename">BeanFactory</code> interface, in
    addition to extending other interfaces to provide additional functionality
    in a more <span class="emphasis"><em>application framework-oriented style</em></span>. Many
    people use the <code class="interfacename">ApplicationContext</code> in a
    completely declarative fashion, not even creating it programmatically, but
    instead relying on support classes such as
    <code class="classname">ContextLoader</code> to automatically instantiate an
    <code class="interfacename">ApplicationContext</code> as part of the normal
    startup process of a J2EE web application.</p><p>To enhance <code class="interfacename">BeanFactory</code> functionality in a
    more framework-oriented style the context package also provides the
    following functionality:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>Access to messages in i18n-style</em></span>, through the
        <code class="interfacename">MessageSource</code> interface.</p></li><li><p><span class="emphasis"><em>Access to resources</em></span>, such as URLs and files,
        through the <code class="interfacename">ResourceLoader</code>
        interface.</p></li><li><p><span class="emphasis"><em>Event publication</em></span> to beans implementing the
        <code class="interfacename">ApplicationListener</code> interface, through
        the use of the <code class="interfacename">ApplicationEventPublisher</code>
        interface.</p></li><li><p><span class="emphasis"><em>Loading of multiple (hierarchical) contexts</em></span>,
        allowing each to be focused on one particular layer, such as the web
        layer of an application, through the
        <code class="interfacename">HierarchicalBeanFactory</code> interface.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="context-functionality-messagesource"></a>4.14.1&nbsp;Internationalization using
      <code class="interfacename">MessageSource</code></h3></div></div></div><p>The <code class="interfacename">ApplicationContext</code> interface
      extends an interface called <code class="interfacename">MessageSource</code>,
      and therefore provides internationalization (i18n) functionality. Spring
      also provides the interface
      <code class="classname">HierarchicalMessageSource</code>, which can resolve
      messages hierarchically. Together these interfaces provide the foundation
      upon which Spring effects message resolution. The methods defined on these
      interfaces include:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="methodname">String getMessage(String code, Object[] args, String
          default, Locale loc)</code>: The basic method used to retrieve a
          message from the <code class="interfacename">MessageSource</code>. When no
          message is found for the specified locale, the default message is
          used. Any arguments passed in become replacement values, using the
          <code class="interfacename">MessageFormat</code> functionality provided by
          the standard library.</p></li><li><p><code class="methodname">String getMessage(String code, Object[] args, Locale
          loc)</code>: Essentially the same as the previous method, but
          with one difference: no default message can be specified; if the
          message cannot be found, a
          <code class="classname">NoSuchMessageException</code> is thrown.</p></li><li><p><code class="methodname">String getMessage(MessageSourceResolvable resolvable,
          Locale locale)</code>: All properties used in the preceding
          methods are also wrapped in a class named
          <code class="interfacename">MessageSourceResolvable</code>, which you can
          use with this method.</p></li></ul></div><p>When an <code class="interfacename">ApplicationContext</code> is loaded,
      it automatically searches for a
      <code class="interfacename">MessageSource</code> bean defined in the context.
      The bean must have the name <code class="literal">messageSource</code>. If such a
      bean is found, all calls to the preceding methods are delegated to the
      message source. If no message source is found, the
      <code class="interfacename">ApplicationContext</code> attempts to find a
      parent containing a bean with the same name. If it does, it uses that bean
      as the <code class="interfacename">MessageSource</code>. If the
      <code class="interfacename">ApplicationContext</code> cannot find any source
      for messages, an empty <code class="classname">DelegatingMessageSource</code> is
      instantiated in order to be able to accept calls to the methods defined
      above.</p><p>Spring provides two <code class="interfacename">MessageSource</code>
      implementations, <code class="classname">ResourceBundleMessageSource</code> and
      <code class="classname">StaticMessageSource</code>. Both implement
      <code class="interfacename">HierarchicalMessageSource</code> in order to do
      nested messaging. The <code class="classname">StaticMessageSource</code> is rarely
      used but provides programmatic ways to add messages to the source. The
      <code class="classname">ResourceBundleMessageSource</code> is shown in the
      following example:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messageSource"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.support.ResourceBundleMessageSource"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"basenames"</span>&gt;
    &lt;<span class="hl-tag">list</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;format&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;exceptions&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;windows&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>In the example it is assumed you have three resource bundles defined
      in your classpath called <code class="literal">format</code>,
      <code class="literal">exceptions</code> and <code class="literal">windows</code>. Any request
      to resolve a message will be handled in the JDK standard way of resolving
      messages through ResourceBundles. For the purposes of the example, assume
      the contents of two of the above resource bundle files are...</p><pre class="programlisting"># in format.properties
message=Alligators rock!</pre><pre class="programlisting"># in exceptions.properties
argument.required=The <span class="hl-string">'{0}'</span> argument is required.</pre><p>A program to execute the <code class="classname">MessageSource</code>
      functionality is shown in the next example. Remember that all
      <code class="classname">ApplicationContext</code> implementations are also
      <code class="classname">MessageSource</code> implementations and so can be cast to
      the <code class="classname">MessageSource</code> interface.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
  MessageSource resources = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"beans.xml"</span>);
  String message = resources.getMessage(<span class="hl-string">"message"</span>, null, <span class="hl-string">"Default"</span>, null);
  System.out.println(message);
}</pre><p>The resulting output from the above program will be...</p><pre class="programlisting">Alligators rock!</pre><p>So to summarize, the <code class="classname">MessageSource</code> is defined
      in a file called <code class="literal">beans.xml</code>, which exists at the root of
      your classpath. The <code class="literal">messageSource</code> bean definition
      refers to a number of resource bundles through its
      <code class="literal">basenames</code> property. The three files that are passed in
      the list to the <code class="literal">basenames</code> property exist as files at
      the root of your classpath and are called
      <code class="literal">format.properties</code>,
      <code class="literal">exceptions.properties</code>, and
      <code class="literal">windows.properties</code> respectively.</p><p>The next example shows arguments passed to the message lookup; these
      arguments will be converted into Strings and inserted into placeholders in
      the lookup message.</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-comment">!-- this MessageSource is being used in a web application --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messageSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.support.ResourceBundleMessageSource"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"basename"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"test-messages"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-comment">!-- lets inject the above MessageSource into this POJO --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"example"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.Example"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messages"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"messageSource"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Example {

  <span class="hl-keyword">private</span> MessageSource messages;

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMessages(MessageSource messages) {
      <span class="hl-keyword">this</span>.messages = messages;
  }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> execute() {
      String message = <span class="hl-keyword">this</span>.messages.getMessage(<span class="hl-string">"argument.required"</span>,
          <span class="hl-keyword">new</span> Object [] {<span class="hl-string">"userDao"</span>}, <span class="hl-string">"Required"</span>, null);
      System.out.println(message);
  }

}</pre><p>The resulting output from the invocation of the
      <code class="methodname">execute()</code> method will be...</p><pre class="programlisting">The userDao argument is required.</pre><p>With regard to internationalization (i18n), Spring's various
      <code class="classname">MessageResource</code> implementations follow the same
      locale resolution and fallback rules as the standard JDK
      <code class="classname">ResourceBundle</code>. In short, and continuing with the
      example <code class="literal">messageSource</code> defined previously, if you want
      to resolve messages against the British (en-GB) locale, you would create
      files called <code class="literal">format_en_GB.properties</code>,
      <code class="literal">exceptions_en_GB.properties</code>, and
      <code class="literal">windows_en_GB.properties</code> respectively.</p><p>Typically, locale resolution is managed by the surrounding environment
      of the application. In this example, the locale against which (British)
      messages will be resolved is specified manually.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation"># in exceptions_en_GB.properties</span></em>
argument.required=Ebagum lad, the '{0}' argument is required, I say, required.</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) {
  MessageSource resources = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"beans.xml"</span>);
  String message = resources.getMessage(<span class="hl-string">"argument.required"</span>,
      <span class="hl-keyword">new</span> Object [] {<span class="hl-string">"userDao"</span>}, <span class="hl-string">"Required"</span>, Locale.UK);
  System.out.println(message);
}</pre><p>The resulting output from the running of the above program will
      be...</p><pre class="programlisting">Ebagum lad, the 'userDao' argument is required, I say, required.</pre><p>You can also use the <code class="classname">MessageSourceAware</code>
      interface to acquire a reference to any
      <code class="classname">MessageSource</code> that has been defined. Any bean that
      is defined in an <code class="classname">ApplicationContext</code> that implements
      the <code class="classname">MessageSourceAware</code> interface is injected with
      the application context's <code class="classname">MessageSource</code> when the
      bean is created and configured.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><span class="emphasis"><em>As an alternative to
        <code class="classname">ResourceBundleMessageSource</code>, Spring provides a
        <code class="classname">ReloadableResourceBundleMessageSource</code> class. This
        variant supports the same bundle file format but is more flexible than
        the standard JDK based
        <code class="classname">ResourceBundleMessageSource</code>
        implementation.</em></span> In particular, it allows for reading files
        from any Spring resource location (not just from the classpath) and
        supports hot reloading of bundle property files (while efficiently
        caching them in between). Check out the
        <code class="classname">ReloadableResourceBundleMessageSource</code> javadoc for
        details.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="context-functionality-events"></a>4.14.2&nbsp;Standard and Custom Events</h3></div></div></div><p>Event handling in the
      <code class="interfacename">ApplicationContext</code> is provided through the
      <code class="classname">ApplicationEvent</code> class and
      <code class="interfacename">ApplicationListener</code> interface. If a bean
      that implements the <code class="interfacename">ApplicationListener</code>
      interface is deployed into the context, every time an
      <code class="classname">ApplicationEvent</code> gets published to the
      <code class="interfacename">ApplicationContext</code>, that bean is notified.
      Essentially, this is the standard <span class="emphasis"><em>Observer</em></span> design
      pattern. Spring provides the following standard events:</p><div class="table"><a name="beans-ctx-events-tbl"></a><p class="title"><b>Table&nbsp;4.7.&nbsp;Built-in Events</b></p><div class="table-contents"><table summary="Built-in Events" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Event</th><th style="border-bottom: 1.0pt solid ; ">Explanation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">ContextRefreshedEvent</code></td><td style="border-bottom: 1.0pt solid ; ">Published when the
              <code class="interfacename">ApplicationContext</code> is initialized
              or refreshed, for example, using the
              <code class="methodname">refresh()</code> method on the
              <code class="interfacename">ConfigurableApplicationContext</code>
              interface. "Initialized" here means that all beans are loaded,
              post-processor beans are detected and activated, singletons are
              pre-instantiated, and the
              <code class="interfacename">ApplicationContext</code> object is ready
              for use. As long as the context has not been closed, a refresh can
              be triggered multiple times, provided that the chosen
              <code class="interfacename">ApplicationContext</code> actually
              supports such "hot" refreshes. For example,
              <code class="classname">XmlWebApplicationContext</code> supports hot
              refreshes, but <code class="classname">GenericApplicationContext</code>
              does not.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">ContextStartedEvent</code></td><td style="border-bottom: 1.0pt solid ; ">Published when the
              <code class="interfacename">ApplicationContext</code> is started,
              using the <code class="methodname">start()</code> method on the
              <code class="interfacename">ConfigurableApplicationContext</code>
              interface. "Started" here means that all
              <code class="interfacename">Lifecycle</code> beans receive an explicit
              start signal. Typically this signal is used to restart beans after
              an explicit stop, but it may also be used to start components that
              have not been configured for autostart , for example, components
              that have not already started on initialization.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">ContextStoppedEvent</code></td><td style="border-bottom: 1.0pt solid ; ">Published when the
              <code class="interfacename">ApplicationContext</code> is stopped,
              using the <code class="methodname">stop()</code> method on the
              <code class="interfacename">ConfigurableApplicationContext</code>
              interface. "Stopped" here means that all
              <code class="interfacename">Lifecycle</code> beans receive an explicit
              stop signal. A stopped context may be restarted through a
              <code class="methodname">start()</code> call.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">ContextClosedEvent</code></td><td style="border-bottom: 1.0pt solid ; ">Published when the
              <code class="interfacename">ApplicationContext</code> is closed, using
              the <code class="methodname">close()</code> method on the
              <code class="interfacename">ConfigurableApplicationContext</code>
              interface. "Closed" here means that all singleton beans are
              destroyed. A closed context reaches its end of life; it cannot be
              refreshed or restarted.</td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="classname">RequestHandledEvent</code></td><td style="">A web-specific event telling all beans that an HTTP request
              has been serviced. This event is published
              <span class="emphasis"><em>after</em></span> the request is complete. This event is
              only applicable to web applications using Spring's
              <code class="classname">DispatcherServlet</code>.</td></tr></tbody></table></div></div><br class="table-break"><p>You can also create and publish your own custom events. This example
      demonstrates a simple class that extends Spring's
      <code class="classname">ApplicationEvent</code> base class:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BlackListEvent <span class="hl-keyword">extends</span> ApplicationEvent {
  <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> String address;
  <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> String test;

  <span class="hl-keyword">public</span> BlackListEvent(Object source, String address, String test) {
      <span class="hl-keyword">super</span>(source);
      <span class="hl-keyword">this</span>.address = address;
      <span class="hl-keyword">this</span>.test = test;
  }

  <span class="hl-comment">// accessor and other methods...</span>
}</pre><p>To publish a custom <code class="classname">ApplicationEvent</code>, call the
      <code class="methodname">publishEvent()</code> method on an
      <code class="interfacename">ApplicationEventPublisher</code>. Typically this
      is done by creating a class that implements
      <code class="interfacename">ApplicationEventPublisherAware</code> and
      registering it as a Spring bean. The following example demonstrates such a
      class:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> EmailService <span class="hl-keyword">implements</span> ApplicationEventPublisherAware {

  <span class="hl-keyword">private</span> List&lt;String&gt; blackList;
  <span class="hl-keyword">private</span> ApplicationEventPublisher publisher;

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBlackList(List&lt;String&gt; blackList) {
      <span class="hl-keyword">this</span>.blackList = blackList;
  }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setApplicationEventPublisher(ApplicationEventPublisher publisher) {
      <span class="hl-keyword">this</span>.publisher = publisher;
  }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> sendEmail(String address, String text) {
      <span class="hl-keyword">if</span> (blackList.contains(address)) {
          BlackListEvent event = <span class="hl-keyword">new</span> BlackListEvent(<span class="hl-keyword">this</span>, address, text);
          publisher.publishEvent(event);
          <span class="hl-keyword">return</span>;
      }
      <span class="hl-comment">// send email...</span>
  }
}</pre><p>At configuration time, the Spring container will detect that
      <code class="classname">EmailService</code> implements
      <code class="interfacename">ApplicationEventPublisherAware</code> and will
      automatically call
      <code class="methodname">setApplicationEventPublisher()</code>. In reality, the
      parameter passed in will be the Spring container itself; you're simply
      interacting with the application context via its
      <code class="interfacename">ApplicationEventPublisher</code> interface.</p><p>To receive the custom <code class="classname">ApplicationEvent</code>, create
      a class that implements <code class="interfacename">ApplicationListener</code>
      and register it as a Spring bean. The following example demonstrates such
      a class:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BlackListNotifier <span class="hl-keyword">implements</span> ApplicationListener&lt;BlackListEvent&gt; {

  <span class="hl-keyword">private</span> String notificationAddress;

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setNotificationAddress(String notificationAddress) {
      <span class="hl-keyword">this</span>.notificationAddress = notificationAddress;
  }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onApplicationEvent(BlackListEvent event) {
        <span class="hl-comment">// notify appropriate parties via notificationAddress...</span>
  }
}</pre><p>Notice that <code class="interfacename">ApplicationListener</code> is
      generically parameterized with the type of your custom event,
      <code class="classname">BlackListEvent</code>. This means that the
      <code class="methodname">onApplicationEvent()</code> method can remain type-safe,
      avoiding any need for downcasting. You may register as many event
      listeners as you wish, but note that by default event listeners receive
      events synchronously. This means the
      <code class="methodname">publishEvent()</code> method blocks until all listeners
      have finished processing the event. One advantage of this synchronous and
      single-threaded approach is that when a listener receives an event, it
      operates inside the transaction context of the publisher if a transaction
      context is available. If another strategy for event publication becomes
      necessary, refer to the JavaDoc for Spring's
      <code class="interfacename">ApplicationEventMulticaster</code>
      interface.</p><p>The following example shows the bean definitions used to
      register and configure each of the classes above:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emailService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.EmailService"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"blackList"</span>&gt;
      &lt;<span class="hl-tag">list</span>&gt;
          &lt;<span class="hl-tag">value</span>&gt;known.spammer@example.org&lt;<span class="hl-tag">/value</span>&gt;
          &lt;<span class="hl-tag">value</span>&gt;known.hacker@example.org&lt;<span class="hl-tag">/value</span>&gt;
          &lt;<span class="hl-tag">value</span>&gt;john.doe@example.org&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"blackListNotifier"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.BlackListNotifier"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"notificationAddress"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"blacklist@example.org"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Putting it all together, when the <code class="methodname">sendEmail()</code>
      method of the <code class="literal">emailService</code> bean is called, if there are
      any emails that should be blacklisted, a custom event of type
      <code class="classname">BlackListEvent</code> is published. The
      <code class="literal">blackListNotifier</code> bean is registered as an
      <code class="interfacename">ApplicationListener</code> and thus receives the
      <code class="classname">BlackListEvent</code>, at which point it can notify
      appropriate parties.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Spring's eventing mechanism is designed for simple communication
        between Spring beans within the same application context. However, for
        more sophisticated enterprise integration needs, the
        separately-maintained <a class="ulink" href="http://springsource.org/spring-integration" target="_top">Spring
        Integration</a> project provides complete support for building
        lightweight, <a class="ulink" href="http://www.enterpriseintegrationpatterns.com" target="_top">pattern-oriented</a>, event-driven architectures that build upon
        the well-known Spring programming model.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="context-functionality-resources"></a>4.14.3&nbsp;Convenient access to low-level resources</h3></div></div></div><p>For optimal usage and understanding of application contexts, users
      should generally familiarize themselves with Spring's
      <code class="interfacename">Resource</code> abstraction, as described in the
      chapter <a class="xref" href="#resources" title="5.&nbsp;Resources">Chapter&nbsp;5, <i>Resources</i></a>.</p><p>An application context is a
      <code class="interfacename">ResourceLoader</code>, which can be used to load
      <code class="interfacename">Resource</code>s. A
      <code class="interfacename">Resource</code> is essentially a more feature rich
      version of the JDK class <code class="literal">java.net.URL</code>, in fact, the
      implementations of the <code class="interfacename">Resource</code> wrap an
      instance of <code class="literal">java.net.URL</code> where appropriate. A
      <code class="interfacename">Resource</code> can obtain low-level resources
      from almost any location in a transparent fashion, including from the
      classpath, a filesystem location, anywhere describable with a standard
      URL, and some other variations. If the resource location string is a
      simple path without any special prefixes, where those resources come from
      is specific and appropriate to the actual application context type.</p><p>You can configure a bean deployed into the application context to
      implement the special callback interface,
      <code class="interfacename">ResourceLoaderAware</code>, to be automatically
      called back at initialization time with the application context itself
      passed in as the <code class="interfacename">ResourceLoader</code>. You can
      also expose properties of type <code class="interfacename">Resource</code>, to
      be used to access static resources; they will be injected into it like any
      other properties. You can specify those
      <code class="interfacename">Resource</code> properties as simple String paths,
      and rely on a special JavaBean
      <code class="interfacename">PropertyEditor</code> that is automatically
      registered by the context, to convert those text strings to actual
      <code class="interfacename">Resource</code> objects when the bean is
      deployed.</p><p>The location path or paths supplied to an
      <code class="interfacename">ApplicationContext</code> constructor are actually
      resource strings, and in simple form are treated appropriately to the
      specific context implementation.
      <code class="classname">ClassPathXmlApplicationContext</code> treats a simple
      location path as a classpath location. You can also use location paths
      (resource strings) with special prefixes to force loading of definitions
      from the classpath or a URL, regardless of the actual context type.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="context-create"></a>4.14.4&nbsp;Convenient <code class="interfacename">ApplicationContext</code>
      instantiation for web applications</h3></div></div></div><p>You can create <code class="interfacename">ApplicationContext</code>
      instances declaratively by using, for example, a
      <code class="classname">ContextLoader</code>. Of course you can also create
      <code class="interfacename">ApplicationContext</code> instances
      programmatically by using one of the
      <code class="interfacename">ApplicationContext</code> implementations.</p><p>The <code class="classname">ContextLoader</code> mechanism comes in two
      flavors: the <code class="classname">ContextLoaderListener</code> and the
      <code class="classname">ContextLoaderServlet</code>. They have the same
      functionality but differ in that the listener version is not reliable in
      Servlet 2.3 containers. In the Servlet 2.4 specification, Servlet context
      listeners must execute immediately after the Servlet context for the web
      application is created and is available to service the first request (and
      also when the Servlet context is about to be shut down). As such a Servlet
      context listener is an ideal place to initialize the Spring
      <code class="interfacename">ApplicationContext</code>. All things being equal,
      you should probably prefer <code class="classname">ContextLoaderListener</code>;
      for more information on compatibility, have a look at the Javadoc for the
      <code class="classname">ContextLoaderServlet</code>.</p><p>You can register an <code class="interfacename">ApplicationContext</code>
      using the <code class="classname">ContextLoaderListener</code> as follows:</p><pre class="programlisting">&lt;<span class="hl-tag">context-param</span>&gt;
&lt;<span class="hl-tag">param-name</span>&gt;contextConfigLocation&lt;<span class="hl-tag">/param-name</span>&gt;
&lt;<span class="hl-tag">param-value</span>&gt;/WEB-INF/daoContext.xml /WEB-INF/applicationContext.xml&lt;<span class="hl-tag">/param-value</span>&gt;
&lt;<span class="hl-tag">/context-param</span>&gt;

&lt;<span class="hl-tag">listener</span>&gt;
&lt;<span class="hl-tag">listener-class</span>&gt;org.springframework.web.context.ContextLoaderListener&lt;<span class="hl-tag">/listener-class</span>&gt;
&lt;<span class="hl-tag">/listener</span>&gt;

&lt;<span class="hl-comment">!-- or use the ContextLoaderServlet instead of the above listener
&lt;servlet&gt;
&lt;servlet-name&gt;context&lt;/servlet-name&gt;
&lt;servlet-class&gt;org.springframework.web.context.ContextLoaderServlet&lt;/servlet-class&gt;
&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
--</span>&gt;</pre><p>The listener inspects the <code class="literal">contextConfigLocation</code>
      parameter. If the parameter does not exist, the listener uses
      <code class="literal">/WEB-INF/applicationContext.xml</code> as a default. When the
      parameter <span class="emphasis"><em>does</em></span> exist, the listener separates the
      String by using predefined delimiters (comma, semicolon and whitespace)
      and uses the values as locations where application contexts will be
      searched. Ant-style path patterns are supported as well. Examples are
      <code class="literal">/WEB-INF/*Context.xml</code> for all files with names ending
      with "Context.xml", residing in the "WEB-INF" directory, and
      <code class="literal">/WEB-INF/**/*Context.xml</code>, for all such files in any
      subdirectory of "WEB-INF".</p><p>You can use <code class="classname">ContextLoaderServlet</code> instead of
      <code class="classname">ContextLoaderListener</code>. The Servlet uses the
      <code class="literal">contextConfigLocation</code> parameter just as the listener
      does.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e9544"></a>4.14.5&nbsp;Deploying a Spring ApplicationContext as a J2EE RAR file</h3></div></div></div><p>In Spring 2.5 and later, it is possible to deploy a Spring
      ApplicationContext as a RAR file, encapsulating the context and all of its
      required bean classes and library JARs in a J2EE RAR deployment unit. This
      is the equivalent of bootstrapping a standalone ApplicationContext, just
      hosted in J2EE environment, being able to access the J2EE servers
      facilities. RAR deployment is a more natural alternative to scenario of
      deploying a headless WAR file, in effect, a WAR file without any HTTP
      entry points that is used only for bootstrapping a Spring
      ApplicationContext in a J2EE environment.</p><p>RAR deployment is ideal for application contexts that do not need HTTP
      entry points but rather consist only of message endpoints and scheduled
      jobs. Beans in such a context can use application server resources such as
      the JTA transaction manager and JNDI-bound JDBC DataSources and JMS
      ConnectionFactory instances, and may also register with the platform's JMX
      server - all through Spring's standard transaction management and JNDI and
      JMX support facilities. Application components can also interact with the
      application server's JCA WorkManager through Spring's
      <code class="interfacename">TaskExecutor</code> abstraction.</p><p>Check out the JavaDoc of the <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/jca/context/SpringContextResourceAdapter.html" target="_top">SpringContextResourceAdapter</a> class for the configuration details
      involved in RAR deployment.</p><p><span class="emphasis"><em>For a simple deployment of a Spring ApplicationContext as a
      J2EE RAR file:</em></span> package all application classes into a RAR file,
      which is a standard JAR file with a different file extension. Add all
      required library JARs into the root of the RAR archive. Add a
      "META-INF/ra.xml" deployment descriptor (as shown in
      <code class="classname">SpringContextResourceAdapter</code>s JavaDoc) and the
      corresponding Spring XML bean definition file(s) (typically
      "META-INF/applicationContext.xml"), and drop the resulting RAR file into
      your application server's deployment directory.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Such RAR deployment units are usually self-contained; they do not
        expose components to the outside world, not even to other modules of the
        same application. Interaction with a RAR-based ApplicationContext
        usually occurs through JMS destinations that it shares with other
        modules. A RAR-based ApplicationContext may also, for example, schedule
        some jobs, reacting to new files in the file system (or the like). If it
        needs to allow synchronous access from the outside, it could for example
        export RMI endpoints, which of course may be used by other application
        modules on the same machine.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-beanfactory"></a>4.15&nbsp;The BeanFactory</h2></div></div></div><p>The <code class="classname">BeanFactory</code> provides the underlying basis
      for Spring's IoC functionality but it is only used directly in integration
      with other third-party frameworks and is now largely historical in nature
      for most users of Spring. The <code class="classname">BeanFactory</code> and
      related interfaces, such as <code class="classname">BeanFactoryAware</code>,
      <code class="classname">InitializingBean</code>,
      <code class="classname">DisposableBean</code>, are still present in Spring for the
      purposes of backward compatibility with the large number of third-party
      frameworks that integrate with Spring. Often third-party components that
      can not use more modern equivalents such as <code class="code">@PostConstruct</code> or
      <code class="code">@PreDestroy</code> in order to remain compatible with JDK 1.4 or to
      avoid a dependency on JSR-250.</p><p>This section provides additional background into the differences
      between the <code class="interfacename">BeanFactory</code> and
      <code class="interfacename">ApplicationContext</code> and how one might access
      the IoC container directly through a classic singleton lookup.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="context-introduction-ctx-vs-beanfactory"></a>4.15.1&nbsp;<code class="interfacename">BeanFactory</code> or
        <code class="interfacename">ApplicationContext</code>?</h3></div></div></div><p>Use an <code class="interfacename">ApplicationContext</code> unless you
        have a good reason for not doing so.</p><p>Because the <code class="interfacename">ApplicationContext</code>
        includes all functionality of the
        <code class="interfacename">BeanFactory</code>, it is generally recommended
        over the <code class="interfacename">BeanFactory</code>, except for a few
        situations such as in an <code class="classname">Applet</code> where memory
        consumption might be critical and a few extra kilobytes might make a
        difference. However, for most typical enterprise applications and
        systems, the <code class="interfacename">ApplicationContext</code> is what
        you will want to use. Spring 2.0 and later makes
        <span class="emphasis"><em>heavy</em></span> use of the <a class="link" href="#beans-factory-extension-bpp" title="4.8.1&nbsp;Customizing beans using a BeanPostProcessor"><code class="interfacename">BeanPostProcessor</code> extension point</a>
        (to effect proxying and so on). If you use only a plain
        <code class="interfacename">BeanFactory</code>, a fair amount of support
        such as transactions and AOP will not take effect, at least not without
        some extra steps on your part. This situation could be confusing because
        nothing is actually wrong with the configuration.</p><p>The following table lists features provided by the
        <code class="interfacename">BeanFactory</code> and
        <code class="interfacename">ApplicationContext</code> interfaces and
        implementations.</p><div class="table"><a name="context-introduction-ctx-vs-beanfactory-feature-matrix"></a><p class="title"><b>Table&nbsp;4.8.&nbsp;Feature Matrix</b></p><div class="table-contents"><table summary="Feature Matrix" width="100%" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="left"><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Feature</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center"><code class="interfacename">BeanFactory</code></th><th style="border-bottom: 1.0pt solid ; " align="center"><code class="interfacename">ApplicationContext</code></th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p>Bean instantiation/wiring</p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center"><p>Yes</p></td><td style="border-bottom: 1.0pt solid ; " align="center"><p>Yes</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p>Automatic
                <code class="interfacename">BeanPostProcessor</code>
                registration</p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center"><p>No</p></td><td style="border-bottom: 1.0pt solid ; " align="center"><p>Yes</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p>Automatic
                <code class="interfacename">BeanFactoryPostProcessor</code>
                registration</p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center"><p>No</p></td><td style="border-bottom: 1.0pt solid ; " align="center"><p>Yes</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p>Convenient
                <code class="interfacename">MessageSource</code> access (for
                i18n)</p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center"><p>No</p></td><td style="border-bottom: 1.0pt solid ; " align="center"><p>Yes</p></td></tr><tr><td style="border-right: 1.0pt solid ; " align="left"><p><code class="interfacename">ApplicationEvent</code>
                publication</p></td><td style="border-right: 1.0pt solid ; " align="center"><p>No</p></td><td style="" align="center"><p>Yes</p></td></tr></tbody></table></div></div><br class="table-break"><p>To explicitly register a bean post-processor with a
        <code class="interfacename">BeanFactory</code> implementation, you must
        write code like this:</p><pre class="programlisting">ConfigurableBeanFactory factory = <span class="hl-keyword">new</span> XmlBeanFactory(...);

<span class="hl-comment">// now register any needed BeanPostProcessor instances</span>
MyBeanPostProcessor postProcessor = <span class="hl-keyword">new</span> MyBeanPostProcessor();
factory.addBeanPostProcessor(postProcessor);

<span class="hl-comment">// now start using the factory</span></pre><p>To explicitly register a
        <code class="classname">BeanFactoryPostProcessor</code> when using a
        <code class="interfacename">BeanFactory</code> implementation, you must
        write code like this:</p><pre class="programlisting">XmlBeanFactory factory = <span class="hl-keyword">new</span> XmlBeanFactory(<span class="hl-keyword">new</span> FileSystemResource(<span class="hl-string">"beans.xml"</span>));

<span class="hl-comment">// bring in some property values from a Properties file</span>
PropertyPlaceholderConfigurer cfg = <span class="hl-keyword">new</span> PropertyPlaceholderConfigurer();
cfg.setLocation(<span class="hl-keyword">new</span> FileSystemResource(<span class="hl-string">"jdbc.properties"</span>));

<span class="hl-comment">// now actually do the replacement</span>
cfg.postProcessBeanFactory(factory);</pre><p>In both cases, the explicit registration step is inconvenient, which
        is one reason why the various
        <code class="interfacename">ApplicationContext</code> implementations are
        preferred above plain <code class="interfacename">BeanFactory</code>
        implementations in the vast majority of Spring-backed applications,
        especially when using <code class="literal">BeanFactoryPostProcessors</code> and
        <code class="classname">BeanPostProcessors</code>. These mechanisms implement
        important functionality such as property placeholder replacement and
        AOP.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-servicelocator"></a>4.15.2&nbsp;Glue code and the evil singleton</h3></div></div></div><p>It is best to write most application code in a dependency-injection
        (DI) style, where that code is served out of a Spring IoC container, has
        its own dependencies supplied by the container when it is created, and
        is completely unaware of the container. However, for the small glue
        layers of code that are sometimes needed to tie other code together, you
        sometimes need a singleton (or quasi-singleton) style access to a Spring
        IoC container. For example, third-party code may try to construct new
        objects directly (<code class="literal">Class.forName()</code> style), without the
        ability to get these objects out of a Spring IoC container.
        If
        the object constructed by the third-party code is a small stub or proxy,
        which then uses a singleton style access to a Spring IoC container to
        get a real object to delegate to, then inversion of control has still
        been achieved for the majority of the code (the object coming out of the
        container). Thus most code is still unaware of the container or how it
        is accessed, and remains decoupled from other code, with all ensuing
        benefits. EJBs may also use this stub/proxy approach to delegate to a
        plain Java implementation object, retrieved from a Spring IoC container.
        While the Spring IoC container itself ideally does not have to be a
        singleton, it may be unrealistic in terms of memory usage or
        initialization times (when using beans in the Spring IoC container such
        as a Hibernate <code class="interfacename">SessionFactory</code>) for each
        bean to use its own, non-singleton Spring IoC container.</p><p>Looking up the application context in a service locator style is
        sometimes the only option for accessing shared Spring-managed
        components, such as in an EJB 2.1 environment, or when you want to share
        a single ApplicationContext as a parent to WebApplicationContexts across
        WAR files. In this case you should look into using the utility class
        <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/access/ContextSingletonBeanFactoryLocator.html" target="_top"><code class="classname">ContextSingletonBeanFactoryLocator</code></a>
        locator that is described in this <a class="ulink" href="http://blog.springsource.com/2007/06/11/using-a-shared-parent-application-context-in-a-multi-war-spring-application/" target="_top">SpringSource team blog entry</a>.</p></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d0e1768" href="#d0e1768" class="para">1</a>] </sup>See <a class="xref" href="#background-ioc" title="Background">Background</a></p></div><div class="footnote"><p><sup>[<a name="ftn.d0e3795" href="#d0e3795" class="para">2</a>] </sup>See <a class="xref" href="#beans-factory-collaborators" title="4.4.1&nbsp;Dependency injection">Section&nbsp;4.4.1, &#8220;Dependency injection&#8221;</a></p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="resources"></a>5.&nbsp;Resources</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-introduction"></a>5.1&nbsp;Introduction</h2></div></div></div><p>Java's standard <code class="classname">java.net.URL</code> class and
    standard handlers for various URL prefixes unfortunately are not quite
    adequate enough for all access to low-level resources. For example,
	there is no standardized <code class="classname">URL</code> implementation
	that may be used to access a resource that needs to be obtained from
	the classpath, or relative to a
	<code class="interfacename">ServletContext</code>. While it is possible
    to register new handlers for specialized <code class="classname">URL</code>
	prefixes (similar to existing handlers for prefixes such as
	<code class="literal">http:</code>), this is generally quite complicated, and the
	<code class="classname">URL</code> interface still lacks some desirable
    functionality, such as a method to check for the existence of the
	resource being pointed to.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-resource"></a>5.2&nbsp;The <code class="interfacename">Resource</code> interface</h2></div></div></div><p>Spring's <code class="interfacename">Resource</code> interface is meant
    to be a more capable interface for abstracting access to low-level
    resources.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Resource <span class="hl-keyword">extends</span> InputStreamSource {

    <span class="hl-keyword">boolean</span> exists();

    <span class="hl-keyword">boolean</span> isOpen();

    URL getURL() <span class="hl-keyword">throws</span> IOException;

    File getFile() <span class="hl-keyword">throws</span> IOException;

    Resource createRelative(String relativePath) <span class="hl-keyword">throws</span> IOException;

    String getFilename();

    String getDescription();
}</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> InputStreamSource {

    InputStream getInputStream() <span class="hl-keyword">throws</span> IOException;
}</pre><p>Some of the most important methods from the
    <code class="interfacename">Resource</code> interface are:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="methodname">getInputStream()</code>: locates and opens the
        resource, returning an <code class="classname">InputStream</code> for reading
        from the resource. It is expected that each invocation returns a
        fresh <code class="classname">InputStream</code>. It is the responsibility of
        the caller to close the stream.</p></li><li><p><code class="methodname">exists()</code>: returns a
        <code class="literal">boolean</code> indicating whether this resource actually
        exists in physical form.</p></li><li><p><code class="methodname">isOpen()</code>: returns a
        <code class="literal">boolean</code> indicating whether this resource represents
        a handle with an open stream. If <code class="literal">true</code>, the
        <code class="classname">InputStream</code> cannot be read multiple times, and
        must be read once only and then closed to avoid resource leaks. Will
        be <code class="literal">false</code> for all usual resource implementations,
        with the exception of
        <code class="classname">InputStreamResource</code>.</p></li><li><p><code class="methodname">getDescription()</code>: returns a description
        for this resource, to be used for error output when working with the
        resource. This is often the fully qualified file name or the actual
        URL of the resource.</p></li></ul></div><p>Other methods allow you to obtain an actual
    <code class="classname">URL</code> or <code class="classname">File</code> object
    representing the resource (if the underlying implementation is compatible,
    and supports that functionality).</p><p>The <code class="interfacename">Resource</code> abstraction is used
    extensively in Spring itself, as an argument type in many method
    signatures when a resource is needed. Other methods in some Spring APIs
    (such as the constructors to various
    <code class="interfacename">ApplicationContext</code> implementations), take a
    <code class="classname">String</code> which in unadorned or simple form is used to
    create a <code class="interfacename">Resource</code> appropriate to that
    context implementation, or via special prefixes on the
    <code class="classname">String</code> path, allow the caller to specify that a
    specific <code class="interfacename">Resource</code> implementation must be
    created and used.</p><p>While the <code class="interfacename">Resource</code> interface is used
    a lot with Spring and by Spring, it's actually very useful to use as a
    general utility class by itself in your own code, for access to resources,
    even when your code doesn't know or care about any other parts of Spring.
    While this couples your code to Spring, it really only couples it to this
    small set of utility classes, which are serving as a more capable
    replacement for <code class="classname">URL</code>, and can be considered
    equivalent to any other library you would use for this purpose.</p><p>It is important to note that the
    <code class="interfacename">Resource</code> abstraction does not replace
    functionality: it wraps it where possible. For example, a
    <code class="classname">UrlResource</code> wraps a URL, and uses the wrapped
    <code class="classname">URL</code> to do its work.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-implementations"></a>5.3&nbsp;Built-in <code class="interfacename">Resource</code> implementations</h2></div></div></div><p>There are a number of <code class="interfacename">Resource</code>
    implementations that come supplied straight out of the box in
    Spring:</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-urlresource"></a>5.3.1&nbsp;<code class="classname">UrlResource</code></h3></div></div></div><p>The <code class="classname">UrlResource</code> wraps a
      <code class="classname">java.net.URL</code>, and may be used to access any
      object that is normally accessible via a URL, such as files, an HTTP
      target, an FTP target, etc. All URLs have a standardized
      <code class="classname">String</code> representation, such that appropriate
      standardized prefixes are used to indicate one URL type from another.
      This includes <code class="literal">file:</code> for accessing filesystem paths,
      <code class="literal">http:</code> for accessing resources via the HTTP protocol,
      <code class="literal">ftp:</code> for accessing resources via FTP, etc.</p><p>A <code class="classname">UrlResource</code> is created by Java code
      explicitly using the <code class="classname">UrlResource</code> constructor, but
      will often be created implicitly when you call an API method which takes
      a <code class="classname">String</code> argument which is meant to represent a
      path. For the latter case, a JavaBeans
      <code class="interfacename">PropertyEditor</code> will ultimately decide
      which type of <code class="interfacename">Resource</code> to create. If the
      path string contains a few well-known (to it, that is) prefixes such as
      <code class="literal">classpath:</code>, it will create an appropriate specialized
      <code class="interfacename">Resource</code> for that prefix. However, if it
      doesn't recognize the prefix, it will assume the this is just a standard
      URL string, and will create a <code class="classname">UrlResource</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-classpathresource"></a>5.3.2&nbsp;<code class="classname">ClassPathResource</code></h3></div></div></div><p>This class represents a resource which should be obtained from the
      classpath. This uses either the thread context class loader, a given
      class loader, or a given class for loading resources.</p><p>This <code class="interfacename">Resource</code> implementation
      supports resolution as <code class="classname">java.io.File</code> if the class
      path resource resides in the file system, but not for classpath
      resources which reside in a jar and have not been expanded (by the
      servlet engine, or whatever the environment is) to the filesystem. To
      address this the various <code class="interfacename">Resource</code>
      implementations always support resolution as a
      <code class="classname">java.net.URL</code>.</p><p>A <code class="classname">ClassPathResource</code> is created by Java code
      explicitly using the <code class="classname">ClassPathResource</code>
      constructor, but will often be created implicitly when you call an API
      method which takes a <code class="classname">String</code> argument which is
      meant to represent a path. For the latter case, a JavaBeans
      <code class="interfacename">PropertyEditor</code> will recognize the special
      prefix <code class="literal">classpath:</code>on the string path, and create a
      <code class="classname">ClassPathResource</code> in that case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-filesystemresource"></a>5.3.3&nbsp;<code class="classname">FileSystemResource</code></h3></div></div></div><p>This is a <code class="interfacename">Resource</code> implementation
      for <code class="classname">java.io.File</code> handles. It obviously supports
      resolution as a <code class="classname">File</code>, and as a
      <code class="classname">URL</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-servletcontextresource"></a>5.3.4&nbsp;<code class="classname">ServletContextResource</code></h3></div></div></div><p>This is a <code class="interfacename">Resource</code> implementation
      for <code class="interfacename">ServletContext</code> resources,
      interpreting relative paths within the relevant web application's root
      directory.</p><p>This always supports stream access and URL access, but only allows
      <code class="classname">java.io.File</code> access when the web application
      archive is expanded and the resource is physically on the filesystem.
      Whether or not it's expanded and on the filesystem like this, or
      accessed directly from the JAR or somewhere else like a DB (it's
      conceivable) is actually dependent on the Servlet container.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-inputstreamresource"></a>5.3.5&nbsp;<code class="classname">InputStreamResource</code></h3></div></div></div><p>A <code class="interfacename">Resource</code> implementation for a
      given <code class="interfacename">InputStream</code>. This should only be
      used if no specific <code class="interfacename">Resource</code>
      implementation is applicable. In particular, prefer
      <code class="classname">ByteArrayResource</code> or any of the file-based
      <code class="interfacename">Resource</code> implementations where
      possible.</p><p>In contrast to other <code class="interfacename">Resource</code>
      implementations, this is a descriptor for an
      <span class="emphasis"><em>already</em></span> opened resource - therefore returning
      <code class="literal">true</code> from <code class="methodname">isOpen()</code>. Do not
      use it if you need to keep the resource descriptor somewhere, or if you
      need to read a stream multiple times.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-bytearrayresource"></a>5.3.6&nbsp;<code class="classname">ByteArrayResource</code></h3></div></div></div><p>This is a <code class="interfacename">Resource</code> implementation
      for a given byte array. It creates a
      <code class="classname">ByteArrayInputStream</code> for the given byte
      array.</p><p>It's useful for loading content from any given byte array, without
      having to resort to a single-use
      <code class="classname">InputStreamResource</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-resourceloader"></a>5.4&nbsp;The <code class="interfacename">ResourceLoader</code></h2></div></div></div><p>The <code class="interfacename">ResourceLoader</code> interface is meant
    to be implemented by objects that can return (i.e. load)
    <code class="interfacename">Resource</code> instances.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ResourceLoader {
    Resource getResource(String location);
}</pre><p>All application contexts implement the
    <code class="interfacename">ResourceLoader</code> interface, and therefore all
    application contexts may be used to obtain
    <code class="interfacename">Resource</code> instances.</p><p>When you call <code class="methodname">getResource()</code> on a specific
    application context, and the location path specified doesn't have a
    specific prefix, you will get back a
    <code class="interfacename">Resource</code> type that is appropriate to that
    particular application context. For example, assume the following snippet
    of code was executed against a
    <code class="classname">ClassPathXmlApplicationContext</code> instance:</p><pre class="programlisting">Resource template = ctx.getResource(<span class="hl-string">"some/resource/path/myTemplate.txt"</span>);</pre><p>What would be returned would be a
    <code class="classname">ClassPathResource</code>; if the same method was executed
    against a <code class="classname">FileSystemXmlApplicationContext</code> instance,
    you'd get back a <code class="classname">FileSystemResource</code>. For a
    <code class="classname">WebApplicationContext</code>, you'd get back a
    <code class="classname">ServletContextResource</code>, and so on.</p><p>As such, you can load resources in a fashion appropriate to the
    particular application context.</p><p>On the other hand, you may also force
    <code class="classname">ClassPathResource</code> to be used, regardless of the
    application context type, by specifying the special
    <code class="literal">classpath:</code> prefix:</p><pre class="programlisting">Resource template = ctx.getResource(<span class="hl-string">"classpath:some/resource/path/myTemplate.txt"</span>);</pre><p>Similarly, one can force a <code class="classname">UrlResource</code> to be
    used by specifying any of the standard <code class="classname">java.net.URL</code>
    prefixes:</p><pre class="programlisting">Resource template = ctx.getResource(<span class="hl-string">"file:/some/resource/path/myTemplate.txt"</span>);</pre><pre class="programlisting">Resource template = ctx.getResource(<span class="hl-string">"http://myhost.com/resource/path/myTemplate.txt"</span>);</pre><p>The following table summarizes the strategy for converting
    <code class="classname">String</code>s to
    <code class="interfacename">Resource</code>s:</p><div class="table"><a name="resources-resource-strings"></a><p class="title"><b>Table&nbsp;5.1.&nbsp;Resource strings</b></p><div class="table-contents"><table summary="Resource strings" width="100%" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="left"><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Prefix</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Example</th><th style="border-bottom: 1.0pt solid ; " align="center">Explanation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p>classpath:</p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p> <code class="literal">classpath:com/myapp/config.xml</code>
            </p></td><td style="border-bottom: 1.0pt solid ; "><p>Loaded from the classpath.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p>file:</p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p> <code class="literal">file:/data/config.xml</code>
            </p></td><td style="border-bottom: 1.0pt solid ; "><p> Loaded as a <code class="classname">URL</code>, from the
            filesystem. <sup>[<a name="d0e10253" href="#ftn.d0e10253" class="footnote">1</a>]</sup> </p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p>http:</p></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><p> <code class="literal">http://myserver/logo.png</code>
            </p></td><td style="border-bottom: 1.0pt solid ; "><p>Loaded as a
            <code class="classname">URL</code>.</p></td></tr><tr><td style="border-right: 1.0pt solid ; " align="left"><p>(none)</p></td><td style="border-right: 1.0pt solid ; "><p> <code class="literal">/data/config.xml</code> </p></td><td style=""><p> Depends on the underlying
            <code class="interfacename">ApplicationContext</code>. </p></td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a name="ftn.d0e10253" href="#d0e10253" class="para">1</a>] </sup>But see also
                <a class="xref" href="#resources-filesystemresource-caveats" title="5.7.3&nbsp;FileSystemResource caveats">Section&nbsp;5.7.3, &#8220;FileSystemResource caveats&#8221;</a>.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-resourceloaderaware"></a>5.5&nbsp;The <code class="interfacename">ResourceLoaderAware</code> interface</h2></div></div></div><p>The <code class="interfacename">ResourceLoaderAware</code> interface is
    a special marker interface, identifying objects that expect to be provided
    with a <code class="interfacename">ResourceLoader</code> reference.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ResourceLoaderAware {

   <span class="hl-keyword">void</span> setResourceLoader(ResourceLoader resourceLoader);
}</pre><p>When a class implements
    <code class="interfacename">ResourceLoaderAware</code> and is deployed into an
    application context (as a Spring-managed bean), it is recognized as
    <code class="interfacename">ResourceLoaderAware</code> by the application
    context. The application context will then invoke the
    <code class="methodname">setResourceLoader(ResourceLoader)</code>, supplying
    itself as the argument (remember, all application contexts in Spring
    implement the <code class="interfacename">ResourceLoader</code>
    interface).</p><p>Of course, since an
    <code class="interfacename">ApplicationContext</code> is a
    <code class="interfacename">ResourceLoader</code>, the bean could also
    implement the <code class="interfacename">ApplicationContextAware</code>
    interface and use the supplied application context directly to load
    resources, but in general, it's better to use the specialized
    <code class="interfacename">ResourceLoader</code> interface if that's all
    that's needed. The code would just be coupled to the resource loading
    interface, which can be considered a utility interface, and not the whole
    Spring <code class="interfacename">ApplicationContext</code> interface.</p><p>As of Spring 2.5, you can rely upon autowiring of the
    <code class="interfacename">ResourceLoader</code> as an alternative to
    implementing the <code class="interfacename">ResourceLoaderAware</code> interface.
    The "traditional" <code class="literal">constructor</code> and <code class="literal">byType</code>
    autowiring modes (as described in <a class="xref" href="#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators">Section&nbsp;4.4.5, &#8220;Autowiring collaborators&#8221;</a>)
    are now capable of providing a dependency of type
    <code class="interfacename">ResourceLoader</code> for either a
    constructor argument or setter method parameter respectively. For more flexibility
    (including the ability to autowire fields and multiple parameter methods), consider
    using the new annotation-based autowiring features. In that case, the
    <code class="interfacename">ResourceLoader</code> will be autowired into a field,
    constructor argument, or method parameter that is expecting the
    <code class="interfacename">ResourceLoader</code> type as long as the field,
    constructor, or method in question carries the
    <code class="interfacename">@Autowired</code> annotation. For more information,
    see <a class="xref" href="#beans-autowired-annotation" title="4.9.2&nbsp;@Autowired">Section&nbsp;4.9.2, &#8220;@Autowired&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-as-dependencies"></a>5.6&nbsp;<code class="literal">Resources</code> as dependencies</h2></div></div></div><p>If the bean itself is going to determine and supply the resource
    path through some sort of dynamic process, it probably makes sense for the
    bean to use the <code class="interfacename">ResourceLoader</code> interface to
    load resources. Consider as an example the loading of a template of some
    sort, where the specific resource that is needed depends on the role of
    the user. If the resources are static, it makes sense to eliminate the use
    of the <code class="interfacename">ResourceLoader</code> interface completely,
    and just have the bean expose the <code class="interfacename">Resource</code>
    properties it needs, and expect that they will be injected into it.</p><p>What makes it trivial to then inject these properties, is that all
    application contexts register and use a special JavaBeans
    <code class="interfacename">PropertyEditor</code> which can convert
    <code class="classname">String</code> paths to
    <code class="interfacename">Resource</code> objects. So if
    <code class="literal">myBean</code> has a template property of type
    <code class="interfacename">Resource</code>, it can be configured with a
    simple string for that resource, as follows:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"template"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"some/resource/path/myTemplate.txt"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Note that the resource path has no prefix, so because the
    application context itself is going to be used as the
    <code class="interfacename">ResourceLoader</code>, the resource itself will be
    loaded via a <code class="classname">ClassPathResource</code>,
    <code class="literal">FileSystemResource</code>, or
    <code class="classname">ServletContextResource</code> (as appropriate)
    depending on the exact type of the context.</p><p>If there is a need to force a specific
    <code class="interfacename">Resource</code> type to be used, then a prefix may
    be used. The following two examples show how to force a
    <code class="classname">ClassPathResource</code> and a
    <code class="classname">UrlResource</code> (the latter being used to access a
    filesystem file).</p><pre class="programlisting">&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"template"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"classpath:some/resource/path/myTemplate.txt"</span>&gt;</pre><pre class="programlisting">&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"template"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"file:/some/resource/path/myTemplate.txt"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-app-ctx"></a>5.7&nbsp;Application contexts and <code class="interfacename">Resource</code> paths</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-app-ctx-construction"></a>5.7.1&nbsp;Constructing application contexts</h3></div></div></div><p>An application context constructor (for a specific application
      context type) generally takes a string or array of strings as the
      location path(s) of the resource(s) such as XML files that make up the
      definition of the context.</p><p>When such a location path doesn't have a prefix, the specific
      <code class="interfacename">Resource</code> type built from that path and
      used to load the bean definitions, depends on and is appropriate to the
      specific application context. For example, if you create a
      <code class="classname">ClassPathXmlApplicationContext</code> as follows:</p><pre class="programlisting">ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"conf/appContext.xml"</span>);</pre><p>The bean definitions will be loaded from the classpath, as a
      <code class="classname"></code><code class="classname">ClassPathResource</code> will be
      used. But if you create a
      <code class="classname">FileSystemXmlApplicationContext</code> as
      follows:</p><pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">"conf/appContext.xml"</span>);</pre><p>The bean definition will be loaded from a filesystem location, in
      this case relative to the current working directory.</p><p>Note that the use of the special classpath prefix or a standard
      URL prefix on the location path will override the default type of
      <code class="interfacename">Resource</code> created to load the definition.
      So this <code class="classname">FileSystemXmlApplicationContext</code>...</p><pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">"classpath:conf/appContext.xml"</span>);</pre><p>... will actually load its bean definitions from the classpath.
      However, it is still a <code class="classname">FileSystemXmlApplicationContext</code>. If it is
      subsequently used as a <code class="interfacename">ResourceLoader</code>,
      any unprefixed paths will still be treated as filesystem paths.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="resources-app-ctx-classpathxml"></a>5.7.1.1&nbsp;Constructing <code class="classname">ClassPathXmlApplicationContext</code> instances - shortcuts</h4></div></div></div><p>The <code class="classname">ClassPathXmlApplicationContext</code>
        exposes a number of constructors to enable convenient instantiation.
        The basic idea is that one supplies merely a string array containing
        just the filenames of the XML files themselves (without the leading
        path information), and one <span class="emphasis"><em>also</em></span> supplies a
        <code class="classname">Class</code>; the
        <code class="classname">ClassPathXmlApplicationContext</code> will derive the
        path information from the supplied class.</p><p>An example will hopefully make this clear. Consider a directory
        layout that looks like this:</p><pre class="programlisting">com/
  foo/
    services.xml
    daos.xml
    MessengerService.class</pre><p>A <code class="classname">ClassPathXmlApplicationContext</code> instance
        composed of the beans defined in the <code class="literal">'services.xml'</code>
        and <code class="literal">'daos.xml'</code> could be instantiated like
        so...</p><pre class="programlisting">ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(
    <span class="hl-keyword">new</span> String[] {<span class="hl-string">"services.xml"</span>, <span class="hl-string">"daos.xml"</span>}, MessengerService.<span class="hl-keyword">class</span>);</pre><p>Please do consult the Javadocs for the
        <code class="classname">ClassPathXmlApplicationContext</code> class for
        details of the various constructors.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-app-ctx-wildcards-in-resource-paths"></a>5.7.2&nbsp;Wildcards in application context constructor resource paths</h3></div></div></div><p>The resource paths in application context constructor values may
      be a simple path (as shown above) which has a one-to-one mapping to a
      target Resource, or alternately may contain the special "classpath*:"
      prefix and/or internal Ant-style regular expressions (matched using
      Spring's <code class="classname">PathMatcher</code> utility). Both of the latter
      are effectively wildcards</p><p>One use for this mechanism is when doing component-style
      application assembly. All components can 'publish' context definition
      fragments to a well-known location path, and when the final application
      context is created using the same path prefixed via
      <code class="literal">classpath*:</code>, all component fragments will be picked
      up automatically.</p><p>Note that this wildcarding is specific to use of resource paths in
      application context constructors (or when using the
      <code class="classname">PathMatcher</code> utility class hierarchy directly),
      and is resolved at construction time. It has nothing to do with the
      <code class="interfacename">Resource</code> type itself. It's not possible
      to use the <code class="literal">classpath*:</code> prefix to construct an actual
      <code class="interfacename">Resource</code>, as a resource points to just
      one resource at a time.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="resources-app-ctx-ant-patterns-in-paths"></a>5.7.2.1&nbsp;Ant-style Patterns</h4></div></div></div><p>When the path location contains an Ant-style pattern, for example:</p><pre class="programlisting">     /WEB-INF/*-context.xml
     com/mycompany/**/applicationContext.xml
     file:C:/some/path/*-context.xml
     classpath:com/mycompany/**/applicationContext.xml</pre><p>... the resolver follows a more complex but defined procedure to
        try to resolve the wildcard. It produces a Resource for the path up to
        the last non-wildcard segment and obtains a URL from it. If this URL
        is not a "jar:" URL or container-specific variant (e.g.
        "<code class="literal">zip:</code>" in WebLogic, "<code class="literal">wsjar</code>" in
        WebSphere, etc.), then a <code class="classname">java.io.File</code> is
        obtained from it and used to resolve the wildcard by traversing the
        filesystem. In the case of a jar URL, the resolver either gets a
        <code class="classname">java.net.JarURLConnection</code> from it or manually
        parses the jar URL and then traverses the contents of the jar file
        to resolve the wildcards.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="resources-app-ctx-portability"></a>Implications on portability</h5></div></div></div><p>If the specified path is already a file URL (either
          explicitly, or implicitly because the base
		  <code class="interfacename">ResourceLoader</code> is a
          filesystem one, then wildcarding is guaranteed to work in a
          completely portable fashion.</p><p>If the specified path is a classpath location, then the
          resolver must obtain the last non-wildcard path segment URL via a
          <code class="methodname">Classloader.getResource()</code> call. Since this
          is just a node of the path (not the file at the end) it is actually
          undefined (in the <code class="classname">ClassLoader</code> Javadocs)
          exactly what sort of a URL is returned in this case. In practice, it
          is always a <code class="classname">java.io.File</code> representing the
          directory, where the classpath resource resolves to a filesystem
          location, or a jar URL of some sort, where the classpath resource
          resolves to a jar location. Still, there is a portability concern on
          this operation.</p><p>If a jar URL is obtained for the last non-wildcard segment,
          the resolver must be able to get a
          <code class="classname">java.net.JarURLConnection</code> from it, or
          manually parse the jar URL, to be able to walk the contents of the
          jar, and resolve the wildcard. This will work in most environments,
          but will fail in others, and it is strongly recommended that the
          wildcard resolution of resources coming from jars be thoroughly
          tested in your specific environment before you rely on it.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="resources-classpath-wildcards"></a>5.7.2.2&nbsp;The <code class="literal">classpath*:</code> prefix</h4></div></div></div><p>When constructing an XML-based application context, a location
        string may use the special <code class="literal">classpath*:</code>
        prefix:</p><pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"classpath*:conf/appContext.xml"</span>);</pre><p>This special prefix specifies that all classpath resources that
        match the given name must be obtained (internally, this essentially
        happens via a <code class="methodname">ClassLoader.getResources(...)</code>
        call), and then merged to form the final application context
        definition.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Classpath*: portability"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Classpath*: portability</th></tr><tr><td align="left" valign="top"><p>The wildcard classpath relies on the <code class="literal">getResources()</code> method of the
          underlying classloader. As most application servers nowadays supply
          their own classloader implementation, the behavior might differ
          especially when dealing with jar files. A simple test to check if
          <code class="literal">classpath*</code> works is to use the classloader to load a file from
          within a jar on the classpath:
          <code class="literal">getClass().getClassLoader().getResources("&lt;someFileInsideTheJar&gt;")</code>.
          Try this test with files that have the same name but are placed
          inside two different locations. In case an inappropriate result is
          returned, check the application server documentation for settings
          that might affect the classloader behavior.</p></td></tr></table></div><p>The "<code class="literal">classpath*:</code>" prefix can also be combined
        with a <code class="literal">PathMatcher</code> pattern in the rest of the location path, for
        example "<code class="literal">classpath*:META-INF/*-beans.xml</code>". In this
        case, the resolution strategy is fairly simple: a
        ClassLoader.getResources() call is used on the last non-wildcard path
        segment to get all the matching resources in the class loader
        hierarchy, and then off each resource the same PathMatcher resoltion
        strategy described above is used for the wildcard subpath.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="resources-wildcards-in-path-other-stuff"></a>5.7.2.3&nbsp;Other notes relating to wildcards</h4></div></div></div><p>Please note that "<code class="literal">classpath*:</code>" when
        combined with Ant-style patterns will only work reliably with at least
        one root directory before the pattern starts, unless the actual target
        files reside in the file system. This means that a pattern like
        "<code class="literal">classpath*:*.xml</code>" will not retrieve files from the
        root of jar files but rather only from the root of expanded
        directories. This originates from a limitation in the JDK's
        <code class="methodname">ClassLoader.getResources()</code> method which only
        returns file system locations for a passed-in empty string (indicating
        potential roots to search).</p><p>Ant-style patterns with "<code class="literal">classpath:</code>"
		resources are not guaranteed to find matching resources if the root
		package to search is available in multiple class path locations. This
		is because a resource such as</p><pre class="programlisting">    com/mycompany/package1/service-context.xml</pre><p>may be in only one location, but when a path such as</p><pre class="programlisting">    classpath:com/mycompany/**/service-context.xml</pre><p>is used to try to resolve it, the resolver will work off the (first) URL
        returned by <code class="methodname">getResource("com/mycompany")</code>;. If
        this base package node exists in multiple classloader locations, the
        actual end resource may not be underneath. Therefore, preferably, use
        "<code class="literal">classpath*:</code>" with the same Ant-style pattern in
        such a case, which will search all class path locations that contain
        the root package.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="resources-filesystemresource-caveats"></a>5.7.3&nbsp;<code class="classname">FileSystemResource</code> caveats</h3></div></div></div><p>A <code class="classname">FileSystemResource</code> that is not attached
      to a <code class="classname">FileSystemApplicationContext</code> (that is, a
      <code class="classname">FileSystemApplicationContext</code> is not the actual
      <code class="interfacename">ResourceLoader</code>) will treat absolute vs.
      relative paths as you would expect. Relative paths are relative to the
      current working directory, while absolute paths are relative to the root
      of the filesystem.</p><p>For backwards compatibility (historical) reasons however, this
      changes when the <code class="classname">FileSystemApplicationContext</code> is
      the <code class="literal">ResourceLoader</code>. The
      <code class="classname">FileSystemApplicationContext</code> simply forces all
      attached <code class="classname">FileSystemResource</code> instances to treat
      all location paths as relative, whether they start with a leading slash
      or not. In practice, this means the following are equivalent:</p><pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">"conf/context.xml"</span>);</pre><pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">"/conf/context.xml"</span>);</pre><p>As are the following: (Even though it would make sense for them to
      be different, as one case is relative and the other absolute.)</p><pre class="programlisting">FileSystemXmlApplicationContext ctx = ...;
ctx.getResource(<span class="hl-string">"some/resource/path/myTemplate.txt"</span>);</pre><pre class="programlisting">FileSystemXmlApplicationContext ctx = ...;
ctx.getResource(<span class="hl-string">"/some/resource/path/myTemplate.txt"</span>);</pre><p>In practice, if true absolute filesystem paths are needed, it is
      better to forgo the use of absolute paths with
      <code class="classname">FileSystemResource</code> /
      <code class="classname">FileSystemXmlApplicationContext</code>, and just force
      the use of a <code class="classname">UrlResource</code>, by using the
      <code class="literal">file:</code> URL prefix.</p><pre class="programlisting"><span class="hl-comment">// actual context type doesn't matter, the Resource will always be UrlResource</span>
ctx.getResource(<span class="hl-string">"file:/some/resource/path/myTemplate.txt"</span>);</pre><pre class="programlisting"><span class="hl-comment">// force this FileSystemXmlApplicationContext to load its definition via a UrlResource</span>
ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">"file:/conf/context.xml"</span>);</pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="validation"></a>6.&nbsp;Validation, Data Binding, and Type Conversion</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-introduction"></a>6.1&nbsp;Introduction</h2></div></div></div><p>There are pros and cons for considering validation as business logic,
      and Spring offers a design for validation (and data binding) that does not
      exclude either one of them. Specifically validation should not be tied to
      the web tier, should be easy to localize and it should be possible to plug
      in any validator available. Considering the above, Spring has come up with
      a <code class="interfacename">Validator</code> interface that is both basic
      ands eminently usable in every layer of an application. </p><p>Data binding is useful for allowing user input to be dynamically bound
      to the domain model of an application (or whatever objects you use to
      process user input). Spring provides the so-called
      <code class="interfacename">DataBinder</code> to do exactly that. The
      <code class="interfacename">Validator</code> and the
      <code class="interfacename">DataBinder</code> make up the
      <code class="literal">validation</code> package, which is primarily used in but not
      limited to the MVC framework. </p><p>The <code class="interfacename">BeanWrapper</code> is a fundamental
      concept in the Spring Framework and is used in a lot of places. However,
      you probably will not have the need to use the
      <code class="interfacename">BeanWrapper</code> directly. Because this is
      reference documentation however, we felt that some explanation might be in
      order. We will explain the <code class="interfacename">BeanWrapper</code> in
      this chapter since, if you were going to use it at all, you would most
      likely do so when trying to bind data to objects.</p><p>Spring's DataBinder and the lower-level BeanWrapper both use
      PropertyEditors to parse and format property values. The
      <code class="interfacename">PropertyEditor</code> concept is part of the
      JavaBeans specification, and is also explained in this chapter. Spring 3
      introduces a "core.convert" package that provides a general type
      conversion facility, as well as a higher-level "format" package for
      formatting UI field values. These new packages may be used as simpler
      alternatives to PropertyEditors, and will also be discussed in this
      chapter.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validator"></a>6.2&nbsp;Validation using Spring's <code class="interfacename">Validator</code>
      interface</h2></div></div></div><p>Spring features a <code class="interfacename">Validator</code> interface
      that you can use to validate objects. The
      <code class="interfacename">Validator</code> interface works using an
      <code class="interfacename">Errors</code> object so that while validating,
      validators can report validation failures to the
      <code class="interfacename">Errors</code> object.</p><p>Let's consider a small data object:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Person {

  <span class="hl-keyword">private</span> String name;
  <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;

  <span class="hl-comment">// the usual getters and setters...</span>
}</pre><p>We're going to provide validation behavior for the
      <code class="classname">Person</code> class by implementing the following two
      methods of the
      <code class="interfacename">org.springframework.validation.Validator</code>
      interface: </p><div class="itemizedlist"><ul type="disc" compact><li><p><code class="methodname">supports(Class)</code> - Can this
          <code class="interfacename">Validator</code> validate instances of the
          supplied <code class="classname">Class</code>?</p></li><li><p><code class="methodname">validate(Object,
          org.springframework.validation.Errors)</code> - validates the
          given object and in case of validation errors, registers those with
          the given <code class="interfacename">Errors</code> object</p></li></ul></div><p> </p><p> Implementing a <code class="interfacename">Validator</code> is fairly
      straightforward, especially when you know of the
      <code class="classname">ValidationUtils</code> helper class that the Spring
      Framework also provides.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PersonValidator <span class="hl-keyword">implements</span> Validator {

    <span class="hl-comment">/**
    * This Validator validates just Person instances
    */</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> supports(Class clazz) {
        <span class="hl-keyword">return</span> Person.<span class="hl-keyword">class</span>.equals(clazz);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validate(Object obj, Errors e) {
        ValidationUtils.rejectIfEmpty(e, <span class="hl-string">"name"</span>, <span class="hl-string">"name.empty"</span>);
        Person p = (Person) obj;
        <span class="hl-keyword">if</span> (p.getAge() &lt; 0) {
            e.rejectValue(<span class="hl-string">"age"</span>, <span class="hl-string">"negativevalue"</span>);
        } <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (p.getAge() &gt; 110) {
            e.rejectValue(<span class="hl-string">"age"</span>, <span class="hl-string">"too.darn.old"</span>);
        }
    }
}</pre><p>As you can see, the <code class="literal">static</code>
      <code class="methodname">rejectIfEmpty(..)</code> method on the
      <code class="classname">ValidationUtils</code> class is used to reject the
      <code class="literal">'name'</code> property if it is <code class="literal">null</code> or the
      empty string. Have a look at the Javadoc for the
      <code class="classname">ValidationUtils</code> class to see what functionality it
      provides besides the example shown previously.</p><p>While it is certainly possible to implement a single
      <code class="interfacename">Validator</code> class to validate each of the
      nested objects in a rich object, it may be better to encapsulate the
      validation logic for each nested class of object in its own
      <code class="interfacename">Validator</code> implementation. A simple example
      of a <span class="emphasis"><em>'rich'</em></span> object would be a
      <code class="classname">Customer</code> that is composed of two
      <code class="classname">String</code> properties (a first and second name) and a
      complex <code class="classname">Address</code> object.
      <code class="classname">Address</code> objects may be used independently of
      <code class="classname">Customer</code> objects, and so a distinct
      <code class="classname">AddressValidator</code> has been implemented. If you want
      your <code class="classname">CustomerValidator</code> to reuse the logic contained
      within the <code class="classname">AddressValidator</code> class without resorting
      to copy-and-paste, you can dependency-inject or instantiate an
      <code class="classname">AddressValidator</code> within your
      <code class="classname">CustomerValidator</code>, and use it like so:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomerValidator <span class="hl-keyword">implements</span> Validator {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> Validator addressValidator;

    <span class="hl-keyword">public</span> CustomerValidator(Validator addressValidator) {
        <span class="hl-keyword">if</span> (addressValidator == null) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> IllegalArgumentException(
              <span class="hl-string">"The supplied [Validator] is required and must not be null."</span>);
        }
        <span class="hl-keyword">if</span> (!addressValidator.supports(Address.<span class="hl-keyword">class</span>)) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> IllegalArgumentException(
              <span class="hl-string">"The supplied [Validator] must support the validation of [Address] instances."</span>);
        }
        <span class="hl-keyword">this</span>.addressValidator = addressValidator;
    }

    <span class="hl-comment">/**
    * This Validator validates Customer instances, and any subclasses of Customer too
    */</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> supports(Class clazz) {
        <span class="hl-keyword">return</span> Customer.<span class="hl-keyword">class</span>.isAssignableFrom(clazz);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validate(Object target, Errors errors) {
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="hl-string">"firstName"</span>, <span class="hl-string">"field.required"</span>);
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="hl-string">"surname"</span>, <span class="hl-string">"field.required"</span>);
        Customer customer = (Customer) target;
        <span class="hl-keyword">try</span> {
            errors.pushNestedPath(<span class="hl-string">"address"</span>);
            ValidationUtils.invokeValidator(<span class="hl-keyword">this</span>.addressValidator, customer.getAddress(), errors);
        } <span class="hl-keyword">finally</span> {
            errors.popNestedPath();
        }
    }
}</pre><p>Validation errors are reported to the
      <code class="interfacename">Errors</code> object passed to the validator. In
      case of Spring Web MVC you can use <code class="literal">&lt;spring:bind/&gt;</code>
      tag to inspect the error messages, but of course you can also inspect the
      errors object yourself. More information about the methods it offers can
      be found from the Javadoc.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-conversion"></a>6.3&nbsp;Resolving codes to error messages</h2></div></div></div><p>We've talked about databinding and validation. Outputting messages
      corresponding to validation errors is the last thing we need to discuss.
      In the example we've shown above, we rejected the <code class="literal">name</code>
      and the <code class="literal">age</code> field. If we're going to output the error
      messages by using a <code class="interfacename">MessageSource</code>, we will
      do so using the error code we've given when rejecting the field ('name'
      and 'age' in this case). When you call (either directly, or indirectly,
      using for example the <code class="classname">ValidationUtils</code> class)
      <code class="literal">rejectValue</code> or one of the other
      <code class="literal">reject</code> methods from the
      <code class="interfacename">Errors</code> interface, the underlying
      implementation will not only register the code you've passed in, but also
      a number of additional error codes. What error codes it registers is
      determined by the <code class="interfacename">MessageCodesResolver</code> that
      is used. By default, the
      <code class="classname">DefaultMessageCodesResolver</code> is used, which for
      example not only registers a message with the code you gave, but also
      messages that include the field name you passed to the reject method. So
      in case you reject a field using <code class="literal">rejectValue("age",
      "too.darn.old")</code>, apart from the <code class="literal">too.darn.old</code>
      code, Spring will also register <code class="literal">too.darn.old.age</code> and
      <code class="literal">too.darn.old.age.int</code> (so the first will include the
      field name and the second will include the type of the field); this is
      done as a convenience to aid developers in targeting error messages and
      suchlike.</p><p>More information on the
      <code class="interfacename">MessageCodesResolver</code> and the default
      strategy can be found online with the Javadocs for <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/validation/MessageCodesResolver.html" target="_top">MessageCodesResolver</a> and <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/validation/DefaultMessageCodesResolver.html" target="_top">DefaultMessageCodesResolver</a> respectively.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-beans"></a>6.4&nbsp;Bean manipulation and the
      <code class="interfacename">BeanWrapper</code></h2></div></div></div><p>The <code class="literal">org.springframework.beans</code> package adheres to
      the JavaBeans standard provided by Sun. A JavaBean is simply a class with
      a default no-argument constructor, which follows a naming convention where
      (by way of an example) a property named <code class="literal">bingoMadness</code>
      would have a setter method <code class="methodname">setBingoMadness(..)</code>
      and a getter method <code class="methodname">getBingoMadness()</code>. For more
      information about JavaBeans and the specification, please refer to Sun's
      website ( <a class="ulink" href="http://java.sun.com/products/javabeans/" target="_top">java.sun.com/products/javabeans</a>).</p><p>One quite important class in the beans package is the
      <code class="interfacename">BeanWrapper</code> interface and its corresponding
      implementation (<code class="classname">BeanWrapperImpl</code>). As quoted from
      the Javadoc, the <code class="interfacename">BeanWrapper</code> offers
      functionality to set and get property values (individually or in bulk),
      get property descriptors, and to query properties to determine if they are
      readable or writable. Also, the <code class="interfacename">BeanWrapper</code>
      offers support for nested properties, enabling the setting of properties
      on sub-properties to an unlimited depth. Then, the
      <code class="interfacename">BeanWrapper</code> supports the ability to add
      standard JavaBeans <code class="interfacename">PropertyChangeListeners</code>
      and <code class="interfacename">VetoableChangeListeners</code>, without the
      need for supporting code in the target class. Last but not least, the
      <code class="interfacename">BeanWrapper</code> provides support for the
      setting of indexed properties. The
      <code class="interfacename">BeanWrapper</code> usually isn't used by
      application code directly, but by the
      <code class="interfacename">DataBinder</code> and the
      <code class="interfacename">BeanFactory</code>.</p><p>The way the <code class="interfacename">BeanWrapper</code> works is partly
      indicated by its name: <span class="emphasis"><em>it wraps a bean</em></span> to perform
      actions on that bean, like setting and retrieving properties.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-beans-conventions"></a>6.4.1&nbsp;Setting and getting basic and nested properties</h3></div></div></div><p>Setting and getting properties is done using the
        <code class="literal">setPropertyValue(s)</code> and
        <code class="literal">getPropertyValue(s)</code> methods that both come with a
        couple of overloaded variants. They're all described in more detail in
        the Javadoc Spring comes with. What's important to know is that there
        are a couple of conventions for indicating properties of an object. A
        couple of examples:</p><div class="table"><a name="beans-beans-conventions-properties-tbl"></a><p class="title"><b>Table&nbsp;6.1.&nbsp;Examples of properties</b></p><div class="table-contents"><table summary="Examples of properties" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Expression</th><th style="border-bottom: 1.0pt solid ; ">Explanation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">name</code></td><td style="border-bottom: 1.0pt solid ; ">Indicates the property <code class="literal">name</code>
                corresponding to the methods <code class="methodname">getName()</code>
                or <code class="methodname">isName()</code> and
                <code class="methodname">setName(..)</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">account.name</code></td><td style="border-bottom: 1.0pt solid ; ">Indicates the nested property <code class="literal">name</code> of
                the property <code class="literal">account</code> corresponding e.g. to
                the methods <code class="literal">getAccount().setName()</code> or
                <code class="literal">getAccount().getName()</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">account[2]</code></td><td style="border-bottom: 1.0pt solid ; ">Indicates the <span class="emphasis"><em>third</em></span> element of the
                indexed property <code class="literal">account</code>. Indexed properties
                can be of type <code class="literal">array</code>, <code class="literal">list</code>
                or other <span class="emphasis"><em>naturally ordered</em></span>
                collection</td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="literal">account[COMPANYNAME]</code></td><td style="">Indicates the value of the map entry indexed by the key
                <span class="emphasis"><em>COMPANYNAME</em></span> of the Map property
                <code class="literal">account</code></td></tr></tbody></table></div></div><br class="table-break"><p>Below you'll find some examples of working with the
        <code class="interfacename">BeanWrapper</code> to get and set
        properties.</p><p><span class="emphasis"><em>(This next section is not vitally important to you if
        you're not planning to work with the
        <code class="interfacename">BeanWrapper</code> directly. If you're just
        using the <code class="interfacename">DataBinder</code> and the
        <code class="interfacename">BeanFactory</code> and their out-of-the-box
        implementation, you should skip ahead to the section about
        <code class="interfacename">PropertyEditors</code>.)</em></span></p><p>Consider the following two classes:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Company {
    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> Employee managingDirector;

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.name;
    }
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }
    <span class="hl-keyword">public</span> Employee getManagingDirector() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.managingDirector;
    }
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setManagingDirector(Employee managingDirector) {
        <span class="hl-keyword">this</span>.managingDirector = managingDirector;
    }
}</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Employee {
    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> <span class="hl-keyword">float</span> salary;

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.name;
    }
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }
    <span class="hl-keyword">public</span> <span class="hl-keyword">float</span> getSalary() {
        <span class="hl-keyword">return</span> salary;
    }
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSalary(<span class="hl-keyword">float</span> salary) {
        <span class="hl-keyword">this</span>.salary = salary;
    }
}</pre><p>The following code snippets show some examples of how to retrieve
        and manipulate some of the properties of instantiated
        <code class="literal">Companies</code> and <code class="literal">Employees</code>:</p><pre class="programlisting">BeanWrapper company = BeanWrapperImpl(<span class="hl-keyword">new</span> Company());
<span class="hl-comment">// setting the company name..</span>
company.setPropertyValue(<span class="hl-string">"name"</span>, <span class="hl-string">"Some Company Inc."</span>);
<span class="hl-comment">// ... can also be done like this:</span>
PropertyValue value = <span class="hl-keyword">new</span> PropertyValue(<span class="hl-string">"name"</span>, <span class="hl-string">"Some Company Inc."</span>);
company.setPropertyValue(value);

<span class="hl-comment">// ok, let's create the director and tie it to the company:</span>
BeanWrapper jim = BeanWrapperImpl(<span class="hl-keyword">new</span> Employee());
jim.setPropertyValue(<span class="hl-string">"name"</span>, <span class="hl-string">"Jim Stravinsky"</span>);
company.setPropertyValue(<span class="hl-string">"managingDirector"</span>, jim.getWrappedInstance());

<span class="hl-comment">// retrieving the salary of the managingDirector through the company</span>
Float salary = (Float) company.getPropertyValue(<span class="hl-string">"managingDirector.salary"</span>);</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="beans-beans-conversion"></a>6.4.2&nbsp;Built-in <span class="interface">PropertyEditor</span>
        implementations</h3></div></div></div><p>Spring uses the concept of <code class="literal">PropertyEditors</code> to
        effect the conversion between an <code class="classname">Object</code> and a
        <code class="classname">String</code>. If you think about it, it sometimes might
        be handy to be able to represent properties in a different way than the
        object itself. For example, a <code class="classname">Date</code> can be
        represented in a human readable way (as the
        <code class="classname">String</code> '<code class="literal">2007-14-09</code>'), while
        we're still able to convert the human readable form back to the original
        date (or even better: convert any date entered in a human readable form,
        back to <code class="classname">Date</code> objects). This behavior can be
        achieved by <span class="emphasis"><em>registering custom editors</em></span>, of type
        <code class="interfacename">java.beans.PropertyEditor</code>. Registering
        custom editors on a <code class="interfacename">BeanWrapper</code> or
        alternately in a specific IoC container as mentioned in the previous
        chapter, gives it the knowledge of how to convert properties to the
        desired type. Read more about
        <code class="interfacename">PropertyEditors</code> in the Javadoc of the
        <code class="literal">java.beans</code> package provided by Sun.</p><p>A couple of examples where property editing is used in Spring:
        </p><div class="itemizedlist"><ul type="disc" compact><li><p><span class="emphasis"><em>setting properties on beans</em></span> is done using
            <code class="literal">PropertyEditors</code>. When mentioning
            <code class="literal">java.lang.String</code> as the value of a property of
            some bean you're declaring in XML file, Spring will (if the setter
            of the corresponding property has a
            <code class="classname">Class</code>-parameter) use the
            <code class="classname">ClassEditor</code> to try to resolve the parameter
            to a <code class="classname">Class</code> object.</p></li><li><p><span class="emphasis"><em>parsing HTTP request parameters</em></span> in Spring's
            MVC framework is done using all kinds of
            <code class="literal">PropertyEditors</code> that you can manually bind in all
            subclasses of the <code class="classname">CommandController</code>.</p></li></ul></div><p> </p><p>Spring has a number of built-in <code class="literal">PropertyEditors</code>
        to make life easy. Each of those is listed below and they are all
        located in the
        <code class="literal">org.springframework.beans.propertyeditors</code> package.
        Most, but not all (as indicated below), are registered by default by
        <code class="classname">BeanWrapperImpl</code>. Where the property editor is
        configurable in some fashion, you can of course still register your own
        variant to override the default one:</p><div class="table"><a name="beans-beans-property-editors-tbl"></a><p class="title"><b>Table&nbsp;6.2.&nbsp;Built-in <code class="literal">PropertyEditors</code></b></p><div class="table-contents"><table summary="Built-in PropertyEditors" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Class</th><th style="border-bottom: 1.0pt solid ; ">Explanation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">ByteArrayPropertyEditor</code></td><td style="border-bottom: 1.0pt solid ; ">Editor for byte arrays. Strings will simply be converted to
                their corresponding byte representations. Registered by default
                by <code class="classname">BeanWrapperImpl</code>.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">ClassEditor</code></td><td style="border-bottom: 1.0pt solid ; ">Parses Strings representing classes to actual classes and
                the other way around. When a class is not found, an
                <code class="classname">IllegalArgumentException</code> is thrown.
                Registered by default by
                <code class="classname">BeanWrapperImpl</code>.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">CustomBooleanEditor</code></td><td style="border-bottom: 1.0pt solid ; ">Customizable property editor for
                <code class="classname">Boolean</code> properties. Registered by default
                by <code class="classname">BeanWrapperImpl</code>, but, can be
                overridden by registering custom instance of it as custom
                editor.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">CustomCollectionEditor</code></td><td style="border-bottom: 1.0pt solid ; ">Property editor for Collections, converting any source
                <code class="interfacename">Collection</code> to a given target
                <code class="interfacename">Collection</code> type.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">CustomDateEditor</code></td><td style="border-bottom: 1.0pt solid ; ">Customizable property editor for java.util.Date, supporting
                a custom DateFormat. NOT registered by default. Must be user
                registered as needed with appropriate format.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">CustomNumberEditor</code></td><td style="border-bottom: 1.0pt solid ; ">Customizable property editor for any Number subclass like
                <code class="classname">Integer</code>, <code class="classname">Long</code>,
                <code class="classname">Float</code>, <code class="classname">Double</code>.
                Registered by default by <code class="classname">BeanWrapperImpl</code>,
                but can be overridden by registering custom instance of it as a
                custom editor.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">FileEditor</code></td><td style="border-bottom: 1.0pt solid ; ">Capable of resolving Strings to
                <code class="classname">java.io.File</code> objects. Registered by
                default by <code class="classname">BeanWrapperImpl</code>. </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">InputStreamEditor</code></td><td style="border-bottom: 1.0pt solid ; ">One-way property editor, capable of taking a text string
                and producing (via an intermediate
                <code class="classname">ResourceEditor</code> and
                <code class="interfacename">Resource</code>) an
                <code class="interfacename">InputStream</code>, so
                <code class="interfacename">InputStream</code> properties may be
                directly set as Strings. Note that the default usage will not
                close the <code class="interfacename">InputStream</code> for you!
                Registered by default by
                <code class="classname">BeanWrapperImpl</code>.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">LocaleEditor</code></td><td style="border-bottom: 1.0pt solid ; ">Capable of resolving Strings to
                <code class="classname">Locale</code> objects and vice versa (the String
                format is [language]_[country]_[variant], which is the same
                thing the toString() method of Locale provides). Registered by
                default by <code class="classname">BeanWrapperImpl</code>.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">PatternEditor</code></td><td style="border-bottom: 1.0pt solid ; ">Capable of resolving Strings to JDK 1.5
                <code class="classname">Pattern</code> objects and vice versa.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">PropertiesEditor</code></td><td style="border-bottom: 1.0pt solid ; ">Capable of converting Strings (formatted using the format
                as defined in the Javadoc for the java.lang.Properties class) to
                <code class="classname">Properties</code> objects. Registered by default
                by <code class="classname">BeanWrapperImpl</code>.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">StringTrimmerEditor</code></td><td style="border-bottom: 1.0pt solid ; ">Property editor that trims Strings. Optionally allows
                transforming an empty string into a <code class="literal">null</code>
                value. NOT registered by default; must be user registered as
                needed.</td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="classname">URLEditor</code></td><td style="">Capable of resolving a String representation of a URL to an
                actual <code class="classname">URL</code> object. Registered by default
                by <code class="classname">BeanWrapperImpl</code>.</td></tr></tbody></table></div></div><br class="table-break"><p> Spring uses the
        <code class="interfacename">java.beans.PropertyEditorManager</code> to set
        the search path for property editors that might be needed. The search
        path also includes <code class="literal">sun.bean.editors</code>, which includes
        <code class="interfacename">PropertyEditor</code> implementations for types
        such as <code class="classname">Font</code>, <code class="classname">Color</code>, and
        most of the primitive types. Note also that the standard JavaBeans
        infrastructure will automatically discover
        <code class="interfacename">PropertyEditor</code> classes (without you
        having to register them explicitly) if they are in the same package as
        the class they handle, and have the same name as that class, with
        <code class="literal">'Editor'</code> appended; for example, one could have the
        following class and package structure, which would be sufficient for the
        <code class="classname">FooEditor</code> class to be recognized and used as the
        <code class="interfacename">PropertyEditor</code> for
        <code class="classname">Foo</code>-typed properties. </p><pre class="programlisting">com
  chank
    pop
      Foo
      FooEditor   <em class="lineannotation"><span class="lineannotation">// the <code class="interfacename">PropertyEditor</code> for the <code class="classname">Foo</code> class</span></em></pre><p>Note that you can also use the standard
        <code class="interfacename">BeanInfo</code> JavaBeans mechanism here as well
        (described <a class="ulink" href="http://java.sun.com/docs/books/tutorial/javabeans/customization/index.html" target="_top">in not-amazing-detail here</a>). Find below an example of using the
        <code class="interfacename">BeanInfo</code> mechanism for explicitly
        registering one or more <code class="interfacename">PropertyEditor</code>
        instances with the properties of an associated class.</p><pre class="programlisting">com
  chank
    pop
      Foo
      FooBeanInfo   <em class="lineannotation"><span class="lineannotation">// the <code class="interfacename">BeanInfo</code> for the <code class="classname">Foo</code> class</span></em></pre><p> Here is the Java source code for the referenced
        <code class="classname">FooBeanInfo</code> class. This would associate a
        <code class="classname">CustomNumberEditor</code> with the
        <code class="literal">age</code> property of the <code class="classname">Foo</code> class. </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FooBeanInfo <span class="hl-keyword">extends</span> SimpleBeanInfo {

    <span class="hl-keyword">public</span> PropertyDescriptor[] getPropertyDescriptors() {
        <span class="hl-keyword">try</span> {
            <span class="hl-keyword">final</span> PropertyEditor numberPE = <span class="hl-keyword">new</span> CustomNumberEditor(Integer.<span class="hl-keyword">class</span>, true);
            PropertyDescriptor ageDescriptor = <span class="hl-keyword">new</span> PropertyDescriptor(<span class="hl-string">"age"</span>, Foo.<span class="hl-keyword">class</span>) {
                <span class="hl-keyword">public</span> PropertyEditor createPropertyEditor(Object bean) {
                    <span class="hl-keyword">return</span> numberPE;
                };
            };
            <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> PropertyDescriptor[] { ageDescriptor };
        }
        <span class="hl-keyword">catch</span> (IntrospectionException ex) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> Error(ex.toString());
        }
    }
}</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="beans-beans-conversion-customeditor-registration"></a>6.4.2.1&nbsp;Registering additional custom
          <code class="interfacename">PropertyEditors</code></h4></div></div></div><p>When setting bean properties as a string value, a Spring IoC
          container ultimately uses standard JavaBeans
          <code class="literal">PropertyEditors</code> to convert these Strings to the
          complex type of the property. Spring pre-registers a number of custom
          <code class="literal">PropertyEditors</code> (for example, to convert a
          classname expressed as a string into a real
          <code class="classname">Class</code> object). Additionally, Java's standard
          JavaBeans <code class="interfacename">PropertyEditor</code> lookup
          mechanism allows a <code class="classname">PropertyEditor</code> for a class
          simply to be named appropriately and placed in the same package as the
          class it provides support for, to be found automatically.</p><p>If there is a need to register other custom
          <code class="literal">PropertyEditors</code>, there are several mechanisms
          available. The most manual approach, which is not normally convenient
          or recommended, is to simply use the
          <code class="methodname">registerCustomEditor()</code> method of the
          <code class="interfacename">ConfigurableBeanFactory</code> interface,
          assuming you have a <code class="interfacename">BeanFactory</code>
          reference. Another, slightly more convenient, mechanism is to use a
          special bean factory post-processor called
          <code class="classname">CustomEditorConfigurer</code>. Although bean factory
          post-processors can be used with
          <code class="interfacename">BeanFactory</code> implementations, the
          <code class="classname">CustomEditorConfigurer</code> has a nested property
          setup, so it is strongly recommended that it is used with the
          <code class="interfacename">ApplicationContext</code>, where it may be
          deployed in similar fashion to any other bean, and automatically
          detected and applied.</p><p>Note that all bean factories and application contexts
          automatically use a number of built-in property editors, through their
          use of something called a <code class="interfacename">BeanWrapper</code>
          to handle property conversions. The standard property editors that the
          <code class="interfacename">BeanWrapper</code> registers are listed in
          <a class="link" href="#beans-beans-conversion" title="6.4.2&nbsp;Built-in PropertyEditor implementations">the previous section</a>.
          Additionally, <code class="literal">ApplicationContexts</code> also override or
          add an additional number of editors to handle resource lookups in a
          manner appropriate to the specific application context type.</p><p>Standard JavaBeans <code class="interfacename">PropertyEditor</code>
          instances are used to convert property values expressed as strings to
          the actual complex type of the property.
          <code class="classname">CustomEditorConfigurer</code>, a bean factory
          post-processor, may be used to conveniently add support for additional
          <code class="interfacename">PropertyEditor</code> instances to an
          <code class="interfacename">ApplicationContext</code>.</p><p>Consider a user class <code class="classname">ExoticType</code>, and
          another class <code class="classname">DependsOnExoticType</code> which needs
          <code class="classname">ExoticType</code> set as a property:</p><pre class="programlisting"><span class="hl-keyword">package</span> example;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExoticType {

    <span class="hl-keyword">private</span> String name;

    <span class="hl-keyword">public</span> ExoticType(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DependsOnExoticType {

    <span class="hl-keyword">private</span> ExoticType type;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setType(ExoticType type) {
        <span class="hl-keyword">this</span>.type = type;
    }
}</pre><p>When things are properly set up, we want to be able to assign the
          type property as a string, which a
          <code class="interfacename">PropertyEditor</code> will behind the scenes
          convert into an actual <code class="classname">ExoticType</code>
          instance:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sample"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.DependsOnExoticType"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"type"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"aNameForExoticType"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The <code class="interfacename">PropertyEditor</code> implementation
          could look similar to this:</p><pre class="programlisting"><span class="hl-comment">// converts string representation to ExoticType object</span>
<span class="hl-keyword">package</span> example;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExoticTypeEditor <span class="hl-keyword">extends</span> PropertyEditorSupport {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAsText(String text) {
        setValue(<span class="hl-keyword">new</span> ExoticType(text.toUpperCase()));
    }
}</pre><p>Finally, we use <code class="classname">CustomEditorConfigurer</code> to
          register the new <code class="interfacename">PropertyEditor</code> with
          the <code class="interfacename">ApplicationContext</code>, which will then
          be able to use it as needed:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.CustomEditorConfigurer"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"customEditors"</span>&gt;
    &lt;<span class="hl-tag">map</span>&gt;
      &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"example.ExoticType"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.ExoticTypeEditor"</span>/&gt;
    &lt;<span class="hl-tag">/map</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="beans-beans-conversion-customeditor-registration-per"></a>Using
            <code class="interfacename">PropertyEditorRegistrars</code></h5></div></div></div><p>Another mechanism for registering property editors with the
            Spring container is to create and use a
            <code class="interfacename">PropertyEditorRegistrar</code>. This
            interface is particularly useful when you need to use the same set
            of property editors in several different situations: write a
            corresponding registrar and reuse that in each case.
            <code class="literal">PropertyEditorRegistrars</code> work in conjunction with
            an interface called
            <code class="interfacename">PropertyEditorRegistry</code>, an interface
            that is implemented by the Spring
            <code class="interfacename">BeanWrapper</code> (and
            <code class="interfacename">DataBinder</code>).
            <code class="literal">PropertyEditorRegistrars</code> are particularly
            convenient when used in conjunction with the
            <code class="classname">CustomEditorConfigurer</code> (introduced <a class="link" href="#beans-beans-conversion-customeditor-registration" title="6.4.2.1&nbsp;Registering additional custom PropertyEditors">here</a>), which exposes a property called
            <code class="methodname">setPropertyEditorRegistrars(..)</code>:
            <code class="literal">PropertyEditorRegistrars</code> added to a
            <code class="classname">CustomEditorConfigurer</code> in this fashion can
            easily be shared with <code class="interfacename">DataBinder</code> and
            Spring MVC <code class="interfacename">Controllers</code>. Furthermore,
            it avoids the need for synchronization on custom editors: a
            <code class="interfacename">PropertyEditorRegistrar</code> is expected
            to create fresh <code class="interfacename">PropertyEditor</code>
            instances for each bean creation attempt.</p><p>Using a <code class="interfacename">PropertyEditorRegistrar</code>
            is perhaps best illustrated with an example. First off, you need to
            create your own
            <code class="interfacename">PropertyEditorRegistrar</code>
            implementation:</p><pre class="programlisting"><span class="hl-keyword">package</span> com.foo.editors.spring;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> CustomPropertyEditorRegistrar <span class="hl-keyword">implements</span> PropertyEditorRegistrar {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> registerCustomEditors(PropertyEditorRegistry registry) {

        <span class="hl-comment">// it is expected that new PropertyEditor instances are created</span>
        registry.registerCustomEditor(ExoticType.<span class="hl-keyword">class</span>, <span class="hl-keyword">new</span> ExoticTypeEditor());

        <span class="hl-comment">// you could register as many custom property editors as are required here...</span>
    }
}</pre><p>See also the
            <code class="classname">org.springframework.beans.support.ResourceEditorRegistrar</code>
            for an example
            <code class="interfacename">PropertyEditorRegistrar</code>
            implementation. Notice how in its implementation of the
            <code class="methodname">registerCustomEditors(..)</code> method it creates
            new instances of each property editor.</p><p>Next we configure a
            <code class="classname">CustomEditorConfigurer</code> and inject an instance
            of our <code class="classname">CustomPropertyEditorRegistrar</code> into
            it:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.CustomEditorConfigurer"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"propertyEditorRegistrars"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"customPropertyEditorRegistrar"</span>/&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"customPropertyEditorRegistrar"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.editors.spring.CustomPropertyEditorRegistrar"</span>/&gt;</pre><p>Finally, and in a bit of a departure from the focus of this
            chapter, for those of you using <a class="link" href="#mvc" title="16.&nbsp;Web MVC framework">Spring's MVC web
            framework</a>, using
            <code class="interfacename">PropertyEditorRegistrars</code> in
            conjunction with data-binding
            <code class="interfacename">Controllers</code> (such as
            <code class="classname">SimpleFormController</code>) can be very convenient.
            Find below an example of using a
            <code class="interfacename">PropertyEditorRegistrar</code> in the
            implementation of an <code class="methodname">initBinder(..)</code>
            method:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> RegisterUserController <span class="hl-keyword">extends</span> SimpleFormController {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> PropertyEditorRegistrar customPropertyEditorRegistrar;

    <span class="hl-keyword">public</span> RegisterUserController(PropertyEditorRegistrar propertyEditorRegistrar) {
        <span class="hl-keyword">this</span>.customPropertyEditorRegistrar = propertyEditorRegistrar;
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> initBinder(HttpServletRequest request, ServletRequestDataBinder binder)
                        <span class="hl-keyword">throws</span> Exception {
        <span class="hl-keyword">this</span>.customPropertyEditorRegistrar.registerCustomEditors(binder);
    }

    <span class="hl-comment">// other methods to do with registering a User</span>
}</pre><p>This style of <code class="interfacename">PropertyEditor</code>
            registration can lead to concise code (the implementation of
            <code class="methodname">initBinder(..)</code> is just one line long!), and
            allows common <code class="interfacename">PropertyEditor</code>
            registration code to be encapsulated in a class and then shared
            amongst as many <code class="interfacename">Controllers</code> as
            needed.</p></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="core-convert"></a>6.5&nbsp;Spring 3 Type Conversion</h2></div></div></div><p> Spring 3 introduces a <code class="filename">core.convert</code> package that
      provides a general type conversion system. The system defines an SPI to
      implement type conversion logic, as well as an API to execute type
      conversions at runtime. Within a Spring container, this system can be used
      as an alternative to PropertyEditors to convert externalized bean property
      value strings to required property types. The public API may also be used
      anywhere in your application where type conversion is needed. </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="core-convert-Converter-API"></a>6.5.1&nbsp;Converter SPI</h3></div></div></div><p> The SPI to implement type conversion logic is simple and strongly
        typed: </p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.converter;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Converter&lt;S, T&gt; {

    T convert(S source);

}</pre><p> To create your own Converter, simply implement the interface above.
        Parameterize S as the type you are converting from, and T as the type
        you are converting to. For each call to convert(S), the source argument
        is guaranteed to be NOT null. Your Converter may throw any Exception if
        conversion fails. An IllegalArgumentException should be thrown to report
        an invalid source value. Take care to ensure your Converter
        implementation is thread-safe. </p><p> Several converter implementations are provided in the
        <code class="filename">core.convert.support</code> package as a convenience.
        These include converters from Strings to Numbers and other common types.
        Consider <code class="classname">StringToInteger</code> as an example Converter
        implementation: </p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.support;

<span class="hl-keyword">final</span> <span class="hl-keyword">class</span> StringToInteger <span class="hl-keyword">implements</span> Converter&lt;String, Integer&gt; {

    <span class="hl-keyword">public</span> Integer convert(String source) {
        <span class="hl-keyword">return</span> Integer.valueOf(source);
    }

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="core-convert-ConverterFactory-SPI"></a>6.5.2&nbsp;ConverterFactory</h3></div></div></div><p> When you need to centralize the conversion logic for an entire
        class hierarchy, for example, when converting from String to
        java.lang.Enum objects, implement
        <code class="interfacename">ConverterFactory</code>: </p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.converter;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConverterFactory&lt;S, R&gt; {

    &lt;T <span class="hl-keyword">extends</span> R&gt; Converter&lt;S, T&gt; getConverter(Class&lt;T&gt; targetType);

}</pre><p> Parameterize S to be the type you are converting from and R to be
        the base type defining the <span class="emphasis"><em>range</em></span> of classes you can
        convert to. Then implement getConverter(Class&lt;T&gt;), where T is a
        subclass of R. </p><p> Consider the <code class="classname">StringToEnum</code> ConverterFactory
        as an example: </p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.support;

<span class="hl-keyword">final</span> <span class="hl-keyword">class</span> StringToEnumConverterFactory <span class="hl-keyword">implements</span> ConverterFactory&lt;String, Enum&gt; {

    <span class="hl-keyword">public</span> &lt;T <span class="hl-keyword">extends</span> Enum&gt; Converter&lt;String, T&gt; getConverter(Class&lt;T&gt; targetType) {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> StringToEnumConverter(targetType);
    }

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> StringToEnumConverter&lt;T <span class="hl-keyword">extends</span> Enum&gt; <span class="hl-keyword">implements</span> Converter&lt;String, T&gt; {

        <span class="hl-keyword">private</span> Class&lt;T&gt; enumType;

        <span class="hl-keyword">public</span> StringToEnumConverter(Class&lt;T&gt; enumType) {
            <span class="hl-keyword">this</span>.enumType = enumType;
        }

        <span class="hl-keyword">public</span> T convert(String source) {
            <span class="hl-keyword">return</span> (T) Enum.valueOf(<span class="hl-keyword">this</span>.enumType, source.trim());
        }
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="core-convert-GenericConverter-SPI"></a>6.5.3&nbsp;GenericConverter</h3></div></div></div><p> When you require a sophisticated Converter implementation, consider
        the GenericConverter interface. With a more flexible but less strongly
        typed signature, a GenericConverter supports converting between multiple
        source and target types. In addition, a GenericConverter makes available
        source and target field context you can use when implementing your
        conversion logic. Such context allows a type conversion to be driven by
        a field annotation, or generic information declared on a field
        signature. </p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.converter;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> GenericConverter {

    <span class="hl-keyword">public</span> Set&lt;ConvertiblePair&gt; getConvertibleTypes();

    Object convert(Object source, TypeDescriptor sourceType, TypeDescriptor targetType);

}</pre><p> To implement a GenericConverter, have getConvertibleTypes() return
        the supported source-&gt;target type pairs. Then implement
        convert(Object, TypeDescriptor, TypeDescriptor) to implement your
        conversion logic. The source TypeDescriptor provides access to the
        source field holding the value being converted. The target
        TypeDescriptor provides access to the target field where the converted
        value will be set. </p><p> A good example of a GenericConverter is a converter that converts
        between a Java Array and a Collection. Such an
        ArrayToCollectionConverter introspects the field that declares the
        target Collection type to resolve the Collection's element type. This
        allows each element in the source array to be converted to the
        Collection element type before the Collection is set on the target
        field. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p> Because GenericConverter is a more complex SPI interface, only
          use it when you need it. Favor Converter or ConverterFactory for basic
          type conversion needs. </p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="core-convert-ConditionalGenericConverter-SPI"></a>6.5.3.1&nbsp;ConditionalGenericConverter</h4></div></div></div><p> Sometimes you only want a Converter to execute if a specific
          condition holds true. For example, you might only want to execute a
          Converter if a specific annotation is present on the target field. Or
          you might only want to execute a Converter if a specific method, such
          as static valueOf method, is defined on the target class.
          ConditionalGenericConverter is an subinterface of GenericConverter
          that allows you to define such custom matching criteria: </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConditionalGenericConverter <span class="hl-keyword">extends</span> GenericConverter {

    <span class="hl-keyword">boolean</span> matches(TypeDescriptor sourceType, TypeDescriptor targetType);

}</pre><p> A good example of a ConditionalGenericConverter is an
          EntityConverter that converts between an persistent entity identifier
          and an entity reference. Such a EntityConverter might only match if
          the target entity type declares a static finder method e.g.
          findAccount(Long). You would perform such a finder method check in the
          implementation of matches(TypeDescriptor, TypeDescriptor). </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="core-convert-ConversionService-API"></a>6.5.4&nbsp;ConversionService API</h3></div></div></div><p> The ConversionService defines a unified API for executing type
        conversion logic at runtime. Converters are often executed behind this
        facade interface: </p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConversionService {

    <span class="hl-keyword">boolean</span> canConvert(Class&lt;?&gt; sourceType, Class&lt;?&gt; targetType);

    &lt;T&gt; T convert(Object source, Class&lt;T&gt; targetType);

    <span class="hl-keyword">boolean</span> canConvert(TypeDescriptor sourceType, TypeDescriptor targetType);

    Object convert(Object source, TypeDescriptor sourceType, TypeDescriptor targetType);

}</pre><p> Most ConversionService implementations also implement
        <span class="interface">ConverterRegistry</span>, which provides an SPI for
        registering converters. Internally, a ConversionService implementation
        delegates to its registered converters to carry out type conversion
        logic. </p><p> A robust ConversionService implementation is provided in the
        <code class="filename">core.convert.support</code> package.
        <code class="classname">GenericConversionService</code> is the general-purpose
        implementation suitable for use in most environments.
        <code class="classname">ConversionServiceFactory</code> provides a convenient
        factory for creating common ConversionService configurations. </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="core-convert-Spring-config"></a>6.5.5&nbsp;Configuring a ConversionService</h3></div></div></div><p> A ConversionService is a stateless object designed to be
        instantiated at application startup, then shared between multiple
        threads. In a Spring application, you typically configure a
        ConversionService instance per Spring container (or ApplicationContext).
        That ConversionService will be picked up by Spring and then used
        whenever a type conversion needs to be performed by the framework. You
        may also inject this ConversionService into any of your beans and invoke
        it directly. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p> If no ConversionService is registered with Spring, the original
          PropertyEditor-based system is used. </p></td></tr></table></div><p> To register a default ConversionService with Spring, add the
        following bean definition with id <code class="code">conversionService</code>: </p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"conversionService"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.support.ConversionServiceFactoryBean"</span>/&gt;
      </pre><p> A default ConversionService can convert between strings, numbers,
        enums, collections, maps, and other common types. To suppliment or
        override the default converters with your own custom converter(s), set
        the <code class="code">converters</code> property. Property values may implement
        either of the Converter, ConverterFactory, or GenericConverter
        interfaces. </p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"conversionService"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.support.ConversionServiceFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"converters"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.MyCustomConverter"</span>/&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>It is also common to use a ConversionService within a Spring MVC
        application. See <a class="xref" href="#format-configuring-FormattingConversionService" title="6.6.5&nbsp;Configuring Formatting in Spring MVC">Section&nbsp;6.6.5, &#8220;Configuring Formatting in Spring MVC&#8221;</a>
        for details on use with
        <code class="literal">&lt;mvc:annotation-driven/&gt;</code>.</p><p>In certain situations you may wish to apply formatting during
        conversion. See <a class="xref" href="#format-FormatterRegistry-SPI" title="6.6.3&nbsp;FormatterRegistry SPI">Section&nbsp;6.6.3, &#8220;FormatterRegistry SPI&#8221;</a> for
        details on using
        <code class="classname">FormattingConversionServiceFactoryBean</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="core-convert-programmatic-usage"></a>6.5.6&nbsp;Using a ConversionService programatically</h3></div></div></div><p> To work with a ConversionService instance programatically, simply
        inject a reference to it like you would for any other bean: </p><pre class="programlisting">@Service
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyService {

    @Autowired
    <span class="hl-keyword">public</span> MyService(ConversionService conversionService) {
        <span class="hl-keyword">this</span>.conversionService = conversionService;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doIt() {
        <span class="hl-keyword">this</span>.conversionService.convert(...)
    }
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="format"></a>6.6&nbsp;Spring 3 Field Formatting</h2></div></div></div><p> As discussed in the previous section, <a class="link" href="#core-convert" title="6.5&nbsp;Spring 3 Type Conversion"><code class="filename">core.convert</code></a> is a general-purpose type
      conversion system. It provides a unified ConversionService API as well as
      a strongly-typed Converter SPI for implementing conversion logic from one
      type to another. A Spring Container uses this system to bind bean property
      values. In addition, both the Spring Expression Language (SpEL) and
      DataBinder use this system to bind field values. For example, when SpEL
      needs to coerce a <code class="classname">Short</code> to a
      <code class="classname">Long</code> to complete an
      <code class="function">expression.setValue(Object bean, Object value)</code>
      attempt, the core.convert system performs the coercion. </p><p> Now consider the type conversion requirements of a typical client
      environment such as a web or desktop application. In such environments,
      you typically convert <span class="emphasis"><em>from String</em></span> to support the
      client postback process, as well as back <span class="emphasis"><em>to String</em></span> to
      support the view rendering process. In addition, you often need to
      localize String values. The more general <span class="emphasis"><em>core.convert</em></span>
      Converter SPI does not address such <span class="emphasis"><em>formatting</em></span>
      requirements directly. To directly address them, Spring 3 introduces a
      convenient Formatter SPI that provides a simple and robust alternative to
      PropertyEditors for client environments. </p><p> In general, use the Converter SPI when you need to implement
      general-purpose type conversion logic; for example, for converting between
      a java.util.Date and and java.lang.Long. Use the Formatter SPI when you're
      working in a client environment, such as a web application, and need to
      parse and print localized field values. The ConversionService provides a
      unified type conversion API for both SPIs. </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="format-Formatter-SPI"></a>6.6.1&nbsp;Formatter SPI</h3></div></div></div><p> The Formatter SPI to implement field formatting logic is simple and
        strongly typed: </p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Formatter&lt;T&gt; <span class="hl-keyword">extends</span> Printer&lt;T&gt;, Parser&lt;T&gt; {
}</pre><p> Where Formatter extends from the Printer and Parser building-block
        interfaces: </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Printer&lt;T&gt; {
    String print(T fieldValue, Locale locale);
}</pre><pre class="programlisting"><span class="hl-keyword">import</span> java.text.ParseException;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Parser&lt;T&gt; {
    T parse(String clientValue, Locale locale) <span class="hl-keyword">throws</span> ParseException;
}</pre><p> To create your own Formatter, simply implement the Formatter
        interface above. Parameterize T to be the type of object you wish to
        format, for example, <code class="classname">java.util.Date</code>. Implement
        the <code class="methodname">print()</code> operation to print an instance of T
        for display in the client locale. Implement the
        <code class="methodname">parse()</code> operation to parse an instance of T from
        the formatted representation returned from the client locale. Your
        Formatter should throw a ParseException or IllegalArgumentException if a
        parse attempt fails. Take care to ensure your Formatter implementation
        is thread-safe. </p><p> Several Formatter implementations are provided in
        <code class="filename">format</code> subpackages as a convenience. The
        <code class="filename">number</code> package provides a NumberFormatter,
        CurrencyFormatter, and PercentFormatter to format java.lang.Number
        objects using a java.text.NumberFormat. The
        <code class="filename">datetime</code> package provides a DateFormatter to format
        java.util.Date objects with a java.text.DateFormat. The
        <code class="filename">datetime.joda</code> package provides comprehensive
        datetime formatting support based on the <a class="ulink" href="http://joda-time.sourceforge.net" target="_top">Joda Time library</a>. </p><p> Consider <code class="classname">DateFormatter</code> as an example
        <code class="interfacename">Formatter</code> implementation: </p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format.datetime;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> DateFormatter <span class="hl-keyword">implements</span> Formatter&lt;Date&gt; {

    <span class="hl-keyword">private</span> String pattern;

    <span class="hl-keyword">public</span> DateFormatter(String pattern) {
        <span class="hl-keyword">this</span>.pattern = pattern;
    }

    <span class="hl-keyword">public</span> String print(Date date, Locale locale) {
        <span class="hl-keyword">if</span> (date == null) {
            <span class="hl-keyword">return</span> <span class="hl-string">""</span>;
        }
        <span class="hl-keyword">return</span> getDateFormat(locale).format(date);
    }

    <span class="hl-keyword">public</span> Date parse(String formatted, Locale locale) <span class="hl-keyword">throws</span> ParseException {
        <span class="hl-keyword">if</span> (formatted.length() == 0) {
            <span class="hl-keyword">return</span> null;
        }
        <span class="hl-keyword">return</span> getDateFormat(locale).parse(formatted);
    }

    <span class="hl-keyword">protected</span> DateFormat getDateFormat(Locale locale) {
        DateFormat dateFormat = <span class="hl-keyword">new</span> SimpleDateFormat(<span class="hl-keyword">this</span>.pattern, locale);
        dateFormat.setLenient(false);
        <span class="hl-keyword">return</span> dateFormat;
    }

}</pre><p> The Spring team welcomes community-driven Formatter contributions;
        see <a class="ulink" href="http://jira.springframework.org" target="_top">http://jira.springframework.org</a> to contribute. </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="format-CustomFormatAnnotations"></a>6.6.2&nbsp;Annotation-driven Formatting</h3></div></div></div><p> As you will see, field formatting can be configured by field type
        or annotation. To bind an Annotation to a formatter, implement
        AnnotationFormatterFactory: </p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> AnnotationFormatterFactory&lt;A <span class="hl-keyword">extends</span> Annotation&gt; {

    Set&lt;Class&lt;?&gt;&gt; getFieldTypes();

    Printer&lt;?&gt; getPrinter(A annotation, Class&lt;?&gt; fieldType);

    Parser&lt;?&gt; getParser(A annotation, Class&lt;?&gt; fieldType);

}</pre><p> Parameterize A to be the field annotationType you wish to associate
        formatting logic with, for example
        <code class="code">org.springframework.format.annotation.DateTimeFormat</code>. Have
        <code class="methodname">getFieldTypes()</code> return the types of fields the
        annotation may be used on. Have <code class="methodname">getPrinter()</code>
        return a Printer to print the value of an annotated field. Have
        <code class="methodname">getParser()</code> return a Parser to parse a
        clientValue for an annotated field. </p><p> The example AnnotationFormatterFactory implementation below binds
        the @NumberFormat Annotation to a formatter. This annotation allows
        either a number style or pattern to be specified: </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> NumberFormatAnnotationFormatterFactory
        <span class="hl-keyword">implements</span> AnnotationFormatterFactory&lt;NumberFormat&gt; {

    <span class="hl-keyword">public</span> Set&lt;Class&lt;?&gt;&gt; getFieldTypes() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> HashSet&lt;Class&lt;?&gt;&gt;(asList(<span class="hl-keyword">new</span> Class&lt;?&gt;[] {
            Short.<span class="hl-keyword">class</span>, Integer.<span class="hl-keyword">class</span>, Long.<span class="hl-keyword">class</span>, Float.<span class="hl-keyword">class</span>,
            Double.<span class="hl-keyword">class</span>, BigDecimal.<span class="hl-keyword">class</span>, BigInteger.<span class="hl-keyword">class</span> }));
    }

    <span class="hl-keyword">public</span> Printer&lt;Number&gt; getPrinter(NumberFormat annotation, Class&lt;?&gt; fieldType) {
        <span class="hl-keyword">return</span> configureFormatterFrom(annotation, fieldType);
    }

    <span class="hl-keyword">public</span> Parser&lt;Number&gt; getParser(NumberFormat annotation, Class&lt;?&gt; fieldType) {
        <span class="hl-keyword">return</span> configureFormatterFrom(annotation, fieldType);
    }

    <span class="hl-keyword">private</span> Formatter&lt;Number&gt; configureFormatterFrom(NumberFormat annotation,
                                                     Class&lt;?&gt; fieldType) {
        <span class="hl-keyword">if</span> (!annotation.pattern().isEmpty()) {
            <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> NumberFormatter(annotation.pattern());
        } <span class="hl-keyword">else</span> {
            Style style = annotation.style();
            <span class="hl-keyword">if</span> (style == Style.PERCENT) {
                <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> PercentFormatter();
            } <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (style == Style.CURRENCY) {
                <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> CurrencyFormatter();
            } <span class="hl-keyword">else</span> {
                <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> NumberFormatter();
            }
        }
    }
}</pre><p> To trigger formatting, simply annotate fields with @NumberFormat: </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyModel {

    @NumberFormat(style=Style.CURRENCY)
    <span class="hl-keyword">private</span> BigDecimal decimal;

}</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="format-annotations-api"></a>6.6.2.1&nbsp;Format Annotation API</h4></div></div></div><p> A portable format annotation API exists in the
          <code class="filename">org.springframework.format.annotation</code> package.
          Use @NumberFormat to format java.lang.Number fields. Use
          @DateTimeFormat to format java.util.Date, java.util.Calendar,
          java.util.Long, or Joda Time fields. </p><p> The example below uses @DateTimeFormat to format a java.util.Date
          as a ISO Date (yyyy-MM-dd): </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyModel {

    @DateTimeFormat(iso=ISO.DATE)
    <span class="hl-keyword">private</span> Date date;

}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="format-FormatterRegistry-SPI"></a>6.6.3&nbsp;FormatterRegistry SPI</h3></div></div></div><p> The FormatterRegistry is an SPI for registering formatters and 
      	converters. <code class="classname">FormattingConversionService</code> is 
      	an implementation of FormatterRegistry suitable for most environments. 
      	This implementation may be configured programatically or declaratively 
      	as a Spring bean using 
      	<code class="classname">FormattingConversionServiceFactoryBean</code>.
      	Because this implemementation also implements
        <code class="classname">ConversionService</code>, it can be directly 
        configured for use with Spring's DataBinder and the Spring Expression 
        Language (SpEL).
      </p><p> Review the FormatterRegistry SPI below: </p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FormatterRegistry <span class="hl-keyword">extends</span> ConverterRegistry {

    <span class="hl-keyword">void</span> addFormatterForFieldType(Class&lt;?&gt; fieldType, Printer&lt;?&gt; printer, Parser&lt;?&gt; parser);

    <span class="hl-keyword">void</span> addFormatterForFieldType(Class&lt;?&gt; fieldType, Formatter&lt;?&gt; formatter);

    <span class="hl-keyword">void</span> addFormatterForFieldType(Formatter&lt;?&gt; formatter);

    <span class="hl-keyword">void</span> addFormatterForAnnotation(AnnotationFormatterFactory&lt;?, ?&gt; factory);

}</pre><p> As shown above, Formatters can be registered by fieldType or
        annotation. 
      </p><p> The FormatterRegistry SPI allows you to configure Formatting rules
        centrally, instead of duplicating such configuration across your
        Controllers. For example, you might want to enforce that all Date fields
        are formatted a certain way, or fields with a specific annotation are
        formatted in a certain way. With a shared FormatterRegistry, you define
        these rules once and they are applied whenever formatting is needed. 
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="format-FormatterRegistrar-SPI"></a>6.6.4&nbsp;FormatterRegistrar SPI</h3></div></div></div><p> The FormatterRegistrar is an SPI for registering formatters and 
	  	converters through the FormatterRegistry: 
	  </p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FormatterRegistrar {

    <span class="hl-keyword">void</span> registerFormatters(FormatterRegistry registry);

}</pre><p> A FormatterRegistrar is useful when registering multiple related 
	        converters and formatters for a given formatting category, such as Date 
	        formatting. It can also be useful where declarative registration is
	        insufficient. For example when a formatter needs to be indexed under a 
	        specific field type different from its own &lt;T&gt; or when registering
	        a Printer/Parser pair. The next section provides more information on 
	        converter and formatter registration.
	    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="format-configuring-FormattingConversionService"></a>6.6.5&nbsp;Configuring Formatting in Spring MVC</h3></div></div></div><p> In a Spring MVC application, you may configure a custom
        ConversionService instance explicity as an attribute of the
        <code class="literal">annotation-driven</code> element of the MVC namespace. This
        ConversionService will then be used anytime a type conversion is
        required during Controller model binding. If not configured explicitly,
        Spring MVC will automatically register default formatters and converters
        for common types such as numbers and dates. </p><p> To rely on default formatting rules, no custom configuration is
        required in your Spring MVC config XML: </p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">mvc:annotation-driven</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p> With this one-line of configuation, default formatters for Numbers
        and Date types will be installed, including support for the
        @NumberFormat and @DateTimeFormat annotations. Full support for the Joda
        Time formatting library is also installed if Joda Time is present on the
        classpath. </p><p> To inject a ConversionService instance with custom formatters and
        converters registered, set the conversion-service attribute and then 
        specify custom converters, formatters, or FormatterRegistrars as properties
        of the FormattingConversionServiceFactoryBean: </p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">mvc:annotation-driven</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"conversionService"</span>/&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"conversionService"</span>
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.format.support.FormattingConversionServiceFactoryBean"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"converters"</span>&gt;
            &lt;<span class="hl-tag">set</span>&gt;
                &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.MyConverter"</span>/&gt;
            &lt;<span class="hl-tag">/set</span>&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"formatters"</span>&gt;
            &lt;<span class="hl-tag">set</span>&gt;
                &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.MyFormatter"</span>/&gt;
                &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.MyAnnotationFormatterFactory"</span>/&gt;
            &lt;<span class="hl-tag">/set</span>&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"formatterRegistrars"</span>&gt;
            &lt;<span class="hl-tag">set</span>&gt;
                &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.MyFormatterRegistrar"</span>/&gt;
            &lt;<span class="hl-tag">/set</span>&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p> See <a class="xref" href="#format-FormatterRegistrar-SPI" title="6.6.4&nbsp;FormatterRegistrar SPI">Section&nbsp;6.6.4, &#8220;FormatterRegistrar SPI&#8221;</a> and  
	        the <code class="classname">FormattingConversionServiceFactoryBean</code> 
	        for more information on when to use FormatterRegistrars.
	      </p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-beanvalidation"></a>6.7&nbsp;Spring 3 Validation</h2></div></div></div><p> Spring 3 introduces several enhancements to its validation support.
      First, the JSR-303 Bean Validation API is now fully supported. Second,
      when used programatically, Spring's DataBinder can now validate objects as
      well as bind to them. Third, Spring MVC now has support for declaratively
      validating @Controller inputs. </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="validation-beanvalidation-overview"></a>6.7.1&nbsp;Overview of the JSR-303 Bean Validation API</h3></div></div></div><p> JSR-303 standardizes validation constraint declaration and metadata
        for the Java platform. Using this API, you annotate domain model
        properties with declarative validation constraints and the runtime
        enforces them. There are a number of built-in constraints you can take
        advantage of. You may also define your own custom constraints. </p><p> To illustrate, consider a simple PersonForm model with two
        properties: </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PersonForm {
    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;
}</pre><p> JSR-303 allows you to define declarative validation constraints
        against such properties: </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PersonForm {

    @NotNull
    @Size(max=64)
    <span class="hl-keyword">private</span> String name;

    @Min(0)
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;

}</pre><p> When an instance of this class is validated by a JSR-303 Validator,
        these constraints will be enforced. </p><p> For general information on JSR-303, see the <a class="ulink" href="http://jcp.org/en/jsr/detail?id=303" target="_top">Bean Validation
        Specification</a>. For information on the specific capabilities of
        the default reference implementation, see the <a class="ulink" href="https://www.hibernate.org/412.html" target="_top">Hibernate Validator</a>
        documentation. To learn how to setup a JSR-303 implementation as a
        Spring bean, keep reading. </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="validation-beanvalidation-spring"></a>6.7.2&nbsp;Configuring a Bean Validation Implementation</h3></div></div></div><p> Spring provides full support for the JSR-303 Bean Validation API.
        This includes convenient support for bootstrapping a JSR-303
        implementation as a Spring bean. This allows for a
        <code class="code">javax.validation.ValidatorFactory</code> or
        <code class="code">javax.validation.Validator</code> to be injected wherever
        validation is needed in your application. </p><p> Use the <code class="classname">LocalValidatorFactoryBean</code> to
        configure a default JSR-303 Validator as a Spring bean: </p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"validator"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.validation.beanvalidation.LocalValidatorFactoryBean"</span>/&gt;</pre><p> The basic configuration above will trigger JSR-303 to initialize
        using its default bootstrap mechanism. A JSR-303 provider, such as
        Hibernate Validator, is expected to be present in the classpath and will
        be detected automatically. </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="validation-beanvalidation-spring-inject"></a>6.7.2.1&nbsp;Injecting a Validator</h4></div></div></div><p> <code class="classname">LocalValidatorFactoryBean</code> implements both
          <code class="code">javax.validation.ValidatorFactory</code> and
          <code class="code">javax.validation.Validator</code>, as well as Spring's
          <code class="code">org.springframework.validation.Validator</code>. You may inject
          a reference to either of these interfaces into beans that need to
          invoke validation logic. </p><p> Inject a reference to <code class="code">javax.validation.Validator</code> if
          you prefer to work with the JSR-303 API directly: </p><pre class="programlisting"><span class="hl-keyword">import</span> javax.validation.Validator;

@Service
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyService {

    @Autowired
    <span class="hl-keyword">private</span> Validator validator;</pre><p> Inject a reference to
          <code class="code">org.springframework.validation.Validator</code> if your bean
          requires the Spring Validation API: </p><pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.validation.Validator;

@Service
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyService {

    @Autowired
    <span class="hl-keyword">private</span> Validator validator;

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="validation-beanvalidation-spring-constraints"></a>6.7.2.2&nbsp;Configuring Custom Constraints</h4></div></div></div><p> Each JSR-303 validation constraint consists of two parts. First,
          a @Constraint annotation that declares the constraint and its
          configurable properties. Second, an implementation of the
          <code class="code">javax.validation.ConstraintValidator</code> interface that
          implements the constraint's behavior. To associate a declaration with
          an implementation, each @Constraint annotation references a
          corresponding ValidationConstraint implementation class. At runtime, a
          <code class="code">ConstraintValidatorFactory</code> instantiates the referenced
          implementation when the constraint annotation is encountered in your
          domain model. </p><p> By default, the <code class="classname">LocalValidatorFactoryBean</code>
          configures a <code class="code">SpringConstraintValidatorFactory</code> that uses
          Spring to create ConstraintValidator instances. This allows your
          custom ConstraintValidators to benefit from dependency injection like
          any other Spring bean. </p><p> Shown below is an example of a custom @Constraint declaration,
          followed by an associated <code class="code">ConstraintValidator</code>
          implementation that uses Spring for dependency injection: </p><pre class="programlisting">@Target({ElementType.METHOD, ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy=MyConstraintValidator.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> @<span class="hl-keyword">interface</span> MyConstraint {
}</pre><pre class="programlisting"><span class="hl-keyword">import</span> javax.validation.ConstraintValidator;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyConstraintValidator <span class="hl-keyword">implements</span> ConstraintValidator {

    @Autowired;
    <span class="hl-keyword">private</span> Foo aDependency;

    ...
}</pre><p> As you can see, a ConstraintValidator implementation may have its
          dependencies @Autowired like any other Spring bean. </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="validation-beanvalidation-spring-other"></a>6.7.2.3&nbsp;Additional Configuration Options</h4></div></div></div><p> The default <code class="classname">LocalValidatorFactoryBean</code>
          configuration should prove sufficient for most cases. There are a
          number of other configuration options for various JSR-303 constructs,
          from message interpolation to traversal resolution. See the JavaDocs
          of <code class="classname">LocalValidatorFactoryBean</code> for more
          information on these options. </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="validation-binder"></a>6.7.3&nbsp;Configuring a DataBinder</h3></div></div></div><p> Since Spring 3, a DataBinder instance can be configured with a
        Validator. Once configured, the Validator may be invoked by calling
        <code class="code">binder.validate()</code>. Any validation Errors are automatically
        added to the binder's BindingResult. </p><p> When working with the DataBinder programatically, this can be used
        to invoke validation logic after binding to a target object: </p><pre class="programlisting">Foo target = <span class="hl-keyword">new</span> Foo();
DataBinder binder = <span class="hl-keyword">new</span> DataBinder(target);
binder.setValidator(<span class="hl-keyword">new</span> FooValidator());

<span class="hl-comment">// bind to the target object</span>
binder.bind(propertyValues);

<span class="hl-comment">// validate the target object</span>
binder.validate();

<span class="hl-comment">// get BindingResult that includes any validation errors</span>
BindingResult results = binder.getBindingResult();</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="validation-mvc"></a>6.7.4&nbsp;Spring MVC 3 Validation</h3></div></div></div><p> Beginning with Spring 3, Spring MVC has the ability to
        automatically validate @Controller inputs. In previous versions it was
        up to the developer to manually invoke validation logic. </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="validation-mvc-triggering"></a>6.7.4.1&nbsp;Triggering @Controller Input Validation</h4></div></div></div><p> To trigger validation of a @Controller input, simply annotate the
          input argument as @Valid: </p><pre class="programlisting">@Controller
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyController {

    @RequestMapping(<span class="hl-string">"/foo"</span>, method=RequestMethod.POST)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> processFoo(@Valid Foo foo) { <span class="hl-comment">/* ... */</span> }
</pre><p> Spring MVC will validate a @Valid object after binding so-long as
          an appropriate Validator has been configured. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p> The @Valid annotation is part of the standard JSR-303 Bean
            Validation API, and is not a Spring-specific construct. </p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="validation-mvc-configuring"></a>6.7.4.2&nbsp;Configuring a Validator for use by Spring MVC</h4></div></div></div><p> The Validator instance invoked when a @Valid method argument is
          encountered may be configured in two ways. First, you may call
          binder.setValidator(Validator) within a @Controller's @InitBinder
          callback. This allows you to configure a Validator instance per
          @Controller class: </p><pre class="programlisting">@Controller
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyController {

    @InitBinder
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> initBinder(WebDataBinder binder) {
        binder.setValidator(<span class="hl-keyword">new</span> FooValidator());
    }

    @RequestMapping(<span class="hl-string">"/foo"</span>, method=RequestMethod.POST)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> processFoo(@Valid Foo foo) { ... }

}</pre><p> Second, you may call setValidator(Validator) on the global
          WebBindingInitializer. This allows you to configure a Validator
          instance across all @Controllers. This can be achieved easily by using
          the Spring MVC namespace: </p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">mvc:annotation-driven</span> <span class="hl-attribute">validator</span>=<span class="hl-value">"globalValidator"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="validation-mvc-jsr303"></a>6.7.4.3&nbsp;Configuring a JSR-303 Validator for use by Spring MVC</h4></div></div></div><p> With JSR-303, a single <code class="code">javax.validation.Validator</code>
          instance typically validates <span class="emphasis"><em>all</em></span> model objects
          that declare validation constraints. To configure a JSR-303-backed
          Validator with Spring MVC, simply add a JSR-303 Provider, such as
          Hibernate Validator, to your classpath. Spring MVC will detect it and
          automatically enable JSR-303 support across all Controllers. </p><p> The Spring MVC configuration required to enable JSR-303 support
          is shown below: </p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd"</span>&gt;

    &lt;<span class="hl-comment">!-- JSR-303 support will be detected on classpath and enabled automatically --</span>&gt;
    &lt;<span class="hl-tag">mvc:annotation-driven</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;
</pre><p> With this minimal configuration, anytime a @Valid @Controller
          input is encountered, it will be validated by the JSR-303 provider.
          JSR-303, in turn, will enforce any constraints declared against the
          input. Any ConstraintViolations will automatically be exposed as
          errors in the BindingResult renderable by standard Spring MVC form
          tags. </p></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="expressions"></a>7.&nbsp;Spring Expression Language (SpEL)</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="expressions-intro"></a>7.1&nbsp;Introduction</h2></div></div></div><p>The Spring Expression Language (SpEL for short) is a powerful
    expression language that supports querying and manipulating an object
    graph at runtime. The language syntax is similar to Unified EL but offers
    additional features, most notably method invocation and basic string
    templating functionality.</p><p>While there are several other Java expression languages available,
    OGNL, MVEL, and JBoss EL, to name a few, the Spring Expression Language
    was created to provide the Spring community with a single well supported
    expression language that can be used across all the products in the Spring
    portfolio. Its language features are driven by the requirements of the
    projects in the Spring portfolio, including tooling requirements for code
    completion support within the eclipse based SpringSource Tool Suite. That
    said, SpEL is based on a technology agnostic API allowing other
    expression language implementations to be integrated should the need
    arise.</p><p>While SpEL serves as the foundation for expression evaluation within
    the Spring portfolio, it is not directly tied to Spring and can be used
    independently. In order to be self contained, many of the examples in this
    chapter use SpEL as if it were an independent expression language. This
    requires creating a few bootstrapping infrastructure classes such as the
    parser. Most Spring users will not need to deal with this infrastructure
    and will instead only author expression strings for evaluation. An example
    of this typical use is the integration of SpEL into creating XML or
    annotated based bean definitions as shown in the section <a class="link" href="#expressions-beandef" title="7.4&nbsp;Expression support for defining bean definitions">Expression support for defining bean
    definitions.</a></p><p>This chapter covers the features of the expression language, its
    API, and its language syntax. In several places an Inventor and Inventor's
    Society class are used as the target objects for expression evaluation.
    These class declarations and the data used to populate them are listed at
    the end of the chapter.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="expressions-features"></a>7.2&nbsp;Feature Overview</h2></div></div></div><p>The expression language supports the following functionality</p><div class="itemizedlist"><ul type="disc"><li><p>Literal expressions</p></li><li><p>Boolean and relational operators</p></li><li><p>Regular expressions</p></li><li><p>Class expressions</p></li><li><p>Accessing properties, arrays, lists, maps</p></li><li><p>Method invocation</p></li><li><p>Relational operators</p></li><li><p>Assignment</p></li><li><p>Calling constructors</p></li><li><p>Bean references</p></li><li><p>Array construction</p></li><li><p>Inline lists</p></li><li><p>Ternary operator</p></li><li><p>Variables</p></li><li><p>User defined functions</p></li><li><p>Collection projection</p></li><li><p>Collection selection</p></li><li><p>Templated expressions</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="expressions-evaluation"></a>7.3&nbsp;Expression Evaluation using Spring's Expression Interface</h2></div></div></div><p>This section introduces the simple use of SpEL interfaces and its
    expression language. The complete language reference can be found in the
    section <a class="link" href="#expressions-language-ref" title="7.5&nbsp;Language Reference">Language
    Reference</a>.</p><p>The following code introduces the SpEL API to evaluate the literal
    string expression 'Hello World'.</p><pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">"'Hello World'"</span>);
String message = (String) exp.getValue();</pre><p>The value of the
    message variable is simply 'Hello World'.</p><p>The SpEL classes and interfaces you are most likely to use are
    located in the packages <span class="package">org.springframework.expression</span>
    and its sub packages and <span class="package">spel.support</span>.</p><p>The interface <code class="interfacename">ExpressionParser</code> is
    responsible for parsing an expression string. In this example the
    expression string is a string literal denoted by the surrounding single
    quotes. The interface <code class="interfacename">Expression</code> is
    responsible for evaluating the previously defined expression string. There
    are two exceptions that can be thrown,
    <code class="classname">ParseException</code> and
    <code class="classname">EvaluationException</code> when calling
    '<code class="literal">parser.parseExpression</code>' and
    '<code class="literal">exp.getValue</code>' respectively.</p><p>SpEL supports a wide range of features, such as calling methods,
    accessing properties, and calling constructors.</p><p>As an example of method invocation, we call the 'concat' method on
    the string literal.</p><pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">"'Hello World'.concat('!')"</span>);
String message = (String) exp.getValue();</pre><p>The value of message is now 'Hello World!'.</p><p>As an example of calling a JavaBean property, the String property
    'Bytes' can be called as shown below.</p><pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

<span class="hl-comment">// invokes 'getBytes()'</span>
Expression exp = parser.parseExpression(<span class="hl-string">"'Hello World'.bytes"</span>);  

<span class="hl-keyword">byte</span>[] bytes = (<span class="hl-keyword">byte</span>[]) exp.getValue();</pre><p>SpEL also supports nested properties using standard 'dot' notation,
    i.e. prop1.prop2.prop3 and the setting of property values</p><p>Public fields may also be accessed.</p><pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

<span class="hl-comment">// invokes 'getBytes().length'</span>
Expression exp = parser.parseExpression(<span class="hl-string">"'Hello World'.bytes.length"</span>);  

<span class="hl-keyword">int</span> length = (Integer) exp.getValue();</pre><p>The String's constructor can be called instead of using a string
    literal.</p><pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">"new String('hello world').toUpperCase()"</span>);
String message = exp.getValue(String.<span class="hl-keyword">class</span>);</pre><p>Note the use of the generic method <code class="literal">public &lt;T&gt; T
    getValue(Class&lt;T&gt; desiredResultType)</code>. Using this method
    removes the need to cast the value of the expression to the desired result
    type. An <code class="classname">EvaluationException</code> will be thrown if the
    value cannot be cast to the type <code class="literal">T</code> or converted using
    the registered type converter.</p><p>The more common usage of SpEL is to provide an expression string that
    is evaluated against a specific object instance (called the root object). 
    There are two options here and which to choose depends on whether the object 
    against which the expression is being evaluated will be changing with each 
    call to evaluate the expression.  In the following example
    we retrieve the <code class="literal">name</code> property from an instance of the
    Inventor class.</p><pre class="programlisting"><span class="hl-comment">// Create and set a calendar </span>
GregorianCalendar c = <span class="hl-keyword">new</span> GregorianCalendar();
c.set(1856, 7, 9);

<span class="hl-comment">//  The constructor arguments are name, birthday, and nationality.</span>
Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">"Nikola Tesla"</span>, c.getTime(), <span class="hl-string">"Serbian"</span>);

ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">"name"</span>);
EvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);

String name = (String) exp.getValue(context);</pre><p>In the last
    line, the value of the string variable 'name' will be set to "Nikola
    Tesla". The class StandardEvaluationContext is where you can specify which
    object the "name" property will be evaluated against.  This is the mechanism
    to use if the root object is unlikely to change, it can simply be set once
    in the evaluation context.  If the root object is likely to change
    repeatedly, it can be supplied on each call to <code class="literal">getValue</code>, 
    as this next example shows:</p><pre class="programlisting">/ Create and set a calendar 
GregorianCalendar c = <span class="hl-keyword">new</span> GregorianCalendar();
c.set(1856, 7, 9);

<span class="hl-comment">//  The constructor arguments are name, birthday, and nationality.</span>
Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">"Nikola Tesla"</span>, c.getTime(), <span class="hl-string">"Serbian"</span>);

ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">"name"</span>);

String name = (String) exp.getValue(tesla);
    </pre><p>In this case the inventor <code class="literal">tesla</code> has been
    supplied directly to <code class="literal">getValue</code> and the expression
    evaluation infrastructure creates and manages a default evaluation context 
    internally - it did not require one to be supplied.</p><p>The StandardEvaluationContext is relatively expensive to construct and
    during repeated usage it builds up cached state that enables subsequent
    expression evaluations to be performed more quickly.  For this reason it is
    better to cache and reuse them where possible, rather than construct a new 
    one for each expression evaluation.
    </p><p>In some cases it can be desirable to use a configured evaluation context and
    yet still supply a different root object on each call to <code class="literal">getValue</code>.
    <code class="literal">getValue</code> allows both to be specified on the same call.
    In these situations the root object passed on the call is considered to override
    any (which maybe null) specified on the evaluation context.</p><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In standalone usage of SpEL there is a need to create the parser,
        parse expressions and perhaps provide evaluation contexts and a root
        context object. However, more common usage
        is to provide only the SpEL expression string as part of a
        configuration file, for example for Spring bean or Spring Web Flow
        definitions. In this case, the parser, evaluation context, root object
        and any predefined variables are all set up implicitly, requiring
        the user to specify nothing other than the expressions.</p></td></tr></table></div><p>
	As a final introductory example, the use of a boolean operator is
    shown using the Inventor object in the previous example.</p><pre class="programlisting">Expression exp = parser.parseExpression(<span class="hl-string">"name == 'Nikola Tesla'"</span>);
<span class="hl-keyword">boolean</span> result = exp.getValue(context, Boolean.<span class="hl-keyword">class</span>);  <span class="hl-comment">// evaluates to true</span></pre><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12545"></a>7.3.1&nbsp;The EvaluationContext interface</h3></div></div></div><p>The interface <code class="interfacename">EvaluationContext</code> is
      used when evaluating an expression to resolve properties, methods,
      fields, and to help perform type conversion. The out-of-the-box
      implementation, <code class="classname">StandardEvaluationContext</code>, uses
      reflection to manipulate the object, caching
      <span class="package">java.lang.reflect</span>'s <code class="classname">Method</code>,
      <code class="classname">Field</code>, and <code class="classname">Constructor</code>
      instances for increased performance.</p><p>The <code class="classname">StandardEvaluationContext</code> is where you
      may specify the root object to evaluate against via the method
      <code class="methodname">setRootObject()</code> or passing the root object into
      the constructor. You can also specify variables and functions that
      will be used in the expression using the methods
      <code class="methodname">setVariable()</code> and
      <code class="methodname">registerFunction()</code>. The use of variables and
      functions are described in the language reference sections <a class="link" href="#expressions-ref-variables" title="7.5.10&nbsp;Variables">Variables</a> and <a class="link" href="#expressions-ref-functions" title="7.5.11&nbsp;Functions">Functions</a>. The
      <code class="classname">StandardEvaluationContext</code> is also where you can
      register custom <code class="classname">ConstructorResolver</code>s,
      <code class="classname">MethodResolver</code>s, and
      <code class="classname">PropertyAccessor</code>s to extend how SpEL evaluates
      expressions. Please refer to the JavaDoc of these classes for more
      details.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e12600"></a>7.3.1.1&nbsp;Type Conversion</h4></div></div></div><p>By default SpEL uses the conversion service available in Spring
        core
        (<code class="literal">org.springframework.core.convert.ConversionService</code>).
        This conversion service comes with many converters built in for common
        conversions but is also fully extensible so custom conversions between
        types can be added. Additionally it has the key capability that it is
        generics aware. This means that when working with generic types in
        expressions, SpEL will attempt conversions to maintain type
        correctness for any objects it encounters.</p><p>What does this mean in practice? Suppose assignment, using
        <code class="literal">setValue()</code>, is being used to set a
        <code class="literal">List</code> property. The type of the property is actually
        <code class="literal">List&lt;Boolean&gt;</code>. SpEL will recognize that the
        elements of the list need to be converted to
        <code class="literal">Boolean</code> before being placed in it. A simple
        example:</p><pre class="programlisting"><span class="hl-keyword">class</span> Simple {
    <span class="hl-keyword">public</span> List&lt;Boolean&gt; booleanList = <span class="hl-keyword">new</span> ArrayList&lt;Boolean&gt;();
}
    	
Simple simple = <span class="hl-keyword">new</span> Simple();

simple.booleanList.add(true);

StandardEvaluationContext simpleContext = <span class="hl-keyword">new</span> StandardEvaluationContext(simple);

<span class="hl-comment">// false is passed in here as a string.  SpEL and the conversion service will </span>
<span class="hl-comment">// correctly recognize that it needs to be a Boolean and convert it</span>
parser.parseExpression(<span class="hl-string">"booleanList[0]"</span>).setValue(simpleContext, <span class="hl-string">"false"</span>);

<span class="hl-comment">// b will be false</span>
Boolean b = simple.booleanList.get(0);
        </pre></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="expressions-beandef"></a>7.4&nbsp;Expression support for defining bean definitions</h2></div></div></div><p>SpEL expressions can be used with XML or annotation based
    configuration metadata for defining BeanDefinitions. In both cases the
    syntax to define the expression is of the form <code class="literal">#{ &lt;expression
    string&gt; }</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-beandef-xml-based"></a>7.4.1&nbsp;XML based configuration</h3></div></div></div><p>A property or constructor-arg value can be set using expressions
      as shown below</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"numberGuess"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.spring.samples.NumberGuess"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"randomNumber"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{ T(java.lang.Math).random() * 100.0 }"</span>/&gt;

    &lt;<span class="hl-comment">!-- other properties --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The variable 'systemProperties' is predefined, so you can use it
      in your expressions as shown below. Note that you do not have to prefix
      the predefined variable with the '#' symbol in this context.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"taxCalculator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.spring.samples.TaxCalculator"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"defaultLocale"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{ systemProperties['user.region'] }"</span>/&gt;

    &lt;<span class="hl-comment">!-- other properties --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>You can also refer to other bean properties by name, for
      example.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"numberGuess"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.spring.samples.NumberGuess"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"randomNumber"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{ T(java.lang.Math).random() * 100.0 }"</span>/&gt;

    &lt;<span class="hl-comment">!-- other properties --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;


&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"shapeGuess"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.spring.samples.ShapeGuess"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"initialShapeSeed"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{ numberGuess.randomNumber }"</span>/&gt;

    &lt;<span class="hl-comment">!-- other properties --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-beandef-annotation-based"></a>7.4.2&nbsp;Annotation-based configuration</h3></div></div></div><p>The <code class="literal">@Value</code> annotation can be placed on fields,
      methods and method/constructor parameters to specify a default
      value.</p><p>Here is an example to set the default value of a field
      variable.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> FieldValueTestBean

  @Value(<span class="hl-string">"#{ systemProperties['user.region'] }"</span>)
  <span class="hl-keyword">private</span> String defaultLocale;

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDefaultLocale(String defaultLocale)
  {
    <span class="hl-keyword">this</span>.defaultLocale = defaultLocale;
  }

  <span class="hl-keyword">public</span> String getDefaultLocale() 
  {
    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.defaultLocale;
  }

}

</pre><p>The equivalent but on a property setter method is shown
      below.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> PropertyValueTestBean

  <span class="hl-keyword">private</span> String defaultLocale;

  @Value(<span class="hl-string">"#{ systemProperties['user.region'] }"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDefaultLocale(String defaultLocale)
  {
    <span class="hl-keyword">this</span>.defaultLocale = defaultLocale;
  }

  <span class="hl-keyword">public</span> String getDefaultLocale() 
  {
    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.defaultLocale;
  }

}</pre><p>Autowired methods and constructors can also use the
      <code class="literal">@Value</code> annotation.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

  <span class="hl-keyword">private</span> MovieFinder movieFinder;
  <span class="hl-keyword">private</span> String defaultLocale;

  @Autowired
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configure(MovieFinder movieFinder, 
                        @Value(<span class="hl-string">"#{ systemProperties['user.region'] }"</span>} String defaultLocale) {
      <span class="hl-keyword">this</span>.movieFinder = movieFinder;
      <span class="hl-keyword">this</span>.defaultLocale = defaultLocale;
  }

  <span class="hl-comment">// ...</span>
}</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

  <span class="hl-keyword">private</span> String defaultLocale;

  <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

  @Autowired
  <span class="hl-keyword">public</span> MovieRecommender(CustomerPreferenceDao customerPreferenceDao,
                          @Value(<span class="hl-string">"#{systemProperties['user.country']}"</span>} String defaultLocale) {
      <span class="hl-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;
      <span class="hl-keyword">this</span>.defaultLocale = defaultLocale;
  }

  <span class="hl-comment">// ...</span>
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="expressions-language-ref"></a>7.5&nbsp;Language Reference</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-ref-literal"></a>7.5.1&nbsp;Literal expressions</h3></div></div></div><p>The types of literal expressions supported are strings, dates,
      numeric values (int, real, and hex), boolean and null. Strings are
      delimited by single quotes. To put a single quote itself in a string use
      two single quote characters. The following listing shows simple usage of
      literals. Typically they would not be used in isolation like this, but
      as part of a more complex expression, for example using a literal on one
      side of a logical comparison operator.</p><pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

<span class="hl-comment">// evals to "Hello World"</span>
String helloWorld = (String) parser.parseExpression(<span class="hl-string">"'Hello World'"</span>).getValue(); 

<span class="hl-keyword">double</span> avogadrosNumber  = (Double) parser.parseExpression(<span class="hl-string">"6.0221415E+23"</span>).getValue();  

<span class="hl-comment">// evals to 2147483647</span>
<span class="hl-keyword">int</span> maxValue = (Integer) parser.parseExpression(<span class="hl-string">"0x7FFFFFFF"</span>).getValue();  

<span class="hl-keyword">boolean</span> trueValue = (Boolean) parser.parseExpression(<span class="hl-string">"true"</span>).getValue();

Object nullValue = parser.parseExpression(<span class="hl-string">"null"</span>).getValue();
</pre><p>Numbers support the use of the negative sign, exponential
      notation, and decimal points. By default real numbers are parsed using
      Double.parseDouble().</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12686"></a>7.5.2&nbsp;Properties, Arrays, Lists, Maps, Indexers</h3></div></div></div><p>Navigating with property references is easy, just use a period to
      indicate a nested property value. The instances of Inventor class, pupin
      and tesla, were populated with data listed in the section <a class="link" href="#expressions-example-classes" title="7.6&nbsp;Classes used in the examples">Classes used in the
      examples</a>. To navigate "down" and get Tesla's year of birth and
      Pupin's city of birth the following expressions are used.</p><pre class="programlisting"><span class="hl-comment">// evals to 1856</span>
<span class="hl-keyword">int</span> year = (Integer) parser.parseExpression(<span class="hl-string">"Birthdate.Year + 1900"</span>).getValue(context); 


String city = (String) parser.parseExpression(<span class="hl-string">"placeOfBirth.City"</span>).getValue(context);</pre><p>Case insensitivity is allowed for the first letter of property
      names. The contents of arrays and lists are obtained using square
      bracket notation.</p><pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

<span class="hl-comment">// Inventions Array</span>
StandardEvaluationContext teslaContext = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);

<span class="hl-comment">// evaluates to "Induction motor"</span>
String invention = parser.parseExpression(<span class="hl-string">"inventions[3]"</span>).getValue(teslaContext, 
                                                                    String.<span class="hl-keyword">class</span>); 


<span class="hl-comment">// Members List</span>
StandardEvaluationContext societyContext = <span class="hl-keyword">new</span> StandardEvaluationContext(ieee);

<span class="hl-comment">// evaluates to "Nikola Tesla"</span>
String name = parser.parseExpression(<span class="hl-string">"Members[0].Name"</span>).getValue(societyContext, String.<span class="hl-keyword">class</span>);

<span class="hl-comment">// List and Array navigation</span>
<span class="hl-comment">// evaluates to "Wireless communication"</span>
String invention = parser.parseExpression(<span class="hl-string">"Members[0].Inventions[6]"</span>).getValue(societyContext,
                                                                               String.<span class="hl-keyword">class</span>);
</pre><p>The contents of maps are obtained by specifying the literal key
      value within the brackets. In this case, because keys for the Officers
      map are strings, we can specify string literals.</p><pre class="programlisting"><span class="hl-comment">// Officer's Dictionary</span>

Inventor pupin = parser.parseExpression(<span class="hl-string">"Officers['president']"</span>).getValue(societyContext, 
                                                                          Inventor.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to "Idvor"</span>
String city = 
    parser.parseExpression(<span class="hl-string">"Officers['president'].PlaceOfBirth.City"</span>).getValue(societyContext,
                                                                               String.<span class="hl-keyword">class</span>);

<span class="hl-comment">// setting values</span>
parser.parseExpression(<span class="hl-string">"Officers['advisors'][0].PlaceOfBirth.Country"</span>).setValue(societyContext,
                                                                                <span class="hl-string">"Croatia"</span>);

</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12704"></a>7.5.3&nbsp;Inline lists</h3></div></div></div><p>Lists can be expressed directly in an expression using {} notation.
      </p><pre class="programlisting">
<span class="hl-comment">// evaluates to a Java list containing the four numbers</span>
List numbers = (List) parser.parseExpression(<span class="hl-string">"{1,2,3,4}"</span>).getValue(context); 

List listOfLists = (List) parser.parseExpression(<span class="hl-string">"{{'a','b'},{'x','y'}}"</span>).getValue(context); 
</pre><p>{} by itself means an empty list.  For performance reasons, if the
      list is itself entirely composed of fixed literals then a constant list is created
      to represent the expression, rather than building a new list on each evaluation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12713"></a>7.5.4&nbsp;Array construction</h3></div></div></div><p>Arrays can be built using the familiar Java syntax, optionally
      supplying an initializer to have the array populated at construction time.
      </p><pre class="programlisting"><span class="hl-keyword">int</span>[] numbers1 = (<span class="hl-keyword">int</span>[]) parser.parseExpression(<span class="hl-string">"new int[4]"</span>).getValue(context); 

<span class="hl-comment">// Array with initializer</span>
<span class="hl-keyword">int</span>[] numbers2 = (<span class="hl-keyword">int</span>[]) parser.parseExpression(<span class="hl-string">"new int[]{1,2,3}"</span>).getValue(context); 

<span class="hl-comment">// Multi dimensional array</span>
<span class="hl-keyword">int</span>[][] numbers3 = (<span class="hl-keyword">int</span>[][]) parser.parseExpression(<span class="hl-string">"new int[4][5]"</span>).getValue(context); 
</pre><p>It is not currently allowed to supply an initializer when constructing
      a multi-dimensional array.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12722"></a>7.5.5&nbsp;Methods</h3></div></div></div><p>Methods are invoked using typical Java programming syntax. You may
      also invoke methods on literals. Varargs are also supported.</p><pre class="programlisting"><span class="hl-comment">// string literal, evaluates to "bc"</span>
String c = parser.parseExpression(<span class="hl-string">"'abc'.substring(2, 3)"</span>).getValue(String.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> isMember = parser.parseExpression(<span class="hl-string">"isMember('Mihajlo Pupin')"</span>).getValue(societyContext,
                                                                                Boolean.<span class="hl-keyword">class</span>);</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12729"></a>7.5.6&nbsp;Operators</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e12732"></a>7.5.6.1&nbsp;Relational operators</h4></div></div></div><p>The relational operators; equal, not equal, less than, less than
        or equal, greater than, and greater than or equal are supported using
        standard operator notation.</p><pre class="programlisting"><span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(<span class="hl-string">"2 == 2"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(<span class="hl-string">"2 &lt; -5.0"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(<span class="hl-string">"'black' &lt; 'block'"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);</pre><p>
        In addition to standard relational operators SpEL supports the
        'instanceof' and regular expression based 'matches' operator.</p><pre class="programlisting"><span class="hl-comment">// evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(<span class="hl-string">"'xyz' instanceof T(int)"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> trueValue = 
     parser.parseExpression(<span class="hl-string">"'5.00' matches '^-?\\d+(\\.\\d{2})?$'"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">//evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = 
     parser.parseExpression(<span class="hl-string">"'5.0067' matches '^-?\\d+(\\.\\d{2})?$'"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

</pre><p>Each symbolic operator can also be specified as a purely alphabetic equivalent.  This avoids
      problems where the symbols used have special meaning for the document type in which 
      the expression is embedded (eg. an XML document).  The textual equivalents are shown
      here: lt ('&lt;'), gt ('&gt;'), le ('&lt;='), ge ('&gt;='),
      eq ('=='), ne ('!='), div ('/'), mod ('%'), not ('!').
      These are case insensitive.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e12745"></a>7.5.6.2&nbsp;Logical operators</h4></div></div></div><p>The logical operators that are supported are and, or, and not.
        Their use is demonstrated below.</p><pre class="programlisting"><span class="hl-comment">// -- AND --</span>

<span class="hl-comment">// evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(<span class="hl-string">"true and false"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
String expression =  <span class="hl-string">"isMember('Nikola Tesla') and isMember('Mihajlo Pupin')"</span>;
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(expression).getValue(societyContext, Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// -- OR --</span>

<span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(<span class="hl-string">"true or false"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
String expression =  <span class="hl-string">"isMember('Nikola Tesla') or isMember('Albert Einstien')"</span>;
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(expression).getValue(societyContext, Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// -- NOT --</span>

<span class="hl-comment">// evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(<span class="hl-string">"!true"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);


<span class="hl-comment">// -- AND and NOT --</span>
String expression =  <span class="hl-string">"isMember('Nikola Tesla') and !isMember('Mihajlo Pupin')"</span>;
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(expression).getValue(societyContext, Boolean.<span class="hl-keyword">class</span>);</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e12753"></a>7.5.6.3&nbsp;Mathematical operators</h4></div></div></div><p>The addition operator can be used on numbers, strings and dates.
        Subtraction can be used on numbers and dates. Multiplication and
        division can be used only on numbers. Other mathematical operators
        supported are modulus (%) and exponential power (^). Standard operator
        precedence is enforced. These operators are demonstrated below.</p><pre class="programlisting"><span class="hl-comment">// Addition</span>
<span class="hl-keyword">int</span> two = parser.parseExpression(<span class="hl-string">"1 + 1"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 2</span>

String testString = 
   parser.parseExpression(<span class="hl-string">"'test' + ' ' + 'string'"</span>).getValue(String.<span class="hl-keyword">class</span>);  <span class="hl-comment">// 'test string'</span>

<span class="hl-comment">// Subtraction</span>
<span class="hl-keyword">int</span> four =  parser.parseExpression(<span class="hl-string">"1 - -3"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 4</span>

<span class="hl-keyword">double</span> d = parser.parseExpression(<span class="hl-string">"1000.00 - 1e4"</span>).getValue(Double.<span class="hl-keyword">class</span>); <span class="hl-comment">// -9000</span>

<span class="hl-comment">// Multiplication</span>
<span class="hl-keyword">int</span> six =  parser.parseExpression(<span class="hl-string">"-2 * -3"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 6</span>

<span class="hl-keyword">double</span> twentyFour = parser.parseExpression(<span class="hl-string">"2.0 * 3e0 * 4"</span>).getValue(Double.<span class="hl-keyword">class</span>); <span class="hl-comment">// 24.0</span>

<span class="hl-comment">// Division</span>
<span class="hl-keyword">int</span> minusTwo =  parser.parseExpression(<span class="hl-string">"6 / -3"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// -2</span>

<span class="hl-keyword">double</span> one = parser.parseExpression(<span class="hl-string">"8.0 / 4e0 / 2"</span>).getValue(Double.<span class="hl-keyword">class</span>); <span class="hl-comment">// 1.0</span>

<span class="hl-comment">// Modulus</span>
<span class="hl-keyword">int</span> three =  parser.parseExpression(<span class="hl-string">"7 % 4"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 3</span>

<span class="hl-keyword">int</span> one = parser.parseExpression(<span class="hl-string">"8 / 5 % 2"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 1</span>

<span class="hl-comment">// Operator precedence</span>
<span class="hl-keyword">int</span> minusTwentyOne = parser.parseExpression(<span class="hl-string">"1+2-3*8"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// -21</span>
</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12761"></a>7.5.7&nbsp;Assignment</h3></div></div></div><p>Setting of a property is done by using the assignment operator.
      This would typically be done within a call to
      <code class="literal">setValue</code> but can also be done inside a call to
      <code class="literal">getValue</code>.</p><pre class="programlisting">Inventor inventor = <span class="hl-keyword">new</span> Inventor();		
StandardEvaluationContext inventorContext = <span class="hl-keyword">new</span> StandardEvaluationContext(inventor);

parser.parseExpression(<span class="hl-string">"Name"</span>).setValue(inventorContext, <span class="hl-string">"Alexander Seovic2"</span>);

<span class="hl-comment">// alternatively</span>

String aleks = parser.parseExpression(<span class="hl-string">"Name = 'Alexandar Seovic'"</span>).getValue(inventorContext, 
                                                                            String.<span class="hl-keyword">class</span>);
</pre><p></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12775"></a>7.5.8&nbsp;Types</h3></div></div></div><p>The special 'T' operator can be used to specify an instance of
      java.lang.Class (the 'type'). Static methods are invoked using this
      operator as well. The <code class="classname">StandardEvaluationContext</code>
      uses a <code class="classname">TypeLocator</code> to find types and the
      <code class="classname">StandardTypeLocator</code> (which can be replaced) is
      built with an understanding of the java.lang package. This means T()
      references to types within java.lang do not need to be fully qualified,
      but all other type references must be.</p><pre class="programlisting">Class dateClass = parser.parseExpression(<span class="hl-string">"T(java.util.Date)"</span>).getValue(Class.<span class="hl-keyword">class</span>);

Class stringClass = parser.parseExpression(<span class="hl-string">"T(String)"</span>).getValue(Class.<span class="hl-keyword">class</span>);

<span class="hl-keyword">boolean</span> trueValue = 
   parser.parseExpression(<span class="hl-string">"T(java.math.RoundingMode).CEILING &lt; T(java.math.RoundingMode).FLOOR"</span>)
  .getValue(Boolean.<span class="hl-keyword">class</span>);
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12791"></a>7.5.9&nbsp;Constructors</h3></div></div></div><p>Constructors can be invoked using the new operator. The fully
      qualified class name should be used for all but the primitive type and
      String (where int, float, etc, can be used).</p><pre class="programlisting">Inventor einstein = 
  p.parseExpression(<span class="hl-string">"new org.spring.samples.spel.inventor.Inventor('Albert Einstein', 
                                                                   'German')"</span>)
                                                                   .getValue(Inventor.<span class="hl-keyword">class</span>);

<span class="hl-comment">//create new inventor instance within add method of List</span>
p.parseExpression(<span class="hl-string">"Members.add(new org.spring.samples.spel.inventor.Inventor('Albert Einstein',
                                                                   'German'))"</span>)
                                                                   .getValue(societyContext);
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-ref-variables"></a>7.5.10&nbsp;Variables</h3></div></div></div><p>Variables can be referenced in the expression using the syntax
      #variableName. Variables are set using the method setVariable on the
      StandardEvaluationContext.</p><pre class="programlisting">Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">"Nikola Tesla"</span>, <span class="hl-string">"Serbian"</span>);
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);
context.setVariable(<span class="hl-string">"newName"</span>, <span class="hl-string">"Mike Tesla"</span>);

parser.parseExpression(<span class="hl-string">"Name = #newName"</span>).getValue(context);

System.out.println(tesla.getName()) <span class="hl-comment">// "Mike Tesla"</span></pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e12805"></a>7.5.10.1&nbsp;The #this and #root variables</h4></div></div></div><p>The variable #this is always defined and refers to the current
        evaluation object (against which unqualified references are resolved).
        The variable #root is always defined and refers to the root
        context object.  Although #this may vary as components of an expression
        are evaluated, #root always refers to the root.</p><pre class="programlisting"><span class="hl-comment">// create an array of integers</span>
List&lt;Integer&gt; primes = <span class="hl-keyword">new</span> ArrayList&lt;Integer&gt;();
primes.addAll(Arrays.asList(2,3,5,7,11,13,17));

<span class="hl-comment">// create parser and set variable 'primes' as the array of integers</span>
ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext();
context.setVariable(<span class="hl-string">"primes"</span>,primes);

<span class="hl-comment">// all prime numbers &gt; 10 from the list (using selection ?{...})</span>
<span class="hl-comment">// evaluates to [11, 13, 17]</span>
List&lt;Integer&gt; primesGreaterThanTen = 
             (List&lt;Integer&gt;) parser.parseExpression(<span class="hl-string">"#primes.?[#this&gt;10]"</span>).getValue(context);

</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-ref-functions"></a>7.5.11&nbsp;Functions</h3></div></div></div><p>You can extend SpEL by registering user defined functions that can
      be called within the expression string. The function is registered with
      the <code class="classname">StandardEvaluationContext</code> using the
      method.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> registerFunction(String name, Method m)</pre><p>A reference to a Java Method provides the implementation of the
      function. For example, a utility method to reverse a string is shown
      below.</p><pre class="programlisting">public abstract class StringUtils {

  public static String reverseString(String input) {
    StringBuilder backwards = new StringBuilder();
    for (int i = 0; i &lt; input.length(); i++) 
      backwards.append(input.charAt(input.length() - 1 - i));
    }
    return backwards.toString();
  }
}</pre><p>This method is then registered with the evaluation context and can
      be used within an expression string.</p><pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext();

context.registerFunction(<span class="hl-string">"reverseString"</span>, 
                         StringUtils.<span class="hl-keyword">class</span>.getDeclaredMethod(<span class="hl-string">"reverseString"</span>, 
                                                             <span class="hl-keyword">new</span> Class[] { String.<span class="hl-keyword">class</span> }));

String helloWorldReversed = 
          parser.parseExpression(<span class="hl-string">"#reverseString('hello')"</span>).getValue(context, String.<span class="hl-keyword">class</span>);</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12831"></a>7.5.12&nbsp;Bean references</h3></div></div></div><p>If the evaluation context has been configured with a bean resolver it is possible to
    	lookup beans from an expression using the (@) symbol.
    	</p><pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext();
context.setBeanResolver(<span class="hl-keyword">new</span> MyBeanResolver());

<span class="hl-comment">// This will end up calling resolve(context,"foo") on MyBeanResolver during evaluation</span>
Object bean = parser.parseExpression(<span class="hl-string">"@foo"</span>).getValue(context);</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12838"></a>7.5.13&nbsp;Ternary Operator (If-Then-Else)</h3></div></div></div><p>You can use the ternary operator for performing if-then-else
      conditional logic inside the expression. A minimal example is:</p><pre class="programlisting">String falseString = 
             parser.parseExpression(<span class="hl-string">"false ? 'trueExp' : 'falseExp'"</span>).getValue(String.<span class="hl-keyword">class</span>);</pre><p>In this case, the boolean false results in returning the string
      value 'falseExp'. A more realistic example is shown below.</p><pre class="programlisting">parser.parseExpression(<span class="hl-string">"Name"</span>).setValue(societyContext, <span class="hl-string">"IEEE"</span>);
societyContext.setVariable(<span class="hl-string">"queryName"</span>, <span class="hl-string">"Nikola Tesla"</span>);

expression = <span class="hl-string">"isMember(#queryName)? #queryName + ' is a member of the ' "</span> + 
             <span class="hl-string">"+ Name + ' Society' : #queryName + ' is not a member of the ' + Name + ' Society'"</span>;

String queryResultString = 
                    parser.parseExpression(expression).getValue(societyContext, String.<span class="hl-keyword">class</span>);
<span class="hl-comment">// queryResultString = "Nikola Tesla is a member of the IEEE Society"</span></pre><p>Also see the next section on the Elvis operator for an even
      shorter syntax for the ternary operator.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12851"></a>7.5.14&nbsp;The Elvis Operator</h3></div></div></div><p>The Elvis operator is a shortening of the ternary operator syntax
      and is used in the <a class="ulink" href="http://groovy.codehaus.org/Operators#Operators-ElvisOperator(%3F%3A)" target="_top">Groovy</a>
      language. With the ternary operator syntax you usually have to repeat a
      variable twice, for example:</p><pre class="programlisting">String name = "Elvis Presley";
String displayName = name != null ? name : "Unknown";</pre><p>Instead you can use the Elvis operator, named for the resemblance
      to Elvis' hair style.</p><pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

String name = parser.parseExpression(<span class="hl-string">"null?:'Unknown'"</span>).getValue(String.<span class="hl-keyword">class</span>);

System.out.println(name);  <span class="hl-comment">// 'Unknown'</span>

</pre><p>Here is a more complex example.</p><pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">"Nikola Tesla"</span>, <span class="hl-string">"Serbian"</span>);
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);

String name = parser.parseExpression(<span class="hl-string">"Name?:'Elvis Presley'"</span>).getValue(context, String.<span class="hl-keyword">class</span>);

System.out.println(name); <span class="hl-comment">// Mike Tesla</span>

tesla.setName(null);

name = parser.parseExpression(<span class="hl-string">"Name?:'Elvis Presley'"</span>).getValue(context, String.<span class="hl-keyword">class</span>);

System.out.println(name); <span class="hl-comment">// Elvis Presley</span></pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12869"></a>7.5.15&nbsp;Safe Navigation operator</h3></div></div></div><p>The Safe Navigation operator is used to avoid a
      <code class="literal">NullPointerException</code> and comes from the <a class="ulink" href="http://groovy.codehaus.org/Operators#Operators-SafeNavigationOperator(%3F.)" target="_top">Groovy</a>
      language. Typically when you have a reference to an object you might
      need to verify that it is not null before accessing methods or
      properties of the object. To avoid this, the safe navigation operator
      will simply return null instead of throwing an exception.</p><pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">"Nikola Tesla"</span>, <span class="hl-string">"Serbian"</span>);
tesla.setPlaceOfBirth(<span class="hl-keyword">new</span> PlaceOfBirth(<span class="hl-string">"Smiljan"</span>));

StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);

String city = parser.parseExpression(<span class="hl-string">"PlaceOfBirth?.City"</span>).getValue(context, String.<span class="hl-keyword">class</span>);
System.out.println(city); <span class="hl-comment">// Smiljan</span>

tesla.setPlaceOfBirth(null);

city = parser.parseExpression(<span class="hl-string">"PlaceOfBirth?.City"</span>).getValue(context, String.<span class="hl-keyword">class</span>);

System.out.println(city); <span class="hl-comment">// null - does not throw NullPointerException!!!</span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The Elvis operator can be used to apply default values in
        expressions, e.g. in an <code class="interfacename">@Value</code> expression:</p><pre class="programlisting">@Value("#{systemProperties['pop3.port'] ?: 25}")</pre><p>This will inject a system property <code class="code">pop3.port</code> if it
        is defined or 25 if not.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12895"></a>7.5.16&nbsp;Collection Selection</h3></div></div></div><p>Selection is a powerful expression language feature that allows you
      to transform some source collection into another by selecting from its
      entries.</p><p>Selection uses the syntax
      <code class="literal">?[selectionExpression]</code>. This will filter the
      collection and return a new collection containing a subset of the
      original elements. For example, selection would allow us to easily get a
      list of Serbian inventors:</p><pre class="programlisting">List&lt;Inventor&gt; list = (List&lt;Inventor&gt;) 
      parser.parseExpression(<span class="hl-string">"Members.?[Nationality == 'Serbian']"</span>).getValue(societyContext);</pre><p>Selection is possible upon both lists and maps. In the former case
      the selection criteria is evaluated against each individual list element
      whilst against a map the selection criteria is evaluated against each
      map entry (objects of the Java type <code class="literal">Map.Entry</code>). Map
      entries have their key and value accessible as properties for use in the
      selection.</p><p>This expression will return a new map consisting of those elements
      of the original map where the entry value is less than 27.</p><pre class="programlisting">Map newMap = parser.parseExpression(<span class="hl-string">"map.?[value&lt;27]"</span>).getValue();</pre><p>In addition to returning all the selected elements, it is possible
      to retrieve just the first or the last value. To obtain the first entry
      matching the selection the syntax is <code class="literal">^[...]</code> whilst to
      obtain the last matching selection the syntax is
      <code class="literal">$[...]</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12924"></a>7.5.17&nbsp;Collection Projection</h3></div></div></div><p>Projection allows a collection to drive the evaluation of a
      sub-expression and the result is a new collection. The syntax for
      projection is <code class="literal">![projectionExpression]</code>. Most easily
      understood by example, suppose we have a list of inventors but want the
      list of cities where they were born. Effectively we want to evaluate
      'placeOfBirth.city' for every entry in the inventor list. Using
      projection:</p><pre class="programlisting"><span class="hl-comment">// returns [ 'Smiljan', 'Idvor' ]</span>
List placesOfBirth = (List)parser.parseExpression(<span class="hl-string">"Members.![placeOfBirth.city]"</span>);</pre><p>A map can also be used to drive projection and in this case the
      projection expression is evaluated against each entry in the map
      (represented as a Java <code class="literal">Map.Entry</code>). The result of a
      projection across a map is a list consisting of the evaluation of the
      projection expression against each map entry.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12939"></a>7.5.18&nbsp;Expression templating</h3></div></div></div><p>Expression templates allow a mixing of literal text with one or
      more evaluation blocks. Each evaluation block is delimited with prefix
      and suffix characters that you can define, a common choice is to use
      <code class="literal">#{ }</code> as the delimiters. For example,</p><pre class="programlisting">String randomPhrase = 
   parser.parseExpression(<span class="hl-string">"random number is #{T(java.lang.Math).random()}"</span>, 
                          <span class="hl-keyword">new</span> TemplateParserContext()).getValue(String.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to "random number is 0.7038186818312008"</span></pre><p>The string is evaluated by concatenating the literal text 'random
      number is ' with the result of evaluating the expression inside the #{ }
      delimiter, in this case the result of calling that random() method. The
      second argument to the method <code class="literal">parseExpression()</code> is of
      the type <code class="interfacename">ParserContext</code>. The
      <code class="interfacename">ParserContext</code> interface is used to
      influence how the expression is parsed in order to support the
      expression templating functionality. The definition of
      <code class="classname">TemplateParserContext</code> is shown below.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TemplateParserContext <span class="hl-keyword">implements</span> ParserContext {

  <span class="hl-keyword">public</span> String getExpressionPrefix() {
    <span class="hl-keyword">return</span> <span class="hl-string">"#{"</span>;
  }

  <span class="hl-keyword">public</span> String getExpressionSuffix() {
    <span class="hl-keyword">return</span> <span class="hl-string">"}"</span>;
  }
  
  <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> isTemplate() {
    <span class="hl-keyword">return</span> true;
  }
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="expressions-example-classes"></a>7.6&nbsp;Classes used in the examples</h2></div></div></div><p>Inventor.java</p><pre class="programlisting"><span class="hl-keyword">package</span> org.spring.samples.spel.inventor;

<span class="hl-keyword">import</span> java.util.Date;
<span class="hl-keyword">import</span> java.util.GregorianCalendar;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Inventor {

  <span class="hl-keyword">private</span> String name;
  <span class="hl-keyword">private</span> String nationality;
  <span class="hl-keyword">private</span> String[] inventions;
  <span class="hl-keyword">private</span> Date birthdate;
  <span class="hl-keyword">private</span> PlaceOfBirth placeOfBirth;
  
  
  <span class="hl-keyword">public</span> Inventor(String name, String nationality)
  {
    GregorianCalendar c= <span class="hl-keyword">new</span> GregorianCalendar();
    <span class="hl-keyword">this</span>.name = name;
    <span class="hl-keyword">this</span>.nationality = nationality;
    <span class="hl-keyword">this</span>.birthdate = c.getTime();
  }
  <span class="hl-keyword">public</span> Inventor(String name, Date birthdate, String nationality) {
    <span class="hl-keyword">this</span>.name = name;
    <span class="hl-keyword">this</span>.nationality = nationality;
    <span class="hl-keyword">this</span>.birthdate = birthdate;
  }
  
  <span class="hl-keyword">public</span> Inventor() {
  }

  <span class="hl-keyword">public</span> String getName() {
    <span class="hl-keyword">return</span> name;
  }
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
    <span class="hl-keyword">this</span>.name = name;
  }
  <span class="hl-keyword">public</span> String getNationality() {
    <span class="hl-keyword">return</span> nationality;
  }
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setNationality(String nationality) {
    <span class="hl-keyword">this</span>.nationality = nationality;
  }
  <span class="hl-keyword">public</span> Date getBirthdate() {
    <span class="hl-keyword">return</span> birthdate;
  }
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBirthdate(Date birthdate) {
    <span class="hl-keyword">this</span>.birthdate = birthdate;
  }
  <span class="hl-keyword">public</span> PlaceOfBirth getPlaceOfBirth() {
    <span class="hl-keyword">return</span> placeOfBirth;
  }
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setPlaceOfBirth(PlaceOfBirth placeOfBirth) {
    <span class="hl-keyword">this</span>.placeOfBirth = placeOfBirth;
  }
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setInventions(String[] inventions) {
    <span class="hl-keyword">this</span>.inventions = inventions;
  }
  <span class="hl-keyword">public</span> String[] getInventions() {
    <span class="hl-keyword">return</span> inventions;
  }       
}
</pre><p>PlaceOfBirth.java</p><pre class="programlisting"><span class="hl-keyword">package</span> org.spring.samples.spel.inventor;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PlaceOfBirth {

	<span class="hl-keyword">private</span> String city;
	<span class="hl-keyword">private</span> String country;
	
	<span class="hl-keyword">public</span> PlaceOfBirth(String city) {
		<span class="hl-keyword">this</span>.city=city;
	}
	<span class="hl-keyword">public</span> PlaceOfBirth(String city, String country)
	{
		<span class="hl-keyword">this</span>(city);
		<span class="hl-keyword">this</span>.country = country;
	}
	
	
	<span class="hl-keyword">public</span> String getCity() {
		<span class="hl-keyword">return</span> city;
	}
	<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setCity(String s) {
		<span class="hl-keyword">this</span>.city = s;
	}
	<span class="hl-keyword">public</span> String getCountry() {
		<span class="hl-keyword">return</span> country;
	}
	<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setCountry(String country) {
		<span class="hl-keyword">this</span>.country = country;
	}

	
	
}
</pre><p>Society.java</p><pre class="programlisting"><span class="hl-keyword">package</span> org.spring.samples.spel.inventor;

<span class="hl-keyword">import</span> java.util.*;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Society {

	<span class="hl-keyword">private</span> String name;
	
	<span class="hl-keyword">public</span> <span class="hl-keyword">static</span> String Advisors = <span class="hl-string">"advisors"</span>;
	<span class="hl-keyword">public</span> <span class="hl-keyword">static</span> String President = <span class="hl-string">"president"</span>;
	
	<span class="hl-keyword">private</span> List&lt;Inventor&gt; members = <span class="hl-keyword">new</span> ArrayList&lt;Inventor&gt;();
	<span class="hl-keyword">private</span> Map officers = <span class="hl-keyword">new</span> HashMap();

	<span class="hl-keyword">public</span> List getMembers() {
		<span class="hl-keyword">return</span> members;
	}

	<span class="hl-keyword">public</span> Map getOfficers() {
		<span class="hl-keyword">return</span> officers;
	}

	<span class="hl-keyword">public</span> String getName() {
		<span class="hl-keyword">return</span> name;
	}

	<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
		<span class="hl-keyword">this</span>.name = name;
	}

	<span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> isMember(String name)
	{
		<span class="hl-keyword">boolean</span> found = false;
		<span class="hl-keyword">for</span> (Inventor inventor : members) {
			<span class="hl-keyword">if</span> (inventor.getName().equals(name))
			{
				found = true;
				<span class="hl-keyword">break</span>;
			}
		}		
		<span class="hl-keyword">return</span> found;
	}

	
}
</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="aop"></a>8.&nbsp;Aspect Oriented Programming with Spring</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-introduction"></a>8.1&nbsp;Introduction</h2></div></div></div><p><span class="emphasis"><em>Aspect-Oriented Programming</em></span> (AOP) complements
    Object-Oriented Programming (OOP) by providing another way of thinking
    about program structure. The key unit of modularity in OOP is the class,
    whereas in AOP the unit of modularity is the <span class="emphasis"><em>aspect</em></span>.
    Aspects enable the modularization of concerns such as transaction
    management that cut across multiple types and objects. (Such concerns are
    often termed <span class="emphasis"><em>crosscutting</em></span> concerns in AOP
    literature.)</p><p>One of the key components of Spring is the <span class="emphasis"><em>AOP
    framework</em></span>. While the Spring IoC container does not depend on
    AOP, meaning you do not need to use AOP if you don't want to, AOP
    complements Spring IoC to provide a very capable middleware
    solution.</p><div class="sidebar"><p class="title"><b>Spring 2.0 AOP</b></p><p>Spring 2.0 introduces a simpler and more powerful way of writing
      custom aspects using either a <a class="link" href="#aop-schema" title="8.3&nbsp;Schema-based AOP support">schema-based
      approach</a> or the <a class="link" href="#aop-ataspectj" title="8.2&nbsp;@AspectJ support">@AspectJ annotation
      style</a>. Both of these styles offer fully typed advice and use of
      the AspectJ pointcut language, while still using Spring AOP for
      weaving.</p><p>The Spring 2.0 schema- and @AspectJ-based AOP support is discussed
      in this chapter. Spring 2.0 AOP remains fully backwards compatible with
      Spring 1.2 AOP, and the lower-level AOP support offered by the Spring
      1.2 APIs is discussed in <a class="link" href="#aop-api" title="9.&nbsp;Spring AOP APIs">the following
      chapter</a>.</p></div><p>AOP is used in the Spring Framework to...</p><div class="itemizedlist"><ul type="disc"><li><p>... provide declarative enterprise services, especially as a
        replacement for EJB declarative services. The most important such
        service is <a class="link" href="#transaction-declarative" title="11.5&nbsp;Declarative transaction management"><span class="emphasis"><em>declarative transaction
        management</em></span></a>.</p></li><li><p>... allow users to implement custom aspects, complementing their
        use of OOP with AOP.</p></li></ul></div><p class="remark"><i><span class="remark"><p>If you are interested only in generic declarative services
    or other pre-packaged declarative middleware services such as pooling, you
    do not need to work directly with Spring AOP, and can skip most of this
    chapter. </p></span></i></p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-introduction-defn"></a>8.1.1&nbsp;AOP concepts</h3></div></div></div><p>Let us begin by defining some central AOP concepts and
      terminology. These terms are not Spring-specific... unfortunately, AOP
      terminology is not particularly intuitive; however, it would be even
      more confusing if Spring used its own terminology.</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>Aspect</em></span>: a modularization of a concern
          that cuts across multiple classes. Transaction management is a good
          example of a crosscutting concern in enterprise Java applications.
          In Spring AOP, aspects are implemented using regular classes (the
          <a class="link" href="#aop-schema" title="8.3&nbsp;Schema-based AOP support">schema-based approach</a>) or regular
          classes annotated with the <code class="interfacename">@Aspect</code>
          annotation (the <a class="link" href="#aop-ataspectj" title="8.2&nbsp;@AspectJ support"><code class="interfacename">@AspectJ</code>
          style</a>).</p></li><li><p><span class="emphasis"><em>Join point</em></span>: a point during the execution
          of a program, such as the execution of a method or the handling of
          an exception. In Spring AOP, a join point
          <span class="emphasis"><em>always</em></span> represents a method execution.</p></li><li><p><span class="emphasis"><em>Advice</em></span>: action taken by an aspect at a
          particular join point. Different types of advice include "around,"
          "before" and "after" advice. (Advice types are discussed below.)
          Many AOP frameworks, including Spring, model an advice as an
          <span class="emphasis"><em>interceptor</em></span>, maintaining a chain of
          interceptors <span class="emphasis"><em>around</em></span> the join point.</p></li><li><p><span class="emphasis"><em>Pointcut</em></span>: a predicate that matches join
          points. Advice is associated with a pointcut expression and runs at
          any join point matched by the pointcut (for example, the execution
          of a method with a certain name). The concept of join points as
          matched by pointcut expressions is central to AOP, and Spring uses
          the AspectJ pointcut expression language by default.</p></li><li><p><span class="emphasis"><em>Introduction</em></span>: declaring additional
          methods or fields on behalf of a type. Spring AOP allows you to
          introduce new interfaces (and a corresponding implementation) to any
          advised object. For example, you could use an introduction to make a
          bean implement an <code class="interfacename">IsModified</code>
          interface, to simplify caching. (An introduction is known as an
          inter-type declaration in the AspectJ community.)</p></li><li><p><span class="emphasis"><em>Target object</em></span>: object being advised by
          one or more aspects. Also referred to as the
          <span class="emphasis"><em>advised</em></span> object. Since Spring AOP is implemented
          using runtime proxies, this object will always be a
          <span class="emphasis"><em>proxied</em></span> object.</p></li><li><p><span class="emphasis"><em>AOP proxy</em></span>: an object created by the AOP
          framework in order to implement the aspect contracts (advise method
          executions and so on). In the Spring Framework, an AOP proxy will be
          a JDK dynamic proxy or a CGLIB proxy.</p></li><li><p><span class="emphasis"><em>Weaving</em></span>: linking aspects with other
          application types or objects to create an advised object. This can
          be done at compile time (using the AspectJ compiler, for example),
          load time, or at runtime. Spring AOP, like other pure Java AOP
          frameworks, performs weaving at runtime.</p></li></ul></div><p>Types of advice:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>Before advice</em></span>: Advice that executes
          before a join point, but which does not have the ability to prevent
          execution flow proceeding to the join point (unless it throws an
          exception).</p></li><li><p><span class="emphasis"><em>After returning advice</em></span>: Advice to be
          executed after a join point completes normally: for example, if a
          method returns without throwing an exception.</p></li><li><p><span class="emphasis"><em>After throwing advice</em></span>: Advice to be
          executed if a method exits by throwing an exception.</p></li><li><p><span class="emphasis"><em>After (finally) advice</em></span>: Advice to be
          executed regardless of the means by which a join point exits (normal
          or exceptional return).</p></li><li><p><span class="emphasis"><em>Around advice</em></span>: Advice that surrounds a
          join point such as a method invocation. This is the most powerful
          kind of advice. Around advice can perform custom behavior before and
          after the method invocation. It is also responsible for choosing
          whether to proceed to the join point or to shortcut the advised
          method execution by returning its own return value or throwing an
          exception.</p></li></ul></div><p>Around advice is the most general kind of advice. Since Spring
      AOP, like AspectJ, provides a full range of advice types, we recommend
      that you use the least powerful advice type that can implement the
      required behavior. For example, if you need only to update a cache with
      the return value of a method, you are better off implementing an after
      returning advice than an around advice, although an around advice can
      accomplish the same thing. Using the most specific advice type provides
      a simpler programming model with less potential for errors. For example,
      you do not need to invoke the <code class="methodname">proceed()</code> method
      on the <code class="interfacename">JoinPoint</code> used for around advice,
      and hence cannot fail to invoke it.</p><p>In Spring 2.0, all advice parameters are statically typed, so that
      you work with advice parameters of the appropriate type (the type of the
      return value from a method execution for example) rather than
      <code class="classname">Object</code> arrays.</p><p>The concept of join points, matched by pointcuts, is the key to
      AOP which distinguishes it from older technologies offering only
      interception. Pointcuts enable advice to be targeted independently of
      the Object-Oriented hierarchy. For example, an around advice providing
      declarative transaction management can be applied to a set of methods
      spanning multiple objects (such as all business operations in the
      service layer).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-introduction-spring-defn"></a>8.1.2&nbsp;Spring AOP capabilities and goals</h3></div></div></div><p>Spring AOP is implemented in pure Java. There is no need for a
      special compilation process. Spring AOP does not need to control the
      class loader hierarchy, and is thus suitable for use in a Servlet
      container or application server.</p><p>Spring AOP currently supports only method execution join points
      (advising the execution of methods on Spring beans). Field interception
      is not implemented, although support for field interception could be
      added without breaking the core Spring AOP APIs. If you need to advise
      field access and update join points, consider a language such as
      AspectJ.</p><p>Spring AOP's approach to AOP differs from that of most other AOP
      frameworks. The aim is not to provide the most complete AOP
      implementation (although Spring AOP is quite capable); it is rather to
      provide a close integration between AOP implementation and Spring IoC to
      help solve common problems in enterprise applications.</p><p>Thus, for example, the Spring Framework's AOP functionality is
      normally used in conjunction with the Spring IoC container. Aspects are
      configured using normal bean definition syntax (although this allows
      powerful "autoproxying" capabilities): this is a crucial difference from
      other AOP implementations. There are some things you cannot do easily or
      efficiently with Spring AOP, such as advise very fine-grained objects
      (such as domain objects typically): AspectJ is the best choice in such
      cases. However, our experience is that Spring AOP provides an excellent
      solution to most problems in enterprise Java applications that are
      amenable to AOP.</p><p>Spring AOP will never strive to compete with AspectJ to provide a
      comprehensive AOP solution. We believe that both proxy-based frameworks
      like Spring AOP and full-blown frameworks such as AspectJ are valuable,
      and that they are complementary, rather than in competition. Spring 2.0
      seamlessly integrates Spring AOP and IoC with AspectJ, to enable all
      uses of AOP to be catered for within a consistent Spring-based
      application architecture. This integration does not affect the Spring
      AOP API or the AOP Alliance API: Spring AOP remains backward-compatible.
      See <a class="link" href="#aop-api" title="9.&nbsp;Spring AOP APIs">the following chapter</a> for a
      discussion of the Spring AOP APIs.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>One of the central tenets of the Spring Framework is that of
        <span class="emphasis"><em>non-invasiveness</em></span>; this is the idea that you
        should not be forced to introduce framework-specific classes and
        interfaces into your business/domain model. However, in some places
        the Spring Framework does give you the option to introduce Spring
        Framework-specific dependencies into your codebase: the rationale in
        giving you such options is because in certain scenarios it might be
        just plain easier to read or code some specific piece of functionality
        in such a way. The Spring Framework (almost) always offers you the
        choice though: you have the freedom to make an informed decision as to
        which option best suits your particular use case or scenario.</p><p>One such choice that is relevant to this chapter is that of
        which AOP framework (and which AOP style) to choose. You have the
        choice of AspectJ and/or Spring AOP, and you also have the choice of
        either the @AspectJ annotation-style approach or the Spring XML
        configuration-style approach. The fact that this chapter chooses to
        introduce the @AspectJ-style approach first should not be taken as an
        indication that the Spring team favors the @AspectJ annotation-style
        approach over the Spring XML configuration-style.</p><p>See <a class="xref" href="#aop-choosing" title="8.4&nbsp;Choosing which AOP declaration style to use">Section&nbsp;8.4, &#8220;Choosing which AOP declaration style to use&#8221;</a> for a
        more complete discussion of the whys and wherefores of each style.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-introduction-proxies"></a>8.1.3&nbsp;AOP Proxies</h3></div></div></div><p>Spring AOP defaults to using standard J2SE <span class="emphasis"><em>dynamic
      proxies</em></span> for AOP proxies. This enables any interface (or set
      of interfaces) to be proxied.</p><p>Spring AOP can also use CGLIB proxies. This is necessary to proxy
      classes, rather than interfaces. CGLIB is used by default if a business
      object does not implement an interface. As it is good practice to
      program to interfaces rather than classes, business classes normally
      will implement one or more business interfaces. It is possible to <a class="link" href="#aop-autoproxy-force-CGLIB">force the use of CGLIB</a>, in
      those (hopefully rare) cases where you need to advise a method that is
      not declared on an interface, or where you need to pass a proxied object
      to a method as a concrete type.</p><p>It is important to grasp the fact that Spring AOP is
      <span class="emphasis"><em>proxy-based</em></span>. See <a class="xref" href="#aop-understanding-aop-proxies" title="8.6.1&nbsp;Understanding AOP proxies">Section&nbsp;8.6.1, &#8220;Understanding AOP proxies&#8221;</a> for a thorough examination of
      exactly what this implementation detail actually means.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-ataspectj"></a>8.2&nbsp;@AspectJ support</h2></div></div></div><p>@AspectJ refers to a style of declaring aspects as regular Java
    classes annotated with Java 5 annotations. The @AspectJ style was
    introduced by the <a class="ulink" href="http://www.eclipse.org/aspectj" target="_top">AspectJ
    project</a> as part of the AspectJ 5 release. Spring 2.0 interprets
    the same annotations as AspectJ 5, using a library supplied by AspectJ for
    pointcut parsing and matching. The AOP runtime is still pure Spring AOP
    though, and there is no dependency on the AspectJ compiler or
    weaver.</p><p class="remark"><i><span class="remark"><p>Using the AspectJ compiler and weaver enables use of the
    full AspectJ language, and is discussed in <a class="xref" href="#aop-using-aspectj" title="8.8&nbsp;Using AspectJ with Spring applications">Section&nbsp;8.8, &#8220;Using AspectJ with Spring applications&#8221;</a>.</p></span></i></p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-aspectj-support"></a>8.2.1&nbsp;Enabling @AspectJ Support</h3></div></div></div><p>To use @AspectJ aspects in a Spring configuration you need to
      enable Spring support for configuring Spring AOP based on @AspectJ
      aspects, and <span class="emphasis"><em>autoproxying</em></span> beans based on whether or
      not they are advised by those aspects. By autoproxying we mean that if
      Spring determines that a bean is advised by one or more aspects, it will
      automatically generate a proxy for that bean to intercept method
      invocations and ensure that advice is executed as needed.</p><p>The @AspectJ support is enabled by including the following element
      inside your spring configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:aspectj-autoproxy</span>/&gt;</pre><p>This assumes that you are using schema support as described in
      <a class="xref" href="#xsd-config" title="Appendix&nbsp;C.&nbsp;XML Schema-based configuration">Appendix&nbsp;C, <i>XML Schema-based configuration</i></a>. See <a class="xref" href="#xsd-config-body-schemas-aop" title="C.2.7&nbsp;The aop schema">Section&nbsp;C.2.7, &#8220;The aop schema&#8221;</a> for how to import the tags in
      the aop namespace.</p><p>If you are using the DTD, it is still possible to enable @AspectJ
      support by adding the following definition to your application
      context:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.aspectj.annotation.AnnotationAwareAspectJAutoProxyCreator"</span> /&gt;</pre><p>You will also need AspectJ's
      <code class="filename">aspectjrt.jar</code> library on the
      classpath of your application, version 1.6.8 or later. This library is
      available in the <code class="filename">'lib'</code> directory
      of an AspectJ distribution or via the Maven Central repository.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-at-aspectj"></a>8.2.2&nbsp;Declaring an aspect</h3></div></div></div><p>With the @AspectJ support enabled, any bean defined in your
      application context with a class that is an @AspectJ aspect (has the
      <code class="interfacename">@Aspect</code> annotation) will be automatically
      detected by Spring and used to configure Spring AOP. The following
      example shows the minimal definition required for a not-very-useful
      aspect:</p><p>A regular bean definition in the application context, pointing to
      a bean class that has the <code class="interfacename">@Aspect</code>
      annotation:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAspect"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.xyz.NotVeryUsefulAspect"</span>&gt;
   &lt;<span class="hl-comment">!-- configure properties of aspect here as normal --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
</pre><p>And the <code class="classname">NotVeryUsefulAspect</code> class
      definition, annotated with
      <code class="interfacename">org.aspectj.lang.annotation.Aspect</code>
      annotation;</p><pre class="programlisting"><span class="hl-keyword">package</span> org.xyz;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;

@Aspect
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> NotVeryUsefulAspect {

}</pre><p>Aspects (classes annotated with
      <code class="interfacename">@Aspect</code>) may have methods and fields just
      like any other class. They may also contain pointcut, advice, and
      introduction (inter-type) declarations.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Autodetecting aspects through component scanning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Autodetecting aspects through component scanning</th></tr><tr><td align="left" valign="top"><p>You may register aspect classes as regular beans in your Spring
        XML configuration, or autodetect them through classpath scanning -
        just like any other Spring-managed bean. However, note that the
        <span class="emphasis"><em>@Aspect</em></span> annotation is <span class="emphasis"><em>not</em></span>
        sufficient for autodetection in the classpath: For that purpose,
        you need to add a separate <span class="emphasis"><em>@Component</em></span> annotation
        (or alternatively a custom stereotype annotation that qualifies,
        as per the rules of Spring's component scanner).</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Advising aspects with other aspects?"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Advising aspects with other aspects?</th></tr><tr><td align="left" valign="top"><p>In Spring AOP, it is <span class="emphasis"><em>not</em></span> possible to have
        aspects themselves be the target of advice from other aspects. The
        <span class="emphasis"><em>@Aspect</em></span> annotation on a class marks it as an
        aspect, and hence excludes it from auto-proxying.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-pointcuts"></a>8.2.3&nbsp;Declaring a pointcut</h3></div></div></div><p>Recall that pointcuts determine join points of interest, and thus
      enable us to control when advice executes. <span class="emphasis"><em>Spring AOP only
      supports method execution join points for Spring beans</em></span>, so
      you can think of a pointcut as matching the execution of methods on
      Spring beans. A pointcut declaration has two parts: a signature
      comprising a name and any parameters, and a pointcut expression that
      determines <span class="emphasis"><em>exactly</em></span> which method executions we are
      interested in. In the @AspectJ annotation-style of AOP, a pointcut
      signature is provided by a regular method definition, and the pointcut
      expression is indicated using the
      <code class="interfacename">@Pointcut</code> annotation (the method serving
      as the pointcut signature <span class="emphasis"><em>must</em></span> have a
      <code class="literal">void</code> return type).</p><p>An example will help make this distinction between a pointcut
      signature and a pointcut expression clear. The following example defines
      a pointcut named <code class="literal">'anyOldTransfer'</code> that will match the
      execution of any method named <code class="literal">'transfer'</code>:</p><pre class="programlisting">@Pointcut(<span class="hl-string">"execution(* transfer(..))"</span>)<span class="hl-comment">// the pointcut expression</span>
<span class="hl-keyword">private</span> <span class="hl-keyword">void</span> anyOldTransfer() {}<span class="hl-comment">// the pointcut signature</span></pre><p>The pointcut expression that forms the value of the
      <code class="interfacename">@Pointcut</code> annotation is a regular AspectJ
      5 pointcut expression. For a full discussion of AspectJ's pointcut
      language, see the <a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/progguide/index.html" target="_top">AspectJ
      Programming Guide</a> (and for Java 5 based extensions, the <a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/adk15notebook/index.html" target="_top">AspectJ
      5 Developers Notebook</a>) or one of the books on AspectJ such as
      &#8220;<span class="quote">Eclipse AspectJ</span>&#8221; by Colyer et. al. or &#8220;<span class="quote">AspectJ in
      Action</span>&#8221; by Ramnivas Laddad.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-pointcuts-designators"></a>8.2.3.1&nbsp;Supported Pointcut Designators</h4></div></div></div><p>Spring AOP supports the following AspectJ pointcut designators
        (PCD) for use in pointcut expressions:</p><div class="sidebar"><p class="title"><b>Other pointcut types</b></p><p>The full AspectJ pointcut language supports additional
          pointcut designators that are not supported in Spring. These are:
          <code class="literal">call, get, set, preinitialization, staticinitialization,
          initialization, handler, adviceexecution, withincode, cflow,
          cflowbelow, if, @this</code>, and <code class="literal">@withincode</code>.
          Use of these pointcut designators in pointcut expressions
          interpreted by Spring AOP will result in an
          <code class="classname">IllegalArgumentException</code> being thrown.</p><p>The set of pointcut designators supported by Spring AOP may be
          extended in future releases to support more of the AspectJ pointcut
          designators.</p></div><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>execution</em></span> - for matching method
            execution join points, this is the primary pointcut designator you
            will use when working with Spring AOP</p></li><li><p><span class="emphasis"><em>within</em></span> - limits matching to join points
            within certain types (simply the execution of a method declared
            within a matching type when using Spring AOP)</p></li><li><p><span class="emphasis"><em>this</em></span> - limits matching to join points
            (the execution of methods when using Spring AOP) where the bean
            reference (Spring AOP proxy) is an instance of the given
            type</p></li><li><p><span class="emphasis"><em>target</em></span> - limits matching to join points
            (the execution of methods when using Spring AOP) where the target
            object (application object being proxied) is an instance of the
            given type</p></li><li><p><span class="emphasis"><em>args</em></span> - limits matching to join points
            (the execution of methods when using Spring AOP) where the
            arguments are instances of the given types</p></li><li><p><span class="emphasis"><em><code class="interfacename">@target</code></em></span>
            - limits matching to join points (the execution of methods when
            using Spring AOP) where the class of the executing object has an
            annotation of the given type</p></li><li><p><span class="emphasis"><em><code class="interfacename">@args</code></em></span> -
            limits matching to join points (the execution of methods when
            using Spring AOP) where the runtime type of the actual arguments
            passed have annotations of the given type(s)</p></li><li><p><span class="emphasis"><em><code class="interfacename">@within</code></em></span>
            - limits matching to join points within types that have the given
            annotation (the execution of methods declared in types with the
            given annotation when using Spring AOP)</p></li><li><p><span class="emphasis"><em>@annotation</em></span> - limits matching to join
            points where the subject of the join point (method being executed
            in Spring AOP) has the given annotation</p></li></ul></div><p>Because Spring AOP limits matching to only method execution
        join points, the discussion of the pointcut designators above gives a
        narrower definition than you will find in the AspectJ programming
        guide. In addition, AspectJ itself has type-based semantics and at an
        execution join point both '<code class="literal">this</code>' and
        '<code class="literal">target</code>' refer to the same object - the object
        executing the method. Spring AOP is a proxy-based system and
        differentiates between the proxy object itself (bound to
        '<code class="literal">this</code>') and the target object behind the proxy
        (bound to '<code class="literal">target</code>').</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Due to the proxy-based nature of Spring's AOP framework,
          protected methods are by definition <span class="emphasis"><em>not</em></span>
          intercepted, neither for JDK proxies (where this isn't applicable)
          nor for CGLIB proxies (where this is technically possible but not
          recommendable for AOP purposes). As a consequence, any given pointcut
          will be matched against <span class="emphasis"><em>public methods only</em></span>!</p><p>If your interception needs include protected/private methods
          or even constructors, consider the use of Spring-driven
          <a class="link" href="#aop-aj-ltw" title="8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">native AspectJ weaving</a> instead
          of Spring's proxy-based AOP framework. This constitutes a different
          mode of AOP usage with different characteristics, so be sure to make
          yourself familiar with weaving first before making a decision.</p></td></tr></table></div><p>Spring AOP also supports an additional PCD named
        '<code class="literal">bean</code>'. This PCD allows you to limit the matching
        of join points to a particular named Spring bean, or to a set of named
        Spring beans (when using wildcards). The '<code class="literal">bean</code>' PCD
        has the following form:</p><pre class="programlisting">bean(idOrNameOfBean)</pre><p>The '<code class="literal">idOrNameOfBean</code>' token can be the name of
        any Spring bean: limited wildcard support using the
        '<code class="literal">*</code>' character is provided, so if you establish
        some naming conventions for your Spring beans you can quite easily
        write a '<code class="literal">bean</code>' PCD expression to pick them out. As
        is the case with other pointcut designators, the
        '<code class="literal">bean</code>' PCD can be &amp;&amp;'ed, ||'ed, and !
        (negated) too.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Please note that the '<code class="literal">bean</code>' PCD is
          <span class="emphasis"><em>only</em></span> supported in Spring AOP - and
          <span class="emphasis"><em>not</em></span> in native AspectJ weaving. It is a
          Spring-specific extension to the standard PCDs that AspectJ
          defines.</p><p>The '<code class="literal">bean</code>' PCD operates at the
          <span class="emphasis"><em>instance</em></span> level (building on the Spring
          bean name concept) rather than at the type level only
          (which is what weaving-based AOP is limited to).
          Instance-based pointcut designators are a special capability
          of Spring's proxy-based AOP framework and its close integration
          with the Spring bean factory, where it is natural and
          straightforward to identify specific beans by name.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-pointcuts-combining"></a>8.2.3.2&nbsp;Combining pointcut expressions</h4></div></div></div><p>Pointcut expressions can be combined using '&amp;&amp;', '||'
        and '!'. It is also possible to refer to pointcut expressions by name.
        The following example shows three pointcut expressions:
        <code class="literal">anyPublicOperation</code> (which matches if a method
        execution join point represents the execution of any public method);
        <code class="literal">inTrading</code> (which matches if a method execution is
        in the trading module), and <code class="literal">tradingOperation</code> (which
        matches if a method execution represents any public method in the
        trading module).</p><pre class="programlisting">    @Pointcut(<span class="hl-string">"execution(public * *(..))"</span>)
    <span class="hl-keyword">private</span> <span class="hl-keyword">void</span> anyPublicOperation() {}
    
    @Pointcut(<span class="hl-string">"within(com.xyz.someapp.trading..*)"</span>)
    <span class="hl-keyword">private</span> <span class="hl-keyword">void</span> inTrading() {}
    
    @Pointcut(<span class="hl-string">"anyPublicOperation() &amp;&amp; inTrading()"</span>)
    <span class="hl-keyword">private</span> <span class="hl-keyword">void</span> tradingOperation() {}</pre><p>It is a best practice to build more complex pointcut expressions
        out of smaller named components as shown above. When referring to
        pointcuts by name, normal Java visibility rules apply (you can see
        private pointcuts in the same type, protected pointcuts in the
        hierarchy, public pointcuts anywhere and so on). Visibility does not
        affect pointcut <span class="emphasis"><em>matching</em></span>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-common-pointcuts"></a>8.2.3.3&nbsp;Sharing common pointcut definitions</h4></div></div></div><p>When working with enterprise applications, you often want to
        refer to modules of the application and particular sets of operations
        from within several aspects. We recommend defining a
        "SystemArchitecture" aspect that captures common pointcut expressions
        for this purpose. A typical such aspect would look as follows:</p><pre class="programlisting"><span class="hl-keyword">package</span> com.xyz.someapp;

<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Pointcut;

@Aspect
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SystemArchitecture {

  <span class="hl-comment">/**
   * A join point is in the web layer if the method is defined
   * in a type in the com.xyz.someapp.web package or any sub-package
   * under that.
   */</span>
  @Pointcut(<span class="hl-string">"within(com.xyz.someapp.web..*)"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> inWebLayer() {}

  <span class="hl-comment">/**
   * A join point is in the service layer if the method is defined
   * in a type in the com.xyz.someapp.service package or any sub-package
   * under that.
   */</span>
  @Pointcut(<span class="hl-string">"within(com.xyz.someapp.service..*)"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> inServiceLayer() {}

  <span class="hl-comment">/**
   * A join point is in the data access layer if the method is defined
   * in a type in the com.xyz.someapp.dao package or any sub-package
   * under that.
   */</span>
  @Pointcut(<span class="hl-string">"within(com.xyz.someapp.dao..*)"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> inDataAccessLayer() {}

  <span class="hl-comment">/**
   * A business service is the execution of any method defined on a service
   * interface. This definition assumes that interfaces are placed in the
   * "service" package, and that implementation types are in sub-packages.
   * 
   * If you group service interfaces by functional area (for example, 
   * in packages com.xyz.someapp.abc.service and com.xyz.def.service) then
   * the pointcut expression "execution(* com.xyz.someapp..service.*.*(..))"
   * could be used instead.
   *
   * Alternatively, you can write the expression using the 'bean'
   * PCD, like so "bean(*Service)". (This assumes that you have
   * named your Spring service beans in a consistent fashion.)
   */</span>
  @Pointcut(<span class="hl-string">"execution(* com.xyz.someapp.service.*.*(..))"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> businessService() {}
  
  <span class="hl-comment">/**
   * A data access operation is the execution of any method defined on a 
   * dao interface. This definition assumes that interfaces are placed in the
   * "dao" package, and that implementation types are in sub-packages.
   */</span>
  @Pointcut(<span class="hl-string">"execution(* com.xyz.someapp.dao.*.*(..))"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> dataAccessOperation() {}

}</pre><p>The pointcuts defined in such an aspect can be referred to
        anywhere that you need a pointcut expression. For example, to make the
        service layer transactional, you could write:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:config</span>&gt;
  &lt;<span class="hl-tag">aop:advisor</span> 
      <span class="hl-attribute">pointcut</span>=<span class="hl-value">"com.xyz.someapp.SystemArchitecture.businessService()"</span>
      <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"tx-advice"</span>/&gt;
&lt;<span class="hl-tag">/aop:config</span>&gt;

&lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"tx-advice"</span>&gt;
  &lt;<span class="hl-tag">tx:attributes</span>&gt;
    &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"REQUIRED"</span>/&gt;
  &lt;<span class="hl-tag">/tx:attributes</span>&gt;
&lt;<span class="hl-tag">/tx:advice</span>&gt;</pre><p>The <code class="literal">&lt;aop:config&gt;</code> and
        <code class="literal">&lt;aop:advisor&gt;</code> elements are discussed in <a class="xref" href="#aop-schema" title="8.3&nbsp;Schema-based AOP support">Section&nbsp;8.3, &#8220;Schema-based AOP support&#8221;</a>. The transaction elements are discussed in
        <a class="xref" href="#transaction" title="11.&nbsp;Transaction Management">Chapter&nbsp;11, <i>Transaction Management</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-pointcuts-examples"></a>8.2.3.4&nbsp;Examples</h4></div></div></div><p>Spring AOP users are likely to use the
        <code class="literal">execution</code> pointcut designator the most often. The
        format of an execution expression is:</p><pre class="programlisting">execution(modifiers-pattern? ret-type-pattern declaring-type-pattern? name-pattern(param-pattern)
          <span class="hl-keyword">throws</span>-pattern?)</pre><p>All parts except the returning type pattern (ret-type-pattern in
        the snippet above), name pattern, and parameters pattern are optional.
        The returning type pattern determines what the return type of the
        method must be in order for a join point to be matched. Most
        frequently you will use <code class="literal">*</code> as the returning type
        pattern, which matches any return type. A fully-qualified type name
        will match only when the method returns the given type. The name
        pattern matches the method name. You can use the <code class="literal">*</code>
        wildcard as all or part of a name pattern. The parameters pattern is
        slightly more complex: <code class="literal">()</code> matches a method that
        takes no parameters, whereas <code class="literal">(..)</code> matches any
        number of parameters (zero or more). The pattern
        <code class="literal">(*)</code> matches a method taking one parameter of any
        type, <code class="literal">(*,String)</code> matches a method taking two
        parameters, the first can be of any type, the second must be a String.
        Consult the <a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/progguide/semantics-pointcuts.html" target="_top">
        Language Semantics</a> section of the AspectJ Programming Guide
        for more information.</p><p>Some examples of common pointcut expressions are given
        below.</p><div class="itemizedlist"><ul type="disc"><li><p>the execution of any public method:</p><pre class="programlisting">execution(<span class="hl-keyword">public</span> * *(..))</pre></li><li><p>the execution of any method with a name beginning with
            "set":</p><pre class="programlisting">execution(* set*(..))</pre></li><li><p>the execution of any method defined by the
            <code class="interfacename">AccountService</code> interface:</p><pre class="programlisting">execution(* com.xyz.service.AccountService.*(..))</pre></li><li><p>the execution of any method defined in the service
            package:</p><pre class="programlisting">execution(* com.xyz.service.*.*(..))</pre></li><li><p>the execution of any method defined in the service package
            or a sub-package:</p><pre class="programlisting">execution(* com.xyz.service..*.*(..))</pre></li><li><p>any join point (method execution only in Spring AOP) within
            the service package:</p><pre class="programlisting">within(com.xyz.service.*)</pre></li><li><p>any join point (method execution only in Spring AOP) within
            the service package or a sub-package:</p><pre class="programlisting">within(com.xyz.service..*)</pre></li><li><p>any join point (method execution only in Spring AOP) where
            the proxy implements the
            <code class="interfacename">AccountService</code> interface:</p><pre class="programlisting"><span class="hl-keyword">this</span>(com.xyz.service.AccountService)</pre><p class="remark"><i><span class="remark"><p>'this' is more commonly used in a binding form :-
            see the following section on advice for how to make the proxy
            object available in the advice body.</p></span></i></p></li><li><p>any join point (method execution only in Spring AOP) where
            the target object implements the
            <code class="interfacename">AccountService</code> interface:</p><pre class="programlisting">target(com.xyz.service.AccountService)</pre><p class="remark"><i><span class="remark"><p>'target' is more commonly used in a binding form :-
            see the following section on advice for how to make the target
            object available in the advice body.</p></span></i></p></li><li><p>any join point (method execution only in Spring AOP) which
            takes a single parameter, and where the argument passed at runtime
            is <code class="interfacename">Serializable</code>:</p><pre class="programlisting">args(java.io.Serializable)</pre><p class="remark"><i><span class="remark">'args' is more commonly used in a binding form :- see the
            following section on advice for how to make the method arguments
            available in the advice body.</span></i></p><p>Note that the pointcut given in this example is different to
            <code class="literal">execution(* *(java.io.Serializable))</code>: the args
            version matches if the argument passed at runtime is Serializable,
            the execution version matches if the method signature declares a
            single parameter of type
            <code class="interfacename">Serializable</code>.</p></li><li><p>any join point (method execution only in Spring AOP) where
            the target object has an
            <code class="interfacename">@Transactional</code> annotation:</p><pre class="programlisting">@target(org.springframework.transaction.annotation.Transactional)</pre><p class="remark"><i><span class="remark"><p>'@target' can also be used in a binding form :- see
            the following section on advice for how to make the annotation
            object available in the advice body.</p></span></i></p></li><li><p>any join point (method execution only in Spring AOP) where
            the declared type of the target object has an
            <code class="interfacename">@Transactional</code> annotation:</p><pre class="programlisting">@within(org.springframework.transaction.annotation.Transactional)</pre><p class="remark"><i><span class="remark"><p>'@within' can also be used in a binding form :- see
            the following section on advice for how to make the annotation
            object available in the advice body.</p></span></i></p></li><li><p>any join point (method execution only in Spring AOP) where
            the executing method has an
            <code class="interfacename">@Transactional</code> annotation:</p><pre class="programlisting">@annotation(org.springframework.transaction.annotation.Transactional)</pre><p class="remark"><i><span class="remark"><p>'@annotation' can also be used in a binding form :-
            see the following section on advice for how to make the annotation
            object available in the advice body.</p></span></i></p></li><li><p>any join point (method execution only in Spring AOP) which
            takes a single parameter, and where the runtime type of the
            argument passed has the <code class="interfacename">@Classified</code>
            annotation:</p><pre class="programlisting">@args(com.xyz.security.Classified)</pre><p class="remark"><i><span class="remark"><p>'@args' can also be used in a binding form :- see
            the following section on advice for how to make the annotation
            object(s) available in the advice body.</p></span></i></p></li><li><p>any join point (method execution only in Spring AOP) on a
            Spring bean named '<code class="literal">tradeService</code>':</p><pre class="programlisting">bean(tradeService)</pre></li><li><p>any join point (method execution only in Spring AOP) on
            Spring beans having names that match the wildcard expression
            '<code class="literal">*Service</code>':</p><pre class="programlisting">bean(*Service)</pre></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="writing-good-pointcuts"></a>8.2.3.5&nbsp;Writing good pointcuts</h4></div></div></div><p>During compilation, AspectJ processes pointcuts in order to try and optimize matching performance. Examining code 
        and determining if each join point matches (statically or dynamically) a given pointcut is a costly process. (A dynamic 
        match means the match cannot be fully determined from static analysis and a test will be placed in the code to 
        determine if there is an actual match when the code is running). On first encountering a pointcut declaration, 
        AspectJ will rewrite it into an optimal form for the matching process. What does this mean? Basically pointcuts 
        are rewritten in DNF (Disjunctive Normal Form) and the components of the pointcut are sorted such that those 
        components that are cheaper to evaluate are checked first. This means you do not have to worry about understanding 
        the performance of various pointcut designators and may supply them in any order in a pointcut declaration.</p><p>However, AspectJ can only work with what it is told, and for optimal performance of matching you should 
        think about what they are trying to achieve and narrow the search space for matches as much as possible in the 
        definition. The existing designators naturally fall into one of three groups: kinded, scoping and context:</p><div class="itemizedlist"><ul type="disc"><li><p>Kinded designators are those which select a particular kind of join point. For example: execution, get, set, call, handler</p></li><li><p>Scoping designators are those which select a group of join points of interest (of probably many kinds). For example: within, withincode</p></li><li><p>Contextual designators are those that match (and optionally bind) based on context. For example: this, target, @annotation</p></li></ul></div><p>A well written pointcut should try and include at least the first two types (kinded and scoping), whilst 
        the contextual designators may be included if wishing to match based on join point context, or bind that context 
        for use in the advice. Supplying either just a kinded designator or just a contextual designator will work but 
        could affect weaving performance (time and memory used) due to all the extra processing and analysis. Scoping 
        designators are very fast to match and their usage means AspectJ can very quickly dismiss groups of 
        join points that should not be further processed - that is why a good pointcut should always include 
        one if possible.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-advice"></a>8.2.4&nbsp;Declaring advice</h3></div></div></div><p>Advice is associated with a pointcut expression, and runs before,
      after, or around method executions matched by the pointcut. The pointcut
      expression may be either a simple reference to a named pointcut, or a
      pointcut expression declared in place.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-advice-before"></a>8.2.4.1&nbsp;Before advice</h4></div></div></div><p>Before advice is declared in an aspect using the
        <code class="interfacename">@Before</code> annotation:</p><pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Before;

@Aspect
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BeforeExample {

  @Before(<span class="hl-string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation()"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck() {
    <span class="hl-comment">// ...</span>
  }

}</pre><p>If using an in-place pointcut expression we could rewrite the
        above example as:</p><pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Before;

@Aspect
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BeforeExample {

  @Before(<span class="hl-string">"execution(* com.xyz.myapp.dao.*.*(..))"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck() {
    <span class="hl-comment">// ...</span>
  }

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-advice-after-returning"></a>8.2.4.2&nbsp;After returning advice</h4></div></div></div><p>After returning advice runs when a matched method execution
        returns normally. It is declared using the
        <code class="interfacename">@AfterReturning</code> annotation:</p><pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.AfterReturning;

@Aspect
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterReturningExample {

  @AfterReturning(<span class="hl-string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation()"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck() {
    <span class="hl-comment">// ...</span>
  }

}</pre><p class="remark"><i><span class="remark">Note: it is of course possible to have multiple advice
        declarations, and other members as well, all inside the same aspect.
        We're just showing a single advice declaration in these examples to
        focus on the issue under discussion at the time.</span></i></p><p>Sometimes you need access in the advice body to the actual value
        that was returned. You can use the form of
        <code class="interfacename">@AfterReturning</code> that binds the return
        value for this:</p><pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.AfterReturning;

@Aspect
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterReturningExample {

  @AfterReturning(
    pointcut=<span class="hl-string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation()"</span>,
    returning=<span class="hl-string">"retVal"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck(Object retVal) {
    <span class="hl-comment">// ...</span>
  }
  
}</pre><p>The name used in the <code class="literal">returning</code> attribute must
        correspond to the name of a parameter in the advice method. When a
        method execution returns, the return value will be passed to the
        advice method as the corresponding argument value. A
        <code class="literal">returning</code> clause also restricts matching to only
        those method executions that return a value of the specified type
        (<code class="classname">Object</code> in this case, which will match any
        return value).</p><p>Please note that it is <span class="emphasis"><em>not</em></span> possible to
        return a totally different reference when using after-returning
        advice.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-advice-after-throwing"></a>8.2.4.3&nbsp;After throwing advice</h4></div></div></div><p>After throwing advice runs when a matched method execution exits
        by throwing an exception. It is declared using the
        <code class="interfacename">@AfterThrowing</code> annotation:</p><pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;

@Aspect
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterThrowingExample {

  @AfterThrowing(<span class="hl-string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation()"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doRecoveryActions() {
    <span class="hl-comment">// ...</span>
  }

}</pre><p>Often you want the advice to run only when exceptions of a given
        type are thrown, and you also often need access to the thrown
        exception in the advice body. Use the <code class="literal">throwing</code>
        attribute to both restrict matching (if desired, use
        <code class="interfacename">Throwable</code> as the exception type
        otherwise) and bind the thrown exception to an advice
        parameter.</p><pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;

@Aspect
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterThrowingExample {

  @AfterThrowing(
    pointcut=<span class="hl-string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation()"</span>,
    throwing=<span class="hl-string">"ex"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doRecoveryActions(DataAccessException ex) {
    <span class="hl-comment">// ...</span>
  }

}</pre><p>The name used in the <code class="literal">throwing</code> attribute must
        correspond to the name of a parameter in the advice method. When a
        method execution exits by throwing an exception, the exception will be
        passed to the advice method as the corresponding argument value. A
        <code class="literal">throwing</code> clause also restricts matching to only
        those method executions that throw an exception of the specified type
        (<code class="classname">DataAccessException</code> in this case).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-advice-after-finally"></a>8.2.4.4&nbsp;After (finally) advice</h4></div></div></div><p>After (finally) advice runs however a matched method execution
        exits. It is declared using the <code class="interfacename">@After</code>
        annotation. After advice must be prepared to handle both normal and
        exception return conditions. It is typically used for releasing
        resources, etc.</p><pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.After;

@Aspect
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterFinallyExample {

  @After(<span class="hl-string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation()"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doReleaseLock() {
    <span class="hl-comment">// ...</span>
  }

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-ataspectj-around-advice"></a>8.2.4.5&nbsp;Around advice</h4></div></div></div><p>The final kind of advice is around advice. Around advice runs
        "around" a matched method execution. It has the opportunity to do work
        both before and after the method executes, and to determine when, how,
        and even if, the method actually gets to execute at all. Around advice
        is often used if you need to share state before and after a method
        execution in a thread-safe manner (starting and stopping a timer for
        example). Always use the least powerful form of advice that meets your
        requirements (i.e. don't use around advice if simple before advice
        would do).</p><p>Around advice is declared using the
        <code class="interfacename">@Around</code> annotation. The first parameter
        of the advice method must be of type
        <code class="interfacename">ProceedingJoinPoint</code>. Within the body of
        the advice, calling <code class="literal">proceed()</code> on the
        <code class="interfacename">ProceedingJoinPoint</code> causes the
        underlying method to execute. The <code class="literal">proceed</code> method
        may also be called passing in an <code class="classname">Object[]</code> - the
        values in the array will be used as the arguments to the method
        execution when it proceeds.</p><p class="remark"><i><span class="remark">The behavior of proceed when called with an
        <code class="classname">Object[]</code> is a little different than the
        behavior of proceed for around advice compiled by the AspectJ
        compiler. For around advice written using the traditional AspectJ
        language, the number of arguments passed to proceed must match the
        number of arguments passed to the around advice (not the number of
        arguments taken by the underlying join point), and the value passed to
        proceed in a given argument position supplants the original value at
        the join point for the entity the value was bound to (Don't worry if
        this doesn't make sense right now!). The approach taken by Spring is
        simpler and a better match to its proxy-based, execution only
        semantics. You only need to be aware of this difference if you are
        compiling @AspectJ aspects written for Spring and using proceed with
        arguments with the AspectJ compiler and weaver. There is a way to
        write such aspects that is 100% compatible across both Spring AOP and
        AspectJ, and this is discussed in the following section on advice
        parameters.</span></i></p><pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Around;
<span class="hl-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;

@Aspect
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AroundExample {

  @Around(<span class="hl-string">"com.xyz.myapp.SystemArchitecture.businessService()"</span>)
  <span class="hl-keyword">public</span> Object doBasicProfiling(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
    <span class="hl-comment">// start stopwatch</span>
    Object retVal = pjp.proceed();
    <span class="hl-comment">// stop stopwatch</span>
    <span class="hl-keyword">return</span> retVal;
  }

}</pre><p>The value returned by the around advice will be the return value
        seen by the caller of the method. A simple caching aspect for example
        could return a value from a cache if it has one, and invoke proceed()
        if it does not. Note that proceed may be invoked once, many times, or
        not at all within the body of the around advice, all of these are
        quite legal.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-ataspectj-advice-params"></a>8.2.4.6&nbsp;Advice parameters</h4></div></div></div><p>Spring 2.0 offers fully typed advice - meaning that you declare
        the parameters you need in the advice signature (as we saw for the
        returning and throwing examples above) rather than work with
        <code class="classname">Object[]</code> arrays all the time. We'll see how to
        make argument and other contextual values available to the advice body
        in a moment. First let's take a look at how to write generic advice
        that can find out about the method the advice is currently
        advising.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-params-the-joinpoint"></a>Access to the current
          <code class="interfacename">JoinPoint</code></h5></div></div></div><p>Any advice method may declare as its first parameter, a
          parameter of type
          <code class="interfacename">org.aspectj.lang.JoinPoint</code> (please
          note that around advice is <span class="emphasis"><em>required</em></span> to declare
          a first parameter of type
          <code class="interfacename">ProceedingJoinPoint</code>, which is a
          subclass of <code class="interfacename">JoinPoint</code>. The
          <code class="interfacename">JoinPoint</code> interface provides a number
          of useful methods such as <code class="literal">getArgs()</code> (returns the
          method arguments), <code class="methodname">getThis()</code> (returns the
          proxy object), <code class="methodname">getTarget()</code> (returns the
          target object), <code class="methodname">getSignature()</code> (returns a
          description of the method that is being advised) and
          <code class="methodname">toString()</code> (prints a useful description of
          the method being advised). Please do consult the Javadocs for full
          details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-params-passing"></a>Passing parameters to advice</h5></div></div></div><p>We've already seen how to bind the returned value or exception
          value (using after returning and after throwing advice). To make
          argument values available to the advice body, you can use the
          binding form of <code class="literal">args</code>. If a parameter name is used
          in place of a type name in an args expression, then the value of the
          corresponding argument will be passed as the parameter value when
          the advice is invoked. An example should make this clearer. Suppose
          you want to advise the execution of dao operations that take an
          Account object as the first parameter, and you need access to the
          account in the advice body. You could write the following:</p><pre class="programlisting">@Before(<span class="hl-string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp;"</span> + 
        <span class="hl-string">"args(account,..)"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateAccount(Account account) {
  <span class="hl-comment">// ...</span>
}</pre><p>The <code class="literal">args(account,..)</code> part of the pointcut
          expression serves two purposes: firstly, it restricts matching to
          only those method executions where the method takes at least one
          parameter, and the argument passed to that parameter is an instance
          of <code class="classname">Account</code>; secondly, it makes the actual
          <code class="classname">Account</code> object available to the advice via
          the <code class="literal">account</code> parameter.</p><p>Another way of writing this is to declare a pointcut that
          "provides" the <code class="classname">Account</code> object value when it
          matches a join point, and then just refer to the named pointcut from
          the advice. This would look as follows:</p><pre class="programlisting">@Pointcut(<span class="hl-string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp;"</span> + 
          <span class="hl-string">"args(account,..)"</span>)
<span class="hl-keyword">private</span> <span class="hl-keyword">void</span> accountDataAccessOperation(Account account) {}

@Before(<span class="hl-string">"accountDataAccessOperation(account)"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateAccount(Account account) {
  <span class="hl-comment">// ...</span>
}</pre><p>The interested reader is once more referred to the AspectJ
          programming guide for more details.</p><p>The proxy object (<code class="literal">this</code>), target object
          (<code class="literal">target</code>), and annotations (<code class="literal">@within,
          @target, @annotation, @args</code>) can all be bound in a similar
          fashion. The following example shows how you could match the
          execution of methods annotated with an
          <code class="interfacename">@Auditable</code> annotation, and extract
          the audit code.</p><p>First the definition of the
          <code class="interfacename">@Auditable</code> annotation:</p><pre class="programlisting">@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
<span class="hl-keyword">public</span> @<span class="hl-keyword">interface</span> Auditable {
	AuditCode value();
}</pre><p>And then the advice that matches the execution of
          <code class="interfacename">@Auditable</code> methods:</p><pre class="programlisting">@Before(<span class="hl-string">"com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; "</span> + 
        <span class="hl-string">"@annotation(auditable)"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> audit(Auditable auditable) {
  AuditCode code = auditable.value();
  <span class="hl-comment">// ...</span>
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-params-generics"></a>Advice parameters and generics</h5></div></div></div><p>Spring AOP can handle generics used in class declarations and
          method parameters. Suppose you have a generic type like this:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Sample&lt;T&gt; {
  <span class="hl-keyword">void</span> sampleGenericMethod(T param);
  <span class="hl-keyword">void</span> sampleGenericCollectionMethod(Collection&gt;T&gt; param);
}</pre><p>You can restrict interception of method types to certain
          parameter types by simply typing the advice parameter to the
          parameter type you want to intercept the method for:</p><pre class="programlisting">@Before(<span class="hl-string">"execution(* ..Sample+.sampleGenericMethod(*)) &amp;&amp; args(param)"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> beforeSampleMethod(MyType param) {
  <span class="hl-comment">// Advice implementation</span>
}</pre><p>That this works is pretty obvious as we already discussed
          above. However, it's worth pointing out that this won't work for
          generic collections. So you cannot define a pointcut like
          this:</p><pre class="programlisting">@Before(<span class="hl-string">"execution(* ..Sample+.sampleGenericCollectionMethod(*)) &amp;&amp; args(param)"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> beforeSampleMethod(Collection&lt;MyType&gt; param) {
  <span class="hl-comment">// Advice implementation</span>
}</pre><p>To make this work we would have to inspect every element of
          the collection, which is not reasonable as we also cannot decide how
          to treat <code class="literal">null</code> values in general. To achieve
          something similar to this you have to type the parameter to
          <code class="interfacename">Collection&lt;?&gt;</code> and manually
          check the type of the elements.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-params-names"></a>Determining argument names</h5></div></div></div><p>The parameter binding in advice invocations relies on matching
          names used in pointcut expressions to declared parameter names in
          (advice and pointcut) method signatures. Parameter names are
          <span class="emphasis"><em>not</em></span> available through Java reflection, so
          Spring AOP uses the following strategies to determine parameter
          names:</p><div class="orderedlist"><ol type="1"><li><p>If the parameter names have been specified by the user
              explicitly, then the specified parameter names are used: both
              the advice and the pointcut annotations have an optional
              "argNames" attribute which can be used to specify the argument
              names of the annotated method - these argument names
              <span class="emphasis"><em>are</em></span> available at runtime. For
              example:</p><pre class="programlisting">@Before(
   value=<span class="hl-string">"com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)"</span>,
   argNames=<span class="hl-string">"bean,auditable"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> audit(Object bean, Auditable auditable) {
  AuditCode code = auditable.value();
  <span class="hl-comment">// ... use code and bean</span>
}</pre><p>If the first parameter is of the
              <code class="interfacename">JoinPoint</code>,
              <code class="interfacename">ProceedingJoinPoint</code>, or
              <code class="interfacename">JoinPoint.StaticPart</code> type, you
              may leave out the name of the parameter from the value of the
              "argNames" attribute. For example, if you modify the preceding
              advice to receive the join point object, the "argNames"
              attribute need not include it:</p><pre class="programlisting">@Before(
   value=<span class="hl-string">"com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)"</span>,
   argNames=<span class="hl-string">"bean,auditable"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> audit(JoinPoint jp, Object bean, Auditable auditable) {
  AuditCode code = auditable.value();
  <span class="hl-comment">// ... use code, bean, and jp</span>
}</pre><p>The special treatment given to the first parameter of the
              <code class="interfacename">JoinPoint</code>,
              <code class="interfacename">ProceedingJoinPoint</code>, and
              <code class="interfacename">JoinPoint.StaticPart</code> types is
              particularly convenient for advice that do not collect any other
              join point context. In such situations, you may simply omit the
              "argNames" attribute. For example, the following advice need not
              declare the "argNames" attribute:</p><pre class="programlisting">@Before(
   <span class="hl-string">"com.xyz.lib.Pointcuts.anyPublicMethod()"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> audit(JoinPoint jp) {
  <span class="hl-comment">// ... use jp</span>
}</pre></li><li><p>Using the <code class="literal">'argNames'</code> attribute is a
              little clumsy, so if the <code class="literal">'argNames'</code> attribute
              has not been specified, then Spring AOP will look at the debug
              information for the class and try to determine the parameter
              names from the local variable table. This information will be
              present as long as the classes have been compiled with debug
              information (<code class="literal">'-g:vars'</code> at a minimum). The
              consequences of compiling with this flag on are: (1) your code
              will be slightly easier to understand (reverse engineer), (2)
              the class file sizes will be very slightly bigger (typically
              inconsequential), (3) the optimization to remove unused local
              variables will not be applied by your compiler. In other words,
              you should encounter no difficulties building with this flag
              on.</p><p class="remark"><i><span class="remark">If an @AspectJ aspect has been compiled by the AspectJ
              compiler (ajc) even without the debug information then there is
              no need to add the <code class="literal">argNames</code> attribute as the
              compiler will retain the needed information.</span></i></p></li><li><p>If the code has been compiled without the necessary debug
              information, then Spring AOP will attempt to deduce the pairing
              of binding variables to parameters (for example, if only one
              variable is bound in the pointcut expression, and the advice
              method only takes one parameter, the pairing is obvious!). If
              the binding of variables is ambiguous given the available
              information, then an
              <code class="exceptionname">AmbiguousBindingException</code> will be
              thrown.</p></li><li><p>If all of the above strategies fail then an
              <code class="exceptionname">IllegalArgumentException</code> will be
              thrown.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-proceeding-with-the-call"></a>Proceeding with arguments</h5></div></div></div><p>We remarked earlier that we would describe how to write a
          proceed call <span class="emphasis"><em>with arguments</em></span> that works
          consistently across Spring AOP and AspectJ. The solution is simply
          to ensure that the advice signature binds each of the method
          parameters in order. For example:</p><pre class="programlisting">@Around(<span class="hl-string">"execution(List&lt;Account&gt; find*(..)) &amp;&amp;"</span> +
        <span class="hl-string">"com.xyz.myapp.SystemArchitecture.inDataAccessLayer() &amp;&amp; "</span> +
        <span class="hl-string">"args(accountHolderNamePattern)"</span>)		
<span class="hl-keyword">public</span> Object preProcessQueryPattern(ProceedingJoinPoint pjp, String accountHolderNamePattern)
<span class="hl-keyword">throws</span> Throwable {
  String newPattern = preProcess(accountHolderNamePattern);
  <span class="hl-keyword">return</span> pjp.proceed(<span class="hl-keyword">new</span> Object[] {newPattern});
}        
</pre><p>In many cases you will be doing this binding anyway (as in the
          example above).</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-ataspectj-advice-ordering"></a>8.2.4.7&nbsp;Advice ordering</h4></div></div></div><p>What happens when multiple pieces of advice all want to run at
        the same join point? Spring AOP follows the same precedence rules as
        AspectJ to determine the order of advice execution. The highest
        precedence advice runs first "on the way in" (so given two pieces of
        before advice, the one with highest precedence runs first). "On the
        way out" from a join point, the highest precedence advice runs last
        (so given two pieces of after advice, the one with the highest
        precedence will run second).</p><p>When two pieces of advice defined in
        <span class="emphasis"><em>different</em></span> aspects both need to run at the same
        join point, unless you specify otherwise the order of execution is
        undefined. You can control the order of execution by specifying
        precedence. This is done in the normal Spring way by either
        implementing the
        <code class="interfacename">org.springframework.core.Ordered</code>
        interface in the aspect class or annotating it with the
        <code class="interfacename">Order</code> annotation. Given two aspects,
        the aspect returning the lower value from
        <code class="literal">Ordered.getValue()</code> (or the annotation value) has
        the higher precedence.</p><p>When two pieces of advice defined in <span class="emphasis"><em>the
        same</em></span> aspect both need to run at the same join point, the
        ordering is undefined (since there is no way to retrieve the
        declaration order via reflection for javac-compiled classes). Consider
        collapsing such advice methods into one advice method per join point
        in each aspect class, or refactor the pieces of advice into separate
        aspect classes - which can be ordered at the aspect level.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-introductions"></a>8.2.5&nbsp;Introductions</h3></div></div></div><p>Introductions (known as inter-type declarations in AspectJ) enable
      an aspect to declare that advised objects implement a given interface,
      and to provide an implementation of that interface on behalf of those
      objects.</p><p>An introduction is made using the
      <code class="interfacename">@DeclareParents</code> annotation. This
      annotation is used to declare that matching types have a new parent
      (hence the name). For example, given an interface
      <code class="interfacename">UsageTracked</code>, and an implementation of
      that interface <code class="classname">DefaultUsageTracked</code>, the following
      aspect declares that all implementors of service interfaces also
      implement the <code class="interfacename">UsageTracked</code> interface. (In
      order to expose statistics via JMX for example.)</p><pre class="programlisting">@Aspect
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UsageTracking {

  @DeclareParents(value=<span class="hl-string">"com.xzy.myapp.service.*+"</span>,
                  defaultImpl=DefaultUsageTracked.<span class="hl-keyword">class</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> UsageTracked mixin;
  
  @Before(<span class="hl-string">"com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp;"</span> +
          <span class="hl-string">"this(usageTracked)"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> recordUsage(UsageTracked usageTracked) {
    usageTracked.incrementUseCount();
  }
  
}</pre><p>The interface to be implemented is determined by the type of the
      annotated field. The <code class="literal">value</code> attribute of the
      <code class="interfacename">@DeclareParents</code> annotation is an AspectJ
      type pattern :- any bean of a matching type will implement the
      UsageTracked interface. Note that in the before advice of the above
      example, service beans can be directly used as implementations of the
      <code class="interfacename">UsageTracked</code> interface. If accessing a
      bean programmatically you would write the following:</p><pre class="programlisting">UsageTracked usageTracked = (UsageTracked) context.getBean(<span class="hl-string">"myService"</span>);</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-instantiation-models"></a>8.2.6&nbsp;Aspect instantiation models</h3></div></div></div><p class="remark"><i><span class="remark">(This is an advanced topic, so if you are just starting out with
      AOP you can safely skip it until later.)</span></i></p><p>By default there will be a single instance of each aspect within
      the application context. AspectJ calls this the singleton instantiation
      model. It is possible to define aspects with alternate lifecycles :-
      Spring supports AspectJ's <code class="literal">perthis</code> and
      <code class="literal">pertarget</code> instantiation models (<code class="literal">percflow,
      percflowbelow,</code> and <code class="literal">pertypewithin</code> are not
      currently supported).</p><p>A "perthis" aspect is declared by specifying a
      <code class="literal">perthis</code> clause in the
      <code class="interfacename">@Aspect</code> annotation. Let's look at an
      example, and then we'll explain how it works.</p><pre class="programlisting">@Aspect(<span class="hl-string">"perthis(com.xyz.myapp.SystemArchitecture.businessService())"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyAspect {

  <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> someState;
	
  @Before(com.xyz.myapp.SystemArchitecture.businessService())
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> recordServiceUsage() {
    <span class="hl-comment">// ...</span>
  }
  	
}</pre><p>The effect of the <code class="literal">'perthis'</code> clause is that one
      aspect instance will be created for each unique service object executing
      a business service (each unique object bound to 'this' at join points
      matched by the pointcut expression). The aspect instance is created the
      first time that a method is invoked on the service object. The aspect
      goes out of scope when the service object goes out of scope. Before the
      aspect instance is created, none of the advice within it executes. As
      soon as the aspect instance has been created, the advice declared within
      it will execute at matched join points, but only when the service object
      is the one this aspect is associated with. See the AspectJ programming
      guide for more information on per-clauses.</p><p>The <code class="literal">'pertarget'</code> instantiation model works in
      exactly the same way as perthis, but creates one aspect instance for
      each unique target object at matched join points.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ataspectj-example"></a>8.2.7&nbsp;Example</h3></div></div></div><p>Now that you have seen how all the constituent parts work, let's
      put them together to do something useful!</p><p>The execution of business services can sometimes fail due to
      concurrency issues (for example, deadlock loser). If the operation is
      retried, it is quite likely to succeed next time round. For business
      services where it is appropriate to retry in such conditions (idempotent
      operations that don't need to go back to the user for conflict
      resolution), we'd like to transparently retry the operation to avoid the
      client seeing a
      <code class="classname">PessimisticLockingFailureException</code>. This is a
      requirement that clearly cuts across multiple services in the service
      layer, and hence is ideal for implementing via an aspect.</p><p>Because we want to retry the operation, we will need to use around
      advice so that we can call proceed multiple times. Here's how the basic
      aspect implementation looks:</p><pre class="programlisting">@Aspect
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConcurrentOperationExecutor <span class="hl-keyword">implements</span> Ordered {
   
   <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> <span class="hl-keyword">int</span> DEFAULT_MAX_RETRIES = 2;

   <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> maxRetries = DEFAULT_MAX_RETRIES;
   <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> order = 1;

   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMaxRetries(<span class="hl-keyword">int</span> maxRetries) {
      <span class="hl-keyword">this</span>.maxRetries = maxRetries;
   }
   
   <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getOrder() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.order;
   }
   
   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setOrder(<span class="hl-keyword">int</span> order) {
      <span class="hl-keyword">this</span>.order = order;
   }
   
   @Around(<span class="hl-string">"com.xyz.myapp.SystemArchitecture.businessService()"</span>)
   <span class="hl-keyword">public</span> Object doConcurrentOperation(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable { 
      <span class="hl-keyword">int</span> numAttempts = 0;
      PessimisticLockingFailureException lockFailureException;
      <span class="hl-keyword">do</span> {
         numAttempts++;
         <span class="hl-keyword">try</span> { 
            <span class="hl-keyword">return</span> pjp.proceed();
         }
         <span class="hl-keyword">catch</span>(PessimisticLockingFailureException ex) {
            lockFailureException = ex;
         }
      }
      <span class="hl-keyword">while</span>(numAttempts &lt;= <span class="hl-keyword">this</span>.maxRetries);
      <span class="hl-keyword">throw</span> lockFailureException;
   }

}</pre><p>Note that the aspect implements the
      <code class="interfacename">Ordered</code> interface so we can set the
      precedence of the aspect higher than the transaction advice (we want a
      fresh transaction each time we retry). The <code class="literal">maxRetries</code>
      and <code class="literal">order</code> properties will both be configured by
      Spring. The main action happens in the
      <code class="literal">doConcurrentOperation</code> around advice. Notice that for
      the moment we're applying the retry logic to all
      <code class="literal">businessService()s</code>. We try to proceed, and if we fail
      with an <code class="classname">PessimisticLockingFailureException</code> we
      simply try again unless we have exhausted all of our retry
      attempts.</p><p>The corresponding Spring configuration is:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:aspectj-autoproxy</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"concurrentOperationExecutor"</span>
  <span class="hl-attribute">class</span>=<span class="hl-value">"com.xyz.myapp.service.impl.ConcurrentOperationExecutor"</span>&gt;
     &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"maxRetries"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"3"</span>/&gt;
     &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"order"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;  
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>To refine the aspect so that it only retries idempotent
      operations, we might define an <code class="interfacename">Idempotent</code>
      annotation:</p><pre class="programlisting">@Retention(RetentionPolicy.RUNTIME)
<span class="hl-keyword">public</span> @<span class="hl-keyword">interface</span> Idempotent {
  <span class="hl-comment">// marker annotation</span>
}</pre><p>and use the annotation to annotate the implementation of service
      operations. The change to the aspect to only retry idempotent operations
      simply involves refining the pointcut expression so that only
      <code class="interfacename">@Idempotent</code> operations match:</p><pre class="programlisting">@Around(<span class="hl-string">"com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp; "</span> + 
        <span class="hl-string">"@annotation(com.xyz.myapp.service.Idempotent)"</span>)
<span class="hl-keyword">public</span> Object doConcurrentOperation(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable { 
  ...	
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-schema"></a>8.3&nbsp;Schema-based AOP support</h2></div></div></div><p>If you are unable to use Java 5, or simply prefer an XML-based
    format, then Spring 2.0 also offers support for defining aspects using the
    new "aop" namespace tags. The exact same pointcut expressions and advice
    kinds are supported as when using the @AspectJ style, hence in this
    section we will focus on the new <span class="emphasis"><em>syntax</em></span> and refer the
    reader to the discussion in the previous section (<a class="xref" href="#aop-ataspectj" title="8.2&nbsp;@AspectJ support">Section&nbsp;8.2, &#8220;@AspectJ support&#8221;</a>) for an understanding of writing pointcut
    expressions and the binding of advice parameters.</p><p>To use the aop namespace tags described in this section, you need to
    import the spring-aop schema as described in <a class="xref" href="#xsd-config" title="Appendix&nbsp;C.&nbsp;XML Schema-based configuration">Appendix&nbsp;C, <i>XML Schema-based configuration</i></a>. See <a class="xref" href="#xsd-config-body-schemas-aop" title="C.2.7&nbsp;The aop schema">Section&nbsp;C.2.7, &#8220;The aop schema&#8221;</a> for how to import the tags in the
    aop namespace.</p><p>Within your Spring configurations, all aspect and advisor elements
    must be placed within an <code class="literal">&lt;aop:config&gt;</code> element
    (you can have more than one <code class="literal">&lt;aop:config&gt;</code> element
    in an application context configuration). An
    <code class="literal">&lt;aop:config&gt;</code> element can contain pointcut,
    advisor, and aspect elements (note these must be declared in that
    order).</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.gif"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">&lt;aop:config&gt;</code> style of configuration
      makes heavy use of Spring's <a class="link" href="#aop-autoproxy" title="9.9&nbsp;Using the &#34;autoproxy&#34; facility">auto-proxying</a> mechanism. This can cause
      issues (such as advice not being woven) if you are already using
      explicit auto-proxying via the use of
      <code class="classname">BeanNameAutoProxyCreator</code> or suchlike. The
      recommended usage pattern is to use either just the
      <code class="literal">&lt;aop:config&gt;</code> style, or just the
      <code class="interfacename">AutoProxyCreator</code> style.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-declaring-an-aspect"></a>8.3.1&nbsp;Declaring an aspect</h3></div></div></div><p>Using the schema support, an aspect is simply a regular Java
      object defined as a bean in your Spring application context. The state
      and behavior is captured in the fields and methods of the object, and
      the pointcut and advice information is captured in the XML.</p><p>An aspect is declared using the &lt;aop:aspect&gt; element, and
      the backing bean is referenced using the <code class="literal">ref</code>
      attribute:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:config</span>&gt;
  &lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span>&gt;
    ...
  &lt;<span class="hl-tag">/aop:aspect</span>&gt;
&lt;<span class="hl-tag">/aop:config</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"aBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>&gt;
  ...
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The bean backing the aspect ("<code class="literal">aBean</code>" in this
      case) can of course be configured and dependency injected just like any
      other Spring bean.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-pointcuts"></a>8.3.2&nbsp;Declaring a pointcut</h3></div></div></div><p>A named pointcut can be declared inside an &lt;aop:config&gt;
      element, enabling the pointcut definition to be shared across several
      aspects and advisors.</p><p>A pointcut representing the execution of any business service in
      the service layer could be defined as follows:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:config</span>&gt;

  &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessService"</span> 
        <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..))"</span>/&gt;

&lt;<span class="hl-tag">/aop:config</span>&gt;</pre><p>Note that the pointcut expression itself is using the same AspectJ
      pointcut expression language as described in <a class="xref" href="#aop-ataspectj" title="8.2&nbsp;@AspectJ support">Section&nbsp;8.2, &#8220;@AspectJ support&#8221;</a>. If you are using the schema based
      declaration style with Java 5, you can refer to named pointcuts defined
      in types (@Aspects) within the pointcut expression, but this feature is
      not available on JDK 1.4 and below (it relies on the Java 5 specific
      AspectJ reflection APIs). On JDK 1.5 therefore, another way of defining
      the above pointcut would be:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:config</span>&gt;

  &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessService"</span> 
        <span class="hl-attribute">expression</span>=<span class="hl-value">"com.xyz.myapp.SystemArchitecture.businessService()"</span>/&gt;

&lt;<span class="hl-tag">/aop:config</span>&gt;</pre><p>Assuming you have a <code class="literal">SystemArchitecture</code> aspect
      as described in <a class="xref" href="#aop-common-pointcuts" title="8.2.3.3&nbsp;Sharing common pointcut definitions">Section&nbsp;8.2.3.3, &#8220;Sharing common pointcut definitions&#8221;</a>.</p><p>Declaring a pointcut inside an aspect is very similar to declaring
      a top-level pointcut:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:config</span>&gt;

  &lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span>&gt;

    &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessService"</span> 
          <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..))"</span>/&gt;
          
    ...
    
  &lt;<span class="hl-tag">/aop:aspect</span>&gt;

&lt;<span class="hl-tag">/aop:config</span>&gt;</pre><p>Much the same way in an @AspectJ aspect, pointcuts declared using
      the schema based definition style may collect join point context. For
      example, the following pointcut collects the 'this' object as the join
      point context and passes it to advice:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:config</span>&gt;

  &lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span>&gt;

    &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessService"</span> 
          <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..)) &amp;amp;&amp;amp; this(service)"</span>/&gt;
    &lt;<span class="hl-tag">aop:before</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"businessService"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"monitor"</span>/&gt;
    ...
    
  &lt;<span class="hl-tag">/aop:aspect</span>&gt;

&lt;<span class="hl-tag">/aop:config</span>&gt;</pre><p>The advice must be declared to receive the collected join point
      context by including parameters of the matching names:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> monitor(Object service) {
    ...
}</pre><p>When combining pointcut sub-expressions, '&amp;&amp;' is awkward
      within an XML document, and so the keywords 'and', 'or' and 'not' can be
      used in place of '&amp;&amp;', '||' and '!' respectively. For example,
      the previous pointcut may be better written as:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:config</span>&gt;

  &lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span>&gt;

    &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessService"</span> 
          <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..)) and this(service)"</span>/&gt;
    &lt;<span class="hl-tag">aop:before</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"businessService"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"monitor"</span>/&gt;
    ...
    
  &lt;<span class="hl-tag">/aop:aspect</span>&gt;

&lt;<span class="hl-tag">/aop:config</span>&gt;</pre><p>Note that pointcuts defined in this way are referred to by their
      XML id and cannot be used as named pointcuts to form composite
      pointcuts. The named pointcut support in the schema based definition
      style is thus more limited than that offered by the @AspectJ
      style.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-advice"></a>8.3.3&nbsp;Declaring advice</h3></div></div></div><p>The same five advice kinds are supported as for the @AspectJ
      style, and they have exactly the same semantics.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-before"></a>8.3.3.1&nbsp;Before advice</h4></div></div></div><p>Before advice runs before a matched method execution. It is
        declared inside an <code class="literal">&lt;aop:aspect&gt;</code> using the
        &lt;aop:before&gt; element.</p><pre class="programlisting">&lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"beforeExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span>&gt;

    &lt;<span class="hl-tag">aop:before</span> 
      <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"dataAccessOperation"</span> 
      <span class="hl-attribute">method</span>=<span class="hl-value">"doAccessCheck"</span>/&gt;
          
    ...
    
&lt;<span class="hl-tag">/aop:aspect</span>&gt;</pre><p>Here <code class="literal">dataAccessOperation</code> is the id of a
        pointcut defined at the top (<code class="literal">&lt;aop:config&gt;</code>)
        level. To define the pointcut inline instead, replace the
        <code class="literal">pointcut-ref</code> attribute with a
        <code class="literal">pointcut</code> attribute:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"beforeExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span>&gt;

    &lt;<span class="hl-tag">aop:before</span> 
      <span class="hl-attribute">pointcut</span>=<span class="hl-value">"execution(* com.xyz.myapp.dao.*.*(..))"</span> 
      <span class="hl-attribute">method</span>=<span class="hl-value">"doAccessCheck"</span>/&gt;
          
    ...
    
&lt;<span class="hl-tag">/aop:aspect</span>&gt;</pre><p>As we noted in the discussion of the @AspectJ style, using named
        pointcuts can significantly improve the readability of your
        code.</p><p>The method attribute identifies a method
        (<code class="literal">doAccessCheck</code>) that provides the body of the
        advice. This method must be defined for the bean referenced by the
        aspect element containing the advice. Before a data access operation
        is executed (a method execution join point matched by the pointcut
        expression), the "doAccessCheck" method on the aspect bean will be
        invoked.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-after-returning"></a>8.3.3.2&nbsp;After returning advice</h4></div></div></div><p>After returning advice runs when a matched method execution
        completes normally. It is declared inside an
        <code class="literal">&lt;aop:aspect&gt;</code> in the same way as before
        advice. For example:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"afterReturningExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span>&gt;

    &lt;<span class="hl-tag">aop:after-returning</span> 
      <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"dataAccessOperation"</span> 
      <span class="hl-attribute">method</span>=<span class="hl-value">"doAccessCheck"</span>/&gt;
          
    ...
    
&lt;<span class="hl-tag">/aop:aspect</span>&gt;</pre><p>Just as in the @AspectJ style, it is possible to get hold of the
        return value within the advice body. Use the returning attribute to
        specify the name of the parameter to which the return value should be
        passed:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"afterReturningExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span>&gt;

    &lt;<span class="hl-tag">aop:after-returning</span> 
      <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"dataAccessOperation"</span>
      <span class="hl-attribute">returning</span>=<span class="hl-value">"retVal"</span> 
      <span class="hl-attribute">method</span>=<span class="hl-value">"doAccessCheck"</span>/&gt;
          
    ...
    
&lt;<span class="hl-tag">/aop:aspect</span>&gt;</pre><p>The doAccessCheck method must declare a parameter named
        <code class="literal">retVal</code>. The type of this parameter constrains
        matching in the same way as described for @AfterReturning. For
        example, the method signature may be declared as:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck(Object retVal) {...</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-after-throwing"></a>8.3.3.3&nbsp;After throwing advice</h4></div></div></div><p>After throwing advice executes when a matched method execution
        exits by throwing an exception. It is declared inside an
        <code class="literal">&lt;aop:aspect&gt;</code> using the after-throwing
        element:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"afterThrowingExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span>&gt;

    &lt;<span class="hl-tag">aop:after-throwing</span>
      <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"dataAccessOperation"</span> 
      <span class="hl-attribute">method</span>=<span class="hl-value">"doRecoveryActions"</span>/&gt;
          
    ...
    
&lt;<span class="hl-tag">/aop:aspect</span>&gt;</pre><p>Just as in the @AspectJ style, it is possible to get hold of the
        thrown exception within the advice body. Use the throwing attribute to
        specify the name of the parameter to which the exception should be
        passed:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"afterThrowingExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span>&gt;

    &lt;<span class="hl-tag">aop:after-throwing</span> 
      <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"dataAccessOperation"</span>
      <span class="hl-attribute">throwing</span>=<span class="hl-value">"dataAccessEx"</span> 
      <span class="hl-attribute">method</span>=<span class="hl-value">"doRecoveryActions"</span>/&gt;
          
    ...
    
&lt;<span class="hl-tag">/aop:aspect</span>&gt;</pre><p>The doRecoveryActions method must declare a parameter named
        <code class="literal">dataAccessEx</code>. The type of this parameter constrains
        matching in the same way as described for @AfterThrowing. For example,
        the method signature may be declared as:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doRecoveryActions(DataAccessException dataAccessEx) {...</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-after-finally"></a>8.3.3.4&nbsp;After (finally) advice</h4></div></div></div><p>After (finally) advice runs however a matched method execution
        exits. It is declared using the <code class="literal">after</code>
        element:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"afterFinallyExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span>&gt;

    &lt;<span class="hl-tag">aop:after</span>
      <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"dataAccessOperation"</span> 
      <span class="hl-attribute">method</span>=<span class="hl-value">"doReleaseLock"</span>/&gt;
          
    ...
    
&lt;<span class="hl-tag">/aop:aspect</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-around"></a>8.3.3.5&nbsp;Around advice</h4></div></div></div><p>The final kind of advice is around advice. Around advice runs
        "around" a matched method execution. It has the opportunity to do work
        both before and after the method executes, and to determine when, how,
        and even if, the method actually gets to execute at all. Around advice
        is often used if you need to share state before and after a method
        execution in a thread-safe manner (starting and stopping a timer for
        example). Always use the least powerful form of advice that meets your
        requirements; don't use around advice if simple before advice would
        do.</p><p>Around advice is declared using the
        <code class="literal">aop:around</code> element. The first parameter of the
        advice method must be of type
        <code class="interfacename">ProceedingJoinPoint</code>. Within the body of
        the advice, calling <code class="literal">proceed()</code> on the
        <code class="interfacename">ProceedingJoinPoint</code> causes the
        underlying method to execute. The <code class="literal">proceed</code> method
        may also be calling passing in an <code class="classname">Object[]</code> -
        the values in the array will be used as the arguments to the method
        execution when it proceeds. See <a class="xref" href="#aop-ataspectj-around-advice" title="8.2.4.5&nbsp;Around advice">Section&nbsp;8.2.4.5, &#8220;Around advice&#8221;</a> for notes on calling proceed
        with an <code class="classname">Object[]</code>.</p><pre class="programlisting">&lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"aroundExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span>&gt;

    &lt;<span class="hl-tag">aop:around</span>
      <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"businessService"</span> 
      <span class="hl-attribute">method</span>=<span class="hl-value">"doBasicProfiling"</span>/&gt;
          
    ...
    
&lt;<span class="hl-tag">/aop:aspect</span>&gt;</pre><p>The implementation of the <code class="literal">doBasicProfiling</code>
        advice would be exactly the same as in the @AspectJ example (minus the
        annotation of course):</p><pre class="programlisting"><span class="hl-keyword">public</span> Object doBasicProfiling(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
    <span class="hl-comment">// start stopwatch</span>
    Object retVal = pjp.proceed();
    <span class="hl-comment">// stop stopwatch</span>
    <span class="hl-keyword">return</span> retVal;
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-params"></a>8.3.3.6&nbsp;Advice parameters</h4></div></div></div><p>The schema based declaration style supports fully typed advice
        in the same way as described for the @AspectJ support - by matching
        pointcut parameters by name against advice method parameters. See
        <a class="xref" href="#aop-ataspectj-advice-params" title="8.2.4.6&nbsp;Advice parameters">Section&nbsp;8.2.4.6, &#8220;Advice parameters&#8221;</a> for details. If you
        wish to explicitly specify argument names for the advice methods (not
        relying on the detection strategies previously described) then this is
        done using the <code class="literal">arg-names</code> attribute of the advice
        element, which is treated in the same manner to the "argNames"
        attribute in an advice annotation as described in <a class="xref" href="#aop-ataspectj-advice-params-names" title="Determining argument names">the section called &#8220;Determining argument names&#8221;</a>. For example:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:before</span>
  <span class="hl-attribute">pointcut</span>=<span class="hl-value">"com.xyz.lib.Pointcuts.anyPublicMethod() and @annotation(auditable)"</span>
  <span class="hl-attribute">method</span>=<span class="hl-value">"audit"</span>
  <span class="hl-attribute">arg-names</span>=<span class="hl-value">"auditable"</span>/&gt;</pre><p>The <code class="literal">arg-names</code> attribute accepts a
        comma-delimited list of parameter names.</p><p>Find below a slightly more involved example of the XSD-based
        approach that illustrates some around advice used in conjunction with
        a number of strongly typed parameters.</p><pre class="programlisting"><span class="hl-keyword">package</span> x.y.service;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FooService {

   Foo getFoo(String fooName, <span class="hl-keyword">int</span> age);
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultFooService <span class="hl-keyword">implements</span> FooService {

   <span class="hl-keyword">public</span> Foo getFoo(String name, <span class="hl-keyword">int</span> age) {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo(name, age);
   }
}</pre><p>Next up is the aspect. Notice the fact that the
        <code class="methodname">profile(..)</code> method accepts a number of
        strongly-typed parameters, the first of which happens to be the join
        point used to proceed with the method call: the presence of this
        parameter is an indication that the
        <code class="methodname">profile(..)</code> is to be used as
        <code class="literal">around</code> advice:</p><pre class="programlisting"><span class="hl-keyword">package</span> x.y;

<span class="hl-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;
<span class="hl-keyword">import</span> org.springframework.util.StopWatch;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleProfiler {

   <span class="hl-keyword">public</span> Object profile(ProceedingJoinPoint call, String name, <span class="hl-keyword">int</span> age) <span class="hl-keyword">throws</span> Throwable {
      StopWatch clock = <span class="hl-keyword">new</span> StopWatch(
            <span class="hl-string">"Profiling for '"</span> + name + <span class="hl-string">"' and '"</span> + age + <span class="hl-string">"'"</span>);
      <span class="hl-keyword">try</span> {
         clock.start(call.toShortString());
         <span class="hl-keyword">return</span> call.proceed();
      } <span class="hl-keyword">finally</span> {
         clock.stop();
         System.out.println(clock.prettyPrint());
      }
   }
}</pre><p>Finally, here is the XML configuration that is required to
        effect the execution of the above advice for a particular join
        point:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;

   &lt;<span class="hl-comment">!-- this is the object that will be proxied by Spring's AOP infrastructure --</span>&gt;
   &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span>/&gt;

   &lt;<span class="hl-comment">!-- this is the actual advice itself --</span>&gt;
   &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profiler"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.SimpleProfiler"</span>/&gt;

   &lt;<span class="hl-tag">aop:config</span>&gt;
      &lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"profiler"</span>&gt;

         &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"theExecutionOfSomeFooServiceMethod"</span>
                    <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.FooService.getFoo(String,int))
                    and args(name, age)"</span>/&gt;

         &lt;<span class="hl-tag">aop:around</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"theExecutionOfSomeFooServiceMethod"</span>
                  <span class="hl-attribute">method</span>=<span class="hl-value">"profile"</span>/&gt;

      &lt;<span class="hl-tag">/aop:aspect</span>&gt;
   &lt;<span class="hl-tag">/aop:config</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>If we had the following driver script, we would get output
        something like this on standard output:</p><pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.beans.factory.BeanFactory;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;
<span class="hl-keyword">import</span> x.y.service.FooService;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Boot {

   <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) <span class="hl-keyword">throws</span> Exception {
      BeanFactory ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"x/y/plain.xml"</span>);
      FooService foo = (FooService) ctx.getBean(<span class="hl-string">"fooService"</span>);
      foo.getFoo(<span class="hl-string">"Pengo"</span>, 12);
   }
}</pre><pre class="programlisting">StopWatch 'Profiling for 'Pengo' and '12'': running time (millis) = 0
-----------------------------------------
ms     %     Task name
-----------------------------------------
00000  ?  execution(getFoo)</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-ordering"></a>8.3.3.7&nbsp;Advice ordering</h4></div></div></div><p>When multiple advice needs to execute at the same join point
        (executing method) the ordering rules are as described in <a class="xref" href="#aop-ataspectj-advice-ordering" title="8.2.4.7&nbsp;Advice ordering">Section&nbsp;8.2.4.7, &#8220;Advice ordering&#8221;</a>. The precedence between
        aspects is determined by either adding the
        <code class="interfacename">Order</code> annotation to the bean backing
        the aspect or by having the bean implement the
        <code class="interfacename">Ordered</code> interface.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-introductions"></a>8.3.4&nbsp;Introductions</h3></div></div></div><p>Introductions (known as inter-type declarations in AspectJ) enable
      an aspect to declare that advised objects implement a given interface,
      and to provide an implementation of that interface on behalf of those
      objects.</p><p>An introduction is made using the
      <code class="literal">aop:declare-parents</code> element inside an
      <code class="literal">aop:aspect</code> This element is used to declare that
      matching types have a new parent (hence the name). For example, given an
      interface <code class="interfacename">UsageTracked</code>, and an
      implementation of that interface
      <code class="classname">DefaultUsageTracked</code>, the following aspect
      declares that all implementors of service interfaces also implement the
      <code class="interfacename">UsageTracked</code> interface. (In order to
      expose statistics via JMX for example.)</p><pre class="programlisting">&lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"usageTrackerAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"usageTracking"</span>&gt;

  &lt;<span class="hl-tag">aop:declare-parents</span>
      <span class="hl-attribute">types-matching</span>=<span class="hl-value">"com.xzy.myapp.service.*+"</span>
      <span class="hl-attribute">implement-interface</span>=<span class="hl-value">"com.xyz.myapp.service.tracking.UsageTracked"</span>
      <span class="hl-attribute">default-impl</span>=<span class="hl-value">"com.xyz.myapp.service.tracking.DefaultUsageTracked"</span>/&gt;
  
  &lt;<span class="hl-tag">aop:before</span>
    <span class="hl-attribute">pointcut</span>=<span class="hl-value">"com.xyz.myapp.SystemArchitecture.businessService()
              and this(usageTracked)"</span>
    <span class="hl-attribute">method</span>=<span class="hl-value">"recordUsage"</span>/&gt;
  
&lt;<span class="hl-tag">/aop:aspect</span>&gt;</pre><p>The class backing the <code class="literal">usageTracking</code> bean would
      contain the method:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> recordUsage(UsageTracked usageTracked) {
    usageTracked.incrementUseCount();
}</pre><p>The interface to be implemented is determined by
      <code class="literal">implement-interface</code> attribute. The value of the
      <code class="literal">types-matching</code> attribute is an AspectJ type pattern
      :- any bean of a matching type will implement the
      <code class="interfacename">UsageTracked</code> interface. Note that in the
      before advice of the above example, service beans can be directly used
      as implementations of the <code class="interfacename">UsageTracked</code>
      interface. If accessing a bean programmatically you would write the
      following:</p><pre class="programlisting">UsageTracked usageTracked = (UsageTracked) context.getBean(<span class="hl-string">"myService"</span>);</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-instatiation-models"></a>8.3.5&nbsp;Aspect instantiation models</h3></div></div></div><p>The only supported instantiation model for schema-defined aspects
      is the singleton model. Other instantiation models may be supported in
      future releases.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-advisors"></a>8.3.6&nbsp;Advisors</h3></div></div></div><p>The concept of "advisors" is brought forward from the AOP support
      defined in Spring 1.2 and does not have a direct equivalent in AspectJ.
      An advisor is like a small self-contained aspect that has a single piece
      of advice. The advice itself is represented by a bean, and must
      implement one of the advice interfaces described in <a class="xref" href="#aop-api-advice-types" title="9.3.2&nbsp;Advice types in Spring">Section&nbsp;9.3.2, &#8220;Advice types in Spring&#8221;</a>. Advisors can take advantage of
      AspectJ pointcut expressions though.</p><p>Spring 2.0 supports the advisor concept with the
      <code class="literal">&lt;aop:advisor&gt;</code> element. You will most commonly
      see it used in conjunction with transactional advice, which also has its
      own namespace support in Spring 2.0. Here's how it looks:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:config</span>&gt;

  &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessService"</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..))"</span>/&gt;

  &lt;<span class="hl-tag">aop:advisor</span> 
      <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"businessService"</span>
      <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"tx-advice"</span>/&gt;
      
&lt;<span class="hl-tag">/aop:config</span>&gt;

&lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"tx-advice"</span>&gt;
  &lt;<span class="hl-tag">tx:attributes</span>&gt;
    &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"REQUIRED"</span>/&gt;
  &lt;<span class="hl-tag">/tx:attributes</span>&gt;
&lt;<span class="hl-tag">/tx:advice</span>&gt;</pre></div><p>As well as the <code class="literal">pointcut-ref</code> attribute used in the
    above example, you can also use the <code class="literal">pointcut</code> attribute
    to define a pointcut expression inline.</p><p>To define the precedence of an advisor so that the advice can
    participate in ordering, use the <code class="literal">order</code> attribute to
    define the <code class="literal">Ordered</code> value of the advisor.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-example"></a>8.3.7&nbsp;Example</h3></div></div></div><p>Let's see how the concurrent locking failure retry example from
      <a class="xref" href="#aop-ataspectj-example" title="8.2.7&nbsp;Example">Section&nbsp;8.2.7, &#8220;Example&#8221;</a> looks when rewritten using the
      schema support.</p><p>The execution of business services can sometimes fail due to
      concurrency issues (for example, deadlock loser). If the operation is
      retried, it is quite likely it will succeed next time round. For
      business services where it is appropriate to retry in such conditions
      (idempotent operations that don't need to go back to the user for
      conflict resolution), we'd like to transparently retry the operation to
      avoid the client seeing a
      <code class="classname">PessimisticLockingFailureException</code>. This is a
      requirement that clearly cuts across multiple services in the service
      layer, and hence is ideal for implementing via an aspect.</p><p>Because we want to retry the operation, we'll need to use around
      advice so that we can call proceed multiple times. Here's how the basic
      aspect implementation looks (it's just a regular Java class using the
      schema support):</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConcurrentOperationExecutor <span class="hl-keyword">implements</span> Ordered {
   
   <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> <span class="hl-keyword">int</span> DEFAULT_MAX_RETRIES = 2;

   <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> maxRetries = DEFAULT_MAX_RETRIES;
   <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> order = 1;

   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMaxRetries(<span class="hl-keyword">int</span> maxRetries) {
      <span class="hl-keyword">this</span>.maxRetries = maxRetries;
   }
   
   <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getOrder() {
      <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.order;
   }
   
   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setOrder(<span class="hl-keyword">int</span> order) {
      <span class="hl-keyword">this</span>.order = order;
   }
   
   <span class="hl-keyword">public</span> Object doConcurrentOperation(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable { 
      <span class="hl-keyword">int</span> numAttempts = 0;
      PessimisticLockingFailureException lockFailureException;
      <span class="hl-keyword">do</span> {
         numAttempts++;
         <span class="hl-keyword">try</span> { 
            <span class="hl-keyword">return</span> pjp.proceed();
         }
         <span class="hl-keyword">catch</span>(PessimisticLockingFailureException ex) {
            lockFailureException = ex;
         }
      }
      <span class="hl-keyword">while</span>(numAttempts &lt;= <span class="hl-keyword">this</span>.maxRetries);
      <span class="hl-keyword">throw</span> lockFailureException;
   }

}</pre><p>Note that the aspect implements the
      <code class="interfacename">Ordered</code> interface so we can set the
      precedence of the aspect higher than the transaction advice (we want a
      fresh transaction each time we retry). The <code class="literal">maxRetries</code>
      and <code class="literal">order</code> properties will both be configured by
      Spring. The main action happens in the
      <code class="literal">doConcurrentOperation</code> around advice method. We try to
      proceed, and if we fail with a
      <code class="classname">PessimisticLockingFailureException</code> we simply try
      again unless we have exhausted all of our retry attempts.</p><p class="remark"><i><span class="remark">This class is identical to the one used in the @AspectJ example,
      but with the annotations removed.</span></i></p><p>The corresponding Spring configuration is:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:config</span>&gt;

  &lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"concurrentOperationRetry"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"concurrentOperationExecutor"</span>&gt;

    &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"idempotentOperation"</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..))"</span>/&gt;
       
    &lt;<span class="hl-tag">aop:around</span>
       <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"idempotentOperation"</span>
       <span class="hl-attribute">method</span>=<span class="hl-value">"doConcurrentOperation"</span>/&gt;
  
  &lt;<span class="hl-tag">/aop:aspect</span>&gt;

&lt;<span class="hl-tag">/aop:config</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"concurrentOperationExecutor"</span>
  <span class="hl-attribute">class</span>=<span class="hl-value">"com.xyz.myapp.service.impl.ConcurrentOperationExecutor"</span>&gt;
     &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"maxRetries"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"3"</span>/&gt;
     &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"order"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;  
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Notice that for the time being we assume that all business
      services are idempotent. If this is not the case we can refine the
      aspect so that it only retries genuinely idempotent operations, by
      introducing an <code class="interfacename">Idempotent</code>
      annotation:</p><pre class="programlisting">@Retention(RetentionPolicy.RUNTIME)
<span class="hl-keyword">public</span> @<span class="hl-keyword">interface</span> Idempotent {
  <span class="hl-comment">// marker annotation</span>
}</pre><p>and using the annotation to annotate the implementation of service
      operations. The change to the aspect to retry only idempotent operations
      simply involves refining the pointcut expression so that only
      <code class="interfacename">@Idempotent</code> operations match:</p><pre class="programlisting">  &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"idempotentOperation"</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..)) and
                    @annotation(com.xyz.myapp.service.Idempotent)"</span>/&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-choosing"></a>8.4&nbsp;Choosing which AOP declaration style to use</h2></div></div></div><p>Once you have decided that an aspect is the best approach for
    implementing a given requirement, how do you decide between using Spring
    AOP or AspectJ, and between the Aspect language (code) style, @AspectJ
    annotation style, or the Spring XML style? These decisions are influenced
    by a number of factors including application requirements, development
    tools, and team familiarity with AOP.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-spring-or-aspectj"></a>8.4.1&nbsp;Spring AOP or full AspectJ?</h3></div></div></div><p>Use the simplest thing that can work. Spring AOP is simpler than
      using full AspectJ as there is no requirement to introduce the AspectJ
      compiler / weaver into your development and build processes. If you only
      need to advise the execution of operations on Spring beans, then Spring
      AOP is the right choice. If you need to advise objects not managed by
      the Spring container (such as domain objects typically), then you will
      need to use AspectJ. You will also need to use AspectJ if you wish to
      advise join points other than simple method executions (for example,
      field get or set join points, and so on).</p><p>When using AspectJ, you have the choice of the AspectJ language
      syntax (also known as the "code style") or the @AspectJ annotation
      style. Clearly, if you are not using Java 5+ then the choice has been
      made for you... use the code style. If aspects play a large role in your
      design, and you are able to use the <a class="ulink" href="http://www.eclipse.org/ajdt/" target="_top">AspectJ Development Tools
      (AJDT)</a> plugin for Eclipse, then the AspectJ language syntax is
      the preferred option: it is cleaner and simpler because the language was
      purposefully designed for writing aspects. If you are not using Eclipse,
      or have only a few aspects that do not play a major role in your
      application, then you may want to consider using the @AspectJ style and
      sticking with a regular Java compilation in your IDE, and adding an
      aspect weaving phase to your build script.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ataspectj-or-xml"></a>8.4.2&nbsp;@AspectJ or XML for Spring AOP?</h3></div></div></div><p>If you have chosen to use Spring AOP, then you have a choice of
      @AspectJ or XML style. Clearly if you are not running on Java 5+, then
      the XML style is the appropriate choice; for Java 5 projects there are
      various tradeoffs to consider.</p><p>The XML style will be most familiar to existing Spring users. It
      can be used with any JDK level (referring to named pointcuts from within
      pointcut expressions does still require Java 5+ though) and is backed by
      genuine POJOs. When using AOP as a tool to configure enterprise services
      then XML can be a good choice (a good test is whether you consider the
      pointcut expression to be a part of your configuration you might want to
      change independently). With the XML style arguably it is clearer from
      your configuration what aspects are present in the system.</p><p>The XML style has two disadvantages. Firstly it does not fully
      encapsulate the implementation of the requirement it addresses in a
      single place. The DRY principle says that there should be a single,
      unambiguous, authoritative representation of any piece of knowledge
      within a system. When using the XML style, the knowledge of
      <span class="emphasis"><em>how</em></span> a requirement is implemented is split across
      the declaration of the backing bean class, and the XML in the
      configuration file. When using the @AspectJ style there is a single
      module - the aspect - in which this information is encapsulated.
      Secondly, the XML style is slightly more limited in what it can express
      than the @AspectJ style: only the "singleton" aspect instantiation model
      is supported, and it is not possible to combine named pointcuts declared
      in XML. For example, in the @AspectJ style you can write something
      like:</p><pre class="programlisting">  @Pointcut(execution(* get*()))
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> propertyAccess() {}

  @Pointcut(execution(org.xyz.Account+ *(..))
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> operationReturningAnAccount() {}

  @Pointcut(propertyAccess() &amp;&amp; operationReturningAnAccount())
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> accountPropertyAccess() {}</pre><p>In the XML style I can declare the first two pointcuts:</p><pre class="programlisting">  &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"propertyAccess"</span>
      <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* get*())"</span>/&gt;

  &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"operationReturningAnAccount"</span>
      <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(org.xyz.Account+ *(..))"</span>/&gt;</pre><p>The downside of the XML approach is that you cannot define the
      '<code class="literal">accountPropertyAccess</code>' pointcut by combining these
      definitions.</p><p>The @AspectJ style supports additional instantiation models, and
      richer pointcut composition. It has the advantage of keeping the aspect
      as a modular unit. It also has the advantage the @AspectJ aspects can be
      understood (and thus consumed) both by Spring AOP and by AspectJ - so if
      you later decide you need the capabilities of AspectJ to implement
      additional requirements then it is very easy to migrate to an
      AspectJ-based approach. On balance the Spring team prefer the @AspectJ
      style whenever you have aspects that do more than simple "configuration"
      of enterprise services.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-mixing-styles"></a>8.5&nbsp;Mixing aspect types</h2></div></div></div><p>It is perfectly possible to mix @AspectJ style aspects using the
    autoproxying support, schema-defined <code class="literal">&lt;aop:aspect&gt;</code>
    aspects, <code class="literal">&lt;aop:advisor&gt;</code> declared advisors and even
    proxies and interceptors defined using the Spring 1.2 style in the same
    configuration. All of these are implemented using the same underlying
    support mechanism and will co-exist without any difficulty.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-proxying"></a>8.6&nbsp;Proxying mechanisms</h2></div></div></div><p>Spring AOP uses either JDK dynamic proxies or CGLIB to create the
    proxy for a given target object. (JDK dynamic proxies are preferred
    whenever you have a choice).</p><p>If the target object to be proxied implements at least one interface
    then a JDK dynamic proxy will be used. All of the interfaces implemented
    by the target type will be proxied. If the target object does not
    implement any interfaces then a CGLIB proxy will be created.</p><p>If you want to force the use of CGLIB proxying (for example, to
    proxy every method defined for the target object, not just those
    implemented by its interfaces) you can do so. However, there are some
    issues to consider:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">final</code> methods cannot be advised, as they
        cannot be overriden.</p></li><li><p>You will need the CGLIB 2 binaries on your classpath, whereas
        dynamic proxies are available with the JDK. Spring will automatically
        warn you when it needs CGLIB and the CGLIB library classes are not
        found on the classpath.</p></li><li><p>The constructor of your proxied object will be called twice.
        This is a natural consequence of the CGLIB proxy model whereby a
        subclass is generated for each proxied object. For each proxied
        instance, two objects are created: the actual proxied object and an
        instance of the subclass that implements the advice. This behavior is
        not exhibited when using JDK proxies. Usually, calling the constructor
        of the proxied type twice, is not an issue, as there are usually only
        assignments taking place and no real logic is implemented in the
        constructor.</p></li></ul></div><p><a name="aop-autoproxy-force-CGLIB"></a>To force the use of CGLIB proxies set
    the value of the <code class="literal">proxy-target-class</code> attribute of the
    <code class="literal">&lt;aop:config&gt;</code> element to true:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:config</span> <span class="hl-attribute">proxy-target-class</span>=<span class="hl-value">"true"</span>&gt;
    &lt;<span class="hl-comment">!-- other beans defined here... --</span>&gt;
&lt;<span class="hl-tag">/aop:config</span>&gt;</pre><p>To force CGLIB proxying when using the @AspectJ autoproxy support,
    set the <code class="literal">'proxy-target-class'</code> attribute of the
    <code class="literal">&lt;aop:aspectj-autoproxy&gt;</code> element to
    <code class="literal">true</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:aspectj-autoproxy</span> <span class="hl-attribute">proxy-target-class</span>=<span class="hl-value">"true"</span>/&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Multiple <code class="literal">&lt;aop:config/&gt;</code> sections are
      collapsed into a single unified auto-proxy creator at runtime, which
      applies the <span class="emphasis"><em>strongest</em></span> proxy settings that any of
      the <code class="literal">&lt;aop:config/&gt;</code> sections (typically from
      different XML bean definition files) specified. This also applies to the
      <code class="literal">&lt;tx:annotation-driven/&gt;</code> and
      <code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code> elements.</p><p>To be clear: using '<code class="literal">proxy-target-class="true"</code>'
      on <code class="literal">&lt;tx:annotation-driven/&gt;</code>,
      <code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code> or
      <code class="literal">&lt;aop:config/&gt;</code> elements will force the use of
      CGLIB proxies <span class="emphasis"><em>for all three of them</em></span>.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-understanding-aop-proxies"></a>8.6.1&nbsp;Understanding AOP proxies</h3></div></div></div><p>Spring AOP is <span class="emphasis"><em>proxy-based</em></span>. It is vitally
      important that you grasp the semantics of what that last statement
      actually means before you write your own aspects or use any of the
      Spring AOP-based aspects supplied with the Spring Framework.</p><p>Consider first the scenario where you have a plain-vanilla,
      un-proxied, nothing-special-about-it, straight object reference, as
      illustrated by the following code snippet.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimplePojo <span class="hl-keyword">implements</span> Pojo {

   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> foo() {
      <span class="hl-comment">// this next method invocation is a direct call on the 'this' reference</span>
      <span class="hl-keyword">this</span>.bar();
   }
   
   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> bar() {
      <span class="hl-comment">// some logic...</span>
   }
}</pre><p>If you invoke a method on an object reference, the method is
      invoked <span class="emphasis"><em>directly</em></span> on that object reference, as can
      be seen below.</p><div class="mediaobject" align="center"><img src="images/aop-proxy-plain-pojo-call.png" align="middle"></div><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Main {

   <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
   
      Pojo pojo = <span class="hl-keyword">new</span> SimplePojo();
      
      <span class="hl-comment">// this is a direct method call on the 'pojo' reference</span>
      pojo.foo();
   }
}</pre><p>Things change slightly when the reference that client code has is
      a proxy. Consider the following diagram and code snippet.</p><div class="mediaobject" align="center"><img src="images/aop-proxy-call.png" align="middle"></div><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Main {

   <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
   
      ProxyFactory factory = <span class="hl-keyword">new</span> ProxyFactory(<span class="hl-keyword">new</span> SimplePojo());
      factory.addInterface(Pojo.<span class="hl-keyword">class</span>);
      factory.addAdvice(<span class="hl-keyword">new</span> RetryAdvice());

      Pojo pojo = (Pojo) factory.getProxy();
      
      <span class="hl-comment">// this is a method call on the proxy!</span>
      pojo.foo();
   }
}</pre><p>The key thing to understand here is that the client code inside
      the <code class="methodname">main(..)</code> of the <code class="classname">Main</code>
      class <span class="emphasis"><em>has a reference to the proxy</em></span>. This means that
      method calls on that object reference will be calls on the proxy, and as
      such the proxy will be able to delegate to all of the interceptors
      (advice) that are relevant to that particular method call. However, once
      the call has finally reached the target object, the
      <code class="classname">SimplePojo</code> reference in this case, any method
      calls that it may make on itself, such as
      <code class="methodname">this.bar()</code> or
      <code class="methodname">this.foo()</code>, are going to be invoked against the
      <span class="emphasis"><em><code class="literal">this</code></em></span> reference, and
      <span class="emphasis"><em>not</em></span> the proxy. This has important implications. It
      means that self-invocation is <span class="emphasis"><em>not</em></span> going to result
      in the advice associated with a method invocation getting a chance to
      execute.</p><p>Okay, so what is to be done about this? The best approach (the
      term best is used loosely here) is to refactor your code such that the
      self-invocation does not happen. For sure, this does entail some work on
      your part, but it is the best, least-invasive approach. The next
      approach is absolutely horrendous, and I am almost reticent to point it
      out precisely because it is so horrendous. You can (choke!) totally tie
      the logic within your class to Spring AOP by doing this:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimplePojo <span class="hl-keyword">implements</span> Pojo {

   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> foo() {
      <span class="hl-comment">// this works, but... gah!</span>
      ((Pojo) AopContext.currentProxy()).bar();
   }
   
   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> bar() {
      <span class="hl-comment">// some logic...</span>
   }
}</pre><p>This totally couples your code to Spring AOP,
      <span class="emphasis"><em>and</em></span> it makes the class itself aware of the fact
      that it is being used in an AOP context, which flies in the face of AOP.
      It also requires some additional configuration when the proxy is being
      created:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Main {

   <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
   
      ProxyFactory factory = <span class="hl-keyword">new</span> ProxyFactory(<span class="hl-keyword">new</span> SimplePojo());
      factory.adddInterface(Pojo.<span class="hl-keyword">class</span>);
      factory.addAdvice(<span class="hl-keyword">new</span> RetryAdvice());
      factory.setExposeProxy(true);

      Pojo pojo = (Pojo) factory.getProxy();

      <span class="hl-comment">// this is a method call on the proxy!</span>
      pojo.foo();
   }
}</pre><p>Finally, it must be noted that AspectJ does not have this
      self-invocation issue because it is not a proxy-based AOP
      framework.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-aspectj-programmatic"></a>8.7&nbsp;Programmatic creation of @AspectJ Proxies</h2></div></div></div><p>In addition to declaring aspects in your configuration using either
    <code class="literal">&lt;aop:config&gt;</code> or
    <code class="literal">&lt;aop:aspectj-autoproxy&gt;</code>, it is also possible
    programmatically to create proxies that advise target objects. For the
    full details of Spring's AOP API, see the next chapter. Here we want to
    focus on the ability to automatically create proxies using @AspectJ
    aspects.</p><p>The class
    <code class="classname">org.springframework.aop.aspectj.annotation.AspectJProxyFactory</code>
    can be used to create a proxy for a target object that is advised by one
    or more @AspectJ aspects. Basic usage for this class is very simple, as
    illustrated below. See the Javadocs for full information.</p><pre class="programlisting"><span class="hl-comment">// create a factory that can generate a proxy for the given target object</span>
AspectJProxyFactory factory = <span class="hl-keyword">new</span> AspectJProxyFactory(targetObject); 

<span class="hl-comment">// add an aspect, the class must be an @AspectJ aspect</span>
<span class="hl-comment">// you can call this as many times as you need with different aspects</span>
factory.addAspect(SecurityManager.<span class="hl-keyword">class</span>);

<span class="hl-comment">// you can also add existing aspect instances, the type of the object supplied must be an @AspectJ aspect</span>
factory.addAspect(usageTracker);	

<span class="hl-comment">// now get the proxy object...</span>
MyInterfaceType proxy = factory.getProxy();</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-using-aspectj"></a>8.8&nbsp;Using AspectJ with Spring applications</h2></div></div></div><p>Everything we've covered so far in this chapter is pure Spring AOP.
    In this section, we're going to look at how you can use the AspectJ
    compiler/weaver instead of, or in addition to, Spring AOP if your needs go
    beyond the facilities offered by Spring AOP alone.</p><p>Spring ships with a small AspectJ aspect library, which is available
    standalone in your distribution as <code class="filename">spring-aspects.jar</code>; you'll need to add this
    to your classpath in order to use the aspects in it. <a class="xref" href="#aop-atconfigurable" title="8.8.1&nbsp;Using AspectJ to dependency inject domain objects with Spring">Section&nbsp;8.8.1, &#8220;Using AspectJ to dependency inject domain objects with
      Spring&#8221;</a> and <a class="xref" href="#aop-ajlib-other" title="8.8.2&nbsp;Other Spring aspects for AspectJ">Section&nbsp;8.8.2, &#8220;Other Spring aspects for AspectJ&#8221;</a>
    discuss the content of this library and how you can use it. <a class="xref" href="#aop-aj-configure" title="8.8.3&nbsp;Configuring AspectJ aspects using Spring IoC">Section&nbsp;8.8.3, &#8220;Configuring AspectJ aspects using Spring IoC&#8221;</a> discusses how to dependency inject AspectJ
    aspects that are woven using the AspectJ compiler. Finally, <a class="xref" href="#aop-aj-ltw" title="8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;8.8.4, &#8220;Load-time weaving with AspectJ in the Spring Framework&#8221;</a> provides an introduction to load-time weaving for
    Spring applications using AspectJ.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-atconfigurable"></a>8.8.1&nbsp;Using AspectJ to dependency inject domain objects with
      Spring</h3></div></div></div><p>The Spring container instantiates and configures beans defined in
      your application context. It is also possible to ask a bean factory to
      configure a <span class="emphasis"><em>pre-existing</em></span> object given the name of a
      bean definition containing the configuration to be applied. The
      <code class="filename">spring-aspects.jar</code> contains an
      annotation-driven aspect that exploits this capability to allow
      dependency injection of <span class="emphasis"><em>any object</em></span>. The support is
      intended to be used for objects created <span class="emphasis"><em>outside of the control
      of any container</em></span>. Domain objects often fall into this
      category because they are often created programmatically using the
      <code class="literal">new</code> operator, or by an ORM tool as a result of a
      database query.</p><p>The <code class="interfacename">@Configurable</code> annotation marks
      a class as eligible for Spring-driven configuration. In the simplest
      case it can be used just as a marker annotation:</p><pre class="programlisting"><span class="hl-keyword">package</span> com.xyz.myapp.domain;

<span class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Configurable;

@Configurable
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Account {
   <span class="hl-comment">// ...</span>
}</pre><p>When used as a marker interface in this way, Spring will configure
      new instances of the annotated type (<code class="classname">Account</code> in
      this case) using a prototype-scoped bean definition with the same name
      as the fully-qualified type name
      (<code class="classname">com.xyz.myapp.domain.Account</code>). Since the default
      name for a bean is the fully-qualified name of its type, a convenient
      way to declare the prototype definition is simply to omit the
      <code class="literal">id</code> attribute:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.xyz.myapp.domain.Account"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"fundsTransferService"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"fundsTransferService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>If you want to explicitly specify the name of the prototype bean
      definition to use, you can do so directly in the annotation:</p><pre class="programlisting"><span class="hl-keyword">package</span> com.xyz.myapp.domain;

<span class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Configurable;

@Configurable(<span class="hl-string">"account"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Account {
   <span class="hl-comment">// ...</span>
}</pre><p>Spring will now look for a bean definition named
      "<code class="literal">account</code>" and use that as the definition to configure
      new <code class="classname">Account</code> instances.</p><p>You can also use autowiring to avoid having to specify a
      prototype-scoped bean definition at all. To have Spring apply autowiring
      use the '<code class="literal">autowire</code>' property of the
      <code class="interfacename">@Configurable</code> annotation: specify either
      <code class="literal">@Configurable(autowire=Autowire.BY_TYPE)</code> or
      <code class="literal">@Configurable(autowire=Autowire.BY_NAME</code> for
      autowiring by type or by name respectively. As an alternative, as of
      Spring 2.5 it is preferable to specify explicit, annotation-driven 
      dependency injection for your <code class="interfacename">@Configurable</code> 
      beans by using <code class="interfacename">@Autowired</code> or
      <code class="interfacename">@Inject</code> at the field or method level (see 
      <a class="xref" href="#beans-annotation-config" title="4.9&nbsp;Annotation-based container configuration">Section&nbsp;4.9, &#8220;Annotation-based container configuration&#8221;</a> for further details).</p><p>Finally you can enable Spring dependency checking for the object
      references in the newly created and configured object by using the
      <code class="literal">dependencyCheck</code> attribute (for example:
      <code class="literal">@Configurable(autowire=Autowire.BY_NAME,dependencyCheck=true)</code>).
      If this attribute is set to true, then Spring will validate after
      configuration that all properties (<span class="emphasis"><em>which are not primitives or
      collections</em></span>) have been set.</p><p>Using the annotation on its own does nothing of course. It is the
      <code class="classname">AnnotationBeanConfigurerAspect</code> in <code class="filename">spring-aspects.jar</code> that acts on the
      presence of the annotation. In essence the aspect says "after returning
      from the initialization of a new object of a type annotated with
      <code class="interfacename">@Configurable</code>, configure the newly
      created object using Spring in accordance with the properties of the
      annotation". In this context, <span class="emphasis"><em>initialization</em></span> refers
      to newly instantiated objects (e.g., objects instantiated with the
      '<code class="literal">new</code>' operator) as well as to
      <code class="interfacename">Serializable</code> objects that are undergoing
      deserialization (e.g., via <a class="ulink" href="http://java.sun.com/j2se/1.5.0/docs/api/java/io/Serializable.html" target="_top">readResolve()</a>).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>One of the key phrases in the above paragraph is '<span class="emphasis"><em>in
        essence</em></span>'. For most cases, the exact semantics of
        '<span class="emphasis"><em>after returning from the initialization of a new
        object</em></span>' will be fine... in this context, '<span class="emphasis"><em>after
        initialization</em></span>' means that the dependencies will be
        injected <span class="emphasis"><em>after</em></span> the object has been constructed -
        this means that the dependencies will not be available for use in the
        constructor bodies of the class. If you want the dependencies to be
        injected <span class="emphasis"><em>before</em></span> the constructor bodies execute,
        and thus be available for use in the body of the constructors, then
        you need to define this on the
        <code class="interfacename">@Configurable</code> declaration like
        so:</p><pre class="programlisting">@Configurable(preConstruction=true)</pre><p>You can find out more information about the language semantics
        of the various pointcut types in AspectJ <a class="ulink" href="http://www.eclipse.org/aspectj/doc/next/progguide/semantics-joinPoints.html" target="_top">in
        this appendix</a> of the <a class="ulink" href="http://www.eclipse.org/aspectj/doc/next/progguide/index.html" target="_top">AspectJ
        Programming Guide</a>.</p></td></tr></table></div><p>For this to work the annotated types must be woven with the
      AspectJ weaver - you can either use a build-time Ant or Maven task to do
      this (see for example the <a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/devguide/antTasks.html" target="_top">AspectJ
      Development Environment Guide</a>) or load-time weaving (see <a class="xref" href="#aop-aj-ltw" title="8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;8.8.4, &#8220;Load-time weaving with AspectJ in the Spring Framework&#8221;</a>). The
      <code class="classname">AnnotationBeanConfigurerAspect</code> itself needs
      configuring by Spring (in order to obtain a reference to the bean
      factory that is to be used to configure new objects). The Spring <a class="link" href="#xsd-config-body-schemas-context" title="C.2.8&nbsp;The context schema"><code class="literal">context</code>
      namespace</a> defines a convenient tag for doing this: just include
      the following in your application context configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">context:spring-configured</span>/&gt;</pre><p>If you are using the DTD instead of schema, the equivalent
      definition is:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> 
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.aspectj.AnnotationBeanConfigurerAspect"</span>
      <span class="hl-attribute">factory-method</span>=<span class="hl-value">"aspectOf"</span>/&gt;</pre><p>Instances of <code class="interfacename">@Configurable</code> objects
      created <span class="emphasis"><em>before</em></span> the aspect has been configured will
      result in a warning being issued to the log and no configuration of the
      object taking place. An example might be a bean in the Spring
      configuration that creates domain objects when it is initialized by
      Spring. In this case you can use the "depends-on" bean attribute to
      manually specify that the bean depends on the configuration
      aspect.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myService"</span>
  <span class="hl-attribute">class</span>=<span class="hl-value">"com.xzy.myapp.service.MyService"</span>
  <span class="hl-attribute">depends-on</span>=<span class="hl-value">"org.springframework.beans.factory.aspectj.AnnotationBeanConfigurerAspect"</span>&gt;

  &lt;<span class="hl-comment">!-- ... --</span>&gt;

&lt;<span class="hl-tag">/bean</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Do not activate <code class="interfacename">@Configurable</code>
        processing through the bean configurer aspect unless you really
        mean to rely on its semantics at runtime. In particular, make sure
        that you do not use <code class="interfacename">@Configurable</code>
        on bean classes which are registered as regular Spring beans with
        the container: You would get double initialization otherwise, once
        through the container and once through the aspect.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-configurable-testing"></a>8.8.1.1&nbsp;Unit testing <code class="interfacename">@Configurable</code>
        objects</h4></div></div></div><p>One of the goals of the
        <code class="interfacename">@Configurable</code> support is to enable
        independent unit testing of domain objects without the difficulties
        associated with hard-coded lookups. If
        <code class="interfacename">@Configurable</code> types have not been woven
        by AspectJ then the annotation has no affect during unit testing, and
        you can simply set mock or stub property references in the object
        under test and proceed as normal. If
        <code class="interfacename">@Configurable</code> types
        <span class="emphasis"><em>have</em></span> been woven by AspectJ then you can still
        unit test outside of the container as normal, but you will see a
        warning message each time that you construct an
        <code class="interfacename">@Configurable</code> object indicating that it
        has not been configured by Spring.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-configurable-container"></a>8.8.1.2&nbsp;Working with multiple application contexts</h4></div></div></div><p>The <code class="classname">AnnotationBeanConfigurerAspect</code> used
        to implement the <code class="interfacename">@Configurable</code> support
        is an AspectJ singleton aspect. The scope of a singleton aspect is the
        same as the scope of <code class="literal">static</code> members, that is to say
        there is one aspect instance per classloader that defines the type.
        This means that if you define multiple application contexts within the
        same classloader hierarchy you need to consider where to define the
        <code class="literal">&lt;context:spring-configured/&gt;</code> bean and where to
        place <code class="filename">spring-aspects.jar</code> on
        the classpath.</p><p>Consider a typical Spring web-app configuration with a shared
        parent application context defining common business services and
        everything needed to support them, and one child application context
        per servlet containing definitions particular to that servlet. All of
        these contexts will co-exist within the same classloader hierarchy,
        and so the <code class="literal">AnnotationBeanConfigurerAspect</code> can only
        hold a reference to one of them. In this case we recommend defining
        the <code class="literal">&lt;context:spring-configured/&gt;</code> bean in the
        shared (parent) application context: this defines the services that
        you are likely to want to inject into domain objects. A consequence is
        that you cannot configure domain objects with references to beans
        defined in the child (servlet-specific) contexts using the
        @Configurable mechanism (probably not something you want to do
        anyway!).</p><p>When deploying multiple web-apps within the same container,
        ensure that each web-application loads the types in <code class="filename">spring-aspects.jar</code> using its own
        classloader (for example, by placing <code class="filename">spring-aspects.jar</code> in <code class="filename">'WEB-INF/lib'</code>). If <code class="filename">spring-aspects.jar</code> is only added to the
        container wide classpath (and hence loaded by the shared parent
        classloader), all web applications will share the same aspect instance
        which is probably not what you want.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ajlib-other"></a>8.8.2&nbsp;Other Spring aspects for AspectJ</h3></div></div></div><p>In addition to the <code class="interfacename">@Configurable</code>
      aspect, <code class="filename">spring-aspects.jar</code>
      contains an AspectJ aspect that can be used to drive Spring's
      transaction management for types and methods annotated with the
      <code class="interfacename">@Transactional</code> annotation. This is
      primarily intended for users who want to use the Spring Framework's
      transaction support outside of the Spring container.</p><p>The aspect that interprets
      <code class="interfacename">@Transactional</code> annotations is the
      <code class="classname">AnnotationTransactionAspect</code>. When using this
      aspect, you must annotate the <span class="emphasis"><em>implementation</em></span> class
      (and/or methods within that class), <span class="emphasis"><em>not</em></span> the
      interface (if any) that the class implements. AspectJ follows Java's
      rule that annotations on interfaces are <span class="emphasis"><em>not
      inherited</em></span>.</p><p>A <code class="interfacename">@Transactional</code> annotation on a
      class specifies the default transaction semantics for the execution of
      any <span class="emphasis"><em>public</em></span> operation in the class.</p><p>A <code class="interfacename">@Transactional</code> annotation on a
      method within the class overrides the default transaction semantics
      given by the class annotation (if present). Methods with
      <code class="literal">public</code>, <code class="literal">protected</code>, and default
      visibility may all be annotated. Annotating <code class="literal">protected</code>
      and default visibility methods directly is the only way to get
      transaction demarcation for the execution of such methods.</p><p>For AspectJ programmers that want to use the Spring configuration
      and transaction management support but don't want to (or cannot) use
      annotations, <code class="filename">spring-aspects.jar</code>
      also contains <code class="literal">abstract</code> aspects you can extend to
      provide your own pointcut definitions. See the sources for the
      <code class="classname">AbstractBeanConfigurerAspect</code> and
      <code class="classname">AbstractTransactionAspect</code> aspects for more
      information. As an example, the following excerpt shows how you could
      write an aspect to configure all instances of objects defined in the
      domain model using prototype bean definitions that match the
      fully-qualified class names:</p><pre class="programlisting"><span class="hl-keyword">public</span> aspect DomainObjectConfiguration <span class="hl-keyword">extends</span> AbstractBeanConfigurerAspect {

  <span class="hl-keyword">public</span> DomainObjectConfiguration() {
    setBeanWiringInfoResolver(<span class="hl-keyword">new</span> ClassNameBeanWiringInfoResolver());
  }

  <span class="hl-comment">// the creation of a new bean (any object in the domain model)</span>
  <span class="hl-keyword">protected</span> pointcut beanCreation(Object beanInstance) :
    initialization(<span class="hl-keyword">new</span>(..)) &amp;&amp;
    SystemArchitecture.inDomainModel() &amp;&amp; 
    <span class="hl-keyword">this</span>(beanInstance);
		   		   
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-aj-configure"></a>8.8.3&nbsp;Configuring AspectJ aspects using Spring IoC</h3></div></div></div><p>When using AspectJ aspects with Spring applications, it is natural
      to both want and expect to be able to configure such aspects using
      Spring. The AspectJ runtime itself is responsible for aspect creation,
      and the means of configuring the AspectJ created aspects via Spring
      depends on the AspectJ instantiation model (the
      '<code class="literal">per-xxx</code>' clause) used by the aspect.</p><p>The majority of AspectJ aspects are <span class="emphasis"><em>singleton</em></span>
      aspects. Configuration of these aspects is very easy: simply create a
      bean definition referencing the aspect type as normal, and include the
      bean attribute <code class="literal">'factory-method="aspectOf"'</code>. This
      ensures that Spring obtains the aspect instance by asking AspectJ for it
      rather than trying to create an instance itself. For example:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profiler"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.xyz.profiler.Profiler"</span>
      <span class="hl-attribute">factory-method</span>=<span class="hl-value">"aspectOf"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"profilingStrategy"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"jamonProfilingStrategy"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Non-singleton aspects are harder to configure: however it is
      possible to do so by creating prototype bean definitions and using the
      <code class="interfacename">@Configurable</code> support from <code class="filename">spring-aspects.jar</code> to configure the
      aspect instances once they have bean created by the AspectJ
      runtime.</p><p>If you have some @AspectJ aspects that you want to weave with
      AspectJ (for example, using load-time weaving for domain model types)
      and other @AspectJ aspects that you want to use with Spring AOP, and
      these aspects are all configured using Spring, then you will need to
      tell the Spring AOP @AspectJ autoproxying support which exact subset of
      the @AspectJ aspects defined in the configuration should be used for
      autoproxying. You can do this by using one or more
      <code class="literal">&lt;include/&gt;</code> elements inside the
      <code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code> declaration. Each
      <code class="literal">&lt;include/&gt;</code> element specifies a name pattern,
      and only beans with names matched by at least one of the patterns will
      be used for Spring AOP autoproxy configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:aspectj-autoproxy</span>&gt;
  &lt;<span class="hl-tag">aop:include</span> <span class="hl-attribute">name</span>=<span class="hl-value">"thisBean"</span>/&gt;
  &lt;<span class="hl-tag">aop:include</span> <span class="hl-attribute">name</span>=<span class="hl-value">"thatBean"</span>/&gt;
&lt;<span class="hl-tag">/aop:aspectj-autoproxy</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Do not be misled by the name of the
        <code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code> element: using it
        will result in the creation of <span class="emphasis"><em>Spring AOP
        proxies</em></span>. The @AspectJ style of aspect declaration is just
        being used here, but the AspectJ runtime is <span class="emphasis"><em>not</em></span>
        involved.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-aj-ltw"></a>8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework</h3></div></div></div><p>Load-time weaving (LTW) refers to the process of weaving AspectJ
      aspects into an application's class files as they are being loaded into
      the Java virtual machine (JVM). The focus of this section is on
      configuring and using LTW in the specific context of the Spring
      Framework: this section is not an introduction to LTW though. For full
      details on the specifics of LTW and configuring LTW with just AspectJ
      (with Spring not being involved at all), see the <a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/devguide/ltw.html" target="_top">LTW
      section of the AspectJ Development Environment Guide</a>.</p><p>The value-add that the Spring Framework brings to AspectJ LTW is
      in enabling much finer-grained control over the weaving process.
      'Vanilla' AspectJ LTW is effected using a Java (5+) agent, which is
      switched on by specifying a VM argument when starting up a JVM. It is
      thus a JVM-wide setting, which may be fine in some situations, but often
      is a little too coarse. Spring-enabled LTW enables you to switch on LTW
      on a <span class="emphasis"><em>per-<code class="classname">ClassLoader</code></em></span> basis,
      which obviously is more fine-grained and which can make more sense in a
      'single-JVM-multiple-application' environment (such as is found in a
      typical application server environment).</p><p>Further, <a class="link" href="#aop-aj-ltw-environments" title="8.8.4.6&nbsp;Environment-specific configuration">in certain
      environments</a>, this support enables load-time weaving
      <span class="emphasis"><em>without making any modifications to the application server's
      launch script</em></span> that will be needed to add
      <code class="literal">-javaagent:path/to/aspectjweaver.jar</code> or (as we describe later in this
      section) <code class="literal">-javaagent:path/to/org.springframework.instrument-{version}.jar</code> 
      (previously named <code class="literal">spring-agent.jar</code>). Developers simply modify
      one or more files that form the application context to enable load-time
      weaving instead of relying on administrators who typically are in charge
      of the deployment configuration such as the launch script.</p><p>Now that the sales pitch is over, let us first walk through a
      quick example of AspectJ LTW using Spring, followed by detailed
      specifics about elements introduced in the following example. For a
      complete example, please see the Petclinic <a class="link" href="#new-in-3.0-samples">sample</a> application.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-aj-ltw-first-example"></a>8.8.4.1&nbsp;A first example</h4></div></div></div><p>Let us assume that you are an application developer who has been
        tasked with diagnosing the cause of some performance problems in a
        system. Rather than break out a profiling tool, what we are going to
        do is switch on a simple profiling aspect that will enable us to very
        quickly get some performance metrics, so that we can then apply a
        finer-grained profiling tool to that specific area immediately
        afterwards.</p><p>Here is the profiling aspect. Nothing too fancy, just a
        quick-and-dirty time-based profiler, using the @AspectJ-style of
        aspect declaration.</p><pre class="programlisting"><span class="hl-keyword">package</span> foo;

<span class="hl-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Around;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Pointcut;
<span class="hl-keyword">import</span> org.springframework.util.StopWatch;
<span class="hl-keyword">import</span> org.springframework.core.annotation.Order;

@Aspect
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProfilingAspect {

    @Around(<span class="hl-string">"methodsToBeProfiled()"</span>)
    <span class="hl-keyword">public</span> Object profile(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
        StopWatch sw = <span class="hl-keyword">new</span> StopWatch(getClass().getSimpleName());
        <span class="hl-keyword">try</span> {
            sw.start(pjp.getSignature().getName());
            <span class="hl-keyword">return</span> pjp.proceed();
        } <span class="hl-keyword">finally</span> {
            sw.stop();
            System.out.println(sw.prettyPrint());
        }
    }

    @Pointcut(<span class="hl-string">"execution(public * foo..*.*(..))"</span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> methodsToBeProfiled(){}
}
</pre><p>We will also need to create an
        '<code class="filename">META-INF/aop.xml</code>' file, to inform the AspectJ
        weaver that we want to weave our
        <code class="classname">ProfilingAspect</code> into our classes. This file
        convention, namely the presence of a file (or files) on the Java
        classpath called ' <code class="filename">META-INF/aop.xml</code>' is standard
        AspectJ.</p><pre class="programlisting">&lt;<span class="hl-tag">!DOCTYPE</span> <span class="hl-attribute">aspectj</span> <span class="hl-attribute">PUBLIC</span>
        <span class="hl-attribute">"-//AspectJ//DTD//EN"</span> <span class="hl-attribute">"http://www.eclipse.org/aspectj/dtd/aspectj.dtd"&gt;</span>
<span class="hl-attribute">&lt;aspectj&gt;</span>

    <span class="hl-attribute">&lt;weaver&gt;</span>

        <span class="hl-attribute">&lt;!--</span> <span class="hl-attribute">only</span> <span class="hl-attribute">weave</span> <span class="hl-attribute">classes</span> <span class="hl-attribute">in</span> <span class="hl-attribute">our</span> <span class="hl-attribute">application-specific</span> <span class="hl-attribute">packages</span> <span class="hl-attribute">--&gt;</span>
        <span class="hl-attribute">&lt;include</span> <span class="hl-attribute">within</span>=<span class="hl-value">"foo.*"</span>/&gt;

    &lt;<span class="hl-tag">/weaver</span>&gt;

    &lt;<span class="hl-tag">aspects</span>&gt;

        &lt;<span class="hl-comment">!-- weave in just this aspect --</span>&gt;        
        &lt;<span class="hl-tag">aspect</span> <span class="hl-attribute">name</span>=<span class="hl-value">"foo.ProfilingAspect"</span>/&gt;

    &lt;<span class="hl-tag">/aspects</span>&gt;

  &lt;<span class="hl-tag">/aspectj</span>&gt;</pre><p>Now to the Spring-specific portion of the configuration. We need
        to configure a <code class="interfacename">LoadTimeWeaver</code> (all
        explained later, just take it on trust for now). This load-time weaver
        is the essential component responsible for weaving the aspect
        configuration in one or more '<code class="filename">META-INF/aop.xml</code>'
        files into the classes in your application. The good thing is that it
        does not require a lot of configuration, as can be seen below (there
        are some more options that you can specify, but these are detailed
        later).</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans 
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/context 
    http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;

    &lt;<span class="hl-comment">!-- a service object; we will be profiling its methods --</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"entitlementCalculationService"</span>
          <span class="hl-attribute">class</span>=<span class="hl-value">"foo.StubEntitlementCalculationService"</span>/&gt;

    &lt;<span class="hl-comment">!-- this switches on the load-time weaving --</span>&gt;
    &lt;<span class="hl-tag">context:load-time-weaver</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Now that all the required artifacts are in place - the aspect,
        the '<code class="filename">META-INF/aop.xml</code>' file, and the Spring
        configuration -, let us create a simple driver class with a
        <code class="methodname">main(..)</code> method to demonstrate the LTW in
        action.</p><pre class="programlisting"><span class="hl-keyword">package</span> foo;

<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Main {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {

        ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"beans.xml"</span>, Main.<span class="hl-keyword">class</span>);

        EntitlementCalculationService entitlementCalculationService
            = (EntitlementCalculationService) ctx.getBean(<span class="hl-string">"entitlementCalculationService"</span>);

        <span class="hl-comment">// the profiling aspect is 'woven' around this method execution</span>
        entitlementCalculationService.calculateEntitlement();
    }
}</pre><p>There is one last thing to do. The introduction to this section
        did say that one could switch on LTW selectively on a
        per-<code class="classname">ClassLoader</code> basis with Spring, and this is
        true. However, just for this example, we are going to use a Java agent
        (supplied with Spring) to switch on the LTW. This is the command line
        we will use to run the above <code class="classname">Main</code> class:</p><pre class="programlisting">java -javaagent:C:/projects/foo/lib/global/spring-instrument.jar foo.Main</pre><p>The '<code class="literal">-javaagent</code>' is a Java 5+ flag for
        specifying and enabling <a class="ulink" href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/instrument/package-summary.html" target="_top">agents
        to instrument programs running on the JVM</a>. The Spring
        Framework ships with such an agent, the
        <code class="classname">InstrumentationSavingAgent</code>, which is packaged
        in the <code class="filename">spring-instrument.jar</code>
		that
        was supplied as the value of the <code class="literal">-javaagent</code>
        argument in the above example.</p><p>The output from the execution of the <code class="classname">Main</code>
        program will look something like that below. (I have introduced a
        <code class="methodname">Thread.sleep(..)</code> statement into the
        <code class="methodname">calculateEntitlement()</code> implementation so that
        the profiler actually captures something other than 0 milliseconds -
        the <code class="literal">01234</code> milliseconds is <span class="emphasis"><em>not</em></span>
        an overhead introduced by the AOP :) )</p><pre class="programlisting">Calculating entitlement

StopWatch 'ProfilingAspect': running time (millis) = 1234
------ ----- ----------------------------
ms     %     Task name
------ ----- ----------------------------
01234  100%  calculateEntitlement</pre><p>Since this LTW is effected using full-blown AspectJ, we are not
        just limited to advising Spring beans; the following slight variation
        on the <code class="classname">Main</code> program will yield the same
        result.</p><pre class="programlisting"><span class="hl-keyword">package</span> foo;

<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Main {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {

        <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"beans.xml"</span>, Main.<span class="hl-keyword">class</span>);

        EntitlementCalculationService entitlementCalculationService =
            <span class="hl-keyword">new</span> StubEntitlementCalculationService();

        <span class="hl-comment">// the profiling aspect will be 'woven' around this method execution</span>
        entitlementCalculationService.calculateEntitlement();
    }
}</pre><p>Notice how in the above program we are simply bootstrapping the
        Spring container, and then creating a new instance of the
        <code class="classname">StubEntitlementCalculationService</code> totally
        outside the context of Spring... the profiling advice still gets woven
        in.</p><p>The example admittedly is simplistic... however the basics of
        the LTW support in Spring have all been introduced in the above
        example, and the rest of this section will explain the 'why' behind
        each bit of configuration and usage in detail.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="classname">ProfilingAspect</code> used in this
          example may be basic, but it is quite useful. It is a nice example
          of a development-time aspect that developers can use during
          development (of course), and then quite easily exclude from builds
          of the application being deployed into UAT or production.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-aj-ltw-the-aspects"></a>8.8.4.2&nbsp;Aspects</h4></div></div></div><p>The aspects that you use in LTW have to be AspectJ aspects. They
        can be written in either the AspectJ language itself or you can write
        your aspects in the @AspectJ-style. The latter option is of course
        only an option if you are using Java 5+, but it does mean that your
        aspects are then both valid AspectJ <span class="emphasis"><em>and</em></span> Spring
        AOP aspects. Furthermore, the compiled aspect classes need to be
        available on the classpath.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-aj-ltw-aop_dot_xml"></a>8.8.4.3&nbsp;'<code class="filename">META-INF/aop.xml</code>'</h4></div></div></div><p>The AspectJ LTW infrastructure is configured using one or more
        '<code class="filename">META-INF/aop.xml</code>' files, that are on the Java
        classpath (either directly, or more typically in jar files).</p><p>The structure and contents of this file is detailed in the main
        AspectJ reference documentation, and the interested reader is <a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/devguide/ltw-configuration.html" target="_top">referred
        to that resource</a>. (I appreciate that this section is brief,
        but the '<code class="filename">aop.xml</code>' file is 100% AspectJ - there is
        no Spring-specific information or semantics that apply to it, and so
        there is no extra value that I can contribute either as a result), so
        rather than rehash the quite satisfactory section that the AspectJ
        developers wrote, I am just directing you there.)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-aj-ltw-libraries"></a>8.8.4.4&nbsp;Required libraries (JARS)</h4></div></div></div><p>At a minimum you will need the following libraries to use the
        Spring Framework's support for AspectJ LTW:</p><div class="orderedlist"><ol type="1"><li><p><code class="filename">spring-aop.jar</code> (version
            2.5 or later, plus all mandatory dependencies)</p></li><li><p><code class="filename">aspectjweaver.jar</code>
            (version 1.6.8 or later)</p></li></ol></div><p>If you are using the <a class="link" href="#aop-aj-ltw-environment-generic" title="Generic Java applications">Spring-provided agent to
        enable instrumentation</a>, you will also need:</p><div class="orderedlist"><ol type="1"><li><p><code class="filename">spring-instrument.jar</code></p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-aj-ltw-spring"></a>8.8.4.5&nbsp;Spring configuration</h4></div></div></div><p>The key component in Spring's LTW support is the
        <code class="interfacename">LoadTimeWeaver</code> interface (in the
        <code class="literal">org.springframework.instrument.classloading</code>
        package), and the numerous implementations of it that ship with the
        Spring distribution. A <code class="interfacename">LoadTimeWeaver</code>
        is responsible for adding one or more
        <code class="classname">java.lang.instrument.ClassFileTransformers</code> to a
        <code class="classname">ClassLoader</code> at runtime, which opens the door to
        all manner of interesting applications, one of which happens to be the
        LTW of aspects.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you are unfamiliar with the idea of runtime class file
          transformation, you are encouraged to read the Javadoc API
          documentation for the <code class="literal">java.lang.instrument</code>
          package before continuing. This is not a huge chore because there is
          - rather annoyingly - precious little documentation there... the key
          interfaces and classes will at least be laid out in front of you for
          reference as you read through this section.</p></td></tr></table></div><p>Configuring a <code class="interfacename">LoadTimeWeaver</code>
        using XML for a particular
        <code class="interfacename">ApplicationContext</code> can be as easy as
        adding one line. (Please note that you almost certainly will need to
        be using an <code class="interfacename">ApplicationContext</code> as your
        Spring container - typically a
        <code class="interfacename">BeanFactory</code> will not be enough because
        the LTW support makes use of
        <code class="interfacename">BeanFactoryPostProcessors</code>.)</p><p>To enable the Spring Framework's LTW support, you need to
        configure a <code class="interfacename">LoadTimeWeaver</code>, which
        typically is done using the
        <code class="literal">&lt;context:load-time-weaver/&gt;</code> element. Find
        below a valid <code class="literal">&lt;context:load-time-weaver/&gt;</code>
        definition that uses default settings.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/context
    http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">context:load-time-weaver</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The above <code class="literal">&lt;context:load-time-weaver/&gt;</code>
        bean definition will define and register a number of LTW-specific
        infrastructure beans for you automatically, such as a
        <code class="interfacename">LoadTimeWeaver</code> and an
        <code class="classname">AspectJWeavingEnabler</code>. Notice how the
        <code class="literal">&lt;context:load-time-weaver/&gt;</code> is defined in the
        '<code class="literal">context</code>' namespace; note also that the referenced
        XML Schema file is only available in versions of Spring 2.5 and
        later.</p><p>What the above configuration does is define and register a
        default <code class="interfacename">LoadTimeWeaver</code> bean for you.
        The default <code class="interfacename">LoadTimeWeaver</code> is the
        <code class="classname">DefaultContextLoadTimeWeaver</code> class, which
        attempts to decorate an automatically detected
        <code class="interfacename">LoadTimeWeaver</code>: the exact type of
        <code class="interfacename">LoadTimeWeaver</code> that will be
        'automatically detected' is dependent upon your runtime environment
        (summarised in the following table).</p><div class="table"><a name="aop-aj-ltw-spring-env-impls"></a><p class="title"><b>Table&nbsp;8.1.&nbsp;<code class="classname">DefaultContextLoadTimeWeaver</code>
          <code class="interfacename">LoadTimeWeavers</code></b></p><div class="table-contents"><table summary="DefaultContextLoadTimeWeaver&#xA;          LoadTimeWeavers" width="100%" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="left"><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Runtime Environment</th><th style="border-bottom: 1.0pt solid ; "><code class="interfacename">LoadTimeWeaver</code> implementation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p>Running in <a class="ulink" href="http://www.bea.com/framework.jsp?CNT=index.htm&amp;FP=/content/products/weblogic/server" target="_top">BEA's
                Weblogic 10</a></p></td><td style="border-bottom: 1.0pt solid ; "><p><code class="classname">WebLogicLoadTimeWeaver</code></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p>Running in <a class="ulink" href="http://www-01.ibm.com/software/webservers/appserv/was/" target="_top">IBM WebSphere Application Server 7</a></p></td><td style="border-bottom: 1.0pt solid ; "><p><code class="classname">WebSphereLoadTimeWeaver</code></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p>Running in <a class="ulink" href="http://www.oracle.com/technology/products/oc4j/index.html" target="_top">Oracle's
                OC4J</a></p></td><td style="border-bottom: 1.0pt solid ; "><p><code class="classname">OC4JLoadTimeWeaver</code></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p>Running in <a class="ulink" href="http://glassfish.dev.java.net/" target="_top">GlassFish</a></p></td><td style="border-bottom: 1.0pt solid ; "><p><code class="classname">GlassFishLoadTimeWeaver</code></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p>Running in <a class="ulink" href="http://www.jboss.org/jbossas/" target="_top">JBoss AS</a></p></td><td style="border-bottom: 1.0pt solid ; "><p><code class="classname">JBossLoadTimeWeaver</code></p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p>JVM started with Spring
                <code class="classname">InstrumentationSavingAgent</code></p>
                <p><span class="emphasis"><em><code class="literal">(java
                -javaagent:path/to/spring-instrument.jar)</code></em></span></p></td><td style="border-bottom: 1.0pt solid ; "><p><code class="classname">InstrumentationLoadTimeWeaver</code></p></td></tr><tr><td style="border-right: 1.0pt solid ; " align="left"><p>Fallback, expecting the underlying ClassLoader to follow common conventions
                (e.g. applicable to <code class="classname">TomcatInstrumentableClassLoader</code> and 
                <a class="ulink" href="http://www.caucho.com/" target="_top">Resin</a>)</p></td><td style=""><p><code class="classname">ReflectiveLoadTimeWeaver</code></p></td></tr></tbody></table></div></div><br class="table-break"><p>Note that these are just the
        <code class="interfacename">LoadTimeWeavers</code> that are autodetected
        when using the <code class="classname">DefaultContextLoadTimeWeaver</code>: it
        is of course possible to specify exactly which
        <code class="interfacename">LoadTimeWeaver</code> implementation that you
        wish to use by specifying the fully-qualified classname as the value
        of the '<code class="literal">weaver-class</code>' attribute of the
        <code class="literal">&lt;context:load-time-weaver/&gt;</code> element. Find
        below an example of doing just that:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/context
    http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">context:load-time-weaver</span>
            <span class="hl-attribute">weaver-class</span>=<span class="hl-value">"org.springframework.instrument.classloading.ReflectiveLoadTimeWeaver"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The <code class="interfacename">LoadTimeWeaver</code> that is
        defined and registered by the
        <code class="literal">&lt;context:load-time-weaver/&gt;</code> element can be
        later retrieved from the Spring container using the well-known name
        '<code class="literal">loadTimeWeaver</code>'. Remember that the
        <code class="interfacename">LoadTimeWeaver</code> exists just as a
        mechanism for Spring's LTW infrastructure to add one or more
        <code class="interfacename">ClassFileTransformers</code>. The actual
        <code class="classname">ClassFileTransformer</code> that does the LTW is the
        <code class="classname">ClassPreProcessorAgentAdapter</code> (from the
        <code class="literal">org.aspectj.weaver.loadtime</code> package) class. See the
        class-level Javadoc for the
        <code class="classname">ClassPreProcessorAgentAdapter</code> class for further
        details, because the specifics of how the weaving is actually effected
        is beyond the scope of this section.</p><p>There is one final attribute of the
        <code class="literal">&lt;context:load-time-weaver/&gt;</code> left to discuss:
        the '<code class="literal">aspectj-weaving</code>' attribute. This is a simple
        attribute that controls whether LTW is enabled or not, it is as simple
        as that. It accepts one of three possible values, summarised below,
        with the default value if the attribute is not present being '
        <code class="literal">autodetect</code>'</p><div class="table"><a name="aop-aj-ltw-ltw-tag-attrs"></a><p class="title"><b>Table&nbsp;8.2.&nbsp;'<code class="literal">aspectj-weaving</code>' attribute values</b></p><div class="table-contents"><table summary="'aspectj-weaving' attribute values" width="100%" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="left"><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Attribute Value</th><th style="border-bottom: 1.0pt solid ; ">Explanation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="literal">on</code></p></td><td style="border-bottom: 1.0pt solid ; "><p>AspectJ weaving is on, and aspects will be woven
                at load-time as appropriate.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="literal">off</code></p></td><td style="border-bottom: 1.0pt solid ; "><p>LTW is off... no aspect will be woven at
                load-time.</p></td></tr><tr><td style="border-right: 1.0pt solid ; " align="left"><p><code class="literal">autodetect</code></p></td><td style=""><p>If the Spring LTW infrastructure can find at
                least one '<code class="filename">META-INF/aop.xml</code>' file, then
                AspectJ weaving is on, else it is off. This is the default
                value.</p></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-aj-ltw-environments"></a>8.8.4.6&nbsp;Environment-specific configuration</h4></div></div></div><p>This last section contains any additional settings and
        configuration that you will need when using Spring's LTW support in
        environments such as application servers and web containers.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-aj-ltw-environment-tomcat"></a>Tomcat</h5></div></div></div><p><a class="ulink" href="http://tomcat.apache.org/" target="_top">Apache Tomcat</a>'s default class loader 
		  does not support class transformation which is why Spring provides an enhanced implementation that
		  addresses this need. Named <code class="classname">TomcatInstrumentableClassLoader</code>, the loader works
		  on Tomcat 5.0 and above and can be registered individually for <span class="emphasis"><em>each</em></span> web application
		  as follows:</p><div class="itemizedlist"><ul type="disc"><li><p>Tomcat 6.0.x or higher</p><div class="orderedlist"><ol type="1"><li><p>Copy <code class="literal">org.springframework.instrument.tomcat.jar</code>
                into <span class="emphasis"><em>$CATALINA_HOME</em></span>/lib, where
                <span class="emphasis"><em>$CATALINA_HOME</em></span> represents the root of the
                Tomcat installation)</p></li><li><p>Instruct Tomcat to use the custom class loader (instead
                of the default) by editing the web application context
                file:</p><pre class="programlisting">&lt;<span class="hl-tag">Context</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/myWebApp"</span> <span class="hl-attribute">docBase</span>=<span class="hl-value">"/my/webApp/location"</span>&gt;
    &lt;<span class="hl-tag">Loader</span>
        <span class="hl-attribute">loaderClass</span>=<span class="hl-value">"org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader"</span>/&gt;
&lt;<span class="hl-tag">/Context</span>&gt;</pre><p>Apache Tomcat 6.0.x (similar to 5.0.x/5.5.x) series supports several context locations:</p><div class="itemizedlist"><ul type="circle"><li>server configuration file - <span class="emphasis"><em>$CATALINA_HOME/conf/server.xml</em></span></li><li>default context configuration - <span class="emphasis"><em>$CATALINA_HOME/conf/context.xml</em></span> - that
						affects all deployed web applications</li><li>per-web application configuration which can be deployed either on the server-side at
						<span class="emphasis"><em>$CATALINA_HOME/conf/[enginename]/[hostname]/[webapp]-context.xml</em></span> or embedded inside
						the web-app archive at <span class="emphasis"><em>META-INF/context.xml</em></span></li></ul></div><p>For efficiency, the embedded per-web-app configuration style is
                recommended because it will impact only applications that use
                the custom class loader and does not require any changes to the server configuration.
                See the Tomcat 6.0.x <a class="ulink" href="http://tomcat.apache.org/tomcat-6.0-doc/config/context.html" target="_top">documentation</a>
                for more details about available context locations.</p></li></ol></div></li><li><p>Tomcat 5.0.x/5.5.x</p><div class="orderedlist"><ol type="1"><li><p>Copy <code class="literal">org.springframework.instrument.tomcat.jar</code>
                into <span class="emphasis"><em>$CATALINA_HOME</em></span>/server/lib, where
                <span class="emphasis"><em>$CATALINA_HOME</em></span> represents the root of the
                Tomcat installation.</p></li><li><p>Instruct Tomcat to use the custom class loader instead
                of the default one by editing the web application context
                file:</p><pre class="programlisting">&lt;<span class="hl-tag">Context</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/myWebApp"</span> <span class="hl-attribute">docBase</span>=<span class="hl-value">"/my/webApp/location"</span>&gt;
    &lt;<span class="hl-tag">Loader</span>
        <span class="hl-attribute">loaderClass</span>=<span class="hl-value">"org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader"</span>/&gt;
&lt;<span class="hl-tag">/Context</span>&gt;</pre><p>Tomcat 5.0.x and 5.5.x series supports several context locations:</p><div class="itemizedlist"><ul type="circle"><li>server configuration file - <span class="emphasis"><em>$CATALINA_HOME/conf/server.xml</em></span></li><li>default context configuration - <span class="emphasis"><em>$CATALINA_HOME/conf/context.xml</em></span> - that
						affects all deployed web applications</li><li>per-web application configuration which can be deployed either on the server-side at
						<span class="emphasis"><em>$CATALINA_HOME/conf/[enginename]/[hostname]/[webapp]-context.xml</em></span> or embedded inside
						the web-app archive at <span class="emphasis"><em>META-INF/context.xml</em></span></li></ul></div><p>For efficiency, the embedded web-app configuration style is recommended
                recommended because it will impact only applications that use the class loader. See the Tomcat 5.x <a class="ulink" href="http://tomcat.apache.org/tomcat-5.5-doc/config/context.html" target="_top">documentation</a>
                for more details about available context locations.</p><p>Tomcat versions prior to 5.5.20 contained a bug in the
                XML configuration parsing that prevented usage of the
                <code class="literal">Loader</code> tag inside
                <span class="emphasis"><em>server.xml</em></span> configuration, regardless of whether a class
                loader is specified or whether it is the official or a custom
                one. See Tomcat's bugzilla for <a class="ulink" href="http://issues.apache.org/bugzilla/show_bug.cgi?id=39704" target="_top">more
                details</a>.</p><p>In Tomcat 5.5.x, versions 5.5.20 or later, you should set
                <span class="emphasis"><em>useSystemClassLoaderAsParent</em></span> to
                <code class="literal">false</code> to fix this problem:
                </p><pre class="programlisting">&lt;<span class="hl-tag">Context</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/myWebApp"</span> <span class="hl-attribute">docBase</span>=<span class="hl-value">"/my/webApp/location"</span>&gt;
    &lt;<span class="hl-tag">Loader</span>
        <span class="hl-attribute">loaderClass</span>=<span class="hl-value">"org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader"</span>
            <span class="hl-attribute">useSystemClassLoaderAsParent</span>=<span class="hl-value">"false"</span>/&gt;
&lt;<span class="hl-tag">/Context</span>&gt;</pre><p>This setting is not needed on Tomcat 6 or higher.</p></li></ol></div></li></ul></div><p>Alternatively, consider the use of the Spring-provided generic
          VM agent, to be specified in Tomcat's launch script (see above).
          This will make instrumentation available to all deployed web
          applications, no matter what ClassLoader they happen to run on.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-aj-ltw-environments-weblogic-oc4j-resin-glassfish-jboss"></a>WebLogic, WebSphere, OC4J, Resin, GlassFish, JBoss</h5></div></div></div><p>Recent versions of BEA WebLogic (version 10 and above), IBM WebSphere Application Server (version 7 and above),
          Oracle Containers for Java EE (OC4J 10.1.3.1 and above), Resin (3.1 and above) and JBoss (5.x or above)
          provide a ClassLoader that is capable of local instrumentation.
          Spring's native LTW leverages such ClassLoaders to enable AspectJ weaving.
          You can enable LTW by simply activating <code class="literal">context:load-time-weaver</code>
          as described earlier. Specifically, you do <span class="emphasis"><em>not</em></span>
          need to modify the launch script to add
          <code class="literal">-javaagent:path/to/spring-instrument.jar</code>.</p><p>Note that GlassFish instrumentation-capable ClassLoader is available only in its EAR environment. 
          For GlassFish web applications, follow the Tomcat setup instructions as outlined above.</p><p>Note that on JBoss 6.x, the app server scanning needs to be disabled to prevent it from loading the classes
          before the application actually starts. A quick workaround is to add to your artifact a file named
          <code class="filename">WEB-INF/jboss-scanning.xml</code> with the following content:</p><pre class="programlisting">&lt;<span class="hl-tag">scanning</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"urn:jboss:scanning:1.0"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-aj-ltw-environment-generic"></a>Generic Java applications</h5></div></div></div><p>When class instrumentation is required in environments that do not support or
          are not supported by the existing <code class="classname">LoadTimeWeaver</code>
          implementations,
          a JDK agent can be the only solution. For such cases, Spring
          provides <code class="classname">InstrumentationLoadTimeWeaver</code>,
          which requires a Spring-specific (but very general) VM agent,
          <code class="filename">org.springframework.instrument-{version}.jar</code>
          (previously named <code class="filename">spring-agent.jar</code>).</p><p>To use it, you must start the virtual machine with the Spring agent, by
          supplying the following JVM options:</p><pre class="programlisting">-javaagent:/path/to/org.springframework.instrument-{version}.jar</pre><p>         
          Note that this requires modification of the VM launch script which may prevent you from using this in application server
          environments (depending on your operation policies). Additionally, the JDK agent will instrument the <span class="emphasis"><em>entire</em></span>
          VM which can prove expensive.</p><p>For performance reasons, it is recommended to use this configuration only if your target environment 
          (such as <a class="ulink" href="http://www.eclipse.org/jetty/" target="_top">Jetty</a>) does not have (or does not support) a dedicated LTW.</p></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-resources"></a>8.9&nbsp;Further Resources</h2></div></div></div><p>More information on AspectJ can be found on the <a class="ulink" href="http://www.eclipse.org/aspectj" target="_top">AspectJ website</a>.</p><p>The book <span class="emphasis"><em>Eclipse AspectJ</em></span> by Adrian Colyer et.
    al. (Addison-Wesley, 2005) provides a comprehensive introduction and
    reference for the AspectJ language.</p><p>The book <span class="emphasis"><em>AspectJ in Action</em></span> by Ramnivas Laddad
    (Manning, 2003) comes highly recommended; the focus of the book is on
    AspectJ, but a lot of general AOP themes are explored (in some depth).</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="aop-api"></a>9.&nbsp;Spring AOP APIs</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-introduction"></a>9.1&nbsp;Introduction</h2></div></div></div><p>The previous chapter described the Spring 2.0 and later version's
    support for AOP using @AspectJ and schema-based aspect definitions. In
    this chapter we discuss the lower-level Spring AOP APIs and the AOP
    support used in Spring 1.2 applications. For new applications, we
    recommend the use of the Spring 2.0 and later AOP support described in the
    previous chapter, but when working with existing applications, or when
    reading books and articles, you may come across Spring 1.2 style examples.
    Spring 3.0 is backwards compatible with Spring 1.2 and everything
    described in this chapter is fully supported in Spring 3.0.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-pointcuts"></a>9.2&nbsp;Pointcut API in Spring</h2></div></div></div><p>Let's look at how Spring handles the crucial pointcut
    concept.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-concepts"></a>9.2.1&nbsp;Concepts</h3></div></div></div><p>Spring's pointcut model enables pointcut reuse independent of
      advice types. It's possible to target different advice using the same
      pointcut.</p><p>The <code class="literal">org.springframework.aop.Pointcut</code> interface
      is the central interface, used to target advices to particular classes
      and methods. The complete interface is shown below:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Pointcut {

    ClassFilter getClassFilter();

    MethodMatcher getMethodMatcher();

}</pre><p>Splitting the <code class="interfacename">Pointcut</code> interface
      into two parts allows reuse of class and method matching parts, and
      fine-grained composition operations (such as performing a "union" with
      another method matcher).</p><p>The <code class="interfacename">ClassFilter</code> interface is used
      to restrict the pointcut to a given set of target classes. If the
      <code class="literal">matches()</code> method always returns true, all target
      classes will be matched:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ClassFilter {

    <span class="hl-keyword">boolean</span> matches(Class clazz);
}</pre><p>The <code class="interfacename">MethodMatcher</code> interface is
      normally more important. The complete interface is shown below:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MethodMatcher {

    <span class="hl-keyword">boolean</span> matches(Method m, Class targetClass);

    <span class="hl-keyword">boolean</span> isRuntime();

    <span class="hl-keyword">boolean</span> matches(Method m, Class targetClass, Object[] args);
}</pre><p>The <code class="literal">matches(Method, Class) </code>method is used to
      test whether this pointcut will ever match a given method on a target
      class. This evaluation can be performed when an AOP proxy is created, to
      avoid the need for a test on every method invocation. If the 2-argument
      matches method returns true for a given method, and the
      <code class="literal">isRuntime()</code> method for the MethodMatcher returns
      true, the 3-argument matches method will be invoked on every method
      invocation. This enables a pointcut to look at the arguments passed to
      the method invocation immediately before the target advice is to
      execute.</p><p>Most MethodMatchers are static, meaning that their
      <code class="literal">isRuntime()</code> method returns false. In this case, the
      3-argument matches method will never be invoked.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If possible, try to make pointcuts static, allowing the AOP
        framework to cache the results of pointcut evaluation when an AOP
        proxy is created.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcut-ops"></a>9.2.2&nbsp;Operations on pointcuts</h3></div></div></div><p>Spring supports operations on pointcuts: notably,
      <span class="emphasis"><em>union</em></span> and <span class="emphasis"><em>intersection</em></span>.</p><div class="itemizedlist"><ul type="disc"><li><p>Union means the methods that either pointcut matches.</p></li><li><p>Intersection means the methods that both pointcuts
          match.</p></li><li><p>Union is usually more useful.</p></li><li><p>Pointcuts can be composed using the static methods in the
          <span class="emphasis"><em>org.springframework.aop.support.Pointcuts</em></span>
          class, or using the <span class="emphasis"><em>ComposablePointcut</em></span> class in
          the same package. However, using AspectJ pointcut expressions is
          usually a simpler approach.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcuts-aspectj"></a>9.2.3&nbsp;AspectJ expression pointcuts</h3></div></div></div><p>Since 2.0, the most important type of pointcut used by Spring is
      <code class="literal">org.springframework.aop.aspectj.AspectJExpressionPointcut</code>.
      This is a pointcut that uses an AspectJ supplied library to parse an
      AspectJ pointcut expression string.</p><p>See the previous chapter for a discussion of supported AspectJ
      pointcut primitives.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcuts-impls"></a>9.2.4&nbsp;Convenience pointcut implementations</h3></div></div></div><p>Spring provides several convenient pointcut implementations. Some
      can be used out of the box; others are intended to be subclassed in
      application-specific pointcuts.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-pointcuts-static"></a>9.2.4.1&nbsp;Static pointcuts</h4></div></div></div><p>Static pointcuts are based on method and target class, and
        cannot take into account the method's arguments. Static pointcuts are
        sufficient - <span class="emphasis"><em>and best</em></span> - for most usages. It's
        possible for Spring to evaluate a static pointcut only once, when a
        method is first invoked: after that, there is no need to evaluate the
        pointcut again with each method invocation.</p><p>Let's consider some static pointcut implementations included
        with Spring.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-api-pointcuts-regex"></a>Regular expression pointcuts</h5></div></div></div><p>One obvious way to specify static pointcuts is regular
          expressions. Several AOP frameworks besides Spring make this
          possible.
          <code class="literal">org.springframework.aop.support.JdkRegexpMethodPointcut</code>
          is a generic regular expression pointcut, using the regular
          expression support in JDK 1.4+.</p><p>Using the <code class="literal">JdkRegexpMethodPointcut</code> class,
          you can provide a list of pattern Strings. If any of these is a
          match, the pointcut will evaluate to true. (So the result is
          effectively the union of these pointcuts.)</p><p>The usage is shown below:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"settersAndAbsquatulatePointcut"</span> 
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.support.JdkRegexpMethodPointcut"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"patterns"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;.*set.*&lt;<span class="hl-tag">/value</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;.*absquatulate&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Spring provides a convenience class,
          <code class="literal">RegexpMethodPointcutAdvisor</code>, that allows us to
          also reference an Advice (remember that an Advice can be an
          interceptor, before advice, throws advice etc.). Behind the scenes,
          Spring will use a <code class="literal">JdkRegexpMethodPointcut</code>. Using
          <code class="literal">RegexpMethodPointcutAdvisor</code> simplifies wiring, as
          the one bean encapsulates both pointcut and advice, as shown
          below:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"settersAndAbsquatulateAdvisor"</span> 
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.support.RegexpMethodPointcutAdvisor"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"advice"</span>&gt;
        &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">local</span>=<span class="hl-value">"beanNameOfAopAllianceInterceptor"</span>/&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"patterns"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;.*set.*&lt;<span class="hl-tag">/value</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;.*absquatulate&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p><span class="emphasis"><em>RegexpMethodPointcutAdvisor</em></span> can be used
          with any Advice type.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-api-pointcuts-attribute-driven"></a>Attribute-driven pointcuts</h5></div></div></div><p>An important type of static pointcut is a
          <span class="emphasis"><em>metadata-driven</em></span> pointcut. This uses the values
          of metadata attributes: typically, source-level metadata.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-pointcuts-dynamic"></a>9.2.4.2&nbsp;Dynamic pointcuts</h4></div></div></div><p>Dynamic pointcuts are costlier to evaluate than static
        pointcuts. They take into account method
        <span class="emphasis"><em>arguments</em></span>, as well as static information. This
        means that they must be evaluated with every method invocation; the
        result cannot be cached, as arguments will vary.</p><p>The main example is the <code class="literal">control flow</code>
        pointcut.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="aop-api-pointcuts-cflow"></a>Control flow pointcuts</h5></div></div></div><p>Spring control flow pointcuts are conceptually similar to
          AspectJ <span class="emphasis"><em>cflow</em></span> pointcuts, although less
          powerful. (There is currently no way to specify that a pointcut
          executes below a join point matched by another pointcut.) A control
          flow pointcut matches the current call stack. For example, it might
          fire if the join point was invoked by a method in the
          <code class="literal">com.mycompany.web</code> package, or by the
          <code class="literal">SomeCaller</code> class. Control flow pointcuts are
          specified using the
          <code class="literal">org.springframework.aop.support.ControlFlowPointcut
          </code>class.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Control flow pointcuts are significantly more expensive to
              evaluate at runtime than even other dynamic pointcuts. In Java
              1.4, the cost is about 5 times that of other dynamic
              pointcuts.</p></td></tr></table></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcuts-superclasses"></a>9.2.5&nbsp;Pointcut superclasses</h3></div></div></div><p>Spring provides useful pointcut superclasses to help you to
      implement your own pointcuts.</p><p>Because static pointcuts are most useful, you'll probably subclass
      StaticMethodMatcherPointcut, as shown below. This requires implementing
      just one abstract method (although it's possible to override other
      methods to customize behavior):</p><pre class="programlisting"><span class="hl-keyword">class</span> TestStaticPointcut <span class="hl-keyword">extends</span> StaticMethodMatcherPointcut {

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> matches(Method m, Class targetClass) {
        <span class="hl-comment">// return true if custom criteria match</span>
    }
}</pre><p>There are also superclasses for dynamic pointcuts.</p><p>You can use custom pointcuts with any advice type in Spring 1.0
      RC2 and above.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcuts-custom"></a>9.2.6&nbsp;Custom pointcuts</h3></div></div></div><p>Because pointcuts in Spring AOP are Java classes, rather than
      language features (as in AspectJ) it's possible to declare custom
      pointcuts, whether static or dynamic. Custom pointcuts in Spring can be
      arbitrarily complex. However, using the AspectJ pointcut expression
      language is recommended if possible.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Later versions of Spring may offer support for "semantic
        pointcuts" as offered by JAC: for example, "all methods that change
        instance variables in the target object."</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-advice"></a>9.3&nbsp;Advice API in Spring</h2></div></div></div><p>Let's now look at how Spring AOP handles advice.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-advice-lifecycle"></a>9.3.1&nbsp;Advice lifecycles</h3></div></div></div><p>Each advice is a Spring bean. An advice instance can be shared
      across all advised objects, or unique to each advised object. This
      corresponds to <span class="emphasis"><em>per-class</em></span> or
      <span class="emphasis"><em>per-instance</em></span> advice.</p><p>Per-class advice is used most often. It is appropriate for generic
      advice such as transaction advisors. These do not depend on the state of
      the proxied object or add new state; they merely act on the method and
      arguments.</p><p>Per-instance advice is appropriate for introductions, to support
      mixins. In this case, the advice adds state to the proxied
      object.</p><p>It's possible to use a mix of shared and per-instance advice in
      the same AOP proxy.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-advice-types"></a>9.3.2&nbsp;Advice types in Spring</h3></div></div></div><p>Spring provides several advice types out of the box, and is
      extensible to support arbitrary advice types. Let us look at the basic
      concepts and standard advice types.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-around"></a>9.3.2.1&nbsp;Interception around advice</h4></div></div></div><p>The most fundamental advice type in Spring is
        <span class="emphasis"><em>interception around advice</em></span>.</p><p>Spring is compliant with the AOP Alliance interface for around
        advice using method interception. MethodInterceptors implementing
        around advice should implement the following interface:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MethodInterceptor <span class="hl-keyword">extends</span> Interceptor {
  
    Object invoke(MethodInvocation invocation) <span class="hl-keyword">throws</span> Throwable;
}</pre><p>The <code class="classname">MethodInvocation</code> argument to the
        <code class="methodname">invoke()</code> method exposes the method being
        invoked; the target join point; the AOP proxy; and the arguments to
        the method. The <code class="methodname">invoke()</code> method should return
        the invocation's result: the return value of the join point.</p><p>A simple <code class="classname">MethodInterceptor</code> implementation
        looks as follows:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DebugInterceptor <span class="hl-keyword">implements</span> MethodInterceptor {

    <span class="hl-keyword">public</span> Object invoke(MethodInvocation invocation) <span class="hl-keyword">throws</span> Throwable {
        System.out.println(<span class="hl-string">"Before: invocation=["</span> + invocation + <span class="hl-string">"]"</span>);
        Object rval = invocation.proceed();
        System.out.println(<span class="hl-string">"Invocation returned"</span>);
        <span class="hl-keyword">return</span> rval;
    }
}</pre><p>Note the call to the MethodInvocation's
        <code class="methodname">proceed()</code> method. This proceeds down the
        interceptor chain towards the join point. Most interceptors will
        invoke this method, and return its return value. However, a
        MethodInterceptor, like any around advice, can return a different
        value or throw an exception rather than invoke the proceed method.
        However, you don't want to do this without good reason!</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>MethodInterceptors offer interoperability with other AOP
          Alliance-compliant AOP implementations. The other advice types
          discussed in the remainder of this section implement common AOP
          concepts, but in a Spring-specific way. While there is an advantage
          in using the most specific advice type, stick with MethodInterceptor
          around advice if you are likely to want to run the aspect in another
          AOP framework. Note that pointcuts are not currently interoperable
          between frameworks, and the AOP Alliance does not currently define
          pointcut interfaces.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-before"></a>9.3.2.2&nbsp;Before advice</h4></div></div></div><p>A simpler advice type is a <span class="bold"><strong>before
        advice</strong></span>. This does not need a
        <code class="literal">MethodInvocation</code> object, since it will only be
        called before entering the method.</p><p>The main advantage of a before advice is that there is no need
        to invoke the <code class="literal">proceed() </code>method, and therefore no
        possibility of inadvertently failing to proceed down the interceptor
        chain.</p><p>The <code class="literal">MethodBeforeAdvice</code> interface is shown
        below. (Spring's API design would allow for field before advice,
        although the usual objects apply to field interception and it's
        unlikely that Spring will ever implement it).</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MethodBeforeAdvice <span class="hl-keyword">extends</span> BeforeAdvice {

    <span class="hl-keyword">void</span> before(Method m, Object[] args, Object target) <span class="hl-keyword">throws</span> Throwable;
}</pre><p>Note the return type is <code class="literal">void</code>. Before advice
        can insert custom behavior before the join point executes, but cannot
        change the return value. If a before advice throws an exception, this
        will abort further execution of the interceptor chain. The exception
        will propagate back up the interceptor chain. If it is unchecked, or
        on the signature of the invoked method, it will be passed directly to
        the client; otherwise it will be wrapped in an unchecked exception by
        the AOP proxy.</p><p>An example of a before advice in Spring, which counts all method
        invocations:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CountingBeforeAdvice <span class="hl-keyword">implements</span> MethodBeforeAdvice {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> count;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> before(Method m, Object[] args, Object target) <span class="hl-keyword">throws</span> Throwable {
        ++count;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getCount() { 
        <span class="hl-keyword">return</span> count; 
    }
}</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Before advice can be used with any pointcut.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-throws"></a>9.3.2.3&nbsp;Throws advice</h4></div></div></div><p><span class="bold"><strong>Throws advice</strong></span> is invoked after
        the return of the join point if the join point threw an exception.
        Spring offers typed throws advice. Note that this means that the
        <code class="literal">org.springframework.aop.ThrowsAdvice</code> interface does
        not contain any methods: It is a tag interface identifying that the
        given object implements one or more typed throws advice methods. These
        should be in the form of:</p><pre class="programlisting">afterThrowing([Method, args, target], subclassOfThrowable) </pre><p>Only the last argument is required. The method signatures may
        have either one or four arguments, depending on whether the advice
        method is interested in the method and arguments. The following
        classes are examples of throws advice.</p><p>The advice below is invoked if a
        <code class="exceptionname">RemoteException</code> is thrown (including
        subclasses):</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RemoteThrowsAdvice <span class="hl-keyword">implements</span> ThrowsAdvice {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(RemoteException ex) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-comment">// Do something with remote exception</span>
    }
}</pre><p>The following advice is invoked if a
        <code class="exceptionname">ServletException</code> is thrown. Unlike the
        above advice, it declares 4 arguments, so that it has access to the
        invoked method, method arguments and target object:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServletThrowsAdviceWithArguments <span class="hl-keyword">implements</span> ThrowsAdvice {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        <span class="hl-comment">// Do something with all arguments</span>
    }
}</pre><p>The final example illustrates how these two methods could be
        used in a single class, which handles both
        <code class="literal">RemoteException</code> and
        <code class="literal">ServletException</code>. Any number of throws advice
        methods can be combined in a single class.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> CombinedThrowsAdvice <span class="hl-keyword">implements</span> ThrowsAdvice {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(RemoteException ex) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-comment">// Do something with remote exception</span>
    }
 
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        <span class="hl-comment">// Do something with all arguments</span>
    }
}</pre><p><span class="emphasis"><em>Note:</em></span> If a throws-advice method throws an
        exception itself, it will override the original exception (i.e. change
        the exception thrown to the user). The overriding exception will
        typically be a RuntimeException; this is compatible with any method
        signature. However, if a throws-advice method throws a checked
        exception, it will have to match the declared exceptions of the target
        method and is hence to some degree coupled to specific target method
        signatures. <span class="emphasis"><em>Do not throw an undeclared checked exception
        that is incompatible with the target method's
        signature!</em></span></p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Throws advice can be used with any pointcut.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-after-returning"></a>9.3.2.4&nbsp;After Returning advice</h4></div></div></div><p>An after returning advice in Spring must implement the
        <span class="emphasis"><em>org.springframework.aop.AfterReturningAdvice</em></span>
        interface, shown below:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> AfterReturningAdvice <span class="hl-keyword">extends</span> Advice {

    <span class="hl-keyword">void</span> afterReturning(Object returnValue, Method m, Object[] args, Object target) 
            <span class="hl-keyword">throws</span> Throwable;
}</pre><p>An after returning advice has access to the return value (which
        it cannot modify), invoked method, methods arguments and
        target.</p><p>The following after returning advice counts all successful
        method invocations that have not thrown exceptions:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CountingAfterReturningAdvice <span class="hl-keyword">implements</span> AfterReturningAdvice {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> count;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterReturning(Object returnValue, Method m, Object[] args, Object target)
            <span class="hl-keyword">throws</span> Throwable {
        ++count;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getCount() {
        <span class="hl-keyword">return</span> count;
    }
}</pre><p>This advice doesn't change the execution path. If it throws an
        exception, this will be thrown up the interceptor chain instead of the
        return value.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>After returning advice can be used with any pointcut.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-introduction"></a>9.3.2.5&nbsp;Introduction advice</h4></div></div></div><p>Spring treats introduction advice as a special kind of
        interception advice.</p><p>Introduction requires an <code class="literal">IntroductionAdvisor</code>,
        and an <code class="literal">IntroductionInterceptor</code>, implementing the
        following interface:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IntroductionInterceptor <span class="hl-keyword">extends</span> MethodInterceptor {

    <span class="hl-keyword">boolean</span> implementsInterface(Class intf);
}</pre><p>The <code class="literal">invoke() </code>method inherited from the AOP
        Alliance <code class="literal">MethodInterceptor</code> interface must implement
        the introduction: that is, if the invoked method is on an introduced
        interface, the introduction interceptor is responsible for handling
        the method call - it cannot invoke
        <code class="literal">proceed()</code>.</p><p>Introduction advice cannot be used with any pointcut, as it
        applies only at class, rather than method, level. You can only use
        introduction advice with the <code class="literal">IntroductionAdvisor</code>,
        which has the following methods:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IntroductionAdvisor <span class="hl-keyword">extends</span> Advisor, IntroductionInfo {

	ClassFilter getClassFilter();

	<span class="hl-keyword">void</span> validateInterfaces() <span class="hl-keyword">throws</span> IllegalArgumentException;
}

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IntroductionInfo {

	Class[] getInterfaces();
}</pre><p>There is no <code class="interfacename">MethodMatcher</code>, and
        hence no <code class="interfacename">Pointcut</code>, associated with
        introduction advice. Only class filtering is logical.</p><p>The <code class="literal">getInterfaces()</code> method returns the
        interfaces introduced by this advisor.</p>

         The 

        <code class="literal">validateInterfaces()</code>

         method is used internally to see whether or not the introduced interfaces can be implemented by the configured 

        <code class="literal">IntroductionInterceptor</code>

         . 

        <p>Let's look at a simple example from the Spring test suite. Let's
        suppose we want to introduce the following interface to one or more
        objects:</p><p>
          </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Lockable {
    <span class="hl-keyword">void</span> lock();
    <span class="hl-keyword">void</span> unlock();
    <span class="hl-keyword">boolean</span> locked();
}</pre><p>
        </p><p>This illustrates a <span class="bold"><strong>mixin</strong></span>. We
        want to be able to cast advised objects to Lockable, whatever their
        type, and call lock and unlock methods. If we call the lock() method,
        we want all setter methods to throw a
        <code class="literal">LockedException</code>. Thus we can add an aspect that
        provides the ability to make objects immutable, without them having
        any knowledge of it: a good example of AOP.</p><p>Firstly, we'll need an
        <code class="literal">IntroductionInterceptor</code> that does the heavy
        lifting. In this case, we extend the
        <code class="literal">org.springframework.aop.support.DelegatingIntroductionInterceptor</code>
        convenience class. We could implement IntroductionInterceptor
        directly, but using
        <code class="literal">DelegatingIntroductionInterceptor</code> is best for most
        cases.</p><p>The <code class="literal">DelegatingIntroductionInterceptor</code> is
        designed to delegate an introduction to an actual implementation of
        the introduced interface(s), concealing the use of interception to do
        so. The delegate can be set to any object using a constructor
        argument; the default delegate (when the no-arg constructor is used)
        is this. Thus in the example below, the delegate is the
        <code class="literal">LockMixin</code> subclass of
        <code class="literal">DelegatingIntroductionInterceptor</code>. Given a delegate
        (by default itself), a
        <code class="literal">DelegatingIntroductionInterceptor</code> instance looks
        for all interfaces implemented by the delegate (other than
        IntroductionInterceptor), and will support introductions against any
        of them. It's possible for subclasses such as
        <code class="literal">LockMixin</code> to call the
        <code class="literal">suppressInterface(Class intf) </code>method to suppress
        interfaces that should not be exposed. However, no matter how many
        interfaces an <code class="literal">IntroductionInterceptor</code> is prepared
        to support, the <code class="literal">IntroductionAdvisor</code> used will
        control which interfaces are actually exposed. An introduced interface
        will conceal any implementation of the same interface by the
        target.</p><p>Thus LockMixin subclasses
        <code class="literal">DelegatingIntroductionInterceptor</code> and implements
        Lockable itself. The superclass automatically picks up that Lockable
        can be supported for introduction, so we don't need to specify that.
        We could introduce any number of interfaces in this way.</p><p>Note the use of the <code class="literal">locked</code> instance variable.
        This effectively adds additional state to that held in the target
        object.</p><p>
          </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> LockMixin <span class="hl-keyword">extends</span> DelegatingIntroductionInterceptor 
    <span class="hl-keyword">implements</span> Lockable {

    <span class="hl-keyword">private</span> <span class="hl-keyword">boolean</span> locked;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> lock() {
        <span class="hl-keyword">this</span>.locked = true;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> unlock() {
        <span class="hl-keyword">this</span>.locked = false;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> locked() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.locked;
    }

    <span class="hl-keyword">public</span> Object invoke(MethodInvocation invocation) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-keyword">if</span> (locked() &amp;&amp; invocation.getMethod().getName().indexOf(<span class="hl-string">"set"</span>) == 0)
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> LockedException();
        <span class="hl-keyword">return</span> <span class="hl-keyword">super</span>.invoke(invocation);
    }

}</pre><p>
        </p><p>Often it isn't necessary to override the <code class="literal">invoke()
        </code>method: the
        <code class="literal">DelegatingIntroductionInterceptor</code> implementation -
        which calls the delegate method if the method is introduced, otherwise
        proceeds towards the join point - is usually sufficient. In the
        present case, we need to add a check: no setter method can be invoked
        if in locked mode.</p><p>The introduction advisor required is simple. All it needs to do
        is hold a distinct <code class="literal">LockMixin</code> instance, and specify
        the introduced interfaces - in this case, just
        <code class="literal">Lockable</code>. A more complex example might take a
        reference to the introduction interceptor (which would be defined as a
        prototype): in this case, there's no configuration relevant for a
        <code class="literal">LockMixin</code>, so we simply create it using
        <code class="literal">new</code>.</p><p>
          </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> LockMixinAdvisor <span class="hl-keyword">extends</span> DefaultIntroductionAdvisor {

    <span class="hl-keyword">public</span> LockMixinAdvisor() {
        <span class="hl-keyword">super</span>(<span class="hl-keyword">new</span> LockMixin(), Lockable.<span class="hl-keyword">class</span>);
    }
}</pre><p>
        </p><p>We can apply this advisor very simply: it requires no
        configuration. (However, it <span class="emphasis"><em>is</em></span> necessary: It's
        impossible to use an <code class="literal">IntroductionInterceptor</code>
        without an <span class="emphasis"><em>IntroductionAdvisor</em></span>.) As usual with
        introductions, the advisor must be per-instance, as it is stateful. We
        need a different instance of <code class="literal">LockMixinAdvisor</code>, and
        hence <code class="literal">LockMixin</code>, for each advised object. The
        advisor comprises part of the advised object's state.</p><p>We can apply this advisor programmatically, using the
        <code class="literal">Advised.addAdvisor() </code>method, or (the recommended
        way) in XML configuration, like any other advisor. All proxy creation
        choices discussed below, including "auto proxy creators," correctly
        handle introductions and stateful mixins.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-advisor"></a>9.4&nbsp;Advisor API in Spring</h2></div></div></div><p>In Spring, an Advisor is an aspect that contains just a single
    advice object associated with a pointcut expression.</p><p>Apart from the special case of introductions, any advisor can be
    used with any advice.
    <code class="literal">org.springframework.aop.support.DefaultPointcutAdvisor</code>
    is the most commonly used advisor class. For example, it can be used with
    a <code class="literal">MethodInterceptor</code>, <code class="literal">BeforeAdvice</code> or
    <code class="literal">ThrowsAdvice</code>.</p><p>It is possible to mix advisor and advice types in Spring in the same
    AOP proxy. For example, you could use a interception around advice, throws
    advice and before advice in one proxy configuration: Spring will
    automatically create the necessary interceptor chain.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-pfb"></a>9.5&nbsp;Using the ProxyFactoryBean to create AOP proxies</h2></div></div></div><p>If you're using the Spring IoC container (an ApplicationContext or
    BeanFactory) for your business objects - and you should be! - you will
    want to use one of Spring's AOP FactoryBeans. (Remember that a factory
    bean introduces a layer of indirection, enabling it to create objects of a
    different type.)</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The Spring 2.0 AOP support also uses factory beans under the
      covers.</p></td></tr></table></div><p>The basic way to create an AOP proxy in Spring is to use the
    <span class="emphasis"><em>org.springframework.aop.framework.ProxyFactoryBean</em></span>.
    This gives complete control over the pointcuts and advice that will apply,
    and their ordering. However, there are simpler options that are preferable
    if you don't need such control.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-pfb-1"></a>9.5.1&nbsp;Basics</h3></div></div></div><p>The <code class="literal">ProxyFactoryBean</code>, like other Spring
      <code class="literal">FactoryBean</code> implementations, introduces a level of
      indirection. If you define a <code class="literal">ProxyFactoryBean</code> with
      name <code class="literal">foo</code>, what objects referencing
      <code class="literal">foo</code> see is not the
      <code class="literal">ProxyFactoryBean</code> instance itself, but an object
      created by the <code class="literal">ProxyFactoryBean</code>'s implementation of
      the <code class="literal">getObject() </code>method. This method will create an
      AOP proxy wrapping a target object.</p><p>One of the most important benefits of using a
      <code class="literal">ProxyFactoryBean</code> or another IoC-aware class to create
      AOP proxies, is that it means that advices and pointcuts can also be
      managed by IoC. This is a powerful feature, enabling certain approaches
      that are hard to achieve with other AOP frameworks. For example, an
      advice may itself reference application objects (besides the target,
      which should be available in any AOP framework), benefiting from all the
      pluggability provided by Dependency Injection.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-pfb-2"></a>9.5.2&nbsp;JavaBean properties</h3></div></div></div><p>In common with most <code class="interfacename">FactoryBean</code>
      implementations provided with Spring, the
      <code class="classname">ProxyFactoryBean</code> class is itself a JavaBean. Its
      properties are used to:</p><div class="itemizedlist"><ul type="disc"><li><p>Specify the target you want to proxy.</p></li><li><p>Specify whether to use CGLIB (see below and also
          <a class="xref" href="#aop-pfb-proxy-types" title="9.5.3&nbsp;JDK- and CGLIB-based proxies">Section&nbsp;9.5.3, &#8220;JDK- and CGLIB-based proxies&#8221;</a>).</p></li></ul></div><p>Some key properties are inherited from
      <code class="classname">org.springframework.aop.framework.ProxyConfig</code>
      (the superclass for all AOP proxy factories in Spring). These key
      properties include:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">proxyTargetClass</code>: <code class="literal">true</code>
          if the target class is to be proxied, rather than the target class'
          interfaces. If this property value is set to
          <code class="literal">true</code>, then CGLIB proxies will be created (but see
          also <a class="xref" href="#aop-pfb-proxy-types" title="9.5.3&nbsp;JDK- and CGLIB-based proxies">Section&nbsp;9.5.3, &#8220;JDK- and CGLIB-based proxies&#8221;</a>).</p></li><li><p><code class="literal">optimize</code>: controls whether or not
          aggressive optimizations are applied to proxies <span class="emphasis"><em>created
          via CGLIB</em></span>. One should not blithely use this setting
          unless one fully understands how the relevant AOP proxy handles
          optimization. This is currently used only for CGLIB proxies; it has
          no effect with JDK dynamic proxies.</p></li><li><p><code class="literal">frozen</code>: if a proxy configuration is
          <code class="literal">frozen</code>, then changes to the configuration are no
          longer allowed. This is useful both as a slight optimization and for
          those cases when you don't want callers to be able to manipulate the
          proxy (via the <code class="interfacename">Advised</code> interface)
          after the proxy has been created. The default value of this property
          is <code class="literal">false</code>, so changes such as adding additional
          advice are allowed.</p></li><li><p><code class="literal">exposeProxy</code>: determines whether or not the
          current proxy should be exposed in a
          <code class="classname">ThreadLocal</code> so that it can be accessed by the
          target. If a target needs to obtain the proxy and the
          <code class="literal">exposeProxy</code> property is set to
          <code class="literal">true</code>, the target can use the
          <code class="methodname">AopContext.currentProxy()</code> method.</p></li></ul></div><p>Other properties specific to
      <code class="classname">ProxyFactoryBean</code> include:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">proxyInterfaces</code>: array of String interface
          names. If this isn't supplied, a CGLIB proxy for the target class
          will be used (but see also <a class="xref" href="#aop-pfb-proxy-types" title="9.5.3&nbsp;JDK- and CGLIB-based proxies">Section&nbsp;9.5.3, &#8220;JDK- and CGLIB-based proxies&#8221;</a>).</p></li><li><p><code class="literal">interceptorNames</code>: String array of
          <code class="interfacename">Advisor</code>, interceptor or other advice
          names to apply. Ordering is significant, on a first come-first
          served basis. That is to say that the first interceptor in the list
          will be the first to be able to intercept the invocation.</p><p>The names are bean names in the current factory, including
          bean names from ancestor factories. You can't mention bean
          references here since doing so would result in the
          <code class="classname">ProxyFactoryBean</code> ignoring the singleton
          setting of the advice.</p><p>You can append an interceptor name with an asterisk
          (<code class="literal">*</code>). This will result in the application of all
          advisor beans with names starting with the part before the asterisk
          to be applied. An example of using this feature can be found in
          <a class="xref" href="#aop-global-advisors" title="9.5.6&nbsp;Using 'global' advisors">Section&nbsp;9.5.6, &#8220;Using 'global' advisors&#8221;</a>.</p></li><li><p>singleton: whether or not the factory should return a single
          object, no matter how often the <code class="literal">getObject()</code>
          method is called. Several <code class="interfacename">FactoryBean</code>
          implementations offer such a method. The default value is
          <code class="literal">true</code>. If you want to use stateful advice - for
          example, for stateful mixins - use prototype advices along with a
          singleton value of <code class="literal">false</code>.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-pfb-proxy-types"></a>9.5.3&nbsp;JDK- and CGLIB-based proxies</h3></div></div></div><p>This section serves as the definitive documentation on how the
      <code class="classname">ProxyFactoryBean</code> chooses to create one of either
      a JDK- and CGLIB-based proxy for a particular target object (that is to
      be proxied).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The behavior of the <code class="classname">ProxyFactoryBean</code> with
        regard to creating JDK- or CGLIB-based proxies changed between
        versions 1.2.x and 2.0 of Spring. The
        <code class="classname">ProxyFactoryBean</code> now exhibits similar semantics
        with regard to auto-detecting interfaces as those of the
        <code class="classname">TransactionProxyFactoryBean</code> class.</p></td></tr></table></div><p>If the class of a target object that is to be proxied (hereafter
      simply referred to as the target class) doesn't implement any
      interfaces, then a CGLIB-based proxy will be created. This is the
      easiest scenario, because JDK proxies are interface based, and no
      interfaces means JDK proxying isn't even possible. One simply plugs in
      the target bean, and specifies the list of interceptors via the
      <code class="literal">interceptorNames</code> property. Note that a CGLIB-based
      proxy will be created even if the <code class="literal">proxyTargetClass</code>
      property of the <code class="classname">ProxyFactoryBean</code> has been set to
      <code class="literal">false</code>. (Obviously this makes no sense, and is best
      removed from the bean definition because it is at best redundant, and at
      worst confusing.)</p><p>If the target class implements one (or more) interfaces, then the
      type of proxy that is created depends on the configuration of the
      <code class="classname">ProxyFactoryBean</code>.</p><p>If the <code class="literal">proxyTargetClass</code> property of the
      <code class="classname">ProxyFactoryBean</code> has been set to
      <code class="literal">true</code>, then a CGLIB-based proxy will be created. This
      makes sense, and is in keeping with the principle of least surprise.
      Even if the <code class="literal">proxyInterfaces</code> property of the
      <code class="classname">ProxyFactoryBean</code> has been set to one or more
      fully qualified interface names, the fact that the
      <code class="literal">proxyTargetClass</code> property is set to
      <code class="literal">true</code> <span class="emphasis"><em>will</em></span> cause CGLIB-based
      proxying to be in effect.</p><p>If the <code class="literal">proxyInterfaces</code> property of the
      <code class="classname">ProxyFactoryBean</code> has been set to one or more
      fully qualified interface names, then a JDK-based proxy will be created.
      The created proxy will implement all of the interfaces that were
      specified in the <code class="literal">proxyInterfaces</code> property; if the
      target class happens to implement a whole lot more interfaces than those
      specified in the <code class="literal">proxyInterfaces</code> property, that is
      all well and good but those additional interfaces will not be
      implemented by the returned proxy.</p><p>If the <code class="literal">proxyInterfaces</code> property of the
      <code class="classname">ProxyFactoryBean</code> has <span class="emphasis"><em>not</em></span>
      been set, but the target class <span class="emphasis"><em>does implement one (or
      more)</em></span> interfaces, then the
      <code class="classname">ProxyFactoryBean</code> will auto-detect the fact that
      the target class does actually implement at least one interface, and a
      JDK-based proxy will be created. The interfaces that are actually
      proxied will be <span class="emphasis"><em>all</em></span> of the interfaces that the
      target class implements; in effect, this is the same as simply supplying
      a list of each and every interface that the target class implements to
      the <code class="literal">proxyInterfaces</code> property. However, it is
      significantly less work, and less prone to typos.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-proxying-intf"></a>9.5.4&nbsp;Proxying interfaces</h3></div></div></div><p>Let's look at a simple example of
      <code class="classname">ProxyFactoryBean</code> in action. This example
      involves:</p><div class="itemizedlist"><ul type="disc"><li><p>A <span class="emphasis"><em>target bean</em></span> that will be proxied. This
          is the "personTarget" bean definition in the example below.</p></li><li><p>An Advisor and an Interceptor used to provide advice.</p></li><li><p>An AOP proxy bean definition specifying the target object (the
          personTarget bean) and the interfaces to proxy, along with the
          advices to apply.</p></li></ul></div><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"personTarget"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.PersonImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Tony"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"51"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.MyAdvisor"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someProperty"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Custom string property value"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"debugInterceptor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.interceptor.DebugInterceptor"</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"person"</span> 
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"proxyInterfaces"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.mycompany.Person"</span>/&gt;

    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"personTarget"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;myAdvisor&lt;<span class="hl-tag">/value</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;debugInterceptor&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Note that the <code class="literal">interceptorNames</code> property takes a
      list of String: the bean names of the interceptor or advisors in the
      current factory. Advisors, interceptors, before, after returning and
      throws advice objects can be used. The ordering of advisors is
      significant.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You might be wondering why the list doesn't hold bean
        references. The reason for this is that if the ProxyFactoryBean's
        singleton property is set to false, it must be able to return
        independent proxy instances. If any of the advisors is itself a
        prototype, an independent instance would need to be returned, so it's
        necessary to be able to obtain an instance of the prototype from the
        factory; holding a reference isn't sufficient.</p></td></tr></table></div><p>The "person" bean definition above can be used in place of a
      Person implementation, as follows:</p><pre class="programlisting">Person person = (Person) factory.getBean(<span class="hl-string">"person"</span>);</pre><p>Other beans in the same IoC context can express a strongly typed
      dependency on it, as with an ordinary Java object:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"personUser"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.PersonUser"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"person"</span>&gt;&lt;<span class="hl-tag">ref</span> <span class="hl-attribute">local</span>=<span class="hl-value">"person"</span>/&gt;&lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The <code class="literal">PersonUser</code> class in this example would
      expose a property of type Person. As far as it's concerned, the AOP
      proxy can be used transparently in place of a "real" person
      implementation. However, its class would be a dynamic proxy class. It
      would be possible to cast it to the <code class="literal">Advised</code> interface
      (discussed below).</p><p>It's possible to conceal the distinction between target and proxy
      using an anonymous <span class="emphasis"><em>inner bean</em></span>, as follows. Only the
      <code class="literal">ProxyFactoryBean</code> definition is different; the advice
      is included only for completeness:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.MyAdvisor"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someProperty"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Custom string property value"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"debugInterceptor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.interceptor.DebugInterceptor"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"person"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"proxyInterfaces"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.mycompany.Person"</span>/&gt;
  &lt;<span class="hl-comment">!-- Use inner bean, not local reference to target --</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.PersonImpl"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Tony"</span>/&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"51"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span>&gt;
    &lt;<span class="hl-tag">list</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;myAdvisor&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;debugInterceptor&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>This has the advantage that there's only one object of type
      <code class="literal">Person</code>: useful if we want to prevent users of the
      application context from obtaining a reference to the un-advised object,
      or need to avoid any ambiguity with Spring IoC
      <span class="emphasis"><em>autowiring</em></span>. There's also arguably an advantage in
      that the ProxyFactoryBean definition is self-contained. However, there
      are times when being able to obtain the un-advised target from the
      factory might actually be an <span class="emphasis"><em>advantage</em></span>: for
      example, in certain test scenarios.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-proxying-class"></a>9.5.5&nbsp;Proxying classes</h3></div></div></div><p>What if you need to proxy a class, rather than one or more
      interfaces?</p><p>Imagine that in our example above, there was no
      <code class="literal">Person</code> interface: we needed to advise a class called
      <code class="literal">Person</code> that didn't implement any business interface.
      In this case, you can configure Spring to use CGLIB proxying, rather
      than dynamic proxies. Simply set the <code class="literal">proxyTargetClass</code>
      property on the ProxyFactoryBean above to true. While it's best to
      program to interfaces, rather than classes, the ability to advise
      classes that don't implement interfaces can be useful when working with
      legacy code. (In general, Spring isn't prescriptive. While it makes it
      easy to apply good practices, it avoids forcing a particular
      approach.)</p><p>If you want to, you can force the use of CGLIB in any case, even
      if you do have interfaces.</p><p>CGLIB proxying works by generating a subclass of the target class
      at runtime. Spring configures this generated subclass to delegate method
      calls to the original target: the subclass is used to implement the
      <span class="emphasis"><em>Decorator</em></span> pattern, weaving in the advice.</p><p>CGLIB proxying should generally be transparent to users. However,
      there are some issues to consider:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">Final</code> methods can't be advised, as they
          can't be overridden.</p></li><li><p>You'll need the CGLIB 2 binaries on your classpath; dynamic
          proxies are available with the JDK.</p></li></ul></div><p>There's little performance difference between CGLIB proxying and
      dynamic proxies. As of Spring 1.0, dynamic proxies are slightly faster.
      However, this may change in the future. Performance should not be a
      decisive consideration in this case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-global-advisors"></a>9.5.6&nbsp;Using 'global' advisors</h3></div></div></div><p>By appending an asterisk to an interceptor name, all advisors with
      bean names matching the part before the asterisk, will be added to the
      advisor chain. This can come in handy if you need to add a standard set
      of 'global' advisors: </p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"proxy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"service"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span>&gt;
    &lt;<span class="hl-tag">list</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;global*&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"global_debug"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.interceptor.DebugInterceptor"</span>/&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"global_performance"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.interceptor.PerformanceMonitorInterceptor"</span>/&gt;
</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-concise-proxy"></a>9.6&nbsp;Concise proxy definitions</h2></div></div></div><p>Especially when defining transactional proxies, you may end up with
    many similar proxy definitions. The use of parent and child bean
    definitions, along with inner bean definitions, can result in much cleaner
    and more concise proxy definitions.</p><p>First a parent, <span class="emphasis"><em>template</em></span>, bean definition is
    created for the proxy:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txProxyTemplate"</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">"true"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributes"</span>&gt;
    &lt;<span class="hl-tag">props</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"*"</span>&gt;PROPAGATION_REQUIRED&lt;<span class="hl-tag">/prop</span>&gt;
    &lt;<span class="hl-tag">/props</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>This will never be instantiated itself, so may actually be
    incomplete. Then each proxy which needs to be created is just a child bean
    definition, which wraps the target of the proxy as an inner bean
    definition, since the target will never be used on its own
    anyway.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myService"</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"txProxyTemplate"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.MyServiceImpl"</span>&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>It is of course possible to override properties from the parent
    template, such as in this case, the transaction propagation
    settings:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mySpecialService"</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"txProxyTemplate"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.MySpecialServiceImpl"</span>&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributes"</span>&gt;
    &lt;<span class="hl-tag">props</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"get*"</span>&gt;PROPAGATION_REQUIRED,readOnly&lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"find*"</span>&gt;PROPAGATION_REQUIRED,readOnly&lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"load*"</span>&gt;PROPAGATION_REQUIRED,readOnly&lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"store*"</span>&gt;PROPAGATION_REQUIRED&lt;<span class="hl-tag">/prop</span>&gt;
    &lt;<span class="hl-tag">/props</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Note that in the example above, we have explicitly marked the parent
    bean definition as <span class="emphasis"><em>abstract</em></span> by using the
    <span class="emphasis"><em>abstract</em></span> attribute, as described <a class="link" href="#beans-child-bean-definitions" title="4.7&nbsp;Bean definition inheritance">previously</a>, so that it may
    not actually ever be instantiated. Application contexts (but not simple
    bean factories) will by default pre-instantiate all singletons. It is
    therefore important (at least for singleton beans) that if you have a
    (parent) bean definition which you intend to use only as a template, and
    this definition specifies a class, you must make sure to set the
    <span class="emphasis"><em>abstract</em></span> attribute to <span class="emphasis"><em>true</em></span>,
    otherwise the application context will actually try to pre-instantiate
    it.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-prog"></a>9.7&nbsp;Creating AOP proxies programmatically with the ProxyFactory</h2></div></div></div><p>It's easy to create AOP proxies programmatically using Spring. This
    enables you to use Spring AOP without dependency on Spring IoC.</p><p>The following listing shows creation of a proxy for a target object,
    with one interceptor and one advisor. The interfaces implemented by the
    target object will automatically be proxied:</p><pre class="programlisting">ProxyFactory factory = <span class="hl-keyword">new</span> ProxyFactory(myBusinessInterfaceImpl);
factory.addAdvice(myMethodInterceptor);
factory.addAdvisor(myAdvisor);
MyBusinessInterface tb = (MyBusinessInterface) factory.getProxy();</pre><p>The first step is to construct an object of type
    <code class="literal">org.springframework.aop.framework.ProxyFactory</code>. You can
    create this with a target object, as in the above example, or specify the
    interfaces to be proxied in an alternate constructor.</p><p>You can add advices (with interceptors as a specialized kind of advice)
    and/or advisors, and manipulate them for the life of the ProxyFactory.
    If you add an IntroductionInterceptionAroundAdvisor, you can cause the proxy
    to implement additional interfaces.</p><p>There are also convenience methods on ProxyFactory (inherited from
    <code class="classname">AdvisedSupport</code>) which allow you to add other advice
    types such as before and throws advice. AdvisedSupport is the superclass
    of both ProxyFactory and ProxyFactoryBean.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Integrating AOP proxy creation with the IoC framework is best
      practice in most applications. We recommend that you externalize
      configuration from Java code with AOP, as in general.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-advised"></a>9.8&nbsp;Manipulating advised objects</h2></div></div></div><p>However you create AOP proxies, you can manipulate them using the
    <code class="literal">org.springframework.aop.framework.Advised</code> interface.
    Any AOP proxy can be cast to this interface, whichever other interfaces it
    implements. This interface includes the following methods:</p><pre class="programlisting">Advisor[] getAdvisors();

<span class="hl-keyword">void</span> addAdvice(Advice advice) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> addAdvice(<span class="hl-keyword">int</span> pos, Advice advice) 
        <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> addAdvisor(Advisor advisor) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> addAdvisor(<span class="hl-keyword">int</span> pos, Advisor advisor) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">int</span> indexOf(Advisor advisor);

<span class="hl-keyword">boolean</span> removeAdvisor(Advisor advisor) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> removeAdvisor(<span class="hl-keyword">int</span> index) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">boolean</span> replaceAdvisor(Advisor a, Advisor b) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">boolean</span> isFrozen();</pre><p>The <code class="literal">getAdvisors()</code> method will return an Advisor
    for every advisor, interceptor or other advice type that has been added to
    the factory. If you added an Advisor, the returned advisor at this index
    will be the object that you added. If you added an interceptor or other
    advice type, Spring will have wrapped this in an advisor with a pointcut
    that always returns true. Thus if you added a
    <code class="literal">MethodInterceptor</code>, the advisor returned for this index
    will be an <code class="literal">DefaultPointcutAdvisor</code> returning your
    <code class="literal">MethodInterceptor</code> and a pointcut that matches all
    classes and methods.</p><p>The <code class="literal">addAdvisor()</code> methods can be used to add any
    Advisor. Usually the advisor holding pointcut and advice will be the
    generic <code class="literal">DefaultPointcutAdvisor</code>, which can be used with
    any advice or pointcut (but not for introductions).</p><p>By default, it's possible to add or remove advisors or interceptors
    even once a proxy has been created. The only restriction is that it's
    impossible to add or remove an introduction advisor, as existing proxies
    from the factory will not show the interface change. (You can obtain a new
    proxy from the factory to avoid this problem.)</p><p>A simple example of casting an AOP proxy to the
    <code class="literal">Advised</code> interface and examining and manipulating its
    advice:</p><pre class="programlisting">Advised advised = (Advised) myObject;
Advisor[] advisors = advised.getAdvisors();
<span class="hl-keyword">int</span> oldAdvisorCount = advisors.length;
System.out.println(oldAdvisorCount + <span class="hl-string">" advisors"</span>);

<span class="hl-comment">// Add an advice like an interceptor without a pointcut</span>
<span class="hl-comment">// Will match all proxied methods</span>
<span class="hl-comment">// Can use for interceptors, before, after returning or throws advice</span>
advised.addAdvice(<span class="hl-keyword">new</span> DebugInterceptor());

<span class="hl-comment">// Add selective advice using a pointcut</span>
advised.addAdvisor(<span class="hl-keyword">new</span> DefaultPointcutAdvisor(mySpecialPointcut, myAdvice));

assertEquals(<span class="hl-string">"Added two advisors"</span>,
     oldAdvisorCount + 2, advised.getAdvisors().length);</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>It's questionable whether it's advisable (no pun intended) to
      modify advice on a business object in production, although there are no
      doubt legitimate usage cases. However, it can be very useful in
      development: for example, in tests. I have sometimes found it very
      useful to be able to add test code in the form of an interceptor or
      other advice, getting inside a method invocation I want to test. (For
      example, the advice can get inside a transaction created for that
      method: for example, to run SQL to check that a database was correctly
      updated, before marking the transaction for roll back.)</p></td></tr></table></div><p>Depending on how you created the proxy, you can usually set a
    <code class="literal">frozen</code> flag, in which case the
    <code class="literal">Advised</code> <code class="literal">isFrozen()</code> method will
    return true, and any attempts to modify advice through addition or removal
    will result in an <code class="literal">AopConfigException</code>. The ability to
    freeze the state of an advised object is useful in some cases, for
    example, to prevent calling code removing a security interceptor. It may
    also be used in Spring 1.1 to allow aggressive optimization if runtime
    advice modification is known not to be required.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-autoproxy"></a>9.9&nbsp;Using the "autoproxy" facility</h2></div></div></div><p>So far we've considered explicit creation of AOP proxies using a
    <code class="literal">ProxyFactoryBean</code> or similar factory bean.</p><p>Spring also allows us to use "autoproxy" bean definitions, which can
    automatically proxy selected bean definitions. This is built on Spring
    "bean post processor" infrastructure, which enables modification of any
    bean definition as the container loads.</p><p>In this model, you set up some special bean definitions in your XML
    bean definition file to configure the auto proxy infrastructure. This
    allows you just to declare the targets eligible for autoproxying: you
    don't need to use <code class="literal">ProxyFactoryBean</code>.</p><p>There are two ways to do this:</p><div class="itemizedlist"><ul type="disc"><li><p>Using an autoproxy creator that refers to specific beans in the
        current context.</p></li><li><p>A special case of autoproxy creation that deserves to be
        considered separately; autoproxy creation driven by source-level
        metadata attributes.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-autoproxy-choices"></a>9.9.1&nbsp;Autoproxy bean definitions</h3></div></div></div><p>The <code class="literal">org.springframework.aop.framework.autoproxy</code>
      package provides the following standard autoproxy creators.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-autoproxy"></a>9.9.1.1&nbsp;BeanNameAutoProxyCreator</h4></div></div></div><p>The <code class="literal">BeanNameAutoProxyCreator</code> class is a
        <code class="literal">BeanPostProcessor</code> that automatically creates AOP
        proxies for beans with names matching literal values or
        wildcards.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beanNames"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdk*,onlyJdk"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span>&gt;
    &lt;<span class="hl-tag">list</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;myInterceptor&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>As with <code class="literal">ProxyFactoryBean</code>, there is an
        <code class="literal">interceptorNames</code> property rather than a list of
        interceptors, to allow correct behavior for prototype advisors. Named
        "interceptors" can be advisors or any advice type.</p><p>As with auto proxying in general, the main point of using
        <code class="literal">BeanNameAutoProxyCreator</code> is to apply the same
        configuration consistently to multiple objects, with minimal volume of
        configuration. It is a popular choice for applying declarative
        transactions to multiple objects.</p><p>Bean definitions whose names match, such as "jdkMyBean" and
        "onlyJdk" in the above example, are plain old bean definitions with
        the target class. An AOP proxy will be created automatically by the
        <code class="literal">BeanNameAutoProxyCreator</code>. The same advice will be
        applied to all matching beans. Note that if advisors are used (rather
        than the interceptor in the above example), the pointcuts may apply
        differently to different beans.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-autoproxy-default"></a>9.9.1.2&nbsp;DefaultAdvisorAutoProxyCreator</h4></div></div></div><p>A more general and extremely powerful auto proxy creator is
        <code class="literal">DefaultAdvisorAutoProxyCreator</code>. This will
        automagically apply eligible advisors in the current context, without
        the need to include specific bean names in the autoproxy advisor's
        bean definition. It offers the same merit of consistent configuration
        and avoidance of duplication as
        <code class="literal">BeanNameAutoProxyCreator</code>.</p><p>Using this mechanism involves:</p><div class="itemizedlist"><ul type="disc"><li><p>Specifying a
            <code class="literal">DefaultAdvisorAutoProxyCreator</code> bean
            definition.</p></li><li><p>Specifying any number of Advisors in the same or related
            contexts. Note that these <span class="emphasis"><em>must</em></span> be Advisors,
            not just interceptors or other advices. This is necessary because
            there must be a pointcut to evaluate, to check the eligibility of
            each advice to candidate bean definitions.</p></li></ul></div><p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> will
        automatically evaluate the pointcut contained in each advisor, to see
        what (if any) advice it should apply to each business object (such as
        "businessObject1" and "businessObject2" in the example).</p><p>This means that any number of advisors can be applied
        automatically to each business object. If no pointcut in any of the
        advisors matches any method in a business object, the object will not
        be proxied. As bean definitions are added for new business objects,
        they will automatically be proxied if necessary.</p><p>Autoproxying in general has the advantage of making it
        impossible for callers or dependencies to obtain an un-advised object.
        Calling getBean("businessObject1") on this ApplicationContext will
        return an AOP proxy, not the target business object. (The "inner bean"
        idiom shown earlier also offers this benefit.)</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionInterceptor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionInterceptor"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"customAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.MyAdvisor"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessObject1"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.BusinessObject1"</span>&gt;
  &lt;<span class="hl-comment">!-- Properties omitted --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessObject2"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.BusinessObject2"</span>/&gt;
</pre><p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> is very
        useful if you want to apply the same advice consistently to many
        business objects. Once the infrastructure definitions are in place,
        you can simply add new business objects without including specific
        proxy configuration. You can also drop in additional aspects very
        easily - for example, tracing or performance monitoring aspects - with
        minimal change to configuration.</p><p>The DefaultAdvisorAutoProxyCreator offers support for filtering
        (using a naming convention so that only certain advisors are
        evaluated, allowing use of multiple, differently configured,
        AdvisorAutoProxyCreators in the same factory) and ordering. Advisors
        can implement the <code class="literal">org.springframework.core.Ordered</code>
        interface to ensure correct ordering if this is an issue. The
        TransactionAttributeSourceAdvisor used in the above example has a
        configurable order value; the default setting is unordered.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-autoproxy-abstract"></a>9.9.1.3&nbsp;AbstractAdvisorAutoProxyCreator</h4></div></div></div><p>This is the superclass of DefaultAdvisorAutoProxyCreator. You
        can create your own autoproxy creators by subclassing this class, in
        the unlikely event that advisor definitions offer insufficient
        customization to the behavior of the framework
        <code class="literal">DefaultAdvisorAutoProxyCreator</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-autoproxy-metadata"></a>9.9.2&nbsp;Using metadata-driven auto-proxying</h3></div></div></div><p>A particularly important type of autoproxying is driven by
      metadata. This produces a similar programming model to .NET
      <code class="literal">ServicedComponents</code>. Instead of using XML deployment
      descriptors as in EJB, configuration for transaction management and
      other enterprise services is held in source-level attributes.</p><p>In this case, you use the
      <code class="literal">DefaultAdvisorAutoProxyCreator</code>, in combination with
      Advisors that understand metadata attributes. The metadata specifics are
      held in the pointcut part of the candidate advisors, rather than in the
      autoproxy creation class itself.</p><p>This is really a special case of the
      <code class="literal">DefaultAdvisorAutoProxyCreator</code>, but deserves
      consideration on its own. (The metadata-aware code is in the pointcuts
      contained in the advisors, not the AOP framework itself.)</p><p>The <code class="literal">/attributes</code> directory of the JPetStore
      sample application shows the use of attribute-driven autoproxying. In
      this case, there's no need to use the
      <code class="literal">TransactionProxyFactoryBean</code>. Simply defining
      transactional attributes on business objects is sufficient, because of
      the use of metadata-aware pointcuts. The bean definitions include the
      following code, in <code class="literal">/WEB-INF/declarativeServices.xml</code>.
      Note that this is generic, and can be used outside the JPetStore:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionInterceptor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionInterceptor"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionInterceptor"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionInterceptor"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributeSource"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.AttributesTransactionAttributeSource"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"attributes"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"attributes"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"attributes"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.metadata.commons.CommonsAttributes"</span>/&gt;</pre><p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> bean
      definition (the name is not significant, hence it can even be omitted)
      will pick up all eligible pointcuts in the current application context.
      In this case, the "transactionAdvisor" bean definition, of type
      <code class="literal">TransactionAttributeSourceAdvisor</code>, will apply to
      classes or methods carrying a transaction attribute. The
      TransactionAttributeSourceAdvisor depends on a TransactionInterceptor,
      via constructor dependency. The example resolves this via autowiring.
      The <code class="literal">AttributesTransactionAttributeSource</code> depends on
      an implementation of the
      <code class="literal">org.springframework.metadata.Attributes</code> interface. In
      this fragment, the "attributes" bean satisfies this, using the Jakarta
      Commons Attributes API to obtain attribute information. (The application
      code must have been compiled using the Commons Attributes compilation
      task.)</p><p>The <code class="literal">/annotation</code> directory of the JPetStore
      sample application contains an analogous example for auto-proxying
      driven by JDK 1.5+ annotations. The following configuration enables
      automatic detection of Spring's <code class="literal">Transactional</code>
      annotation, leading to implicit proxies for beans containing that
      annotation:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionInterceptor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionInterceptor"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionInterceptor"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionInterceptor"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributeSource"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.annotation.AnnotationTransactionAttributeSource"</span>/&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The <code class="literal">TransactionInterceptor</code> defined here depends
      on a <code class="literal">PlatformTransactionManager</code> definition, which is
      not included in this generic file (although it could be) because it will
      be specific to the application's transaction requirements (typically
      JTA, as in this example, or Hibernate, JDO or JDBC):</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionManager"</span> 
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.jta.JtaTransactionManager"</span>/&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you require only declarative transaction management, using
        these generic XML definitions will result in Spring automatically
        proxying all classes or methods with transaction attributes. You won't
        need to work directly with AOP, and the programming model is similar
        to that of .NET ServicedComponents.</p></td></tr></table></div><p>This mechanism is extensible. It's possible to do autoproxying
      based on custom attributes. You need to:</p><div class="itemizedlist"><ul type="disc"><li><p>Define your custom attribute.</p></li><li><p>Specify an Advisor with the necessary advice, including a
          pointcut that is triggered by the presence of the custom attribute
          on a class or method. You may be able to use an existing advice,
          merely implementing a static pointcut that picks up the custom
          attribute.</p></li></ul></div><p>It's possible for such advisors to be unique to each advised class
      (for example, mixins): they simply need to be defined as prototype,
      rather than singleton, bean definitions. For example, the
      <code class="literal">LockMixin</code> introduction interceptor from the Spring
      test suite, shown above, could be used in conjunction with an
      attribute-driven pointcut to target a mixin, as shown here. We use the
      generic <code class="literal">DefaultPointcutAdvisor</code>, configured using
      JavaBean properties:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"lockMixin"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.LockMixin"</span>
    <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"lockableAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.support.DefaultPointcutAdvisor"</span>
    <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"pointcut"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myAttributeAwarePointcut"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"advice"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"lockMixin"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anyBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"anyclass"</span> <span class="hl-attribute">...</span></pre><p>If the attribute aware pointcut matches any methods in the
      <code class="literal">anyBean</code> or other bean definitions, the mixin will be
      applied. Note that both <code class="literal">lockMixin</code> and
      <code class="literal">lockableAdvisor</code> definitions are prototypes. The
      <code class="literal">myAttributeAwarePointcut</code> pointcut can be a singleton
      definition, as it doesn't hold state for individual advised
      objects.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-targetsource"></a>9.10&nbsp;Using TargetSources</h2></div></div></div><p>Spring offers the concept of a <span class="emphasis"><em>TargetSource</em></span>,
    expressed in the <code class="literal">org.springframework.aop.TargetSource</code>
    interface. This interface is responsible for returning the "target object"
    implementing the join point. The <code class="literal">TargetSource</code>
    implementation is asked for a target instance each time the AOP proxy
    handles a method invocation.</p><p>Developers using Spring AOP don't normally need to work directly
    with TargetSources, but this provides a powerful means of supporting
    pooling, hot swappable and other sophisticated targets. For example, a
    pooling TargetSource can return a different target instance for each
    invocation, using a pool to manage instances.</p><p>If you do not specify a TargetSource, a default implementation is
    used that wraps a local object. The same target is returned for each
    invocation (as you would expect).</p><p>Let's look at the standard target sources provided with Spring, and
    how you can use them.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>When using a custom target source, your target will usually need
      to be a prototype rather than a singleton bean definition. This allows
      Spring to create a new target instance when required.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ts-swap"></a>9.10.1&nbsp;Hot swappable target sources</h3></div></div></div><p>The
      <code class="literal">org.springframework.aop.target.HotSwappableTargetSource</code>
      exists to allow the target of an AOP proxy to be switched while allowing
      callers to keep their references to it.</p><p>Changing the target source's target takes effect immediately. The
      <code class="literal">HotSwappableTargetSource</code> is threadsafe.</p><p>You can change the target via the <code class="literal">swap()</code> method
      on HotSwappableTargetSource as follows:</p><pre class="programlisting">HotSwappableTargetSource swapper = 
    (HotSwappableTargetSource) beanFactory.getBean(<span class="hl-string">"swapper"</span>);
Object oldTarget = swapper.swap(newTarget);</pre><p>The XML definitions required look as follows:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"initialTarget"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mycompany.OldTarget"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"swapper"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.target.HotSwappableTargetSource"</span>&gt;
  &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"initialTarget"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"swappable"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"swapper"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The above <code class="literal">swap()</code> call changes the target of the
      swappable bean. Clients who hold a reference to that bean will be
      unaware of the change, but will immediately start hitting the new
      target.</p><p>Although this example doesn't add any advice - and it's not
      necessary to add advice to use a <code class="literal">TargetSource</code> - of
      course any <code class="literal">TargetSource</code> can be used in conjunction
      with arbitrary advice.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ts-pool"></a>9.10.2&nbsp;Pooling target sources</h3></div></div></div><p>Using a pooling target source provides a similar programming model
      to stateless session EJBs, in which a pool of identical instances is
      maintained, with method invocations going to free objects in the
      pool.</p><p>A crucial difference between Spring pooling and SLSB pooling is
      that Spring pooling can be applied to any POJO. As with Spring in
      general, this service can be applied in a non-invasive way.</p><p>Spring provides out-of-the-box support for Jakarta Commons Pool
      1.3, which provides a fairly efficient pooling implementation. You'll
      need the commons-pool Jar on your application's classpath to use this
      feature. It's also possible to subclass
      <code class="literal">org.springframework.aop.target.AbstractPoolingTargetSource</code>
      to support any other pooling API.</p><p>Sample configuration is shown below:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessObjectTarget"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.MyBusinessObject"</span> 
    <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span>&gt;
  ... properties omitted
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"poolTargetSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.target.CommonsPoolTargetSource"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetBeanName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"businessObjectTarget"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"maxSize"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"25"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessObject"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"poolTargetSource"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"myInterceptor"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Note that the target object - "businessObjectTarget" in the
      example - <span class="emphasis"><em>must</em></span> be a prototype. This allows the
      <code class="literal">PoolingTargetSource</code> implementation to create new
      instances of the target to grow the pool as necessary. See the javadoc
      for <code class="literal">AbstractPoolingTargetSource</code> and the concrete
      subclass you wish to use for information about its properties: "maxSize"
      is the most basic, and always guaranteed to be present.</p><p>In this case, "myInterceptor" is the name of an interceptor that
      would need to be defined in the same IoC context. However, it isn't
      necessary to specify interceptors to use pooling. If you want only
      pooling, and no other advice, don't set the interceptorNames property at
      all.</p><p>It's possible to configure Spring so as to be able to cast any
      pooled object to the
      <code class="literal">org.springframework.aop.target.PoolingConfig</code>
      interface, which exposes information about the configuration and current
      size of the pool through an introduction. You'll need to define an
      advisor like this:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"poolConfigAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.MethodInvokingFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetObject"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"poolTargetSource"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetMethod"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"getPoolingConfigMixin"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>This advisor is obtained by calling a convenience method on the
      <code class="literal">AbstractPoolingTargetSource</code> class, hence the use of
      MethodInvokingFactoryBean. This advisor's name ("poolConfigAdvisor"
      here) must be in the list of interceptors names in the ProxyFactoryBean
      exposing the pooled object.</p><p>The cast will look as follows:</p><pre class="programlisting">PoolingConfig conf = (PoolingConfig) beanFactory.getBean(<span class="hl-string">"businessObject"</span>);
System.out.println(<span class="hl-string">"Max pool size is "</span> + conf.getMaxSize());</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Pooling stateless service objects is not usually necessary. We
        don't believe it should be the default choice, as most stateless
        objects are naturally thread safe, and instance pooling is problematic
        if resources are cached.</p></td></tr></table></div><p>Simpler pooling is available using autoproxying. It's possible to
      set the TargetSources used by any autoproxy creator.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ts-prototype"></a>9.10.3&nbsp;Prototype target sources</h3></div></div></div><p>Setting up a "prototype" target source is similar to a pooling
      TargetSource. In this case, a new instance of the target will be created
      on every method invocation. Although the cost of creating a new object
      isn't high in a modern JVM, the cost of wiring up the new object
      (satisfying its IoC dependencies) may be more expensive. Thus you
      shouldn't use this approach without very good reason.</p><p>To do this, you could modify the
      <code class="literal">poolTargetSource</code> definition shown above as follows.
      (I've also changed the name, for clarity.)</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"prototypeTargetSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.target.PrototypeTargetSource"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetBeanName"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"businessObjectTarget"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>There's only one property: the name of the target bean.
      Inheritance is used in the TargetSource implementations to ensure
      consistent naming. As with the pooling target source, the target bean
      must be a prototype bean definition.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ts-threadlocal"></a>9.10.4&nbsp;<code class="classname">ThreadLocal</code> target sources</h3></div></div></div><p><code class="classname">ThreadLocal</code> target sources are useful if
      you need an object to be created for each incoming request (per thread
      that is). The concept of a <code class="classname">ThreadLocal</code> provide a
      JDK-wide facility to transparently store resource alongside a thread.
      Setting up a <code class="classname">ThreadLocalTargetSource</code> is pretty
      much the same as was explained for the other types of target
      source:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"threadlocalTargetSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.target.ThreadLocalTargetSource"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetBeanName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"businessObjectTarget"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>ThreadLocals come with serious issues (potentially resulting in
        memory leaks) when incorrectly using them in a multi-threaded and
        multi-classloader environments. One should always consider wrapping a
        threadlocal in some other class and never directly use the
        <code class="classname">ThreadLocal</code> itself (except of course in the
        wrapper class). Also, one should always remember to correctly set and
        unset (where the latter simply involved a call to
        <code class="literal">ThreadLocal.set(null)</code>) the resource local to the
        thread. Unsetting should be done in any case since not unsetting it
        might result in problematic behavior. Spring's ThreadLocal support
        does this for you and should always be considered in favor of using
        ThreadLocals without other proper handling code.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-extensibility"></a>9.11&nbsp;Defining new <code class="interfacename">Advice</code> types</h2></div></div></div><p>Spring AOP is designed to be extensible. While the interception
    implementation strategy is presently used internally, it is possible to
    support arbitrary advice types in addition to the out-of-the-box
    interception around advice, before, throws advice and after returning
    advice.</p><p>The <code class="literal">org.springframework.aop.framework.adapter</code>
    package is an SPI package allowing support for new custom advice types to
    be added without changing the core framework. The only constraint on a
    custom <code class="interfacename">Advice</code> type is that it must
    implement the <code class="interfacename">org.aopalliance.aop.Advice</code>
    tag interface.</p><p>Please refer to the
    <code class="literal">org.springframework.aop.framework.adapter</code> package's
    Javadocs for further information.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-resources"></a>9.12&nbsp;Further resources</h2></div></div></div><p>Please refer to the Spring sample applications for further examples
    of Spring AOP:</p><div class="itemizedlist"><ul type="disc"><li><p>The JPetStore's default configuration illustrates the use of the
        <code class="classname">TransactionProxyFactoryBean</code> for declarative
        transaction management.</p></li><li><p>The <code class="literal">/attributes</code> directory of the JPetStore
        illustrates the use of attribute-driven declarative transaction
        management.</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="testing"></a>10.&nbsp;Testing</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing-introduction"></a>10.1&nbsp;Introduction to Spring Testing</h2></div></div></div><p>Testing is an integral part of enterprise software development. This
    chapter focuses on the value-add of the IoC principle to <a class="link" href="#unit-testing" title="10.2&nbsp;Unit Testing">unit testing</a> and on the benefits of the
    Spring Framework's support for <a class="link" href="#integration-testing" title="10.3&nbsp;Integration Testing">integration testing</a>. <span class="emphasis"><em>(A
    thorough treatment of testing in the enterprise is beyond the scope of
    this reference manual.)</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="unit-testing"></a>10.2&nbsp;Unit Testing</h2></div></div></div><p>Dependency Injection should make your code less dependent on the
    container than it would be with traditional Java EE development. The POJOs
    that make up your application should be testable in JUnit or TestNG tests,
    with objects simply instantiated using the <code class="literal">new</code>
    operator, <span class="emphasis"><em>without Spring or any other container</em></span>. You
    can use <a class="link" href="#mock-objects" title="10.2.1&nbsp;Mock Objects">mock objects</a> (in conjunction
    with other valuable testing techniques) to test your code in isolation. If
    you follow the architecture recommendations for Spring, the resulting
    clean layering and componentization of your codebase will facilitate
    easier unit testing. For example, you can test service layer objects by
    stubbing or mocking DAO or Repository interfaces, without needing to
    access persistent data while running unit tests.</p><p>True unit tests typically run extremely quickly, as there is no
    runtime infrastructure to set up. Emphasizing true unit tests as part of
    your development methodology will boost your productivity. You may not
    need this section of the testing chapter to help you write effective unit
    tests for your IoC-based applications. For certain unit testing scenarios,
    however, the Spring Framework provides the following mock objects and
    testing support classes.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mock-objects"></a>10.2.1&nbsp;Mock Objects</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mock-objects-jndi"></a>10.2.1.1&nbsp;JNDI</h4></div></div></div><p>The <code class="literal">org.springframework.mock.jndi</code> package
        contains an implementation of the JNDI SPI, which you can use to set
        up a simple JNDI environment for test suites or stand-alone
        applications. If, for example, JDBC <code class="classname">DataSource</code>s
        get bound to the same JNDI names in test code as within a Java EE
        container, you can reuse both application code and configuration in
        testing scenarios without modification.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mock-objects-servlet"></a>10.2.1.2&nbsp;Servlet API</h4></div></div></div><p>The <code class="literal">org.springframework.mock.web</code> package
        contains a comprehensive set of Servlet API mock objects, targeted at
        usage with Spring's Web MVC framework, which are useful for testing
        web contexts and controllers. These mock objects are generally more
        convenient to use than dynamic mock objects such as <a class="ulink" href="http://www.easymock.org" target="_top">EasyMock</a> or existing Servlet API
        mock objects such as <a class="ulink" href="http://www.mockobjects.com" target="_top">MockObjects</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mock-objects-portlet"></a>10.2.1.3&nbsp;Portlet API</h4></div></div></div><p>The <code class="literal">org.springframework.mock.web.portlet</code>
        package contains a set of Portlet API mock objects, targeted at usage
        with Spring's Portlet MVC framework.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="unit-testing-support-classes"></a>10.2.2&nbsp;Unit Testing support Classes</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="unit-testing-utilities"></a>10.2.2.1&nbsp;General utilities</h4></div></div></div><p>The <code class="literal">org.springframework.test.util</code> package
        contains <code class="classname">ReflectionTestUtils</code>, which is a
        collection of reflection-based utility methods. Developers use these
        methods in unit and integration testing scenarios in which they need
        to set a non-<code class="literal">public</code> field or invoke a
        non-<code class="literal">public</code> setter method when testing application
        code involving, for example:</p><div class="itemizedlist"><ul type="disc"><li><p>ORM frameworks such as JPA and Hibernate that condone
            <code class="literal">private</code> or <code class="literal">protected</code> field
            access as opposed to <code class="literal">public</code> setter methods for
            properties in a domain entity.</p></li><li><p>Spring's support for annotations such as
            <code class="interfacename">@Autowired</code>,
            <code class="interfacename">@Inject</code>, and
            <code class="interfacename">@Resource,</code> which provides
            dependency injection for <code class="literal">private</code> or
            <code class="literal">protected</code> fields, setter methods, and
            configuration methods.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="unit-testing-spring-mvc"></a>10.2.2.2&nbsp;Spring MVC</h4></div></div></div><p>The <code class="literal">org.springframework.test.web</code> package
        contains <code class="classname">ModelAndViewAssert</code>, which you can use
        in combination with JUnit, TestNG, or any other testing framework for
        unit tests dealing with Spring MVC <code class="classname">ModelAndView</code>
        objects.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Unit testing Spring MVC Controllers"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Unit testing Spring MVC Controllers</th></tr><tr><td align="left" valign="top"><p>To test your Spring MVC <code class="literal">Controller</code>s, use
          <code class="classname">ModelAndViewAssert</code> combined with
          <code class="literal">MockHttpServletRequest</code>,
          <code class="literal">MockHttpSession</code>, and so on from the <a class="link" href="#mock-objects-servlet" title="10.2.1.2&nbsp;Servlet API"><code class="literal">org.springframework.mock.web</code></a>
          package.</p></td></tr></table></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="integration-testing"></a>10.3&nbsp;Integration Testing</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="integration-testing-overview"></a>10.3.1&nbsp;Overview</h3></div></div></div><p>It is important to be able to perform some integration testing
      without requiring deployment to your application server or connecting to
      other enterprise infrastructure. This will enable you to test things
      such as:</p><div class="itemizedlist"><ul type="disc"><li><p>The correct wiring of your Spring IoC container
          contexts.</p></li><li><p>Data access using JDBC or an ORM tool. This would include such
          things as the correctness of SQL statements, Hibernate queries, JPA
          entity mappings, etc.</p></li></ul></div><p>The Spring Framework provides first-class support for integration
      testing in the <code class="filename">spring-test</code>
      module. The name of the actual JAR file might include the release
      version and might also be in the long
      <code class="filename">org.springframework.test</code> form, depending on where
      you get it from (see the <a class="link" href="#dependency-management" title="1.3.1&nbsp;Dependency Management and Naming Conventions">section
      on Dependency Management</a> for an explanation). This library
      includes the <code class="literal">org.springframework.test</code> package, which
      contains valuable classes for integration testing with a Spring
      container. This testing does not rely on an application server or other
      deployment environment. Such tests are slower to run than unit tests but
      much faster than the equivalent Cactus tests or remote tests that rely
      on deployment to an application server.</p><p>In Spring 2.5 and later, unit and integration testing support is
      provided in the form of the annotation-driven <a class="link" href="#testcontext-framework" title="10.3.5&nbsp;Spring TestContext Framework">Spring TestContext Framework</a>. The
      TestContext framework is agnostic of the actual testing framework in
      use, thus allowing instrumentation of tests in various environments
      including JUnit, TestNG, and so on.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning: JUnit 3.8 support is deprecated"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.gif"></td><th align="left">JUnit 3.8 support is deprecated</th></tr><tr><td align="left" valign="top"><p>As of Spring 3.0, the legacy JUnit 3.8 base class hierarchy
        (i.e.,
        <code class="classname">AbstractDependencyInjectionSpringContextTests</code>,
        <code class="classname">AbstractTransactionalDataSourceSpringContextTests</code>,
        etc.) is officially deprecated and will be removed in a later release.
        Any test classes based on this code should be migrated to the <a class="link" href="#testcontext-framework" title="10.3.5&nbsp;Spring TestContext Framework">Spring TestContext
        Framework</a>.</p><p>As of Spring 3.1, the JUnit 3.8 base classes in the Spring
        TestContext Framework (i.e.,
        <code class="classname">AbstractJUnit38SpringContextTests</code> and
        <code class="classname">AbstractTransactionalJUnit38SpringContextTests</code>)
        and <code class="interfacename">@ExpectedException</code> have been
        officially deprecated and will be removed in a later release. Any test
        classes based on this code should be migrated to the JUnit 4 or TestNG
        support provided by the <a class="link" href="#testcontext-framework" title="10.3.5&nbsp;Spring TestContext Framework">Spring
        TestContext Framework</a>. Similarly, any test methods annotated
        with <code class="interfacename">@ExpectedException</code> should be
        modified to use the built-in support for expected exceptions in JUnit
        and TestNG.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="integration-testing-goals"></a>10.3.2&nbsp;Goals of Integration Testing</h3></div></div></div><p>Spring's integration testing support has the following primary
      goals:</p><div class="itemizedlist"><ul type="disc"><li><p>To manage <a class="link" href="#testing-ctx-management" title="10.3.2.1&nbsp;Context management and caching">Spring IoC
          container caching</a> between test execution.</p></li><li><p>To provide <a class="link" href="#testing-fixture-di" title="10.3.2.2&nbsp;Dependency Injection of test fixtures">Dependency
          Injection of test fixture instances</a>.</p></li><li><p>To provide <a class="link" href="#testing-tx" title="10.3.2.3&nbsp;Transaction management">transaction
          management</a> appropriate to integration testing.</p></li><li><p>To supply <a class="link" href="#testing-support-classes" title="10.3.2.4&nbsp;Support classes for integration testing">Spring-specific base
          classes</a> that assist developers in writing integration
          tests.</p></li></ul></div><p>The next few sections describe each goal and provide links to
      implementation and configuration details.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="testing-ctx-management"></a>10.3.2.1&nbsp;Context management and caching</h4></div></div></div><p>The Spring TestContext Framework provides consistent loading of
        Spring <code class="classname">ApplicationContext</code>s and caching of those
        contexts. Support for the caching of loaded contexts is important,
        because startup time can become an issue &#8212; not because of the overhead
        of Spring itself, but because the objects instantiated by the Spring
        container take time to instantiate. For example, a project with 50 to
        100 Hibernate mapping files might take 10 to 20 seconds to load the
        mapping files, and incurring that cost before running every test in
        every test fixture leads to slower overall test runs that could reduce
        productivity.</p><p>Test classes can provide either an array containing the resource
        locations of XML configuration metadata &#8212; typically in the classpath &#8212;
        or an array containing <code class="interfacename">@Configuration</code>
        classes that is used to configure the application. These locations or
        classes are the same as or similar to those specified in
        <code class="literal">web.xml</code> or other deployment configuration
        files.</p><p>By default, once loaded, the configured
        <code class="interfacename">ApplicationContext</code> is reused for each
        test. Thus the setup cost is incurred only once (per test suite), and
        subsequent test execution is much faster. In this context, the term
        <span class="emphasis"><em>test suite</em></span> means all tests run in the same JVM &#8212;
        for example, all tests run from an Ant or Maven build for a given
        project or module. In the unlikely case that a test corrupts the
        application context and requires reloading &#8212; for example, by modifying
        a bean definition or the state of an application object &#8212; the
        TestContext framework can be configured to reload the configuration
        and rebuild the application context before executing the next
        test.</p><p>See context management and caching with the <a class="link" href="#testcontext-ctx-management" title="10.3.5.2&nbsp;Context management">TestContext
        framework</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="testing-fixture-di"></a>10.3.2.2&nbsp;Dependency Injection of test fixtures</h4></div></div></div><p>When the TestContext framework loads your application context,
        it can optionally configure instances of your test classes via
        Dependency Injection. This provides a convenient mechanism for setting
        up test fixtures using preconfigured beans from your application
        context. A strong benefit here is that you can reuse application
        contexts across various testing scenarios (e.g., for configuring
        Spring-managed object graphs, transactional proxies,
        <code class="classname">DataSource</code>s, etc.), thus avoiding the need to
        duplicate complex test fixture set up for individual test
        cases.</p><p>As an example, consider the scenario where we have a class,
        <code class="classname">HibernateTitleRepository</code>, that performs data
        access logic for a <code class="classname">Title</code> domain entity. We want
        to write integration tests that test the following areas:</p><div class="itemizedlist"><ul type="disc"><li><p>The Spring configuration: basically, is everything related
            to the configuration of the
            <code class="classname">HibernateTitleRepository</code> bean correct and
            present?</p></li><li><p>The Hibernate mapping file configuration: is everything
            mapped correctly, and are the correct lazy-loading settings in
            place?</p></li><li><p>The logic of the
            <code class="classname">HibernateTitleRepository</code>: does the
            configured instance of this class perform as anticipated?</p></li></ul></div><p>See dependency injection of test fixtures with the <a class="link" href="#testcontext-fixture-di" title="10.3.5.3&nbsp;Dependency injection of test fixtures">TestContext framework</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="testing-tx"></a>10.3.2.3&nbsp;Transaction management</h4></div></div></div><p>One common issue in tests that access a real database is their
        affect on the state of the persistence store. Even when you're using a
        development database, changes to the state may affect future tests.
        Also, many operations &#8212; such as inserting or modifying persistent data
        &#8212; cannot be performed (or verified) outside a transaction.</p><p>The TestContext framework addresses this issue. By default, the
        framework will create and roll back a transaction for each test. You
        simply write code that can assume the existence of a transaction. If
        you call transactionally proxied objects in your tests, they will
        behave correctly, according to their configured transactional
        semantics. In addition, if test methods delete the contents of
        selected tables while running within a transaction, the transaction
        will roll back by default, and the database will return to its state
        prior to execution of the test. Transactional support is provided to
        your test class via a
        <code class="classname">PlatformTransactionManager</code> bean defined in the
        test's application context.</p><p>If you want a transaction to commit &#8212; unusual, but occasionally
        useful when you want a particular test to populate or modify the
        database &#8212; the TestContext framework can be instructed to cause the
        transaction to commit instead of roll back via the <a class="link" href="#integration-testing-annotations" title="10.3.4&nbsp;Annotations"><code class="interfacename">@TransactionConfiguration</code></a>
        and <a class="link" href="#integration-testing-annotations" title="10.3.4&nbsp;Annotations"><code class="interfacename">@Rollback</code></a>
        annotations.</p><p>See transaction management with the <a class="link" href="#testcontext-tx" title="10.3.5.4&nbsp;Transaction management">TestContext framework</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="testing-support-classes"></a>10.3.2.4&nbsp;Support classes for integration testing</h4></div></div></div><p>The Spring TestContext Framework provides several
        <code class="literal">abstract</code> support classes that simplify the writing
        of integration tests. These base test classes provide well-defined
        hooks into the testing framework as well as convenient instance
        variables and methods, which enable you to access:</p><div class="itemizedlist"><ul type="disc"><li><p>The <code class="literal">ApplicationContext</code>, for performing
            explicit bean lookups or testing the state of the context as a
            whole.</p></li><li><p>A <code class="classname">SimpleJdbcTemplate</code>, for executing
            SQL statements to query the database. Such queries can be used to
            confirm database state both <span class="emphasis"><em>prior to</em></span> and
            <span class="emphasis"><em>after</em></span> execution of database-related
            application code, and Spring ensures that such queries run in the
            scope of the same transaction as the application code. When used
            in conjunction with an ORM tool, be sure to avoid <a class="link" href="#testcontext-tx-false-positives">false
            positives</a>.</p></li></ul></div><p>In addition, you may want to create your own custom,
        application-wide superclass with instance variables and methods
        specific to your project.</p><p>See support classes for the <a class="link" href="#testcontext-support-classes" title="10.3.5.5&nbsp;TestContext support classes">TestContext
        framework</a>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="integration-testing-support-jdbc"></a>10.3.3&nbsp;JDBC Testing Support</h3></div></div></div><p>The <code class="literal">org.springframework.test.jdbc</code> package
      contains <code class="classname">SimpleJdbcTestUtils</code>, which is a
      collection of JDBC related utility functions intended to simplify
      standard database testing scenarios. <span class="emphasis"><em>Note that <a class="link" href="#testcontext-support-classes-junit4" title="JUnit support classes"><code class="classname">AbstractTransactionalJUnit4SpringContextTests</code></a>
      and <a class="link" href="#testcontext-support-classes-testng" title="TestNG support classes"><code class="classname">AbstractTransactionalTestNGSpringContextTests</code></a>
      provide convenience methods which delegate to
      <code class="classname">SimpleJdbcTestUtils</code> internally.</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="integration-testing-annotations"></a>10.3.4&nbsp;Annotations</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="integration-testing-annotations-spring"></a>10.3.4.1&nbsp;Spring Testing Annotations</h4></div></div></div><p>The Spring Framework provides the following set of
        <span class="emphasis"><em>Spring-specific</em></span> annotations that you can use in
        your unit and integration tests in conjunction with the TestContext
        framework. Refer to the respective Javadoc for further information,
        including default attribute values, attribute aliases, and so
        on.</p><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong><code class="interfacename">@ContextConfiguration</code></strong></span></p><p>Defines class-level metadata that is used to determine how
            to load and configure an
            <code class="interfacename">ApplicationContext</code> for test
            classes. Specifically,
            <code class="interfacename">@ContextConfiguration</code> declares
            <span class="emphasis"><em>either</em></span> the application context resource
            <code class="literal">locations</code> <span class="emphasis"><em>or</em></span> the
            <code class="interfacename">@Configuration</code>
            <code class="varname">classes</code> (but not both) to load as well as the
            <code class="interfacename">ContextLoader</code> strategy to use for
            loading the context. Note, however, that you typically do not need
            to explicitly configure the loader since the default loader
            supports either resource <code class="varname">locations</code> or
            configuration <code class="varname">classes</code>.</p><pre class="programlisting">@ContextConfiguration(locations=<span class="hl-string">"example/test-context.xml"</span>, loader=CustomContextLoader.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> XmlApplicationContextTests {
    <span class="hl-comment">// class body...</span>
}</pre><pre class="programlisting">@ContextConfiguration(classes=MyConfig.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConfigClassApplicationContextTests {
    <span class="hl-comment">// class body...</span>
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="interfacename">@ContextConfiguration</code>
              provides support for <span class="emphasis"><em>inheriting</em></span> resource
              locations or configuration classes declared by superclasses by
              default.</p></td></tr></table></div><p>See <a class="link" href="#testcontext-ctx-management" title="10.3.5.2&nbsp;Context management">Context
            management and caching</a> and Javadoc for examples and further
            details.</p></li><li><p><span class="bold"><strong><code class="interfacename">@ActiveProfiles</code></strong></span></p><p>A class-level annotation that is used to declare which
            <span class="emphasis"><em>bean definition profiles</em></span> should be active
            when loading an <code class="interfacename">ApplicationContext</code>
            for test classes.</p><pre class="programlisting">@ContextConfiguration
@ActiveProfiles(<span class="hl-string">"dev"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DeveloperTests {
    <span class="hl-comment">// class body...</span>
}</pre><pre class="programlisting">@ContextConfiguration
@ActiveProfiles({<span class="hl-string">"dev"</span>, <span class="hl-string">"integration"</span>})
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DeveloperIntegrationTests {
    <span class="hl-comment">// class body...</span>
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="interfacename">@ActiveProfiles</code> provides
              support for <span class="emphasis"><em>inheriting</em></span> active bean
              definition profiles declared by superclasses classes by
              default.</p></td></tr></table></div><p>See <a class="link" href="#testcontext-ctx-management-env-profiles" title="Context configuration with environment profiles">Context
            configuration with environment profiles</a> and the Javadoc for
            <code class="interfacename">@ActiveProfiles</code> for examples and
            further details.</p></li><li><p><span class="bold"><strong><code class="interfacename">@DirtiesContext</code></strong></span></p><p>Indicates that the underlying Spring
            <code class="interfacename">ApplicationContext</code> has been
            <span class="emphasis"><em>dirtied</em></span> (i.e., modified or corrupted in some
            manner) during the execution of a test and should be closed,
            regardless of whether the test passed.
            <code class="interfacename">@DirtiesContext</code> is supported in the
            following scenarios:</p><div class="itemizedlist"><ul type="circle"><li><p>After the current test class, when declared on a class
                with class mode set to <code class="literal">AFTER_CLASS</code>, which
                is the default class mode.</p></li><li><p>After each test method in the current test class, when
                declared on a class with class mode set to
                <code class="literal">AFTER_EACH_TEST_METHOD.</code></p></li><li><p>After the current test, when declared on a
                method.</p></li></ul></div><p>Use this annotation if a test has modified the context (for
            example, by replacing a bean definition). Subsequent tests are
            supplied a new context.</p><p>With JUnit 4.5+ or TestNG you can use
            <code class="interfacename">@DirtiesContext</code> as both a
            class-level and method-level annotation within the same test
            class. In such scenarios, the
            <code class="interfacename">ApplicationContext</code> is marked as
            <span class="emphasis"><em>dirty</em></span> after any such annotated method as well
            as after the entire class. If the <code class="classname">ClassMode</code>
            is set to <code class="literal">AFTER_EACH_TEST_METHOD</code>, the context
            is marked dirty after each test method in the class.</p><pre class="programlisting">@DirtiesContext
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContextDirtyingTests {
    <span class="hl-comment">// some tests that result in the Spring container being dirtied</span>
}</pre><pre class="programlisting">@DirtiesContext(classMode = ClassMode.AFTER_EACH_TEST_METHOD)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContextDirtyingTests {
    <span class="hl-comment">// some tests that result in the Spring container being dirtied</span>
}</pre><pre class="programlisting">@DirtiesContext
@Test
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWhichDirtiesAppCtx() {
    <span class="hl-comment">// some logic that results in the Spring container being dirtied</span>
}</pre><p>When an application context is marked
            <span class="emphasis"><em>dirty</em></span>, it is removed from the testing
            framework's cache and closed; thus the underlying Spring container
            is rebuilt for any subsequent test that requires a context with
            the same set of resource locations.</p></li><li><p><span class="bold"><strong><code class="interfacename">@TestExecutionListeners</code></strong></span></p><p>Defines class-level metadata for configuring which
            <code class="interfacename">TestExecutionListener</code>s should be
            registered with the <code class="classname">TestContextManager</code>.
            Typically, <code class="interfacename">@TestExecutionListeners</code>
            is used in conjunction with
            <code class="interfacename">@ContextConfiguration</code>.</p><pre class="programlisting">@ContextConfiguration
@TestExecutionListeners({CustomTestExecutionListener.<span class="hl-keyword">class</span>, AnotherTestExecutionListener.<span class="hl-keyword">class</span>})
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomTestExecutionListenerTests {
    <span class="hl-comment">// class body...</span>
}</pre><p><code class="interfacename">@TestExecutionListeners</code>
            supports <span class="emphasis"><em>inherited</em></span> listeners by default. See
            the Javadoc for an example and further details.</p></li><li><p><span class="bold"><strong><code class="interfacename">@TransactionConfiguration</code></strong></span></p><p>Defines class-level metadata for configuring transactional
            tests. Specifically, the bean name of the
            <code class="interfacename">PlatformTransactionManager</code> that is
            to be used to drive transactions can be explicitly configured if
            the bean name of the desired
            <code class="interfacename">PlatformTransactionManager</code> is not
            "transactionManager". In addition, you can change the
            <code class="literal">defaultRollback</code> flag to
            <code class="literal">false</code>. Typically,
            <code class="interfacename">@TransactionConfiguration</code> is used
            in conjunction with
            <code class="interfacename">@ContextConfiguration</code>.</p><pre class="programlisting">@ContextConfiguration
@TransactionConfiguration(transactionManager=<span class="hl-string">"txMgr"</span>, defaultRollback=false)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomConfiguredTransactionalTests {
    <span class="hl-comment">// class body...</span>
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If the default conventions are sufficient for your test
              configuration, you can avoid using
              <code class="interfacename">@TransactionConfiguration</code>
              altogether. In other words, if your transaction manager bean is
              named "transactionManager" and if you want transactions to roll
              back automatically, there is no need to annotate your test class
              with
              <code class="interfacename">@TransactionConfiguration</code>.</p></td></tr></table></div></li><li><p><span class="bold"><strong><code class="interfacename">@Rollback</code></strong></span></p><p>Indicates whether the transaction for the annotated test
            method should be <span class="emphasis"><em>rolled back</em></span> after the test
            method has completed. If <code class="literal">true</code>, the transaction
            is rolled back; otherwise, the transaction is committed. Use
            <code class="interfacename">@Rollback</code> to override the default
            rollback flag configured at the class level.</p><pre class="programlisting">@Rollback(false)
@Test
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWithoutRollback() {
    <span class="hl-comment">// ...</span>
}</pre></li><li><p><span class="bold"><strong><code class="interfacename">@BeforeTransaction</code></strong></span></p><p>Indicates that the annotated <code class="literal">public void</code>
            method should be executed <span class="emphasis"><em>before</em></span> a
            transaction is started for test methods configured to run within a
            transaction via the <code class="interfacename">@Transactional</code>
            annotation.</p><pre class="programlisting">@BeforeTransaction
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> beforeTransaction() {
    <span class="hl-comment">// logic to be executed before a transaction is started</span>
}</pre></li><li><p><span class="bold"><strong><code class="interfacename">@AfterTransaction</code></strong></span></p><p>Indicates that the annotated <code class="literal">public void</code>
            method should be executed <span class="emphasis"><em>after</em></span> a transaction
            has ended for test methods configured to run within a transaction
            via the <code class="interfacename">@Transactional</code>
            annotation.</p><pre class="programlisting">@AfterTransaction
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterTransaction() {
    <span class="hl-comment">// logic to be executed after a transaction has ended</span>
}</pre></li><li><p><span class="bold"><strong><code class="interfacename">@NotTransactional</code></strong></span></p><p>The presence of this annotation indicates that the annotated
            test method must <span class="emphasis"><em>not</em></span> execute in a
            transactional context.</p><pre class="programlisting">@NotTransactional
@Test
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWithoutTransaction() {
    <span class="hl-comment">// ...</span>
}</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning: @NotTransactional is deprecated"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.gif"></td><th align="left">@NotTransactional is deprecated</th></tr><tr><td align="left" valign="top"><p>As of Spring 3.0,
              <code class="interfacename">@NotTransactional</code> is deprecated
              in favor of moving the <span class="emphasis"><em>non-transactional</em></span>
              test method to a separate (non-transactional) test class or to a
              <code class="interfacename">@BeforeTransaction</code> or
              <code class="interfacename">@AfterTransaction</code> method. As an
              alternative to annotating an entire class with
              <code class="interfacename">@Transactional</code>, consider
              annotating individual methods with
              <code class="interfacename">@Transactional</code>; doing so allows a
              mix of transactional and non-transactional methods in the same
              test class without the need for using
              <code class="interfacename">@NotTransactional</code>.</p></td></tr></table></div></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="integration-testing-annotations-standard"></a>10.3.4.2&nbsp;Standard Annotation Support</h4></div></div></div><p>The following annotations are supported with standard semantics
        for all configurations of the Spring TestContext Framework. Note that
        these annotations are not specific to tests and can be used anywhere
        in the Spring Framework.</p><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong><code class="interfacename">@Autowired</code></strong></span></p></li><li><p><span class="bold"><strong><code class="interfacename">@Qualifier</code></strong></span></p></li><li><p><span class="bold"><strong><code class="interfacename">@Resource</code></strong></span>
            (javax.annotation) <span class="emphasis"><em>if JSR-250 is
            present</em></span></p></li><li><p><span class="bold"><strong><code class="interfacename">@Inject</code></strong></span>
            (javax.inject) <span class="emphasis"><em>if JSR-330 is present</em></span></p></li><li><p><span class="bold"><strong><code class="interfacename">@Named</code></strong></span>
            (javax.inject) <span class="emphasis"><em>if JSR-330 is present</em></span></p></li><li><p><span class="bold"><strong><code class="interfacename">@PersistenceContext</code></strong></span>
            (javax.persistence) <span class="emphasis"><em>if JPA is present</em></span></p></li><li><p><span class="bold"><strong><code class="interfacename">@PersistenceUnit</code></strong></span>
            (javax.persistence) <span class="emphasis"><em>if JPA is present</em></span></p></li><li><p><span class="bold"><strong><code class="interfacename">@Required</code></strong></span></p></li><li><p><span class="bold"><strong><code class="interfacename">@Transactional</code></strong></span></p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="integration-testing-annotations-junit"></a>10.3.4.3&nbsp;Spring JUnit Testing Annotations</h4></div></div></div><p>The following annotations are <span class="emphasis"><em>only</em></span>
        supported when used in conjunction with the <a class="link" href="#testcontext-junit4-runner" title="Spring JUnit Runner">SpringJUnit4ClassRunner</a> or
        the <a class="link" href="#testcontext-support-classes-junit4" title="JUnit support classes">JUnit</a>
        support classes.</p><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong><code class="interfacename">@IfProfileValue</code></strong></span></p><p>Indicates that the annotated test is enabled for a specific
            testing environment. If the configured
            <code class="classname">ProfileValueSource</code> returns a matching
            <code class="literal">value</code> for the provided <code class="literal">name</code>,
            the test is enabled. This annotation can be applied to an entire
            class or to individual methods. Class-level usage overrides
            method-level usage.</p><pre class="programlisting">@IfProfileValue(name=<span class="hl-string">"java.vendor"</span>, value=<span class="hl-string">"Sun Microsystems Inc."</span>)
@Test
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWhichRunsOnlyOnSunJvm() {
    <span class="hl-comment">// some logic that should run only on Java VMs from Sun Microsystems</span>
}</pre><p>Alternatively, you can configure
            <code class="interfacename">@IfProfileValue</code> with a list of
            <code class="literal">values</code> (with <span class="emphasis"><em>OR</em></span> semantics)
            to achieve TestNG-like support for <span class="emphasis"><em>test
            groups</em></span> in a JUnit environment. Consider the following
            example:</p><pre class="programlisting">@IfProfileValue(name=<span class="hl-string">"test-groups"</span>, values={<span class="hl-string">"unit-tests"</span>, <span class="hl-string">"integration-tests"</span>})
@Test
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWhichRunsForUnitOrIntegrationTestGroups() {
    <span class="hl-comment">// some logic that should run only for unit and integration test groups</span>
}</pre></li><li><p><span class="bold"><strong><code class="interfacename">@ProfileValueSourceConfiguration</code></strong></span></p><p>Class-level annotation that specifies what type of
            <code class="literal">ProfileValueSource</code> to use when retrieving
            <span class="emphasis"><em>profile values</em></span> configured through the
            <code class="interfacename">@IfProfileValue</code> annotation. If
            <code class="interfacename">@ProfileValueSourceConfiguration</code> is
            not declared for a test,
            <code class="classname">SystemProfileValueSource</code> is used by
            default.</p><pre class="programlisting">@ProfileValueSourceConfiguration(CustomProfileValueSource.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomProfileValueSourceTests {
    <span class="hl-comment">// class body...</span>
}</pre></li><li><p><span class="bold"><strong><code class="interfacename">@Timed</code></strong></span></p><p>Indicates that the annotated test method must finish
            execution in a specified time period (in milliseconds). If the
            text execution time exceeds the specified time period, the test
            fails.</p><p>The time period includes execution of the test method
            itself, any repetitions of the test (see
            <code class="interfacename">@Repeat</code>), as well as any
            <span class="emphasis"><em>set up</em></span> or <span class="emphasis"><em>tear down</em></span> of
            the test fixture.</p><pre class="programlisting">@Timed(millis=1000)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWithOneSecondTimeout() {
    <span class="hl-comment">// some logic that should not take longer than 1 second to execute</span>
}</pre><p>Spring's <code class="interfacename">@Timed</code> annotation
            has different semantics than JUnit's
            <code class="interfacename">@Test(timeout=...)</code> support.
            Specifically, due to the manner in which JUnit handles test
            execution timeouts (that is, by executing the test method in a
            separate <code class="classname">Thread</code>),
            <code class="interfacename">@Test(timeout=...)</code> applies to
            <span class="emphasis"><em>each iteration</em></span> in the case of repetitions and
            preemptively fails the test if the test takes too long. Spring's
            <code class="interfacename">@Timed</code>, on the other hand, times
            the <span class="emphasis"><em>total</em></span> test execution time (including all
            repetitions) and does not preemptively fail the test but rather
            waits for the test to complete before failing.</p></li><li><p><span class="bold"><strong><code class="interfacename">@Repeat</code></strong></span></p><p>Indicates that the annotated test method must be executed
            repeatedly. The number of times that the test method is to be
            executed is specified in the annotation.</p><p>The scope of execution to be repeated includes execution of
            the test method itself as well as any <span class="emphasis"><em>set up</em></span>
            or <span class="emphasis"><em>tear down</em></span> of the test fixture.</p><pre class="programlisting">@Repeat(10)
@Test
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessRepeatedly() {
    <span class="hl-comment">// ...</span>
}</pre></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcontext-framework"></a>10.3.5&nbsp;Spring TestContext Framework</h3></div></div></div><p>The <span class="emphasis"><em>Spring <code class="classname">TestContext</code>
      Framework</em></span> (located in the
      <code class="literal">org.springframework.test.context</code> package) provides
      generic, annotation-driven unit and integration testing support that is
      agnostic of the testing framework in use, whether JUnit or TestNG. The
      TestContext framework also places a great deal of importance on
      <span class="emphasis"><em>convention over configuration</em></span> with reasonable
      defaults that can be overridden through annotation-based
      configuration.</p><p>In addition to generic testing infrastructure, the TestContext
      framework provides explicit support for JUnit and TestNG in the form of
      <code class="literal">abstract</code> support classes. For JUnit, Spring also
      provides a custom JUnit <code class="interfacename">Runner</code> that
      allows one to write so called <span class="emphasis"><em>POJO test classes</em></span>.
      POJO test classes are not required to extend a particular class
      hierarchy.</p><p>The following section provides an overview of the internals of the
      TestContext framework. If you are only interested in using the framework
      and not necessarily interested in extending it with your own custom
      listeners or custom loaders, feel free to go directly to the
      configuration (<a class="link" href="#testcontext-ctx-management" title="10.3.5.2&nbsp;Context management">context
      management</a>, <a class="link" href="#testcontext-fixture-di" title="10.3.5.3&nbsp;Dependency injection of test fixtures">dependency
      injection</a>, <a class="link" href="#testcontext-tx" title="10.3.5.4&nbsp;Transaction management">transaction
      management</a>), <a class="link" href="#testcontext-support-classes" title="10.3.5.5&nbsp;TestContext support classes">support
      classes</a>, and <a class="link" href="#integration-testing-annotations" title="10.3.4&nbsp;Annotations">annotation support</a>
      sections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-key-abstractions"></a>10.3.5.1&nbsp;Key abstractions</h4></div></div></div><p>The core of the framework consists of the
        <code class="classname">TestContext</code> and
        <code class="classname">TestContextManager</code> classes and the
        <code class="interfacename">TestExecutionListener</code>,
        <code class="interfacename">ContextLoader</code>, and
        <code class="interfacename">SmartContextLoader</code> interfaces. A
        <code class="classname">TestContextManager</code> is created on a per-test
        basis (e.g., for the execution of a single test method in JUnit). The
        <code class="classname">TestContextManager</code> in turn manages a
        <code class="classname">TestContext</code> that holds the context of the
        current test. The <code class="classname">TestContextManager</code> also
        updates the state of the <code class="classname">TestContext</code> as the
        test progresses and delegates to
        <code class="interfacename">TestExecutionListener</code>s, which
        instrument the actual test execution by providing dependency
        injection, managing transactions, and so on. A
        <code class="interfacename">ContextLoader</code> (or
        <code class="interfacename">SmartContextLoader</code>) is responsible for
        loading an <code class="interfacename">ApplicationContext</code> for a
        given test class. Consult the Javadoc and the Spring test suite for
        further information and examples of various implementations.</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">TestContext</code>: Encapsulates the context
            in which a test is executed, agnostic of the actual testing
            framework in use, and provides context management and caching
            support for the test instance for which it is responsible. The
            <code class="classname">TestContext</code> also delegates to a
            <code class="interfacename">ContextLoader</code> (or
            <code class="interfacename">SmartContextLoader</code>) to load an
            <code class="interfacename">ApplicationContext</code> if
            requested.</p></li><li><p><code class="classname">TestContextManager</code>: The main entry
            point into the <span class="emphasis"><em>Spring TestContext Framework</em></span>,
            which manages a single <code class="classname">TestContext</code> and
            signals events to all registered
            <code class="interfacename">TestExecutionListener</code>s at
            well-defined test execution points:</p><div class="itemizedlist"><ul type="circle"><li><p>prior to any <span class="emphasis"><em>before class methods</em></span>
                of a particular testing framework</p></li><li><p>test instance preparation</p></li><li><p>prior to any <span class="emphasis"><em>before methods</em></span> of a
                particular testing framework</p></li><li><p>after any <span class="emphasis"><em>after methods</em></span> of a
                particular testing framework</p></li><li><p>after any <span class="emphasis"><em>after class methods</em></span> of a
                particular testing framework</p></li></ul></div></li><li><p><code class="interfacename">TestExecutionListener</code>:
            Defines a <span class="emphasis"><em>listener</em></span> API for reacting to test
            execution events published by the
            <code class="classname">TestContextManager</code> with which the listener
            is registered.</p><p>Spring provides three
            <code class="interfacename">TestExecutionListener</code>
            implementations that are configured by default:
            <code class="classname">DependencyInjectionTestExecutionListener</code>,
            <code class="classname">DirtiesContextTestExecutionListener</code>, and
            <code class="classname">TransactionalTestExecutionListener</code>.
            Respectively, they support dependency injection of the test
            instance, handling of the
            <code class="interfacename">@DirtiesContext</code> annotation, and
            transactional test execution with default rollback
            semantics.</p></li><li><p><code class="interfacename">ContextLoader</code>: Strategy
            interface introduced in Spring 2.5 for loading an
            <code class="interfacename">ApplicationContext</code> for an
            integration test managed by the Spring TestContext
            Framework.</p><p>As of Spring 3.1, implement
            <code class="interfacename">SmartContextLoader</code> instead of this
            interface in order to provide support for configuration classes
            and active bean definition profiles.</p></li><li><p><code class="interfacename">SmartContextLoader</code>: Extension
            of the <code class="interfacename">ContextLoader</code> interface
            introduced in Spring 3.1.</p><p>The <code class="interfacename">SmartContextLoader</code> SPI
            supersedes the <code class="interfacename">ContextLoader</code> SPI
            that was introduced in Spring 2.5. Specifically, a
            <code class="interfacename">SmartContextLoader</code> can choose to
            process either resource <code class="varname">locations</code> or
            configuration <code class="varname">classes</code>. Furthermore, a
            <code class="interfacename">SmartContextLoader</code> can set active
            bean definition profiles in the context that it loads.</p><p>Spring provides the following out-of-the-box
            implementations:</p><div class="itemizedlist"><ul type="circle"><li><p><code class="classname">DelegatingSmartContextLoader</code>: the
                default loader which delegates internally to an
                <code class="classname">AnnotationConfigContextLoader</code> or a
                <code class="classname">GenericXmlContextLoader</code> depending
                either on the configuration declared for the test class or on
                the presence of default locations or default configuration
                classes.</p></li><li><p><code class="classname">AnnotationConfigContextLoader</code>:
                loads an application context from
                <code class="interfacename">@Configuration</code> classes.</p></li><li><p><code class="classname">GenericXmlContextLoader</code>: loads an
                application context from XML resource locations.</p></li><li><p><code class="classname">GenericPropertiesContextLoader</code>:
                loads an application context from Java Properties
                files.</p></li></ul></div></li></ul></div><p>The following sections explain how to configure the
        <code class="classname">TestContext</code> framework through annotations and
        provide working examples of how to write unit and integration tests
        with the framework.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-ctx-management"></a>10.3.5.2&nbsp;Context management</h4></div></div></div><p>Each <code class="classname">TestContext</code> provides context
        management and caching support for the test instance it is responsible
        for. Test instances do not automatically receive access to the
        configured <code class="classname">ApplicationContext</code>. However, if a
        test class implements the
        <code class="interfacename">ApplicationContextAware</code> interface, a
        reference to the <code class="classname">ApplicationContext</code> is supplied
        to the test instance. Note that
        <code class="classname">AbstractJUnit4SpringContextTests</code> and
        <code class="classname">AbstractTestNGSpringContextTests</code> implement
        <code class="interfacename">ApplicationContextAware</code> and therefore
        provide access to the <code class="classname">ApplicationContext</code>
        out-of-the-box.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: @Autowired ApplicationContext"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">@Autowired ApplicationContext</th></tr><tr><td align="left" valign="top"><p>As an alternative to implementing the
          <code class="interfacename">ApplicationContextAware</code> interface,
          you can inject the application context for your test class through
          the <code class="interfacename">@Autowired</code> annotation on either a
          field or setter method. For example:</p><pre class="programlisting">@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
@ContextConfiguration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {

    @Autowired
    <span class="hl-keyword">private</span> ApplicationContext applicationContext;

    <span class="hl-comment">// class body...</span>
}</pre><p>Dependency injection via
          <code class="interfacename">@Autowired</code> is provided by the
          <code class="classname">DependencyInjectionTestExecutionListener</code>
          which is configured by default (see <a class="xref" href="#testcontext-fixture-di" title="10.3.5.3&nbsp;Dependency injection of test fixtures">Section&nbsp;10.3.5.3, &#8220;Dependency injection of test fixtures&#8221;</a>).</p></td></tr></table></div><p>Test classes that use the TestContext framework do not need to
        extend any particular class or implement a specific interface to
        configure their application context. Instead, configuration is
        achieved simply by declaring the
        <code class="interfacename">@ContextConfiguration</code> annotation at the
        class level. If your test class does not explicitly declare
        application context resource <code class="literal">locations</code> or
        configuration <code class="varname">classes</code>, the configured
        <code class="interfacename">ContextLoader</code> determines how to load a
        context from a default location or default configuration
        classes.</p><p>The following sections explain how to configure an
        <code class="interfacename">ApplicationContext</code> via XML
        configuration files or <code class="interfacename">@Configuration</code>
        classes using Spring's
        <code class="interfacename">@ContextConfiguration</code>
        annotation.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="testcontext-ctx-management-xml"></a>Context configuration with XML resources</h5></div></div></div><p>To load an <code class="interfacename">ApplicationContext</code>
          for your tests using XML configuration files, annotate your test
          class with <code class="interfacename">@ContextConfiguration</code> and
          configure the <code class="literal">locations</code> attribute with an array
          that contains the resource locations of XML configuration metadata.
          A plain path &#8212; for example <code class="literal">"context.xml"</code> &#8212; will
          be treated as a classpath resource that is relative to the package
          in which the test class is defined. A path starting with a slash is
          treated as an absolute classpath location, for example
          <code class="literal">"/org/example/config.xml"</code>. A path which
          represents a resource URL (i.e., a path prefixed with
          <code class="literal">classpath:</code>, <code class="literal">file:</code>,
          <code class="literal">http:</code>, etc.) will be used <span class="emphasis"><em>as
          is</em></span>. Alternatively, you can implement and configure your
          own custom <code class="interfacename">ContextLoader</code> or
          <code class="interfacename">SmartContextLoader</code> for advanced use
          cases.</p><pre class="programlisting">@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
<span class="hl-comment">// ApplicationContext will be loaded from "/app-config.xml" and</span>
<span class="hl-comment">// "/test-config.xml" in the root of the classpath</span>
@ContextConfiguration(locations={<span class="hl-string">"/app-config.xml"</span>, <span class="hl-string">"/test-config.xml"</span>})
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre><p><code class="interfacename">@ContextConfiguration</code> supports
          an alias for the <code class="literal">locations</code> attribute through the
          standard Java <code class="literal">value</code> attribute. Thus, if you do
          not need to configure a custom
          <code class="interfacename">ContextLoader</code>, you can omit the
          declaration of the <code class="literal">locations</code> attribute name and
          declare the resource locations by using the shorthand format
          demonstrated in the following example.</p><pre class="programlisting">@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
@ContextConfiguration({<span class="hl-string">"/app-config.xml"</span>, <span class="hl-string">"/test-config.xml"</span>})
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre><p>If you omit both the <code class="varname">locations</code> and
          <code class="varname">value</code> attributes from the
          <code class="interfacename">@ContextConfiguration</code> annotation, the
          TestContext framework will attempt to detect a default XML resource
          location. Specifically,
          <code class="classname">GenericXmlContextLoader</code> detects a default
          location based on the name of the test class. If your class is named
          <code class="literal">com.example.MyTest</code>,
          <code class="classname">GenericXmlContextLoader</code> loads your
          application context from
          <code class="literal">"classpath:/com/example/MyTest-context.xml"</code>.</p><pre class="programlisting"><span class="hl-keyword">package</span> com.example;

@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
<span class="hl-comment">// ApplicationContext will be loaded from "classpath:/com/example/MyTest-context.xml"</span>
@ContextConfiguration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="testcontext-ctx-management-javaconfig"></a>Context configuration with @Configuration classes</h5></div></div></div><p>To load an <code class="interfacename">ApplicationContext</code>
          for your tests using <code class="interfacename">@Configuration</code>
          classes (see <a class="xref" href="#beans-java" title="4.12&nbsp;Java-based container configuration">Section&nbsp;4.12, &#8220;Java-based container configuration&#8221;</a>), annotate your test
          class with <code class="interfacename">@ContextConfiguration</code> and
          configure the <code class="literal">classes</code> attribute with an array
          that contains references to configuration classes. Alternatively,
          you can implement and configure your own custom
          <code class="interfacename">ContextLoader</code> or
          <code class="interfacename">SmartContextLoader</code> for advanced use
          cases.</p><pre class="programlisting">@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
<span class="hl-comment">// ApplicationContext will be loaded from AppConfig and TestConfig</span>
@ContextConfiguration(classes={AppConfig.<span class="hl-keyword">class</span>, TestConfig.<span class="hl-keyword">class</span>})
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre><p>If you omit the <code class="varname">classes</code> attribute from the
          <code class="interfacename">@ContextConfiguration</code> annotation, the
          TestContext framework will attempt to detect the presence of default
          configuration classes. Specifically,
          <code class="classname">AnnotationConfigContextLoader</code> will detect all
          static inner classes of the annotated test class that meet the
          requirements for configuration class implementations as specified in
          the Javadoc for <code class="interfacename">@Configuration</code>. In
          the following example, the <code class="classname">OrderServiceTest</code>
          class declares a static inner configuration class named
          <code class="classname">Config</code> that will be automatically used to
          load the <code class="interfacename">ApplicationContext</code> for the
          test class. Note that the name of the configuration class is
          arbitrary. In addition, a test class can contain more than one
          static inner configuration class if desired.</p><pre class="programlisting"><span class="hl-keyword">package</span> com.example;
 
@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
<span class="hl-comment">// ApplicationContext will be loaded from the static inner Config class</span>
@ContextConfiguration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> OrderServiceTest {
 
    @Configuration
    <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> Config {
 
        <span class="hl-comment">// this bean will be injected into the OrderServiceTest class</span>
        @Bean
        <span class="hl-keyword">public</span> OrderService orderService() {
            OrderService orderService = <span class="hl-keyword">new</span> OrderServiceImpl();
            <span class="hl-comment">// set properties, etc.</span>
            <span class="hl-keyword">return</span> orderService;
        }
    }
 
    @Autowired
    <span class="hl-keyword">private</span> OrderService orderService;
 
    @Test
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testOrderService() {
        <span class="hl-comment">// test the orderService</span>
    }

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="testcontext-ctx-management-mixed-config"></a>Mixing XML resources and @Configuration classes</h5></div></div></div><p>It may sometimes be desirable to mix XML resources and
          <code class="interfacename">@Configuration</code> classes to configure
          an <code class="interfacename">ApplicationContext</code> for your tests.
          For example, if you use XML configuration in production, you may
          decide that you want to use
          <code class="interfacename">@Configuration</code> classes to configure
          specific Spring-managed components for your tests, or vice versa. As
          mentioned in <a class="xref" href="#integration-testing-annotations-spring" title="10.3.4.1&nbsp;Spring Testing Annotations">Section&nbsp;10.3.4.1, &#8220;Spring Testing Annotations&#8221;</a> the TestContext
          framework does not allow you to declare <span class="emphasis"><em>both</em></span>
          via <code class="interfacename">@ContextConfiguration</code>, but this
          does not mean that you cannot use both.</p><p>If you want to use XML <span class="bold"><strong>and</strong></span>
          <code class="interfacename">@Configuration</code> classes to configure
          your tests, you will have to pick one as the <span class="emphasis"><em>entry
          point</em></span>, and that one will have to include or import the
          other. For example, in XML you can include
          <code class="interfacename">@Configuration</code> classes via component
          scanning or define them as normal Spring beans in XML; whereas, in a
          <code class="interfacename">@Configuration</code> class you can use
          <code class="interfacename">@ImportResource</code> to import XML
          configuration files. Note that this behavior is semantically
          equivalent to how you configure your application in production: in
          production configuration you will define either a set of XML
          resource locations or a set of
          <code class="interfacename">@Configuration</code> classes that your
          production <code class="interfacename">ApplicationContext</code> will be
          loaded from, but you still have the freedom to include or import the
          other type of configuration.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="testcontext-ctx-management-inheritance"></a>Context configuration inheritance</h5></div></div></div><p><code class="interfacename">@ContextConfiguration</code> supports
          a boolean <code class="literal">inheritLocations</code> attribute that denotes
          whether resource locations or configuration classes declared by
          superclasses should be <span class="emphasis"><em>inherited</em></span>. The default
          value is <code class="literal">true</code>. This means that an annotated class
          inherits the resource locations or configuration classes declared by
          any annotated superclasses. Specifically, the resource locations or
          configuration classes for an annotated test class are appended to
          the list of resource locations or configuration classes declared by
          annotated superclasses. Thus, subclasses have the option of
          <span class="emphasis"><em>extending</em></span> the list of resource locations or
          configuration classes.</p><p>If <code class="interfacename">@ContextConfiguration</code>'s
          <code class="literal">inheritLocations</code> attribute is set to
          <code class="literal">false</code>, the resource locations or configuration
          classes for the annotated class <span class="emphasis"><em>shadow</em></span> and
          effectively replace any resource locations or configuration classes
          defined by superclasses.</p><p>In the following example that uses XML resource locations, the
          <code class="interfacename">ApplicationContext</code> for
          <code class="classname">ExtendedTest</code> will be loaded from
          <span class="emphasis"><em>"base-config.xml"</em></span> <span class="bold"><strong>and</strong></span>
          <span class="emphasis"><em>"extended-config.xml"</em></span>, in that order. Beans
          defined in <span class="emphasis"><em>"extended-config.xml"</em></span> may therefore
          <span class="emphasis"><em>override</em></span> (i.e., replace) those defined in
          <span class="emphasis"><em>"base-config.xml"</em></span>.</p><pre class="programlisting">@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
<span class="hl-comment">// ApplicationContext will be loaded from "/base-config.xml" in the root of the classpath</span>
@ContextConfiguration(<span class="hl-string">"/base-config.xml"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}

<span class="hl-comment">// ApplicationContext will be loaded from "/base-config.xml" and "/extended-config.xml"</span>
<span class="hl-comment">// in the root of the classpath</span>
@ContextConfiguration(<span class="hl-string">"/extended-config.xml"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTest <span class="hl-keyword">extends</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}</pre><p>Similarly, in the following example that uses configuration
          classes, the <code class="interfacename">ApplicationContext</code> for
          <code class="classname">ExtendedTest</code> will be loaded from the
          <code class="classname">BaseConfig</code> <span class="bold"><strong>and</strong></span> <code class="classname">ExtendedConfig</code>
          configuration classes, in that order. Beans defined in
          <code class="classname">ExtendedConfig</code> may therefore override (i.e.,
          replace) those defined in <code class="classname">BaseConfig</code>.</p><pre class="programlisting">@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
<span class="hl-comment">// ApplicationContext will be loaded from BaseConfig</span>
@ContextConfiguration(classes=BaseConfig.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}

<span class="hl-comment">// ApplicationContext will be loaded from BaseConfig and ExtendedConfig</span>
@ContextConfiguration(classes=ExtendedConfig.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTest <span class="hl-keyword">extends</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="testcontext-ctx-management-env-profiles"></a>Context configuration with environment profiles</h5></div></div></div><p>Spring 3.1 introduces first-class support in the framework for
          the notion of environments and profiles (a.k.a., <span class="emphasis"><em>bean
          definition profiles</em></span>), and integration tests can now be
          configured to activate particular bean definition profiles for
          various testing scenarios. This is achieved by annotating a test
          class with the new <code class="interfacename">@ActiveProfiles</code>
          annotation and supplying a list of profiles that should be activated
          when loading the <code class="interfacename">ApplicationContext</code>
          for the test.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="interfacename">@ActiveProfiles</code> may be used
            with any implementation of the new
            <code class="interfacename">SmartContextLoader</code> SPI, but
            <code class="interfacename">@ActiveProfiles</code> is not supported
            with implementations of the older
            <code class="interfacename">ContextLoader</code> SPI.</p></td></tr></table></div><p>Let's take a look at some examples with XML configuration and
          <code class="interfacename">@Configuration</code> classes.</p><pre class="programlisting">&lt;<span class="hl-comment">!-- app-config.xml --</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:jdbc</span>=<span class="hl-value">"http://www.springframework.org/schema/jdbc"</span>
    <span class="hl-attribute">xmlns:jee</span>=<span class="hl-value">"http://www.springframework.org/schema/jee"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"..."</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transferService"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"com.bank.service.internal.DefaultTransferService"</span>&gt;
        &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountRepository"</span>/&gt;
        &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"feePolicy"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountRepository"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"com.bank.repository.internal.JdbcAccountRepository"</span>&gt;
        &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"feePolicy"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"com.bank.service.internal.ZeroFeePolicy"</span>/&gt;

    &lt;<span class="hl-tag">beans</span> <span class="hl-attribute">profile</span>=<span class="hl-value">"dev"</span>&gt;
        &lt;<span class="hl-tag">jdbc:embedded-database</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span>&gt;
            &lt;<span class="hl-tag">jdbc:script</span>
                <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:com/bank/config/sql/schema.sql"</span>/&gt;
            &lt;<span class="hl-tag">jdbc:script</span>
                <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:com/bank/config/sql/test-data.sql"</span>/&gt;
        &lt;<span class="hl-tag">/jdbc:embedded-database</span>&gt;
    &lt;<span class="hl-tag">/beans</span>&gt;

    &lt;<span class="hl-tag">beans</span> <span class="hl-attribute">profile</span>=<span class="hl-value">"production"</span>&gt;
        &lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span>
            <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"java:comp/env/jdbc/datasource"</span>/&gt;
    &lt;<span class="hl-tag">/beans</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
<span class="hl-comment">// ApplicationContext will be loaded from "classpath:/app-config.xml"</span>
@ContextConfiguration(<span class="hl-string">"/app-config.xml"</span>)
@ActiveProfiles(<span class="hl-string">"dev"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransferServiceTest {

   @Autowired
   <span class="hl-keyword">private</span> TransferService transferService;

   @Test
   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testTransferService() {
       <span class="hl-comment">// test the transferService</span>
   }
}</pre><p>When <code class="classname">TransferServiceTest</code> is run, its
          <code class="interfacename">ApplicationContext</code> will be loaded
          from the <code class="filename">app-config.xml</code> configuration file in
          the root of the classpath. If you inspect
          <code class="filename">app-config.xml</code> you'll notice that the
          <code class="varname">accountRepository</code> bean has a dependency on a
          <code class="varname">dataSource</code> bean; however,
          <code class="varname">dataSource</code> is not defined as a top-level bean.
          Instead, <code class="varname">dataSource</code> is defined twice: once in the
          <span class="emphasis"><em>production</em></span> profile and once in the
          <span class="emphasis"><em>dev</em></span> profile.</p><p>By annotating <code class="classname">TransferServiceTest</code> with
          <code class="interfacename">@ActiveProfiles("dev")</code> we instruct
          the Spring TestContext Framework to load the
          <code class="interfacename">ApplicationContext</code> with the active
          profiles set to <code class="literal">{"dev"}</code>. As a result, an embedded
          database will be created, and the
          <code class="varname">accountRepository</code> bean will be wired with a
          reference to the development
          <code class="interfacename">DataSource</code>. And that's likely what we
          want in an integration test.</p><p>The following code listings demonstrate how to implement the
          same configuration and integration test but using
          <code class="interfacename">@Configuration</code> classes instead of
          XML.</p><pre class="programlisting">@Configuration
@Profile(<span class="hl-string">"dev"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> StandaloneDataConfig {

    @Bean
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.HSQL)
            .addScript(<span class="hl-string">"classpath:com/bank/config/sql/schema.sql"</span>)
            .addScript(<span class="hl-string">"classpath:com/bank/config/sql/test-data.sql"</span>)
            .build();
    }
}</pre><pre class="programlisting">@Configuration
@Profile(<span class="hl-string">"production"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JndiDataConfig {

    @Bean
    <span class="hl-keyword">public</span> DataSource dataSource() <span class="hl-keyword">throws</span> Exception {
        Context ctx = <span class="hl-keyword">new</span> InitialContext();
        <span class="hl-keyword">return</span> (DataSource) ctx.lookup(<span class="hl-string">"java:comp/env/jdbc/datasource"</span>);
    }
}</pre><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransferServiceConfig {

    @Autowired DataSource dataSource;

    @Bean
    <span class="hl-keyword">public</span> TransferService transferService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> DefaultTransferService(accountRepository(),
            feePolicy());
    }

    @Bean
    <span class="hl-keyword">public</span> AccountRepository accountRepository() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> JdbcAccountRepository(dataSource);
    }

    @Bean
    <span class="hl-keyword">public</span> FeePolicy feePolicy() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ZeroFeePolicy();
    }

}</pre><pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
@ContextConfiguration(
   classes={
       TransferServiceConfig.<span class="hl-keyword">class</span>,
       StandaloneDataConfig.<span class="hl-keyword">class</span>,
       JndiDataConfig.<span class="hl-keyword">class</span>})
@ActiveProfiles(<span class="hl-string">"dev"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransferServiceTest {

   @Autowired
   <span class="hl-keyword">private</span> TransferService transferService;

   @Test
   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testTransferService() {
       <span class="hl-comment">// test the transferService</span>
   }
}</pre><p>In this variation, we have split the XML configuration into
          three independent <code class="interfacename">@Configuration</code>
          classes:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">TransferServiceConfig</code>: acquires a
              <code class="varname">dataSource</code> via dependency injection using
              <code class="interfacename">@Autowired</code></p></li><li><p><code class="classname">StandaloneDataConfig</code>: defines a
              <code class="varname">dataSource</code> for an embedded database suitable
              for developer tests</p></li><li><p><code class="classname">JndiDataConfig</code>: defines a
              <code class="varname">dataSource</code> that is retrieved from JNDI in a
              production environment</p></li></ul></div><p>As with the XML-based configuration example, we still annotate
          <code class="classname">TransferServiceTest</code> with
          <code class="interfacename">@ActiveProfiles("dev")</code>, but this time
          we specify all three configuration classes via the
          <code class="interfacename">@ContextConfiguration </code>annotation. The
          body of the test class itself remains completely unchanged.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="testcontext-ctx-management-caching"></a>Context caching</h5></div></div></div><p>Once the TestContext framework loads an
          <code class="interfacename">ApplicationContext</code> for a test, that
          context will be cached and reused for <span class="bold"><strong>all</strong></span> subsequent tests that declare the same
          unique context configuration within the same test suite. To
          understand how caching works, it is important to understand what is
          meant by <span class="emphasis"><em>unique</em></span> and <span class="emphasis"><em>test
          suite</em></span>.</p><p>An <code class="interfacename">ApplicationContext</code> can be
          <span class="emphasis"><em>uniquely</em></span> identified by the combination of
          configuration parameters that are used to load it. Consequently, the
          unique combination of configuration parameters are used to generate
          a <span class="emphasis"><em>key</em></span> under which the context is cached. The
          TestContext framework uses the following configuration parameters to
          build the context cache key:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="varname">locations</code> <span class="emphasis"><em>(from
              @ContextConfiguration)</em></span></p></li><li><p><code class="varname">classes</code> <span class="emphasis"><em>(from
              @ContextConfiguration)</em></span></p></li><li><p><code class="varname">contextLoader</code> <span class="emphasis"><em>(from
              @ContextConfiguration)</em></span></p></li><li><p><code class="varname">activeProfiles</code> <span class="emphasis"><em>(from
              @ActiveProfiles)</em></span></p></li></ul></div><p>For example, if <code class="classname">TestClassA</code> specifies
          <code class="literal">{"app-config.xml", "test-config.xml"}</code> for the
          <code class="varname">locations</code> (or <code class="varname">value</code>) attribute
          of <code class="interfacename">@ContextConfiguration</code>, the
          TestContext framework will load the corresponding
          <code class="interfacename">ApplicationContext</code> and store it in a
          <code class="varname">static</code> context cache under a key that is based
          solely on those locations. So if <code class="classname">TestClassB</code>
          also defines <code class="literal">{"app-config.xml",
          "test-config.xml"}</code> for its locations (either explicitly or
          implicitly through inheritance) and does not define a different
          <code class="interfacename">ContextLoader</code> or different active
          profiles, then the same
          <code class="interfacename">ApplicationContext</code> will be shared by
          both test classes. This means that the setup cost for loading an
          application context is incurred only once (per test suite), and
          subsequent test execution is much faster.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Test suites and forked processes"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Test suites and forked processes</th></tr><tr><td align="left" valign="top"><p>The Spring TestContext framework stores application contexts
            in a <span class="emphasis"><em>static</em></span> cache. This means that the
            context is literally stored in a <code class="varname">static</code>
            variable. In other words, if tests execute in separate processes
            the static cache will be cleared between each test execution, and
            this will effectively disable the caching mechanism.</p><p>To benefit from the caching mechanism, all tests must run
            within the same process or test suite. This can be achieved by
            executing all tests as a group within an IDE. Similarly, when
            executing tests with a build framework such as Ant or Maven it is
            important to make sure that the build framework does not
            <span class="emphasis"><em>fork</em></span> between tests. For example, if the
            <a class="ulink" href="http://maven.apache.org/plugins/maven-surefire-plugin/test-mojo.html#forkMode" target="_top">forkMode</a>
            for the Maven Surefire plug-in is set to <code class="literal">always</code>
            or <code class="literal">pertest</code>, the TestContext framework will not
            be able to cache application contexts between test classes and the
            build process will run significantly slower as a result.</p></td></tr></table></div><p>In the unlikely case that a test corrupts the application
          context and requires reloading &#8212; for example, by modifying a bean
          definition or the state of an application object &#8212; you can annotate
          your test class or test method with
          <code class="interfacename">@DirtiesContext</code> (see the discussion
          of <code class="interfacename">@DirtiesContext</code> in <a class="xref" href="#integration-testing-annotations-spring" title="10.3.4.1&nbsp;Spring Testing Annotations">Section&nbsp;10.3.4.1, &#8220;Spring Testing Annotations&#8221;</a>). This instructs
          Spring to remove the context from the cache and rebuild the
          application context before executing the next test. Note that
          support for the <code class="interfacename">@DirtiesContext</code>
          annotation is provided by the
          <code class="classname">DirtiesContextTestExecutionListener</code> which is
          enabled by default.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-fixture-di"></a>10.3.5.3&nbsp;Dependency injection of test fixtures</h4></div></div></div><p>When you use the
        <code class="classname">DependencyInjectionTestExecutionListener</code> &#8212;
        which is configured by default &#8212; the dependencies of your test
        instances are <span class="emphasis"><em>injected</em></span> from beans in the
        application context that you configured with
        <code class="interfacename">@ContextConfiguration</code>. You may use
        setter injection, field injection, or both, depending on which
        annotations you choose and whether you place them on setter methods or
        fields. For consistency with the annotation support introduced in
        Spring 2.5 and 3.0, you can use Spring's
        <code class="interfacename">@Autowired</code> annotation or the
        <code class="interfacename">@Inject</code> annotation from JSR 300.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The TestContext framework does not instrument the manner in
          which a test instance is instantiated. Thus the use of
          <code class="interfacename">@Autowired</code> or
          <code class="interfacename">@Inject</code> for constructors has no
          effect for test classes.</p></td></tr></table></div><p>Because <code class="interfacename">@Autowired</code> is used to
        perform <a class="link" href="#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators"><span class="emphasis"><em>autowiring by
        type</em></span></a>, if you have multiple bean definitions of the
        same type, you cannot rely on this approach for those particular
        beans. In that case, you can use
        <code class="interfacename">@Autowired</code> in conjunction with
        <code class="interfacename">@Qualifier</code>. As of Spring 3.0 you may
        also choose to use <code class="interfacename">@Inject</code> in
        conjunction with <code class="interfacename">@Named</code>. Alternatively,
        if your test class has access to its
        <code class="classname">ApplicationContext</code>, you can perform an explicit
        lookup by using (for example) a call to
        <code class="methodname">applicationContext.getBean("titleRepository")</code>.</p><p>If you do not want dependency injection applied to your test
        instances, simply do not annotate fields or setter methods with
        <code class="interfacename">@Autowired</code> or
        <code class="interfacename">@Inject</code>. Alternatively, you can disable
        dependency injection altogether by explicitly configuring your class
        with <code class="interfacename">@TestExecutionListeners</code> and
        omitting
        <code class="literal">DependencyInjectionTestExecutionListener.class</code> from
        the list of listeners.</p><p>Consider the scenario of testing a
        <code class="classname">HibernateTitleRepository</code> class, as outlined in
        the <a class="link" href="#integration-testing-goals" title="10.3.2&nbsp;Goals of Integration Testing">Goals</a> section.
        The next two code listings demonstrate the use of
        <code class="interfacename">@Autowired</code> on fields and setter
        methods. The application context configuration is presented after all
        sample code listings.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The dependency injection behavior in the following code
          listings is not specific to JUnit. The same DI techniques can be
          used in conjunction with any testing framework.</p><p>The following examples make calls to static assertion methods
          such as <code class="literal">assertNotNull()</code> but without prepending
          the call with <code class="literal">Assert</code>. In such cases, assume that
          the method was properly imported through an <code class="literal">import
          static</code> declaration that is not shown in the
          example.</p></td></tr></table></div><p>The first code listing shows a JUnit-based implementation of the
        test class that uses <code class="interfacename">@Autowired</code> for
        field injection.</p><pre class="programlisting">@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
<span class="hl-comment">// specifies the Spring configuration to load for this test fixture</span>
@ContextConfiguration(<span class="hl-string">"repository-config.xml"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HibernateTitleRepositoryTests {

    <span class="hl-comment">// this instance will be dependency injected by type</span>
    @Autowired    
    <span class="hl-keyword">private</span> HibernateTitleRepository titleRepository;

    @Test
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findById() {
        Title title = titleRepository.findById(<span class="hl-keyword">new</span> Long(10));
        assertNotNull(title);
    }
}</pre><p>Alternatively, you can configure the class to use
        <code class="interfacename">@Autowired</code> for setter injection as seen
        below.</p><pre class="programlisting">@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
<span class="hl-comment">// specifies the Spring configuration to load for this test fixture</span>
@ContextConfiguration(<span class="hl-string">"repository-config.xml"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HibernateTitleRepositoryTests {

    <span class="hl-comment">// this instance will be dependency injected by type</span>
    <span class="hl-keyword">private</span> HibernateTitleRepository titleRepository;

    @Autowired
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setTitleRepository(HibernateTitleRepository titleRepository) {
        <span class="hl-keyword">this</span>.titleRepository = titleRepository;
    }

    @Test
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findById() {
        Title title = titleRepository.findById(<span class="hl-keyword">new</span> Long(10));
        assertNotNull(title);
    }
}</pre><p>The preceding code listings use the same XML context file
        referenced by the <code class="interfacename">@ContextConfiguration</code>
        annotation (that is, <code class="literal">repository-config.xml</code>), which
        looks like this:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span> 
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans 
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

    &lt;<span class="hl-comment">!-- this bean will be injected into the HibernateTitleRepositoryTests class --</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"titleRepository"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.repository.hibernate.HibernateTitleRepository"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"sessionFactory"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
    
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sessionFactory"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate3.LocalSessionFactoryBean"</span>&gt;
        &lt;<span class="hl-comment">!-- configuration elided for brevity --</span>&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you are extending from a Spring-provided test base class
          that happens to use <code class="interfacename">@Autowired</code> on one
          of its setter methods, you might have multiple beans of the affected
          type defined in your application context: for example, multiple
          <code class="interfacename">DataSource</code> beans. In such a case, you
          can override the setter method and use the
          <code class="interfacename">@Qualifier</code> annotation to indicate a
          specific target bean as follows, but make sure to delegate to the
          overridden method in the superclass as well.</p><pre class="programlisting"><span class="hl-comment">// ...</span>

    @Autowired
    @Override
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(@Qualifier(<span class="hl-string">"myDataSource"</span>) DataSource dataSource) {
        <span class="hl-keyword">super</span>.setDataSource(dataSource);
    }

<span class="hl-comment">// ...</span></pre><p>The specified qualifier value indicates the specific
          <code class="interfacename">DataSource</code> bean to inject, narrowing
          the set of type matches to a specific bean. Its value is matched
          against <code class="literal">&lt;qualifier&gt;</code> declarations within the
          corresponding <code class="literal">&lt;bean&gt;</code> definitions. The bean
          name is used as a fallback qualifier value, so you may effectively
          also point to a specific bean by name there (as shown above,
          assuming that "myDataSource" is the bean id).</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-tx"></a>10.3.5.4&nbsp;Transaction management</h4></div></div></div><p>In the TestContext framework, transactions are managed by the
        <code class="classname">TransactionalTestExecutionListener</code>. Note that
        <code class="classname">TransactionalTestExecutionListener</code> is
        configured by default, even if you do not explicitly declare
        <code class="interfacename">@TestExecutionListeners</code> on your test
        class. To enable support for transactions, however, you must provide a
        <code class="classname">PlatformTransactionManager</code> bean in the
        application context loaded by
        <code class="interfacename">@ContextConfiguration</code> semantics. In
        addition, you must declare
        <code class="interfacename">@Transactional</code> either at the class or
        method level for your tests.</p><p>For class-level transaction configuration (i.e., setting the
        bean name for the transaction manager and the default rollback flag),
        see the <code class="interfacename">@TransactionConfiguration</code> entry
        in the <a class="link" href="#integration-testing-annotations" title="10.3.4&nbsp;Annotations">annotation
        support</a> section.</p><p>If transactions are not enabled for the entire test class, you
        can annotate methods explicitly with
        <code class="interfacename">@Transactional</code>. To control whether a
        transaction should commit for a particular test method, you can use
        the <code class="interfacename">@Rollback</code> annotation to override
        the class-level default rollback setting.</p><p><span class="emphasis"><em><a class="link" href="#testcontext-support-classes-junit4" title="JUnit support classes"><code class="classname">AbstractTransactionalJUnit4SpringContextTests</code></a>
        and <a class="link" href="#testcontext-support-classes-testng" title="TestNG support classes"><code class="classname">AbstractTransactionalTestNGSpringContextTests</code></a>
        are preconfigured for transactional support at the class level.
        </em></span></p><p>Occasionally you need to execute certain code before or after a
        transactional test method but outside the transactional context, for
        example, to verify the initial database state prior to execution of
        your test or to verify expected transactional commit behavior after
        test execution (if the test was configured not to roll back the
        transaction).
        <code class="classname">TransactionalTestExecutionListener</code> supports the
        <code class="interfacename">@BeforeTransaction</code> and
        <code class="interfacename">@AfterTransaction</code> annotations exactly
        for such scenarios. Simply annotate any <code class="literal">public void</code>
        method in your test class with one of these annotations, and the
        <code class="classname">TransactionalTestExecutionListener</code> ensures that
        your <span class="emphasis"><em>before transaction method</em></span> or <span class="emphasis"><em>after
        transaction method</em></span> is executed at the appropriate
        time.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Any <span class="emphasis"><em>before methods</em></span> (such as methods
          annotated with JUnit's <code class="interfacename">@Before</code>) and
          any <span class="emphasis"><em>after methods</em></span> (such as methods annotated
          with JUnit's <code class="interfacename">@After</code>) are executed
          <span class="bold"><strong>within</strong></span> a transaction. In addition,
          methods annotated with
          <code class="interfacename">@BeforeTransaction</code> or
          <code class="interfacename">@AfterTransaction</code> are naturally not
          executed for tests annotated with
          <code class="interfacename">@NotTransactional</code>. However,
          <code class="interfacename">@NotTransactional</code> is deprecated as of
          Spring 3.0.</p></td></tr></table></div><p>The following JUnit-based example displays a fictitious
        integration testing scenario highlighting several transaction-related
        annotations. Consult the <a class="link" href="#integration-testing-annotations" title="10.3.4&nbsp;Annotations">annotation support</a>
        section for further information and configuration examples.</p><pre class="programlisting">@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
@ContextConfiguration
@TransactionConfiguration(transactionManager=<span class="hl-string">"txMgr"</span>, defaultRollback=false)
@Transactional
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FictitiousTransactionalTest {

    @BeforeTransaction
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> verifyInitialDatabaseState() {
        <span class="hl-comment">// logic to verify the initial state before a transaction is started</span>
    }

    @Before
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setUpTestDataWithinTransaction() {
        <span class="hl-comment">// set up test data within the transaction</span>
    }

    @Test
    <span class="hl-comment">// overrides the class-level defaultRollback setting</span>
    @Rollback(true)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> modifyDatabaseWithinTransaction() {
        <span class="hl-comment">// logic which uses the test data and modifies database state</span>
    }

    @After
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> tearDownWithinTransaction() {
        <span class="hl-comment">// execute "tear down" logic within the transaction</span>
    }

    @AfterTransaction
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> verifyFinalDatabaseState() {
        <span class="hl-comment">// logic to verify the final state after transaction has rolled back</span>
    }

}</pre><a name="testcontext-tx-false-positives"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Avoid false positives when testing ORM code"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Avoid false positives when testing ORM code</th></tr><tr><td align="left" valign="top"><p>When you test application code that manipulates the state of
          the Hibernate session, make sure to <span class="emphasis"><em>flush</em></span> the
          underlying session within test methods that execute that code.
          Failing to flush the underlying session can produce <span class="emphasis"><em>false
          positives</em></span>: your test may pass, but the same code throws
          an exception in a live, production environment. In the following
          Hibernate-based example test case, one method demonstrates a false
          positive, and the other method correctly exposes the results of
          flushing the session. Note that this applies to JPA and any other
          ORM frameworks that maintain an in-memory <span class="emphasis"><em>unit of
          work</em></span>.</p><pre class="programlisting"><span class="hl-comment">// ...</span>

@Autowired
<span class="hl-keyword">private</span> SessionFactory sessionFactory;

@Test <span class="hl-comment">// no expected exception!</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> falsePositive() {
    updateEntityInHibernateSession();
    <span class="hl-comment">// False positive: an exception will be thrown once the session is</span>
    <span class="hl-comment">// finally flushed (i.e., in production code)</span>
}

@Test(expected = GenericJDBCException.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> updateWithSessionFlush() {
    updateEntityInHibernateSession();
    <span class="hl-comment">// Manual flush is required to avoid false positive in test</span>
    sessionFactory.getCurrentSession().flush();
}

<span class="hl-comment">// ...</span></pre></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-support-classes"></a>10.3.5.5&nbsp;TestContext support classes</h4></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="testcontext-support-classes-junit4"></a>JUnit support classes</h5></div></div></div><p>The <code class="literal">org.springframework.test.context.junit4</code>
          package provides support classes for JUnit 4.5+ based test
          cases.</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">AbstractJUnit4SpringContextTests</code>:
              Abstract base test class that integrates the <span class="emphasis"><em>Spring
              TestContext Framework</em></span> with explicit
              <code class="classname">ApplicationContext</code> testing support in a
              JUnit 4.5+ environment.</p><p>When you extend
              <code class="classname">AbstractJUnit4SpringContextTests</code>, you can
              access the following <code class="literal">protected</code> instance
              variable:</p><div class="itemizedlist"><ul type="circle"><li><p><code class="literal">applicationContext</code>: Use this
                  variable to perform explicit bean lookups or to test the
                  state of the context as a whole.</p></li></ul></div></li><li><p><code class="classname">AbstractTransactionalJUnit4SpringContextTests</code>:
              Abstract <span class="emphasis"><em>transactional</em></span> extension of
              <code class="classname">AbstractJUnit4SpringContextTests</code> that
              also adds some convenience functionality for JDBC access.
              Expects a <code class="classname">javax.sql.DataSource</code> bean and a
              <code class="interfacename">PlatformTransactionManager</code> bean
              to be defined in the <code class="classname">ApplicationContext</code>.
              When you extend
              <code class="classname">AbstractTransactionalJUnit4SpringContextTests</code>
              you can access the following <code class="literal">protected</code>
              instance variables:</p><div class="itemizedlist"><ul type="circle"><li><p><code class="literal">applicationContext</code>: Inherited from
                  the <code class="classname">AbstractJUnit4SpringContextTests</code>
                  superclass. Use this variable to perform explicit bean
                  lookups or to test the state of the context as a
                  whole.</p></li><li><p><code class="literal">simpleJdbcTemplate</code>: Use this
                  variable to execute SQL statements to query the database.
                  Such queries can be used to confirm database state both
                  <span class="emphasis"><em>prior to</em></span> and <span class="emphasis"><em>after</em></span>
                  execution of database-related application code, and Spring
                  ensures that such queries run in the scope of the same
                  transaction as the application code. When used in
                  conjunction with an ORM tool, be sure to avoid <a class="link" href="#testcontext-tx-false-positives">false
                  positives</a>.</p></li></ul></div></li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>These classes are a convenience for extension. If you do not
            want your test classes to be tied to a Spring-specific class
            hierarchy &#8212; for example, if you want to directly extend the class
            you are testing &#8212; you can configure your own custom test classes
            by using
            <code class="interfacename">@RunWith(SpringJUnit4ClassRunner.class)</code>,
            <code class="interfacename">@ContextConfiguration</code>,
            <code class="interfacename">@TestExecutionListeners</code>, and so
            on.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="testcontext-junit4-runner"></a>Spring JUnit Runner</h5></div></div></div><p>The <span class="emphasis"><em>Spring TestContext Framework</em></span> offers
          full integration with JUnit 4.5+ through a custom runner (tested on
          JUnit 4.5 &#8211; 4.9). By annotating test classes with
          <code class="literal">@RunWith(SpringJUnit4ClassRunner.class)</code>,
          developers can implement standard JUnit-based unit and integration
          tests and simultaneously reap the benefits of the TestContext
          framework such as support for loading application contexts,
          dependency injection of test instances, transactional test method
          execution, and so on. The following code listing displays the
          minimal requirements for configuring a test class to run with the
          custom Spring Runner.
          <code class="interfacename">@TestExecutionListeners</code> is configured
          with an empty list in order to disable the default listeners, which
          otherwise would require an ApplicationContext to be configured
          through <code class="interfacename">@ContextConfiguration</code>.</p><pre class="programlisting">@RunWith(SpringJUnit4ClassRunner.<span class="hl-keyword">class</span>)
@TestExecutionListeners({})
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleTest {

    @Test
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testMethod() {
        <span class="hl-comment">// execute test logic...</span>
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="testcontext-support-classes-testng"></a>TestNG support classes</h5></div></div></div><p>The <code class="literal">org.springframework.test.context.testng</code>
          package provides support classes for TestNG based test cases.</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">AbstractTestNGSpringContextTests</code>:
              Abstract base test class that integrates the <span class="emphasis"><em>Spring
              TestContext Framework</em></span> with explicit
              <code class="classname">ApplicationContext</code> testing support in a
              TestNG environment.</p><p>When you extend
              <code class="classname">AbstractTestNGSpringContextTests</code>, you can
              access the following <code class="literal">protected</code> instance
              variable:</p><div class="itemizedlist"><ul type="circle"><li><p><code class="literal">applicationContext</code>: Use this
                  variable to perform explicit bean lookups or to test the
                  state of the context as a whole.</p></li></ul></div></li><li><p><code class="classname">AbstractTransactionalTestNGSpringContextTests</code>:
              Abstract <span class="emphasis"><em>transactional</em></span> extension of
              <code class="classname">AbstractTestNGSpringContextTests</code> that
              adds some convenience functionality for JDBC access. Expects a
              <code class="classname">javax.sql.DataSource</code> bean and a
              <code class="interfacename">PlatformTransactionManager</code> bean
              to be defined in the <code class="classname">ApplicationContext</code>.
              When you extend
              <code class="classname">AbstractTransactionalTestNGSpringContextTests</code>,
              you can access the following <code class="literal">protected</code>
              instance variables:</p><div class="itemizedlist"><ul type="circle"><li><p><code class="literal">applicationContext</code>: Inherited from
                  the <code class="classname">AbstractTestNGSpringContextTests</code>
                  superclass. Use this variable to perform explicit bean
                  lookups or to test the state of the context as a
                  whole.</p></li><li><p><code class="literal">simpleJdbcTemplate</code>: Use this
                  variable to execute SQL statements to query the database.
                  Such queries can be used to confirm database state both
                  <span class="emphasis"><em>prior to</em></span> and <span class="emphasis"><em>after</em></span>
                  execution of database-related application code, and Spring
                  ensures that such queries run in the scope of the same
                  transaction as the application code. When used in
                  conjunction with an ORM tool, be sure to avoid <a class="link" href="#testcontext-tx-false-positives">false
                  positives</a>.</p></li></ul></div></li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>These classes are a convenience for extension. If you do not
            want your test classes to be tied to a Spring-specific class
            hierarchy &#8212; for example, if you want to directly extend the class
            you are testing &#8212; you can configure your own custom test classes
            by using <code class="interfacename">@ContextConfiguration</code>,
            <code class="interfacename">@TestExecutionListeners</code>, and so on,
            and by manually instrumenting your test class with a
            <code class="classname">TestContextManager</code>. See the source code of
            <code class="classname">AbstractTestNGSpringContextTests</code> for an
            example of how to instrument your test class.</p></td></tr></table></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testing-examples-petclinic"></a>10.3.6&nbsp;PetClinic Example</h3></div></div></div><p>The PetClinic application, available from the <a class="link" href="#new-in-3.0-samples">samples repository</a>, illustrates
      several features of the <span class="emphasis"><em>Spring TestContext
      Framework</em></span> in a JUnit 4.5+ environment. Most test
      functionality is included in the
      <code class="classname">AbstractClinicTests</code>, for which a partial listing
      is shown below:</p><pre class="programlisting"><span class="hl-keyword">import</span> <span class="hl-keyword">static</span> org.junit.Assert.assertEquals;
<span class="hl-comment">// import ...</span>

@ContextConfiguration
<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> AbstractClinicTests <span class="hl-keyword">extends</span> AbstractTransactionalJUnit4SpringContextTests {

    @Autowired
    <span class="hl-keyword">protected</span> Clinic clinic;

    @Test
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> getVets() {
        Collection&lt;Vet&gt; vets = <span class="hl-keyword">this</span>.clinic.getVets();
        assertEquals(<span class="hl-string">"JDBC query must show the same number of vets"</span>,
            <span class="hl-keyword">super</span>.countRowsInTable(<span class="hl-string">"VETS"</span>), vets.size());
        Vet v1 = EntityUtils.getById(vets, Vet.<span class="hl-keyword">class</span>, 2);
        assertEquals(<span class="hl-string">"Leary"</span>, v1.getLastName());
        assertEquals(1, v1.getNrOfSpecialties());
        assertEquals(<span class="hl-string">"radiology"</span>, (v1.getSpecialties().get(0)).getName());
        <span class="hl-comment">// ...</span>
    }

    <span class="hl-comment">// ...</span>
}</pre><p>Notes:</p><div class="itemizedlist"><ul type="disc"><li><p>This test case extends the
          <code class="classname">AbstractTransactionalJUnit4SpringContextTests</code>
          class, from which it inherits configuration for Dependency Injection
          (through the
          <code class="classname">DependencyInjectionTestExecutionListener</code>) and
          transactional behavior (through the
          <code class="classname">TransactionalTestExecutionListener</code>).</p></li><li><p>The <code class="literal">clinic</code> instance variable &#8212; the
          application object being tested &#8212; is set by Dependency Injection
          through <code class="interfacename">@Autowired</code> semantics.</p></li><li><p>The <code class="methodname">testGetVets()</code> method illustrates
          how you can use the inherited
          <code class="methodname">countRowsInTable()</code> method to easily verify
          the number of rows in a given table, thus verifying correct behavior
          of the application code being tested. This allows for stronger tests
          and lessens dependency on the exact test data. For example, you can
          add additional rows in the database without breaking tests.</p></li><li><p>Like many integration tests that use a database, most of the
          tests in <code class="classname">AbstractClinicTests</code> depend on a
          minimum amount of data already in the database before the test cases
          run. Alternatively, you might choose to populate the database within
          the test fixture set up of your test cases &#8212; again, within the same
          transaction as the tests.</p></li></ul></div><p>The PetClinic application supports three data access technologies:
      JDBC, Hibernate, and JPA. By declaring
      <code class="interfacename">@ContextConfiguration</code> without any
      specific resource locations, the
      <code class="classname">AbstractClinicTests</code> class will have its
      application context loaded from the default location,
      <code class="literal">AbstractClinicTests-context.xml</code>, which declares a
      common <code class="classname">DataSource</code>. Subclasses specify additional
      context locations that must declare a
      <code class="interfacename">PlatformTransactionManager</code> and a concrete
      implementation of <code class="interfacename">Clinic</code>.</p><p>For example, the Hibernate implementation of the PetClinic tests
      contains the following implementation. For this example,
      <code class="classname">HibernateClinicTests</code> does not contain a single
      line of code: we only need to declare
      <code class="interfacename">@ContextConfiguration</code>, and the tests are
      inherited from <code class="classname">AbstractClinicTests</code>. Because
      <code class="interfacename">@ContextConfiguration</code> is declared without
      any specific resource locations, the <span class="emphasis"><em>Spring TestContext
      Framework</em></span> loads an application context from all the beans
      defined in <code class="literal">AbstractClinicTests-context.xml</code> (i.e., the
      inherited locations) and
      <code class="literal">HibernateClinicTests-context.xml</code>, with
      <code class="literal">HibernateClinicTests-context.xml</code> possibly overriding
      beans defined in
      <code class="literal">AbstractClinicTests-context.xml</code>.</p><pre class="programlisting">@ContextConfiguration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HibernateClinicTests <span class="hl-keyword">extends</span> AbstractClinicTests { }
</pre><p>In a large-scale application, the Spring configuration is often
      split across multiple files. Consequently, configuration locations are
      typically specified in a common base class for all application-specific
      integration tests. Such a base class may also add useful instance
      variables &#8212; populated by Dependency Injection, naturally &#8212; such as a
      <code class="classname">SessionFactory</code> in the case of an application
      using Hibernate.</p><p>As far as possible, you should have exactly the same Spring
      configuration files in your integration tests as in the deployed
      environment. One likely point of difference concerns database connection
      pooling and transaction infrastructure. If you are deploying to a
      full-blown application server, you will probably use its connection pool
      (available through JNDI) and JTA implementation. Thus in production you
      will use a <code class="classname">JndiObjectFactoryBean</code> or
      <code class="literal">&lt;jee:jndi-lookup&gt;</code> for the
      <code class="classname">DataSource</code> and
      <code class="classname">JtaTransactionManager</code>. JNDI and JTA will not be
      available in out-of-container integration tests, so you should use a
      combination like the Commons DBCP <code class="classname">BasicDataSource</code>
      and <code class="classname">DataSourceTransactionManager</code> or
      <code class="classname">HibernateTransactionManager</code> for them. You can
      factor out this variant behavior into a single XML file, having the
      choice between application server and a 'local' configuration separated
      from all other configuration, which will not vary between the test and
      production environments. In addition, it is advisable to use properties
      files for connection settings. See the PetClinic application for an
      example.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing-resources"></a>10.4&nbsp;Further Resources</h2></div></div></div><p>Consult the following resources for more information about
    testing:</p><div class="itemizedlist"><ul type="disc"><li><p><a class="ulink" href="http://www.junit.org/" target="_top">JUnit</a>:
        &#8220;<span class="quote"><span class="emphasis"><em>A programmer-oriented testing framework for
        Java</em></span></span>&#8221;. Used by the Spring Framework in its test
        suite.</p></li><li><p><a class="ulink" href="http://testng.org/" target="_top">TestNG</a>: A testing
        framework inspired by JUnit with added support for Java 5 annotations,
        test groups, data-driven testing, distributed testing, etc.</p></li><li><p><a class="ulink" href="http://www.mockobjects.com/" target="_top">MockObjects.com</a>: Web site
        dedicated to mock objects, a technique for improving the design of
        code within test-driven development.</p></li><li><p><a class="ulink" href="http://en.wikipedia.org/wiki/Mock_Object" target="_top">"Mock
        Objects"</a>: Article in Wikipedia.</p></li><li><p><a class="ulink" href="http://www.easymock.org/" target="_top">EasyMock</a>: Java
        library &#8220;<span class="quote"><span class="emphasis"><em>that provides Mock Objects for interfaces
        (and objects through the class extension) by generating them on the
        fly using Java's proxy mechanism.</em></span></span>&#8221; Used by the
        Spring Framework in its test suite.</p></li><li><p><a class="ulink" href="http://www.jmock.org/" target="_top">JMock</a>: Library that
        supports test-driven development of Java code with mock
        objects.</p></li><li><p><a class="ulink" href="http://mockito.org/" target="_top">Mockito</a>: Java mock
        library based on the <a class="ulink" href="http://xunitpatterns.com/Test%20Spy.html" target="_top">test spy</a>
        pattern.</p></li><li><p><a class="ulink" href="http://dbunit.sourceforge.net/" target="_top">DbUnit</a>:
        JUnit extension (also usable with Ant and Maven) targeted for
        database-driven projects that, among other things, puts your database
        into a known state between test runs.</p></li><li><p><a class="ulink" href="http://grinder.sourceforge.net/" target="_top">Grinder</a>:
        Java load testing framework.</p></li></ul></div></div></div></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="spring-data-tier"></a>Part&nbsp;IV.&nbsp;Data Access</h1></div></div></div><div class="partintro" lang="en"><div></div><p>This part of the reference documentation is concerned with data
      access and the interaction between the data access layer and the
      business or service layer.</p><p>Spring's comprehensive transaction management support is covered
      in some detail, followed by thorough coverage of the various data access
      frameworks and technologies that the Spring Framework integrates
      with.</p><div class="itemizedlist"><ul type="disc"><li><p><a class="xref" href="#transaction" title="11.&nbsp;Transaction Management">Chapter&nbsp;11, <i>Transaction Management</i></a></p></li><li><p><a class="xref" href="#dao" title="12.&nbsp;DAO support">Chapter&nbsp;12, <i>DAO support</i></a></p></li><li><p><a class="xref" href="#jdbc" title="13.&nbsp;Data access with JDBC">Chapter&nbsp;13, <i>Data access with JDBC</i></a></p></li><li><p><a class="xref" href="#orm" title="14.&nbsp;Object Relational Mapping (ORM) Data Access">Chapter&nbsp;14, <i>Object Relational Mapping (ORM) Data Access</i></a></p></li><li><p><a class="xref" href="#oxm" title="15.&nbsp;Marshalling XML using O/X Mappers">Chapter&nbsp;15, <i>Marshalling XML using O/X Mappers</i></a></p></li></ul></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="transaction"></a>11.&nbsp;Transaction Management</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-intro"></a>11.1&nbsp;Introduction to Spring Framework transaction management</h2></div></div></div><p>Comprehensive transaction support is among the most compelling
    reasons to use the Spring Framework. The Spring Framework provides a
    consistent abstraction for transaction management that delivers the
    following benefits:</p><div class="itemizedlist"><ul type="disc"><li><p>Consistent programming model across different transaction APIs
        such as Java Transaction API (JTA), JDBC, Hibernate, Java Persistence
        API (JPA), and Java Data Objects (JDO).</p></li><li><p>Support for <a class="link" href="#transaction-declarative" title="11.5&nbsp;Declarative transaction management">declarative
        transaction management</a>.</p></li><li><p>Simpler API for <a class="link" href="#transaction-programmatic" title="11.6&nbsp;Programmatic transaction management">programmatic</a> transaction
        management than complex transaction APIs such as JTA.</p></li><li><p>Excellent integration with Spring's data access
        abstractions.</p></li></ul></div><p>The following sections describe the Spring Framework's transaction
    value-adds and technologies. (The chapter also includes discussions of
    best practices, application server integration, and solutions to common
    problems.)</p><div class="itemizedlist"><ul type="disc"><li><p><a class="link" href="#transaction-motivation" title="11.2&nbsp;Advantages of the Spring Framework's transaction support model">Advantages of the Spring
        Framework's transaction support model</a> describes
        <span class="emphasis"><em>why</em></span> you would use the Spring Framework's
        transaction abstraction instead of EJB Container-Managed Transactions
        (CMT) or choosing to drive local transactions through a proprietary
        API such as Hibernate.</p></li><li><p><a class="link" href="#transaction-strategies" title="11.3&nbsp;Understanding the Spring Framework transaction abstraction">Understanding the Spring
        Framework transaction abstraction</a> outlines the core classes and
        describes how to configure and obtain
        <code class="interfacename">DataSource</code> instances from a variety of
        sources.</p></li><li><p><a class="link" href="#tx-resource-synchronization" title="11.4&nbsp;Synchronizing resources with transactions">Synchronizing
        resources with transactions </a>describes how the application code
        ensures that resources are created, reused, and cleaned up
        properly.</p></li><li><p><a class="link" href="#transaction-declarative" title="11.5&nbsp;Declarative transaction management">Declarative transaction
        management</a> describes support for declarative transaction
        management.</p></li><li><p><a class="link" href="#transaction-programmatic" title="11.6&nbsp;Programmatic transaction management">Programmatic
        transaction management</a> covers support for programmatic (that
        is, explicitly coded) transaction management.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-motivation"></a>11.2&nbsp;Advantages of the Spring Framework's transaction support model</h2></div></div></div><p>Traditionally, Java EE developers have had two choices for
    transaction management: <span class="emphasis"><em>global</em></span> or
    <span class="emphasis"><em>local</em></span> transactions, both of which have profound
    limitations. Global and local transaction management is reviewed in the
    next two sections, followed by a discussion of how the Spring Framework's
    transaction management support addresses the limitations of the global and
    local transaction models.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e20593"></a>11.2.1&nbsp;Global transactions</h3></div></div></div><p>Global transactions enable you to work with multiple transactional
      resources, typically relational databases and message queues. The
      application server manages global transactions through the JTA, which is
      a cumbersome API to use (partly due to its exception model).
      Furthermore, a JTA <code class="interfacename">UserTransaction</code>
      normally needs to be sourced from JNDI, meaning that you
      <span class="emphasis"><em>also</em></span> need to use JNDI in order to use JTA.
      Obviously the use of global transactions would limit any potential reuse
      of application code, as JTA is normally only available in an application
      server environment.</p><p>Previously, the preferred way to use global transactions was via
      EJB <span class="emphasis"><em>CMT</em></span> (<span class="emphasis"><em>Container Managed
      Transaction</em></span>): CMT is a form of <span class="bold"><strong>declarative transaction management</strong></span> (as
      distinguished from <span class="bold"><strong>programmatic transaction
      management</strong></span>). EJB CMT removes the need for transaction-related
      JNDI lookups, although of course the use of EJB itself necessitates the
      use of JNDI. It removes most but not all of the need to write Java code
      to control transactions. The significant downside is that CMT is tied to
      JTA and an application server environment. Also, it is only available if
      one chooses to implement business logic in EJBs, or at least behind a
      transactional EJB facade. The negatives of EJB in general are so great
      that this is not an attractive proposition, especially in the face of
      compelling alternatives for declarative transaction management.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e20618"></a>11.2.2&nbsp;Local transactions</h3></div></div></div><p>Local transactions are resource-specific, such as a transaction
      associated with a JDBC connection. Local transactions may be easier to
      use, but have significant disadvantages: they cannot work across
      multiple transactional resources. For example, code that manages
      transactions using a JDBC connection cannot run within a global JTA
      transaction. Because the application server is not involved in
      transaction management, it cannot help ensure correctness across
      multiple resources. (It is worth noting that most applications use a
      single transaction resource.) Another downside is that local
      transactions are invasive to the programming model.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e20623"></a>11.2.3&nbsp;Spring Framework's consistent programming model</h3></div></div></div><p>Spring resolves the disadvantages of global and local
      transactions. It enables application developers to use a
      <span class="emphasis"><em>consistent</em></span> programming model <span class="emphasis"><em>in any
      environment</em></span>. You write your code once, and it can benefit
      from different transaction management strategies in different
      environments. The Spring Framework provides both declarative and
      programmatic transaction management. Most users prefer declarative
      transaction management, which is recommended in most cases.</p><p>With programmatic transaction management, developers work with the
      Spring Framework transaction abstraction, which can run over any
      underlying transaction infrastructure. With the preferred declarative model, developers typically write little or
      no code related to transaction management, and hence do not depend on
      the Spring Framework transaction API, or any other transaction
      API.</p><div class="sidebar"><p class="title"><b>Do you need an application server for transaction
        management?</b></p><p>The Spring Framework's transaction management support changes
        traditional rules as to when an enterprise Java application requires
        an application server.</p><p>In particular, you do not need an application server simply for
        declarative transactions through EJBs. In fact, even if your
        application server has powerful JTA capabilities, you may decide that
        the Spring Framework's declarative transactions offer more power and a
        more productive programming model than EJB CMT.</p><p>Typically you need an application server's JTA capability only
        if your application needs to handle transactions across multiple
        resources, which is not a requirement for many applications. Many
        high-end applications use a single, highly scalable database (such as
        Oracle RAC) instead. Standalone transaction managers such as <a class="ulink" href="http://www.atomikos.com/" target="_top">Atomikos Transactions</a> and
        <a class="ulink" href="http://jotm.objectweb.org/" target="_top">JOTM</a> are other
        options. Of course, you may need other application server capabilities
        such as Java Message Service (JMS) and J2EE Connector Architecture
        (JCA).</p><p>The Spring Framework <span class="emphasis"><em>gives you the choice of when to
        scale your application to a fully loaded application
        server</em></span>. Gone are the days when the only alternative to
        using EJB CMT or JTA was to write code with local transactions such as
        those on JDBC connections, and face a hefty rework if you need that
        code to run within global, container-managed transactions. With the
        Spring Framework, only some of the bean definitions in your
        configuration file, rather than your code, need to change.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-strategies"></a>11.3&nbsp;Understanding the Spring Framework transaction abstraction</h2></div></div></div><p>The key to the Spring transaction abstraction is the notion of a
    <span class="emphasis"><em>transaction strategy</em></span>. A transaction strategy is
    defined by the
    <code class="interfacename">org.springframework.transaction.PlatformTransactionManager</code>
    interface:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> PlatformTransactionManager {

  TransactionStatus getTransaction(TransactionDefinition definition)
    <span class="hl-keyword">throws</span> TransactionException;

  <span class="hl-keyword">void</span> commit(TransactionStatus status) <span class="hl-keyword">throws</span> TransactionException;

  <span class="hl-keyword">void</span> rollback(TransactionStatus status) <span class="hl-keyword">throws</span> TransactionException;
}</pre><p>This is primarily a service provider interface (SPI), although it
    can be used <a class="link" href="#transaction-programmatic-ptm" title="11.6.2&nbsp;Using the PlatformTransactionManager">programmatically</a> from your
    application code. Because
    <code class="interfacename">PlatformTransactionManager</code> is an
    <span class="emphasis"><em>interface</em></span>, it can be easily mocked or stubbed as
    necessary. It is not tied to a lookup strategy such as JNDI.
    <code class="interfacename">PlatformTransactionManager</code> implementations
    are defined like any other object (or bean) in the Spring Framework IoC
    container. This benefit alone makes Spring Framework transactions a
    worthwhile abstraction even when you work with JTA. Transactional code can
    be tested much more easily than if it used JTA directly.</p><p>Again in keeping with Spring's philosophy, the
    <code class="exceptionname">TransactionException</code> that can be thrown by
    any of the <code class="interfacename">PlatformTransactionManager</code>
    interface's methods is <span class="emphasis"><em>unchecked</em></span> (that is, it extends
    the <code class="exceptionname">java.lang.RuntimeException</code> class).
    Transaction infrastructure failures are almost invariably fatal. In rare
    cases where application code can actually recover from a transaction
    failure, the application developer can still choose to catch and handle
    <code class="exceptionname">TransactionException</code>. The salient point is
    that developers are not <span class="emphasis"><em>forced</em></span> to do so.</p><p>The <code class="methodname">getTransaction(..)</code> method returns a
    <code class="interfacename">TransactionStatus</code> object, depending on a
    <code class="interfacename">TransactionDefinition</code> parameter. The
    returned <code class="interfacename">TransactionStatus</code> might represent
    a new transaction, or can represent an existing transaction if a matching
    transaction exists in the current call stack. The implication in this
    latter case is that, as with Java EE transaction contexts, a
    <code class="interfacename">TransactionStatus</code> is associated with a
    <span class="bold"><strong>thread</strong></span> of execution.</p><p>The <code class="interfacename">TransactionDefinition</code> interface
    specifies:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>Isolation</strong></span>: The degree to which
        this transaction is isolated from the work of other transactions. For
        example, can this transaction see uncommitted writes from other
        transactions?</p></li><li><p><span class="bold"><strong>Propagation</strong></span>: Typically, all
        code executed within a transaction scope will run in that transaction.
        However, you have the option of specifying the behavior in the event
        that a transactional method is executed when a transaction context
        already exists. For
        example, code can continue running in the existing transaction (the
        common case); or the existing transaction can be suspended and a new
        transaction created. <span class="emphasis"><em>Spring offers all of the transaction
        propagation options familiar from EJB CMT</em></span>. To read about
        the semantics of transaction propagation in Spring, see <a class="xref" href="#tx-propagation" title="11.5.7&nbsp;Transaction propagation">Section&nbsp;11.5.7, &#8220;Transaction propagation&#8221;</a>.</p></li><li><p><span class="bold"><strong>Timeout</strong></span>: How long this
        transaction runs before timing out and being rolled back automatically
        by the underlying transaction infrastructure.</p></li><li><p><span class="bold"><strong>Read-only status</strong></span>: A read-only
        transaction can be used when your code reads but does not modify data.
        Read-only transactions can be a useful optimization in some cases,
        such as when you are using Hibernate.</p></li></ul></div><p>These settings reflect standard transactional concepts. If
    necessary, refer to resources that discuss transaction isolation levels
    and other core transaction concepts. Understanding these concepts is
    essential to using the Spring Framework or any transaction management
    solution.</p><p>The <code class="interfacename">TransactionStatus</code> interface
    provides a simple way for transactional code to control transaction
    execution and query transaction status. The concepts should be familiar,
    as they are common to all transaction APIs:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> TransactionStatus <span class="hl-keyword">extends</span> SavepointManager {

    <span class="hl-keyword">boolean</span> isNewTransaction();

    <span class="hl-keyword">boolean</span> hasSavepoint();

    <span class="hl-keyword">void</span> setRollbackOnly();

    <span class="hl-keyword">boolean</span> isRollbackOnly();

    <span class="hl-keyword">void</span> flush();

    <span class="hl-keyword">boolean</span> isCompleted();

}</pre><p>Regardless of whether you opt for declarative or programmatic
    transaction management in Spring, defining the correct
    <code class="interfacename">PlatformTransactionManager</code> implementation
    is absolutely essential. You typically define this implementation through
    dependency injection.</p><p><code class="interfacename">PlatformTransactionManager</code>
    implementations normally require knowledge of the environment in which
    they work: JDBC, JTA, Hibernate, and so on. The following examples show
    how you can define a local
    <code class="interfacename">PlatformTransactionManager</code> implementation.
    (This example works with plain JDBC.)</p><p>You define a JDBC <code class="interfacename">DataSource</code></p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.driverClassName}"</span> /&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span> /&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span> /&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The related <code class="interfacename">PlatformTransactionManager</code>
    bean definition will then have a reference to the
    <code class="interfacename">DataSource</code> definition. It will look like this:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>If you use JTA in a Java EE container then you use a container
    <code class="interfacename">DataSource</code>, obtained through JNDI, in
    conjunction with Spring's <code class="classname">JtaTransactionManager</code>.
    This is what the JTA and JNDI lookup version would look like:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xmlns:jee</span>=<span class="hl-value">"http://www.springframework.org/schema/jee"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
     http://www.springframework.org/schema/beans 
     http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
     http://www.springframework.org/schema/jee 
     http://www.springframework.org/schema/jee/spring-jee-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"jdbc/jpetstore"</span>/&gt; 

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.jta.JtaTransactionManager"</span> /&gt;
  
  &lt;<span class="hl-comment">!-- other &lt;bean/&gt; definitions here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The <code class="classname">JtaTransactionManager</code> does not need to
    know about the <code class="interfacename">DataSource</code>, or any other
    specific resources, because it uses the container's global transaction
    management infrastructure.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The above definition of the <code class="literal">dataSource</code> bean
      uses the <code class="literal">&lt;jndi-lookup/&gt;</code> tag from the
      <code class="literal">jee</code> namespace. For more information on schema-based
      configuration, see <a class="xref" href="#xsd-config" title="Appendix&nbsp;C.&nbsp;XML Schema-based configuration">Appendix&nbsp;C, <i>XML Schema-based configuration</i></a>, and for more
      information on the <code class="literal">&lt;jee/&gt;</code> tags see the section
      entitled <a class="xref" href="#xsd-config-body-schemas-jee" title="C.2.3&nbsp;The jee schema">Section&nbsp;C.2.3, &#8220;The jee schema&#8221;</a>.</p></td></tr></table></div><p>You can also use Hibernate local transactions easily, as shown in
    the following examples. In this case, you need to define a Hibernate
    <code class="classname">LocalSessionFactoryBean</code>, which your application
    code will use to obtain Hibernate <code class="interfacename">Session</code>
    instances.</p><p>The <code class="interfacename">DataSource</code> bean definition will
    be similar to the local JDBC example shown previously and thus is not
    shown in the following example.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If the <code class="interfacename">DataSource</code>, used by any
      non-JTA transaction manager, is looked up via JNDI and managed by a Java
      EE container, then it should be non-transactional because the Spring
      Framework, rather than the Java EE container, will manage the
      transactions.</p></td></tr></table></div><p>The <code class="literal">txManager</code> bean in this case is of the
    <code class="classname">HibernateTransactionManager</code> type. In the same way
    as the <code class="classname">DataSourceTransactionManager</code> needs a
    reference to the <code class="interfacename">DataSource</code>, the
    <code class="classname">HibernateTransactionManager</code> needs a reference to
    the <code class="interfacename">SessionFactory</code>.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate3.LocalSessionFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span> /&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappingResources"</span>&gt;
  &lt;<span class="hl-tag">list</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;org/springframework/samples/petclinic/hibernate/petclinic.hbm.xml&lt;<span class="hl-tag">/value</span>&gt;
  &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hibernateProperties"</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;
      hibernate.dialect=${hibernate.dialect}
    &lt;<span class="hl-tag">/value</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate3.HibernateTransactionManager"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"sessionFactory"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>If you are using Hibernate and Java EE container-managed JTA
    transactions, then you should simply use the same
    <code class="classname">JtaTransactionManager</code> as in the previous JTA
    example for JDBC.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.jta.JtaTransactionManager"</span>/&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you use JTA , then your transaction manager definition will
      look the same regardless of what data access technology you use, be it
      JDBC, Hibernate JPA or any other supported technology. This is due to
      the fact that JTA transactions are global transactions, which can enlist
      any transactional resource.</p></td></tr></table></div><p>In all these cases, application code does not need to change. You
    can change how transactions are managed merely by changing configuration,
    even if that change means moving from local to global transactions or vice
    versa.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tx-resource-synchronization"></a>11.4&nbsp;Synchronizing resources with transactions</h2></div></div></div><p>It should now be clear how you create different transaction
    managers, and how they are linked to related resources that need to be
    synchronized to transactions (for example
    <code class="classname">DataSourceTransactionManager</code> to a JDBC
    <code class="interfacename">DataSource</code>,
    <code class="classname">HibernateTransactionManager</code> to a Hibernate
    <code class="interfacename">SessionFactory</code>, and so forth). This section
    describes how the application code, directly or indirectly using a
    persistence API such as JDBC, Hibernate, or JDO, ensures that these
    resources are created, reused, and cleaned up properly. The section also
    discusses how transaction synchronization is triggered (optionally)
    through the relevant
    <code class="interfacename">PlatformTransactionManager</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-high"></a>11.4.1&nbsp;High-level synchronization approach</h3></div></div></div><p>The preferred approach is to use Spring's highest level template
      based persistence integration APIs or to use native ORM APIs with
      transaction- aware factory beans or proxies for managing the native
      resource factories. These transaction-aware solutions internally handle
      resource creation and reuse, cleanup, optional transaction
      synchronization of the resources, and exception mapping. Thus user data
      access code does not have to address these tasks, but can be focused
      purely on non-boilerplate persistence logic. Generally, you use the
      native ORM API or take a <span class="emphasis"><em>template</em></span> approach for JDBC
      access by using the <code class="classname">JdbcTemplate</code>. These solutions
      are detailed in subsequent chapters of this reference documentation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-low"></a>11.4.2&nbsp;Low-level synchronization approach</h3></div></div></div><p>Classes such as <code class="classname">DataSourceUtils</code> (for JDBC),
      <code class="classname">EntityManagerFactoryUtils</code> (for JPA),
      <code class="classname">SessionFactoryUtils</code> (for Hibernate),
      <code class="classname">PersistenceManagerFactoryUtils</code> (for JDO), and so
      on exist at a lower level. When you want the application code to deal
      directly with the resource types of the native persistence APIs, you use
      these classes to ensure that proper Spring Framework-managed instances
      are obtained, transactions are (optionally) synchronized, and exceptions
      that occur in the process are properly mapped to a consistent
      API.</p><p>For example, in the case of JDBC, instead of the traditional JDBC
      approach of calling the <code class="literal">getConnection()</code> method on the
      <code class="interfacename">DataSource</code>, you instead use Spring's
      <code class="classname">org.springframework.jdbc.datasource.DataSourceUtils</code>
      class as follows:</p><pre class="programlisting">Connection conn = DataSourceUtils.getConnection(dataSource);</pre><p>If an existing transaction already has a connection synchronized
      (linked) to it, that instance is returned. Otherwise, the method call
      triggers the creation of a new connection, which is (optionally)
      synchronized to any existing transaction, and made available for
      subsequent reuse in that same transaction. As mentioned, any
      <code class="exceptionname">SQLException</code> is wrapped in a Spring
      Framework
      <code class="exceptionname">CannotGetJdbcConnectionException</code>, one of
      the Spring Framework's hierarchy of unchecked DataAccessExceptions. This
      approach gives you more information than can be obtained easily from the
      <code class="exceptionname">SQLException</code>, and ensures portability
      across databases, even across different persistence technologies.</p><p>This approach also works without Spring transaction management
      (transaction synchronization is optional), so you can use it whether or
      not you are using Spring for transaction management.</p><p>Of course, once you have used Spring's JDBC support, JPA support
      or Hibernate support, you will generally prefer not to use
      <code class="classname">DataSourceUtils</code> or the other helper classes,
      because you will be much happier working through the Spring abstraction
      than directly with the relevant APIs. For example, if you use the Spring
      <code class="classname">JdbcTemplate</code> or <code class="literal">jdbc.object</code>
      package to simplify your use of JDBC, correct connection retrieval
      occurs behind the scenes and you won't need to write any special
      code.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-tadsp"></a>11.4.3&nbsp;<code class="classname">TransactionAwareDataSourceProxy</code></h3></div></div></div><p>At the very lowest level exists the
      <code class="classname">TransactionAwareDataSourceProxy</code> class. This is a
      proxy for a target <code class="interfacename">DataSource</code>, which
      wraps the target <code class="interfacename">DataSource</code> to add
      awareness of Spring-managed transactions. In this respect, it is similar
      to a transactional JNDI <code class="interfacename">DataSource</code> as
      provided by a Java EE server.</p><p>It should almost never be necessary or desirable to use this
      class, except when existing code must be called and passed a standard
      JDBC <code class="interfacename">DataSource</code> interface implementation.
      In that case, it is possible that this code is usable, but participating
      in Spring managed transactions. It is preferable to write your new code
      by using the higher level abstractions mentioned above.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-declarative"></a>11.5&nbsp;Declarative transaction management</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Most Spring Framework users choose declarative transaction
      management. This option has the least impact on application code, and
      hence is most consistent with the ideals of a
      <span class="emphasis"><em>non-invasive</em></span> lightweight container.</p></td></tr></table></div><p>The Spring Framework's declarative transaction management is made
    possible with Spring aspect-oriented programming (AOP), although, as the
    transactional aspects code comes with the Spring Framework distribution
    and may be used in a boilerplate fashion, AOP concepts do not generally
    have to be understood to make effective use of this code.</p><p>The Spring Framework's declarative transaction management is similar
    to EJB CMT in that you can specify transaction behavior (or lack of it)
    down to individual method level. It is possible to make a
    <code class="methodname">setRollbackOnly()</code> call within a transaction
    context if necessary. The differences between the two types of transaction
    management are:</p><div class="itemizedlist"><ul type="disc"><li><p>Unlike EJB CMT, which is tied to JTA, the Spring Framework's
        declarative transaction management works in any environment. It can
        work with JTA transactions or local transactions using JDBC, JPA,
        Hibernate or JDO by simply adjusting the configuration files.</p></li><li><p>You can apply the Spring Framework declarative transaction
        management to any class, not merely special classes such as
        EJBs.</p></li><li><p>The Spring Framework offers declarative <a class="link" href="#transaction-declarative-rolling-back" title="11.5.3&nbsp;Rolling back a declarative transaction"><span class="emphasis"><em>rollback
        rules</em></span>, </a>a feature with no EJB equivalent. Both
        programmatic and declarative support for rollback rules is
        provided.</p></li><li><p>The Spring Framework enables you to customize transactional
        behavior, by using AOP. For example, you can insert custom behavior in
        the case of transaction rollback. You can also add arbitrary advice,
        along with the transactional advice. With EJB CMT, you cannot influence
        the container's transaction management except with
        <code class="methodname">setRollbackOnly()</code>.</p></li><li><p>The Spring Framework does not support propagation of transaction
        contexts across remote calls, as do high-end application servers. If
        you need this feature, we recommend that you use EJB. However,
        consider carefully before using such a feature, because normally, one
        does not want transactions to span remote calls.</p></li></ul></div><div class="sidebar"><p class="title"><b>Where is
      <code class="classname">TransactionProxyFactoryBean</code>?</b></p><p>Declarative transaction configuration in versions of Spring 2.0
      and above differs considerably from previous versions of Spring. The
      main difference is that there is no longer any need to configure
      <code class="classname">TransactionProxyFactoryBean</code> beans.</p><p>The pre-Spring 2.0 configuration style is still 100% valid
      configuration; think of the new <code class="literal">&lt;tx:tags/&gt;</code> as
      simply defining <code class="classname">TransactionProxyFactoryBean</code> beans
      on your behalf.</p></div><p>The concept of rollback rules is important: they enable you to
    specify which exceptions (and throwables) should
    cause automatic rollback. You specify this declaratively, in
    configuration, not in Java code. So, although you can still call
    <code class="methodname">setRollbackOnly()</code>on the
    <code class="interfacename">TransactionStatus</code> object to roll back the
    current transaction back, most often you can specify a rule that
    <code class="exceptionname">MyApplicationException</code> must always result
    in rollback. The significant advantage to this option is that business
    objects do not depend on the transaction infrastructure. For example, they
    typically do not need to import Spring transaction APIs or other Spring
    APIs.</p><p>Although EJB container default behavior automatically rolls back the
    transaction on a <span class="emphasis"><em>system exception</em></span> (usually a runtime
    exception), EJB CMT does not roll back the transaction automatically on an
    <span class="emphasis"><em>application exception</em></span> (that is, a checked exception
    other than <code class="exceptionname">java.rmi.RemoteException</code>). While
    the Spring default behavior for declarative transaction management follows
    EJB convention (roll back is automatic only on unchecked exceptions), it
    is often useful to customize this behavior.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-decl-explained"></a>11.5.1&nbsp;Understanding the Spring Framework's declarative transaction
      implementation</h3></div></div></div><p>It is not sufficient to tell you simply to annotate your classes
      with the <code class="interfacename">@Transactional</code> annotation, add
      the line (<code class="literal">&lt;tx:annotation-driven/&gt;</code>) to your
      configuration, and then expect you to understand how it all works. This
      section explains the inner workings of the Spring Framework's
      declarative transaction infrastructure in the event of
      transaction-related issues.</p><p>The most important concepts to grasp with regard to the Spring
      Framework's declarative transaction support are that this support is
      enabled <a class="link" href="#aop-understanding-aop-proxies" title="8.6.1&nbsp;Understanding AOP proxies"><span class="emphasis"><em>via AOP
      proxies</em></span></a>, and that the transactional advice is driven
      by <span class="emphasis"><em>metadata</em></span> (currently XML- or annotation-based).
      The combination of AOP with transactional metadata yields an AOP proxy
      that uses a <code class="classname">TransactionInterceptor</code> in conjunction
      with an appropriate <code class="classname">PlatformTransactionManager</code>
      implementation to drive transactions <span class="emphasis"><em>around method
      invocations</em></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Spring AOP is covered in <a class="xref" href="#aop" title="8.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;8, <i>Aspect Oriented Programming with Spring</i></a>.</p></td></tr></table></div><p>Conceptually, calling a method on a transactional proxy looks like
      this...</p><div class="mediaobject" align="center"><img src="images/tx.png" align="middle"></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-first-example"></a>11.5.2&nbsp;Example of declarative transaction implementation</h3></div></div></div><p>Consider the following interface, and its attendant
      implementation. This example uses <code class="classname">Foo</code> and
      <code class="classname">Bar</code> classes as placeholders so that you can
      concentrate on the transaction usage without focusing on a particular
      domain model. For the purposes of this example, the fact that the
      <code class="classname">DefaultFooService</code> class throws
      <code class="exceptionname">UnsupportedOperationException</code> instances
      in the body of each implemented method is good; it allows you to see
      transactions created and then rolled back in response to the
      <code class="exceptionname">UnsupportedOperationException</code> instance.
      </p><pre class="programlisting"><span class="hl-comment">// the service interface that we want to make transactional</span>

<span class="hl-keyword">package</span> x.y.service;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FooService {

  Foo getFoo(String fooName);

  Foo getFoo(String fooName, String barName);

  <span class="hl-keyword">void</span> insertFoo(Foo foo);

  <span class="hl-keyword">void</span> updateFoo(Foo foo);

}</pre><pre class="programlisting"><span class="hl-comment">// an implementation of the above interface</span>

<span class="hl-keyword">package</span> x.y.service;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultFooService <span class="hl-keyword">implements</span> FooService {

  <span class="hl-keyword">public</span> Foo getFoo(String fooName) {
    <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> UnsupportedOperationException();
  }

  <span class="hl-keyword">public</span> Foo getFoo(String fooName, String barName) {
    <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> UnsupportedOperationException();
  }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertFoo(Foo foo) {
    <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> UnsupportedOperationException();
  }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> updateFoo(Foo foo) {
    <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> UnsupportedOperationException();
  }

}</pre><p>Assume that the first two methods of the
      <code class="interfacename">FooService</code> interface<code class="literal">,
      getFoo(String)</code> and <code class="literal">getFoo(String, String),
      </code>must execute in the context of a transaction with read-only
      semantics, and that the other methods<code class="literal">,insertFoo(Foo)</code>
      and <code class="literal">updateFoo(Foo),</code> must execute in the context of a
      transaction with read-write semantics. The following configuration is
      explained in detail in the next few paragraphs.</p><pre class="programlisting">&lt;<span class="hl-comment">!-- from the file 'context.xml' --</span>&gt;
&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
     <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
     http://www.springframework.org/schema/beans 
     http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
     http://www.springframework.org/schema/tx
     http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
     http://www.springframework.org/schema/aop 
     http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;
  
  &lt;<span class="hl-comment">!-- this is the service object that we want to make transactional --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span>/&gt;

  &lt;<span class="hl-comment">!-- the transactional advice (what 'happens'; see the &lt;aop:advisor/&gt; bean below) --</span>&gt;
  &lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span>&gt;
  &lt;<span class="hl-comment">!-- the transactional semantics... --</span>&gt;
  &lt;<span class="hl-tag">tx:attributes</span>&gt;
    &lt;<span class="hl-comment">!-- all methods starting with 'get' are read-only --</span>&gt;
    &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span>/&gt;
    &lt;<span class="hl-comment">!-- other methods use the default transaction settings (see below) --</span>&gt;
    &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span>/&gt;
  &lt;<span class="hl-tag">/tx:attributes</span>&gt;
  &lt;<span class="hl-tag">/tx:advice</span>&gt;
  
  &lt;<span class="hl-comment">!-- ensure that the above transactional advice runs for any execution
    of an operation defined by the FooService interface --</span>&gt;
  &lt;<span class="hl-tag">aop:config</span>&gt;
  &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooServiceOperation"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.FooService.*(..))"</span>/&gt;
  &lt;<span class="hl-tag">aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"fooServiceOperation"</span>/&gt;
  &lt;<span class="hl-tag">/aop:config</span>&gt;
  
  &lt;<span class="hl-comment">!-- don't forget the DataSource --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"oracle.jdbc.driver.OracleDriver"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc:oracle:thin:@rj-t42:1521:elvis"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"scott"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"tiger"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-comment">!-- similarly, don't forget the PlatformTransactionManager --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;
  
  &lt;<span class="hl-comment">!-- other &lt;bean/&gt; definitions here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Examine the preceding configuration. You want to make a service
      object, the <code class="literal">fooService</code> bean, transactional. The
      transaction semantics to apply are encapsulated in the
      <code class="literal">&lt;tx:advice/&gt;</code> definition. The
      <code class="literal">&lt;tx:advice/&gt;</code> definition reads as
      &#8220;<span class="quote"><span class="emphasis"><em>... all methods on starting with
      <code class="literal">'get'</code> are to execute in the context of a read-only
      transaction, and all other methods are to execute with the default
      transaction semantics</em></span></span>&#8221;. The
      <code class="literal">transaction-manager</code> attribute of the
      <code class="literal">&lt;tx:advice/&gt;</code> tag is set to the name of the
      <code class="interfacename">PlatformTransactionManager</code> bean that is
      going to <span class="emphasis"><em>drive</em></span> the transactions, in this case, the
      <code class="literal">txManager</code> bean.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You can omit the <code class="literal">transaction-manager</code>
        attribute in the transactional advice
        (<code class="literal">&lt;tx:advice/&gt;</code>) if the bean name of the
        <code class="interfacename">PlatformTransactionManager</code> that you
        want to wire in has the name <code class="literal">transactionManager</code>. If
        the <code class="interfacename">PlatformTransactionManager</code> bean
        that you want to wire in has any other name, then you must use the
        <code class="literal">transaction-manager</code> attribute explicitly, as in the
        preceding example.</p></td></tr></table></div><p>The <code class="literal">&lt;aop:config/&gt;</code> definition ensures that
      the transactional advice defined by the <code class="literal">txAdvice</code> bean
      executes at the appropriate points in the program. First you define a
      pointcut that matches the execution of any operation defined in the
      <code class="interfacename">FooService</code> interface
      (<code class="literal">fooServiceOperation</code>). Then you associate the
      pointcut with the <code class="literal">txAdvice</code> using an advisor. The
      result indicates that at the execution of a
      <code class="literal">fooServiceOperation</code>, the advice defined by
      <code class="literal">txAdvice</code> will be run.</p><p>The expression defined within the
      <code class="literal">&lt;aop:pointcut/&gt;</code> element is an AspectJ pointcut
      expression; see <a class="xref" href="#aop" title="8.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;8, <i>Aspect Oriented Programming with Spring</i></a> for more details on pointcut
      expressions in Spring 2.0.</p><p>A common requirement is to make an entire service layer
      transactional. The best way to do this is simply to change the pointcut
      expression to match any operation in your service layer. For
      example:</p><pre class="programlisting">&lt;<span class="hl-tag">aop:config</span>&gt;
  &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooServiceMethods"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.*.*(..))"</span>/&gt;
  &lt;<span class="hl-tag">aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"fooServiceMethods"</span>/&gt;
&lt;<span class="hl-tag">/aop:config</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><span class="emphasis"><em>In this example it is assumed that all your service
          interfaces are defined in the <code class="literal">x.y.service</code>
          package; see <a class="xref" href="#aop" title="8.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;8, <i>Aspect Oriented Programming with Spring</i></a> for more
          details.</em></span></p></td></tr></table></div><p>Now that we've analyzed the configuration, you may be asking
      yourself, &#8220;<span class="quote"><span class="emphasis"><em>Okay... but what does all this configuration
      actually do?</em></span></span>&#8221;.</p><p>The above configuration will be used to create a transactional
      proxy around the object that is created from the
      <code class="literal">fooService</code> bean definition. The
      proxy will be configured with the transactional advice, so that when an
      appropriate method is invoked <span class="emphasis"><em>on the proxy</em></span>, a
      transaction is started, suspended, marked as read-only, and so on,
      depending on the transaction configuration associated with that method.
      Consider the following program that test drives the above
      configuration:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Boot {

  <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) <span class="hl-keyword">throws</span> Exception {
    ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"context.xml"</span>, Boot.<span class="hl-keyword">class</span>);
    FooService fooService = (FooService) ctx.getBean(<span class="hl-string">"fooService"</span>);
    fooService.insertFoo (<span class="hl-keyword">new</span> Foo());
  }
}</pre><p>The output from running the preceding program will resemble the
      following. (The Log4J output and the stack trace from the
      UnsupportedOperationException thrown by the insertFoo(..) method of the
      DefaultFooService class have been truncated for clarity.)</p><pre class="programlisting">  &lt;<span class="hl-comment">!-- the Spring container is starting up... --</span>&gt;
[AspectJInvocationContextExposingAdvisorAutoProxyCreator] - Creating implicit proxy
    for bean 'fooService' with 0 common interceptors and 1 specific interceptors
  &lt;<span class="hl-comment">!-- the DefaultFooService is actually proxied --</span>&gt;
[JdkDynamicAopProxy] - Creating JDK dynamic proxy for [x.y.service.DefaultFooService]

  &lt;<span class="hl-comment">!-- ... the insertFoo(..) method is now being invoked on the proxy --</span>&gt;

[TransactionInterceptor] - Getting transaction for x.y.service.FooService.insertFoo
  &lt;<span class="hl-comment">!-- the transactional advice kicks in here... --</span>&gt;
[DataSourceTransactionManager] - Creating new transaction with name [x.y.service.FooService.insertFoo]
[DataSourceTransactionManager] - Acquired Connection
    [org.apache.commons.dbcp.PoolableConnection@a53de4] for JDBC transaction

  &lt;<span class="hl-comment">!-- the insertFoo(..) method from DefaultFooService throws an exception... --</span>&gt;
[RuleBasedTransactionAttribute] - Applying rules to determine whether transaction should
    rollback on java.lang.UnsupportedOperationException
[TransactionInterceptor] - Invoking rollback for transaction on x.y.service.FooService.insertFoo
    due to throwable [java.lang.UnsupportedOperationException]

   &lt;<span class="hl-comment">!-- and the transaction is rolled back (by default, RuntimeException instances cause rollback) --</span>&gt;
[DataSourceTransactionManager] - Rolling back JDBC transaction on Connection
    [org.apache.commons.dbcp.PoolableConnection@a53de4]
[DataSourceTransactionManager] - Releasing JDBC Connection after transaction
[DataSourceUtils] - Returning JDBC Connection to DataSource

Exception in thread "main" java.lang.UnsupportedOperationException
    at x.y.service.DefaultFooService.insertFoo(DefaultFooService.java:14)
   &lt;<span class="hl-comment">!-- AOP infrastructure stack trace elements removed for clarity --</span>&gt;
    at $Proxy0.insertFoo(Unknown Source)
    at Boot.main(Boot.java:11)</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-rolling-back"></a>11.5.3&nbsp;Rolling back a declarative transaction</h3></div></div></div><p>The previous section outlined the basics of how to specify
      transactional settings for classes, typically service layer classes,
      declaratively in your application. This section describes how you can
      control the rollback of transactions in a simple declarative
      fashion.</p><p>The recommended way to indicate to the Spring Framework's
      transaction infrastructure that a transaction's work is to be rolled
      back is to throw an <code class="exceptionname">Exception</code> from code
      that is currently executing in the context of a transaction. The Spring
      Framework's transaction infrastructure code will catch any unhandled
      <code class="exceptionname">Exception</code> as it bubbles up the call
      stack, and make a determination whether to mark the transaction for
      rollback.</p><p>In its default configuration, the Spring Framework's transaction
      infrastructure code <span class="emphasis"><em>only</em></span> marks a transaction for
      rollback in the case of runtime, unchecked exceptions; that is, when the
      thrown exception is an instance or subclass of
      <code class="exceptionname">RuntimeException</code>.
      (<code class="exceptionname">Error</code>s will also - by default - result
      in a rollback). Checked exceptions that are thrown from a transactional
      method do <span class="emphasis"><em>not</em></span> result in rollback in the default
      configuration.</p><p>You can configure exactly which
      <code class="exceptionname">Exception</code> types mark a transaction for
      rollback, including checked exceptions. The following XML snippet
      demonstrates how you configure rollback for a checked,
      application-specific <code class="exceptionname">Exception</code>
      type.</p><pre class="programlisting">&lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span>&gt;
  &lt;<span class="hl-tag">tx:attributes</span>&gt;
  &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">rollback-for</span>=<span class="hl-value">"NoProductInStockException"</span>/&gt;
  &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span>/&gt;
  &lt;<span class="hl-tag">/tx:attributes</span>&gt;
&lt;<span class="hl-tag">/tx:advice</span>&gt;</pre><p>You can also specify 'no rollback rules', if you do
      <span class="emphasis"><em>not</em></span> want a transaction rolled back when an
      exception is thrown. The following example tells the Spring Framework's
      transaction infrastructure to commit the attendant transaction even in
      the face of an unhandled
      <code class="exceptionname">InstrumentNotFoundException</code>.</p><pre class="programlisting">&lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span>&gt;
  &lt;<span class="hl-tag">tx:attributes</span>&gt;
  &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"updateStock"</span> <span class="hl-attribute">no-rollback-for</span>=<span class="hl-value">"InstrumentNotFoundException"</span>/&gt;
  &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span>/&gt;
  &lt;<span class="hl-tag">/tx:attributes</span>&gt;
&lt;<span class="hl-tag">/tx:advice</span>&gt;</pre><p>When the Spring Framework's transaction infrastructure catches an
      exception and is consults configured rollback rules to determine whether
      to mark the transaction for rollback, the <span class="emphasis"><em>strongest</em></span>
      matching rule wins. So in the case of the following configuration, any
      exception other than an
      <code class="exceptionname">InstrumentNotFoundException</code> results in a
      rollback of the attendant transaction.</p><pre class="programlisting">&lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span>&gt;
  &lt;<span class="hl-tag">tx:attributes</span>&gt;
  &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">rollback-for</span>=<span class="hl-value">"Throwable"</span> <span class="hl-attribute">no-rollback-for</span>=<span class="hl-value">"InstrumentNotFoundException"</span>/&gt;
  &lt;<span class="hl-tag">/tx:attributes</span>&gt;
&lt;<span class="hl-tag">/tx:advice</span>&gt;</pre><p>You can also indicate a required rollback
      <span class="emphasis"><em>programmatically</em></span>. Although very simple, this
      process is quite invasive, and tightly couples your code to the Spring
      Framework's transaction infrastructure:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> resolvePosition() {
  <span class="hl-keyword">try</span> {
    <span class="hl-comment">// some business logic...</span>
  } <span class="hl-keyword">catch</span> (NoProductInStockException ex) {
    <span class="hl-comment">// trigger rollback programmatically</span>
    TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
  }
}</pre><p>You are strongly encouraged to use the declarative approach to
      rollback if at all possible. Programmatic rollback is available should
      you absolutely need it, but its usage flies in the face of achieving a
      clean POJO-based architecture.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-diff-tx"></a>11.5.4&nbsp;Configuring different transactional semantics for different
      beans</h3></div></div></div><p>Consider the scenario where you have a number of service layer
      objects, and you want to apply a <span class="emphasis"><em>totally different</em></span>
      transactional configuration to each of them. You do this by defining
      distinct <code class="literal">&lt;aop:advisor/&gt;</code> elements with differing
      <code class="literal">pointcut</code> and <code class="literal">advice-ref</code> attribute
      values.</p><p>As a point of comparison, first assume that all of your service
      layer classes are defined in a root <code class="literal">x.y.service</code>
      package. To make all beans that are instances of classes defined in that
      package (or in subpackages) and that have names ending in
      <code class="literal">Service</code> have the default transactional configuration,
      you would write the following:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
  <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
  http://www.springframework.org/schema/beans 
  http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
  http://www.springframework.org/schema/tx 
  http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
  http://www.springframework.org/schema/aop 
  http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">aop:config</span>&gt;

    &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceOperation"</span>
          <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service..*Service.*(..))"</span>/&gt;

    &lt;<span class="hl-tag">aop:advisor</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"serviceOperation"</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span>/&gt;

  &lt;<span class="hl-tag">/aop:config</span>&gt;

  &lt;<span class="hl-comment">!-- these two beans will be transactional... --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span>/&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"barService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.extras.SimpleBarService"</span>/&gt;

  &lt;<span class="hl-comment">!-- ... and these two beans won't --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anotherService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.xyz.SomeService"</span>/&gt; &lt;<span class="hl-comment">!-- (not in the right package) --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"barManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.SimpleBarManager"</span>/&gt; &lt;<span class="hl-comment">!-- (doesn't end in 'Service') --</span>&gt;

  &lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span>&gt;
    &lt;<span class="hl-tag">tx:attributes</span>&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span>/&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span>/&gt;
    &lt;<span class="hl-tag">/tx:attributes</span>&gt;
  &lt;<span class="hl-tag">/tx:advice</span>&gt;

  &lt;<span class="hl-comment">!-- other transaction infrastructure beans such as a PlatformTransactionManager omitted... --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The following example shows how to configure two distinct beans
      with totally different transactional settings.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
  <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
  http://www.springframework.org/schema/beans 
  http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
  http://www.springframework.org/schema/tx 
  http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
  http://www.springframework.org/schema/aop 
  http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">aop:config</span>&gt;

    &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"defaultServiceOperation"</span>
          <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.*Service.*(..))"</span>/&gt;

    &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"noTxServiceOperation"</span>
          <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.ddl.DefaultDdlManager.*(..))"</span>/&gt;

    &lt;<span class="hl-tag">aop:advisor</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"defaultServiceOperation"</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"defaultTxAdvice"</span>/&gt;

    &lt;<span class="hl-tag">aop:advisor</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"noTxServiceOperation"</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"noTxAdvice"</span>/&gt;

  &lt;<span class="hl-tag">/aop:config</span>&gt;

  &lt;<span class="hl-comment">!-- this bean will be transactional (see the 'defaultServiceOperation' pointcut) --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span>/&gt;

  &lt;<span class="hl-comment">!-- this bean will also be transactional, but with totally different transactional settings --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anotherFooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.ddl.DefaultDdlManager"</span>/&gt;

  &lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"defaultTxAdvice"</span>&gt;
    &lt;<span class="hl-tag">tx:attributes</span>&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span>/&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span>/&gt;
    &lt;<span class="hl-tag">/tx:attributes</span>&gt;
  &lt;<span class="hl-tag">/tx:advice</span>&gt;

  &lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"noTxAdvice"</span>&gt;
    &lt;<span class="hl-tag">tx:attributes</span>&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"NEVER"</span>/&gt;
    &lt;<span class="hl-tag">/tx:attributes</span>&gt;
  &lt;<span class="hl-tag">/tx:advice</span>&gt;

  &lt;<span class="hl-comment">!-- other transaction infrastructure beans such as a PlatformTransactionManager omitted... --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-txadvice-settings"></a>11.5.5&nbsp;<code class="literal">&lt;tx:advice/&gt;</code> settings</h3></div></div></div><p>This section summarizes the various transactional settings that
      can be specified using the <code class="literal">&lt;tx:advice/&gt;</code> tag.
      The default <code class="literal">&lt;tx:advice/&gt;</code> settings are:</p><div class="itemizedlist"><ul type="disc"><li><p><a class="link" href="#tx-propagation" title="11.5.7&nbsp;Transaction propagation">Propagation setting</a> is
            <code class="literal">REQUIRED.</code></p></li><li><p>Isolation level is <code class="literal">DEFAULT.</code></p></li><li><p>Transaction is read/write.</p></li><li><p>Transaction timeout defaults to the default timeout of the
            underlying transaction system, or none if timeouts are not
            supported.</p></li><li><p>Any <code class="exceptionname">RuntimeException</code> triggers
            rollback, and any checked <code class="exceptionname">Exception</code>
            does not.</p></li></ul></div><p>You can change these default settings; the various attributes of
      the <code class="literal">&lt;tx:method/&gt;</code> tags that are nested within
      <code class="literal">&lt;tx:advice/&gt;</code> and
      <code class="literal">&lt;tx:attributes/&gt;</code> tags are summarized
      below:</p><div class="table"><a name="tx-method-settings"></a><p class="title"><b>Table&nbsp;11.1.&nbsp;<code class="literal">&lt;tx:method/&gt;</code> settings</b></p><div class="table-contents"><table summary="<tx:method/&gt; settings" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Required?</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Default</th><th style="border-bottom: 1.0pt solid ; ">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">name</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Yes</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">&nbsp;</td><td style="border-bottom: 1.0pt solid ; "><p>Method name(s) with which the transaction
                attributes are to be associated. The wildcard (*) character
                can be used to associate the same transaction attribute
                settings with a number of methods; for example,
                <code class="literal">get*</code>, <code class="literal">handle*</code>,<code class="literal">
                on*Event</code>, and so forth.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">propagation</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">No</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">REQUIRED</td><td style="border-bottom: 1.0pt solid ; ">Transaction propagation behavior.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">isolation</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">No</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">DEFAULT</td><td style="border-bottom: 1.0pt solid ; ">Transaction isolation level.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">timeout</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">No</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">-1</td><td style="border-bottom: 1.0pt solid ; ">Transaction timeout value (in seconds).</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">read-only</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">No</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">false</td><td style="border-bottom: 1.0pt solid ; ">Is this transaction read-only?</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">rollback-for</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">No</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">&nbsp;</td><td style="border-bottom: 1.0pt solid ; "><p><code class="literal">Exception(s)</code> that trigger
                rollback; comma-delimited. For example,
                <code class="literal">com.foo.MyBusinessException,ServletException.</code></p></td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="literal">no-rollback-for</code></td><td style="border-right: 1.0pt solid ; ">No</td><td style="border-right: 1.0pt solid ; ">&nbsp;</td><td style=""><p><code class="literal">Exception(s)</code> that do
                <span class="emphasis"><em>not</em></span> trigger rollback; comma-delimited.
                For example,
                <code class="literal">com.foo.MyBusinessException,ServletException.</code></p></td></tr></tbody></table></div></div><p><br class="table-break"></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-annotations"></a>11.5.6&nbsp;Using <code class="interfacename">@Transactional</code></h3></div></div></div><p>In addition to the XML-based declarative approach to transaction
      configuration, you can use an annotation-based approach. Declaring
      transaction semantics directly in the Java source code puts the
      declarations much closer to the affected code. There is not much danger
      of undue coupling, because code that is meant to be used transactionally
      is almost always deployed that way anyway.</p><p>The ease-of-use afforded by the use of the
      <code class="interfacename">@Transactional</code> annotation is best
      illustrated with an example, which is explained in the text that
      follows. Consider the following class definition:</p><pre class="programlisting"><span class="hl-comment">// the service class that we want to make transactional</span>
@Transactional
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultFooService <span class="hl-keyword">implements</span> FooService {

  Foo getFoo(String fooName);

  Foo getFoo(String fooName, String barName);

  <span class="hl-keyword">void</span> insertFoo(Foo foo);

  <span class="hl-keyword">void</span> updateFoo(Foo foo);
}</pre><p>When the above POJO is defined as a bean in a Spring IoC
      container, the bean instance can be made transactional by adding merely
      <span class="emphasis"><em>one</em></span> line of XML configuration:</p><pre class="programlisting">&lt;<span class="hl-comment">!-- from the file 'context.xml' --</span>&gt;
&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
     <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
     http://www.springframework.org/schema/beans 
     http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
     http://www.springframework.org/schema/tx 
     http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
     http://www.springframework.org/schema/aop 
     http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;
  
  &lt;<span class="hl-comment">!-- this is the service object that we want to make transactional --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span>/&gt;

  &lt;<span class="hl-comment">!-- enable the configuration of transactional behavior based on annotations --</span>&gt;
  &lt;<span class="hl-tag">tx:annotation-driven</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span>/&gt;

  &lt;<span class="hl-comment">!-- a PlatformTransactionManager is still required --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;
  &lt;<span class="hl-comment">!-- (this dependency is defined somewhere else) --</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;
  
  &lt;<span class="hl-comment">!-- other &lt;bean/&gt; definitions here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You can omit the <code class="literal">transaction-manager</code>
        attribute in the <code class="literal">&lt;tx:annotation-driven/&gt;</code> tag
        if the bean name of the
        <code class="interfacename">PlatformTransactionManager</code> that you
        want to wire in has the name <code class="literal">transactionManager</code>. If
        the <code class="interfacename">PlatformTransactionManager</code> bean
        that you want to dependency-inject has any other name, then you have
        to use the <code class="literal">transaction-manager</code> attribute
        explicitly, as in the preceding example.</p></td></tr></table></div><div class="sidebar"><p class="title"><b>Method visibility and
        <code class="interfacename">@Transactional</code></b></p><p>When using proxies, you should apply the
        <code class="interfacename">@Transactional</code> annotation only to
        methods with <span class="emphasis"><em>public</em></span> visibility. If you do
        annotate protected, private or package-visible methods with the
        <code class="interfacename">@Transactional</code> annotation, no error is
        raised, but the annotated method does not exhibit the configured
        transactional settings. Consider the use of AspectJ (see below) if you
        need to annotate non-public methods.</p></div><p>You can place the <code class="interfacename">@Transactional</code>
      annotation before an interface definition, a method on an interface, a
      class definition, or a <span class="emphasis"><em>public</em></span> method on a class.
      However, the mere presence of the
      <code class="interfacename">@Transactional</code> annotation is not enough
      to activate the transactional behavior. The
      <code class="interfacename">@Transactional</code> annotation is simply
      metadata that can be consumed by some runtime infrastructure that is
      <code class="interfacename">@Transactional</code>-aware and that can use the
      metadata to configure the appropriate beans with transactional behavior.
      In the preceding example, the
      <code class="literal">&lt;tx:annotation-driven/&gt;</code> element
      <span class="emphasis"><em>switches on</em></span> the transactional behavior.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Spring recommends that you only annotate concrete classes (and
          methods of concrete classes) with the
          <code class="interfacename">@Transactional</code> annotation, as opposed
          to annotating interfaces. You certainly can place the
          <code class="interfacename">@Transactional</code> annotation on an
          interface (or an interface method), but this works only as you would
          expect it to if you are using interface-based proxies. The fact that
          Java annotations are <span class="emphasis"><em>not inherited from interfaces</em></span>
          means that if you are using class-based proxies
          (<code class="literal">proxy-target-class="true"</code>) or the weaving-based
          aspect (<code class="literal">mode="aspectj"</code>), then the transaction
          settings are not recognized by the proxying and weaving
          infrastructure, and the object will not be wrapped in a
          transactional proxy, which would be decidedly
          <span class="emphasis"><em>bad</em></span>.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In proxy mode (which is the default), only external method calls
        coming in through the proxy are intercepted. This means that
        self-invocation, in effect, a method within the target object calling
        another method of the target object, will not lead to an actual
        transaction at runtime even if the invoked method is marked with
        <code class="interfacename">@Transactional</code>.</p></td></tr></table></div><p>Consider the use of AspectJ mode (see mode attribute in table
      below) if you expect self-invocations to be wrapped with transactions as
      well. In
      this case, there will not be a proxy in the first place; instead, the
      target class will be weaved (that is, its byte code will be modified) in
      order to turn <code class="interfacename">@Transactional</code> into runtime
      behavior on any kind of method.</p><div class="table"><a name="tx-annotation-driven-settings"></a><p class="title"><b>Table&nbsp;11.2.&nbsp;<code class="literal">&lt;tx:annotation-driven/&gt;</code>
          settings</b></p><div class="table-contents"><table summary="<tx:annotation-driven/&gt;&#xA;          settings" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Default</th><th style="border-bottom: 1.0pt solid ; ">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">transaction-manager</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">transactionManager</td><td style="border-bottom: 1.0pt solid ; "><p>Name of transaction manager to use. Only required
                if the name of the transaction manager is not
                <code class="literal">transactionManager</code>, as in the example
                above.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">mode</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">proxy</td><td style="border-bottom: 1.0pt solid ; "><p>The default mode "proxy" processes annotated
                beans to be proxied using Spring's AOP framework (following
                proxy semantics, as discussed above, applying to method calls
                coming in through the proxy only). The alternative mode
                "aspectj" instead weaves the affected classes with Spring's
                AspectJ transaction aspect, modifying the target class byte
                code to apply to any kind of method call. AspectJ weaving
                requires spring-aspects.jar in the classpath as well as
                load-time weaving (or compile-time weaving) enabled. (See
                <a class="xref" href="#aop-aj-ltw-spring" title="8.8.4.5&nbsp;Spring configuration">Section&nbsp;8.8.4.5, &#8220;Spring configuration&#8221;</a> for details on how to set
                up load-time weaving.)</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">proxy-target-class</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">false</td><td style="border-bottom: 1.0pt solid ; "><p>Applies to proxy mode only. Controls what type of
                transactional proxies are created for classes annotated with
                the <code class="interfacename">@Transactional</code> annotation.
                If the <code class="literal">proxy-target-class</code> attribute is set
                to <code class="literal">true</code>, then class-based proxies are
                created. If <code class="literal">proxy-target-class</code> is
                <code class="literal">false</code> or if the attribute is omitted, then
                standard JDK interface-based proxies are created. (See <a class="xref" href="#aop-proxying" title="8.6&nbsp;Proxying mechanisms">Section&nbsp;8.6, &#8220;Proxying mechanisms&#8221;</a> for a detailed examination of the
                different proxy types.)</p></td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="literal">order</code></td><td style="border-right: 1.0pt solid ; ">Ordered.LOWEST_PRECEDENCE</td><td style=""><p>Defines the order of the transaction advice that
                is applied to beans annotated with
                <code class="interfacename">@Transactional</code>. (For more
                information about the rules related to ordering of AOP advice,
                see <a class="xref" href="#aop-ataspectj-advice-ordering" title="8.2.4.7&nbsp;Advice ordering">Section&nbsp;8.2.4.7, &#8220;Advice ordering&#8221;</a>.) No
                specified ordering means that the AOP subsystem determines the
                order of the advice.</p></td></tr></tbody></table></div></div><p><br class="table-break"></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">proxy-target-class</code> attribute on the
        <code class="literal">&lt;tx:annotation-driven/&gt;</code> element controls what
        type of transactional proxies are created for classes annotated with
        the <code class="interfacename">@Transactional</code> annotation. If
        <code class="literal">proxy-target-class</code> attribute is set to
        <code class="literal">true</code>, class-based proxies are created. If
        <code class="literal">proxy-target-class</code> is <code class="literal">false</code> or
        if the attribute is omitted, standard JDK interface-based proxies are
        created. (See <a class="xref" href="#aop-proxying" title="8.6&nbsp;Proxying mechanisms">Section&nbsp;8.6, &#8220;Proxying mechanisms&#8221;</a> for a discussion of the
        different proxy types.)</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">&lt;tx:annotation-driven/&gt;</code> only looks for
        <code class="interfacename">@Transactional</code> on beans in the same
        application context it is defined in. This means that, if you put
        <code class="literal">&lt;tx:annotation-driven/&gt;</code> in a
        <code class="interfacename">WebApplicationContext</code> for a
        <code class="classname">DispatcherServlet</code>, it only checks for
        <code class="interfacename">@Transactional</code> beans in your
        controllers, and not your services. See <a class="xref" href="#mvc-servlet" title="16.2&nbsp;The DispatcherServlet">Section&nbsp;16.2, &#8220;The DispatcherServlet&#8221;</a> for more information.</p></td></tr></table></div><p>The most derived location takes precedence when evaluating the
      transactional settings for a method. In
      the case of the following example, the
      <code class="classname">DefaultFooService</code> class is annotated at the class
      level with the settings for a read-only transaction, but the
      <code class="interfacename">@Transactional</code> annotation on the
      <code class="methodname">updateFoo(Foo)</code> method in the same class takes
      precedence over the transactional settings defined at the class
      level.</p><pre class="programlisting">@Transactional(readOnly = true)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultFooService <span class="hl-keyword">implements</span> FooService {

  <span class="hl-keyword">public</span> Foo getFoo(String fooName) {
    <span class="hl-comment">// do something</span>
  }

  <span class="hl-comment">// these settings have precedence for this method</span>
  @Transactional(readOnly = false, propagation = Propagation.REQUIRES_NEW)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> updateFoo(Foo foo) {
    <span class="hl-comment">// do something</span>
  }
}</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="transaction-declarative-attransactional-settings"></a>11.5.6.1&nbsp;<code class="interfacename">@Transactional</code> settings</h4></div></div></div><p>The <code class="interfacename">@Transactional</code> annotation is
        metadata that specifies that an interface, class, or method must have
        transactional semantics; for example, &#8220;<span class="quote"><span class="emphasis"><em>start a brand
        new read-only transaction when this method is invoked, suspending any
        existing transaction</em></span></span>&#8221;. The default
        <code class="interfacename">@Transactional</code> settings are as
        follows:</p><div class="itemizedlist"><ul type="disc"><li><p>Propagation setting is
            <code class="literal">PROPAGATION_REQUIRED.</code></p></li><li><p>Isolation level is
            <code class="literal">ISOLATION_DEFAULT.</code></p></li><li><p>Transaction is read/write.</p></li><li><p>Transaction timeout defaults to the default timeout of the
            underlying transaction system, or to none if timeouts are not
            supported.</p></li><li><p>Any <code class="exceptionname">RuntimeException</code> triggers
            rollback, and any checked <code class="exceptionname">Exception</code>
            does not.</p></li></ul></div><p>These default settings can be changed; the various properties of
        the <code class="interfacename">@Transactional</code> annotation are
        summarized in the following table:</p><div class="table"><a name="tx-attransactional-properties"></a><p class="title"><b>Table&nbsp;11.3.&nbsp;<code class="interfacename">@Transactional</code>
            properties</b></p><div class="table-contents"><table summary="@Transactional&#xA;            properties" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Property</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Type</th><th style="border-bottom: 1.0pt solid ; ">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal"><a class="link" href="#tx-multiple-tx-mgrs-with-attransactional" title="11.5.6.2&nbsp;Multiple Transaction Managers with @Transactional">value</a></code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">String</td><td style="border-bottom: 1.0pt solid ; ">
                    Optional qualifier specifying the transaction manager to be used.
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal"><a class="link" href="#tx-propagation" title="11.5.7&nbsp;Transaction propagation">propagation</a></code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">enum: <code class="classname">Propagation</code></td><td style="border-bottom: 1.0pt solid ; ">Optional propagation setting.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">isolation</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">enum: <code class="classname">Isolation</code></td><td style="border-bottom: 1.0pt solid ; ">Optional isolation level.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">readOnly</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">boolean</td><td style="border-bottom: 1.0pt solid ; ">Read/write vs. read-only transaction</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">timeout</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">int (in seconds granularity)</td><td style="border-bottom: 1.0pt solid ; ">Transaction timeout.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">rollbackFor</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Array of <code class="classname">Class</code> objects, which
                  must be derived from
                  <code class="classname">Throwable.</code></td><td style="border-bottom: 1.0pt solid ; ">Optional array of exception classes that <span class="bold"><strong>must</strong></span> cause rollback.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">rollbackForClassname</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Array of class names. Classes must be derived from
                  <code class="classname">Throwable.</code></td><td style="border-bottom: 1.0pt solid ; ">Optional array of names of exception classes that
                  <span class="bold"><strong>must</strong></span> cause
                  rollback.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">noRollbackFor</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Array of <code class="classname">Class</code> objects, which
                  must be derived from
                  <code class="classname">Throwable.</code></td><td style="border-bottom: 1.0pt solid ; ">Optional array of exception classes that <span class="bold"><strong>must not</strong></span> cause rollback.</td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="literal">noRollbackForClassname</code></td><td style="border-right: 1.0pt solid ; ">Array of <code class="classname">String</code> class names,
                  which must be derived from
                  <code class="classname">Throwable.</code></td><td style="">Optional array of names of exception classes that
                  <span class="bold"><strong>must not</strong></span> cause
                  rollback.</td></tr></tbody></table></div></div><p><br class="table-break"></p><p>Currently you cannot have explicit control over the name of a
        transaction, where 'name' means the transaction name that will be
        shown in a transaction monitor, if applicable (for example, WebLogic's
        transaction monitor), and in logging output. For declarative
        transactions, the transaction name is always the fully-qualified class
        name + "." + method
        name of the transactionally-advised class. For example, if the
        <code class="methodname">handlePayment(..)</code> method of the
        <code class="classname">BusinessService</code> class started a transaction,
        the name of the transaction would be:
        <code class="literal">com.foo.BusinessService.handlePayment</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tx-multiple-tx-mgrs-with-attransactional"></a>11.5.6.2&nbsp;Multiple Transaction Managers with <code class="interfacename">@Transactional</code></h4></div></div></div><p>
          Most Spring applications only need a single transaction manager, but there may be situations
          where you want multiple independent transaction managers in a single application.
          The value attribute of the <code class="interfacename">@Transactional</code> annotation can
          be used to optionally specify the identity of the <code class="classname">PlatformTransactionManager</code>
          to be used. This can either be the bean name or the qualifier value of the transaction manager bean.
          For example, using the qualifier notation, the following Java code 
</p><pre class="programlisting">
  <span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransactionalService {
  
    @Transactional(<span class="hl-string">"order"</span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSomething(String name) { ... }
  
    @Transactional(<span class="hl-string">"account"</span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() { ... }
  }
</pre><p>          
          could be combined with the following transaction manager bean declarations in the application context.
</p><pre class="programlisting">
  &lt;<span class="hl-tag">tx:annotation-driven</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionManager1"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.DataSourceTransactionManager"</span>&gt;
    ...
    &lt;<span class="hl-tag">qualifier</span> <span class="hl-attribute">value</span>=<span class="hl-value">"order"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionManager2"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.DataSourceTransactionManager"</span>&gt;
    ...
    &lt;<span class="hl-tag">qualifier</span> <span class="hl-attribute">value</span>=<span class="hl-value">"account"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;  

</pre><p>  
          In this case, the two methods on <code class="literal">TransactionalService</code> will run under separate 
          transaction managers, differentiated by the "order" and "account" qualifiers.          
          The default <code class="literal">&lt;tx:annotation-driven&gt;</code> target bean name <code class="literal">transactionManager</code> will 
          still be used if no specifically qualified PlatformTransactionManager bean is found.          
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tx-custom-attributes"></a>11.5.6.3&nbsp;Custom shortcut annotations</h4></div></div></div><p>
          If you find you are repeatedly using the same attributes with <code class="interfacename">@Transactional</code>
          on many different methods, then Spring's meta-annotation support allows you to define custom shortcut
          annotations for your specific use cases. For example, defining the following annotations
</p><pre class="programlisting">
  @Target({ElementType.METHOD, ElementType.TYPE})
  @Retention(RetentionPolicy.RUNTIME)
  @Transactional(<span class="hl-string">"order"</span>)
  <span class="hl-keyword">public</span> @<span class="hl-keyword">interface</span> OrderTx {
  }
  
  @Target({ElementType.METHOD, ElementType.TYPE})
  @Retention(RetentionPolicy.RUNTIME)
  @Transactional(<span class="hl-string">"account"</span>)
  <span class="hl-keyword">public</span> @<span class="hl-keyword">interface</span> AccountTx {
  }  
</pre><p>
          allows us to write the example from the previous section as
</p><pre class="programlisting">
  <span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransactionalService {
  
    @OrderTx
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSomething(String name) { ... }
  
    @AccountTx
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() { ... }
  }
</pre><p>          
          Here we have used the syntax to define the transaction manager qualifier, but could also have 
          included propagation behavior, rollback rules, timeouts etc.
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-propagation"></a>11.5.7&nbsp;Transaction propagation</h3></div></div></div><p>This section describes some semantics of transaction propagation
      in Spring. Please note that this section is not an introduction to
      transaction propagation proper; rather it details some of the semantics
      regarding transaction propagation in Spring.</p><p>In Spring-managed transactions, be aware of the difference between
      <span class="emphasis"><em>physical</em></span> and <span class="emphasis"><em>logical</em></span>
      transactions, and how the propagation setting applies to this
      difference.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tx-propagation-required"></a>11.5.7.1&nbsp;Required</h4></div></div></div><div class="mediaobject" align="center"><img src="images/tx_prop_required.png" align="middle"><div class="caption"><p>PROPAGATION_REQUIRED</p></div></div><p>When the propagation setting is
        <code class="literal">PROPAGATION_REQUIRED</code>, a
        <span class="emphasis"><em>logical</em></span> transaction scope is created for each
        method upon which the setting is applied. Each such logical
        transaction scope can determine rollback-only status individually,
        with an outer transaction scope being logically independent from the
        inner transaction scope. Of course, in case of standard
        <code class="literal">PROPAGATION_REQUIRED</code> behavior, all these scopes
        will be mapped to the same physical transaction. So a rollback-only
        marker set in the inner transaction scope does affect the outer
        transaction's chance to actually commit (as you would expect it
        to).</p><p>However, in the case where an inner transaction scope sets the
        rollback-only marker, the outer transaction has not decided on the
        rollback itself, and so the rollback (silently triggered by the inner
        transaction scope) is unexpected. A corresponding
        <code class="classname">UnexpectedRollbackException</code> is thrown at that
        point. This is <span class="emphasis"><em>expected behavior</em></span> so that the
        caller of a transaction can never be misled to assume that a commit
        was performed when it really was not. So if an inner transaction (of
        which the outer caller is not aware) silently marks a transaction as
        rollback-only, the outer caller still calls commit. The outer caller
        needs to receive an <code class="classname">UnexpectedRollbackException</code>
        to indicate clearly that a rollback was performed instead.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tx-propagation-requires_new"></a>11.5.7.2&nbsp;RequiresNew</h4></div></div></div><div class="mediaobject" align="center"><img src="images/tx_prop_requires_new.png" align="middle"><div class="caption"><p>PROPAGATION_REQUIRES_NEW</p></div></div><p><code class="literal">PROPAGATION_REQUIRES_NEW</code>, in contrast to
        <span class="type">PROPAGATION_REQUIRED</span>, uses a
        <span class="emphasis"><em>completely</em></span> independent transaction for each
        affected transaction scope. In that case, the underlying physical
        transactions are different and hence can commit or roll back
        independently, with an outer transaction not affected by an inner
        transaction's rollback status.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tx-propagation-nested"></a>11.5.7.3&nbsp;Nested</h4></div></div></div><p><code class="literal">PROPAGATION_NESTED</code> uses a
        <span class="emphasis"><em>single</em></span> physical transaction with multiple
        savepoints that it can roll back to. Such partial rollbacks allow an
        inner transaction scope to trigger a rollback <span class="emphasis"><em>for its
        scope</em></span>, with the outer transaction being able to continue
        the physical transaction despite some operations having been rolled
        back. This setting is typically mapped onto JDBC savepoints, so will
        only work with JDBC resource transactions. See Spring's
        <code class="classname">DataSourceTransactionManager</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-applying-more-than-just-tx-advice"></a>11.5.8&nbsp;Advising transactional operations</h3></div></div></div><p>Suppose you want to execute <span class="emphasis"><em>both</em></span>
      transactional <span class="emphasis"><em>and</em></span> some basic profiling advice. How
      do you effect this in the context of
      <code class="literal">&lt;tx:annotation-driven/&gt;</code>?</p><p>When you invoke the <code class="methodname">updateFoo(Foo)</code>
      method, you want to see the following actions:</p><div class="orderedlist"><ol type="1"><li><p>Configured profiling aspect starts up.</p></li><li><p>Transactional advice executes.</p></li><li><p>Method on the advised object executes.</p></li><li><p>Transaction commits.</p></li><li><p>Profiling aspect reports exact duration of the whole
          transactional method invocation.</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>This chapter is not concerned with explaining AOP in any great
        detail (except as it applies to transactions). See <a class="xref" href="#aop" title="8.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;8, <i>Aspect Oriented Programming with Spring</i></a> for detailed coverage of the following AOP
        configuration and AOP in general.</p></td></tr></table></div><p>Here is the code for a simple profiling aspect discussed above.
      The
      ordering of advice is controlled through the
      <code class="interfacename">Ordered</code> interface. For full details on
      advice ordering, see <a class="xref" href="#aop-ataspectj-advice-ordering" title="8.2.4.7&nbsp;Advice ordering">Section&nbsp;8.2.4.7, &#8220;Advice ordering&#8221;</a>.</p><pre class="programlisting"><span class="hl-keyword">package</span> x.y;

<span class="hl-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;
<span class="hl-keyword">import</span> org.springframework.util.StopWatch;
<span class="hl-keyword">import</span> org.springframework.core.Ordered;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleProfiler <span class="hl-keyword">implements</span> Ordered {

  <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> order;

  <span class="hl-comment">// allows us to control the ordering of advice</span>
  <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getOrder() {
    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.order;
  }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setOrder(<span class="hl-keyword">int</span> order) {
    <span class="hl-keyword">this</span>.order = order;
  }

  <span class="hl-comment">// this method is the around advice</span>
  <span class="hl-keyword">public</span> Object profile(ProceedingJoinPoint call) <span class="hl-keyword">throws</span> Throwable {
    Object returnValue;
    StopWatch clock = <span class="hl-keyword">new</span> StopWatch(getClass().getName());
    <span class="hl-keyword">try</span> {
      clock.start(call.toShortString());
      returnValue = call.proceed();
    } <span class="hl-keyword">finally</span> {
      clock.stop();
      System.out.println(clock.prettyPrint());
    }
    <span class="hl-keyword">return</span> returnValue;
  }
}
</pre><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
     <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
   http://www.springframework.org/schema/beans 
   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
   http://www.springframework.org/schema/tx 
   http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
   http://www.springframework.org/schema/aop 
   http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span>/&gt;

  &lt;<span class="hl-comment">!-- this is the aspect --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profiler"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.SimpleProfiler"</span>&gt;
    &lt;<span class="hl-comment">!-- execute before the transactional advice (hence the lower order number) --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"order"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">tx:annotation-driven</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">order</span>=<span class="hl-value">"200"</span>/&gt;

  &lt;<span class="hl-tag">aop:config</span>&gt;
    &lt;<span class="hl-comment">!-- this advice will execute around the transactional advice --</span>&gt;
    &lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profilingAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"profiler"</span>&gt;
      &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceMethodWithReturnValue"</span>
              <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(!void x.y..*Service.*(..))"</span>/&gt;
      &lt;<span class="hl-tag">aop:around</span> <span class="hl-attribute">method</span>=<span class="hl-value">"profile"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"serviceMethodWithReturnValue"</span>/&gt;
    &lt;<span class="hl-tag">/aop:aspect</span>&gt;
  &lt;<span class="hl-tag">/aop:config</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"oracle.jdbc.driver.OracleDriver"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc:oracle:thin:@rj-t42:1521:elvis"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"scott"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"tiger"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The result of the above configuration is a
      <code class="literal">fooService</code> bean that has profiling and transactional
      aspects applied to it <span class="emphasis"><em>in the desired order</em></span>. You
      configure any number of additional aspects in similar fashion.</p><p>The following example effects the same setup as above, but uses
      the purely XML declarative approach.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
     <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
   http://www.springframework.org/schema/beans 
   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
   http://www.springframework.org/schema/tx 
   http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
   http://www.springframework.org/schema/aop 
   http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span>/&gt;

  &lt;<span class="hl-comment">!-- the profiling advice --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profiler"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.SimpleProfiler"</span>&gt;
    &lt;<span class="hl-comment">!-- execute before the transactional advice (hence the lower order number) --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"order"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">aop:config</span>&gt;

    &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"entryPointMethod"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y..*Service.*(..))"</span>/&gt;

    &lt;<span class="hl-comment">!-- will execute after the profiling advice (c.f. the order attribute) --</span>&gt;
    &lt;<span class="hl-tag">aop:advisor</span>
        <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"entryPointMethod"</span>
        <span class="hl-attribute">order</span>=<span class="hl-value">"2"</span>/&gt; &lt;<span class="hl-comment">!-- order value is higher than the profiling aspect --</span>&gt;

    &lt;<span class="hl-tag">aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profilingAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"profiler"</span>&gt;
      &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceMethodWithReturnValue"</span>
              <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(!void x.y..*Service.*(..))"</span>/&gt;
      &lt;<span class="hl-tag">aop:around</span> <span class="hl-attribute">method</span>=<span class="hl-value">"profile"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"serviceMethodWithReturnValue"</span>/&gt;
    &lt;<span class="hl-tag">/aop:aspect</span>&gt;

  &lt;<span class="hl-tag">/aop:config</span>&gt;

  &lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span>&gt;
    &lt;<span class="hl-tag">tx:attributes</span>&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span>/&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span>/&gt;
    &lt;<span class="hl-tag">/tx:attributes</span>&gt;
  &lt;<span class="hl-tag">/tx:advice</span>&gt;

  &lt;<span class="hl-comment">!-- other &lt;bean/&gt; definitions such as a DataSource and a PlatformTransactionManager here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The result of the above configuration will be a
      <code class="literal">fooService</code> bean that has profiling and transactional
      aspects applied to it <span class="emphasis"><em>in that order</em></span>. If you want
      the profiling advice to execute <span class="emphasis"><em>after</em></span> the
      transactional advice on the way in, and <span class="emphasis"><em>before</em></span> the
      transactional advice on the way out, then you simply swap the value of
      the profiling aspect bean's <code class="literal">order</code> property so that it
      is higher than the transactional advice's order value.</p><p>You configure additional aspects in similar fashion.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-aspectj"></a>11.5.9&nbsp;Using <code class="interfacename">@Transactional</code> with
      AspectJ</h3></div></div></div><p>It is also possible to use the Spring Framework's
      <code class="interfacename">@Transactional</code> support outside of a
      Spring container by means of an AspectJ aspect. To do so, you first
      annotate your classes (and optionally your classes' methods) with the
      <code class="interfacename">@Transactional</code> annotation, and then you
      link (weave) your application with the
      <code class="classname">org.springframework.transaction.aspectj.AnnotationTransactionAspect</code>
      defined in the <code class="filename">spring-aspects.jar</code> file. The aspect must
      also be configured with a transaction manager. You can of course use the
      Spring Framework's IoC container to take care of dependency-injecting
      the aspect. The simplest way to configure the transaction management
      aspect is to use the <code class="literal">&lt;tx:annotation-driven/&gt;</code>
      element and specify the <code class="literal">mode</code> attribute to
      <code class="literal">aspectj</code> as described in <a class="xref" href="#transaction-declarative-annotations" title="11.5.6&nbsp;Using @Transactional">Section&nbsp;11.5.6, &#8220;Using @Transactional&#8221;</a>. Because we're focusing
      here on applications running outside of a Spring container, we'll show
      you how to do it programmatically.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Prior to continuing, you may want to read <a class="xref" href="#transaction-declarative-annotations" title="11.5.6&nbsp;Using @Transactional">Section&nbsp;11.5.6, &#8220;Using @Transactional&#8221;</a> and <a class="xref" href="#aop" title="8.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;8, <i>Aspect Oriented Programming with Spring</i></a> respectively.</p></td></tr></table></div><pre class="programlisting"><span class="hl-comment">// construct an appropriate transaction manager </span>
DataSourceTransactionManager txManager = <span class="hl-keyword">new</span> DataSourceTransactionManager(getDataSource());

<span class="hl-comment">// configure the AnnotationTransactionAspect to use it; this must be done before executing any transactional methods</span>
AnnotationTransactionAspect.aspectOf().setTransactionManager(txManager); </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>When using this aspect, you must annotate the
        <span class="emphasis"><em>implementation</em></span> class (and/or methods within that
        class), <span class="emphasis"><em>not</em></span> the interface (if any) that the class
        implements. AspectJ follows Java's rule that annotations on interfaces
        are <span class="emphasis"><em>not inherited</em></span>.</p></td></tr></table></div><p>The <code class="interfacename">@Transactional</code> annotation on a
      class specifies the default transaction semantics for the execution of
      any method in the class.</p><p>The <code class="interfacename">@Transactional</code> annotation on a
      method within the class overrides the default transaction semantics
      given by the class annotation (if present). Any method may be annotated,
      regardless of visibility.</p><p>To weave your applications with the
      <code class="classname">AnnotationTransactionAspect</code> you must either build
      your application with AspectJ (see the <a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/devguide/index.html" target="_top">AspectJ
      Development Guide</a>) or use load-time weaving. See <a class="xref" href="#aop-aj-ltw" title="8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;8.8.4, &#8220;Load-time weaving with AspectJ in the Spring Framework&#8221;</a> for a discussion of load-time weaving with
      AspectJ.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-programmatic"></a>11.6&nbsp;Programmatic transaction management</h2></div></div></div><p>The Spring Framework provides two means of programmatic transaction
    management:</p><div class="itemizedlist"><ul type="disc"><li><p>Using the <code class="classname">TransactionTemplate</code>.</p></li><li><p>Using a
        <code class="interfacename">PlatformTransactionManager</code>
        implementation directly.</p></li></ul></div><p>The Spring team generally recommends the
    <code class="classname">TransactionTemplate</code> for programmatic transaction
    management. The second approach is similar to using the JTA
    <code class="interfacename">UserTransaction</code> API, although exception
    handling is less cumbersome.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-prog-template"></a>11.6.1&nbsp;Using the <code class="classname">TransactionTemplate</code></h3></div></div></div><p>The <code class="classname">TransactionTemplate</code> adopts the same
      approach as other Spring <span class="emphasis"><em>templates</em></span> such as the
      <code class="classname">JdbcTemplate</code>. It uses a callback approach, to
      free application code from having to do the boilerplate acquisition and
      release of transactional resources, and results in code that is
      intention driven, in that the code that is written focuses solely on
      what the developer wants to do.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>As you will see in the examples that follow, using the
        <code class="classname">TransactionTemplate</code> absolutely couples you to
        Spring's transaction infrastructure and APIs. Whether or not
        programmatic transaction management is suitable for your development
        needs is a decision that you will have to make yourself.</p></td></tr></table></div><p>Application code that must execute in a transactional context, and
      that will use the <code class="classname">TransactionTemplate</code> explicitly,
      looks like the following. You, as an application developer, write a
      <code class="interfacename">TransactionCallback</code> implementation
      (typically expressed as an anonymous inner class) that contains the code
      that you need to execute in the context of a transaction. You then pass
      an instance of your custom
      <code class="interfacename">TransactionCallback</code> to the
      <code class="methodname">execute(..)</code> method exposed on the
      <code class="classname">TransactionTemplate</code>.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleService <span class="hl-keyword">implements</span> Service {

  <span class="hl-comment">// single TransactionTemplate shared amongst all methods in this instance</span>
  <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> TransactionTemplate transactionTemplate;

  <span class="hl-comment">// use constructor-injection to supply the PlatformTransactionManager</span>
  <span class="hl-keyword">public</span> SimpleService(PlatformTransactionManager transactionManager) {
    Assert.notNull(transactionManager, <span class="hl-string">"The 'transactionManager' argument must not be null."</span>);
    <span class="hl-keyword">this</span>.transactionTemplate = <span class="hl-keyword">new</span> TransactionTemplate(transactionManager);
  }

  <span class="hl-keyword">public</span> Object someServiceMethod() {
    <span class="hl-keyword">return</span> transactionTemplate.execute(<span class="hl-keyword">new</span> TransactionCallback() {

      <span class="hl-comment">// the code in this method executes in a transactional context</span>
      <span class="hl-keyword">public</span> Object doInTransaction(TransactionStatus status) {
        updateOperation1();
        <span class="hl-keyword">return</span> resultOfUpdateOperation2();
      }
    });
  }
}</pre><p>If there is no return value, use the convenient
      <code class="classname">TransactionCallbackWithoutResult</code> class with an
      anonymous class as follows:</p><pre class="programlisting">transactionTemplate.execute(<span class="hl-keyword">new</span> TransactionCallbackWithoutResult() {

  <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> doInTransactionWithoutResult(TransactionStatus status) {
    updateOperation1();
    updateOperation2();
  }
});</pre><p>Code within the callback can roll the transaction back by calling
      the <code class="literal">setRollbackOnly()</code> method on the supplied
      <code class="interfacename">TransactionStatus</code> object:</p><pre class="programlisting">transactionTemplate.execute(<span class="hl-keyword">new</span> TransactionCallbackWithoutResult() {

  <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> doInTransactionWithoutResult(TransactionStatus status) {
    <span class="hl-keyword">try</span> {
      updateOperation1();
      updateOperation2();
    } <span class="hl-keyword">catch</span> (SomeBusinessExeption ex) {
      status.setRollbackOnly();
    }
  }
});</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tx-prog-template-settings"></a>11.6.1.1&nbsp;Specifying transaction settings</h4></div></div></div><p>You can specify transaction settings such as the propagation
        mode, the isolation level, the timeout, and so forth on the
        <code class="classname">TransactionTemplate</code> either programmatically or
        in configuration. <code class="classname">TransactionTemplate</code> instances
        by default have the <a class="link" href="#transaction-declarative-txadvice-settings" title="11.5.5&nbsp;<tx:advice/&gt; settings">default
        transactional settings</a>. The following example shows the
        programmatic customization of the transactional settings for a
        specific <code class="classname">TransactionTemplate:</code></p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleService <span class="hl-keyword">implements</span> Service {

  <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> TransactionTemplate transactionTemplate;

  <span class="hl-keyword">public</span> SimpleService(PlatformTransactionManager transactionManager) {
    Assert.notNull(transactionManager, <span class="hl-string">"The 'transactionManager' argument must not be null."</span>);
    <span class="hl-keyword">this</span>.transactionTemplate = <span class="hl-keyword">new</span> TransactionTemplate(transactionManager);

    <span class="hl-comment">// the transaction settings can be set here explicitly if so desired</span>
    <span class="hl-keyword">this</span>.transactionTemplate.setIsolationLevel(TransactionDefinition.ISOLATION_READ_UNCOMMITTED);
    <span class="hl-keyword">this</span>.transactionTemplate.setTimeout(30); <span class="hl-comment">// 30 seconds</span>
    <span class="hl-comment">// and so forth...</span>
  }
}</pre><p>The following example defines a
        <code class="classname">TransactionTemplate</code> with some custom
        transactional settings, using Spring XML configuration. The
        <code class="literal">sharedTransactionTemplate</code> can then be injected into
        as many services as are required.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sharedTransactionTemplate"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.support.TransactionTemplate"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"isolationLevelName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"ISOLATION_READ_UNCOMMITTED"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"timeout"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"30"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;"</pre></div><p>Finally, instances of the
      <code class="classname">TransactionTemplate</code> class are threadsafe, in that
      instances do not maintain any conversational state.
      <code class="classname">TransactionTemplate</code> instances
      <span class="emphasis"><em>do</em></span> however maintain configuration state, so while a
      number of classes may share a single instance of a
      <code class="classname">TransactionTemplate</code>, if a class needs to use a
      <code class="classname">TransactionTemplate</code> with different settings (for
      example, a different isolation level), then you need to create two
      distinct <code class="classname">TransactionTemplate</code> instances.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-programmatic-ptm"></a>11.6.2&nbsp;Using the
      <code class="interfacename">PlatformTransactionManager</code></h3></div></div></div><p>You can also use the
      <code class="interfacename">org.springframework.transaction.PlatformTransactionManager</code>
      directly to manage your transaction. Simply pass the implementation of
      the <code class="interfacename">PlatformTransactionManager</code> you are
      using to your bean through a bean reference. Then, using the
      <code class="interfacename">TransactionDefinition</code> and
      <code class="interfacename">TransactionStatus</code> objects you can
      initiate transactions, roll back, and commit.</p><pre class="programlisting">DefaultTransactionDefinition def = <span class="hl-keyword">new</span> DefaultTransactionDefinition();
<span class="hl-comment">// explicitly setting the transaction name is something that can only be done programmatically</span>
def.setName(<span class="hl-string">"SomeTxName"</span>);
def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);

TransactionStatus status = txManager.getTransaction(def);
<span class="hl-keyword">try</span> {
  <span class="hl-comment">// execute your business logic here</span>
}
<span class="hl-keyword">catch</span> (MyException ex) {
  txManager.rollback(status);
  <span class="hl-keyword">throw</span> ex;
}
txManager.commit(status);</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tx-decl-vs-prog"></a>11.7&nbsp;Choosing between programmatic and declarative transaction
    management</h2></div></div></div><p>Programmatic transaction management is usually a good idea only if
    you have a small number of transactional operations. For example, if you
    have a web application that require transactions only for certain update
    operations, you may not want to set up transactional proxies using Spring
    or any other technology. In this case, using the
    <code class="classname">TransactionTemplate</code> <span class="emphasis"><em>may</em></span> be a
    good approach. Being able to set the transaction name explicitly is also
    something that can only be done using the programmatic approach to
    transaction management.</p><p>On the other hand, if your application has numerous transactional
    operations, declarative transaction management is usually worthwhile. It
    keeps transaction management out of business logic, and is not difficult
    to configure. When using the Spring Framework, rather than EJB CMT, the
    configuration cost of declarative transaction management is greatly
    reduced.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-application-server-integration"></a>11.8&nbsp;Application server-specific integration</h2></div></div></div><p>Spring's transaction abstraction generally is application server
    agnostic. Additionally, Spring's
    <code class="classname">JtaTransactionManager</code> class, which can optionally
    perform a JNDI lookup for the JTA
    <code class="interfacename">UserTransaction</code> and
    <code class="interfacename">TransactionManager</code> objects, autodetects the
    location for the latter object, which varies by application server. Having
    access to the JTA <code class="interfacename">TransactionManager</code> allows
    for enhanced transaction semantics, in particular supporting transaction
    suspension. See the <code class="classname">JtaTransactionManager</code> Javadocs
    for details.</p><p>Spring's <code class="classname">JtaTransactionManager</code> is the
    standard choice to run on Java EE application servers, and is known to
    work on all common servers. Advanced functionality such as transaction
    suspension works on many servers as well -- including GlassFish, JBoss,
    Geronimo, and Oracle OC4J -- without any special configuration required.
    However, for fully supported transaction suspension and further advanced
    integration, Spring ships special adapters for IBM WebSphere, BEA WebLogic
    Server, and Oracle OC4J. These adapters are discussed in the following
    sections.</p><p><span class="emphasis"><em>For standard scenarios, including WebLogic Server,
    WebSphere and OC4J, consider using the convenient
    <code class="literal">&lt;tx:jta-transaction-manager/&gt;</code> configuration
    element.</em></span> When configured, this element automatically detects
    the underlying server and chooses the best transaction manager available
    for the platform. This means that you won't have to configure
    server-specific adapter classes (as discussed in the following sections)
    explicitly; rather, they are chosen automatically, with the standard
    <code class="classname">JtaTransactionManager</code> as default fallback.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-application-server-integration-websphere"></a>11.8.1&nbsp;IBM WebSphere</h3></div></div></div><p>On WebSphere 6.1.0.9 and above, the recommended Spring JTA
      transaction manager to use is
      <code class="classname">WebSphereUowTransactionManager</code>. This special
      adapter leverages IBM's <code class="interfacename">UOWManager</code> API,
      which is available in WebSphere Application Server 6.0.2.19 and later
      and 6.1.0.9 and later. With this adapter, Spring-driven transaction
      suspension (suspend/resume as initiated by
      <code class="literal">PROPAGATION_REQUIRES_NEW</code>) is officially supported by
      IBM!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-application-server-integration-weblogic"></a>11.8.2&nbsp;BEA WebLogic Server</h3></div></div></div><p>On WebLogic Server 9.0 or above, you typically would use the
      <code class="classname">WebLogicJtaTransactionManager</code> instead of the
      stock <code class="classname">JtaTransactionManager</code> class. This special
      WebLogic-specific subclass of the normal
      <code class="classname">JtaTransactionManager</code> supports the full power of
      Spring's transaction definitions in a WebLogic-managed transaction
      environment, beyond standard JTA semantics: Features include transaction
      names, per-transaction isolation levels, and proper resuming of
      transactions in all cases.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-application-server-integration-oc4j"></a>11.8.3&nbsp;Oracle OC4J</h3></div></div></div><p>Spring ships a special adapter class for OC4J 10.1.3 or later
      called <code class="classname">OC4JJtaTransactionManager</code>. This class is
      analogous to the <code class="classname">WebLogicJtaTransactionManager</code>
      class discussed in the previous section, providing similar value-adds on
      OC4J: transaction names and per-transaction isolation levels.</p><p>The full JTA functionality, including transaction suspension,
      works fine with Spring's <code class="classname">JtaTransactionManager</code> on
      OC4J as well. The special
      <code class="classname">OC4JJtaTransactionManager</code> adapter simply provides
      value-adds beyond standard JTA.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-solutions-to-common-problems"></a>11.9&nbsp;Solutions to common problems</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-solutions-to-common-problems-wrong-ptm"></a>11.9.1&nbsp;Use of the wrong transaction manager for a specific
      <code class="interfacename">DataSource</code></h3></div></div></div><p>Use the <span class="emphasis"><em>correct</em></span>
      <code class="interfacename">PlatformTransactionManager</code> implementation
      based on your choice of transactional technologies and requirements.
      Used properly, the Spring Framework merely provides a straightforward
      and portable abstraction. If you are using global transactions, you
      <span class="emphasis"><em>must</em></span> use the
      <code class="classname">org.springframework.transaction.jta.JtaTransactionManager</code>
      class (or an <a class="link" href="#transaction-application-server-integration" title="11.8&nbsp;Application server-specific integration">application
      server-specific subclass</a> of it) for all your transactional
      operations. Otherwise the transaction infrastructure attempts to perform
      local transactions on resources such as container
      <code class="interfacename">DataSource</code> instances. Such local
      transactions do not make sense, and a good application server treats
      them as errors.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-resources"></a>11.10&nbsp;Further Resources</h2></div></div></div><p>For more information about the Spring Framework's transaction
    support:</p><div class="itemizedlist"><ul type="disc"><li><p><a class="ulink" href="http://www.javaworld.com/javaworld/jw-01-2009/jw-01-spring-transactions.html" target="_top">Distributed
        transactions in Spring, with and without XA</a> is a JavaWorld
        presentation in which SpringSource's David Syer guides you through
        seven patterns for distributed transactions in Spring applications,
        three of them with XA and four without.</p></li><li><p><a class="ulink" href="http://www.infoq.com/minibooks/JTDS" target="_top">Java
        Transaction Design Strategies</a> is a book available from <a class="ulink" href="http://www.infoq.com/" target="_top">InfoQ</a> that provides a well-paced
        introduction to transactions in Java. It also includes side-by-side
        examples of how to configure and use transactions with both the Spring
        Framework and EJB3.</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="dao"></a>12.&nbsp;DAO support</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dao-introduction"></a>12.1&nbsp;Introduction</h2></div></div></div><p>The Data Access Object (DAO) support in Spring is aimed at making it
    easy to work with data access technologies like JDBC, Hibernate, JPA or
    JDO in a consistent way. This allows one to switch between the
    aforementioned persistence technologies fairly easily and it also allows
    one to code without worrying about catching exceptions that are specific
    to each technology.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dao-exceptions"></a>12.2&nbsp;Consistent exception hierarchy</h2></div></div></div><p>Spring provides a convenient translation from technology-specific
    exceptions like <code class="classname">SQLException</code> to its own exception
    class hierarchy with the <code class="classname">DataAccessException</code> as the
    root exception. These exceptions wrap the original exception so there is
    never any risk that one might lose any information as to what might have
    gone wrong.</p><p>In addition to JDBC exceptions, Spring can also wrap
    Hibernate-specific exceptions, converting them from proprietary, checked
    exceptions (in the case of versions of Hibernate prior to Hibernate 3.0),
    to a set of focused runtime exceptions (the same is true for JDO and JPA
    exceptions). This allows one to handle most persistence exceptions, which
    are non-recoverable, only in the appropriate layers, without having
    annoying boilerplate catch-and-throw blocks and exception declarations in
    one's DAOs. (One can still trap and handle exceptions anywhere one needs
    to though.) As mentioned above, JDBC exceptions (including
    database-specific dialects) are also converted to the same hierarchy,
    meaning that one can perform some operations with JDBC within a consistent
    programming model.</p><p>The above holds true for the various template classes in Springs
    support for various ORM frameworks. If one uses the interceptor-based
    classes then the application must care about handling
    <code class="classname">HibernateExceptions</code> and
    <code class="classname">JDOExceptions</code> itself, preferably via delegating to
    <code class="classname">SessionFactoryUtils</code>'
    <code class="methodname">convertHibernateAccessException(..)</code> or
    <code class="methodname">convertJdoAccessException()</code> methods respectively.
    These methods convert the exceptions to ones that are compatible with the
    exceptions in the <code class="literal">org.springframework.dao</code> exception
    hierarchy. As <code class="classname">JDOExceptions</code> are unchecked, they can
    simply get thrown too, sacrificing generic DAO abstraction in terms of
    exceptions though.</p><p>The exception hierarchy that Spring provides can be seen below.
    (Please note that the class hierarchy detailed in the image shows only a
    subset of the entire <code class="classname">DataAccessException</code>
    hierarchy.)</p><div class="mediaobject" align="center"><img src="images/DataAccessException.gif" align="middle"></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dao-annotations"></a>12.3&nbsp;Annotations used for configuring DAO or Repository classes</h2></div></div></div><p>The best way to guarantee that your Data Access Objects (DAOs) or
    repositories provide exception translation is to use the
    <code class="interfacename">@Repository</code> annotation. This annotation
    also allows the component scanning support to find and configure your DAOs
    and repositories without having to provide XML configuration entries for
    them.</p><pre class="programlisting">@Repository
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SomeMovieFinder <span class="hl-keyword">implements</span> MovieFinder {

    <span class="hl-comment">// ...</span>

}</pre><p>Any DAO or repository implementation will need to access to a
    persistence resource, depending on the persistence technology used; for
    example, a JDBC-based repository will need access to a JDBC
    <code class="interfacename">DataSource</code>; a JPA-based repository will need
    access to an <code class="interfacename">EntityManager</code>. The easiest way
    to accomplish this is to have this resource dependency injected using one of
    the <code class="interfacename">@Autowired,</code>, <code class="interfacename">@Inject</code>,
    <code class="interfacename">@Resource</code> or
    <code class="interfacename">@PersistenceContext</code> annotations. Here is an
    example for a JPA repository:</p><pre class="programlisting">@Repository
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JpaMovieFinder <span class="hl-keyword">implements</span> MovieFinder {

    @PersistenceContext
    <span class="hl-keyword">private</span> EntityManager entityManager;
    
    <span class="hl-comment">// ...</span>

}</pre><p>If you are using the classic Hibernate APIs than you can inject the
    SessionFactory:</p><pre class="programlisting">@Repository
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HibernateMovieFinder <span class="hl-keyword">implements</span> MovieFinder {

    <span class="hl-keyword">private</span> SessionFactory sessionFactory;
    
    @Autowired
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSessionFactory(SessionFactory sessionFactory) {
        <span class="hl-keyword">this</span>.sessionFactory = sessionFactory;
    }
    
    <span class="hl-comment">// ...</span>

}</pre><p>Last example we will show here is for typical JDBC support. You
    would have the <code class="classname">DataSource</code> injected into an
    initialization method where you would create a
    <code class="classname">JdbcTemplate</code> and other data access support classes
    like <code class="classname">SimpleJdbcCall</code> etc using this
    <code class="classname">DataSource</code>.</p><pre class="programlisting">@Repository
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcMovieFinder <span class="hl-keyword">implements</span> MovieFinder {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;
    
    @Autowired
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }
    
    <span class="hl-comment">// ...</span>

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Please see the specific coverage of each persistence technology
      for details on how to configure the application context to take
      advantage of these annotations.</p></td></tr></table></div><p></p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="jdbc"></a>13.&nbsp;Data access with JDBC</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-introduction"></a>13.1&nbsp;Introduction to Spring Framework JDBC</h2></div></div></div><p>The value-add provided by the Spring Framework JDBC abstraction is
    perhaps best shown by the sequence of actions outlined in the table below.
    The table shows what actions Spring will take care of and which actions
    are the responsibility of you, the application developer.</p><div class="table"><a name="d0e23030"></a><p class="title"><b>Table&nbsp;13.1.&nbsp;Spring JDBC - who does what?</b></p><div class="table-contents"><table summary="Spring JDBC - who does what?" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Action</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Spring</th><th style="border-bottom: 1.0pt solid ; " align="center">You</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Define connection parameters.</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center"><span class="bold"><strong></strong></span></td><td style="border-bottom: 1.0pt solid ; " align="center">X</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Open the connection.</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">X</td><td style="border-bottom: 1.0pt solid ; " align="center">&nbsp;</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Specify the SQL statement.</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">&nbsp;</td><td style="border-bottom: 1.0pt solid ; " align="center">X</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Declare parameters and provide parameter values</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">&nbsp;</td><td style="border-bottom: 1.0pt solid ; " align="center">X</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Prepare and execute the statement.</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">X</td><td style="border-bottom: 1.0pt solid ; " align="center">&nbsp;</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Set up the loop to iterate through the results (if
            any).</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">X</td><td style="border-bottom: 1.0pt solid ; " align="center">&nbsp;</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Do the work for each iteration.</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">&nbsp;</td><td style="border-bottom: 1.0pt solid ; " align="center">X</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Process any exception.</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">X</td><td style="border-bottom: 1.0pt solid ; " align="center">&nbsp;</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Handle transactions.</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">X</td><td style="border-bottom: 1.0pt solid ; " align="center">&nbsp;</td></tr><tr><td style="border-right: 1.0pt solid ; " align="left">Close the connection, statement and resultset.</td><td style="border-right: 1.0pt solid ; " align="center">X</td><td style="" align="center">&nbsp;</td></tr></tbody></table></div></div><br class="table-break"><p>The Spring Framework takes care of all the low-level details that
    can make JDBC such a tedious API to develop with.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-choose-style"></a>13.1.1&nbsp;Choosing an approach for JDBC database access</h3></div></div></div><p>You can choose among several approaches to form the basis for your
      JDBC database access. In addition to three flavors of the JdbcTemplate,
      a new SimpleJdbcInsert and SimplejdbcCall approach optimizes database
      metadata, and the RDBMS Object style takes a more object-oriented
      approach similar to that of JDO Query design. Once you start using one
      of these approaches, you can still mix and match to include a feature
      from a different approach. All approaches require a JDBC 2.0-compliant
      driver, and some advanced features require a JDBC 3.0 driver.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Spring 3.0 updates all of the following approaches with Java 5
        support such as generics and varargs.</p></td></tr></table></div><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>JdbcTemplate</strong></span> is the classic
          Spring JDBC approach and the most popular. This "lowest level"
          approach and all others use a JdbcTemplate under the covers, and all
          are updated with Java 5 support such as generics and varargs.</p></li><li><p><span class="bold"><strong>NamedParameterJdbcTemplate</strong></span>
          wraps a <code class="code">JdbcTemplate</code> to provide named parameters
          instead of the traditional JDBC "?" placeholders. This approach
          provides better documentation and ease of use when you have multiple
          parameters for an SQL statement.</p></li><li><p><span class="bold"><strong>SimpleJdbcTemplate</strong></span> combines
          the most frequently used operations of JdbcTemplate and
          NamedParameterJdbcTemplate.</p></li><li><p><span class="bold"><strong>SimpleJdbcInsert and
          SimpleJdbcCall</strong></span> optimize database metadata to limit the
          amount of necessary configuration. This approach simplifies coding
          so that you only need to provide the name of the table or procedure
          and provide a map of parameters matching the column names. 
          This only works if the database provides adequate metadata. If the
          database doesn't provide this metadata, you will have to provide
          explicit configuration of the parameters.</p></li><li><p><span class="bold"><strong>RDBMS Objects including MappingSqlQuery,
          SqlUpdate and StoredProcedure</strong></span> requires you to create
          reusable and thread-safe objects during initialization of your data
          access layer. This approach is modeled after JDO Query wherein you
          define your query string, declare parameters, and compile the query.
          Once you do that, execute methods can be called multiple times with
          various parameter values passed in.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-packages"></a>13.1.2&nbsp;Package hierarchy</h3></div></div></div><p>The Spring Framework's JDBC abstraction framework consists of four
      different packages, namely <code class="literal">core</code>,
      <code class="literal">datasource</code>, <code class="literal">object</code>, and
      <code class="literal">support</code>.</p><p>The <code class="literal">org.springframework.jdbc.core</code> package
      contains the <code class="classname">JdbcTemplate</code> class and its various
      callback interfaces, plus a variety of related classes. A subpackage
      named <code class="literal">org.springframework.jdbc.core.simple</code> contains
      the <code class="classname">SimpleJdbcTemplate</code> class and the related
      <code class="classname">SimpleJdbcInsert</code> and
      <code class="classname">SimpleJdbcCall</code> classes. Another subpackage named
      <code class="literal">org.springframework.jdbc.core.namedparam</code> contains the
      <code class="classname">NamedParameterJdbcTemplate</code> class and the related
      support classes. See <a class="xref" href="#jdbc-core" title="13.2&nbsp;Using the JDBC core classes to control basic JDBC processing and error handling">Section&nbsp;13.2, &#8220;Using the JDBC core classes to control basic JDBC processing and
    error handling&#8221;</a>, <a class="xref" href="#jdbc-advanced-jdbc" title="13.4&nbsp;JDBC batch operations">Section&nbsp;13.4, &#8220;JDBC batch operations&#8221;</a>, and <a class="xref" href="#jdbc-simple-jdbc" title="13.5&nbsp;Simplifying JDBC operations with the SimpleJdbc classes">Section&nbsp;13.5, &#8220;Simplifying JDBC operations with the SimpleJdbc classes&#8221;</a></p><p>The <code class="literal">org.springframework.jdbc.datasource</code> package
      contains a utility class for easy
      <code class="interfacename">DataSource</code> access, and various simple
      <code class="interfacename">DataSource</code> implementations that can be
      used for testing and running unmodified JDBC code outside of a Java EE
      container. A subpackage named
      <code class="literal">org.springfamework.jdbc.datasource.embedded</code> provides
      support for creating in-memory database instances using Java database
      engines such as HSQL and H2. See <a class="xref" href="#jdbc-connections" title="13.3&nbsp;Controlling database connections">Section&nbsp;13.3, &#8220;Controlling database connections&#8221;</a> and
      <a class="xref" href="#jdbc-embedded-database-support" title="13.8&nbsp;Embedded database support">Section&nbsp;13.8, &#8220;Embedded database support&#8221;</a></p><p>The <code class="literal">org.springframework.jdbc.object</code> package
      contains classes that represent RDBMS queries, updates, and stored
      procedures as thread safe, reusable objects. See <a class="xref" href="#jdbc-object" title="13.6&nbsp;Modeling JDBC operations as Java objects">Section&nbsp;13.6, &#8220;Modeling JDBC operations as Java objects&#8221;</a>.This approach is modeled by JDO, although of
      course objects returned by queries are &#8220;<span class="quote">disconnected</span>&#8221; from
      the database. This higher level of JDBC abstraction depends on the
      lower-level abstraction in the
      <code class="literal">org.springframework.jdbc.core</code> package.</p><p>The
      <code class="literal">org.springframework.jdbc.support</code> package provides
      <code class="classname">SQLException</code> translation functionality and some
      utility classes. Exceptions thrown during JDBC processing are translated
      to exceptions defined in the <code class="literal">org.springframework.dao</code>
      package. This means that code using the Spring JDBC abstraction layer
      does not need to implement JDBC or RDBMS-specific error handling. All
      translated exceptions are unchecked, which gives you the option of
      catching the exceptions from which you can recover while allowing other
      exceptions to be propagated to the caller. See <a class="xref" href="#jdbc-SQLExceptionTranslator" title="13.2.4&nbsp;SQLExceptionTranslator">Section&nbsp;13.2.4, &#8220;SQLExceptionTranslator&#8221;</a>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-core"></a>13.2&nbsp;Using the JDBC core classes to control basic JDBC processing and
    error handling</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-JdbcTemplate"></a>13.2.1&nbsp;<code class="classname">JdbcTemplate</code></h3></div></div></div><p>The <code class="classname">JdbcTemplate</code> class is the central class
      in the JDBC core package. It handles the creation and release of
      resources, which helps you avoid common errors such as forgetting to
      close the connection. It performs the basic tasks of the core JDBC
      workflow such as statement creation and execution, leaving application
      code to provide SQL and extract results. The
      <code class="classname">JdbcTemplate</code> class executes SQL queries, update
      statements and stored procedure calls, performs iteration over
      <code class="interfacename">ResultSet</code>s and extraction of returned
      parameter values.
      It also catches JDBC exceptions and translates them to the generic, more
      informative, exception hierarchy defined in the
      <code class="literal">org.springframework.dao</code> package.</p><p>When you use the <code class="classname">JdbcTemplate</code> for your
      code, you only need to implement callback interfaces, giving them a
      clearly defined contract. The
      <code class="interfacename">PreparedStatementCreator</code> callback
      interface creates a prepared statement given a
      <code class="interfacename">Connection</code> provided by this class,
      providing SQL and any necessary parameters. The same is true for the
      <code class="interfacename">CallableStatementCreator</code> interface, which
      creates callable statements. The
      <code class="interfacename">RowCallbackHandler</code> interface extracts
      values from each row of a
      <code class="interfacename">ResultSet</code>.</p><p>The <code class="classname">JdbcTemplate</code> can be used within a DAO
      implementation through direct instantiation with a
      <code class="interfacename">DataSource</code> reference, or be configured in
      a Spring IoC container and given to DAOs as a bean reference. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="interfacename">DataSource</code> should always be
          configured as a bean in the Spring IoC container. In the first case
          the bean is given to the service directly; in the second case it is
          given to the prepared template.</p></td></tr></table></div><p>All SQL issued by this class is logged at the
      <code class="literal">DEBUG</code> level under the category corresponding to the
      fully qualified class name of the template instance (typically
      <code class="classname">JdbcTemplate</code>, but it may be different if you are
      using a custom subclass of the <code class="classname">JdbcTemplate</code>
      class).</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="jdbc-JdbcTemplate-examples"></a>13.2.1.1&nbsp;Examples of JdbcTemplate class usage</h4></div></div></div><p>This section provides some examples of
        <code class="classname">JdbcTemplate</code> class usage. These examples are
        not an exhaustive list of all of the functionality exposed by the
        <code class="classname">JdbcTemplate</code>; see the attendant Javadocs for
        that.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="jdbc-JdbcTemplate-examples-query"></a>Querying (SELECT)</h5></div></div></div><p>Here is a simple query for getting the number of rows in a
          relation:</p><pre class="programlisting"><span class="hl-keyword">int</span> rowCount = <span class="hl-keyword">this</span>.jdbcTemplate.queryForInt(<span class="hl-string">"select count(*) from t_actor"</span>);</pre><p>A simple query using a bind variable:</p><pre class="programlisting"><span class="hl-keyword">int</span> countOfActorsNamedJoe = <span class="hl-keyword">this</span>.jdbcTemplate.queryForInt(
        <span class="hl-string">"select count(*) from t_actor where first_name = ?"</span>, <span class="hl-string">"Joe"</span>);</pre><p>Querying for a <code class="classname">String</code>:</p><pre class="programlisting">String lastName = <span class="hl-keyword">this</span>.jdbcTemplate.queryForObject(
        <span class="hl-string">"select last_name from t_actor where id = ?"</span>, 
        <span class="hl-keyword">new</span> Object[]{1212L}, String.<span class="hl-keyword">class</span>);</pre><p>Querying and populating a <span class="emphasis"><em>single</em></span> domain
          object:</p><pre class="programlisting">Actor actor = <span class="hl-keyword">this</span>.jdbcTemplate.queryForObject(
        <span class="hl-string">"select first_name, last_name from t_actor where id = ?"</span>,
        <span class="hl-keyword">new</span> Object[]{1212L},
        <span class="hl-keyword">new</span> RowMapper&lt;Actor&gt;() {
            <span class="hl-keyword">public</span> Actor mapRow(ResultSet rs, <span class="hl-keyword">int</span> rowNum) <span class="hl-keyword">throws</span> SQLException {
                Actor actor = <span class="hl-keyword">new</span> Actor();
                actor.setFirstName(rs.getString(<span class="hl-string">"first_name"</span>));
                actor.setLastName(rs.getString(<span class="hl-string">"last_name"</span>));
                <span class="hl-keyword">return</span> actor;
            }
        });
</pre><p>Querying and populating a number of domain objects:</p><pre class="programlisting">List&lt;Actor&gt; actors = <span class="hl-keyword">this</span>.jdbcTemplate.query(
        <span class="hl-string">"select first_name, last_name from t_actor"</span>,
        <span class="hl-keyword">new</span> RowMapper&lt;Actor&gt;() {
            <span class="hl-keyword">public</span> Actor mapRow(ResultSet rs, <span class="hl-keyword">int</span> rowNum) <span class="hl-keyword">throws</span> SQLException {
                Actor actor = <span class="hl-keyword">new</span> Actor();
                actor.setFirstName(rs.getString(<span class="hl-string">"first_name"</span>));
                actor.setLastName(rs.getString(<span class="hl-string">"last_name"</span>));
                <span class="hl-keyword">return</span> actor;
            }
        });
</pre><p>If the last two snippets of code actually existed in the same
          application, it would make sense to remove the duplication present
          in the two <code class="interfacename">RowMapper</code> anonymous inner
          classes, and extract them out into a single class (typically a
          <code class="literal">static</code> inner class) that can then be referenced
          by DAO methods as needed. For example, it may be better to write the
          last code snippet as follows:</p><pre class="programlisting"><span class="hl-keyword">public</span> List&lt;Actor&gt; findAllActors() {
    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.jdbcTemplate.query( <span class="hl-string">"select first_name, last_name from t_actor"</span>, <span class="hl-keyword">new</span> ActorMapper());
}

<span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> ActorMapper <span class="hl-keyword">implements</span> RowMapper&lt;Actor&gt; {

    <span class="hl-keyword">public</span> Actor mapRow(ResultSet rs, <span class="hl-keyword">int</span> rowNum) <span class="hl-keyword">throws</span> SQLException {
        Actor actor = <span class="hl-keyword">new</span> Actor();
        actor.setFirstName(rs.getString(<span class="hl-string">"first_name"</span>));
        actor.setLastName(rs.getString(<span class="hl-string">"last_name"</span>));
        <span class="hl-keyword">return</span> actor;
    }        
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="jdbc-JdbcTemplate-examples-update"></a>Updating (INSERT/UPDATE/DELETE) with jdbcTemplate</h5></div></div></div><p>You use the <code class="methodname">update(..)</code> method to
          perform insert, update and delete operations. Parameter values are
          usually provided as var args or alternatively as an object
          array.</p><pre class="programlisting"><span class="hl-keyword">this</span>.jdbcTemplate.update(
        <span class="hl-string">"insert into t_actor (first_name, last_name) values (?, ?)"</span>, 
        <span class="hl-string">"Leonor"</span>, <span class="hl-string">"Watling"</span>);</pre><pre class="programlisting"><span class="hl-keyword">this</span>.jdbcTemplate.update(
        <span class="hl-string">"update t_actor set = ? where id = ?"</span>, 
        <span class="hl-string">"Banjo"</span>, 5276L);</pre><pre class="programlisting"><span class="hl-keyword">this</span>.jdbcTemplate.update(
        <span class="hl-string">"delete from actor where id = ?"</span>,
        Long.valueOf(actorId));</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="jdbc-JdbcTemplate-examples-other"></a>Other jdbcTemplate operations</h5></div></div></div><p>You can use the <code class="methodname">execute(..)</code> method to
          execute any arbitrary SQL, and as such the method is often used for
          DDL statements. It is heavily overloaded with variants taking
          callback interfaces, binding variable arrays, and so on.</p><pre class="programlisting"><span class="hl-keyword">this</span>.jdbcTemplate.execute(<span class="hl-string">"create table mytable (id integer, name varchar(100))"</span>);</pre><p>The following example invokes a simple stored procedure. More
          sophisticated stored procedure support is <a class="link" href="#jdbc-StoredProcedure" title="13.6.4&nbsp;StoredProcedure">covered later</a>.</p><pre class="programlisting"><span class="hl-keyword">this</span>.jdbcTemplate.update(
        <span class="hl-string">"call SUPPORT.REFRESH_ACTORS_SUMMARY(?)"</span>, 
        Long.valueOf(unionId));</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="jdbc-JdbcTemplate-idioms"></a>13.2.1.2&nbsp;<code class="classname">JdbcTemplate</code> best practices</h4></div></div></div><p>Instances of the <code class="classname">JdbcTemplate</code> class are
        <span class="emphasis"><em>threadsafe once configured</em></span>. This is important
        because it means that you can configure a single instance of a
        <code class="classname">JdbcTemplate</code> and then safely inject this
        <span class="emphasis"><em>shared</em></span> reference into multiple DAOs (or
        repositories). The <code class="classname">JdbcTemplate</code> is stateful, in
        that it maintains a reference to a
        <code class="interfacename">DataSource</code>, but this state is
        <span class="emphasis"><em>not</em></span> conversational state.</p><p>A common practice when using the
        <code class="classname">JdbcTemplate</code> class (and the associated <a class="link" href="#jdbc-SimpleJdbcTemplate" title="13.2.3&nbsp;SimpleJdbcTemplate"><code class="classname">SimpleJdbcTemplate</code></a>
        and <a class="link" href="#jdbc-NamedParameterJdbcTemplate" title="13.2.2&nbsp;NamedParameterJdbcTemplate"><code class="classname">NamedParameterJdbcTemplate</code></a>
        classes) is to configure a <code class="interfacename">DataSource</code>
        in your Spring configuration file, and then dependency-inject that
        shared <code class="interfacename">DataSource</code> bean into your DAO
        classes; the <code class="classname">JdbcTemplate</code> is created in the
        setter for the <code class="interfacename">DataSource</code>. This leads
        to DAOs that look in part like the following:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcCorporateEventDao <span class="hl-keyword">implements</span> CorporateEventDao {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-comment">// JDBC-backed implementations of the methods on the CorporateEventDao follow...</span>
}</pre><p>The corresponding configuration might look like this.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;
    
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"corporateEventDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.JdbcCorporateEventDao"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
    
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.driverClassName}"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

    &lt;<span class="hl-tag">context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">"jdbc.properties"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>An alternative to explicit configuration is to use
        component-scanning and annotation support for dependency injection. In
        this case you annotate the class with
        <code class="interfacename">@Repository</code> (which makes it a candidate
        for component-scanning) and annotate the
        <code class="classname">DataSource</code> setter method with
        <code class="interfacename">@Autowired</code>.</p><pre class="programlisting">@Repository
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcCorporateEventDao <span class="hl-keyword">implements</span> CorporateEventDao {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    @Autowired
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-comment">// JDBC-backed implementations of the methods on the CorporateEventDao follow...</span>
}</pre><p>The corresponding XML configuration file would
        look like the following:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;
    
    &lt;<span class="hl-comment">!-- Scans within the base package of the application for @Components to configure as beans --</span>&gt;
    &lt;<span class="hl-tag">context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.springframework.docs.test"</span> /&gt;
    
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.driverClassName}"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

    &lt;<span class="hl-tag">context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">"jdbc.properties"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>If you are using Spring's
        <code class="classname">JdbcDaoSupport</code> class, and your various
        JDBC-backed DAO classes extend from it, then your sub-class inherits a
        <code class="methodname">setDataSource(..)</code> method from the
        <code class="classname">JdbcDaoSupport</code> class. You
        can choose whether to inherit from this class. The
        <code class="classname">JdbcDaoSupport</code> class is provided as a
        convenience only.</p><p>Regardless of which of the above template initialization styles
        you choose to use (or not), it is seldom necessary to create a new
        instance of a <code class="classname">JdbcTemplate</code> class each time you
        want to execute SQL. Once configured, a
        <code class="classname">JdbcTemplate</code> instance is threadsafe. You may
        want multiple <code class="classname">JdbcTemplate</code> instances if your
        application accesses multiple databases, which requires multiple
        <code class="interfacename">DataSources</code>, and subsequently multiple
        differently configured <code class="classname">JdbcTemplates</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-NamedParameterJdbcTemplate"></a>13.2.2&nbsp;<code class="classname">NamedParameterJdbcTemplate</code></h3></div></div></div><p>The <code class="classname">NamedParameterJdbcTemplate</code> class adds
      support for programming JDBC statements using named parameters, as
      opposed to programming JDBC statements using only classic placeholder
      (<code class="literal">'?'</code>) arguments. The
      <code class="classname">NamedParameterJdbcTemplate</code> class wraps a
      <code class="classname">JdbcTemplate</code>, and delegates to the wrapped
      <code class="classname">JdbcTemplate</code> to do much of its work. This section
      describes only those areas of the
      <code class="classname">NamedParameterJdbcTemplate</code> class that differ from
      the <code class="classname">JdbcTemplate</code> itself; namely, programming JDBC
      statements using named parameters.</p><pre class="programlisting"><span class="hl-comment">// some JDBC-backed DAO class...</span>
<span class="hl-keyword">private</span> NamedParameterJdbcTemplate namedParameterJdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
    <span class="hl-keyword">this</span>.namedParameterJdbcTemplate = <span class="hl-keyword">new</span> NamedParameterJdbcTemplate(dataSource);
}

<span class="hl-keyword">public</span> <span class="hl-keyword">int</span> countOfActorsByFirstName(String firstName) {

    String sql = <span class="hl-string">"select count(*) from T_ACTOR where first_name = :first_name"</span>;

    SqlParameterSource namedParameters = <span class="hl-keyword">new</span> MapSqlParameterSource(<span class="hl-string">"first_name"</span>, firstName);

    <span class="hl-keyword">return</span> namedParameterJdbcTemplate.queryForInt(sql, namedParameters);
}</pre><p>Notice the use of the named parameter notation in the value
      assigned to the <code class="literal">sql</code> variable, and the corresponding
      value that is plugged into the <code class="literal">namedParameters</code>
      variable (of type <code class="classname">MapSqlParameterSource</code>).</p><p>Alternatively, you can pass along named parameters and their
      corresponding values to a
      <code class="classname">NamedParameterJdbcTemplate</code> instance by using the
      <code class="interfacename">Map</code>-based style.The
      remaining methods exposed by the
      <code class="interfacename">NamedParameterJdbcOperations</code> and
      implemented by the <code class="classname">NamedParameterJdbcTemplate</code>
      class follow a similar pattern and are not covered here.</p><p>The following example shows the use of the
      <code class="interfacename">Map</code>-based style.</p><pre class="programlisting"><span class="hl-comment">// some JDBC-backed DAO class...</span>
<span class="hl-keyword">private</span> NamedParameterJdbcTemplate namedParameterJdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
    <span class="hl-keyword">this</span>.namedParameterJdbcTemplate = <span class="hl-keyword">new</span> NamedParameterJdbcTemplate(dataSource);
}

<span class="hl-keyword">public</span> <span class="hl-keyword">int</span> countOfActorsByFirstName(String firstName) {

    String sql = <span class="hl-string">"select count(*) from T_ACTOR where first_name = :first_name"</span>;

    Map namedParameters = Collections.singletonMap(<span class="hl-string">"first_name"</span>, firstName);

    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.namedParameterJdbcTemplate.queryForInt(sql, namedParameters);
}</pre><p>One nice feature related to the
      <code class="classname">NamedParameterJdbcTemplate</code> (and existing in the
      same Java package) is the <code class="classname">SqlParameterSource</code>
      interface. You have already seen an example of an implementation of this
      interface in one of the previous code snippet (the
      <code class="classname">MapSqlParameterSource</code> class). <code class="interfacename">An
      <code class="classname">SqlParameterSource</code></code> is a source of
      named parameter values to a
      <code class="classname">NamedParameterJdbcTemplate</code>. The
      <code class="classname">MapSqlParameterSource</code> class is a very simple
      implementation that is simply an adapter around a
      <code class="interfacename">java.util.Map</code>, where the keys are the
      parameter names and the values are the parameter values.</p><p>Another <code class="interfacename">SqlParameterSource</code>
      implementation is the
      <code class="classname">BeanPropertySqlParameterSource</code> class. This class
      wraps an arbitrary JavaBean (that is, an instance of a class that
      adheres to <a class="ulink" href="http://java.sun.com/products/javabeans/docs/spec.html" target="_top">the JavaBean
      conventions</a>), and uses the properties of the wrapped JavaBean as
      the source of named parameter values.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Actor {

    <span class="hl-keyword">private</span> Long id;
    <span class="hl-keyword">private</span> String firstName;
    <span class="hl-keyword">private</span> String lastName;
    
    <span class="hl-keyword">public</span> String getFirstName() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.firstName;
    }
    
    <span class="hl-keyword">public</span> String getLastName() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.lastName;
    }
    
    <span class="hl-keyword">public</span> Long getId() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.id;
    }
    
    <span class="hl-comment">// setters omitted...</span>

}</pre><pre class="programlisting"><span class="hl-comment">// some JDBC-backed DAO class...</span>
<span class="hl-keyword">private</span> NamedParameterJdbcTemplate namedParameterJdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
    <span class="hl-keyword">this</span>.namedParameterJdbcTemplate = <span class="hl-keyword">new</span> NamedParameterJdbcTemplate(dataSource);
}

<span class="hl-keyword">public</span> <span class="hl-keyword">int</span> countOfActors(Actor exampleActor) {

    <span class="hl-comment">// notice how the named parameters match the properties of the above 'Actor' class</span>
    String sql = 
        <span class="hl-string">"select count(*) from T_ACTOR where first_name = :firstName and last_name = :lastName"</span>;

    SqlParameterSource namedParameters = <span class="hl-keyword">new</span> BeanPropertySqlParameterSource(exampleActor);

    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.namedParameterJdbcTemplate.queryForInt(sql, namedParameters);
}</pre><p>Remember that the
      <code class="classname">NamedParameterJdbcTemplate</code> class
      <span class="emphasis"><em>wraps</em></span> a classic <code class="classname">JdbcTemplate</code>
      template; if you need access to the wrapped
      <code class="classname">JdbcTemplate</code> instance to access functionality
      only present in the <code class="classname">JdbcTemplate</code> class, you can
      use the <code class="methodname">getJdbcOperations()</code> method to access
      the wrapped <code class="classname">JdbcTemplate</code> through the
      <code class="interfacename">JdbcOperations</code> interface.</p><p>See also <a class="xref" href="#jdbc-JdbcTemplate-idioms" title="13.2.1.2&nbsp;JdbcTemplate best practices">Section&nbsp;13.2.1.2, &#8220;JdbcTemplate best practices&#8221;</a> for
      guidelines on using the
      <code class="classname">NamedParameterJdbcTemplate</code> class in the context
      of an application.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SimpleJdbcTemplate"></a>13.2.3&nbsp;<code class="classname">SimpleJdbcTemplate</code></h3></div></div></div><p>The <code class="classname">SimpleJdbcTemplate</code> class wraps the
      classic <code class="classname">JdbcTemplate</code> and leverages Java 5
      language features such as varargs and autoboxing.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In Spring 3.0, the original <code class="classname">JdbcTemplate</code>
        also supports Java 5-enhanced syntax with generics and varargs.
        However, the <code class="classname">SimpleJdbcTemplate</code> provides a
        simpler API that works best when you do not need access to all the
        methods that the JdbcTemplate offers. Also, because the
        <code class="classname">SimpleJdbcTemplate</code> was designed for Java 5, it
        has more methods that take advantage of varargs due to different
        ordering of the parameters.</p></td></tr></table></div><p>The value-add of the <code class="classname">SimpleJdbcTemplate</code>
      class in the area of syntactic-sugar is best illustrated with a
      before-and-after example. The next code snippet shows data access code
      that uses the classic <code class="classname">JdbcTemplate</code>, followed by a
      code snippet that does the same job with the
      <code class="classname">SimpleJdbcTemplate</code>.</p><pre class="programlisting"><span class="hl-comment">// classic JdbcTemplate-style...</span>
<span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
    <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
}

<span class="hl-keyword">public</span> Actor findActor(String specialty, <span class="hl-keyword">int</span> age) {

    String sql = <span class="hl-string">"select id, first_name, last_name from T_ACTOR"</span> + 
            <span class="hl-string">" where specialty = ? and age = ?"</span>;
    
    RowMapper&lt;Actor&gt; mapper = <span class="hl-keyword">new</span> RowMapper&lt;Actor&gt;() {
        <span class="hl-keyword">public</span> Actor mapRow(ResultSet rs, <span class="hl-keyword">int</span> rowNum) <span class="hl-keyword">throws</span> SQLException {
            Actor actor = <span class="hl-keyword">new</span> Actor();
            actor.setId(rs.getLong(<span class="hl-string">"id"</span>));
            actor.setFirstName(rs.getString(<span class="hl-string">"first_name"</span>));
            actor.setLastName(rs.getString(<span class="hl-string">"last_name"</span>));
            <span class="hl-keyword">return</span> actor;
        }
    };

    
    <span class="hl-comment">// notice the wrapping up of the argumenta in an array</span>
    <span class="hl-keyword">return</span> (Actor) jdbcTemplate.queryForObject(sql, <span class="hl-keyword">new</span> Object[] {specialty, age}, mapper);
}</pre><p>Here is the same method, with the
      <code class="classname">SimpleJdbcTemplate</code>.</p><pre class="programlisting"><span class="hl-comment">// SimpleJdbcTemplate-style...</span>
<span class="hl-keyword">private</span> SimpleJdbcTemplate simpleJdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
    <span class="hl-keyword">this</span>.simpleJdbcTemplate = <span class="hl-keyword">new</span> SimpleJdbcTemplate(dataSource);
}

<span class="hl-keyword">public</span> Actor findActor(String specialty, <span class="hl-keyword">int</span> age) {

    String sql = <span class="hl-string">"select id, first_name, last_name from T_ACTOR"</span> + 
            <span class="hl-string">" where specialty = ? and age = ?"</span>;
    RowMapper&lt;Actor&gt; mapper = <span class="hl-keyword">new</span> RowMapper&lt;Actor&gt;() {  
        <span class="hl-keyword">public</span> Actor mapRow(ResultSet rs, <span class="hl-keyword">int</span> rowNum) <span class="hl-keyword">throws</span> SQLException {
            Actor actor = <span class="hl-keyword">new</span> Actor();
            actor.setId(rs.getLong(<span class="hl-string">"id"</span>));
            actor.setFirstName(rs.getString(<span class="hl-string">"first_name"</span>));
            actor.setLastName(rs.getString(<span class="hl-string">"last_name"</span>));
            <span class="hl-keyword">return</span> actor;
        }
    };

    <span class="hl-comment">// notice the use of varargs since the parameter values now come </span>
    <span class="hl-comment">// after the RowMapper parameter</span>
    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.simpleJdbcTemplate.queryForObject(sql, mapper, specialty, age);
}</pre><p>See <a class="xref" href="#jdbc-JdbcTemplate-idioms" title="13.2.1.2&nbsp;JdbcTemplate best practices">Section&nbsp;13.2.1.2, &#8220;JdbcTemplate best practices&#8221;</a> for guidelines on
      how to use the <code class="classname">SimpleJdbcTemplate</code> class in the
      context of an application.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="classname">SimpleJdbcTemplate</code> class only offers
        a subset of the methods exposed on the
        <code class="classname">JdbcTemplate</code> class. If you need to use a method
        from the <code class="classname">JdbcTemplate</code> that is not defined on
        the <code class="classname">SimpleJdbcTemplate</code>, you can always access
        the underlying <code class="classname">JdbcTemplate</code> by calling the
        <code class="methodname">getJdbcOperations()</code> method on the
        <code class="classname">SimpleJdbcTemplate</code>, which then allows you to
        invoke the method that you want. The only downside is that the methods
        on the <code class="interfacename">JdbcOperations</code> interface are not
        generic, so you are back to casting and so on.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SQLExceptionTranslator"></a>13.2.4&nbsp;<code class="interfacename">SQLExceptionTranslator</code></h3></div></div></div><p><code class="interfacename">SQLExceptionTranslator</code> is an
      interface to be implemented by classes that can translate between
      <code class="classname">SQLExceptions</code> and Spring's own
      <code class="classname">org.springframework.dao.DataAccessException</code>,
      which is agnostic in regard to data access strategy. Implementations can
      be generic (for example, using SQLState codes for JDBC) or proprietary
      (for example, using Oracle error codes) for greater precision.</p><p><code class="classname">SQLErrorCodeSQLExceptionTranslator</code> is the
      implementation of <code class="interfacename">SQLExceptionTranslator</code>
      that is used by default. This implementation uses specific vendor codes.
      It is more precise than the <code class="literal">SQLState</code> implementation.
      The error code translations are based on codes held in a JavaBean type
      class called <code class="classname">SQLErrorCodes</code>. This class is created
      and populated by an <code class="classname">SQLErrorCodesFactory</code> which as
      the name suggests is a factory for creating
      <code class="classname">SQLErrorCodes</code> based on the contents of a
      configuration file named <code class="filename">sql-error-codes.xml</code>. This file is
      populated with vendor codes and based on the
      <code class="code">DatabaseProductName</code> taken from the
      <code class="interfacename">DatabaseMetaData</code>. The codes for the acual
      database you are using are used.</p><p>The <code class="classname">SQLErrorCodeSQLExceptionTranslator</code>
      applies matching rules in the following sequence: </p><div class="orderedlist"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="classname">SQLErrorCodesFactory</code> is used by
            default to define Error codes and custom exception translations.
            They are looked up in a file named
            <code class="filename">sql-error-codes.xml</code> from the classpath and
            the matching <code class="classname">SQLErrorCodes</code> instance is
            located based on the database name from the database metadata of
            the database in use.</p></td></tr></table></div><ol type="1" compact><li><p>Any custom translation implemented by a subclass. Normally
            the provided concrete
            <code class="classname">SQLErrorCodeSQLExceptionTranslator</code> is used
            so this rule does not apply. It only applies if you have actually
            provided a subclass implementation.</p></li><li><p>Any custom implementation of the
            <code class="classname">SQLExceptionTranslator</code> interface that is
            provided as the
            <code class="classname">customSqlExceptionTranslator</code> property of
            the <code class="classname">SQLErrorCodes</code> class.</p></li><li><p>The list of instances of the
            <code class="classname">CustomSQLErrorCodesTranslation</code> class,
            provided for the <code class="classname">customTranslations</code>
            property of the <code class="classname">SQLErrorCodes</code> class, are
            searched for a match.</p></li><li><p>Error code matching is applied.</p></li><li><p>Use the fallback translator.
            <code class="classname">SQLExceptionSubclassTranslator</code> is the
            default fallback translator. If this translation is not available
            then the next fallback translator is the
            <code class="classname">SQLStateSQLExceptionTranslator</code>.</p></li></ol></div><p>You can extend
      <code class="classname">SQLErrorCodeSQLExceptionTranslator:</code></p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomSQLErrorCodesTranslator <span class="hl-keyword">extends</span> SQLErrorCodeSQLExceptionTranslator {

    <span class="hl-keyword">protected</span> DataAccessException customTranslate(String task, String sql, SQLException sqlex) {
        <span class="hl-keyword">if</span> (sqlex.getErrorCode() == -12345) {
            <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> DeadlockLoserDataAccessException(task, sqlex);
        }
        <span class="hl-keyword">return</span> null;
    }
}</pre><p>In this example, the specific error code <code class="literal">-12345</code>
      is translated and other errors are left to be translated by the default
      translator implementation. To use this custom translator, it is
      necessary to pass it to the <code class="classname">JdbcTemplate</code> through
      the method <code class="literal">setExceptionTranslator</code> and to use this
      <code class="classname">JdbcTemplate</code> for all of the data access
      processing where this translator is needed. Here is an example of how
      this custom translator can be used:</p><pre class="programlisting"><span class="hl-keyword">private</span> JdbcTemplate jdbcTemoplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
    <span class="hl-comment">// create a JdbcTemplate and set data source </span>
    <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(); 
    <span class="hl-keyword">this</span>.jdbcTemplate.setDataSource(dataSource); 
    <span class="hl-comment">// create a custom translator and set the DataSource for the default translation lookup </span>
    CustomSQLErrorCodesTranslator tr = <span class="hl-keyword">new</span> CustomSQLErrorCodesTranslator(); 
    tr.setDataSource(dataSource); 
    <span class="hl-keyword">this</span>.jdbcTemplate.setExceptionTranslator(tr); 
}

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> updateShippingCharge(<span class="hl-keyword">long</span> orderId, <span class="hl-keyword">long</span> pct) {
    <span class="hl-comment">// use the prepared JdbcTemplate for this update</span>
    <span class="hl-keyword">this</span>.jdbcTemplate.update(
        <span class="hl-string">"update orders"</span> + 
            <span class="hl-string">" set shipping_charge = shipping_charge * ? / 100"</span> + 
            <span class="hl-string">" where id = ?"</span>
        pct, orderId); 
}</pre><p>The custom translator is passed a data source in order to look up
      the error codes in <code class="literal">sql-error-codes.xml</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-statements-executing"></a>13.2.5&nbsp;Executing statements</h3></div></div></div><p>Executing an SQL statement requires very little code. You need a
      <code class="interfacename">DataSource</code> and a
      <code class="classname">JdbcTemplate</code>, including the convenience
      methods
      that are provided with the <code class="classname">JdbcTemplate</code>. The
      following example shows what you need to include for a minimal but fully
      functional class that creates a new table:</p><pre class="programlisting"><span class="hl-keyword">import</span> javax.sql.DataSource;
<span class="hl-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExecuteAStatement {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doExecute() {
        <span class="hl-keyword">this</span>.jdbcTemplate.execute(<span class="hl-string">"create table mytable (id integer, name varchar(100))"</span>);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-statements-querying"></a>13.2.6&nbsp;Running queries</h3></div></div></div><p>Some query methods return a single value. To retrieve a count or a
      specific value from one row, use
      <code class="methodname">queryForInt(..)</code>,
      <code class="methodname">queryForLong(..)</code> or
      <code class="methodname">queryForObject(..)</code>. The latter converts the
      returned JDBC <code class="classname">Type</code> to the Java class that is
      passed in as an argument. If the type conversion is invalid, then an
      <code class="exceptionname">InvalidDataAccessApiUsageException</code> is
      thrown. Here is an example that contains two query methods, one for an
      <code class="classname">int</code> and one that queries for a
      <code class="classname">String</code>.</p><pre class="programlisting"><span class="hl-keyword">import</span> javax.sql.DataSource;
<span class="hl-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RunAQuery {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }
  
    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getCount() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.jdbcTemplate.queryForInt(<span class="hl-string">"select count(*) from mytable"</span>);
    }

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> (String) <span class="hl-keyword">this</span>.jdbcTemplate.queryForObject(<span class="hl-string">"select name from mytable"</span>, String.<span class="hl-keyword">class</span>);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.dataSource = dataSource;
    }
}</pre><p>In addition to the single result query methods, several methods
      return a list with an entry for each row that the query returned. The
      most generic method is <code class="methodname">queryForList(..)</code> which
      returns a <code class="interfacename">List</code> where each entry is a
      <code class="interfacename">Map</code> with each entry in the map
      representing the column value for that row. If you add a method to the
      above example to retrieve a list of all the rows, it would look like
      this:</p><pre class="programlisting">
<span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
    <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
}

<span class="hl-keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; getList() {
    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.jdbcTemplate.queryForList(<span class="hl-string">"select * from mytable"</span>);
}</pre><p>The list returned would look something like this:</p><pre class="programlisting">[{name=Bob, id=1}, {name=Mary, id=2}]</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-updates"></a>13.2.7&nbsp;Updating the database</h3></div></div></div><p>The following example shows a column updated for a certain primary
      key. In this example, an SQL statement has placeholders for row
      parameters. The parameter values can be passed in as varargs or
      alternatively as an array of objects. Thus primitives should be wrapped
      in the primitive wrapper classes explicitly or using auto-boxing.</p><pre class="programlisting"><span class="hl-keyword">import</span> javax.sql.DataSource;

<span class="hl-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExecuteAnUpdate {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(<span class="hl-keyword">int</span> id, String name) {
        <span class="hl-keyword">this</span>.jdbcTemplate.update(
                <span class="hl-string">"update mytable set name = ? where id = ?"</span>, 
                name, id);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-auto-genereted-keys"></a>13.2.8&nbsp;Retrieving auto-generated keys</h3></div></div></div><p>An <code class="methodname">update()</code> convenience method
      supports the retrieval of primary keys generated
      by the database. This support is part of the JDBC 3.0 standard; see
      Chapter 13.6 of the specification for details. The method takes a
      <code class="classname">PreparedStatementCreator</code> as its first argument,
      and this is the way the required insert statement is specified. The
      other argument is a <code class="classname">KeyHolder</code>, which contains the
      generated key on successful return from the update. There is not a
      standard single way to create an appropriate
      <code class="classname">PreparedStatement</code> (which explains why the method
      signature is the way it is). The following example works on Oracle but
      may not work on other platforms:</p><pre class="programlisting"><span class="hl-keyword">final</span> String INSERT_SQL = <span class="hl-string">"insert into my_test (name) values(?)"</span>;
<span class="hl-keyword">final</span> String name = <span class="hl-string">"Rob"</span>;

KeyHolder keyHolder = <span class="hl-keyword">new</span> GeneratedKeyHolder();
jdbcTemplate.update(
    <span class="hl-keyword">new</span> PreparedStatementCreator() {
        <span class="hl-keyword">public</span> PreparedStatement createPreparedStatement(Connection connection) <span class="hl-keyword">throws</span> SQLException {
            PreparedStatement ps =
                connection.prepareStatement(INSERT_SQL, <span class="hl-keyword">new</span> String[] {<span class="hl-string">"id"</span>});
            ps.setString(1, name);
            <span class="hl-keyword">return</span> ps;
        }
    },
    keyHolder);

<span class="hl-comment">// keyHolder.getKey() now contains the generated key</span></pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-connections"></a>13.3&nbsp;Controlling database connections</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-datasource"></a>13.3.1&nbsp;<code class="interfacename">DataSource</code></h3></div></div></div><p>Spring obtains a connection to the database through a
      <code class="interfacename">DataSource</code>. A
      <code class="interfacename">DataSource</code> is part of the JDBC
      specification and is a generalized connection factory. It allows a
      container or a framework to hide connection pooling and transaction
      management issues from the application code. As a developer, you need
      not know details about how to connect to the database; that is the
      responsibility of the administrator that sets up the datasource. You
      most likely fill both roles as you develop and test code, but you do not
      necessarily have to know how the production data source is
      configured.</p><p>When using Spring's JDBC layer, you obtain a data source from JNDI
      or you configure your own with a connection pool implementation provided
      by a third party. Popular implementations are Apache Jakarta Commons
      DBCP and C3P0. Implementations in the Spring distribution are meant only
      for testing purposes and do not provide pooling.</p><p>This section uses Spring's
      <code class="classname">DriverManagerDataSource</code> implementation, and
      several additional implementations are covered later.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Only use the <code class="classname">DriverManagerDataSource</code>
          class should only be used for testing purposes since it does not
          provide pooling and will perform poorly when multiple requests for a
          connection are made.</p></td></tr></table></div><p>You obtain a connection with
      <code class="classname">DriverManagerDataSource</code> as you typically obtain a
      JDBC connection. Specify the fully qualified classname of the JDBC
      driver so that the <code class="classname">DriverManager</code> can load the
      driver class. Next, provide a URL that varies between JDBC drivers.
      (Consult the documentation for your driver for the correct value.) Then
      provide a username and a password to connect to the database. Here is an
      example of how to configure a
      <code class="classname">DriverManagerDataSource</code> in Java code:</p><pre class="programlisting">DriverManagerDataSource dataSource = <span class="hl-keyword">new</span> DriverManagerDataSource();
dataSource.setDriverClassName(<span class="hl-string">"org.hsqldb.jdbcDriver"</span>);
dataSource.setUrl(<span class="hl-string">"jdbc:hsqldb:hsql://localhost:"</span>);
dataSource.setUsername(<span class="hl-string">"sa"</span>);
dataSource.setPassword(<span class="hl-string">""</span>);</pre><p>Here is the corresponding XML configuration:</p><pre class="programlisting">&lt;bean id=<span class="hl-string">"dataSource"</span> <span class="hl-keyword">class</span>=<span class="hl-string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;
    &lt;property name=<span class="hl-string">"driverClassName"</span> value=<span class="hl-string">"${jdbc.driverClassName}"</span>/&gt;
    &lt;property name=<span class="hl-string">"url"</span> value=<span class="hl-string">"${jdbc.url}"</span>/&gt;
    &lt;property name=<span class="hl-string">"username"</span> value=<span class="hl-string">"${jdbc.username}"</span>/&gt;
    &lt;property name=<span class="hl-string">"password"</span> value=<span class="hl-string">"${jdbc.password}"</span>/&gt;
&lt;/bean&gt;

&lt;context:property-placeholder location=<span class="hl-string">"jdbc.properties"</span>/&gt;</pre><p>The following examples show the basic connectivity and
      configuration for DBCP and C3P0. To learn about more options that help
      control the pooling features, see the product documentation for the
      respective connection pooling implementations.</p><p>DBCP configuration:</p><pre class="programlisting">&lt;bean id=<span class="hl-string">"dataSource"</span> 
        <span class="hl-keyword">class</span>=<span class="hl-string">"org.apache.commons.dbcp.BasicDataSource"</span> destroy-method=<span class="hl-string">"close"</span>&gt;
    &lt;property name=<span class="hl-string">"driverClassName"</span> value=<span class="hl-string">"${jdbc.driverClassName}"</span>/&gt;
    &lt;property name=<span class="hl-string">"url"</span> value=<span class="hl-string">"${jdbc.url}"</span>/&gt;
    &lt;property name=<span class="hl-string">"username"</span> value=<span class="hl-string">"${jdbc.username}"</span>/&gt;
    &lt;property name=<span class="hl-string">"password"</span> value=<span class="hl-string">"${jdbc.password}"</span>/&gt;
&lt;/bean&gt;

&lt;context:property-placeholder location=<span class="hl-string">"jdbc.properties"</span>/&gt;</pre><p>C3P0 configuration:</p><pre class="programlisting">&lt;bean id=<span class="hl-string">"dataSource"</span>
        <span class="hl-keyword">class</span>=<span class="hl-string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span> destroy-method=<span class="hl-string">"close"</span>&gt;
    &lt;property name=<span class="hl-string">"driverClass"</span> value=<span class="hl-string">"${jdbc.driverClassName}"</span>/&gt;
    &lt;property name=<span class="hl-string">"jdbcUrl"</span> value=<span class="hl-string">"${jdbc.url}"</span>/&gt;
    &lt;property name=<span class="hl-string">"user"</span> value=<span class="hl-string">"${jdbc.username}"</span>/&gt;
    &lt;property name=<span class="hl-string">"password"</span> value=<span class="hl-string">"${jdbc.password}"</span>/&gt;
&lt;/bean&gt;

&lt;context:property-placeholder location=<span class="hl-string">"jdbc.properties"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-DataSourceUtils"></a>13.3.2&nbsp;<code class="classname">DataSourceUtils</code></h3></div></div></div><p>The <code class="classname">DataSourceUtils</code> class is a convenient
      and powerful helper class that provides <code class="literal">static</code>
      methods to obtain connections from JNDI and close connections if
      necessary. It supports thread-bound connections with, for example,
      <code class="classname">DataSourceTransactionManager</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SmartDataSource"></a>13.3.3&nbsp;<code class="interfacename">SmartDataSource</code></h3></div></div></div><p>The <code class="interfacename">SmartDataSource</code> interface
      should be implemented by classes that can provide a connection to a
      relational database. It extends the
      <code class="interfacename">DataSource</code> interface to allow classes
      using it to query whether the connection should be closed after a given
      operation. This usage is efficient when you know that you will reuse a
      connection.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-AbstractDataSource"></a>13.3.4&nbsp;<code class="classname">AbstractDataSource</code></h3></div></div></div><p><code class="code"><code class="classname">AbstractDataSource</code></code> is an
      <code class="literal"><code class="classname">abstract</code></code> base class for
      Spring's <code class="interfacename">DataSource</code> implementations that
      implements code that is common to all <code class="classname">DataSource</code>
      implementations.
      You extend the <code class="classname">AbstractDataSource</code> class if you
      are writing your own <code class="interfacename">DataSource</code>
      implementation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SingleConnectionDataSource"></a>13.3.5&nbsp;<code class="classname">SingleConnectionDataSource</code></h3></div></div></div><p>The <code class="classname">SingleConnectionDataSource</code> class is an
      implementation of the <code class="interfacename">SmartDataSource</code>
      interface that wraps a <span class="emphasis"><em>single</em></span>
      <code class="interfacename">Connection</code> that is
      <span class="emphasis"><em>not</em></span> closed after each use. Obviously, this is not
      multi-threading capable.</p><p>If any client code calls <span class="command"><strong>close</strong></span> in the
      assumption of a pooled connection, as when using persistence tools, set
      the <code class="literal">suppressClose</code> property to
      <code class="literal">true</code>. This
      setting returns a close-suppressing proxy wrapping the physical
      connection. Be aware that you will not be able to cast this
      to a native Oracle <code class="interfacename">Connection</code> or the like
      anymore.</p><p>This is primarily a test class. For example, it enables easy
      testing of code outside an application server, in conjunction with a
      simple JNDI environment. In contrast to
      <code class="classname">DriverManagerDataSource</code>, it reuses the same
      connection all the time, avoiding excessive creation of physical
      connections.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-DriverManagerDataSource"></a>13.3.6&nbsp;<code class="classname">DriverManagerDataSource</code></h3></div></div></div><p>The <code class="classname">DriverManagerDataSource</code> class is an
      implementation of the standard <code class="interfacename">DataSource</code>
      interface that configures a plain JDBC driver through bean properties,
      and returns a new <code class="interfacename">Connection</code> every
      time.</p><p>This implementation is useful for test and stand-alone
      environments outside of a Java EE container, either as a
      <code class="interfacename">DataSource</code> bean in a Spring IoC
      container, or in conjunction with a simple JNDI environment.
      Pool-assuming <code class="literal">Connection.close()</code> calls will simply
      close the connection, so any
      <code class="interfacename">DataSource</code>-aware persistence code should
      work. However, using JavaBean-style connection pools such as
      <code class="code">commons-dbcp</code> is so easy, even in a test environment, that
      it is almost always preferable to use such a connection pool over
      <code class="classname">DriverManagerDataSource</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-TransactionAwareDataSourceProxy"></a>13.3.7&nbsp;<code class="classname">TransactionAwareDataSourceProxy</code></h3></div></div></div><p><code class="classname">TransactionAwareDataSourceProxy</code> is a proxy
      for a target <code class="interfacename">DataSource</code>, which wraps that
      target <code class="interfacename">DataSource</code> to add awareness of
      Spring-managed transactions. In this respect, it is similar to a
      transactional JNDI <code class="interfacename">DataSource</code> as provided
      by a Java EE server.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>It is rarely desirable to use this class, except when already
        existing code that must be called and passed a standard JDBC
        <code class="interfacename">DataSource</code> interface implementation. In
        this case, it's possible to still have this code be usable, and at the
        same time have this code participating in Spring managed transactions.
        It
        is generally preferable to write your own new code using the higher
        level abstractions for resource management, such as
        <code class="classname">JdbcTemplate</code> or
        <code class="classname">DataSourceUtils</code>.</p></td></tr></table></div><p><span class="emphasis"><em>(See the
      <code class="classname">TransactionAwareDataSourceProxy</code> Javadocs for more
      details.)</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-DataSourceTransactionManager"></a>13.3.8&nbsp;<code class="classname">DataSourceTransactionManager</code></h3></div></div></div><p>The <code class="classname">DataSourceTransactionManager</code> class is a
      <code class="interfacename">PlatformTransactionManager</code> implementation
      for single JDBC datasources. It binds a JDBC connection from the
      specified data source to the currently executing thread, potentially
      allowing for one thread connection per data source.</p><p>Application code is required to
      retrieve the JDBC connection through
      <code class="literal">DataSourceUtils.getConnection(DataSource)</code> instead of
      Java EE's standard <code class="literal">DataSource.getConnection</code>. It
      throws unchecked <code class="literal">org.springframework.dao</code> exceptions
      instead of checked <code class="exceptionname">SQLExceptions</code>. All
      framework classes like <code class="classname">JdbcTemplate</code> use this
      strategy implicitly. If not used with this transaction manager, the
      lookup strategy behaves exactly like the common one - it can thus be
      used in any case.</p><p>The <code class="classname">DataSourceTransactionManager</code> class
      supports custom isolation levels, and timeouts that get applied as
      appropriate JDBC statement query timeouts. To support the latter,
      application code must either use <code class="classname">JdbcTemplate</code> or
      call the <code class="literal">DataSourceUtils.applyTransactionTimeout(..)</code>
      method for each created statement.</p><p>This implementation can be used instead of
      <code class="classname">JtaTransactionManager</code> in the single resource
      case, as it does not require the container to support JTA. Switching
      between both is just a matter of configuration, if you stick to the
      required connection lookup pattern. JTA does not support custom
      isolation levels!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-NativeJdbcExtractor"></a>13.3.9&nbsp;NativeJdbcExtractor</h3></div></div></div><p>Sometimes you need to access vendor specific JDBC methods that
      differ from the standard JDBC API. This can be problematic if you are
      running in an application server or with a
      <code class="classname">DataSource</code> that wraps the
      <code class="classname">Connection</code>, <code class="classname">Statement</code> and
      <code class="classname">ResultSet</code> objects with its own wrapper objects.
      To gain access to the native objects you can configure your
      <code class="classname">JdbcTemplate</code> or
      <code class="classname">OracleLobHandler</code> with a
      <code class="classname">NativeJdbcExtractor</code>.</p><p>The <code class="code">NativeJdbcExtractor</code> comes in a variety of flavors
      to match your execution environment:</p><div class="itemizedlist"><ul type="disc"><li><p>SimpleNativeJdbcExtractor</p></li><li><p>C3P0NativeJdbcExtractor</p></li><li><p>CommonsDbcpNativeJdbcExtractor</p></li><li><p>JBossNativeJdbcExtractor</p></li><li><p>WebLogicNativeJdbcExtractor</p></li><li><p>WebSphereNativeJdbcExtractor</p></li><li><p>XAPoolNativeJdbcExtractor</p></li></ul></div><p>Usually the <code class="classname">SimpleNativeJdbcExtractor</code> is
      sufficient for unwrapping a <code class="classname">Connection</code> object in
      most environments. See the Javadocs for more details.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-advanced-jdbc"></a>13.4&nbsp;JDBC batch operations</h2></div></div></div><p>Most JDBC drivers provide improved performance if you batch multiple
    calls to the same prepared statement. By grouping updates into batches you
    limit the number of round trips to the database. This section covers batch
    processing using both the <code class="classname">JdbcTemplate</code> and the
    <code class="classname">SimpleJdbcTemplate</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-batch-classic"></a>13.4.1&nbsp;Basic batch operations with the JdbcTemplate</h3></div></div></div><p>You accomplish <code class="classname">JdbcTemplate</code> batch
      processing by implementing two methods of a special interface,
      <code class="classname">BatchPreparedStatementSetter</code>, and passing that in
      as the second parameter in your <code class="classname">batchUpdate</code>
      method call. Use the <code class="classname">getBatchSize</code> method to
      provide the size of the current batch. Use the
      <code class="classname">setValues</code> method to set the values for the
      parameters of the prepared statement. This method will be called the
      number of times that you specified in the
      <code class="classname">getBatchSize</code> call. The following example updates
      the actor table based on entries in a list. The entire list is used as
      the batch in this example:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span>[] batchUpdate(<span class="hl-keyword">final</span> List&lt;Actor&gt; actors) {
        <span class="hl-keyword">int</span>[] updateCounts = jdbcTemplate.batchUpdate(
                <span class="hl-string">"update t_actor set first_name = ?, last_name = ? where id = ?"</span>,
                <span class="hl-keyword">new</span> BatchPreparedStatementSetter() {
                    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setValues(PreparedStatement ps, <span class="hl-keyword">int</span> i) <span class="hl-keyword">throws</span> SQLException {
                        ps.setString(1, actors.get(i).getFirstName());
                        ps.setString(2, actors.get(i).getLastName());
                        ps.setLong(3, actors.get(i).getId().longValue());
                    }

                    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getBatchSize() {
                        <span class="hl-keyword">return</span> actors.size();
                    }
                } );
        <span class="hl-keyword">return</span> updateCounts;
    }

    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>If you are processing a stream of updates or reading from a
      file, then you might have a preferred batch size, but the last batch
      might not have that number of entries. In this case you can use the
      <code class="classname">InterruptibleBatchPreparedStatementSetter</code>
      interface, which allows you to interrupt a batch once the input source
      is exhausted. The <code class="classname">isBatchExhausted</code> method allows
      you to signal the end of the batch.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-batch-list"></a>13.4.2&nbsp;Batch operations with a List of objects</h3></div></div></div><p>Both the <code class="classname">JdbcTemplate</code> and the
      <code class="classname">NamedParameterJdbcTemplate</code> provides an alternate
      way of providing the batch update. Instead of implementing a special
      batch interface, you provide all parameter values in the call as a list.
      The framework loops over these values and uses an internal prepared
      statement setter. The API varies depending on whether you use named
      parameters. For the named parameters you provide an array of
      <code class="classname">SqlParameterSource</code>, one entry for each member of
      the batch. You can use the
      <code class="classname">SqlParameterSource.createBatch</code> method to create
      this array, passing in either an array of JavaBeans or an array of Maps
      containing the parameter values.</p><p>This example shows a batch update using named parameters:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> NamedParameterTemplate namedParameterJdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.namedParameterJdbcTemplate = <span class="hl-keyword">new</span> NamedParameterJdbcTemplate(dataSource);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span>[] batchUpdate(<span class="hl-keyword">final</span> List&lt;Actor&gt; actors) {
        SqlParameterSource[] batch = SqlParameterSourceUtils.createBatch(actors.toArray());
        <span class="hl-keyword">int</span>[] updateCounts = namedParameterJdbcTemplate.batchUpdate(
            <span class="hl-string">"update t_actor set first_name = :firstName, last_name = :lastName where id = :id"</span>,
            batch);
        <span class="hl-keyword">return</span> updateCounts;
    }

    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>For an SQL statement using the classic "?" placeholders, you
      pass in a list containing an object array with the update values. This
      object array must have one entry for each placeholder in the SQL
      statement, and they must be in the same order as they are defined in the
      SQL statement.</p><p>The same example using classic JDBC "?" placeholders:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span>[] batchUpdate(<span class="hl-keyword">final</span> List&lt;Actor&gt; actors) {
        List&lt;Object[]&gt; batch = <span class="hl-keyword">new</span> ArrayList&lt;Object[]&gt;();
        <span class="hl-keyword">for</span> (Actor actor : actors) {
            Object[] values = <span class="hl-keyword">new</span> Object[] {
                    actor.getFirstName(),
                    actor.getLastName(),
                    actor.getId()};
            batch.add(values);
        }
        <span class="hl-keyword">int</span>[] updateCounts = jdbcTemplate.batchUpdate(
                <span class="hl-string">"update t_actor set first_name = ?, last_name = ? where id = ?"</span>,
                batch);
        <span class="hl-keyword">return</span> updateCounts;
    }

    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>All of the above batch update methods return an int array
      containing the number of affected rows for each batch entry. This count
      is reported by the JDBC driver. If the count is not available, the JDBC
      driver returns a -2 value.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-batch-multi"></a>13.4.3&nbsp;Batch operations with multiple batches</h3></div></div></div><p>The last example of a batch update deals with batches that are so
      large that you want to break them up into several smaller batches. You
      can of course do this with the methods mentioned above by making
      multiple calls to the <code class="classname">batchUpdate</code> method, but
      there is now a more convenient method. This method takes, in addition to
      the SQL statement, a Collection of objects containing the parameters,
      the number of updates to make for each batch and a
      <code class="classname">ParameterizedPreparedStatementSetter</code> to set the
      values for the parameters of the prepared statement. The framework loops
      over the provided values and breaks the update calls into batches of the
      size specified.</p><p>This example shows a batch update using a batch size of
      100:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span>[][] batchUpdate(<span class="hl-keyword">final</span> Collection&lt;Actor&gt; actors) {
        Collection&lt;Object[]&gt; batch = <span class="hl-keyword">new</span> ArrayList&lt;Object[]&gt;();
        <span class="hl-keyword">for</span> (Actor actor : actors) {
            Object[] values = <span class="hl-keyword">new</span> Object[] {
                    actor.getFirstName(),
                    actor.getLastName(),
                    actor.getId()};
            batch.add(values);
        }
        <span class="hl-keyword">int</span>[][] updateCounts = jdbcTemplate.batchUpdate(
                <span class="hl-string">"update t_actor set first_name = ?, last_name = ? where id = ?"</span>,
                actors,
                100,
                <span class="hl-keyword">new</span> ParameterizedPreparedStatementSetter&lt;Actor&gt;() {
                    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setValues(PreparedStatement ps, Actor argument) <span class="hl-keyword">throws</span> SQLException {
                        ps.setString(1, argument.getFirstName());
                        ps.setString(2, argument.getLastName());
                        ps.setLong(3, argument.getId().longValue());
 
                     }
                 } );
        <span class="hl-keyword">return</span> updateCounts;
    }

    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>The batch update methods for this call returns an array of
      int arrays containing an array entry for each batch with an array of the
      number of affected rows for each update. The top level array's length
      indicates the number of batches executed and the second level array's
      length indicates the number of updates in that batch. The number of
      updates in each batch should be the the batch size provided for all
      batches except for the last one that might be less, depending on the
      total number of updat objects provided. The update count for each update
      stament is the one reported by the JDBC driver. If the count is not
      available, the JDBC driver returns a -2 value.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-simple-jdbc"></a>13.5&nbsp;Simplifying JDBC operations with the SimpleJdbc classes</h2></div></div></div><p>The <code class="classname">SimpleJdbcInsert</code> and
    <code class="classname">SimpleJdbcCall</code> classes provide a simplified
    configuration by taking advantage of database metadata that can be
    retrieved through the JDBC driver. This means there is less to configure
    up front, although you can override or turn off the metadata processing if
    you prefer to provide all the details in your code.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-simple-jdbc-insert-1"></a>13.5.1&nbsp;Inserting data using SimpleJdbcInsert</h3></div></div></div><p>Let's start by looking at the
      <code class="classname">SimpleJdbcInsert</code> class with the minimal amount of
      configuration options. You should instantiate the
      <code class="classname">SimpleJdbcInsert</code> in the data access layer's
      initialization method. For this example, the initializing method is the
      <code class="classname">setDataSource</code> method. You do not need to subclass
      the <code class="classname">SimpleJdbcInsert</code> class; simply create a new
      instance and set the table name using the
      <code class="classname">withTableName</code> method. Configuration methods for
      this class follow the "fluid" style that returns the instance of the
      <code class="classname">SimpleJdbcInsert</code>, which allows you to chain all
      configuration methods. This example uses only one configuration method;
      you will see examples of multiple ones later.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> SimpleJdbcTemplate simpleJdbcTemplate;
    <span class="hl-keyword">private</span> SimpleJdbcInsert insertActor;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.simpleJdbcTemplate = <span class="hl-keyword">new</span> SimpleJdbcTemplate(dataSource);
        <span class="hl-keyword">this</span>.insertActor = 
                <span class="hl-keyword">new</span> SimpleJdbcInsert(dataSource).withTableName(<span class="hl-string">"t_actor"</span>);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> add(Actor actor) {
        Map&lt;String, Object&gt; parameters = <span class="hl-keyword">new</span> HashMap&lt;String, Object&gt;(3);
        parameters.put(<span class="hl-string">"id"</span>, actor.getId());
        parameters.put(<span class="hl-string">"first_name"</span>, actor.getFirstName());
        parameters.put(<span class="hl-string">"last_name"</span>, actor.getLastName());
        insertActor.execute(parameters);
    }

    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>The execute method used here takes a plain
      <code class="classname">java.utils.Map</code> as its only parameter. The
      important thing to note here is that the keys used for the Map must
      match the column names of the table as defined in the database. This is
      because we read the metadata in order to construct the actual insert
      statement.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-simple-jdbc-insert-2"></a>13.5.2&nbsp;Retrieving auto-generated keys using SimpleJdbcInsert</h3></div></div></div><p>This example uses the same insert as the preceding, but instead of
      passing in the id it retrieves the auto-generated key and sets it on the
      new Actor object. When you create the
      <code class="classname">SimpleJdbcInsert</code>, in addition to specifying the
      table name, you specify the name of the generated key column with the
      <code class="classname">usingGeneratedKeyColumns</code> method.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> SimpleJdbcTemplate simpleJdbcTemplate;
    <span class="hl-keyword">private</span> SimpleJdbcInsert insertActor;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.simpleJdbcTemplate = <span class="hl-keyword">new</span> SimpleJdbcTemplate(dataSource);
        <span class="hl-keyword">this</span>.insertActor =
                <span class="hl-keyword">new</span> SimpleJdbcInsert(dataSource)
                        .withTableName(<span class="hl-string">"t_actor"</span>)
                        .usingGeneratedKeyColumns(<span class="hl-string">"id"</span>);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> add(Actor actor) {
        Map&lt;String, Object&gt; parameters = <span class="hl-keyword">new</span> HashMap&lt;String, Object&gt;(2);
        parameters.put(<span class="hl-string">"first_name"</span>, actor.getFirstName());
        parameters.put(<span class="hl-string">"last_name"</span>, actor.getLastName());
        Number newId = insertActor.executeAndReturnKey(parameters);
        actor.setId(newId.longValue());
    }

    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>The main difference when executing the insert by this second
      approach is that you do not add the id to the Map and you call the
      <code class="literal">executeReturningKey</code> method. This returns a
      <code class="literal">java.lang.Number</code> object with which you can create an
      instance of the numerical type that is used in our domain class.You
      cannot rely on all databases to return a specific Java class here;
      <code class="literal">java.lang.Number</code> is the base class that you can rely
      on. If you have multiple auto-generated columns, or the generated values
      are non-numeric, then you can use a <code class="literal">KeyHolder</code> that is
      returned from the <code class="literal">executeReturningKeyHolder</code>
      method.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-simple-jdbc-insert-3"></a>13.5.3&nbsp;Specifying columns for a SimpleJdbcInsert</h3></div></div></div><p>You can limit the columns for an insert by specifying a list of
      column names with the <code class="classname">usingColumns</code> method:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> SimpleJdbcTemplate simpleJdbcTemplate;
    <span class="hl-keyword">private</span> SimpleJdbcInsert insertActor;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.simpleJdbcTemplate = <span class="hl-keyword">new</span> SimpleJdbcTemplate(dataSource);
        <span class="hl-keyword">this</span>.insertActor =
                <span class="hl-keyword">new</span> SimpleJdbcInsert(dataSource)
                        .withTableName(<span class="hl-string">"t_actor"</span>)
                        .usingColumns(<span class="hl-string">"first_name"</span>, <span class="hl-string">"last_name"</span>)
                        .usingGeneratedKeyColumns(<span class="hl-string">"id"</span>);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> add(Actor actor) {
        Map&lt;String, Object&gt; parameters = <span class="hl-keyword">new</span> HashMap&lt;String, Object&gt;(2);
        parameters.put(<span class="hl-string">"first_name"</span>, actor.getFirstName());
        parameters.put(<span class="hl-string">"last_name"</span>, actor.getLastName());
        Number newId = insertActor.executeAndReturnKey(parameters);
        actor.setId(newId.longValue());
    }

    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>The execution of the insert is the same as if you had relied
      on the metadata to determine which columns to use.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-simple-jdbc-parameters"></a>13.5.4&nbsp;Using SqlParameterSource to provide parameter values</h3></div></div></div><p>Using a <code class="classname">Map</code> to provide parameter values
      works fine, but it's not the most convenient class to use. Spring
      provides a couple of implementations of the
      <code class="classname">SqlParameterSource</code> interface that can be used
      instead.The
      first one is <code class="classname">BeanPropertySqlParameterSource</code>,
      which is a very convenient class if you have a JavaBean-compliant class
      that contains your values. It will use the corresponding getter method
      to extract the parameter values. Here is an example:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> SimpleJdbcTemplate simpleJdbcTemplate;
    <span class="hl-keyword">private</span> SimpleJdbcInsert insertActor;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.simpleJdbcTemplate = <span class="hl-keyword">new</span> SimpleJdbcTemplate(dataSource);
        <span class="hl-keyword">this</span>.insertActor =
                <span class="hl-keyword">new</span> SimpleJdbcInsert(dataSource)
                        .withTableName(<span class="hl-string">"t_actor"</span>)
                        .usingGeneratedKeyColumns(<span class="hl-string">"id"</span>);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> add(Actor actor) {
        SqlParameterSource parameters = <span class="hl-keyword">new</span> BeanPropertySqlParameterSource(actor);
        Number newId = insertActor.executeAndReturnKey(parameters);
        actor.setId(newId.longValue());
    }

    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>Another option is the
      <code class="classname">MapSqlParameterSource</code> that resembles a Map but
      provides a more convenient <code class="classname">addValue</code> method that
      can be chained.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> SimpleJdbcTemplate simpleJdbcTemplate;
    <span class="hl-keyword">private</span> SimpleJdbcInsert insertActor;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.simpleJdbcTemplate = <span class="hl-keyword">new</span> SimpleJdbcTemplate(dataSource);
        <span class="hl-keyword">this</span>.insertActor =
                <span class="hl-keyword">new</span> SimpleJdbcInsert(dataSource)
                        .withTableName(<span class="hl-string">"t_actor"</span>)
                        .usingGeneratedKeyColumns(<span class="hl-string">"id"</span>);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> add(Actor actor) {
        SqlParameterSource parameters = <span class="hl-keyword">new</span> MapSqlParameterSource()
                .addValue(<span class="hl-string">"first_name"</span>, actor.getFirstName())
                .addValue(<span class="hl-string">"last_name"</span>, actor.getLastName());
        Number newId = insertActor.executeAndReturnKey(parameters);
        actor.setId(newId.longValue());
    }

    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>As you can see, the configuration is the same; only the
      executing code has to change to use these alternative input
      classes.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-simple-jdbc-call-1"></a>13.5.5&nbsp;Calling a stored procedure with SimpleJdbcCall</h3></div></div></div><p>The <code class="classname">SimpleJdbcCall</code> class leverages metadata
      in the database to look up names of <code class="code">in</code> and <code class="code">out</code>
      parameters, so that you do not have to declare them explicitly. You can
      declare parameters if you prefer to do that, or if you have parameters
      such as <code class="code">ARRAY</code> or <code class="code">STRUCT</code> that do not have an
      automatic mapping to a Java class. The first example shows a simple
      procedure that returns only scalar values in <code class="code">VARCHAR</code> and
      <code class="code">DATE</code> format from a MySQL database. The example procedure
      reads a specified actor entry and returns <code class="code">first_name</code>,
      <code class="code">last_name</code>, and <code class="code">birth_date</code> columns in the form
      of <code class="code">out</code> parameters.</p><pre class="programlisting">CREATE PROCEDURE read_actor ( 
  IN in_id INTEGER, 
  OUT out_first_name VARCHAR(100), 
  OUT out_last_name VARCHAR(100), 
  OUT out_birth_date DATE) 
BEGIN 
  SELECT first_name, last_name, birth_date 
  INTO out_first_name, out_last_name, out_birth_date 
  FROM t_actor where id = in_id;
END;</pre><p>The <code class="code">in_id</code> parameter contains the
      <code class="code">id</code> of the actor you are looking up. The <code class="code">out</code>
      parameters return the data read from the table.</p><p>The <code class="classname">SimpleJdbcCall</code> is declared in a similar
      manner to the <code class="classname">SimpleJdbcInsert</code>. You should
      instantiate and configure the class in the initialization method of your
      data access layer. Compared to the StoredProcedure class, you don't have
      to create a subclass and you don't have to declare parameters that can
      be looked up in the database metadata. Following
      is an example of a SimpleJdbcCall configuration using the above stored
      procedure. The only configuration option, in addition to the
      <code class="classname">DataSource</code>, is the name of the stored
      procedure.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> SimpleJdbcTemplate simpleJdbcTemplate;
    <span class="hl-keyword">private</span> SimpleJdbcCall procReadActor;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.simpleJdbcTemplate = <span class="hl-keyword">new</span> SimpleJdbcTemplate(dataSource);
        <span class="hl-keyword">this</span>.procReadActor =
                <span class="hl-keyword">new</span> SimpleJdbcCall(dataSource)
                        .withProcedureName(<span class="hl-string">"read_actor"</span>);
    }

    <span class="hl-keyword">public</span> Actor readActor(Long id) {
        SqlParameterSource in = <span class="hl-keyword">new</span> MapSqlParameterSource()
                .addValue(<span class="hl-string">"in_id"</span>, id); 
        Map out = procReadActor.execute(in);
        Actor actor = <span class="hl-keyword">new</span> Actor();
        actor.setId(id);
        actor.setFirstName((String) out.get(<span class="hl-string">"out_first_name"</span>));
        actor.setLastName((String) out.get(<span class="hl-string">"out_last_name"</span>));
        actor.setBirthDate((Date) out.get(<span class="hl-string">"out_birth_date"</span>));
        <span class="hl-keyword">return</span> actor;
    }

    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>The code you write for the execution of the call involves
      creating an <code class="classname">SqlParameterSource</code> containing the IN
      parameter. It's
      important to match the name provided for the input value with that of
      the parameter name declared
      in the stored procedure. The case does not have to match because you use
      metadata to determine how database objects should be referred to in a
      stored procedure. What is specified in the source for the stored
      procedure is not necessarily the way it is stored in the database. Some
      databases transform names to all upper case while others use lower case
      or use the case as specified.</p><p>The <code class="classname">execute</code> method takes the IN parameters
      and returns a Map containing any <code class="code">out</code> parameters keyed by
      the name as specified in the stored procedure. In this case they are
      <code class="classname">out_first_name, out_last_name</code> and
      <code class="classname">out_birth_date</code>.</p><p>The last part of the <code class="classname">execute</code> method creates
      an Actor instance to use to return the data retrieved. Again, it is
      important to use the names of the <code class="code">out</code> parameters as they
      are declared in the stored procedure. Also,
      the case in the names of the <code class="code">out</code> parameters stored in the
      results map matches that of the <code class="code">out</code> parameter names in the
      database, which could vary between databases. To
      make your code more portable you should do a case-insensitive lookup or
      instruct Spring to use a <code class="classname">CaseInsensitiveMap</code> from
      the Jakarta Commons project. To do the latter, you create your own
      <code class="classname">JdbcTemplate</code> and set the
      <code class="classname">setResultsMapCaseInsensitive</code> property to
      <code class="classname">true</code>. Then you pass this customized
      <code class="classname">JdbcTemplate</code> instance into the constructor of
      your <code class="classname">SimpleJdbcCall</code>. You must include the
      <code class="classname">commons-collections.jar</code> in your classpath for
      this to work. Here is an example of this configuration:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> SimpleJdbcCall procReadActor;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        JdbcTemplate jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
        jdbcTemplate.setResultsMapCaseInsensitive(true);
        <span class="hl-keyword">this</span>.procReadActor =
                <span class="hl-keyword">new</span> SimpleJdbcCall(jdbcTemplate)
                        .withProcedureName(<span class="hl-string">"read_actor"</span>);
    }


    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>By taking this action, you avoid conflicts in the case used
      for the names of your returned <code class="code">out</code> parameters.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-simple-jdbc-call-2"></a>13.5.6&nbsp;Explicitly declaring parameters to use for a
      SimpleJdbcCall</h3></div></div></div><p>You have seen how the parameters are deduced based on metadata,
      but you can declare then explicitly if you wish. You do this by creating
      and configuring <code class="classname">SimpleJdbcCall</code> with the
      <code class="classname">declareParameters</code> method, which takes a variable
      number of <code class="classname">SqlParameter</code> objects as input. See the
      next section for details on how to define an
      <code class="classname">SqlParameter</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Explicit declarations are necessary if the database you use is
          not a Spring-supported database. Currently Spring supports metadata
          lookup of stored procedure calls for the following databases: Apache
          Derby, DB2, MySQL, Microsoft SQL Server, Oracle, and Sybase. We also
          support metadata lookup of stored functions for: MySQL, Microsoft
          SQL Server, and Oracle.</p></td></tr></table></div><p>You can opt to declare one, some, or all the parameters
      explicitly. The parameter metadata is still used where you do not
      declare parameters explicitly. To
      bypass all processing of metadata lookups for potential parameters and
      only use the declared parameters, you call the method
      <code class="classname">withoutProcedureColumnMetaDataAccess</code> as part of
      the declaration. Suppose that you have two or more different call
      signatures declared for a database function. In this case you call the
      <code class="classname">useInParameterNames</code> to specify the list of IN
      parameter names to include for a given signature.</p><p>The following example shows a fully declared procedure call, using
      the information from the preceding example.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> SimpleJdbcCall procReadActor;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        JdbcTemplate jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
        jdbcTemplate.setResultsMapCaseInsensitive(true);
        <span class="hl-keyword">this</span>.procReadActor =
                <span class="hl-keyword">new</span> SimpleJdbcCall(jdbcTemplate)
                        .withProcedureName(<span class="hl-string">"read_actor"</span>)
                        .withoutProcedureColumnMetaDataAccess()
                        .useInParameterNames(<span class="hl-string">"in_id"</span>)
                        .declareParameters(
                                <span class="hl-keyword">new</span> SqlParameter(<span class="hl-string">"in_id"</span>, Types.NUMERIC),
                                <span class="hl-keyword">new</span> SqlOutParameter(<span class="hl-string">"out_first_name"</span>, Types.VARCHAR),
                                <span class="hl-keyword">new</span> SqlOutParameter(<span class="hl-string">"out_last_name"</span>, Types.VARCHAR),
                                <span class="hl-keyword">new</span> SqlOutParameter(<span class="hl-string">"out_birth_date"</span>, Types.DATE)
                        );
    }


    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>The execution and end results of the two examples are the
      same; this one specifies all details explicitly rather than relying on
      metadata.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-params"></a>13.5.7&nbsp;How to define SqlParameters</h3></div></div></div><p>To define a parameter for the SimpleJdbc classes and also for the
      RDBMS operations classes, covered in <a class="xref" href="#jdbc-object" title="13.6&nbsp;Modeling JDBC operations as Java objects">Section&nbsp;13.6, &#8220;Modeling JDBC operations as Java objects&#8221;</a>,
      you
      use an <code class="classname">SqlParameter</code> or one of its subclasses. You
      typically specify the parameter name and SQL type in the constructor.
      The SQL type is specified using the
      <code class="classname">java.sql.Types</code> constants. We have already seen
      declarations like:</p><pre class="programlisting">   <span class="hl-keyword">new</span> SqlParameter(<span class="hl-string">"in_id"</span>, Types.NUMERIC),
   <span class="hl-keyword">new</span> SqlOutParameter(<span class="hl-string">"out_first_name"</span>, Types.VARCHAR),</pre><p>The first line with the <code class="classname">SqlParameter</code>
      declares an IN parameter. IN parameters can be used for both stored
      procedure calls and for queries using the
      <code class="classname">SqlQuery</code> and its subclasses covered in the
      following section.</p><p>The second line with the <code class="classname">SqlOutParameter</code>
      declares an <code class="code">out</code> parameter to be used in a stored procedure
      call. There is also an <code class="classname">SqlInOutParameter</code> for
      <code class="code">InOut</code> parameters, parameters that provide an
      <code class="code">IN</code> value to the procedure and that also return a
      value.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Only parameters declared as <code class="classname">SqlParameter</code>
        and <code class="classname">SqlInOutParameter</code> will be used to provide
        input values. This is different from the
        <code class="classname">StoredProcedure</code> class, which for backwards
        compatibility reasons allows input values to be provided for
        parameters declared as <code class="classname">SqlOutParameter</code>.</p></td></tr></table></div><p>For IN parameters, in addition to the name and the SQL type, you
      can specify a scale for numeric data or a type name for custom database
      types. For <code class="code">out</code> parameters, you can provide a
      <code class="classname">RowMapper</code> to handle mapping of rows returned from
      a <code class="code">REF</code> cursor. Another option is to specify an
      <code class="classname">SqlReturnType</code> that provides an opportunity to
      define customized handling of the return values.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-simple-jdbc-call-3"></a>13.5.8&nbsp;Calling a stored function using SimpleJdbcCall</h3></div></div></div><p>You call a stored function in almost the same way as you call a
      stored procedure, except that you provide a function name rather than a
      procedure name. You use the <code class="classname">withFunctionName</code>
      method as part of the configuration to indicate that we want to make a
      call to a function, and the corresponding string for a function call is
      generated. A specialized execute call,
      <code class="classname">executeFunction,</code> is used to execute the function
      and it returns the function return value as an object of a specified
      type, which means you do not have to retrieve the return value from the
      results map. A
      similar convenience method named <code class="classname">executeObject</code> is
      also available for stored procedures that only have one <code class="code">out</code>
      parameter. The following example is based on a stored function named
      <code class="classname">get_actor_name</code> that returns an actor's full name.
      Here is the MySQL source for this function:</p><pre class="programlisting">CREATE FUNCTION get_actor_name (in_id INTEGER)
RETURNS VARCHAR(200) READS SQL DATA 
BEGIN
  DECLARE out_name VARCHAR(200);
  SELECT concat(first_name, ' ', last_name)
    INTO out_name
    FROM t_actor where id = in_id;
  RETURN out_name;
END;</pre><p>To call this function we again create a
      <code class="classname">SimpleJdbcCall</code> in the initialization
      method.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> SimpleJdbcTemplate simpleJdbcTemplate;
    <span class="hl-keyword">private</span> SimpleJdbcCall funcGetActorName;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.simpleJdbcTemplate = <span class="hl-keyword">new</span> SimpleJdbcTemplate(dataSource);
        JdbcTemplate jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
        jdbcTemplate.setResultsMapCaseInsensitive(true);
        <span class="hl-keyword">this</span>.funcGetActorName =
                <span class="hl-keyword">new</span> SimpleJdbcCall(jdbcTemplate)
                        .withFunctionName(<span class="hl-string">"get_actor_name"</span>);
    }

    <span class="hl-keyword">public</span> String getActorName(Long id) {
        SqlParameterSource in = <span class="hl-keyword">new</span> MapSqlParameterSource()
                .addValue(<span class="hl-string">"in_id"</span>, id); 
        String name = funcGetActorName.executeFunction(String.<span class="hl-keyword">class</span>, in);
        <span class="hl-keyword">return</span> name;
    }

    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>The execute method used
      returns a <code class="classname">String</code> containing the return value from
      the function call.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-simple-jdbc-call-4"></a>13.5.9&nbsp;Returning ResultSet/REF Cursor from a SimpleJdbcCall</h3></div></div></div><p>Calling a stored procedure or function that returns a result set
      is a bit tricky. Some databases return result sets during the JDBC
      results processing while others require an explicitly registered
      <code class="code">out</code> parameter of a specific type. Both approaches need
      additional processing to loop over the result set and process the
      returned rows. With the <code class="classname">SimpleJdbcCall</code> you use
      the <code class="classname">returningResultSet</code> method and declare a
      <code class="classname">RowMapper</code> implementation to be used for a
      specific parameter. In the case where the result set is returned during
      the results processing, there are no names defined, so the returned
      results will have to match the order in which you declare the
      <code class="classname">RowMapper</code> implementations. The name specified is
      still used to store the processed list of results in the results map
      that is returned from the execute statement.</p><p>The next example uses a stored procedure that takes no IN
      parameters and returns all rows from the t_actor table. Here is the
      MySQL source for this procedure:</p><pre class="programlisting">CREATE PROCEDURE read_all_actors()
BEGIN
 SELECT a.id, a.first_name, a.last_name, a.birth_date FROM t_actor a;
END;</pre><p>To call this procedure you declare the
      <code class="classname">RowMapper</code>. Because the class you want to map to
      follows the JavaBean rules, you can use a
      <code class="classname">ParameterizedBeanPropertyRowMapper</code> that is
      created by passing in the required class to map to in the
      <code class="classname">newInstance</code> method.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> SimpleJdbcTemplate simpleJdbcTemplate;
    <span class="hl-keyword">private</span> SimpleJdbcCall procReadAllActors;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.simpleJdbcTemplate = <span class="hl-keyword">new</span> SimpleJdbcTemplate(dataSource);
        JdbcTemplate jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
        jdbcTemplate.setResultsMapCaseInsensitive(true);
        <span class="hl-keyword">this</span>.procReadAllActors =
                <span class="hl-keyword">new</span> SimpleJdbcCall(jdbcTemplate)
                        .withProcedureName(<span class="hl-string">"read_all_actors"</span>)
                        .returningResultSet(<span class="hl-string">"actors"</span>,
                                ParameterizedBeanPropertyRowMapper.newInstance(Actor.<span class="hl-keyword">class</span>));
    }

    <span class="hl-keyword">public</span> List getActorsList() {
        Map m = procReadAllActors.execute(<span class="hl-keyword">new</span> HashMap&lt;String, Object&gt;(0));
        <span class="hl-keyword">return</span> (List) m.get(<span class="hl-string">"actors"</span>);
    }

    <span class="hl-comment">//  ... additional methods</span>
}</pre><p>The execute call passes in an empty Map because this call
      does not take any parameters. The list of Actors is then retrieved from
      the results map and returned to the caller.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-object"></a>13.6&nbsp;Modeling JDBC operations as Java objects</h2></div></div></div><p>The <code class="literal">org.springframework.jdbc.object</code> package
    contains classes that allow you to access the database in a more
    object-oriented manner. As an example, you can execute queries and get the
    results back as a list containing business objects with the relational
    column data mapped to the properties of the business object. You can also
    execute stored procedures and run update, delete, and insert
    statements.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Many Spring developers believe that the various RDBMS operation
      classes described below (with the exception of the <a class="link" href="#jdbc-StoredProcedure" title="13.6.4&nbsp;StoredProcedure"><code class="classname">StoredProcedure</code></a>
      class) can often be replaced with straight
      <code class="classname">JdbcTemplate</code> calls. Often it is simpler to write
      a DAO method that simply calls a method on a
      <code class="classname">JdbcTemplate</code> directly (as opposed to
      encapsulating a query as a full-blown class).</p><p>However, if you are getting measurable value from using the RDBMS
      operation classes, continue using these classes.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SqlQuery"></a>13.6.1&nbsp;<code class="classname">SqlQuery</code></h3></div></div></div><p><code class="classname">SqlQuery</code> is a reusable, threadsafe class
      that encapsulates an SQL query. Subclasses must implement the
      <code class="methodname">newRowMapper(..)</code> method to provide a
      <code class="interfacename">RowMapper</code> instance that can create one
      object per row obtained from iterating over the
      <code class="interfacename">ResultSet</code> that is created during the
      execution of the query. The <code class="classname">SqlQuery</code> class is
      rarely used directly because the <code class="classname">MappingSqlQuery</code>
      subclass provides a much more convenient implementation for mapping rows
      to Java classes. Other implementations that extend
      <code class="classname">SqlQuery</code> are
      <code class="classname">MappingSqlQueryWithParameters</code> and
      <code class="classname">UpdatableSqlQuery</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-MappingSqlQuery"></a>13.6.2&nbsp;<code class="classname">MappingSqlQuery</code></h3></div></div></div><p><code class="classname">MappingSqlQuery</code> is a reusable query in
      which concrete subclasses must implement the abstract
      <code class="methodname">mapRow(..)</code> method to convert each row of the
      supplied <code class="interfacename">ResultSet</code> into an object of the
      type specified. The following example shows a custom query that maps the
      data from the <code class="code">t_actor</code> relation to an instance of the
      <code class="classname">Actor</code> class.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ActorMappingQuery <span class="hl-keyword">extends</span> MappingSqlQuery&lt;Actor&gt; {

    <span class="hl-keyword">public</span> ActorMappingQuery(DataSource ds) {
        <span class="hl-keyword">super</span>(ds, <span class="hl-string">"select id, first_name, last_name from t_actor where id = ?"</span>);
        <span class="hl-keyword">super</span>.declareParameter(<span class="hl-keyword">new</span> SqlParameter(<span class="hl-string">"id"</span>, Types.INTEGER));
        compile();
    }

    @Override
    <span class="hl-keyword">protected</span> Actor mapRow(ResultSet rs, <span class="hl-keyword">int</span> rowNumber) <span class="hl-keyword">throws</span> SQLException {
        Actor actor = <span class="hl-keyword">new</span> Actor();
        actor.setId(rs.getLong(<span class="hl-string">"id"</span>));
        actor.setFirstName(rs.getString(<span class="hl-string">"first_name"</span>));
        actor.setLastName(rs.getString(<span class="hl-string">"last_name"</span>));
        <span class="hl-keyword">return</span> actor;
    }

}</pre><p>The class extends <code class="classname">MappingSqlQuery</code>
      parameterized with the <code class="classname">Actor</code> type. The
      constructor for this customer query takes the
      <code class="interfacename">DataSource</code> as the only parameter. In this
      constructor you call the constructor on the superclass with the
      <code class="interfacename">DataSource</code> and the SQL that should be
      executed to retrieve the rows for this query. This SQL will be used to
      create a <code class="interfacename">PreparedStatement</code> so it may
      contain place holders for any parameters to be passed in during
      execution.You
      must declare each parameter using the
      <code class="literal">declareParameter</code> method passing in an
      <code class="classname">SqlParameter</code>. The
      <code class="classname">SqlParameter</code> takes a name and the JDBC type as
      defined in <code class="classname">java.sql.Types</code>. After you define all
      parameters, you call the <code class="literal">compile()</code> method so the
      statement can be prepared and later executed. This class is thread-safe
      after it is compiled, so as long as these instances
      are created when the DAO is initialized they can be kept as instance
      variables and be reused.</p><pre class="programlisting"><span class="hl-keyword">private</span> ActorMappingQuery actorMappingQuery;

@Autowired
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
    <span class="hl-keyword">this</span>.actorMappingQuery = <span class="hl-keyword">new</span> ActorMappingQuery(dataSource);
}

<span class="hl-keyword">public</span> Customer getCustomer(Long id) {
    <span class="hl-keyword">return</span> actorMappingQuery.findObject(id);
}</pre><p>The method in this example retrieves the customer with the id that
      is passed in as the only parameter. Since we only want one object
      returned we simply call the convenience method <code class="code">findObject</code>
      with the id as parameter. If we had instead a query that returned a list
      of objects and took additional parameters then we would use one of the
      execute methods that takes an array of parameter values passed in as
      varargs.</p><pre class="programlisting"><span class="hl-keyword">public</span> List&lt;Actor&gt; searchForActors(<span class="hl-keyword">int</span> age, String namePattern) {
    List&lt;Actor&gt; actors = actorSearchMappingQuery.execute(age, namePattern);
    <span class="hl-keyword">return</span> actors;
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SqlUpdate"></a>13.6.3&nbsp;<code class="classname">SqlUpdate</code></h3></div></div></div><p>The <code class="classname">SqlUpdate</code> class encapsulates an SQL
      update. Like a query, an update object is reusable, and like all
      <code class="classname">RdbmsOperation</code> classes, an update can have
      parameters and is defined in SQL. This class provides a number of
      <code class="methodname">update(..)</code> methods analogous to the
      <code class="methodname">execute(..)</code> methods of query objects. The
      <code class="classname">SQLUpdate</code> class is concrete. It can be
      subclassed, for example, to add a custom update method, as in the
      following snippet where it's simply called
      <code class="classname">execute</code>. However,
      you don't have to subclass the <code class="classname">SqlUpdate</code> class
      since it can easily be parameterized by setting SQL and declaring
      parameters.</p><pre class="programlisting"><span class="hl-keyword">import</span> java.sql.Types;

<span class="hl-keyword">import</span> javax.sql.DataSource;

<span class="hl-keyword">import</span> org.springframework.jdbc.core.SqlParameter;
<span class="hl-keyword">import</span> org.springframework.jdbc.object.SqlUpdate;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UpdateCreditRating <span class="hl-keyword">extends</span> SqlUpdate {

    <span class="hl-keyword">public</span> UpdateCreditRating(DataSource ds) {
        setDataSource(ds);
        setSql(<span class="hl-string">"update customer set credit_rating = ? where id = ?"</span>);
        declareParameter(<span class="hl-keyword">new</span> SqlParameter(<span class="hl-string">"creditRating"</span>, Types.NUMERIC));
        declareParameter(<span class="hl-keyword">new</span> SqlParameter(<span class="hl-string">"id"</span>, Types.NUMERIC));
        compile();
    }

    <span class="hl-comment">/**
     * @param id for the Customer to be updated
     * @param rating the new value for credit rating
     * @return number of rows updated
     */</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> execute(<span class="hl-keyword">int</span> id, <span class="hl-keyword">int</span> rating) {
        <span class="hl-keyword">return</span> update(rating, id);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-StoredProcedure"></a>13.6.4&nbsp;<code class="classname">StoredProcedure</code></h3></div></div></div><p>The <code class="classname">StoredProcedure</code> class is a superclass
      for object abstractions of RDBMS stored procedures. This class is
      <code class="literal">abstract</code>, and its various
      <code class="literal">execute(..)</code> methods have <code class="literal">protected</code>
      access, preventing use other than through a subclass that offers tighter
      typing.</p><p>The inherited <code class="literal">sql</code> property will be the name of
      the stored procedure in the RDBMS.</p><p>To define a parameter for the
      <code class="classname">StoredProcedure</code> class, you use an
      <code class="classname">SqlParameter</code> or one of its subclasses. You must
      specify the parameter name and SQL type in the constructor like in the
      following code snippet. The SQL type is specified using the
      <code class="classname">java.sql.Types</code> constants.</p><pre class="programlisting">   <span class="hl-keyword">new</span> SqlParameter(<span class="hl-string">"in_id"</span>, Types.NUMERIC),
   <span class="hl-keyword">new</span> SqlOutParameter(<span class="hl-string">"out_first_name"</span>, Types.VARCHAR),</pre><p>The first line with the <code class="classname">SqlParameter</code>
      declares an IN parameter. IN parameters can be used for both stored
      procedure calls and for queries using the
      <code class="classname">SqlQuery</code> and its subclasses covered in the
      following section.</p><p>The second line with the <code class="classname">SqlOutParameter</code>
      declares an <code class="code">out</code> parameter to be used in the stored
      procedure call. There is also an
      <code class="classname">SqlInOutParameter</code> for
      <code class="code">I</code><code class="code">nOut</code> parameters, parameters that provide an
      <code class="code">in</code> value to the procedure and that also return a
      value.</p><p>For <code class="code">i</code><code class="code">n</code> parameters, in addition to the
      name and the SQL type, you can specify a scale for numeric data or a
      type name for custom database types. For <code class="code">out</code> parameters you
      can provide a <code class="classname">RowMapper</code> to handle mapping of rows
      returned from a REF cursor. Another option is to specify an
      <code class="classname">SqlReturnType</code> that enables you to define
      customized handling of the return values.</p><p>Here is an example of a simple DAO that uses a
      <code class="classname">StoredProcedure</code> to call a function,
      <code class="literal">sysdate()</code>,which comes with any Oracle database. To
      use the stored procedure functionality you have to create a class that
      extends <code class="classname">StoredProcedure</code>. In this example, the
      <code class="classname">StoredProcedure</code> class is an inner class, but if
      you need to reuse the <code class="classname">StoredProcedure</code> you declare
      it as a top-level class. This example has no input parameters, but an
      output parameter is declared as a date type using the class
      <code class="classname">SqlOutParameter</code>. The <code class="literal">execute()</code>
      method executes the procedure and extracts the returned date from the
      results <code class="classname">Map</code>. The results
      <code class="classname">Map</code> has an entry for each declared output
      parameter, in this case only one, using the parameter name as the
      key.</p><pre class="programlisting"><span class="hl-keyword">import</span> java.sql.Types;
<span class="hl-keyword">import</span> java.util.Date;
<span class="hl-keyword">import</span> java.util.HashMap;
<span class="hl-keyword">import</span> java.util.Map;

<span class="hl-keyword">import</span> javax.sql.DataSource;

<span class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hl-keyword">import</span> org.springframework.jdbc.core.SqlOutParameter;
<span class="hl-keyword">import</span> org.springframework.jdbc.object.StoredProcedure;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> StoredProcedureDao {

    <span class="hl-keyword">private</span> GetSysdateProcedure getSysdate;
    
    @Autowired
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init(DataSource dataSource) {
        <span class="hl-keyword">this</span>.getSysdate = <span class="hl-keyword">new</span> GetSysdateProcedure(dataSource);
    }
    
    <span class="hl-keyword">public</span> Date getSysdate() {
        <span class="hl-keyword">return</span> getSysdate.execute();
    }

    <span class="hl-keyword">private</span> <span class="hl-keyword">class</span> GetSysdateProcedure <span class="hl-keyword">extends</span> StoredProcedure {
        
        <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> String SQL = <span class="hl-string">"sysdate"</span>;

        <span class="hl-keyword">public</span> GetSysdateProcedure(DataSource dataSource) {
            setDataSource(dataSource);
            setFunction(true);
            setSql(SQL);
            declareParameter(<span class="hl-keyword">new</span> SqlOutParameter(<span class="hl-string">"date"</span>, Types.DATE));
            compile();
        }

        <span class="hl-keyword">public</span> Date execute() {
            <span class="hl-comment">// the 'sysdate' sproc has no input parameters, so an empty Map is supplied...</span>
            Map&lt;String, Object&gt; results = execute(<span class="hl-keyword">new</span> HashMap&lt;String, Object&gt;());
            Date sysdate = (Date) results.get(<span class="hl-string">"date"</span>);
            <span class="hl-keyword">return</span> sysdate;    
        }
    }

}</pre><p>The following example of a <code class="classname">StoredProcedure</code>
      has two output parameters (in this case, Oracle REF cursors).</p><pre class="programlisting"><span class="hl-keyword">import</span> oracle.jdbc.OracleTypes;
<span class="hl-keyword">import</span> org.springframework.jdbc.core.SqlOutParameter;
<span class="hl-keyword">import</span> org.springframework.jdbc.object.StoredProcedure;

<span class="hl-keyword">import</span> javax.sql.DataSource;
<span class="hl-keyword">import</span> java.util.HashMap;
<span class="hl-keyword">import</span> java.util.Map;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TitlesAndGenresStoredProcedure <span class="hl-keyword">extends</span> StoredProcedure {

    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> String SPROC_NAME = <span class="hl-string">"AllTitlesAndGenres"</span>;

    <span class="hl-keyword">public</span> TitlesAndGenresStoredProcedure(DataSource dataSource) {
        <span class="hl-keyword">super</span>(dataSource, SPROC_NAME);
        declareParameter(<span class="hl-keyword">new</span> SqlOutParameter(<span class="hl-string">"titles"</span>, OracleTypes.CURSOR, <span class="hl-keyword">new</span> TitleMapper()));
        declareParameter(<span class="hl-keyword">new</span> SqlOutParameter(<span class="hl-string">"genres"</span>, OracleTypes.CURSOR, <span class="hl-keyword">new</span> GenreMapper()));
        compile();
    }

    <span class="hl-keyword">public</span> Map&lt;String, Object&gt; execute() {
        <span class="hl-comment">// again, this sproc has no input parameters, so an empty Map is supplied</span>
        <span class="hl-keyword">return</span> <span class="hl-keyword">super</span>.execute(<span class="hl-keyword">new</span> HashMap&lt;String, Object&gt;());
    }
}</pre><p>Notice how the overloaded variants of the
      <code class="literal">declareParameter(..)</code> method that have been used in
      the <code class="classname">TitlesAndGenresStoredProcedure</code> constructor
      are passed <code class="interfacename">RowMapper</code> implementation
      instances; this is a very convenient and powerful way to reuse existing
      functionality. The code for the two
      <code class="interfacename">RowMapper</code> implementations is provided
      below.</p><p>The <code class="classname">TitleMapper</code> class maps a
      <code class="interfacename">ResultSet</code> to a
      <code class="classname">Title</code> domain object for each row in the supplied
      <code class="interfacename">ResultSet</code>:</p><pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.jdbc.core.RowMapper;

<span class="hl-keyword">import</span> java.sql.ResultSet;
<span class="hl-keyword">import</span> java.sql.SQLException;

<span class="hl-keyword">import</span> com.foo.domain.Title;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> TitleMapper <span class="hl-keyword">implements</span> RowMapper&lt;Title&gt; {
    
    <span class="hl-keyword">public</span> Title mapRow(ResultSet rs, <span class="hl-keyword">int</span> rowNum) <span class="hl-keyword">throws</span> SQLException {
        Title title = <span class="hl-keyword">new</span> Title();
        title.setId(rs.getLong(<span class="hl-string">"id"</span>));
        title.setName(rs.getString(<span class="hl-string">"name"</span>));
        <span class="hl-keyword">return</span> title;
    }
}</pre><p>The <code class="classname">GenreMapper</code> class maps a
      <code class="interfacename">ResultSet</code> to a
      <code class="classname">Genre</code> domain object for each row in the supplied
      <code class="interfacename">ResultSet</code>.</p><pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.jdbc.core.RowMapper;

<span class="hl-keyword">import</span> java.sql.ResultSet;
<span class="hl-keyword">import</span> java.sql.SQLException;

<span class="hl-keyword">import</span> com.foo.domain.Genre;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> GenreMapper <span class="hl-keyword">implements</span> RowMapper&lt;Genre&gt; {
    
    <span class="hl-keyword">public</span> Genre mapRow(ResultSet rs, <span class="hl-keyword">int</span> rowNum) <span class="hl-keyword">throws</span> SQLException {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Genre(rs.getString(<span class="hl-string">"name"</span>));
    }
}</pre><p>To pass parameters to a stored procedure that has one or more
      input parameters in its definition in the RDBMS, you can code a strongly
      typed <code class="literal">execute(..)</code> method that would delegate to the
      superclass' untyped <code class="literal">execute(Map parameters)</code> method
      (which has <code class="literal">protected</code> access); for
      example:</p><pre class="programlisting"><span class="hl-keyword">import</span> oracle.jdbc.OracleTypes;
<span class="hl-keyword">import</span> org.springframework.jdbc.core.SqlOutParameter;
<span class="hl-keyword">import</span> org.springframework.jdbc.core.SqlParameter;
<span class="hl-keyword">import</span> org.springframework.jdbc.object.StoredProcedure;

<span class="hl-keyword">import</span> javax.sql.DataSource;

<span class="hl-keyword">import</span> java.sql.Types;
<span class="hl-keyword">import</span> java.util.Date;
<span class="hl-keyword">import</span> java.util.HashMap;
<span class="hl-keyword">import</span> java.util.Map;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TitlesAfterDateStoredProcedure <span class="hl-keyword">extends</span> StoredProcedure {

    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> String SPROC_NAME = <span class="hl-string">"TitlesAfterDate"</span>;
    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> String CUTOFF_DATE_PARAM = <span class="hl-string">"cutoffDate"</span>;

    <span class="hl-keyword">public</span> TitlesAfterDateStoredProcedure(DataSource dataSource) {
        <span class="hl-keyword">super</span>(dataSource, SPROC_NAME);
        declareParameter(<span class="hl-keyword">new</span> SqlParameter(CUTOFF_DATE_PARAM, Types.DATE);
        declareParameter(<span class="hl-keyword">new</span> SqlOutParameter(<span class="hl-string">"titles"</span>, OracleTypes.CURSOR, <span class="hl-keyword">new</span> TitleMapper()));
        compile();
    }

    <span class="hl-keyword">public</span> Map&lt;String, Object&gt; execute(Date cutoffDate) {
        Map&lt;String, Object&gt; inputs = <span class="hl-keyword">new</span> HashMap&lt;String, Object&gt;();
        inputs.put(CUTOFF_DATE_PARAM, cutoffDate);
        <span class="hl-keyword">return</span> <span class="hl-keyword">super</span>.execute(inputs);
    }
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-parameter-handling"></a>13.7&nbsp;Common problems with parameter and data value handling</h2></div></div></div><p>Common problems with parameters and data values exist in the
    different approaches provided by the Spring Framework JDBC.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-type-information"></a>13.7.1&nbsp;Providing SQL type information for parameters</h3></div></div></div><p>Usually Spring determines the SQL type of the parameters based on
      the type of parameter passed in. It is possible to explicitly provide
      the SQL type to be used when setting parameter values. This is sometimes
      necessary to correctly set NULL values.</p><p>You can provide SQL type information in several ways:</p><div class="itemizedlist"><ul type="disc"><li><p>Many update and query methods of the
          <code class="classname">JdbcTemplate</code> take an additional parameter in
          the form of an <code class="code">int </code>array. This array is used to
          indicate the SQL type of the coresponding parameter using constant
          values from the <code class="classname">java.sql.Types</code> class. Provide
          one entry for each parameter.</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>You can use the <code class="classname">SqlParameterValue</code> class
          to wrap the parameter value that needs this additional information.
          Create
          a new instance for each value and pass in the SQL type and parameter
          value in the constructor. You can also provide an optional scale
          parameter for numeric values.</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>For methods working with named parameters, use the
          <code class="classname">SqlParameterSource</code> classes
          <code class="classname">BeanPropertySqlParameterSource</code> or
          <code class="classname">MapSqlParameterSource</code>. They both have methods
          for registering the SQL type for any of the named parameter
          values.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-lob"></a>13.7.2&nbsp;Handling BLOB and CLOB objects</h3></div></div></div><p>You can store images, other binary objects, and large chunks of
      text. These large object are called BLOB for binary data and CLOB for
      character data. In Spring you can handle these large objects by using
      the JdbcTemplate directly and also when using the higher abstractions
      provided by RDBMS Objects and the <code class="code">SimpleJdbc</code> classes. All
      of these approaches use an implementation of the
      <code class="classname">LobHandler</code> interface for the actual management of
      the LOB data. The <code class="classname">LobHandler</code> provides access to a
      <code class="classname">LobCreator</code> class, through the
      <code class="classname">getLobCreator</code> method, used for creating new LOB
      objects to be inserted.</p><p>The <code class="classname">LobCreator/LobHandler</code> provides the
      following support for LOB input and output:</p><div class="itemizedlist"><ul type="disc"><li><p>BLOB</p><div class="itemizedlist"><ul type="circle"><li><p>byte[] &#8211; getBlobAsBytes and setBlobAsBytes</p></li><li><p>InputStream &#8211; getBlobAsBinaryStream and
                setBlobAsBinaryStream</p></li></ul></div></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>CLOB</p><div class="itemizedlist"><ul type="circle"><li><p>String &#8211; getClobAsString and setClobAsString</p></li><li><p>InputStream &#8211; getClobAsAsciiStream and
                setClobAsAsciiStream</p></li><li><p>Reader &#8211; getClobAsCharacterStream and
                setClobAsCharacterStream</p></li></ul></div></li></ul></div><p>The next example shows how to create and insert a BLOB. Later you
      will see how to read it back from the database.</p><p>This example uses a <code class="code">JdbcTemplate</code> and an
      implementation of the
      <code class="code">AbstractLobCreatingPreparedStatementCallbac</code><code class="code">k</code>.
      It implements one method, <code class="code">setValues</code>. This method provides a
      <code class="code">LobCreator</code> that you use to set the values for the LOB
      columns in your SQL insert statement.</p><p>For this example we assume that there is a variable,
      <code class="code">lobHandle</code><code class="code">r</code>, that already is set to an instance
      of a <code class="classname">DefaultLobHandler</code>. You typically set this
      value through dependency injection.</p><div class="programlistingco"><pre class="programlisting"><span class="hl-keyword">final</span> File blobIn = <span class="hl-keyword">new</span> File(<span class="hl-string">"spring2004.jpg"</span>);
<span class="hl-keyword">final</span> InputStream blobIs = <span class="hl-keyword">new</span> FileInputStream(blobIn);
<span class="hl-keyword">final</span> File clobIn = <span class="hl-keyword">new</span> File(<span class="hl-string">"large.txt"</span>);
<span class="hl-keyword">final</span> InputStream clobIs = <span class="hl-keyword">new</span> FileInputStream(clobIn);
<span class="hl-keyword">final</span> InputStreamReader clobReader = <span class="hl-keyword">new</span> InputStreamReader(clobIs);
jdbcTemplate.execute(
  <span class="hl-string">"INSERT INTO lob_table (id, a_clob, a_blob) VALUES (?, ?, ?)"</span>,
  <span class="hl-keyword">new</span> AbstractLobCreatingPreparedStatementCallback(lobHandler) {                                                       <span class="co" id="jdbc.lobhandler.variableref"><img src="images/callouts/1.gif" alt="(1)"></span>
      <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> setValues(PreparedStatement ps, LobCreator lobCreator) 
          <span class="hl-keyword">throws</span> SQLException {
        ps.setLong(1, 1L);
        lobCreator.setClobAsCharacterStream(ps, 2, clobReader, (<span class="hl-keyword">int</span>)clobIn.length());                                  <span class="co" id="jdbc.lobhandler.setClob"><img src="images/callouts/2.gif" alt="(2)"></span>
        lobCreator.setBlobAsBinaryStream(ps, 3, blobIs, (<span class="hl-keyword">int</span>)blobIn.length());                                         <span class="co" id="jdbc.lobhandler.setBlob"><img src="images/callouts/3.gif" alt="(3)"></span>
      }
  }
);
blobIs.close();
clobReader.close();</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/1.gif" alt="1" border="0"></p></td><td valign="top" align="left"><p>Pass in the lobHandler that in this example is a plain
            <code class="classname">DefaultLobHandler</code></p></td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/2.gif" alt="2" border="0"></p></td><td valign="top" align="left"><p>Using the method
            <code class="classname">setClobAsCharacterStream</code>, pass in the
            contents of the CLOB.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/3.gif" alt="3" border="0"></p></td><td valign="top" align="left"><p>Using the method
            <code class="classname">setBlobAsBinaryStream</code>, pass in the contents
            of the BLOB.</p></td></tr></table></div></div><p>Now it's time to read the LOB data from the database. Again, you
      use a <code class="code">JdbcTemplate</code> with the same instance variable
      <code class="code">l</code><code class="code">obHandler </code>and a reference to a
      <code class="classname">DefaultLobHandler</code>.</p><div class="programlistingco"><pre class="programlisting">List&lt;Map&lt;String, Object&gt;&gt; l = jdbcTemplate.query(<span class="hl-string">"select id, a_clob, a_blob from lob_table"</span>,
        <span class="hl-keyword">new</span> RowMapper&lt;Map&lt;String, Object&gt;&gt;() {
          <span class="hl-keyword">public</span> Map&lt;String, Object&gt; mapRow(ResultSet rs, <span class="hl-keyword">int</span> i) <span class="hl-keyword">throws</span> SQLException {
            Map&lt;String, Object&gt; results = <span class="hl-keyword">new</span> HashMap&lt;String, Object&gt;();
            String clobText = lobHandler.getClobAsString(rs, <span class="hl-string">"a_clob"</span>);                                                <span class="co" id="jdbc.lobhandler.getClob"><img src="images/callouts/1.gif" alt="(1)"></span>
            results.put(<span class="hl-string">"CLOB"</span>, clobText);
            <span class="hl-keyword">byte</span>[] blobBytes = lobHandler.getBlobAsBytes(rs, <span class="hl-string">"a_blob"</span>);                                                <span class="co" id="jdbc.lobhandler.getBlob"><img src="images/callouts/2.gif" alt="(2)"></span>
            results.put(<span class="hl-string">"BLOB"</span>, blobBytes);
            <span class="hl-keyword">return</span> results;
          }
        });
</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/2.gif" alt="2" border="0"></p></td><td valign="top" align="left"><p>Using the method <code class="classname">getClobAsString,
              </code>retrieve the contents of the CLOB.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/3.gif" alt="3" border="0"></p></td><td valign="top" align="left"><p>Using the method <code class="classname">getBlobAsBytes,</code>
              retrieve the contents of the BLOB.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-in-clause"></a>13.7.3&nbsp;Passing in lists of values for IN clause</h3></div></div></div><p>The SQL standard allows for selecting rows based on an expression
      that includes a variable list of values. A typical example would be
      <code class="code">select * from T_ACTOR where id in (1, 2, 3)</code>. This variable
      list is not directly supported for prepared statements by the JDBC
      standard; you cannot declare a variable number of placeholders. You need
      a number of variations with the desired number of placeholders prepared,
      or you need to generate the SQL string dynamically once you know how
      many placeholders are required. The named parameter support provided in
      the <code class="classname">NamedParameterJdbcTemplate</code> and
      <code class="classname">SimpleJdbcTemplate</code> takes the latter approach.
      Pass in the values as a <code class="classname">java.util.List</code> of
      primitive objects. This list will be used to insert the required
      placeholders and pass in the values during the statement
      execution.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Be careful when passing in many values. The JDBC standard does
        not guarantee that you can use more than 100 values for an
        <code class="code">in</code> expression list. Various databases exceed this number,
        but they usually have a hard limit for how many values are allowed.
        Oracle's limit is 1000.</p></td></tr></table></div><p>In addition to the primitive values in the value list, you can
      create a <code class="classname">java.util.List</code> of object arrays. This
      list would support multiple expressions defined for the <code class="code">in</code>
      clause such as <code class="code">select * from T_ACTOR where (id, last_name) in ((1,
      'Johnson'), (2, 'Harrop'))</code>. This of course requires that your
      database supports this syntax.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-complex-types"></a>13.7.4&nbsp;Handling complex types for stored procedure calls</h3></div></div></div><p>When you call stored procedures you can sometimes use complex
      types specific to the database. To accommodate these types, Spring
      provides a <code class="classname">SqlReturnType</code> for handling them when
      they are returned from the stored procedure call and
      <code class="classname">SqlTypeValue</code> when they are passed in as a
      parameter to the stored procedure.</p><p>Here is an example of returning the value of an Oracle
      <code class="code">STRUCT</code> object of the user declared type
      <code class="code">ITEM_TYPE</code>. The <code class="classname">SqlReturnType</code>
      interface has a single method named <code class="classname">getTypeValue</code>
      that must be implemented. This interface is used as part of the
      declaration of an <code class="classname">SqlOutParameter</code>.</p><pre class="programlisting"><span class="hl-keyword">final</span> TestItem - <span class="hl-keyword">new</span> TestItem(123L, <span class="hl-string">"A test item"</span>, 
        <span class="hl-keyword">new</span> SimpleDateFormat(<span class="hl-string">"yyyy-M-d"</span>).parse(<span class="hl-string">"2010-12-31"</span>););

declareParameter(<span class="hl-keyword">new</span> SqlOutParameter(<span class="hl-string">"item"</span>, OracleTypes.STRUCT, <span class="hl-string">"ITEM_TYPE"</span>,
    <span class="hl-keyword">new</span> SqlReturnType() {
      <span class="hl-keyword">public</span> Object getTypeValue(CallableStatement cs, <span class="hl-keyword">int</span> colIndx, <span class="hl-keyword">int</span> sqlType, String typeName) 
          <span class="hl-keyword">throws</span> SQLException {
        STRUCT struct = (STRUCT)cs.getObject(colIndx);
        Object[] attr = struct.getAttributes();
        TestItem item = <span class="hl-keyword">new</span> TestItem();
        item.setId(((Number) attr[0]).longValue());
        item.setDescription((String)attr[1]);
        item.setExpirationDate((java.util.Date)attr[2]);
        <span class="hl-keyword">return</span> item;
      }
    }));</pre><p>You use the <code class="classname">SqlTypeValue</code> to
      pass in the value of a Java object like <code class="classname">TestItem</code>
      into a stored procedure. The
      <code class="classname">SqlTypeValue</code> interface has a single method named
      <code class="classname">createTypeValue</code> that you must implement. The
      active connection is passed in, and you can use it to create
      database-specific objects such as
      <code class="classname">StructDescriptor</code>s, as shown in the following
      example, or <code class="classname">ArrayDescriptor</code>s.</p><pre class="programlisting"><span class="hl-keyword">final</span> TestItem - <span class="hl-keyword">new</span> TestItem(123L, <span class="hl-string">"A test item"</span>, 
        <span class="hl-keyword">new</span> SimpleDateFormat(<span class="hl-string">"yyyy-M-d"</span>).parse(<span class="hl-string">"2010-12-31"</span>););

SqlTypeValue value = <span class="hl-keyword">new</span> AbstractSqlTypeValue() {
  <span class="hl-keyword">protected</span> Object createTypeValue(Connection conn, <span class="hl-keyword">int</span> sqlType, String typeName) <span class="hl-keyword">throws</span> SQLException {
    StructDescriptor itemDescriptor = <span class="hl-keyword">new</span> StructDescriptor(typeName, conn);
    Struct item = <span class="hl-keyword">new</span> STRUCT(itemDescriptor, conn,
        <span class="hl-keyword">new</span> Object[] {
            testItem.getId(),
            testItem.getDescription(),
            <span class="hl-keyword">new</span> java.sql.Date(testItem.getExpirationDate().getTime())
        });
    <span class="hl-keyword">return</span> item;
  }
};</pre><p>This <code class="classname">SqlTypeValue</code> can now be added
      to the Map containing the input parameters for the execute call of the
      stored procedure.</p><p>Another use for the <code class="classname">SqlTypeValue</code> is passing
      in an array of values to an Oracle stored procedure. Oracle has its own
      internal <code class="classname">ARRAY</code> class that must be used in this
      case, and you can use the <code class="classname">SqlTypeValue</code> to create
      an instance of the Oracle <code class="classname">ARRAY</code> and populate it
      with values from the Java <code class="code">ARRAY</code>.</p><pre class="programlisting"><span class="hl-keyword">final</span> Long[] ids = <span class="hl-keyword">new</span> Long[] {1L, 2L};

SqlTypeValue value = <span class="hl-keyword">new</span> AbstractSqlTypeValue() {
  <span class="hl-keyword">protected</span> Object createTypeValue(Connection conn, <span class="hl-keyword">int</span> sqlType, String typeName) <span class="hl-keyword">throws</span> SQLException {
    ArrayDescriptor arrayDescriptor = <span class="hl-keyword">new</span> ArrayDescriptor(typeName, conn);
    ARRAY idArray = <span class="hl-keyword">new</span> ARRAY(arrayDescriptor, conn, ids);
    <span class="hl-keyword">return</span> idArray;
  }
};</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-embedded-database-support"></a>13.8&nbsp;Embedded database support</h2></div></div></div><p>The <code class="literal">org.springframework.jdbc.datasource.embedded</code>
    package provides support for embedded Java database engines. Support for
    <a class="ulink" href="http://www.hsqldb.org" target="_top">HSQL</a>, <a class="ulink" href="http://www.h2database.com" target="_top">H2</a>, and <a class="ulink" href="http://db.apache.org/derby" target="_top">Derby</a> is provided natively. You
    can also use an extensible API to plug in new embedded database types and
    <code class="classname">DataSource</code> implementations.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-why-embedded-database"></a>13.8.1&nbsp;Why use an embedded database?</h3></div></div></div><p>An embedded database is useful during the development phase of a
      project because of its lightweight nature. Benefits include ease of
      configuration, quick startup time, testability, and the ability to
      rapidly evolve SQL during development.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-embedded-database-xml"></a>13.8.2&nbsp;Creating an embedded database instance using Spring XML</h3></div></div></div><p>If you want to expose an embedded database instance as a bean in a
      Spring ApplicationContext, use the embedded-database tag in the
      spring-jdbc namespace: </p><pre class="programlisting">    &lt;<span class="hl-tag">jdbc:embedded-database</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span>&gt;
        &lt;<span class="hl-tag">jdbc:script</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:schema.sql"</span>/&gt;
        &lt;<span class="hl-tag">jdbc:script</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:test-data.sql"</span>/&gt;
    &lt;<span class="hl-tag">/jdbc:embedded-database</span>&gt;
</pre><p>The preceding configuration creates an embedded HSQL database
      populated with SQL from schema.sql and testdata.sql resources in the
      classpath. The database instance is made available to the Spring
      container as a bean of type <code class="classname">javax.sql.DataSource</code>.
      This bean can then be injected into data access objects as
      needed.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-embedded-database-java"></a>13.8.3&nbsp;Creating an embedded database instance programmatically</h3></div></div></div><p>The <code class="classname">EmbeddedDatabaseBuilder</code> class provides
      a fluent API for constructing an embedded database programmatically. Use
      this when you need to create an embedded database instance in a
      standalone environment, such as a data access object unit test:
      </p><pre class="programlisting">    EmbeddedDatabaseBuilder builder = <span class="hl-keyword">new</span> EmbeddedDatabaseBuilder();
    EmbeddedDatabase db = builder.setType(H2).addScript(<span class="hl-string">"my-schema.sql"</span>).addScript(<span class="hl-string">"my-test-data.sql"</span>).build();
    <span class="hl-comment">// do stuff against the db (EmbeddedDatabase extends javax.sql.DataSource)</span>
    db.shutdown()
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-embedded-database-extension"></a>13.8.4&nbsp;Extending the embedded database support</h3></div></div></div><p>Spring JDBC embedded database support can be extended in two ways:
      </p><div class="orderedlist"><ol type="1"><li><p>Implement <code class="classname">EmbeddedDatabaseConfigurer</code>
            to support a new embedded database type, such as Apache
            Derby.</p></li><li><p>Implement <code class="classname">DataSourceFactory</code> to
            support a new DataSource implementation, such as a connection
            pool, to manage embedded database connections.</p></li></ol></div><p>You are encouraged to contribute back extensions to the Spring
      community at <a class="ulink" href="jira.springframework.org" target="_top">jira.springframework.org</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-embedded-database-using-HSQL"></a>13.8.5&nbsp;Using HSQL</h3></div></div></div><p>Spring supports HSQL 1.8.0 and above. HSQL is the default embedded
      database if no type is specified explicitly. To specify HSQL explicitly,
      set the <code class="literal">type</code> attribute of the
      <code class="literal">embedded-database</code> tag to <code class="literal">HSQL</code>. If
      you are using the builder API, call the
      <code class="literal">setType(EmbeddedDatabaseType)</code> method with
      <code class="literal">EmbeddedDatabaseType.HSQL</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-embedded-database-using-H2"></a>13.8.6&nbsp;Using H2</h3></div></div></div><p>Spring supports the H2 database as well. To enable H2, set the
      <code class="literal">type</code> attribute of the
      <code class="literal">embedded-database</code> tag to <code class="literal">H2</code>. If
      you are using the builder API, call the
      <code class="literal">setType(EmbeddedDatabaseType)</code> method with
      <code class="literal">EmbeddedDatabaseType.H2</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-embedded-database-using-Derby"></a>13.8.7&nbsp;Using Derby</h3></div></div></div><p>Spring also supports Apache Derby 10.5 and above. To enable Derby,
      set the <code class="literal">type</code> attribute of the
      <code class="literal">embedded-database</code> tag to <code class="literal">Derby</code>. If
      using the builder API, call the
      <code class="literal">setType(EmbeddedDatabaseType)</code> method with
      <code class="literal">EmbeddedDatabaseType.Derby</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-embedded-database-dao-testing"></a>13.8.8&nbsp;Testing data access logic with an embedded database</h3></div></div></div><p>Embedded databases provide a lightweight way to test data access
      code. The following is a data access unit test template that uses an
      embedded database:</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DataAccessUnitTestTemplate {
    <span class="hl-keyword">private</span> EmbeddedDatabase db;
    
    @Before
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setUp() {
        <span class="hl-comment">// creates a HSQL in-memory db populated from default scripts classpath:schema.sql and classpath:test-data.sql</span>
        db = <span class="hl-keyword">new</span> EmbeddedDatabaseBuilder().addDefaultScripts().build();		
    }

    @Test
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testDataAccess() {
        JdbcTemplate template = <span class="hl-keyword">new</span> JdbcTemplate(db);
        template.query(...);
    }

    @After
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> tearDown() {
        db.shutdown();
    }
}
</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e25689"></a>13.9&nbsp;Initializing a DataSource</h2></div></div></div><p>The <code class="literal">org.springframework.jdbc.datasource.init</code>
    package provides support for initializing an existing
    <code class="classname">DataSource</code>. The embedded database support provides
    one option for creating and initializing a
    <code class="classname">DataSource</code> for an application, but sometimes you
    need to initialize an instance running on a server somewhere.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e25703"></a>13.9.1&nbsp;Initializing a database instance using Spring XML</h3></div></div></div><p>If you want to initialize a database and you can provide a
      reference to a DataSource bean, use the
      <code class="literal">initialize-database</code> tag in the
      <code class="literal">spring-jdbc</code> namespace:</p><pre class="programlisting">&lt;jdbc:initialize-database data-source="dataSource"&gt;
  &lt;jdbc:script location="classpath:com/foo/sql/db-schema.sql"/&gt;
  &lt;jdbc:script location="classpath:com/foo/sql/db-test-data.sql"/&gt;
&lt;/jdbc:initialize-database&gt;</pre><p>The example above runs the two scripts specified against the
      database: the first script is a schema creation, and the second is a
      test data set insert. The script locations can also be patterns with
      wildcards in the usual ant style used for resources in Spring (e.g.
      <code class="code">classpath*:/com/foo/**/sql/*-data.sql</code>). If a pattern is
      used the scripts are executed in lexical order of their URL or
      filename.</p><p>The default behaviour of the database initializer is to
      unconditionally execute the scripts provided. This will not always be
      what you want, for instance if running against an existing database that
      already has test data in it. The likelihood of accidentally deleting
      data is reduced by the commonest pattern (as shown above) that creates
      the tables first and then inserts the data - the first step will fail if
      the tables already exist.</p><p>However, to get more control over the creation and deletion of
      existing data, the XML namespace provides a couple more options. The
      first is flag to switch the initialization on and off. This can be set
      according to the environment (e.g. to pull a boolean value from system
      properties or an environment bean), e.g. </p><pre class="programlisting">&lt;jdbc:initialize-database data-source="dataSource"
    <span class="bold"><strong>enabled="#{systemProperties.INITIALIZE_DATABASE}"</strong></span>&gt;
  &lt;jdbc:script location="..."/&gt;
&lt;/jdbc:initialize-database&gt;</pre><p>The second option to control what happens with existing data is to
      be more tolerant of failures. To this end you can control the ability of
      the initializer to ignore certain errors in the SQL it executes from the
      scripts, e.g.</p><pre class="programlisting">&lt;jdbc:initialize-database data-source="dataSource" <span class="bold"><strong>ignore-failures="DROPS"</strong></span>&gt;
  &lt;jdbc:script location="..."/&gt;
&lt;/jdbc:initialize-database&gt;</pre><p>In this example we are
      saying we expect that sometimes the scripts will be run against an empty
      dtabase and there are some DROP statements in the scripts which would
      therefore fail. So failed SQL <code class="code">DROP</code> statements will be
      ignored, but other failures will cause an exception. This is useful if
      your SQL dialect doesn't support <code class="code">DROP ... IF EXISTS</code> (or
      similar) but you want to unconditionally remove all test data before
      re-creating it. In that case the first script is usually a set of drops,
      followed by a set of <code class="code">CREATE</code> statements.</p><p>The <code class="code">ignore-failures</code> option can be set to
      <code class="code">NONE</code> (the default), <code class="code">DROPS</code> (ignore failed
      drops) or <code class="code">ALL</code> (ignore all failures).</p><p>If you need more control than you get from the XML namespace, you
      can simply use the <code class="classname">DataSourceInitializer</code>
      directly, and define it as a component in your application.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e25767"></a>13.9.1.1&nbsp;Initialization of Other Components that Depend on the
        Database</h4></div></div></div><p>A large class of applications can just use the database
        initializer with no further complications: those that do not use the
        database until after the Spring context has started. If your
        application is <span class="emphasis"><em>not</em></span> one of those then you might
        need to read the rest of this section.</p><p>The database initializer depends on a data source instance and
        runs the scripts provided in its initialization callback (c.f.
        <code class="code">init-method</code> in an XML bean definition or
        <code class="code">InitializingBean</code>). If other beans depend on the same data
        source and also use the data source in an initialization callback then
        there might be a problem because the data has not yet been
        initialized. A common example of this is a cache that initializes
        eagerly and loads up data from the database on application
        startup.</p><p>To get round this issue you two options: change your cache
        initialization strategy to a later phase, or ensure that the database
        initializer is initialized first.</p><p>The first option might be easy if the application is in your
        control, and not otherwise. Some suggestions for how to implement this
        are</p><div class="itemizedlist"><ul type="disc"><li><p>Make the cache initialize lazily on first usage, which
              improves application startup time</p></li><li><p>Have your cache or a separate component that initializes
              the cache implement <code class="code">Lifecycle</code> or
              <code class="code">SmartLifecycle</code>. When the application context starts
              up a <code class="code">SmartLifecycle</code> can be automatically started if
              its <code class="code">autoStartup</code> flag is set, and a
              <code class="code">Lifecycle</code> can be started manually by calling
              <code class="code">ConfigurableApplicationContext.start()</code> on the
              enclosing context.</p></li><li><p>Use a Spring <code class="code">ApplicationEvent</code> or similar
              custom observer mechanism to trigger the cache initialization.
              <code class="code">ContextRefreshedEvent</code> is always published by the
              context when it is ready for use (after all beans have been
              initialized), so that is often a useful hook (this is how the
              <code class="code">SmartLifecycle</code> works by default).</p></li></ul></div><p>The second option can also be easy. Some suggestions on how to
        implement this are</p><div class="itemizedlist"><ul type="disc"><li><p>Rely on Spring BeanFactory default behaviour, which is
              that beans are initialized in registration order. You can easily
              arrange that by adopting the common practice of a set of
              &lt;import/&gt; elements that order your application modules,
              and ensure that the database and database initialization are
              listed first</p></li><li><p>Separate the datasource and the business components that
              use it and control their startup order by putting them in
              separate ApplicationContext instances (e.g. parent has the
              datasource and child has the business components). This
              structure is common in Spring web applications, but can be more
              generally applied.</p></li><li><p>Use a modular runtime like SpringSource dm Server and
              separate the data source and the components that depend on it.
              E.g. specify the bundle start up order as datasource -&gt;
              initializer -&gt; business components.</p></li></ul></div></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="orm"></a>14.&nbsp;Object Relational Mapping (ORM) Data Access</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-introduction"></a>14.1&nbsp;Introduction to ORM with Spring</h2></div></div></div><p>The Spring Framework supports integration
    with Hibernate, Java Persistence API (JPA), Java Data Objects (JDO) and
    iBATIS SQL Maps for resource management, data access object (DAO)
    implementations, and transaction strategies. For example, for Hibernate
    there is first-class support with several convenient IoC features that
    address many typical Hibernate integration issues. You can configure
    all of the supported features for O/R (object relational) mapping tools through
    Dependency Injection. They can participate in Spring's resource
    and transaction management, and they comply with Spring's generic
    transaction and DAO exception hierarchies. The recommended integration
    style is to code DAOs against plain Hibernate, JPA, and JDO APIs. The
    older style of using Spring's DAO templates is no longer recommended;
    however, coverage of this style can be found in the <a class="xref" href="#classic-spring-orm" title="A.1&nbsp;Classic ORM usage">Section&nbsp;A.1, &#8220;Classic ORM usage&#8221;</a> in the appendices.</p><p>Spring adds significant enhancements to the ORM layer of your choice
    when you create data access applications. You can leverage as much of the
    integration support as you wish, and you should compare this integration
    effort with the cost and risk of building a similar infrastructure
    in-house. You can use much of the ORM support as you would a library,
    regardless of technology, because everything is designed as a set of
    reusable JavaBeans. ORM in a Spring IoC container facilitates
    configuration and deployment. Thus most examples in this section show
    configuration inside a Spring container.</p><p>Benefits of using the Spring Framework to create your ORM DAOs
    include:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>Easier testing.</em></span> Spring's IoC approach makes
        it easy to swap the implementations and configuration locations of
        Hibernate <code class="interfacename">SessionFactory</code> instances,
        JDBC <code class="interfacename">DataSource</code> instances, transaction
        managers, and mapped object implementations (if needed). This in turn makes it
        much easier to test each piece of persistence-related code in
        isolation.</p></li><li><p><span class="emphasis"><em>Common data access exceptions.</em></span> Spring can
        wrap exceptions from your ORM tool, converting them from proprietary
        (potentially checked) exceptions to a common runtime
        DataAccessException hierarchy. This feature allows you to handle most
        persistence exceptions, which are non-recoverable, only in the
        appropriate layers, without annoying boilerplate catches, throws, and
        exception declarations. You can still trap and handle exceptions as
        necessary. Remember that JDBC exceptions (including DB-specific
        dialects) are also converted to the same hierarchy, meaning that you
        can perform some operations with JDBC within a consistent programming
        model.</p></li><li><p><span class="emphasis"><em>General resource management.</em></span> Spring
        application contexts can handle the location and configuration of
        Hibernate <code class="interfacename">SessionFactory</code> instances, JPA
        <code class="interfacename">EntityManagerFactory</code> instances, JDBC
        <code class="interfacename">DataSource</code> instances, iBATIS SQL Maps
        configuration objects, and other related resources. This makes these
        values easy to manage and change. Spring offers efficient, easy, and
        safe handling of persistence resources. For example, related code that
        uses Hibernate generally needs to use the same Hibernate
        <code class="interfacename">Session</code> to ensure efficiency and proper
        transaction handling. Spring makes it easy to create and bind a
        <code class="interfacename">Session</code> to the current thread
        transparently, by
        exposing a current <code class="interfacename">Session</code> through the
        Hibernate <code class="interfacename">SessionFactory</code>. Thus Spring
        solves many chronic problems of typical Hibernate usage, for any local
        or JTA transaction environment.</p></li><li><p><span class="emphasis"><em>Integrated transaction management.</em></span> You can
        wrap your ORM code with a declarative, aspect-oriented programming
        (AOP) style method interceptor either through the
        <code class="interfacename">@Transactional</code> annotation or by
        explicitly configuring the transaction AOP advice in an XML
        configuration file. In both cases, transaction semantics and exception
        handling (rollback, and so on) are handled for you. As discussed
        below, in <a class="link" href="#orm-resource-mngmnt" title="14.2.1&nbsp;Resource and transaction management">Resource and transaction
        management</a>, you can also swap various transaction managers,
        without affecting your ORM-related code. For example, you can swap
        between local transactions and JTA, with the same full services (such
        as declarative transactions) available in both scenarios.
        Additionally, JDBC-related code can fully integrate transactionally
        with the code you use to do ORM. This is useful for data access that
        is not suitable for ORM, such as batch processing and BLOB streaming,
        which still need to
        share common transactions with ORM operations.</p></li></ul></div><p><span class="emphasis"><em>TODO:
    provide links to current samples</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-general"></a>14.2&nbsp;General ORM integration considerations</h2></div></div></div><p>This section highlights considerations that apply to all ORM
    technologies. The <a class="xref" href="#orm-hibernate" title="14.3&nbsp;Hibernate">Section&nbsp;14.3, &#8220;Hibernate&#8221;</a> section provides more
    details and also show these features and configurations in a concrete
    context.</p><p>The major goal of Spring's ORM integration is clear application
    layering, with any data access and transaction technology, and for loose
    coupling of application objects. No more business service dependencies on
    the data access or transaction strategy, no more hard-coded resource
    lookups, no more hard-to-replace singletons, no more custom service
    registries. One simple and consistent approach to wiring up application
    objects, keeping them as reusable and free from container dependencies as
    possible. All the individual data access features are usable on their own
    but integrate nicely with Spring's application context concept, providing
    XML-based configuration and cross-referencing of plain JavaBean instances
    that need not be Spring-aware. In a typical Spring application, many
    important objects are JavaBeans: data access templates, data access
    objects, transaction managers, business services that use the data access
    objects and transaction managers, web view resolvers, web controllers that
    use the business services,and so on.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-resource-mngmnt"></a>14.2.1&nbsp;Resource and transaction management</h3></div></div></div><p>Typical business applications are cluttered with repetitive
      resource management code. Many projects try to invent their own
      solutions, sometimes sacrificing proper handling of failures for
      programming convenience. Spring advocates simple solutions for proper
      resource handling, namely IoC through templating in the case of
      JDBC and applying AOP interceptors for the ORM technologies.</p><p>The infrastructure provides proper resource handling and
      appropriate conversion of specific API exceptions to an unchecked
      infrastructure exception hierarchy. Spring
      introduces a DAO exception hierarchy, applicable to any data access
      strategy. For direct JDBC, the <code class="classname">JdbcTemplate</code> class
      mentioned in a previous section provides connection handling and proper
      conversion of <code class="classname">SQLException</code> to the
      <code class="classname">DataAccessException</code> hierarchy, including
      translation of database-specific SQL error codes to meaningful exception
      classes. For ORM technologies, see the next section for how to get the
      same exception translation benefits.</p><p>When it comes to transaction management, the
      <code class="classname">JdbcTemplate</code> class hooks in to the Spring
      transaction support and supports both JTA and JDBC transactions, through
      respective Spring transaction managers. For the supported ORM
      technologies Spring offers Hibernate, JPA and JDO support through the
      Hibernate, JPA, and JDO transaction managers as well as JTA support. For
      details on transaction support, see the <a class="xref" href="#transaction" title="11.&nbsp;Transaction Management">Chapter&nbsp;11, <i>Transaction Management</i></a>
      chapter.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-exception-translation"></a>14.2.2&nbsp;Exception translation</h3></div></div></div><p>When you use Hibernate, JPA, or JDO in a DAO, you must decide how
      to handle the persistence technology's native exception classes. The DAO
      throws a subclass of a <code class="classname">HibernateException</code>,
      <code class="classname">PersistenceException</code> or
      <code class="interfacename">JDOException</code> depending on the technology.
      These exceptions are all run-time exceptions and do not have to be
      declared or caught. You may also have to deal with
      <code class="classname">IllegalArgumentException</code> and
      <code class="classname">IllegalStateException</code>. This means that callers
      can only treat exceptions as generally fatal, unless they want to depend
      on the persistence technology's own exception structure. Catching
      specific causes such as an optimistic locking failure is not possible
      without tying the caller to the implementation strategy. This trade off
      might be acceptable to applications that are strongly ORM-based and/or
      do not need any special exception treatment. However, Spring enables
      exception translation to be applied transparently through the
      <code class="interfacename">@Repository</code> annotation:</p><pre class="programlisting">@Repository
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductDaoImpl <span class="hl-keyword">implements</span> ProductDao {

    <span class="hl-comment">// class body here...</span>

}</pre><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-comment">!-- Exception translation bean post processor --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor"</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductDaoImpl"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The postprocessor automatically looks for all exception
      translators (implementations of the
      <code class="interfacename">PersistenceExceptionTranslator</code> interface)
      and advises all beans marked with the
      <code class="interfacename">@Repository</code> annotation so that the
      discovered translators can intercept and apply the appropriate
      translation on the thrown exceptions.</p><p>In summary: you can implement DAOs based on the plain persistence
      technology's API and annotations, while still benefiting from
      Spring-managed transactions, dependency injection, and transparent
      exception conversion (if desired) to Spring's custom exception
      hierarchies.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-hibernate"></a>14.3&nbsp;Hibernate</h2></div></div></div><p>We will start with a coverage of <a class="ulink" href="http://www.hibernate.org/" target="_top">Hibernate 3</a> in a Spring
    environment, using it to demonstrate the approach that Spring takes
    towards integrating O/R mappers. This section will cover many issues in
    detail and show different variations of DAO implementations and
    transaction demarcation. Most of these patterns can be directly translated
    to all other supported ORM tools. The following sections in this chapter
    will then cover the other ORM technologies, showing briefer examples
    there.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>As of Spring 3.0, Spring requires Hibernate 3.2 or later.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-session-factory-setup"></a>14.3.1&nbsp;<code class="interfacename">SessionFactory</code> setup in a Spring
      container</h3></div></div></div><p>To avoid tying application objects to hard-coded resource lookups,
      you can define resources such as a JDBC
      <code class="interfacename">DataSource</code> or a Hibernate
      <code class="interfacename">SessionFactory</code> as beans in the Spring
      container. Application objects that need to access resources receive
      references to such predefined instances through bean references, as
      illustrated in the DAO definition in the next section.</p><p>The following excerpt from an XML application context definition
      shows how to set up a JDBC <code class="classname">DataSource</code> and a
      Hibernate <code class="interfacename">SessionFactory</code> on top of
      it:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myDataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.hsqldb.jdbcDriver"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc:hsqldb:hsql://localhost:9001"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"sa"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">""</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mySessionFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate3.LocalSessionFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myDataSource"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappingResources"</span>&gt;
      &lt;<span class="hl-tag">list</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;product.hbm.xml&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hibernateProperties"</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;
        hibernate.dialect=org.hibernate.dialect.HSQLDialect
      &lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Switching from a local Jakarta Commons DBCP
      <code class="classname">BasicDataSource</code> to a JNDI-located
      <code class="interfacename">DataSource</code> (usually managed by an
      application server) is just a matter of configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myDataSource"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"java:comp/env/jdbc/myds"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>You can also access a JNDI-located
      <code class="interfacename">SessionFactory</code>, using Spring's
      <code class="classname">JndiObjectFactoryBean</code> /
      <code class="literal">&lt;jee:jndi-lookup&gt;</code> to retrieve and expose it.
      However, that is typically not common outside of an EJB context.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-straight"></a>14.3.2&nbsp;Implementing DAOs based on plain Hibernate 3 API</h3></div></div></div><p>Hibernate 3 has a feature called contextual sessions, wherein
      Hibernate itself manages one current
      <code class="interfacename">Session</code> per transaction. This is roughly
      equivalent to Spring's synchronization of one Hibernate
      <code class="interfacename">Session</code> per transaction. A corresponding
      DAO implementation resembles the following example, based on the plain
      Hibernate API:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductDaoImpl <span class="hl-keyword">implements</span> ProductDao {

    <span class="hl-keyword">private</span> SessionFactory sessionFactory;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSessionFactory(SessionFactory sessionFactory) {
        <span class="hl-keyword">this</span>.sessionFactory = sessionFactory;
    }

    <span class="hl-keyword">public</span> Collection loadProductsByCategory(String category) {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.sessionFactory.getCurrentSession()
                .createQuery(<span class="hl-string">"from test.Product product where product.category=?"</span>)
                .setParameter(0, category)
                .list();
    }
}</pre><p>This style is similar to that of the Hibernate reference
      documentation and examples, except for holding the
      <code class="interfacename">SessionFactory</code> in an instance variable.
      We strongly recommend such an instance-based setup over the old-school
      <code class="literal">static</code> <code class="classname">HibernateUtil</code> class
      from Hibernate's CaveatEmptor sample application. (In general, do not
      keep any resources in <code class="literal">static</code> variables unless
      <span class="emphasis"><em>absolutely</em></span> necessary.)</p><p>The above DAO follows the dependency injection pattern: it fits
      nicely into a Spring IoC container, just as it would if coded against
      Spring's <code class="classname">HibernateTemplate</code>. Of course, such a DAO
      can also be set up in plain Java (for example, in unit tests). Simply
      instantiate it and call <code class="methodname">setSessionFactory(..)</code>
      with the desired factory reference. As a Spring bean definition, the DAO
      would resemble the following:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductDaoImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"mySessionFactory"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The main advantage of this DAO style is that it depends on
      Hibernate API only; no import of any Spring class is required. This is
      of course appealing from a non-invasiveness perspective, and will no
      doubt feel more natural to Hibernate developers.</p><p>However, the DAO throws plain
      <code class="classname">HibernateException</code> (which is unchecked, so does
      not have to be declared or caught), which means that callers can only
      treat exceptions as generally fatal - unless they want to depend on
      Hibernate's own exception hierarchy. Catching specific causes such as an
      optimistic locking failure is not possible without tying the caller to
      the implementation strategy. This trade off might be acceptable to
      applications that are strongly Hibernate-based and/or do not need any
      special exception treatment.</p><p>Fortunately, Spring's
      <code class="classname">LocalSessionFactoryBean</code> supports Hibernate's
      <code class="methodname">SessionFactory.getCurrentSession()</code> method for
      any Spring transaction strategy, returning the current Spring-managed
      transactional <code class="interfacename">Session</code> even with
      <code class="classname">HibernateTransactionManager</code>. Of course, the
      standard behavior of that method remains the return of the current
      <code class="interfacename">Session</code> associated with the ongoing JTA
      transaction, if any. This behavior applies regardless of whether you are
      using Spring's <code class="classname">JtaTransactionManager</code>, EJB
      container managed transactions (CMTs), or JTA.</p><p>In summary: you can implement DAOs based on the plain Hibernate 3
      API, while still being able to participate in Spring-managed
      transactions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-tx-declarative"></a>14.3.3&nbsp;Declarative transaction demarcation</h3></div></div></div><p>We recommend that you use Spring's declarative transaction
      support, which enables you to replace explicit transaction demarcation
      API calls in your Java code with an AOP transaction interceptor. This
      transaction interceptor can be configured in a Spring container using
      either Java annotations or XML.This declarative transaction capability allows you
      to keep business services free of repetitive transaction demarcation
      code and to focus on adding business logic, which is the real value of
      your application.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Prior to continuing, you are <span class="emphasis"><em>strongly</em></span>
        encouraged to read <a class="xref" href="#transaction-declarative" title="11.5&nbsp;Declarative transaction management">Section&nbsp;11.5, &#8220;Declarative transaction management&#8221;</a> if you
        have not done so.</p></td></tr></table></div><p>Furthermore, transaction semantics like propagation behavior and
      isolation level can be changed in a configuration file and do not affect
      the business service implementations.</p><p>The following example shows how you can configure an AOP
      transaction interceptor, using XML, for a simple service class:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
       <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/tx 
       http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
       http://www.springframework.org/schema/aop 
       http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;

  &lt;<span class="hl-comment">!-- SessionFactory, DataSource, etc. omitted --</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionManager"</span> 
            <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate3.HibernateTransactionManager"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"sessionFactory"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;
  
  &lt;<span class="hl-tag">aop:config</span>&gt;
    &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"productServiceMethods"</span> 
            <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* product.ProductService.*(..))"</span>/&gt;
    &lt;<span class="hl-tag">aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"productServiceMethods"</span>/&gt;
  &lt;<span class="hl-tag">/aop:config</span>&gt;

  &lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"myTxManager"</span>&gt;
    &lt;<span class="hl-tag">tx:attributes</span>&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"increasePrice*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"REQUIRED"</span>/&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someOtherBusinessMethod"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"REQUIRES_NEW"</span>/&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"SUPPORTS"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span>/&gt;
    &lt;<span class="hl-tag">/tx:attributes</span>&gt;
  &lt;<span class="hl-tag">/tx:advice</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.SimpleProductService"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"productDao"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myProductDao"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>This is the service class that is advised:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductServiceImpl <span class="hl-keyword">implements</span> ProductService {

    <span class="hl-keyword">private</span> ProductDao productDao;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setProductDao(ProductDao productDao) {
        <span class="hl-keyword">this</span>.productDao = productDao;
    }

    <span class="hl-comment">// notice the absence of transaction demarcation code in this method</span>
    <span class="hl-comment">// Spring's declarative transaction infrastructure will be demarcating</span>
    <span class="hl-comment">// transactions on your behalf </span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> increasePriceOfAllProductsInCategory(<span class="hl-keyword">final</span> String category) {
        List productsToChange = <span class="hl-keyword">this</span>.productDao.loadProductsByCategory(category);
        <span class="hl-comment">// ...</span>
    }
}</pre><p>We also show an attribute-support based configuration, in the
      following example. You
      annotate the service layer with @Transactional annotations and instruct
      the Spring container to find these annotations and provide transactional
      semantics for these annotated methods.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductServiceImpl <span class="hl-keyword">implements</span> ProductService {

    <span class="hl-keyword">private</span> ProductDao productDao;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setProductDao(ProductDao productDao) {
        <span class="hl-keyword">this</span>.productDao = productDao;
    }

    @Transactional
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> increasePriceOfAllProductsInCategory(<span class="hl-keyword">final</span> String category) {
        List productsToChange = <span class="hl-keyword">this</span>.productDao.loadProductsByCategory(category);
        <span class="hl-comment">// ...</span>
    }

    @Transactional(readOnly = true)
    <span class="hl-keyword">public</span> List&lt;Product&gt; findAllProducts() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.productDao.findAllProducts();
    }

}</pre><p>As you can see from the following configuration example, the
      configuration is much simplified, compared to the XML example above,
      while still providing the same functionality driven by the annotations
      in the service layer code. All you need to provide is the
      TransactionManager implementation and a "&lt;tx:annotation-driven/&gt;"
      entry.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
       <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/tx 
       http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
       http://www.springframework.org/schema/aop 
       http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;

  &lt;<span class="hl-comment">!-- SessionFactory, DataSource, etc. omitted --</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionManager"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate3.HibernateTransactionManager"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"sessionFactory"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;
  
  &lt;<span class="hl-tag">tx:annotation-driven</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.SimpleProductService"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"productDao"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myProductDao"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-tx-programmatic"></a>14.3.4&nbsp;Programmatic transaction demarcation</h3></div></div></div><p>You can demarcate transactions in a higher level of the
      application, on top of such lower-level data access services spanning
      any number of operations. Nor do restrictions exist on the
      implementation of the surrounding business service; it just needs a
      Spring <code class="classname">PlatformTransactionManager</code>. Again, the
      latter can come from anywhere, but preferably as a bean reference
      through a <code class="methodname">setTransactionManager(..)</code> method,
      just as the <code class="classname">productDAO</code> should be set by a
      <code class="methodname">setProductDao(..)</code> method. The following
      snippets show a transaction manager and a business service definition in
      a Spring application context, and an example for a business method
      implementation:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myTxManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate3.HibernateTransactionManager"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"mySessionFactory"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductServiceImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myTxManager"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"productDao"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myProductDao"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductServiceImpl <span class="hl-keyword">implements</span> ProductService {

    <span class="hl-keyword">private</span> TransactionTemplate transactionTemplate;
    <span class="hl-keyword">private</span> ProductDao productDao;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setTransactionManager(PlatformTransactionManager transactionManager) {
        <span class="hl-keyword">this</span>.transactionTemplate = <span class="hl-keyword">new</span> TransactionTemplate(transactionManager);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setProductDao(ProductDao productDao) {
        <span class="hl-keyword">this</span>.productDao = productDao;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> increasePriceOfAllProductsInCategory(<span class="hl-keyword">final</span> String category) {
        <span class="hl-keyword">this</span>.transactionTemplate.execute(<span class="hl-keyword">new</span> TransactionCallbackWithoutResult() {

                <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doInTransactionWithoutResult(TransactionStatus status) {
                    List productsToChange = <span class="hl-keyword">this</span>.productDao.loadProductsByCategory(category);
                    <span class="hl-comment">// do the price increase...</span>
                }
            }
        );
    }
}</pre><p>Spring's <code class="classname">TransactionInterceptor</code> allows any
      checked application exception to be thrown with the callback code, while
      <code class="classname">TransactionTemplate</code> is restricted to unchecked
      exceptions within the callback.
      <code class="classname">TransactionTemplate</code> triggers a rollback in case
      of an unchecked application exception, or if the transaction is marked
      rollback-only by the application (via
      <code class="classname">TransactionStatus</code>).
      <code class="classname">TransactionInterceptor</code> behaves the same way by
      default but allows configurable rollback policies per method.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-tx-strategies"></a>14.3.5&nbsp;Transaction management strategies</h3></div></div></div><p>Both <code class="classname">TransactionTemplate</code> and
      <code class="classname">TransactionInterceptor</code> delegate the actual
      transaction handling to a
      <code class="classname">PlatformTransactionManager</code> instance, which can be
      a <code class="classname">HibernateTransactionManager</code> (for a single
      Hibernate <code class="interfacename">SessionFactory</code>, using a
      <code class="classname">ThreadLocal</code>
      <code class="interfacename">Session</code> under the hood) or a
      <code class="classname">JtaTransactionManager</code> (delegating to the JTA
      subsystem of the container) for Hibernate applications. You can even use
      a custom <code class="classname">PlatformTransactionManager</code>
      implementation. Switching from native Hibernate transaction management
      to JTA, such as when facing distributed transaction requirements for
      certain deployments of your application, is just a matter of
      configuration. Simply replace the Hibernate transaction manager with
      Spring's JTA transaction implementation. Both transaction demarcation
      and data access code will work without changes, because they just use
      the generic transaction management APIs.</p><p>For distributed transactions across multiple Hibernate session
      factories, simply combine <code class="classname">JtaTransactionManager</code>
      as a transaction strategy with multiple
      <code class="classname">LocalSessionFactoryBean</code> definitions. Each DAO
      then gets one specific <code class="interfacename">SessionFactory</code>
      reference passed into its corresponding bean property. If all underlying
      JDBC data sources are transactional container ones, a business service
      can demarcate transactions across any number of DAOs and any number of
      session factories without special regard, as long as it is using
      <code class="classname">JtaTransactionManager</code> as the strategy.</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource1"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"java:comp/env/jdbc/myds1"</span>/&gt;

  &lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource2"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"java:comp/env/jdbc/myds2"</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mySessionFactory1"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate3.LocalSessionFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myDataSource1"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappingResources"</span>&gt;
      &lt;<span class="hl-tag">list</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;product.hbm.xml&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hibernateProperties"</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;
        hibernate.dialect=org.hibernate.dialect.MySQLDialect
        hibernate.show_sql=true
      &lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mySessionFactory2"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate3.LocalSessionFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myDataSource2"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappingResources"</span>&gt;
      &lt;<span class="hl-tag">list</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;inventory.hbm.xml&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hibernateProperties"</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;
        hibernate.dialect=org.hibernate.dialect.OracleDialect
      &lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myTxManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.jta.JtaTransactionManager"</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductDaoImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"mySessionFactory1"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myInventoryDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.InventoryDaoImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"mySessionFactory2"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductServiceImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"productDao"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myProductDao"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"inventoryDao"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myInventoryDao"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">aop:config</span>&gt;
    &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"productServiceMethods"</span>
                <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* product.ProductService.*(..))"</span>/&gt;
    &lt;<span class="hl-tag">aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"productServiceMethods"</span>/&gt;
  &lt;<span class="hl-tag">/aop:config</span>&gt;

  &lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"myTxManager"</span>&gt;
    &lt;<span class="hl-tag">tx:attributes</span>&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"increasePrice*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"REQUIRED"</span>/&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someOtherBusinessMethod"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"REQUIRES_NEW"</span>/&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"SUPPORTS"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span>/&gt;
    &lt;<span class="hl-tag">/tx:attributes</span>&gt;
  &lt;<span class="hl-tag">/tx:advice</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Both <code class="classname">HibernateTransactionManager</code> and
      <code class="classname">JtaTransactionManager</code> allow for proper JVM-level
      cache handling with Hibernate, without container-specific transaction
      manager lookup or a JCA connector (if you are not using EJB to initiate
      transactions).</p><p><code class="classname">HibernateTransactionManager</code> can export the
      Hibernate JDBC <code class="interfacename">Connection</code> to plain JDBC
      access code, for a specific <code class="interfacename">DataSource</code>.
      This capability allows for high-level transaction demarcation with mixed
      Hibernate and JDBC data access completely without JTA, if you are
      accessing only one database.
      <code class="classname">HibernateTransactionManager</code> automatically exposes
      the Hibernate transaction as a JDBC transaction if you have set up the
      passed-in <code class="interfacename">SessionFactory</code> with a
      <code class="interfacename">DataSource</code> through the
      <code class="classname">dataSource</code> property of the
      <code class="classname">LocalSessionFactoryBean</code> class. Alternatively, you
      can specify explicitly the <code class="interfacename">DataSource</code> for
      which the transactions are supposed to be exposed through the
      <code class="classname">dataSource</code> property of the
      <code class="classname">HibernateTransactionManager</code> class.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-resources"></a>14.3.6&nbsp;Comparing container-managed and locally defined resources</h3></div></div></div><p>You can switch between a container-managed JNDI
      <code class="interfacename">SessionFactory</code> and a
      locally defined one, without having to change a single line of
      application code. Whether to keep resource definitions in the container
      or locally within the application is mainly a matter of the transaction
      strategy that you use. Compared to a Spring-defined local
      <code class="interfacename">SessionFactory</code>, a manually registered
      JNDI <code class="interfacename">SessionFactory</code> does not provide any
      benefits. Deploying a <code class="interfacename">SessionFactory</code>
      through Hibernate's JCA connector provides the added value of
      participating in the Java EE server's management infrastructure, but
      does not add actual value beyond that.</p><p>Spring's transaction support is not bound to a container.
      Configured with any strategy other than JTA, transaction support also
      works in a stand-alone or test environment. Especially in the typical
      case of single-database transactions, Spring's single-resource local
      transaction support is
      a lightweight and powerful alternative to JTA. When you use local EJB
      stateless session beans to drive transactions, you depend both on an EJB
      container and JTA, even if you access only a single database, and only
      use stateless session beans to provide declarative transactions through
      container-managed transactions. Also,
      direct use of JTA programmatically requires a Java EE environment as
      well. JTA does not involve only container dependencies in terms of JTA
      itself and of JNDI <code class="interfacename">DataSource</code> instances.
      For non-Spring, JTA-driven Hibernate transactions, you have to use the
      Hibernate JCA connector, or extra Hibernate transaction code with the
      <code class="interfacename">TransactionManagerLookup</code> configured for
      proper JVM-level caching.</p><p>Spring-driven transactions can work as well with a locally defined
      Hibernate <code class="interfacename">SessionFactory</code> as they do with
      a local JDBC <code class="interfacename">DataSource </code>if they are
      accessing a single database. Thus you only have to use Spring's JTA
      transaction strategy when you have distributed transaction requirements.
      A JCA connector requires container-specific deployment steps, and
      obviously JCA support in the first place. This configuration requires
      more work than deploying a simple web application with local resource
      definitions and Spring-driven transactions. Also, you often need the
      Enterprise Edition of your container if you are using, for example,
      WebLogic Express, which does not provide JCA. A Spring application with
      local resources and transactions spanning one single database works in
      any Java EE web container (without JTA, JCA, or EJB) such as Tomcat,
      Resin, or even plain Jetty. Additionally, you can easily reuse such a
      middle tier in desktop applications or test suites.</p><p>All things considered, if you do not use EJBs, stick with local
      <code class="interfacename">SessionFactory</code> setup and Spring's
      <code class="classname">HibernateTransactionManager</code> or
      <code class="classname">JtaTransactionManager</code>. You get all of the
      benefits, including proper transactional JVM-level caching and
      distributed transactions, without the inconvenience of container
      deployment. JNDI registration of a Hibernate
      <code class="interfacename">SessionFactory</code> through the JCA connector
      only adds value when used in conjunction with EJBs.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-invalid-jdbc-access-error"></a>14.3.7&nbsp;Spurious application server warnings with Hibernate</h3></div></div></div><p>In some JTA environments with very strict
      <code class="interfacename">XADataSource</code> implementations -- currently
      only some WebLogic Server and WebSphere versions -- when Hibernate is
      configured without regard to the JTA
      <code class="interfacename">PlatformTransactionManager</code> object for
      that environment, it is possible for spurious warning or exceptions to
      show up in the application server log. These warnings or exceptions
      indicate that the connection being accessed is no longer valid, or JDBC
      access is no longer valid, possibly because the transaction is no longer
      active. As an example, here is an actual exception from WebLogic:</p><pre class="programlisting">java.sql.SQLException: The transaction is no longer active - status: 'Committed'.
   No further JDBC access is allowed within this transaction.</pre><p>You resolve this warning by simply making Hibernate aware of the
      JTA <code class="interfacename">PlatformTransactionManager</code> instance,
      to which it will synchronize (along with Spring). You have two options
      for doing this:</p><div class="itemizedlist"><ul type="disc"><li><p>If in your application context you are already directly
          obtaining the JTA
          <code class="interfacename">PlatformTransactionManager</code> object
          (presumably from JNDI through
          <code class="literal">JndiObjectFactoryBean/<code class="literal">&lt;jee:jndi-lookup&gt;</code></code>)
          and feeding it, for example, to Spring's
          <code class="classname">JtaTransactionManager</code>, then the easiest way
          is to specify a reference to the bean defining this JTA
          <code class="interfacename">PlatformTransactionManager</code>
          instance as
          the value of the <span class="property">jtaTransactionManager</span> property
          for <code class="classname">LocalSessionFactoryBean.</code> Spring then makes
          the object available to Hibernate.</p></li><li><p>More likely you do not already have the JTA
          <code class="interfacename">PlatformTransactionManager</code> instance,
          because Spring's <code class="classname">JtaTransactionManager</code> can
          find it itself. Thus
          you need to configure Hibernate to look up JTA
          <code class="interfacename">PlatformTransactionManager</code> directly.
          You do this by configuring an application server- specific
          <code class="literal">TransactionManagerLookup</code> class in the Hibernate
          configuration, as described in the Hibernate manual.</p></li></ul></div><p>The remainder of this section describes the sequence of events
      that occur with and without Hibernate's awareness of the JTA
      <code class="interfacename">PlatformTransactionManager</code>.</p><p>When Hibernate is not configured with any awareness of the JTA
      <code class="interfacename">PlatformTransactionManager</code>, the following
      events occur when a JTA transaction commits:</p><div class="orderedlist"><ol type="1"><li><p>The JTA transaction commits.</p></li><li><p>Spring's <code class="classname">JtaTransactionManager</code> is
          synchronized to the JTA transaction, so it is called back through an
          <span class="emphasis"><em>afterCompletion</em></span> callback by the JTA transaction
          manager.</p></li><li><p>Among other activities, this synchronization can
          trigger a callback by Spring to Hibernate, through Hibernate's
          <code class="literal">afterTransactionCompletion</code> callback (used
          to clear the Hibernate cache), followed by an explicit
          <code class="literal">close()</code> call on the Hibernate Session, which
          causes Hibernate to attempt to <code class="literal">close()</code> the JDBC
          Connection.</p></li><li><p>In some environments, this
          <code class="methodname">Connection.close()</code> call then triggers the
          warning or error, as the application server no longer considers the
          <code class="interfacename">Connection</code> usable at all, because the
          transaction has already been committed.</p></li></ol></div><p>When Hibernate is configured with awareness of the JTA
      <code class="interfacename">PlatformTransactionManager</code>, the following
      events occur when a JTA transaction commits:</p><div class="orderedlist"><ol type="1"><li><p>the JTA transaction is ready to commit.</p></li><li><p>Spring's <code class="classname">JtaTransactionManager</code> is
          synchronized to the JTA transaction, so the transaction is called
          back through a <span class="emphasis"><em>beforeCompletion</em></span> callback by the
          JTA transaction manager.</p></li><li><p>Spring is aware that Hibernate itself is synchronized to the
          JTA transaction, and behaves differently than in the previous
          scenario. Assuming the Hibernate
          <code class="interfacename">Session</code> needs to be closed at all,
          Spring will close it now.</p></li><li><p>The JTA transaction commits.</p></li><li><p>Hibernate is synchronized to the JTA transaction, so the
          transaction is called back through an
          <span class="emphasis"><em>afterCompletion</em></span> callback by the JTA transaction
          manager, and can properly clear its cache.</p></li></ol></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-jdo"></a>14.4&nbsp;JDO</h2></div></div></div><p>Spring supports the standard JDO 2.0 and 2.1 APIs as data access
    strategy, following the same style as the Hibernate support. The
    corresponding integration classes reside in the
    <code class="literal">org.springframework.orm.jdo</code> package.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-setup"></a>14.4.1&nbsp;<code class="interfacename">PersistenceManagerFactory</code>
      setup</h3></div></div></div><p>Spring provides a
      <code class="classname">LocalPersistenceManagerFactoryBean</code> class that
      allows you to define a local JDO
      <code class="interfacename">PersistenceManagerFactory</code> within a Spring
      application context:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myPmf"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.jdo.LocalPersistenceManagerFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"configLocation"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"classpath:kodo.properties"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Alternatively, you can set up a
      <code class="interfacename">PersistenceManagerFactory</code> through direct
      instantiation of a
      <code class="interfacename">PersistenceManagerFactory</code> implementation
      class. A JDO <code class="interfacename">PersistenceManagerFactory</code>
      implementation class follows the JavaBeans pattern, just like a JDBC
      <code class="interfacename">DataSource</code> implementation class, which is
      a natural fit for a configuration that uses Spring. This setup style
      usually supports a Spring-defined JDBC
      <code class="interfacename">DataSource</code>, passed into the
      <code class="classname">connectionFactory</code> property. For example, for the
      open source JDO implementation DataNucleus (formerly JPOX) (<a class="ulink" href="http://www.datanucleus.org/" target="_top">http://www.datanucleus.org/</a>),
      this is the XML configuration of the
      <code class="interfacename">PersistenceManagerFactory</code>
      implementation:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

 &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>&gt;
   &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.driverClassName}"</span>/&gt;
   &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span>/&gt;
   &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span>/&gt;
   &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span>/&gt;
 &lt;<span class="hl-tag">/bean</span>&gt;

 &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myPmf"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.datanucleus.jdo.JDOPersistenceManagerFactory"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>&gt;
   &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span>/&gt;
   &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"nontransactionalRead"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
 &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>You can also set up JDO
      <code class="interfacename">PersistenceManagerFactory</code> in the JNDI
      environment of a Java EE application server, usually through the JCA
      connector provided by the particular JDO implementation. Spring's
      standard <code class="literal">JndiObjectFactoryBean /
      <code class="literal">&lt;jee:jndi-lookup&gt;</code></code> can be used to
      retrieve and expose such a
      <code class="interfacename">PersistenceManagerFactory</code>. However,
      outside an EJB context, no real benefit exists in holding the
      <code class="interfacename">PersistenceManagerFactory</code> in JNDI: only
      choose such a setup for a good reason. See <a class="xref" href="#orm-hibernate-resources" title="14.3.6&nbsp;Comparing container-managed and locally defined resources">Section&nbsp;14.3.6, &#8220;Comparing container-managed and locally defined resources&#8221;</a> for a discussion; the arguments
      there apply to JDO as well.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-daos-straight"></a>14.4.2&nbsp;Implementing DAOs based on the plain JDO API</h3></div></div></div><p>DAOs can also be written directly against plain JDO API, without
      any Spring dependencies, by using an injected
      <code class="interfacename">PersistenceManagerFactory</code>. The following
      is an example of a corresponding DAO implementation:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductDaoImpl <span class="hl-keyword">implements</span> ProductDao {

    <span class="hl-keyword">private</span> PersistenceManagerFactory persistenceManagerFactory;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setPersistenceManagerFactory(PersistenceManagerFactory pmf) {
        <span class="hl-keyword">this</span>.persistenceManagerFactory = pmf;
    }

    <span class="hl-keyword">public</span> Collection loadProductsByCategory(String category) {
        PersistenceManager pm = <span class="hl-keyword">this</span>.persistenceManagerFactory.getPersistenceManager();
        <span class="hl-keyword">try</span> {
            Query query = pm.newQuery(Product.<span class="hl-keyword">class</span>, <span class="hl-string">"category = pCategory"</span>);
            query.declareParameters(<span class="hl-string">"String pCategory"</span>); 
            <span class="hl-keyword">return</span> query.execute(category);
        }
        <span class="hl-keyword">finally</span> {
          pm.close();
        }
    }
}</pre><p>Because the above DAO follows the dependency injection pattern, it
      fits nicely into a Spring container, just as it would if coded against
      Spring's <code class="classname">JdoTemplate</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductDaoImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"persistenceManagerFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myPmf"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The main problem with such DAOs is that they always get a new
      <code class="interfacename">PersistenceManager</code> from the factory. To
      access a Spring-managed transactional
      <code class="interfacename">PersistenceManager</code>, define a
      <code class="classname">TransactionAwarePersistenceManagerFactoryProxy</code>
      (as included in Spring) in front of your target
      <code class="interfacename">PersistenceManagerFactory</code>, then passing a
      reference to that proxy into your DAOs as in the following example:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myPmfProxy"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.jdo.TransactionAwarePersistenceManagerFactoryProxy"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetPersistenceManagerFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myPmf"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductDaoImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"persistenceManagerFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myPmfProxy"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Your data access code will receive a transactional
      <code class="interfacename">PersistenceManager</code> (if any) from the
      <code class="methodname">PersistenceManagerFactory.getPersistenceManager()</code>
      method that it calls. The latter method call goes through the proxy,
      which first checks for a current transactional
      <code class="interfacename">PersistenceManager</code> before getting a new
      one from the factory. Any <code class="methodname">close()</code> calls on the
      <code class="interfacename">PersistenceManager</code> are ignored in case of
      a transactional
      <code class="interfacename">PersistenceManager</code>.</p><p>If your data access code always runs within an active transaction
      (or at least within active transaction synchronization), it is safe to
      omit the <code class="methodname">PersistenceManager.close()</code> call and
      thus the entire <code class="literal">finally</code> block, which you might do to
      keep your DAO implementations concise:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductDaoImpl <span class="hl-keyword">implements</span> ProductDao {

    <span class="hl-keyword">private</span> PersistenceManagerFactory persistenceManagerFactory;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setPersistenceManagerFactory(PersistenceManagerFactory pmf) {
        <span class="hl-keyword">this</span>.persistenceManagerFactory = pmf;
    }

    <span class="hl-keyword">public</span> Collection loadProductsByCategory(String category) {
        PersistenceManager pm = <span class="hl-keyword">this</span>.persistenceManagerFactory.getPersistenceManager();
        Query query = pm.newQuery(Product.<span class="hl-keyword">class</span>, <span class="hl-string">"category = pCategory"</span>);
        query.declareParameters(<span class="hl-string">"String pCategory"</span>); 
        <span class="hl-keyword">return</span> query.execute(category);
    }
}</pre><p>With such DAOs that rely on active transactions, it is recommended
      that you enforce active transactions through turning off
      <code class="classname">TransactionAwarePersistenceManagerFactoryProxy</code>'s
      <code class="classname">allowCreate</code> flag:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myPmfProxy"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.jdo.TransactionAwarePersistenceManagerFactoryProxy"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetPersistenceManagerFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myPmf"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"allowCreate"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"false"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductDaoImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"persistenceManagerFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myPmfProxy"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The main advantage of this DAO style is that it depends on JDO API
      only; no import of any Spring class is required. This is of course
      appealing from a non-invasiveness perspective, and might feel more
      natural to JDO developers.</p><p>However, the DAO throws plain
      <code class="exceptionname">JDOException</code> (which is unchecked, so does
      not have to be declared or caught), which means that callers can only
      treat exceptions as fatal, unless you want to depend on JDO's own
      exception structure. Catching specific causes such as an optimistic
      locking failure is not possible without tying the caller to the
      implementation strategy. This trade off might be acceptable to
      applications that are strongly JDO-based and/or do not need any special
      exception treatment.</p><p>In summary, you can DAOs based on the plain JDO API, and they can
      still participate in Spring-managed transactions. This strategy might
      appeal to you if you are already familiar with JDO. However, such DAOs
      throw plain <code class="exceptionname">JDOException</code>, and you would
      have to convert explicitly to Spring's
      <code class="exceptionname">DataAccessException</code> (if desired).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-tx"></a>14.4.3&nbsp;Transaction management</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You are <span class="emphasis"><em>strongly</em></span> encouraged to read <a class="xref" href="#transaction-declarative" title="11.5&nbsp;Declarative transaction management">Section&nbsp;11.5, &#8220;Declarative transaction management&#8221;</a> if you have not done so, to get a
        more detailed coverage of Spring's declarative transaction
        support.</p></td></tr></table></div><p>To execute service operations within transactions, you can use
      Spring's common declarative transaction facilities. For example:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span>
        <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
        <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
        <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
        <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
   http://www.springframework.org/schema/beans 
   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
   http://www.springframework.org/schema/tx 
   http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
   http://www.springframework.org/schema/aop 
   http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myTxManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.jdo.JdoTransactionManager"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"persistenceManagerFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myPmf"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductServiceImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"productDao"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myProductDao"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span>&gt;
    &lt;<span class="hl-tag">tx:attributes</span>&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"increasePrice*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"REQUIRED"</span>/&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someOtherBusinessMethod"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"REQUIRES_NEW"</span>/&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"SUPPORTS"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span>/&gt;
    &lt;<span class="hl-tag">/tx:attributes</span>&gt;
  &lt;<span class="hl-tag">/tx:advice</span>&gt;

  &lt;<span class="hl-tag">aop:config</span>&gt;
    &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"productServiceMethods"</span>
            <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* product.ProductService.*(..))"</span>/&gt;
    &lt;<span class="hl-tag">aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"productServiceMethods"</span>/&gt;
  &lt;<span class="hl-tag">/aop:config</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>JDO requires an active transaction to modify a persistent object.
      The non-transactional flush concept does not exist in JDO, in contrast
      to Hibernate. For this reason, you need to set up the chosen JDO
      implementation for a specific environment. Specifically, you need to set
      it up explicitly for JTA synchronization, to detect an active JTA
      transaction itself. This is not necessary for local transactions as
      performed by Spring's <code class="classname">JdoTransactionManager</code>, but
      it is necessary to participate in JTA transactions, whether driven by
      Spring's <code class="classname">JtaTransactionManager</code> or by EJB CMT and
      plain JTA.</p><p><code class="classname">JdoTransactionManager</code> is capable of
      exposing a JDO transaction to JDBC access code that accesses the same
      JDBC <code class="interfacename">DataSource</code>, provided that the
      registered <code class="classname">JdoDialect</code> supports retrieval of the
      underlying JDBC <code class="interfacename">Connection</code>. This is the
      case for JDBC-based JDO 2.0 implementations by default.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-dialect"></a>14.4.4&nbsp;<code class="interfacename">JdoDialect</code></h3></div></div></div><p>As an advanced feature, both <code class="classname">JdoTemplate</code>
      and <code class="classname">JdoTransactionManager</code> support a custom
      <code class="interfacename">JdoDialect</code> that can be passed into the
      <code class="code">jdoDialect</code> bean property. In this scenario, the DAOs will
      not receive a <code class="interfacename">PersistenceManagerFactory</code>
      reference but rather a full <code class="classname">JdoTemplate</code> instance
      (for example, passed into the <code class="literal">jdoTemplate</code>
      property of <code class="classname">JdoDaoSupport</code>). Using a
      <code class="interfacename">JdoDialect</code> implementation, you can enable
      advanced features supported by Spring, usually in a vendor-specific
      manner:</p><div class="itemizedlist"><ul type="disc"><li><p>Applying specific transaction semantics such as custom
          isolation level or transaction timeout</p></li><li><p>Retrieving the transactional JDBC
          <code class="interfacename">Connection</code> for exposure to JDBC-based
          DAOs</p></li><li><p>Applying query timeouts, which are automatically calculated
          from Spring-managed transaction timeouts</p></li><li><p>Eagerly flushing a
          <code class="interfacename">PersistenceManager,</code> to make
          transactional changes visible to JDBC-based data access code</p></li><li><p>Advanced translation of <code class="literal">JDOExceptions</code> to
          Spring <code class="literal">DataAccessExceptions</code></p></li></ul></div><p>See the <code class="classname">JdoDialect</code> Javadoc for more details
      on its operations and how to use them within Spring's JDO
      support.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-jpa"></a>14.5&nbsp;JPA</h2></div></div></div><p>The Spring JPA, available under the
    <code class="literal">org.springframework.orm.jpa</code> package, offers
    comprehensive support for the <a class="ulink" href="http://java.sun.com/developer/technicalArticles/J2EE/jpa/index.html" target="_top">Java
    Persistence API</a> in a similar manner to the integration with
    Hibernate or JDO, while being aware of the underlying implementation in
    order to provide additional features.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jpa-setup"></a>14.5.1&nbsp;Three options for JPA setup in a Spring environment</h3></div></div></div><p>The Spring JPA support offers three ways of setting up the JPA
      <code class="interfacename">EntityManagerFactory</code> that will be used by
      the application to obtain an entity manager.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jpa-setup-lemfb"></a>14.5.1.1&nbsp;<code class="classname">LocalEntityManagerFactoryBean</code></h4></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Only use this option in simple deployment environments such as
          stand-alone applications and integration tests.</p></td></tr></table></div><p>The <code class="classname">LocalEntityManagerFactoryBean</code> creates
        an <code class="interfacename">EntityManagerFactory</code> suitable for
        simple deployment environments where the application uses only JPA for
        data access. The factory bean uses the JPA
        <code class="interfacename">PersistenceProvider</code> autodetection
        mechanism (according to JPA's Java SE bootstrapping) and, in most
        cases, requires you to specify only the persistence unit name:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

   &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myEmf"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.jpa.LocalEntityManagerFactoryBean"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"persistenceUnitName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"myPersistenceUnit"</span>/&gt;
   &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>This form of JPA deployment is the simplest and the most
        limited. You cannot refer to
        an existing JDBC <code class="interfacename">DataSource</code> bean
        definition and no support for global transactions exists. Furthermore,
        weaving (byte-code transformation) of persistent classes is
        provider-specific, often requiring a specific JVM agent to specified
        on startup. This option is sufficient only for stand-alone
        applications and test environments, for which the JPA specification is
        designed.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jpa-setup-jndi"></a>14.5.1.2&nbsp;Obtaining an <code class="classname">EntityManagerFactory</code> from
        JNDI</h4></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Use this option when deploying to a Java EE 5 server. Check
          your server's documentation on how to deploy a custom JPA provider
          into your server, allowing for a different provider than the
          server's default.</p></td></tr></table></div><p>Obtaining an <code class="interfacename">EntityManagerFactory</code>
        from JNDI (for example in a Java EE 5 environment), is simply a matter
        of changing the XML configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

    &lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myEmf"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"persistence/myPersistenceUnit"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>This action assumes standard Java EE 5 bootstrapping: the Java
        EE server autodetects persistence units (in effect,
        <code class="literal">META-INF/persistence.xml</code> files in application jars)
        and <code class="literal">persistence-unit-ref</code> entries in the Java EE
        deployment descriptor (for example, <code class="literal">web.xml</code>) and
        defines environment naming context locations for those persistence
        units.</p><p>In such a scenario, the entire persistence unit deployment,
        including the weaving (byte-code transformation) of persistent
        classes, is up to the Java EE server. The JDBC
        <code class="interfacename">DataSource</code> is defined through a JNDI
        location in the <code class="literal">META-INF/persistence.xml</code> file;
        EntityManager transactions are integrated with the server's JTA
        subsystem. Spring merely uses the obtained
        <code class="interfacename">EntityManagerFactory</code>, passing it on to
        application objects through dependency injection, and managing
        transactions for the persistence unit,
        typically through <code class="classname">JtaTransactionManager</code>.</p><p>If multiple persistence units are used in the same application,
        the bean names of such JNDI-retrieved persistence units should match
        the persistence unit names that the application uses to refer to them,
        for example, in <code class="literal">@PersistenceUnit</code> and
        <code class="literal">@PersistenceContext</code> annotations.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jpa-setup-lcemfb"></a>14.5.1.3&nbsp;<code class="classname">LocalContainerEntityManagerFactoryBean</code></h4></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Use this option for full JPA capabilities in a Spring-based
          application environment. This includes web containers such as Tomcat
          as well as stand-alone applications and integration tests with
          sophisticated persistence requirements.</p></td></tr></table></div><p>The
        <code class="classname">LocalContainerEntityManagerFactoryBean</code> gives
        full control over <code class="interfacename">EntityManagerFactory</code>
        configuration and is appropriate for environments where fine-grained
        customization is required. The
        <code class="classname">LocalContainerEntityManagerFactoryBean</code> creates
        a <code class="interfacename">PersistenceUnitInfo</code> instance based
        on the <code class="literal">persistence.xml</code> file, the supplied
        <code class="literal">dataSourceLookup</code> strategy, and the specified
        <code class="literal">loadTimeWeaver</code>. It is thus possible to work with
        custom data sources outside of JNDI and to control the weaving
        process. The following example shows a typical bean definition for a
        <code class="interfacename">LocalContainerEntityManagerFactoryBean</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
        
 &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myEmf"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"someDataSource"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"loadTimeWeaver"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.instrument.classloading.InstrumentationLoadTimeWeaver"</span>/&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
 &lt;<span class="hl-tag">/bean</span>&gt;
 
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The following example shows a typical
        <code class="literal">persistence.xml</code> file:</p><pre class="programlisting">&lt;<span class="hl-tag">persistence</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://java.sun.com/xml/ns/persistence"</span> <span class="hl-attribute">version</span>=<span class="hl-value">"1.0"</span>&gt;

  &lt;<span class="hl-tag">persistence-unit</span> <span class="hl-attribute">name</span>=<span class="hl-value">"myUnit"</span> <span class="hl-attribute">transaction-type</span>=<span class="hl-value">"RESOURCE_LOCAL"</span>&gt;
    &lt;<span class="hl-tag">mapping-file</span>&gt;META-INF/orm.xml&lt;<span class="hl-tag">/mapping-file</span>&gt;
    &lt;<span class="hl-tag">exclude-unlisted-classes</span>/&gt;
  &lt;<span class="hl-tag">/persistence-unit</span>&gt;

&lt;<span class="hl-tag">/persistence</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="code">exclude-unlisted-classes</code> element always
          indicates that <span class="emphasis"><em>no</em></span> scanning for annotated entity
          classes is supposed to occur, in order to support the
          <code class="code">&lt;exclude-unlisted-classes/&gt;</code> shortcut. This is in
          line with the JPA specification, which suggests that shortcut, but
          unfortunately is in conflict with the JPA XSD, which implies
          <code class="code">false</code> for that shortcut. Consequently,
          <code class="code">&lt;exclude-unlisted-classes&gt; false
          &lt;/exclude-unlisted-classes/&gt;</code> is not supported. Simply
          omit the <code class="code">exclude-unlisted-classes</code> element if you want
          entity class scanning to occur.</p></td></tr></table></div><p>Using the
        <code class="classname">LocalContainerEntityManagerFactoryBean</code> is the
        most powerful JPA setup option, allowing for flexible local
        configuration within the application. It supports links to an existing
        JDBC <code class="interfacename">DataSource</code>, supports both local
        and global transactions, and so on. However, it also imposes
        requirements on the runtime environment, such as the availability of
        a weaving-capable class loader if the persistence provider demands
        byte-code transformation.</p><p>This option may conflict with the built-in JPA capabilities of a
        Java EE 5 server. In a full Java EE 5 environment, consider obtaining
        your <code class="interfacename">EntityManagerFactory</code> from JNDI.
        Alternatively, specify a custom
        <code class="classname">persistenceXmlLocation</code> on your
        <code class="classname">LocalContainerEntityManagerFactoryBean</code>
        definition, for example, META-INF/my-persistence.xml, and only include
        a descriptor with that name in your application jar files. Because the
        Java EE 5 server only looks for default
        <code class="literal">META-INF/persistence.xml</code> files, it ignores such
        custom persistence units and hence avoid conflicts with a
        Spring-driven JPA setup upfront. (This applies to Resin 3.1, for
        example.)</p><div class="sidebar"><p class="title"><b>When is load-time weaving required?</b></p><p>Not all JPA providers require a JVM agent ; Hibernate is an
          example of one that does not. If your provider does not require an
          agent or you have other alternatives, such as applying enhancements
          at build time through a custom compiler or an ant task, the
          load-time weaver <span class="bold"><strong>should not</strong></span> be
          used.</p></div><p>The <code class="interfacename">LoadTimeWeaver</code> interface is a
        Spring-provided class that allows JPA
        <code class="interfacename">ClassTransformer</code> instances to be
        plugged in a specific manner, depending whether the environment is a
        web container or application server. 
        Hooking <code class="literal">ClassTransformers</code> through a Java 5 <a class="ulink" href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/instrument/package-summary.html" target="_top">agent</a>
        typically is not efficient. The agents work against the
        <span class="emphasis"><em>entire virtual machine</em></span> and inspect
        <span class="emphasis"><em>every</em></span> class that is loaded, which is usually
        undesirable in a production server environment.</p><p>Spring provides a number of
        <code class="interfacename">LoadTimeWeaver</code> implementations for
        various environments, allowing
        <code class="interfacename">ClassTransformer</code> instances to be
        applied only <span class="emphasis"><em>per class loader</em></span> and not per
        VM.</p><p>Refer to <a class="xref" href="#aop-aj-ltw-spring" title="8.8.4.5&nbsp;Spring configuration">Section&nbsp;8.8.4.5, &#8220;Spring configuration&#8221;</a> in the AOP chapter for more insight regarding the 
        <code class="interfacename">LoadTimeWeaver</code> implementations and their setup, either generic or customized to 
        various platforms (such as Tomcat, WebLogic, OC4J, GlassFish, Resin and JBoss).</p><p>As described in the aforementioned section, you can configure a context-wide <code class="interfacename">LoadTimeWeaver</code>
		using the  <code class="literal">context:load-time-weaver</code> configuration element. (This has been available since Spring 2.5.)
		Such a global weaver is picked up by all JPA <code class="classname">LocalContainerEntityManagerFactoryBeans</code>
        automatically. This is the preferred way of setting up a load-time weaver, delivering autodetection of the platform 
        (WebLogic, OC4J, GlassFish, Tomcat, Resin, JBoss or VM agent) and automatic propagation of the weaver to all weaver-aware beans:</p><pre class="programlisting">&lt;<span class="hl-tag">context:load-time-weaver</span>/&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emf"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</span>&gt;
    ...
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p> However, if needed, one can manually specify a dedicated weaver through the <code class="literal">loadTimeWeaver</code> property:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emf"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"loadTimeWeaver"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.instrument.classloading.ReflectiveLoadTimeWeaver"</span>/&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>No matter how the LTW is configured, using this technique, JPA applications relying on
          instrumentation can run in the target platform (ex: Tomcat) without needing an agent. 
          This is important especially when the hosting applications rely on different JPA implementations 
          because the JPA transformers are applied only at class loader level and thus are
          isolated from each other.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jpa-multiple-pu"></a>14.5.1.4&nbsp;Dealing with multiple persistence units</h4></div></div></div><p>For applications that rely on multiple persistence units
        locations, stored in various JARS in the classpath, for example,
        Spring offers the
        <code class="interfacename">PersistenceUnitManager</code> to act as a
        central repository and to avoid the persistence units discovery
        process, which can be expensive. The default implementation allows
        multiple locations to be specified that are parsed and later retrieved
        through the persistence unit name. (By default, the classpath is
        searched for <code class="filename">META-INF/persistence.xml</code>
        files.)</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"pum"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.jpa.persistenceunit.DefaultPersistenceUnitManager"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"persistenceXmlLocations"</span>&gt;
    &lt;<span class="hl-tag">list</span>&gt;
     &lt;<span class="hl-tag">value</span>&gt;org/springframework/orm/jpa/domain/persistence-multi.xml&lt;<span class="hl-tag">/value</span>&gt;
     &lt;<span class="hl-tag">value</span>&gt;classpath:/my/package/**/custom-persistence.xml&lt;<span class="hl-tag">/value</span>&gt;
     &lt;<span class="hl-tag">value</span>&gt;classpath*:META-INF/persistence.xml&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSources"</span>&gt;
   &lt;<span class="hl-tag">map</span>&gt;
    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"localDataSource"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"local-db"</span>/&gt;
    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"remoteDataSource"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"remote-db"</span>/&gt;
   &lt;<span class="hl-tag">/map</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-comment">!-- if no datasource is specified, use this one --</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"defaultDataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"remoteDataSource"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emf"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"persistenceUnitManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"pum"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"persistenceUnitName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"myCustomUnit"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The default implementation allows customization of the
        <code class="interfacename">PersistenceUnitInfo</code> instances,
        before they are fed to the JPA provider, declaratively through its
        properties,
        which affect <span class="emphasis"><em>all</em></span> hosted units, or
        programmatically, through the
        <code class="interfacename">PersistenceUnitPostProcessor</code>, which
        allows persistence unit selection. If no
        <code class="interfacename">PersistenceUnitManager</code> is specified,
        one is created and used internally by
        <code class="classname">LocalContainerEntityManagerFactoryBean</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jpa-straight"></a>14.5.2&nbsp;Implementing DAOs based on plain JPA</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Although <code class="interfacename">EntityManagerFactory</code>
        instances are thread-safe,
        <code class="interfacename">EntityManager</code> instances are not. The
        injected JPA <code class="interfacename">EntityManager</code> behaves like
        an <code class="interfacename">EntityManager</code> fetched from an
        application server's JNDI environment, as defined by the JPA
        specification. It delegates all calls to the current transactional
        <code class="interfacename">EntityManager</code>, if any; otherwise, it
        falls back to a newly created
        <code class="interfacename">EntityManager</code> per operation, in effect
        making its usage thread-safe.</p></td></tr></table></div><p>It is possible to write code against the plain JPA without any
      Spring dependencies, by using an injected
      <code class="interfacename">EntityManagerFactory</code> or
      <code class="interfacename">EntityManager</code>. Spring can understand
      <code class="interfacename">@PersistenceUnit</code> and
      <code class="interfacename">@PersistenceContext</code> annotations both at
      field and method level if a
      <code class="classname">PersistenceAnnotationBeanPostProcessor</code> is
      enabled. A plain JPA DAO implementation using the
      <code class="interfacename">@PersistenceUnit</code> annotation might
      look like this:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductDaoImpl <span class="hl-keyword">implements</span> ProductDao {

    <span class="hl-keyword">private</span> EntityManagerFactory emf;

    @PersistenceUnit
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setEntityManagerFactory(EntityManagerFactory emf) {
        <span class="hl-keyword">this</span>.emf = emf;
    }

    <span class="hl-keyword">public</span> Collection loadProductsByCategory(String category) {
        EntityManager em = <span class="hl-keyword">this</span>.emf.createEntityManager();
        <span class="hl-keyword">try</span> {
             Query query = em.createQuery(<span class="hl-string">"from Product as p where p.category = ?1"</span>);
             query.setParameter(1, category);
             <span class="hl-keyword">return</span> query.getResultList();
        }
        <span class="hl-keyword">finally</span> {
            <span class="hl-keyword">if</span> (em != null) {
                em.close();
            }
        }
    }
}</pre><p>The DAO above has no dependency on Spring and still fits nicely
      into a Spring application context. Moreover, the DAO takes advantage of
      annotations to require the injection of the default
      <code class="interfacename">EntityManagerFactory</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-comment">!-- bean post-processor for JPA annotations --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor"</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductDaoImpl"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>As an alternative to defining a
      <code class="classname">PersistenceAnnotationBeanPostProcessor</code>
      explicitly, consider using the Spring
      <code class="literal">context:annotation-config</code> XML element in your
      application context configuration. Doing so automatically registers all
      Spring standard post-processors for annotation-based configuration,
      including <code class="classname">CommonAnnotationBeanPostProcessor</code> and
      so on.</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-comment">!-- post-processors for all standard config annotations --</span>&gt;
  &lt;<span class="hl-tag">context:annotation-config</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductDaoImpl"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The main problem with such a DAO is that it always creates a new
      <code class="interfacename">EntityManager</code> through the factory. You
      can avoid this by requesting a transactional
      <code class="interfacename">EntityManager</code> (also called "shared
      EntityManager" because it is a shared, thread-safe proxy for the actual
      transactional EntityManager) to be injected instead of the
      factory:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductDaoImpl <span class="hl-keyword">implements</span> ProductDao {

    @PersistenceContext
    <span class="hl-keyword">private</span> EntityManager em;

    <span class="hl-keyword">public</span> Collection loadProductsByCategory(String category) {
       Query query = em.createQuery(<span class="hl-string">"from Product as p where p.category = :category"</span>);
       query.setParameter(<span class="hl-string">"category"</span>, category);
       <span class="hl-keyword">return</span> query.getResultList(); 
    }
}</pre><p>The <code class="literal">@PersistenceContext</code> annotation has an
      optional attribute <code class="literal">type</code>, which defaults to
      <code class="literal">PersistenceContextType.TRANSACTION</code>. This default is
      what you need to receive a shared EntityManager proxy. The alternative,
      <code class="literal">PersistenceContextType.EXTENDED</code>, is a completely
      different affair: This results in a so-called extended EntityManager,
      which is <span class="emphasis"><em>not thread-safe</em></span> and hence must not be used
      in a concurrently accessed component such as a Spring-managed singleton
      bean. Extended EntityManagers are only supposed to be used in stateful
      components that, for example, reside in a session, with the lifecycle of
      the EntityManager not tied to a current transaction but rather being
      completely up to the application.</p><div class="sidebar"><p class="title"><b>Method- and field-level Injection</b></p><p>Annotations that indicate dependency injections (such as
        <code class="literal">@PersistenceUnit</code> and
        <code class="literal">@PersistenceContext</code>) can be applied on field or
        methods inside a class, hence the expressions <span class="emphasis"><em>method-level
        injection</em></span> and <span class="emphasis"><em>field-level injection</em></span>.
        Field-level annotations are concise and easier to use while
        method-level allows for further processing of the injected dependency.
        In both cases the member visibility (public, protected, private) does
        not matter.</p><p>What about class-level annotations?</p><p>On the Java EE 5 platform, they are used for dependency
        declaration and not for resource injection.</p></div><p>The injected <code class="interfacename">EntityManager</code> is
      Spring-managed (aware of the ongoing transaction). It is important to
      note that even though the new DAO implementation uses method level
      injection of an <code class="interfacename">EntityManager</code> instead of
      an <code class="interfacename">EntityManagerFactory</code>, no change is
      required in the application context XML due to annotation usage.</p><p>The main advantage of this DAO style is that it only depends on
      Java Persistence API; no import of any Spring class is required.
      Moreover, as the JPA annotations are understood, the injections are
      applied automatically by the Spring container. This is appealing from a
      non-invasiveness perspective, and might feel more natural to JPA
      developers.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jpa-tx"></a>14.5.3&nbsp;Transaction Management</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You are <span class="emphasis"><em>strongly</em></span> encouraged to read <a class="xref" href="#transaction-declarative" title="11.5&nbsp;Declarative transaction management">Section&nbsp;11.5, &#8220;Declarative transaction management&#8221;</a> if you have not done so, to get a
        more detailed coverage of Spring's declarative transaction
        support.</p></td></tr></table></div><p>To execute service operations within transactions, you can use
      Spring's common declarative transaction facilities. For example:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
       <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/tx 
       http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
       http://www.springframework.org/schema/aop 
       http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myTxManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.jpa.JpaTransactionManager"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"entityManagerFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myEmf"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductServiceImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"productDao"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myProductDao"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;
  
  &lt;<span class="hl-tag">aop:config</span>&gt;
    &lt;<span class="hl-tag">aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"productServiceMethods"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* product.ProductService.*(..))"</span>/&gt;
    &lt;<span class="hl-tag">aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"productServiceMethods"</span>/&gt;
  &lt;<span class="hl-tag">/aop:config</span>&gt;

  &lt;<span class="hl-tag">tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"myTxManager"</span>&gt;
    &lt;<span class="hl-tag">tx:attributes</span>&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"increasePrice*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"REQUIRED"</span>/&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someOtherBusinessMethod"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"REQUIRES_NEW"</span>/&gt;
      &lt;<span class="hl-tag">tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"SUPPORTS"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span>/&gt;
    &lt;<span class="hl-tag">/tx:attributes</span>&gt;
  &lt;<span class="hl-tag">/tx:advice</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Spring JPA allows a configured
      <code class="classname">JpaTransactionManager</code> to expose a JPA transaction
      to JDBC access code that accesses the same JDBC
      <code class="interfacename">DataSource</code>, provided that the registered
      <code class="interfacename">JpaDialect</code> supports retrieval of the
      underlying JDBC <code class="interfacename">Connection</code>. Out of the
      box, Spring provides dialects for the Toplink, Hibernate and OpenJPA JPA
      implementations. See the next section for details on the
      <code class="interfacename">JpaDialect</code> mechanism.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jpa-dialect"></a>14.5.4&nbsp;<code class="interfacename">JpaDialect</code></h3></div></div></div><p>As an advanced feature <code class="classname">JpaTemplate</code>,
      <code class="classname">JpaTransactionManager</code> and subclasses of
      <code class="classname">AbstractEntityManagerFactoryBean</code> support a custom
      <code class="interfacename">JpaDialect</code>, to be passed into the
      <span class="property">jpaDialect</span> bean property. In such a scenario, the
      DAOs do not receive an
      <code class="interfacename">EntityManagerFactory</code> reference but rather
      a full <code class="classname">JpaTemplate</code> instance (for example,
      passed
      into the <span class="property">jpaTemplate</span> property<code class="classname"> of
      JpaDaoSupport</code>). A <code class="interfacename">JpaDialect</code>
      implementation can enable some advanced features supported by Spring,
      usually in a vendor-specific manner:</p><div class="itemizedlist"><ul type="disc"><li><p>Applying specific transaction semantics such as custom
          isolation level or transaction timeout)</p></li><li><p>Retrieving the transactional JDBC
          <code class="interfacename">Connection</code> for exposure to JDBC-based
          DAOs)</p></li><li><p>Advanced translation of
          <code class="literal">PersistenceExceptions</code> to Spring
          <code class="literal">DataAccessExceptions</code></p></li></ul></div><p>This is particularly valuable for special transaction semantics
      and for advanced translation of exception. The default implementation
      used (<code class="classname">DefaultJpaDialect</code>) does not provide any
      special capabilities and if the above features are required, you have to
      specify the appropriate dialect.</p><p>See the <code class="interfacename">JpaDialect</code> Javadoc for more
      details of its operations and how they are used within Spring's JPA
      support.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-ibatis"></a>14.6&nbsp;iBATIS SQL Maps</h2></div></div></div><p>The iBATIS support in the Spring Framework much resembles the JDBC
    support in that it supports the same template style programming, and as
    with JDBC and other ORM technologies, the iBATIS support works with
    Spring's exception hierarchy and lets you enjoy Spring's IoC
    features.</p><p>Transaction management can be handled through Spring's standard
    facilities. No special transaction strategies are necessary for iBATIS,
    because no special transactional resource involved other than a JDBC
    <code class="interfacename">Connection</code>. Hence, Spring's standard JDBC
    <code class="classname">DataSourceTransactionManager</code> or
    <code class="classname">JtaTransactionManager</code> are perfectly
    sufficient.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Spring supports iBATIS 2.x. The iBATIS 1.x support classes are no
      longer provided.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-ibatis-setup"></a>14.6.1&nbsp;Setting up the <code class="classname">SqlMapClient</code></h3></div></div></div><p>Using iBATIS SQL Maps involves creating SqlMap configuration files
      containing statements and result maps. Spring takes care of loading
      those using the <code class="classname">SqlMapClientFactoryBean</code>. For the
      examples we will be using the following <code class="classname">Account</code>
      class:</p><pre class="programlisting">public class Account {

    private String name;
    private String email; 

    public String getName() {
        return this.name;
    }
 
    public void setName(String name) {
        this.name = name;
    }

    public String getEmail() {
        return this.email;
    }

    public void setEmail(String email) {
        this.email = email;
    }
}</pre><p>To map this <code class="classname">Account</code> class with iBATIS 2.x we
      need to create the following SQL map
      <code class="filename">Account.xml</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">sqlMap</span> <span class="hl-attribute">namespace</span>=<span class="hl-value">"Account"</span>&gt;

  &lt;<span class="hl-tag">resultMap</span> <span class="hl-attribute">id</span>=<span class="hl-value">"result"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.Account"</span>&gt;
    &lt;<span class="hl-tag">result</span> <span class="hl-attribute">property</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">column</span>=<span class="hl-value">"NAME"</span> <span class="hl-attribute">columnIndex</span>=<span class="hl-value">"1"</span>/&gt;
    &lt;<span class="hl-tag">result</span> <span class="hl-attribute">property</span>=<span class="hl-value">"email"</span> <span class="hl-attribute">column</span>=<span class="hl-value">"EMAIL"</span> <span class="hl-attribute">columnIndex</span>=<span class="hl-value">"2"</span>/&gt;
  &lt;<span class="hl-tag">/resultMap</span>&gt;

  &lt;<span class="hl-tag">select</span> <span class="hl-attribute">id</span>=<span class="hl-value">"getAccountByEmail"</span> <span class="hl-attribute">resultMap</span>=<span class="hl-value">"result"</span>&gt;
    select ACCOUNT.NAME, ACCOUNT.EMAIL
    from ACCOUNT
    where ACCOUNT.EMAIL = #value#
  &lt;<span class="hl-tag">/select</span>&gt;

  &lt;<span class="hl-tag">insert</span> <span class="hl-attribute">id</span>=<span class="hl-value">"insertAccount"</span>&gt;
    insert into ACCOUNT (NAME, EMAIL) values (#name#, #email#)
  &lt;<span class="hl-tag">/insert</span>&gt;

&lt;<span class="hl-tag">/sqlMap</span>&gt;</pre><p>The configuration file for iBATIS 2 looks like this:</p><pre class="programlisting">&lt;<span class="hl-tag">sqlMapConfig</span>&gt;

  &lt;<span class="hl-tag">sqlMap</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"example/Account.xml"</span>/&gt;

&lt;<span class="hl-tag">/sqlMapConfig</span>&gt;</pre><p>Remember that iBATIS loads resources from the class path, so be
      sure to add the<code class="filename">Account.xml</code> file to the class
      path.</p><p>We can use the <code class="classname">SqlMapClientFactoryBean</code> in
      the Spring container. Note that with iBATIS SQL Maps 2.x, the JDBC
      <code class="interfacename">DataSource</code> is usually specified on the
      <code class="classname">SqlMapClientFactoryBean</code>, which enables lazy
      loading. This is the configuration needed for these bean
      definitions:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.driverClassName}"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sqlMapClient"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.ibatis.SqlMapClientFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"configLocation"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"WEB-INF/sqlmap-config.xml"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-ibatis-template"></a>14.6.2&nbsp;Using <code class="classname">SqlMapClientTemplate</code> and
      <code class="classname">SqlMapClientDaoSupport</code></h3></div></div></div><p>The <code class="classname">SqlMapClientDaoSupport</code> class offers a
      supporting class similar to the <code class="classname">SqlMapDaoSupport</code>.
      We extend it to implement our DAO:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SqlMapAccountDao <span class="hl-keyword">extends</span> SqlMapClientDaoSupport <span class="hl-keyword">implements</span> AccountDao {

    <span class="hl-keyword">public</span> Account getAccount(String email) <span class="hl-keyword">throws</span> DataAccessException {
        <span class="hl-keyword">return</span> (Account) getSqlMapClientTemplate().queryForObject(<span class="hl-string">"getAccountByEmail"</span>, email);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account account) <span class="hl-keyword">throws</span> DataAccessException {
        getSqlMapClientTemplate().update(<span class="hl-string">"insertAccount"</span>, account);
    }
}</pre><p>In the DAO, we use the pre-configured
      <code class="classname">SqlMapClientTemplate</code> to execute the queries,
      after setting up the <code class="literal">SqlMapAccountDao</code> in the
      application context and wiring it with our
      <code class="literal">SqlMapClient</code> instance:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SqlMapAccountDao"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sqlMapClient"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"sqlMapClient"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>An <code class="classname">SqlMapTemplate</code> instance can also be
      created manually, passing in the <code class="literal">SqlMapClient</code> as
      constructor argument. The <code class="literal">SqlMapClientDaoSupport</code> base
      class simply preinitializes a
      <code class="classname">SqlMapClientTemplate</code> instance for us.</p><p>The <code class="classname">SqlMapClientTemplate</code> offers a generic
      <code class="literal">execute</code> method, taking a custom
      <code class="literal">SqlMapClientCallback</code> implementation as argument. This
      can, for example, be used for batching:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SqlMapAccountDao <span class="hl-keyword">extends</span> SqlMapClientDaoSupport <span class="hl-keyword">implements</span> AccountDao {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account account) <span class="hl-keyword">throws</span> DataAccessException {
        getSqlMapClientTemplate().execute(<span class="hl-keyword">new</span> SqlMapClientCallback() {
            <span class="hl-keyword">public</span> Object doInSqlMapClient(SqlMapExecutor executor) <span class="hl-keyword">throws</span> SQLException {
                executor.startBatch();
                executor.update(<span class="hl-string">"insertAccount"</span>, account);
                executor.update(<span class="hl-string">"insertAddress"</span>, account.getAddress());
                executor.executeBatch();
            }
        });
    }
}</pre><p>In general, any combination of operations offered by the native
      <code class="literal">SqlMapExecutor</code> API can be used in such a callback.
      Any thrown <code class="literal">SQLException</code> is converted automatically to
      Spring's generic <code class="classname">DataAccessException</code>
      hierarchy.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-ibatis-straight"></a>14.6.3&nbsp;Implementing DAOs based on plain iBATIS API</h3></div></div></div><p>DAOs can also be written against plain iBATIS API, without any
      Spring dependencies, directly using an injected
      <code class="literal">SqlMapClient</code>. The following example shows a
      corresponding DAO implementation:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SqlMapAccountDao <span class="hl-keyword">implements</span> AccountDao {
        
    <span class="hl-keyword">private</span> SqlMapClient sqlMapClient;
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSqlMapClient(SqlMapClient sqlMapClient) {
        <span class="hl-keyword">this</span>.sqlMapClient = sqlMapClient;
    }

    <span class="hl-keyword">public</span> Account getAccount(String email) {
        <span class="hl-keyword">try</span> {
            <span class="hl-keyword">return</span> (Account) <span class="hl-keyword">this</span>.sqlMapClient.queryForObject(<span class="hl-string">"getAccountByEmail"</span>, email);
        }
        <span class="hl-keyword">catch</span> (SQLException ex) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> MyDaoException(ex);
        }
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account account) <span class="hl-keyword">throws</span> DataAccessException {
        <span class="hl-keyword">try</span> {
            <span class="hl-keyword">this</span>.sqlMapClient.update(<span class="hl-string">"insertAccount"</span>, account);
        }
        <span class="hl-keyword">catch</span> (SQLException ex) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> MyDaoException(ex);
        }
    }
}</pre><p>In this scenario, you need to handle the
      <code class="literal">SQLException</code> thrown by the iBATIS API in a custom
      fashion, usually by wrapping it in your own application-specific DAO
      exception. Wiring in the application context would still look like it
      does in the example for the
      <code class="classname">SqlMapClientDaoSupport</code>,
      due to the fact that the plain iBATIS-based DAO still follows the
      dependency injection pattern:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SqlMapAccountDao"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sqlMapClient"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"sqlMapClient"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="oxm"></a>15.&nbsp;Marshalling XML using O/X Mappers</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="oxm-introduction"></a>15.1&nbsp;Introduction</h2></div></div></div><p>
            In this chapter, we will describe Spring's Object/XML Mapping support. Object/XML Mapping, or O/X mapping
            for short, is the act of converting an XML document to and from an object. This conversion process is also
            known as XML Marshalling, or XML Serialization. This chapter uses these terms interchangeably.
        </p><p>
            Within the field of O/X mapping, a <span class="emphasis"><em>marshaller</em></span> is responsible for serializing an 
            object (graph) to XML. In similar fashion, an <span class="emphasis"><em>unmarshaller</em></span> deserializes the XML to an
            object graph. This XML can take the form of a DOM document, an input or output stream, or a SAX handler.
        </p><p>Some of the benefits of using Spring for your O/X mapping needs are:</p><p><b>Ease of configuration.&nbsp;</b>
                Spring's bean factory makes it easy to configure marshallers, without needing to construct JAXB context,
                JiBX binding factories, etc. The marshallers can be configured as any other bean in your application
                context. Additionally, XML Schema-based configuration is available for a number of marshallers, making
                the configuration even simpler.
            </p><p><b>Consistent Interfaces.&nbsp;</b>
                Spring's O/X mapping operates through two global interfaces: the 
                <code class="interfacename">Marshaller</code> and <code class="interfacename">Unmarshaller</code> interface. 
                These abstractions allow you to switch O/X mapping 
                frameworks with relative ease, with little or no changes required on the classes that do the 
                marshalling. This approach has the additional benefit of making it possible to do XML marshalling with 
                a mix-and-match approach (e.g. some marshalling performed using JAXB, other using XMLBeans) in a 
                non-intrusive fashion, leveraging the strength of each technology.
            </p><p><b>Consistent Exception Hierarchy.&nbsp;</b>
                Spring provides a conversion from exceptions from the underlying O/X mapping tool to its own exception
                hierarchy with the <code class="classname">XmlMappingException</code> as the root exception. As can be expected,
                these runtime exceptions wrap the original exception so no information is lost.
            </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="oxm-marshaller-unmarshaller"></a>15.2&nbsp;Marshaller and Unmarshaller</h2></div></div></div><p>
            As stated in the introduction, a <span class="emphasis"><em>marshaller</em></span> serializes an object to XML, and an
            <span class="emphasis"><em>unmarshaller</em></span> deserializes XML stream to an object. In this section, we will describe
            the two Spring interfaces used for this purpose.
        </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e27536"></a>15.2.1&nbsp;Marshaller</h3></div></div></div><p>
                Spring abstracts all marshalling operations behind the 
                <code class="interfacename">org.springframework.oxm.Marshaller</code> interface, the main methods of which 
                is listed below.
                </p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Marshaller {

    <span class="hl-comment">/**
     * Marshals the object graph with the given root into the provided Result.
     */</span>
    <span class="hl-keyword">void</span> marshal(Object graph, Result result)
        <span class="hl-keyword">throws</span> XmlMappingException, IOException;
}</pre><p>
                The <code class="interfacename">Marshaller</code> interface has one main method, which marshals the given
                object to a given <code class="interfacename">javax.xml.transform.Result</code>. Result is a tagging 
                interface that basically represents an XML output abstraction: concrete implementations wrap various XML
                representations, as indicated in the table below.
                </p><div class="informaltable"><table style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="interfacename">Result</code> implementation</th><th style="border-bottom: 1.0pt solid ; ">Wraps XML representation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">DOMResult</code></td><td style="border-bottom: 1.0pt solid ; "><code class="interfacename">org.w3c.dom.Node</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">SAXResult</code></td><td style="border-bottom: 1.0pt solid ; "><code class="interfacename">org.xml.sax.ContentHandler</code></td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="interfacename">StreamResult</code></td><td style="">
                                    <code class="classname">java.io.File</code>,
                                    <code class="classname">java.io.OutputStream</code>, or
                                    <code class="classname">java.io.Writer</code>
                                </td></tr></tbody></table></div><p>
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
                        Although the <code class="methodname">marshal()</code> method accepts a plain object as its first 
                        parameter, most <code class="classname">Marshaller</code> implementations cannot handle arbitrary 
                        objects. Instead, an object class must be mapped in a mapping file, marked with an annotation,
                        registered with the marshaller, or have a common base class. Refer to the further sections
                        in this chapter to determine how your O/X technology of choice manages this.
                    </p></td></tr></table></div><p>
            </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e27604"></a>15.2.2&nbsp;Unmarshaller</h3></div></div></div><p>
                Similar to the <code class="interfacename">Marshaller</code>, there is the 
                <code class="interfacename">org.springframework.oxm.Unmarshaller</code> interface.
                </p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Unmarshaller {

    <span class="hl-comment">/**
     * Unmarshals the given provided Source into an object graph.
     */</span>
    Object unmarshal(Source source)
        <span class="hl-keyword">throws</span> XmlMappingException, IOException;
}</pre><p>
                This interface also has one method, which reads from the given 
                <code class="interfacename">javax.xml.transform.Source</code> (an XML input abstraction), and returns the
                object read. As with Result, Source is a tagging interface that has three concrete implementations. Each
                wraps a different XML representation, as indicated in the table below.
                </p><div class="informaltable"><table style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="interfacename">Source</code> implementation</th><th style="border-bottom: 1.0pt solid ; ">Wraps XML representation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">DOMSource</code></td><td style="border-bottom: 1.0pt solid ; "><code class="interfacename">org.w3c.dom.Node</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">SAXSource</code></td><td style="border-bottom: 1.0pt solid ; ">
                                    <code class="classname">org.xml.sax.InputSource</code>, and
                                    <code class="interfacename">org.xml.sax.XMLReader</code>
                                </td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="classname">StreamSource</code></td><td style="">
                                    <code class="classname">java.io.File</code>,
                                    <code class="classname">java.io.InputStream</code>, or
                                    <code class="classname">java.io.Reader</code>
                                </td></tr></tbody></table></div><p>
            </p></div><p>
            Even though there are two separate marshalling interfaces (<code class="interfacename">Marshaller</code>
            and <code class="interfacename">Unmarshaller</code>), all implementations found in Spring-WS implement both in
            one class. This means that you can wire up one marshaller class and refer to it both as a marshaller and an 
            unmarshaller in your <code class="filename">applicationContext.xml</code>.
        </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e27678"></a>15.2.3&nbsp;XmlMappingException</h3></div></div></div><p>
                Spring converts exceptions from the underlying O/X mapping tool to its own exception hierarchy with the
                <code class="classname">XmlMappingException</code> as the root exception. As can be expected, these runtime
                exceptions wrap the original exception so no information will be lost.
            </p><p>
                Additionally, the <code class="classname">MarshallingFailureException</code> and
                <code class="classname">UnmarshallingFailureException</code> provide a distinction between marshalling and
                unmarshalling operations, even though the underlying O/X mapping tool does not do so.
            </p><p>
                The O/X Mapping exception hierarchy is shown in the following figure:
                </p><div class="mediaobject" align="center"><img src="images/oxm-exceptions.png" align="middle"><div class="caption"><p>
                            O/X Mapping exception hierarchy
                        </p></div></div><p>
            </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="oxm-usage"></a>15.3&nbsp;Using Marshaller and Unmarshaller</h2></div></div></div><p>
            Spring's OXM can be used for a wide variety of situations. In the following example, we will use it to
            marshal the settings of a Spring-managed application as an XML file. We will use a simple JavaBean to
            represent the settings:
            </p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Settings {
    <span class="hl-keyword">private</span> <span class="hl-keyword">boolean</span> fooEnabled;

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> isFooEnabled() {
        <span class="hl-keyword">return</span> fooEnabled;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setFooEnabled(<span class="hl-keyword">boolean</span> fooEnabled) {
        <span class="hl-keyword">this</span>.fooEnabled = fooEnabled;
    }
}</pre><p>
        </p><p>
            The application class uses this bean to store its settings. Besides a main method, the class has two
            methods: <code class="methodname">saveSettings()</code> saves the settings bean to a file named
            <code class="filename">settings.xml</code>, and <code class="methodname">loadSettings()</code> loads these settings again. A
            <code class="methodname">main()</code> method constructs a Spring application context, and calls these two methods.
            </p><pre class="programlisting">
<span class="hl-keyword">import</span> java.io.FileInputStream;
<span class="hl-keyword">import</span> java.io.FileOutputStream;
<span class="hl-keyword">import</span> java.io.IOException;
<span class="hl-keyword">import</span> javax.xml.transform.stream.StreamResult;
<span class="hl-keyword">import</span> javax.xml.transform.stream.StreamSource;

<span class="hl-keyword">import</span> org.springframework.context.ApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;
<span class="hl-keyword">import</span> org.springframework.oxm.Marshaller;
<span class="hl-keyword">import</span> org.springframework.oxm.Unmarshaller;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Application {
    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> String FILE_NAME = <span class="hl-string">"settings.xml"</span>;
    <span class="hl-keyword">private</span> Settings settings = <span class="hl-keyword">new</span> Settings();
    <span class="hl-keyword">private</span> Marshaller marshaller;
    <span class="hl-keyword">private</span> Unmarshaller unmarshaller;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMarshaller(Marshaller marshaller) {
        <span class="hl-keyword">this</span>.marshaller = marshaller;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setUnmarshaller(Unmarshaller unmarshaller) {
        <span class="hl-keyword">this</span>.unmarshaller = unmarshaller;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> saveSettings() <span class="hl-keyword">throws</span> IOException {
        FileOutputStream os = null;
        <span class="hl-keyword">try</span> {
            os = <span class="hl-keyword">new</span> FileOutputStream(FILE_NAME);
            <span class="hl-keyword">this</span>.marshaller.marshal(settings, <span class="hl-keyword">new</span> StreamResult(os));
        } <span class="hl-keyword">finally</span> {
            <span class="hl-keyword">if</span> (os != null) {
                os.close();
            }
        }
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> loadSettings() <span class="hl-keyword">throws</span> IOException {
        FileInputStream is = null;
        <span class="hl-keyword">try</span> {
            is = <span class="hl-keyword">new</span> FileInputStream(FILE_NAME);
            <span class="hl-keyword">this</span>.settings = (Settings) <span class="hl-keyword">this</span>.unmarshaller.unmarshal(<span class="hl-keyword">new</span> StreamSource(is));
        } <span class="hl-keyword">finally</span> {
            <span class="hl-keyword">if</span> (is != null) {
                is.close();
            }
        }
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) <span class="hl-keyword">throws</span> IOException {
        ApplicationContext appContext =
            <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"applicationContext.xml"</span>);
        Application application = (Application) appContext.getBean(<span class="hl-string">"application"</span>);
        application.saveSettings();
        application.loadSettings();
    }
}</pre><p>
            The <code class="classname">Application</code> requires both a <span class="property">marshaller</span>
            and <span class="property">unmarshaller</span> property to be set. We can do so using the following
            <code class="filename">applicationContext.xml</code>:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">beans</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"application"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"Application"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"marshaller"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"castorMarshaller"</span> /&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"unmarshaller"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"castorMarshaller"</span> /&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"castorMarshaller"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.oxm.castor.CastorMarshaller"</span>/&gt;
&lt;<span class="hl-tag">/beans</span>&gt;
</pre><p>
            This application context uses Castor, but we could have used any of the other marshaller instances described
            later in this chapter. Note that Castor does not require any further configuration by default, so the bean
            definition is rather simple. Also note that the <code class="classname">CastorMarshaller</code> implements both
            <code class="interfacename">Marshaller</code> and <code class="interfacename">Unmarshaller</code>, so we can refer
            to the <code class="varname">castorMarshaller</code> bean in both the <span class="property">marshaller</span> and
            <span class="property">unmarshaller</span> property of the application.
        </p><p>
            This sample application produces the following <code class="filename">settings.xml</code> file:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">settings</span> <span class="hl-attribute">foo-enabled</span>=<span class="hl-value">"false"</span>/&gt;
</pre><p>
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e27769"></a>15.4&nbsp;XML Schema-based Configuration</h2></div></div></div><p>
       		Marshallers could be configured more concisely using tags from the OXM namespace.
       		To make these tags available, the appropriate schema has to be referenced first in the preamble of the XML configuration file.
       		Note the 'oxm' related text below:
       	</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:oxm</span>=<span class="hl-value">"http://www.springframework.org/schema/oxm"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
    http://www.springframework.org/schema/oxm
    http://www.springframework.org/schema/oxm/spring-oxm-3.0.xsd"</span>&gt;
</pre><p>
			Currently, the following tags are available:
			</p><div class="itemizedlist"><ul type="disc"><li><p><a class="link" href="#oxm-jaxb2-xsd" title="15.5.1.1&nbsp;XML Schema-based Configuration"><code class="literal">jaxb2-marshaller</code></a></p></li><li><p><a class="link" href="#oxm-xmlbeans-xsd" title="15.7.1.1&nbsp;XML Schema-based Configuration"><code class="literal">xmlbeans-marshaller</code></a></p></li><li><p><a class="link" href="#oxm-jibx-xsd" title="15.8.1.1&nbsp;XML Schema-based Configuration"><code class="literal">jibx-marshaller</code></a></p></li></ul></div><p>
		</p><p>
			Each tag will be explained in its respective marshaller's section. As an example though, here is how
			the configuration of a JAXB2 marshaller might look like:
		</p><pre class="programlisting">&lt;<span class="hl-tag">oxm:jaxb2-marshaller</span> <span class="hl-attribute">id</span>=<span class="hl-value">"marshaller"</span> <span class="hl-attribute">contextPath</span>=<span class="hl-value">"org.springframework.ws.samples.airline.schema"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="oxm-jaxb"></a>15.5&nbsp;JAXB</h2></div></div></div><p>
            The JAXB binding compiler translates a W3C XML Schema into one or more Java classes, a 
            <code class="filename">jaxb.properties</code> file, and possibly some resource files. JAXB also offers a 
            way to generate a schema from annotated Java classes.
        </p><p>
            Spring supports the JAXB 2.0 API as XML marshalling strategies, following the
            <code class="interfacename">Marshaller</code> and <code class="interfacename">Unmarshaller</code>
            interfaces described in <a class="xref" href="#oxm-marshaller-unmarshaller" title="15.2&nbsp;Marshaller and Unmarshaller">Section&nbsp;15.2, &#8220;Marshaller and Unmarshaller&#8221;</a>. The corresponding integration 
            classes reside in the <span class="package">org.springframework.oxm.jaxb</span> package.
        </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="oxm-jaxb2"></a>15.5.1&nbsp;Jaxb2Marshaller</h3></div></div></div><p>
                The <code class="classname">Jaxb2Marshaller</code> class implements both the Spring
                <code class="interfacename">Marshaller</code> and <code class="interfacename">Unmarshaller</code>interface. It
                requires a context path to operate, which you can set using the <span class="property">contextPath</span>
                property. The context path is a list of colon (:) separated Java package names that contain schema
                derived classes. It also offers a <span class="property">classesToBeBound</span> property, which allows you to set an array of 
                classes to be supported by the marshaller. Schema validation is performed by specifying one or more 
                schema resource to the bean, like so:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">beans</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jaxb2Marshaller"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.oxm.jaxb.Jaxb2Marshaller"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"classesToBeBound"</span>&gt;
            &lt;<span class="hl-tag">list</span>&gt;
                &lt;<span class="hl-tag">value</span>&gt;org.springframework.oxm.jaxb.Flight&lt;<span class="hl-tag">/value</span>&gt;
                &lt;<span class="hl-tag">value</span>&gt;org.springframework.oxm.jaxb.Flights&lt;<span class="hl-tag">/value</span>&gt;                
            &lt;<span class="hl-tag">/list</span>&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"schema"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"classpath:org/springframework/oxm/schema.xsd"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
    ...

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="oxm-jaxb2-xsd"></a>15.5.1.1&nbsp;XML Schema-based Configuration</h4></div></div></div><p>
	        		The <code class="literal">jaxb2-marshaller</code> tag configures a <code class="classname">org.springframework.oxm.jaxb.Jaxb2Marshaller</code>.
	        		Here is an example:
	        	</p><pre class="programlisting">&lt;<span class="hl-tag">oxm:jaxb2-marshaller</span> <span class="hl-attribute">id</span>=<span class="hl-value">"marshaller"</span> <span class="hl-attribute">contextPath</span>=<span class="hl-value">"org.springframework.ws.samples.airline.schema"</span>/&gt;</pre><p>
	        		Alternatively, the list of classes to bind can be provided to the marshaller via the <code class="literal">class-to-be-bound</code> child tag:
	        	</p><pre class="programlisting">&lt;<span class="hl-tag">oxm:jaxb2-marshaller</span> <span class="hl-attribute">id</span>=<span class="hl-value">"marshaller"</span>&gt;
    &lt;<span class="hl-tag">oxm:class-to-be-bound</span> <span class="hl-attribute">name</span>=<span class="hl-value">"org.springframework.ws.samples.airline.schema.Airport"</span>/&gt;
    &lt;<span class="hl-tag">oxm:class-to-be-bound</span> <span class="hl-attribute">name</span>=<span class="hl-value">"org.springframework.ws.samples.airline.schema.Flight"</span>/&gt;
    ...
&lt;<span class="hl-tag">/oxm:jaxb2-marshaller</span>&gt;
	        	</pre><p>
	        		Available attributes are:
                    </p><div class="informaltable"><table style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Description</th><th style="border-bottom: 1.0pt solid ; ">Required</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">id</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">the id of the marshaller</td><td style="border-bottom: 1.0pt solid ; ">no</td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="literal">contextPath</code></td><td style="border-right: 1.0pt solid ; ">the JAXB Context path</td><td style="">no</td></tr></tbody></table></div><p>
	        	</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="oxm-castor"></a>15.6&nbsp;Castor</h2></div></div></div><p>
            Castor XML mapping is an open source XML binding framework. It allows you to transform the data contained in
            a java object model into/from an XML document. By default, it does not require any further configuration,
            though a mapping file can be used to have more control over the behavior of Castor.
        </p><p>
            For more information on Castor, refer to the <a class="ulink" href="http://castor.org/xml-framework.html" target="_top">
            <em class="citetitle">Castor web site</em></a>. The Spring integration classes reside in the
            <span class="package">org.springframework.oxm.castor</span> package.
        </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e27916"></a>15.6.1&nbsp;CastorMarshaller</h3></div></div></div><p>
                As with JAXB, the <code class="classname">CastorMarshaller</code> implements both the 
                <code class="interfacename">Marshaller</code> and <code class="interfacename">Unmarshaller</code> interface. 
                It can be wired up as follows:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">beans</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"castorMarshaller"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.oxm.castor.CastorMarshaller"</span> /&gt;
    ...

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e27932"></a>15.6.2&nbsp;Mapping</h3></div></div></div><p>
                Although it is possible to rely on Castor's default marshalling behavior, it might be necessary to have
                more control over it. This can be accomplished using a Castor mapping file. For more information, refer
                to <a class="ulink" href="http://castor.org/xml-mapping.html" target="_top">Castor XML Mapping</a>.
            </p><p>
                The mapping can be set using the <span class="property">mappingLocation</span> resource property, indicated
                below with a classpath resource.
            </p><pre class="programlisting">
&lt;<span class="hl-tag">beans</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"castorMarshaller"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.oxm.castor.CastorMarshaller"</span> &gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappingLocation"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"classpath:mapping.xml"</span> /&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">/beans</span>&gt;
</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="oxm-xmlbeans"></a>15.7&nbsp;XMLBeans</h2></div></div></div><p>
            XMLBeans is an XML binding tool that has full XML Schema support, and offers full XML Infoset
            fidelity. It takes a different approach to that of most other O/X mapping frameworks, in that
            all classes that are generated from an XML Schema are all derived from
            <code class="interfacename">XmlObject</code>, and contain XML binding information in them.
        </p><p>
            For more information on XMLBeans, refer to the <a class="ulink" href="http://xmlbeans.apache.org/" target="_top">
			   <em class="citetitle">XMLBeans web site </em></a>. The Spring-WS integration classes reside
            in the <span class="package">org.springframework.oxm.xmlbeans</span> package.
        </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e27965"></a>15.7.1&nbsp;XmlBeansMarshaller</h3></div></div></div><p>
                The <code class="classname">XmlBeansMarshaller</code>
                implements both the <code class="interfacename">Marshaller</code>
                and <code class="interfacename">Unmarshaller</code>
                interfaces. It can be configured as follows:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">beans</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"xmlBeansMarshaller"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.oxm.xmlbeans.XmlBeansMarshaller"</span> /&gt;
    ...

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
                    Note that the <code class="classname">XmlBeansMarshaller</code>
                    can only marshal objects of type <code class="interfacename">XmlObject</code>,
                    and not every <code class="classname">java.lang.Object</code>.
                </p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="oxm-xmlbeans-xsd"></a>15.7.1.1&nbsp;XML Schema-based Configuration</h4></div></div></div><p>
	        		The <code class="literal">xmlbeans-marshaller</code> tag configures a <code class="classname">org.springframework.oxm.xmlbeans.XmlBeansMarshaller</code>.
	        		Here is an example:
	        	</p><pre class="programlisting">&lt;<span class="hl-tag">oxm:xmlbeans-marshaller</span> <span class="hl-attribute">id</span>=<span class="hl-value">"marshaller"</span>/&gt;</pre><p>
	        		Available attributes are:
                    </p><div class="informaltable"><table style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Description</th><th style="border-bottom: 1.0pt solid ; ">Required</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">id</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">the id of the marshaller</td><td style="border-bottom: 1.0pt solid ; ">no</td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="literal">options</code></td><td style="border-right: 1.0pt solid ; ">the bean name of the XmlOptions that is to be used for this marshaller. Typically a
                                    <code class="classname">XmlOptionsFactoryBean</code> definition</td><td style="">no</td></tr></tbody></table></div><p>
	        	</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="oxm-jibx"></a>15.8&nbsp;JiBX</h2></div></div></div><p>
            The JiBX framework offers a solution similar to that which JDO provides for ORM: a binding definition defines the
            rules for how your Java objects are converted to or from XML. After preparing the binding and compiling the
            classes, a JiBX binding compiler enhances the class files, and adds code to handle converting instances of
            the classes from or to XML.
        </p><p>
            For more information on JiBX, refer to the <a class="ulink" href="http://jibx.sourceforge.net/" target="_top">
            <em class="citetitle">JiBX web site</em></a>. The Spring integration classes reside in the
            <span class="package">org.springframework.oxm.jibx</span> package.
        </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e28057"></a>15.8.1&nbsp;JibxMarshaller</h3></div></div></div><p>
                The <code class="classname">JibxMarshaller</code> class implements both the 
                <code class="interfacename">Marshaller</code> and <code class="interfacename">Unmarshaller</code> interface.
                To operate, it requires the name of the class to marshal in, which you can set using the
                <span class="property">targetClass</span> property. Optionally, you can set the binding name using the
                <span class="property">bindingName</span> property. In the next sample, we bind the 
                <code class="classname">Flights</code> class:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">beans</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jibxFlightsMarshaller"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.oxm.jibx.JibxMarshaller"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetClass"</span>&gt;org.springframework.oxm.jibx.Flights&lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

    ...
</pre><p>
                A <code class="classname">JibxMarshaller</code> is configured for a single class. If you want to marshal
                multiple classes, you have to configure multiple <code class="classname">JibxMarshaller</code>s with
                different <span class="property">targetClass</span> property values.
            </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="oxm-jibx-xsd"></a>15.8.1.1&nbsp;XML Schema-based Configuration</h4></div></div></div><p>
	        		The <code class="literal">jibx-marshaller</code> tag configures a <code class="classname">org.springframework.oxm.jibx.JibxMarshaller</code>.
	        		Here is an example:
	        	</p><pre class="programlisting">&lt;<span class="hl-tag">oxm:jibx-marshaller</span> <span class="hl-attribute">id</span>=<span class="hl-value">"marshaller"</span> <span class="hl-attribute">target-class</span>=<span class="hl-value">"org.springframework.ws.samples.airline.schema.Flight"</span>/&gt;</pre><p>
	        		Available attributes are:
                    </p><div class="informaltable"><table style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Description</th><th style="border-bottom: 1.0pt solid ; ">Required</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">id</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">the id of the marshaller</td><td style="border-bottom: 1.0pt solid ; ">no</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">target-class</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">the target class for this marshaller</td><td style="border-bottom: 1.0pt solid ; ">yes</td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="literal">bindingName</code></td><td style="border-right: 1.0pt solid ; ">the binding name used by this marshaller</td><td style="">no</td></tr></tbody></table></div><p>
	        	</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="oxm-xstream"></a>15.9&nbsp;XStream</h2></div></div></div><p>
            XStream is a simple library to serialize objects to XML and back again. It does not require any mapping, and
            generates clean XML.
        </p><p>
            For more information on XStream, refer to the <a class="ulink" href="http://xstream.codehaus.org/" target="_top">
			<em class="citetitle">XStream web site</em></a>. The Spring integration classes reside in the
            <span class="package">org.springframework.oxm.xstream</span> package.
        </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e28162"></a>15.9.1&nbsp;XStreamMarshaller</h3></div></div></div><p>
                The <code class="classname">XStreamMarshaller</code> does not require any configuration, and can be configured
                in an application context directly. To further customize the XML, you can set an 
                <span class="emphasis"><em>alias map</em></span>, which consists of string aliases mapped to classes:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">beans</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"xstreamMarshaller"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.oxm.xstream.XStreamMarshaller"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"aliases"</span>&gt;
            &lt;<span class="hl-tag">props</span>&gt;
                &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"Flight"</span>&gt;org.springframework.oxm.xstream.Flight&lt;<span class="hl-tag">/prop</span>&gt;
            &lt;<span class="hl-tag">/props</span>&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
    ...

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.gif"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>
                  By default, XStream allows for arbitrary classes to be unmarshalled, which can result in security
                  vulnerabilities.
                  As such, it is recommended to set the <span class="property">supportedClasses</span> property on the
                  <code class="classname">XStreamMarshaller</code>, like so:
                  </p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"xstreamMarshaller"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.oxm.xstream.XStreamMarshaller"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"supportedClasses"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.oxm.xstream.Flight"</span>/&gt;
    ...
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>
                  This will make sure that only the registered classes are eligible for unmarshalling.
                </p><p>
                  Additionally, you can register <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/oxm/xstream/XStreamMarshaller.html#setConverters(com.thoughtworks.xstream.converters.ConverterMatcher[])" target="_top">
                  custom converters</a> to make sure that only your supported classes can be unmarshalled.
                </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
                  Note that XStream is an XML serialization library, not a data binding library. Therefore, it has
                  limited namespace support. As such, it is rather unsuitable for usage within Web services.
              </p></td></tr></table></div></div></div></div></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="spring-web"></a>Part&nbsp;V.&nbsp;The Web</h1></div></div></div><div class="partintro" lang="en"><div></div><p>This part of the reference documentation covers the Spring
      Framework's support for the presentation tier (and specifically
      web-based presentation tiers).</p><p>The Spring Framework's own web framework, <a class="link" href="#mvc" title="16.&nbsp;Web MVC framework">Spring Web MVC</a>, is covered in the first couple of
      chapters. A number of the remaining chapters in this part of the
      reference documentation are concerned with the Spring Framework's
      integration with other web technologies, such as <a class="link" href="#struts" title="18.4&nbsp;Apache Struts 1.x and 2.x">Struts</a> and <a class="link" href="#jsf" title="18.3&nbsp;JavaServer Faces 1.1 and 1.2">JSF</a> (to
      name but two).</p><p>This section concludes with coverage of Spring's MVC <a class="link" href="#portlet" title="19.&nbsp;Portlet MVC Framework">portlet framework</a>.</p><div class="itemizedlist"><ul type="disc"><li><p><a class="xref" href="#mvc" title="16.&nbsp;Web MVC framework">Chapter&nbsp;16, <i>Web MVC framework</i></a></p></li><li><p><a class="xref" href="#view" title="17.&nbsp;View technologies">Chapter&nbsp;17, <i>View technologies</i></a></p></li><li><p><a class="xref" href="#web-integration" title="18.&nbsp;Integrating with other web frameworks">Chapter&nbsp;18, <i>Integrating with other web frameworks</i></a></p></li><li><p><a class="xref" href="#portlet" title="19.&nbsp;Portlet MVC Framework">Chapter&nbsp;19, <i>Portlet MVC Framework</i></a></p></li></ul></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="mvc"></a>16.&nbsp;Web MVC framework</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-introduction"></a>16.1&nbsp;Introduction to Spring Web MVC framework</h2></div></div></div><p>The Spring Web model-view-controller (MVC) framework is designed
    around a <code class="classname">DispatcherServlet</code> that dispatches requests
    to handlers, with configurable handler mappings, view resolution, locale
    and theme resolution as well as support for uploading files. The default
    handler is based on the <code class="interfacename">@Controller</code> and
    <code class="interfacename">@RequestMapping</code> annotations, offering a
    wide range of flexible handling methods. With the introduction of Spring
    3.0, the <code class="interfacename">@Controller</code> mechanism also allows
    you to create RESTful Web sites and applications, through the
    <code class="interfacename">@PathVariable</code> annotation and other
    features.</p><div class="sidebar"><a name="mvc-open-for-extension"></a><p class="title"><b>&#8220;<span class="quote">Open for extension...</span>&#8221;</b></p><p>A key design principle in Spring Web MVC and in Spring in general
      is the &#8220;<span class="quote"><span class="emphasis"><em>Open for extension, closed for
      modification</em></span></span>&#8221; principle.</p><p>Some methods in the core classes of Spring Web MVC are marked
      <code class="literal">final</code>. As a developer you cannot override these
      methods to supply your own behavior. This has not been done arbitrarily,
      but specifically with this principle in mind.</p><p>For an explanation of this principle, refer to <span class="emphasis"><em>Expert
      Spring Web MVC and Web Flow</em></span> by Seth Ladd and others;
      specifically see the section "A Look At Design," on page 117 of the
      first edition. Alternatively, see</p><div class="orderedlist"><ol type="1"><li><p><a class="ulink" href="http://www.objectmentor.com/resources/articles/ocp.pdf" target="_top">Bob
          Martin, The Open-Closed Principle (PDF)</a></p></li></ol></div><p>You cannot add advice to final methods when you use Spring MVC.
      For example, you cannot add advice to the
      <code class="literal">AbstractController.setSynchronizeOnSession()</code> method.
      Refer to <a class="xref" href="#aop-understanding-aop-proxies" title="8.6.1&nbsp;Understanding AOP proxies">Section&nbsp;8.6.1, &#8220;Understanding AOP proxies&#8221;</a> for more
      information on AOP proxies and why you cannot add advice to final
      methods.</p></div><p>In Spring Web MVC you can use any object as a command or
    form-backing object; you do not need to implement a framework-specific
    interface or base class. Spring's data binding is highly flexible: for
    example, it treats type mismatches as validation errors that can be
    evaluated by the application, not as system errors. Thus you need not
    duplicate your business objects' properties as simple, untyped strings in
    your form objects simply to handle invalid submissions, or to convert the
    Strings properly. Instead, it is often preferable to bind directly to your
    business objects.</p><p>Spring's view resolution is extremely flexible. A
    <code class="interfacename">Controller</code> is typically responsible for
    preparing a model <code class="classname">Map</code> with data and selecting a
    view name but it can also write directly to the response stream and
    complete the request. View name resolution is highly configurable through
    file extension or Accept header content type negotiation, through bean
    names, a properties file, or even a custom
    <code class="interfacename">ViewResolver</code> implementation. The model (the
    M in MVC) is a <code class="interfacename">Map</code> interface, which allows
    for the complete abstraction of the view technology. You can integrate
    directly with template based rendering technologies such as JSP, Velocity
    and Freemarker, or directly generate XML, JSON, Atom, and many other types
    of content. The model <code class="interfacename">Map</code> is simply
    transformed into an appropriate format, such as JSP request attributes, a
    Velocity template model.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-features"></a>16.1.1&nbsp;Features of Spring Web MVC</h3></div></div></div><div class="sidebar"><p class="title"><b>Spring Web Flow</b></p><p>Spring Web Flow (SWF) aims to be the best solution for the management
  of web application page flow.</p><p>SWF integrates with existing frameworks like Spring MVC, Struts, and
  JSF, in both servlet and portlet environments. If you have a business
  process (or processes) that would benefit from a conversational model as
  opposed to a purely request model, then SWF may be the solution.</p><p>SWF allows you to capture logical page flows as self-contained modules
  that are reusable in different situations, and as such is ideal for building
  web application modules that guide the user through controlled navigations
  that drive business processes.</p><p>For more information about SWF, consult the
  <a class="ulink" href="http://www.springframework.org/webflow" target="_top">Spring Web Flow website</a>.
  </p></div><p>Spring's web module includes many unique web support
      features:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>Clear separation of roles</em></span>. Each role &#8212;
          controller, validator, command object, form object, model object,
          <code class="classname">DispatcherServlet</code>, handler mapping, view
          resolver, and so on &#8212; can be fulfilled by a specialized
          object.</p></li><li><p><span class="emphasis"><em>Powerful and straightforward configuration of both
          framework and application classes as JavaBeans</em></span>. This
          configuration capability includes easy referencing across contexts,
          such as from web controllers to business objects and
          validators.</p></li><li><p><span class="emphasis"><em>Adaptability, non-intrusiveness, and
          flexibility.</em></span> Define any controller method signature you
          need, possibly using one of the parameter annotations (such as
          @RequestParam, @RequestHeader, @PathVariable, and more) for a given
          scenario.</p></li><li><p><span class="emphasis"><em>Reusable business code</em></span>,<span class="emphasis"><em> no need
          for duplication</em></span>. Use existing business objects as command
          or form objects instead of mirroring them to extend a particular
          framework base class.</p></li><li><p><span class="emphasis"><em>Customizable binding and validation</em></span>. Type
          mismatches as application-level validation errors that keep the
          offending value, localized date and number binding, and so on
          instead of String-only form objects with manual parsing and
          conversion to business objects.</p></li><li><p><span class="emphasis"><em>Customizable handler mapping and view
          resolution</em></span>. Handler mapping and view resolution
          strategies range from simple URL-based configuration, to
          sophisticated, purpose-built resolution strategies. Spring is more
          flexible than web MVC frameworks that mandate a particular
          technique.</p></li><li><p><span class="emphasis"><em>Flexible model transfer</em></span>. Model transfer
          with a name/value <code class="interfacename">Map</code> supports easy
          integration with any view technology.</p></li><li><p><span class="emphasis"><em>Customizable locale and theme resolution, support
          for JSPs with or without Spring tag library, support for JSTL,
          support for Velocity without the need for extra bridges, and so
          on.</em></span></p></li><li><p><span class="emphasis"><em>A simple yet powerful JSP tag library known as the
          Spring tag library that provides support for features such as data
          binding and themes</em></span>. The custom tags allow for maximum
          flexibility in terms of markup code. For information on the tag
          library descriptor, see the appendix entitled <a class="xref" href="#spring.tld" title="Appendix&nbsp;F.&nbsp;spring.tld">Appendix&nbsp;F, <i>spring.tld</i></a></p></li><li><p><span class="emphasis"><em>A JSP form tag library, introduced in Spring 2.0,
          that makes writing forms in JSP pages much easier.</em></span> For
          information on the tag library descriptor, see the appendix entitled
          <a class="xref" href="#spring-form.tld" title="Appendix&nbsp;G.&nbsp;spring-form.tld">Appendix&nbsp;G, <i>spring-form.tld</i></a></p></li><li><p><span class="emphasis"><em>Beans whose lifecycle is scoped to the current HTTP
          request or HTTP <code class="interfacename">Session</code>.</em></span>
          This is not a specific feature of Spring MVC itself, but rather of
          the <code class="interfacename">WebApplicationContext</code>
          container(s) that Spring MVC uses. These bean scopes are described
          in <a class="xref" href="#beans-factory-scopes-other" title="4.5.4&nbsp;Request, session, and global session scopes">Section&nbsp;4.5.4, &#8220;Request, session, and global session scopes&#8221;</a></p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-introduction-pluggability"></a>16.1.2&nbsp;Pluggability of other MVC implementations</h3></div></div></div><p>Non-Spring MVC implementations are preferable for some projects.
      Many teams expect to leverage their existing investment in skills and
      tools. A large body of knowledge and experience exist for the Struts
      framework. If you can abide Struts' architectural flaws, it can be a
      viable choice for the web layer; the same applies to WebWork and other
      web MVC frameworks.</p><p>If you do not want to use Spring's web MVC, but intend to leverage
      other solutions that Spring offers, you can integrate the web MVC
      framework of your choice with Spring easily. Simply start up a Spring
      root application context through its
      <code class="classname">ContextLoaderListener</code>, and access it through
      its
      <code class="interfacename">ServletContext</code> attribute (or Spring's
      respective helper method) from within a Struts or WebWork action. No
      "plug-ins" are involved, so no dedicated integration is necessary. From
      the web layer's point of view, you simply use Spring as a library, with
      the root application context instance as the entry point.</p><p>Your registered beans and Spring's services can be at your
      fingertips even without Spring's Web MVC. Spring does not compete with
      Struts or WebWork in this scenario. It simply addresses the many areas
      that the pure web MVC frameworks do not, from bean configuration to data
      access and transaction handling. So you can enrich your application with
      a Spring middle tier and/or data access tier, even if you just want to
      use, for example, the transaction abstraction with JDBC or
      Hibernate.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-servlet"></a>16.2&nbsp;The <code class="classname">DispatcherServlet</code></h2></div></div></div><p>Spring's web MVC framework is, like many other web MVC frameworks,
    request-driven, designed around a central Servlet that dispatches requests
    to controllers and offers other functionality that facilitates the
    development of web applications. Spring's
    <code class="classname">DispatcherServlet</code> however, does more than just
    that. It is completely integrated with the Spring IoC container and as
    such allows you to use every other feature that Spring has.</p><p>The request processing workflow of the Spring Web MVC
    <code class="classname">DispatcherServlet</code> is illustrated in the following
    diagram. The pattern-savvy reader will recognize that the
    <code class="classname">DispatcherServlet</code> is an expression of the
    &#8220;<span class="quote">Front Controller</span>&#8221; design pattern (this is a pattern that
    Spring Web MVC shares with many other leading web frameworks).</p><div class="mediaobject" align="center"><img src="images/mvc.png" align="middle"><div class="caption"><p>The request processing workflow in Spring Web MVC (high
        level)</p></div></div><p>The <code class="classname">DispatcherServlet</code> is an actual
    <code class="interfacename">Servlet</code> (it inherits from the
    <code class="classname">HttpServlet</code> base class), and as such is declared in
    the <code class="literal">web.xml</code> of your web application. You need to map
    requests that you want the <code class="classname">DispatcherServlet</code> to
    handle, by using a URL mapping in the same <code class="literal">web.xml</code>
    file. This is standard Java EE Servlet configuration; the following example
    shows such a <code class="classname">DispatcherServlet</code> declaration and
    mapping:</p><pre class="programlisting">&lt;<span class="hl-tag">web-app</span>&gt;

    &lt;<span class="hl-tag">servlet</span>&gt;
        &lt;<span class="hl-tag">servlet-name</span>&gt;example&lt;<span class="hl-tag">/servlet-name</span>&gt;
        &lt;<span class="hl-tag">servlet-class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
        &lt;<span class="hl-tag">load-on-startup</span>&gt;1&lt;<span class="hl-tag">/load-on-startup</span>&gt;
    &lt;<span class="hl-tag">/servlet</span>&gt;

    &lt;<span class="hl-tag">servlet-mapping</span>&gt;
        &lt;<span class="hl-tag">servlet-name</span>&gt;example&lt;<span class="hl-tag">/servlet-name</span>&gt;
        &lt;<span class="hl-tag">url-pattern</span>&gt;/example/*&lt;<span class="hl-tag">/url-pattern</span>&gt;
    &lt;<span class="hl-tag">/servlet-mapping</span>&gt;

&lt;<span class="hl-tag">/web-app</span>&gt;</pre><p>In the preceding example, all requests startig with
    <code class="literal">/example</code> will be handled by the
    <code class="classname">DispatcherServlet</code> instance named
    <code class="literal">example</code>. This is only the first step in setting up
    Spring Web MVC. You
    now need to configure the various beans used by the Spring Web MVC
    framework (over and above the <code class="classname">DispatcherServlet</code>
    itself).</p><p>As detailed in <a class="xref" href="#context-introduction" title="4.14&nbsp;Additional Capabilities of the ApplicationContext">Section&nbsp;4.14, &#8220;Additional Capabilities of the
    ApplicationContext&#8221;</a>,
    <code class="interfacename">ApplicationContext</code> instances in Spring can
    be scoped. In the Web MVC framework, each
    <code class="classname">DispatcherServlet</code> has its own
    <code class="interfacename">WebApplicationContext</code>, which inherits all
    the beans already defined in the root
    <code class="interfacename">WebApplicationContext</code>. These inherited
    beans can be overridden in the servlet-specific scope, and you can define
    new scope-specific beans local to a given Servlet instance.</p><div class="mediaobject" align="center"><img src="images/mvc-contexts.gif" align="middle"><div class="caption">Context hierarchy in Spring Web MVC</div></div><p>Upon initialization of a <code class="classname">DispatcherServlet</code>,
    Spring MVC looks for a file named <span class="emphasis"><em>
    <code class="literal">[servlet-name]-servlet.xml</code></em></span> in the
    <code class="literal">WEB-INF</code> directory of your web application and creates
    the beans defined there, overriding the definitions of any beans defined
    with the same name in the global scope.</p><p>Consider the following <code class="classname">DispatcherServlet</code>
    Servlet configuration (in the <code class="literal">web.xml</code> file):</p><pre class="programlisting">&lt;<span class="hl-tag">web-app</span>&gt;

    &lt;<span class="hl-tag">servlet</span>&gt;
        &lt;<span class="hl-tag">servlet-name</span>&gt;golfing&lt;<span class="hl-tag">/servlet-name</span>&gt;
        &lt;<span class="hl-tag">servlet-class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
        &lt;<span class="hl-tag">load-on-startup</span>&gt;1&lt;<span class="hl-tag">/load-on-startup</span>&gt;
    &lt;<span class="hl-tag">/servlet</span>&gt;

    &lt;<span class="hl-tag">servlet-mapping</span>&gt;
        &lt;<span class="hl-tag">servlet-name</span>&gt;golfing&lt;<span class="hl-tag">/servlet-name</span>&gt;
        &lt;<span class="hl-tag">url-pattern</span>&gt;/golfing/*&lt;<span class="hl-tag">/url-pattern</span>&gt;
    &lt;<span class="hl-tag">/servlet-mapping</span>&gt;

&lt;<span class="hl-tag">/web-app</span>&gt;</pre><p>With the above Servlet configuration in place, you
    will need to have a file called <code class="literal">/WEB-INF/</code><span class="bold"><strong>golfing</strong></span><code class="literal">-servlet.xml</code> in your
    application; this file will contain all of your Spring Web MVC-specific
    components (beans). You can change the exact location of this
    configuration file through a Servlet initialization parameter (see below
    for details).</p><p>The <code class="interfacename">WebApplicationContext</code> is an
    extension of the plain <code class="interfacename">ApplicationContext</code>
    that has some extra features necessary for web applications. It differs
    from a normal <code class="interfacename">ApplicationContext</code> in that it
    is capable of resolving themes (see <a class="xref" href="#mvc-themeresolver" title="16.9&nbsp;Using themes">Section&nbsp;16.9, &#8220;Using themes&#8221;</a>),
    and that it knows which Servlet it is associated with (by having a link to
    the <code class="interfacename">ServletContext</code>). The
    <code class="interfacename">WebApplicationContext</code> is bound in the
    <code class="interfacename">ServletContext</code>, and by using static methods
    on the <code class="classname">RequestContextUtils</code> class you can always
    look up the <code class="interfacename">WebApplicationContext</code> if you
    need access to it.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-servlet-special-bean-types"></a>16.2.1&nbsp;Special Bean Types In the <code class="interfacename">WebApplicationContext</code></h3></div></div></div><p>The Spring <code class="classname">DispatcherServlet</code> uses special
	    beans to process requests and render the appropriate views. These beans
	    are part of Spring MVC. You can choose which special beans to use
	    by simply configuring one or more of them in the 
	    <code class="interfacename">WebApplicationContext</code>. 
	    However, you don't need to do that initially since Spring MVC
	    maintains a list of default beans to use if you don't configure any. 
	    More on that in the next section. First see the table below  
	    listing the special bean types the 
	    <code class="classname">DispatcherServlet</code> relies on.</p><div class="table"><a name="mvc-webappctx-special-beans-tbl"></a><p class="title"><b>Table&nbsp;16.1.&nbsp;Special bean types in the
	      <code class="interfacename">WebApplicationContext</code></b></p><div class="table-contents"><table summary="Special bean types in the&#xA;      WebApplicationContext" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Bean type</th><th style="border-bottom: 1.0pt solid ; ">Explanation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><a class="link" href="#mvc-handlermapping" title="16.4&nbsp;Handler mappings">HandlerMapping</a></td><td style="border-bottom: 1.0pt solid ; ">Maps incoming requests to handlers and a list of 
	            pre- and post-processors (handler interceptors) based on some 
	            criteria the details of which vary by <code class="interfacename">HandlerMapping</code>
	            implementation. The most popular implementation supports 
	            annotated controllers but other implementations exists as well.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">HandlerAdapter</td><td style="border-bottom: 1.0pt solid ; ">Helps the <code class="interfacename">DispatcherServlet</code> to 
	            invoke a handler mapped to a request regardless of the handler
	            is actually invoked. For example, invoking an annotated controller
	            requires resolving various annotations. Thus the main purpose
	            of a <code class="interfacename">HandlerAdapter</code> is to shield the 
	            <code class="classname">DispatcherServlet</code> from such details.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><a class="link" href="#mvc-exceptionhandlers" title="16.11&nbsp;Handling exceptions">HandlerExceptionResolver</a></td><td style="border-bottom: 1.0pt solid ; ">Maps exceptions to views also allowing for more 
	            complex exception handling code.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><a class="link" href="#mvc-viewresolver" title="16.5&nbsp;Resolving views">ViewResolver</a></td><td style="border-bottom: 1.0pt solid ; ">Resolves logical String-based view names to actual 
	            <span class="interface">View</span> types.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><a class="link" href="#mvc-localeresolver" title="16.8&nbsp;Using locales">LocaleResolver</a></td><td style="border-bottom: 1.0pt solid ; ">Resolves the locale a client is using,
	            in order to be able to offer internationalized views</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><a class="link" href="#mvc-themeresolver" title="16.9&nbsp;Using themes">ThemeResolver</a></td><td style="border-bottom: 1.0pt solid ; ">Resolves themes your web application can use, for
	            example, to offer personalized layouts</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><a class="link" href="#mvc-multipart" title="16.10&nbsp;Spring's multipart (file upload) support">MultipartResolver</a></td><td style="border-bottom: 1.0pt solid ; ">Parses multi-part requests for example to support processing 
	            file uploads from HTML forms.</td></tr><tr><td style="border-right: 1.0pt solid ; "><a class="link" href="#mvc-flash-attributes" title="16.6&nbsp;Using flash attributes">FlashMapManager</a></td><td style="">Stores and retrieves the "input" and the "output" 
	            <code class="classname">FlashMap</code> that can be used to pass attributes
	            from one request to another, usually across a redirect.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-servlet-config"></a>16.2.2&nbsp;Default DispatcherServlet Configuration</h3></div></div></div><p>As mentioned in the previous section for each special bean
		the <code class="classname">DispatcherServlet</code> maintains a list 
		of implementations to use by default. This information is
		kept in the file <code class="filename">DispatcherServlet.properties</code>
		in the package <code class="classname">org.springframework.web.servlet</code>.
		</p><p>All special beans have  some reasonable defaults of 
		their own. Sooner or later though you'll need to customize
		one or more of the properties these beans provide.
		For example it's quite common to configure 
		an <code class="classname">InternalResourceViewResolver</code> 
		settings its <code class="literal">prefix</code> property to
		the parent location of view files.</p><p>Regardless of the details, the important concept 
		to understand here is that once
		you	configure a special bean such as an
		<code class="classname">InternalResourceViewResolver</code>
		in your <code class="classname">WebApplicationContext</code>, you
		effectively override the list of default implementations
		that would have been used otherwise for that special bean 
		type. For example if you configure an 
		<code class="classname">InternalResourceViewResolver</code>, 
		the default list of <code class="interfacename">ViewResolver</code>
		implementations is ignored.
		</p><p>In <a class="xref" href="#mvc-config" title="16.14&nbsp;Configuring Spring MVC">Section&nbsp;16.14, &#8220;Configuring Spring MVC&#8221;</a> you'll learn about
		other options for configuring Spring MVC including 
		MVC Java config and the MVC XML namespace both of which provide
		a simple starting point and assume little knowledge of
		how Spring MVC works. Regardless of how you choose to 
		configure your application, the concepts explained in this
		section are fundamental should be of help to you. 
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-servlet-sequence"></a>16.2.3&nbsp;DispatcherServlet Processing Sequence</h3></div></div></div><p>After you set up a <code class="classname">DispatcherServlet</code>, and a
	    request comes in for that specific
	    <code class="classname">DispatcherServlet</code>, the
	    <code class="classname">DispatcherServlet</code> starts processing the request as
	    follows:</p><div class="orderedlist"><ol type="1"><li><p>The <code class="interfacename">WebApplicationContext</code> is
	        searched for and bound in the request as an attribute that the
	        controller and other elements in the process can use. It
	        is bound by default under the key
	        <code class="literal">DispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE</code>.</p></li><li><p>The locale resolver is bound to the request to enable elements
	        in the process to resolve the locale to use when processing the
	        request (rendering the view, preparing data, and so on). If you do not
	        need locale resolving, you do not need it.</p></li><li><p>The theme resolver is bound to the request to let elements such
	        as views determine which theme to use. If you do not use themes, you
	        can ignore it.</p></li><li><p>If you specify a multipart file resolver, the request is
	        inspected for multiparts; if multiparts are found, the request is
	        wrapped in a <code class="classname">MultipartHttpServletRequest</code> for
	        further processing by other elements in the process. See <a class="xref" href="#mvc-multipart" title="16.10&nbsp;Spring's multipart (file upload) support">Section&nbsp;16.10, &#8220;Spring's multipart (file upload) support&#8221;</a> for further information about multipart
	        handling.</p></li><li><p>An appropriate handler is searched for. If a handler is found,
	        the execution chain associated with the handler (preprocessors,
	        postprocessors, and controllers) is executed in order to prepare a
	        model or rendering.</p></li><li><p>If a model is returned, the view is rendered. If no model is
	        returned, (may be due to a preprocessor or postprocessor intercepting
	        the request, perhaps for security reasons), no view is rendered,
	        because the request could already have been fulfilled.</p></li></ol></div><p>Handler exception resolvers that are declared in the
	    <code class="interfacename">WebApplicationContext</code> pick up exceptions
	    that are thrown during processing of the request. Using these exception
	    resolvers allows you to define custom behaviors to address
	    exceptions.</p></div><p>The Spring <code class="classname">DispatcherServlet</code> also supports
    the return of the <span class="emphasis"><em>last-modification-date</em></span>, as
    specified by the Servlet API. The process of determining the last
    modification date for a specific request is straightforward: the
    <code class="classname">DispatcherServlet</code> looks up an appropriate handler
    mapping and tests whether the handler that is found implements the
    <span class="emphasis"><em><code class="interfacename">LastModified</code></em></span>
    interface. If so, the value of the <code class="literal">long
    getLastModified(request)</code> method of the
    <code class="interfacename">LastModified</code> interface is returned to the
    client.</p><p>You can customize individual
    <code class="classname">DispatcherServlet</code> instances by adding Servlet
    initialization parameters (<code class="literal">init-param</code> elements) to the
    Servlet declaration in the <code class="literal">web.xml</code> file. See the
    following table for the list of supported parameters.</p><div class="table"><a name="mvc-disp-servlet-init-params-tbl"></a><p class="title"><b>Table&nbsp;16.2.&nbsp;<code class="classname">DispatcherServlet</code> initialization
      parameters</b></p><div class="table-contents"><table summary="DispatcherServlet initialization&#xA;      parameters" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Parameter</th><th style="border-bottom: 1.0pt solid ; ">Explanation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">contextClass</code></td><td style="border-bottom: 1.0pt solid ; ">Class that implements
            <code class="interfacename">WebApplicationContext</code>, which
            instantiates the context used by this Servlet. By default, the
            <code class="classname">XmlWebApplicationContext</code> is used.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">contextConfigLocation</code></td><td style="border-bottom: 1.0pt solid ; ">String that is passed to the context instance (specified by
            <code class="literal">contextClass</code>) to indicate where context(s) can
            be found. The string consists potentially of multiple strings
            (using a comma as a delimiter) to support multiple contexts. In
            case of multiple context locations with beans that are defined
            twice, the latest location takes precedence.</td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="literal">namespace</code></td><td style="">Namespace of the
            <code class="interfacename">WebApplicationContext</code>. Defaults to
            <code class="literal">[servlet-name]-servlet</code>.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-controller"></a>16.3&nbsp;Implementing Controllers</h2></div></div></div><p>Controllers provide access to the application behavior that you
    typically define through a service interface. Controllers
    interpret user input and transform it into a model that is represented to
    the user by the view. Spring implements a controller in a very abstract
    way, which enables you to create a wide variety of controllers.</p><p>Spring 2.5 introduced an annotation-based programming model for MVC
    controllers that uses annotations such as
    <code class="interfacename">@RequestMapping</code>,
    <code class="interfacename">@RequestParam</code>,
    <code class="interfacename">@ModelAttribute</code>, and so on. This annotation
    support is available for both Servlet MVC and Portlet MVC. Controllers
    implemented in this style do not have to extend specific base classes or
    implement specific interfaces. Furthermore, they do not usually have
    direct dependencies on Servlet or Portlet APIs, although you can easily
    configure access to Servlet or Portlet facilities.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Available in the <a class="link" href="#new-in-3.0-samples">samples
      repository</a>, a number of web applications leverage the annotation
      support described in this section including
      <span class="emphasis"><em>MvcShowcase</em></span>, <span class="emphasis"><em>MvcAjax</em></span>,
      <span class="emphasis"><em>MvcBasic</em></span>, <span class="emphasis"><em>PetClinic</em></span>,
      <span class="emphasis"><em>PetCare</em></span>, and others.</p></td></tr></table></div><pre class="programlisting">@Controller
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HelloWorldController {

    @RequestMapping(<span class="hl-string">"/helloWorld"</span>)
    <span class="hl-keyword">public</span> String helloWorld(Model model) {
        model.addAttribute(<span class="hl-string">"message"</span>, <span class="hl-string">"Hello World!"</span>);
        <span class="hl-keyword">return</span> <span class="hl-string">"helloWorld"</span>;
    }
}</pre><p>As you can see, the <code class="interfacename">@Controller</code> and
    <code class="interfacename">@RequestMapping</code> annotations allow flexible
    method names and signatures. In this particular example the method accepts
    a <code class="classname">Model</code> and returns a view name as a
    <code class="classname">String</code>, but various other method parameters and
    return values can be used as explained later in this section.
    <code class="interfacename">@Controller</code> and
    <code class="interfacename">@RequestMapping</code> and a number of other
    annotations form the basis for the Spring MVC implementation. This section
    documents these annotations and how they are most commonly used in a
    Servlet environment.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-ann-controller"></a>16.3.1&nbsp;Defining a controller with
      <code class="interfacename">@Controller</code></h3></div></div></div><p>The <code class="interfacename">@Controller</code> annotation
      indicates that a particular class serves the role of a
      <span class="emphasis"><em>controller</em></span>. Spring does not require you to extend
      any controller base class or reference the Servlet API. However, you can
      still reference Servlet-specific features if you need to.</p><p>The <code class="interfacename">@Controller</code> annotation acts as
      a stereotype for the annotated class, indicating its role. The
      dispatcher scans such annotated classes for mapped methods and detects
      <code class="interfacename">@RequestMapping</code> annotations (see the next
      section).</p><p>You can define annotated controller beans explicitly, using a
      standard Spring bean definition in the dispatcher's context. However,
      the <code class="interfacename">@Controller</code> stereotype also allows
      for autodetection, aligned with Spring general support for detecting
      component classes in the classpath and auto-registering bean definitions
      for them.</p><p>To enable autodetection of such annotated controllers, you add
      component scanning to your configuration. Use the
      <span class="emphasis"><em>spring-context</em></span> schema as shown in the following XML
      snippet:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span> 
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">"http://www.springframework.org/schema/p"</span> 
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans 
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/context 
        http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.springframework.samples.petclinic.web"</span>/&gt;

    &lt;<span class="hl-comment">!-- ... --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-ann-requestmapping"></a>16.3.2&nbsp;Mapping Requests With
      <code class="interfacename">@RequestMapping</code></h3></div></div></div><p>You use the <code class="interfacename">@RequestMapping</code>
      annotation to map URLs such as <code class="filename">/appointments</code> onto
      an entire class or a particular handler method. Typically the
      class-level annotation maps a specific request path (or path pattern)
      onto a form controller, with additional method-level annotations
      narrowing the primary mapping for a specific HTTP method request method
      ("GET", "POST", etc.) or an HTTP request parameter condition.</p><p>The following example from the <span class="emphasis"><em>Petcare</em></span> sample
      shows a controller in a Spring MVC application that uses this
      annotation:</p><pre class="programlisting">@Controller
@RequestMapping(<span class="hl-string">"/appointments"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppointmentsController {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> AppointmentBook appointmentBook;
    
    @Autowired
    <span class="hl-keyword">public</span> AppointmentsController(AppointmentBook appointmentBook) {
        <span class="hl-keyword">this</span>.appointmentBook = appointmentBook;
    }

    @RequestMapping(method = RequestMethod.GET)
    <span class="hl-keyword">public</span> Map&lt;String, Appointment&gt; get() {
        <span class="hl-keyword">return</span> appointmentBook.getAppointmentsForToday();
    }

    @RequestMapping(value=<span class="hl-string">"/{day}"</span>, method = RequestMethod.GET)
    <span class="hl-keyword">public</span> Map&lt;String, Appointment&gt; getForDay(@PathVariable @DateTimeFormat(iso=ISO.DATE) Date day, Model model) {
        <span class="hl-keyword">return</span> appointmentBook.getAppointmentsForDay(day);
    }

    @RequestMapping(value=<span class="hl-string">"/new"</span>, method = RequestMethod.GET)
    <span class="hl-keyword">public</span> AppointmentForm getNewForm() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> AppointmentForm();
    }

    @RequestMapping(method = RequestMethod.POST)
    <span class="hl-keyword">public</span> String add(@Valid AppointmentForm appointment, BindingResult result) {
        <span class="hl-keyword">if</span> (result.hasErrors()) {
            <span class="hl-keyword">return</span> <span class="hl-string">"appointments/new"</span>;
        }
        appointmentBook.addAppointment(appointment);
        <span class="hl-keyword">return</span> <span class="hl-string">"redirect:/appointments"</span>;
    }
}</pre><p>In the example, the <code class="interfacename">@RequestMapping</code>
      is used in a number of places. The first usage is on the type (class)
      level, which indicates that all handling methods on this controller are
      relative to the <code class="filename">/appointments</code> path. The
      <code class="methodname">get()</code> method has a further
      <code class="interfacename">@RequestMapping</code> refinement: it only
      accepts GET requests, meaning that an HTTP GET for
      <code class="filename">/appointments</code> invokes this method. The
      <code class="methodname">post()</code> has a similar refinement, and the
      <code class="methodname">getNewForm()</code> combines the definition of HTTP
      method and path into one, so that GET requests for
      <code class="filename">appointments/new</code> are handled by that method.</p><p>The <code class="methodname">getForDay()</code> method shows another
      usage of <code class="interfacename">@RequestMapping</code>: URI templates.
      (See <a class="link" href="#mvc-ann-requestmapping-uri-templates" title="16.3.2.2&nbsp;URI Template Patterns">the next
      section </a>).</p><p>A <code class="interfacename">@RequestMapping</code> on the class
      level is not required. Without it, all paths are simply absolute, and
      not relative. The following example from the
      <span class="emphasis"><em>PetClinic</em></span> sample application shows a multi-action
      controller using <code class="classname">@RequestMapping</code>:</p><pre class="programlisting">@Controller
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ClinicController {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> Clinic clinic;

    @Autowired
    <span class="hl-keyword">public</span> ClinicController(Clinic clinic) {
        <span class="hl-keyword">this</span>.clinic = clinic;
    }

    @RequestMapping(<span class="hl-string">"/"</span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> welcomeHandler() {
    }

    @RequestMapping(<span class="hl-string">"/vets"</span>)
    <span class="hl-keyword">public</span> ModelMap vetsHandler() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ModelMap(<span class="hl-keyword">this</span>.clinic.getVets());
    }

}</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Using @RequestMapping On&#xA;        Interface Methods"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Using @RequestMapping On
        Interface Methods</th></tr><tr><td align="left" valign="top"><p>A common pitfall when working with annotated controller classes
        happens when applying functionality that requires creating a proxy for
        the controller object (e.g.
        <code class="interfacename">@Transactional</code> methods). Usually you
        will introduce an interface for the controller in order to use JDK
        dynamic proxies. To make this work you must move the
        <code class="interfacename">@RequestMapping</code> annotations to the
        interface as well as the mapping mechanism can only "see" the
        interface exposed by the proxy. Alternatively, you could activate
        <code class="code">proxy-target-class="true"</code> in the configuration for the
        functionality applied to the controller (in our transaction scenario
        in <code class="code">&lt;tx:annotation-driven /&gt;</code>). Doing so indicates
        that CGLIB-based subclass proxies should be used instead of
        interface-based JDK proxies. For more information on various proxying
        mechanisms see <a class="xref" href="#aop-proxying" title="8.6&nbsp;Proxying mechanisms">Section&nbsp;8.6, &#8220;Proxying mechanisms&#8221;</a>.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-31-vs-30"></a>16.3.2.1&nbsp;New Support Classes for <code class="classname">@RequestMapping</code> methods in Spring MVC 3.1</h4></div></div></div><p>Spring 3.1 introduced a new set of support classes for
        <code class="classname">@RequestMapping</code> methods called
        <code class="classname">RequestMappingHandlerMapping</code> and
        <code class="classname">RequestMappingHandlerAdapter</code> respectively.
        They are recommended for use and even required to take advantage of
        new features in Spring MVC 3.1 and going forward. The new support
        classes are enabled by default by the MVC namespace and MVC Java
        config (<code class="classname">@EnableWebMvc</code>) but must be configured
        explicitly if using neither. This section describes a few
        important differences between the old and the new support classes.
        </p><p>Prior to Spring 3.1, type and method-level request mappings were
        examined in two separate stages -- a controller was selected first
        by the <code class="classname">DefaultAnnotationHandlerMapping</code> and the
        actual method to invoke was narrowed down second by
        the <code class="classname">AnnotationMethodHandlerAdapter</code>.</p><p>With the new support classes in Spring 3.1, the
        <code class="classname">RequestMappingHandlerMapping</code> is the only place
        where a decision is made about which method should process the request.
        Think of controller methods as a collection of unique endpoints
        with mappings for each method derived from type and method-level
        <code class="classname">@RequestMapping</code> information.</p><p>This enables some new possibilities. For once a
        <code class="classname">HandlerInterceptor</code> or a
        <code class="classname">HandlerExceptionResolver</code> can now expect the
        Object-based handler to be a <code class="classname">HandlerMethod</code>,
        which allows them to examine the exact method, its parameters and
        associated annotations. The processing for a URL no longer needs to
        be split across different controllers.
        </p><p>There are also several things no longer possible:</p><div class="itemizedlist"><ul type="disc"><li><p>Select a controller first with a
            <code class="classname">SimpleUrlHandlerMapping</code> or
            <code class="classname">BeanNameUrlHandlerMapping</code> and then narrow
            the method based on <code class="classname">@RequestMapping</code>
            annotations.</p></li><li><p>Rely on method names as a fall-back mechanism to
            disambiguate between two <code class="classname">@RequestMapping</code> methods
            that don't have an explicit path mapping URL path but otherwise
            match equally, e.g. by HTTP method. In the new support classes
            <code class="classname">@RequestMapping</code> methods have to be mapped
            uniquely.</p></li><li><p>Have a single default method (without an explicit
            path mapping) with which requests are processed if no other
            controller method matches more concretely. In the new support
            classes if a matching method is not found a 404 error
            is raised.</p></li></ul></div><p>The above features are still supported with the existing support
        classes. However to take advantage of new Spring MVC 3.1 features
        you'll need to use the new support classes.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-uri-templates"></a>16.3.2.2&nbsp;URI Template Patterns</h4></div></div></div><p><span class="emphasis"><em>URI templates</em></span> can be used for convenient
        access to selected parts of a URL in a
        <code class="interfacename">@RequestMapping</code> method.</p><p>A URI Template is a URI-like string, containing one or more
        variable names. When you substitute values for these variables, the
        template becomes a URI. The <a class="ulink" href="http://bitworking.org/projects/URI-Templates/" target="_top">proposed
        RFC</a> for URI Templates defines how a URI is parameterized. For
        example, the URI Template
        <code class="code">http://www.example.com/users/{userId}</code> contains the
        variable <span class="emphasis"><em>userId</em></span>. Assigning the value
        <span class="emphasis"><em>fred</em></span> to the variable yields
        <code class="code">http://www.example.com/users/fred</code>.</p><p>In Spring MVC you can use the
        <code class="interfacename">@PathVariable</code> annotation on a method
        argument to bind it to the value of a URI template variable:</p><pre class="programlisting">@RequestMapping(value=<span class="hl-string">"/owners/{ownerId}"</span>, method=RequestMethod.GET)
<span class="hl-keyword">public</span> String findOwner(@PathVariable String ownerId, Model model) {
  Owner owner = ownerService.findOwner(ownerId);  
  model.addAttribute(<span class="hl-string">"owner"</span>, owner);  
  <span class="hl-keyword">return</span> <span class="hl-string">"displayOwner"</span>; 
}</pre><p>The URI Template "<code class="literal">/owners/{ownerId}</code>"
        specifies the variable name <code class="literal">ownerId</code>. When the
        controller handles this request, the value of
        <code class="literal">ownerId</code> is set to the value found in the
        appropriate part of the URI. For example, when a request comes in for
        <code class="code">/owners/fred</code>, the value of <code class="literal">ownerId</code> is
        <code class="literal">fred</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>To process the @PathVariable annotation, Spring MVC needs to
          find the matching URI template variable by name. You can specify it
          in the annotation:</p><pre class="programlisting">@RequestMapping(value=<span class="hl-string">"/owners/{ownerId}"</span>, method=RequestMethod.GET)
<span class="hl-keyword">public</span> String findOwner(@PathVariable(<span class="hl-string">"ownerId"</span>) String theOwner, Model model) {
  <span class="hl-comment">// implementation omitted</span>
}</pre><p>Or if the URI template variable name matches the method
          argument name you can omit that detail. As long as your code is not
          compiled without debugging information, Spring MVC will match the
          method argument name to the URI template variable name:</p><pre class="programlisting">@RequestMapping(value=<span class="hl-string">"/owners/{ownerId}"</span>, method=RequestMethod.GET)
<span class="hl-keyword">public</span> String findOwner(@PathVariable String ownerId, Model model) {
  <span class="hl-comment">// implementation omitted</span>
}</pre></td></tr></table></div><p>A method can have any number of
        <code class="interfacename">@PathVariable</code> annotations:</p><pre class="programlisting">@RequestMapping(value=<span class="hl-string">"/owners/{ownerId}/pets/{petId}"</span>, method=RequestMethod.GET)
<span class="hl-keyword">public</span> String findPet(@PathVariable String ownerId, @PathVariable String petId, Model model) {
  Owner owner = ownerService.findOwner(ownerId);  
  Pet pet = owner.getPet(petId);  
  model.addAttribute(<span class="hl-string">"pet"</span>, pet);  
  <span class="hl-keyword">return</span> <span class="hl-string">"displayPet"</span>; 
}</pre><p>A URI template can be assembled from type and path level
        <span class="emphasis"><em>@RequestMapping</em></span> annotations. As a result the
        <code class="methodname">findPet()</code> method can be invoked with a URL
        such as <code class="filename">/owners/42/pets/21</code>.</p><pre class="programlisting">@Controller
@RequestMapping(<span class="hl-string">"/owners/{ownerId}"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RelativePathUriTemplateController {

  @RequestMapping(<span class="hl-string">"/pets/{petId}"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(@PathVariable String ownerId, @PathVariable String petId, Model model) {    
    <span class="hl-comment">// implementation omitted</span>
  }
}</pre><p>A <code class="interfacename">@PathVariable</code> argument can be
        of <span class="bold"><strong>any simple type</strong></span> such as int, long,
        Date, etc. Spring automatically converts to the appropriate type or
        throws a <code class="classname">TypeMismatchException</code> if it fails to
        do so. You can also register support for parsing additional data
        types. See <a class="xref" href="#mvc-ann-typeconversion" title="16.3.3.14&nbsp;Method Parameters And Type Conversion">Section&nbsp;16.3.3.14, &#8220;Method Parameters And Type Conversion&#8221;</a> and <a class="xref" href="#mvc-ann-webdatabinder" title="16.3.3.15&nbsp;Customizing WebDataBinder initialization">Section&nbsp;16.3.3.15, &#8220;Customizing WebDataBinder
        initialization&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-uri-templates-regex"></a>16.3.2.3&nbsp;URI Template Patterns with Regular Expressions</h4></div></div></div><p>Sometimes you need more precision in defining URI template
        variables. Consider the URL
        <code class="code">"/spring-web/spring-web-3.0.5.jar"</code>. How do you break it
        down into multiple parts?</p><p>The <code class="interfacename">@RequestMapping</code> annotation
        supports the use of regular expressions in URI template variables. The
        syntax is <code class="code">{varName:regex}</code> where the first part defines
        the variable name and the second - the regular expression.For
        example:</p><pre class="programlisting">
@RequestMapping(<span class="hl-string">"/spring-web/{symbolicName:[a-z-]+}-{version:\d\.\d\.\d}.{extension:\.[a-z]}"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> handle(@PathVariable String version, @PathVariable String extension) {    
    <span class="hl-comment">// ...</span>
  }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-patterns"></a>16.3.2.4&nbsp;Path Patterns</h4></div></div></div><p>In addition to URI templates, the
        <code class="interfacename">@RequestMapping</code> annotation also
        supports Ant-style path patterns (for example,
        <code class="filename">/myPath/*.do</code>). A combination of URI templates and
        Ant-style globs is also supported (for example,
        <code class="filename">/owners/*/pets/{petId}</code>).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-consumes"></a>16.3.2.5&nbsp;Consumable Media Types</h4></div></div></div><p>You can narrow the primary mapping by specifying a list of
        consumable media types. The request will be matched only if the
        <span class="emphasis"><em>Content-Type</em></span> request header matches the specified
        media type. For example:</p><pre class="programlisting">@Controller
@RequestMapping(value = <span class="hl-string">"/pets"</span>, method = RequestMethod.POST, consumes=<span class="hl-string">"application/json"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addPet(@RequestBody Pet pet, Model model) {    
    <span class="hl-comment">// implementation omitted</span>
}</pre><p>Consumable media type expressions can also be negated as in
        <span class="emphasis"><em>!text/plain</em></span> to match to all requests other than
        those with <span class="emphasis"><em>Content-Type</em></span> of
        <span class="emphasis"><em>text/plain</em></span>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The <span class="emphasis"><em>consumes</em></span> condition is supported on
          the type and on the method level. Unlike most other conditions, when
          used at the type level, method-level consumable types override
          rather than extend type-level consumeable types.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-produces"></a>16.3.2.6&nbsp;Producible Media Types</h4></div></div></div><p>You can narrow the primary mapping by specifying a list of
        producible media types. The request will be matched only if the
        <span class="emphasis"><em>Accept</em></span> request header matches one of these
        values. Furthermore, use of the <span class="emphasis"><em>produces</em></span>
        condition ensures the actual content type used to generate the
        response respects the media types specified in the
        <span class="emphasis"><em>produces</em></span> condition. For example:</p><pre class="programlisting">@Controller
@RequestMapping(value = <span class="hl-string">"/pets/{petId}"</span>, method = RequestMethod.GET, produces=<span class="hl-string">"application/json"</span>)
@ResponseBody
<span class="hl-keyword">public</span> Pet getPet(@PathVariable String petId, Model model) {    
    <span class="hl-comment">// implementation omitted</span>
}</pre><p>Just like with <span class="emphasis"><em>consumes</em></span>, producible media
        type expressions can be negated as in <span class="emphasis"><em>!text/plain</em></span>
        to match to all requests other than those with an
        <span class="emphasis"><em>Accept</em></span> header value of
        <span class="emphasis"><em>text/plain</em></span>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The <span class="emphasis"><em>produces</em></span> condition is supported on
          the type and on the method level. Unlike most other conditions, when
          used at the type level, method-level producible types override
          rather than extend type-level producible types.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-params-and-headers"></a>16.3.2.7&nbsp;Request Parameters and Header Values</h4></div></div></div><p>You can narrow request matching through request parameter
        conditions such as <code class="code">"myParam"</code>, <code class="code">"!myParam"</code>, or
        <code class="code">"myParam=myValue"</code>. The first two test for request
        parameter presense/absence and the third for a specific parameter
        value. Here is an example with a request parameter value
        condition:</p><pre class="programlisting">@Controller
@RequestMapping(<span class="hl-string">"/owners/{ownerId}"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RelativePathUriTemplateController {

  @RequestMapping(value = <span class="hl-string">"/pets/{petId}"</span>, method = RequestMethod.GET, params=<span class="hl-string">"myParam=myValue"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(@PathVariable String ownerId, @PathVariable String petId, Model model) {    
    <span class="hl-comment">// implementation omitted</span>
  }
}</pre><p>The same can be done to test for request header presence/absence
        or to match based on a specific request header value:</p><pre class="programlisting">@Controller
@RequestMapping(<span class="hl-string">"/owners/{ownerId}"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RelativePathUriTemplateController {

@RequestMapping(value = <span class="hl-string">"/pets"</span>, method = RequestMethod.GET, headers=<span class="hl-string">"myHeader=myValue"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(@PathVariable String ownerId, @PathVariable String petId, Model model) {    
    <span class="hl-comment">// implementation omitted</span>
  }
}</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Although you can match to <span class="emphasis"><em>Content-Type</em></span>
          and <span class="emphasis"><em>Accept</em></span> header values using media type wild
          cards (for example <span class="emphasis"><em>"content-type=text/*"</em></span> will
          match to <span class="emphasis"><em>"text/plain"</em></span> and
          <span class="emphasis"><em>"text/html"</em></span>), it is recommended to use the
          <span class="emphasis"><em>consumes</em></span> and <span class="emphasis"><em>produces</em></span>
          conditions respectively instead. They are intended specifically for
          that purpose.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-ann-methods"></a>16.3.3&nbsp;Defining <span class="interface">@RequestMapping</span> handler
      methods</h3></div></div></div><p>An <code class="classname">@RequestMapping</code> handler method can have
      a very flexible signatures. The supported method arguments and return
      values are described in the following section. Most arguments can be
      used in arbitrary order with the only exception of
      <code class="classname">BindingResult</code> arguments. This is described in the
      next section.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Spring 3.1 introduced a new set of support classes for
      <code class="classname">@RequestMapping</code> methods called
      <code class="classname">RequestMappingHandlerMapping</code> and
      <code class="classname">RequestMappingHandlerAdapter</code> respectively.
      They are recommended for use and even required to take advantage
      of new features in Spring MVC 3.1 and going forward.
      The new support classes are enabled by default from the MVC namespace and
      with use of the MVC Java config (<code class="code">@EnableWebMvc</code>) but must be
      configured explicitly if using neither.
      </p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-arguments"></a>16.3.3.1&nbsp;Supported method argument types</h4></div></div></div><p>The following are the supported method arguments: </p><div class="itemizedlist"><ul type="disc"><li><p>Request or response objects (Servlet API). Choose any
              specific request or response type, for example
              <code class="interfacename">ServletRequest</code> or
              <code class="interfacename">HttpServletRequest</code>.</p></li><li><p>Session object (Servlet API): of type
              <code class="interfacename">HttpSession</code>. An argument of this
              type enforces the presence of a corresponding session. As a
              consequence, such an argument is never
              <code class="literal">null</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Session access may not be thread-safe, in particular in
                a Servlet environment. Consider setting the
                <code class="classname">RequestMappingHandlerAdapter</code>'s
                "synchronizeOnSession" flag to "true" if multiple requests are
                allowed to access a session concurrently.</p></td></tr></table></div></li><li><p><code class="classname">org.springframework.web.context.request.WebRequest</code>
              or
              <code class="classname">org.springframework.web.context.request.NativeWebRequest</code>.
              Allows for generic request parameter access as well as
              request/session attribute access, without ties to the native
              Servlet/Portlet API.</p></li><li><p><code class="classname">java.util.Locale</code> for the current
              request locale, determined by the most specific locale resolver
              available, in effect, the configured
              <code class="interfacename">LocaleResolver</code> in a Servlet
              environment.</p></li><li><p><code class="classname">java.io.InputStream</code> /
              <code class="classname">java.io.Reader</code> for access to the
              request's content. This value is the raw InputStream/Reader as
              exposed by the Servlet API.</p></li><li><p><code class="classname">java.io.OutputStream</code> /
              <code class="classname">java.io.Writer</code> for generating the
              response's content. This value is the raw OutputStream/Writer as
              exposed by the Servlet API.</p></li><li><p><code class="interfacename">java.security.Principal</code>
              containing the currently authenticated user.</p></li><li><p><code class="classname">@PathVariable</code> annotated parameters
              for access to URI template variables. See <a class="xref" href="#mvc-ann-requestmapping-uri-templates" title="16.3.2.2&nbsp;URI Template Patterns">Section&nbsp;16.3.2.2, &#8220;URI Template Patterns&#8221;</a>.</p></li><li><p><code class="classname">@RequestParam</code> annotated parameters
              for access to specific Servlet request parameters. Parameter
              values are converted to the declared method argument type. See
              <a class="xref" href="#mvc-ann-requestparam" title="16.3.3.3&nbsp;Binding request parameters to method parameters with @RequestParam">Section&nbsp;16.3.3.3, &#8220;Binding request parameters to method parameters with
        @RequestParam&#8221;</a>.</p></li><li><p><code class="interfacename">@RequestHeader</code> annotated
              parameters for access to specific Servlet request HTTP headers.
              Parameter values are converted to the declared method argument
              type.</p></li><li><p><code class="interfacename">@RequestBody</code> annotated
              parameters for access to the HTTP request body. Parameter values
              are converted to the declared method argument type using
              <code class="interfacename">HttpMessageConverter</code>s. See <a class="xref" href="#mvc-ann-requestbody" title="16.3.3.4&nbsp;Mapping the request body with the @RequestBody annotation">Section&nbsp;16.3.3.4, &#8220;Mapping the request body with the @RequestBody
        annotation&#8221;</a>.</p></li><li><p><code class="interfacename">@RequestPart</code> annotated
              parameters for access to the content of a "multipart/form-data"
              request part. See <a class="xref" href="#mvc-multipart-forms-non-browsers" title="16.10.5&nbsp;Handling a file upload request from programmatic clients">Section&nbsp;16.10.5, &#8220;Handling a file upload request from programmatic clients&#8221;</a> and <a class="xref" href="#mvc-multipart" title="16.10&nbsp;Spring's multipart (file upload) support">Section&nbsp;16.10, &#8220;Spring's multipart (file upload) support&#8221;</a>.</p></li><li><p><code class="classname">HttpEntity&lt;?&gt;</code> parameters for
              access to the Servlet request HTTP headers and contents. The
              request stream will be converted to the entity body using
              <code class="interfacename">HttpMessageConverter</code>s. See <a class="xref" href="#mvc-ann-httpentity" title="16.3.3.6&nbsp;Using HttpEntity<?&gt;">Section&nbsp;16.3.3.6, &#8220;Using HttpEntity&lt;?&gt;&#8221;</a>.</p></li><li><p><code class="interfacename">java.util.Map</code> /
              <code class="interfacename">org.springframework.ui.Model</code> /
              <code class="classname">org.springframework.ui.ModelMap</code> for
              enriching the implicit model that is exposed to the web
              view.</p></li><li><p><code class="interfacename">org.springframework.web.servlet.mvc.support.RedirectAttributes</code>
              to specify the exact set of attributes to use in case of a
              redirect and also to add flash attributes (attributes stored
              temporarily on the server-side to make them available to the
              request after the redirect).
              <code class="literal">RedirectAttributes</code> is used instead of the
              implicit model if the method returns a "redirect:" prefixed view
              name or <code class="classname">RedirectView</code>.</p></li><li><p>Command or form objects to bind request parameters to bean
              properties (via setters) or directly to fields, with
              customizable type conversion, depending on
              <code class="classname">@InitBinder</code> methods and/or the
              HandlerAdapter configuration. See the
              <code class="literal">webBindingInitializer</code> property on
              <code class="classname">RequestMappingHandlerAdapter</code>. Such
              command objects along with their validation results will be
              exposed as model attributes by default, using the command class
              class name - e.g. model attribute "orderAddress" for a command
              object of type "some.package.OrderAddress". The
              <code class="classname">ModelAttribute</code> annotation can be used on
              a method argument to customize the model attribute name
              used.</p></li><li><p><code class="classname">org.springframework.validation.Errors</code>
              /
              <code class="classname">org.springframework.validation.BindingResult</code>
              validation results for a preceding command or form object (the
              immediately preceding method argument).</p></li><li><p><code class="classname">org.springframework.web.bind.support.SessionStatus</code>
              status handle for marking form processing as complete, which
              triggers the cleanup of session attributes that have been
              indicated by the <code class="classname">@SessionAttributes</code>
              annotation at the handler type level.</p></li><li><p><code class="classname">org.springframework.web.util.UriComponentsBuilder</code>
              a builder for preparing a URL relative to the current request's 
              host, port, scheme, context path, and the literal part of the 
              servlet mapping.</p></li></ul></div><p>The <code class="interfacename">Errors</code> or
        <code class="interfacename">BindingResult</code> parameters have to follow
        the model object that is being bound immediately as the method
        signature might have more that one model object and Spring will create
        a separate <code class="interfacename">BindingResult</code> instance for
        each of them so the following sample won't work:</p><div class="example"><a name="d0e29628"></a><p class="title"><b>Example&nbsp;16.1.&nbsp;Invalid ordering of BindingResult and @ModelAttribute</b></p><div class="example-contents"><pre class="programlisting">@RequestMapping(method = RequestMethod.POST)
<span class="hl-keyword">public</span> String processSubmit(@ModelAttribute(<span class="hl-string">"pet"</span>) Pet pet,
    Model model, BindingResult result) { &#8230; }</pre><p>Note, that there is a <code class="interfacename">Model</code>
          parameter in between <code class="classname">Pet</code> and
          <code class="interfacename">BindingResult</code>. To get this working
          you have to reorder the parameters as follows:</p><pre class="programlisting">@RequestMapping(method = RequestMethod.POST)
<span class="hl-keyword">public</span> String processSubmit(@ModelAttribute(<span class="hl-string">"pet"</span>) Pet pet,
    BindingResult result, Model model) { &#8230; }</pre></div></div><br class="example-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-return-types"></a>16.3.3.2&nbsp;Supported method return types</h4></div></div></div><p>The following are the supported return types: </p><div class="itemizedlist"><ul type="disc"><li><p>A <code class="classname">ModelAndView</code> object, with the
              model implicitly enriched with command objects and the results
              of <code class="literal">@ModelAttribute</code> annotated reference data
              accessor methods.</p></li><li><p>A <code class="interfacename">Model</code> object, with the
              view name implicitly determined through a
              <code class="interfacename">RequestToViewNameTranslator</code> and
              the model implicitly enriched with command objects and the
              results of <code class="literal">@ModelAttribute</code> annotated
              reference data accessor methods.</p></li><li><p>A <code class="interfacename">Map</code> object for exposing a
              model, with the view name implicitly determined through a
              <code class="interfacename">RequestToViewNameTranslator</code> and
              the model implicitly enriched with command objects and the
              results of <code class="literal">@ModelAttribute</code> annotated
              reference data accessor methods.</p></li><li><p>A <code class="interfacename">View</code> object, with the
              model implicitly determined through command objects and
              <code class="literal">@ModelAttribute</code> annotated reference data
              accessor methods. The handler method may also programmatically
              enrich the model by declaring a
              <code class="interfacename">Model</code> argument (see above).</p></li><li><p>A <code class="classname">String</code> value that is interpreted
              as the logical view name, with the model implicitly determined
              through command objects and <code class="literal">@ModelAttribute</code>
              annotated reference data accessor methods. The handler method
              may also programmatically enrich the model by declaring a
              <code class="interfacename">Model</code> argument (see
              above).</p></li><li><p><code class="literal">void</code> if the method handles the response
              itself (by writing the response content directly, declaring an
              argument of type <code class="interfacename">ServletResponse</code>
              / <code class="interfacename">HttpServletResponse</code> for that
              purpose) or if the view name is supposed to be implicitly
              determined through a
              <code class="interfacename">RequestToViewNameTranslator</code> (not
              declaring a response argument in the handler method
              signature).</p></li><li><p>If the method is annotated with
              <code class="interfacename">@ResponseBody</code>, the return type is
              written to the response HTTP body. The return value will be
              converted to the declared method argument type using
              <code class="interfacename">HttpMessageConverter</code>s. See <a class="xref" href="#mvc-ann-responsebody" title="16.3.3.5&nbsp;Mapping the response body with the @ResponseBody annotation">Section&nbsp;16.3.3.5, &#8220;Mapping the response body with the
        @ResponseBody annotation&#8221;</a>.</p></li><li><p>A <code class="classname">HttpEntity&lt;?&gt;</code> or
              <code class="classname">ResponseEntity&lt;?&gt;</code> object to provide
              access to the Servlet response HTTP headers and contents. The
              entity body will be converted to the response stream using
              <code class="interfacename">HttpMessageConverter</code>s. See <a class="xref" href="#mvc-ann-httpentity" title="16.3.3.6&nbsp;Using HttpEntity<?&gt;">Section&nbsp;16.3.3.6, &#8220;Using HttpEntity&lt;?&gt;&#8221;</a>.</p></li><li><p>Any other return type is considered to be a single model
              attribute to be exposed to the view, using the attribute name
              specified through <code class="literal">@ModelAttribute</code> at the
              method level (or the default attribute name based on the return
              type class name). The model is implicitly enriched with command
              objects and the results of <code class="literal">@ModelAttribute</code>
              annotated reference data accessor methods.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestparam"></a>16.3.3.3&nbsp;Binding request parameters to method parameters with
        <code class="interfacename">@RequestParam</code></h4></div></div></div><p>Use the <code class="classname">@RequestParam</code> annotation to bind
        request parameters to a method parameter in your controller.</p><p>The following code snippet shows the usage:</p><pre class="programlisting">@Controller
@RequestMapping(<span class="hl-string">"/pets"</span>)
@SessionAttributes(<span class="hl-string">"pet"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> EditPetForm {

    <span class="hl-comment">// ...</span>

    @RequestMapping(method = RequestMethod.GET)
    <span class="hl-keyword">public</span> String setupForm(@RequestParam(<span class="hl-string">"petId"</span>) <span class="hl-keyword">int</span> petId, ModelMap model) {
        Pet pet = <span class="hl-keyword">this</span>.clinic.loadPet(petId);
        model.addAttribute(<span class="hl-string">"pet"</span>, pet);
        <span class="hl-keyword">return</span> <span class="hl-string">"petForm"</span>;
    }

    <span class="hl-comment">// ...</span></pre><p>Parameters using this annotation are required by default, but
        you can specify that a parameter is optional by setting
        <code class="interfacename">@RequestParam</code>'s
        <code class="literal">required</code> attribute to <code class="literal">false</code>
        (e.g., <code class="literal">@RequestParam(value="id",
        required=false)</code>).</p><p>Type conversion is applied automatically if the target method
        parameter type is not <code class="classname">String</code>. See <a class="xref" href="#mvc-ann-typeconversion" title="16.3.3.14&nbsp;Method Parameters And Type Conversion">Section&nbsp;16.3.3.14, &#8220;Method Parameters And Type Conversion&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestbody"></a>16.3.3.4&nbsp;Mapping the request body with the @RequestBody
        annotation</h4></div></div></div><p>The <code class="classname">@RequestBody</code> method parameter
        annotation indicates that a method parameter should be bound to the
        value of the HTTP request body. For example:</p><pre class="programlisting">@RequestMapping(value = <span class="hl-string">"/something"</span>, method = RequestMethod.PUT)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> handle(@RequestBody String body, Writer writer) <span class="hl-keyword">throws</span> IOException {
  writer.write(body);
}</pre><p>You convert the request body to the method argument by using an
        <code class="interfacename">HttpMessageConverter</code>.
        <code class="interfacename">HttpMessageConverter</code> is responsible for
        converting from the HTTP request message to an object and converting
        from an object to the HTTP response body. The
        <code class="classname">RequestMappingHandlerAdapter</code> supports the
        <code class="classname">@RequestBody</code> annotation with the following
        default <code class="interfacename">HttpMessageConverters</code>:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">ByteArrayHttpMessageConverter</code>
            converts byte arrays.</p></li><li><p><code class="classname">StringHttpMessageConverter</code> converts
            strings.</p></li><li><p><code class="classname">FormHttpMessageConverter</code> converts
            form data to/from a MultiValueMap&lt;String, String&gt;.</p></li><li><p><code class="classname">SourceHttpMessageConverter</code> converts
            to/from a javax.xml.transform.Source.</p></li></ul></div><p>For more information on these converters, see <a class="link" href="#rest-message-conversion" title="20.9.2&nbsp;HTTP Message Conversion">Message Converters</a>. Also note
        that if using the MVC namespace, a wider range of message converters
        are registered by default. See <a class="xref" href="#">???</a> for more information.</p><p>If you intend to read and write XML, you will need to configure
        the <code class="classname">MarshallingHttpMessageConverter</code> with a
        specific <code class="interfacename">Marshaller</code> and an
        <code class="interfacename">Unmarshaller</code> implementation from the
        <code class="classname">org.springframework.oxm</code> package. For
        example:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messageConverters"</span>&gt;
      &lt;<span class="hl-tag">util:list</span> <span class="hl-attribute">id</span>=<span class="hl-value">"beanList"</span>&gt;
        &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"stringHttpMessageConverter"</span>/&gt;
        &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"marshallingHttpMessageConverter"</span>/&gt;
      &lt;<span class="hl-tag">/util:list</span>&gt;
    &lt;<span class="hl-tag">/property
&lt;/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"stringHttpMessageConverter"</span> 
       <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.http.converter.StringHttpMessageConverter"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"marshallingHttpMessageConverter"</span> 
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.http.converter.xml.MarshallingHttpMessageConverter"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"marshaller"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"castorMarshaller"</span> /&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"unmarshaller"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"castorMarshaller"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"castorMarshaller"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.oxm.castor.CastorMarshaller"</span>/&gt;</pre><p>An <code class="classname">@RequestBody</code> method parameter can be
        annotated with <code class="classname">@Valid</code>, in which case it will be
        validated using the configured <code class="classname">Validator</code>
        instance. When using the MVC namespace a JSR-303 validator is
        configured automatically assuming a JSR-303 implementation is
        available on the classpath.</p><p>Unlike <code class="classname">@ModelAttribute</code> parameters, for which
        a <code class="classname">BindingResult</code> can be used to examine the errors,
        <code class="classname">@RequestBody</code> validation errors always result in a
        <code class="classname">MethodArgumentNotValidException</code> being raised.
        The exception is handled in the
        <code class="classname">DefaultHandlerExceptionResolver</code>, which sends
        a <code class="literal">400</code> error back to the client.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Also see <a class="xref" href="#">???</a> for
          information on configuring message converters and a validator
          through the MVC namespace.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-responsebody"></a>16.3.3.5&nbsp;Mapping the response body with the
        <code class="interfacename">@ResponseBody</code> annotation</h4></div></div></div><p>The <code class="interfacename">@ResponseBody</code> annotation is
        similar to <code class="interfacename">@RequestBody</code>. This
        annotation can be put on a method and indicates that the return type
        should be written straight to the HTTP response body (and not placed
        in a Model, or interpreted as a view name). For example:</p><pre class="programlisting">@RequestMapping(value = <span class="hl-string">"/something"</span>, method = RequestMethod.PUT)
@ResponseBody
<span class="hl-keyword">public</span> String helloWorld()  {
  <span class="hl-keyword">return</span> <span class="hl-string">"Hello World"</span>;
}</pre><p>The above example will result in the text <code class="literal">Hello
        World</code> being written to the HTTP response stream.</p><p>As with <code class="interfacename">@RequestBody</code>, Spring
        converts the returned object to a response body by using an
        <code class="interfacename">HttpMessageConverter</code>. For more
        information on these converters, see the previous section and <a class="link" href="#rest-message-conversion" title="20.9.2&nbsp;HTTP Message Conversion">Message Converters</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-httpentity"></a>16.3.3.6&nbsp;Using <code class="classname">HttpEntity&lt;?&gt;</code></h4></div></div></div><p>The <code class="classname">HttpEntity</code> is similar to
        <code class="interfacename">@RequestBody</code> and
        <code class="interfacename">@ResponseBody</code>. Besides getting access
        to the request and response body, <code class="classname">HttpEntity</code>
        (and the response-specific subclass
        <code class="classname">ResponseEntity</code>) also allows access to the
        request and response headers, like so:</p><pre class="programlisting">@RequestMapping(<span class="hl-string">"/something"</span>)
<span class="hl-keyword">public</span> ResponseEntity&lt;String&gt; handle(HttpEntity&lt;<span class="hl-keyword">byte</span>[]&gt; requestEntity) <span class="hl-keyword">throws</span> UnsupportedEncodingException {
  String requestHeader = requestEntity.getHeaders().getFirst(<span class="hl-string">"MyRequestHeader"</span>));
  <span class="hl-keyword">byte</span>[] requestBody = requestEntity.getBody();
  <span class="hl-comment">// do something with request header and body</span>

  HttpHeaders responseHeaders = <span class="hl-keyword">new</span> HttpHeaders();
  responseHeaders.set(<span class="hl-string">"MyResponseHeader"</span>, <span class="hl-string">"MyValue"</span>);
  <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ResponseEntity&lt;String&gt;(<span class="hl-string">"Hello World"</span>, responseHeaders, HttpStatus.CREATED);
}</pre><p>The above example gets the value of the
        <code class="literal">MyRequestHeader</code> request header, and reads the body
        as a byte array. It adds the <code class="literal">MyResponseHeader</code> to
        the response, writes <code class="literal">Hello World</code> to the response
        stream, and sets the response status code to 201 (Created).</p><p>As with <code class="interfacename">@RequestBody</code> and
        <code class="interfacename">@ResponseBody</code>, Spring uses
        <code class="interfacename">HttpMessageConverter</code> to convert from
        and to the request and response streams. For more information on these
        converters, see the previous section and <a class="link" href="#rest-message-conversion" title="20.9.2&nbsp;HTTP Message Conversion">Message Converters</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-modelattrib-methods"></a>16.3.3.7&nbsp;Using <code class="interfacename">@ModelAttribute</code> on a
        method</h4></div></div></div><p>The <code class="interfacename">@ModelAttribute</code> annotation
        can be used on methods or on method arguments. This section explains
        its usage on methods while the next section explains its usage on
        method arguments.</p><p>An <code class="interfacename">@ModelAttribute</code> on a method
        indicates the purpose of that method is to add one or more model
        attributes. Such methods support the same argument types as
        <code class="interfacename">@RequestMapping</code> methods but cannot be
        mapped directly to requests. Instead
        <code class="interfacename">@ModelAttribute</code> methods in a controller
        are invoked before <code class="interfacename">@RequestMapping</code>
        methods, within the same controller. A couple of examples:</p><pre class="programlisting">
<span class="hl-comment">// Add one attribute</span>
<span class="hl-comment">// The return value of the method is added to the model under the name "account"</span>
<span class="hl-comment">// You can customize the name via @ModelAttribute("myAccount")</span>

@ModelAttribute
<span class="hl-keyword">public</span> Account addAccount(@RequestParam String number) {
    <span class="hl-keyword">return</span> accountManager.findAccount(number);
}

<span class="hl-comment">// Add multiple attributes</span>

@ModelAttribute
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> populateModel(@RequestParam String number, Model model) {
    model.addAttribute(accountManager.findAccount(number));
    <span class="hl-comment">// add more ...</span>
}</pre><p><code class="interfacename">@ModelAttribute</code> methods are used
        to populate the model with commonly needed attributes for example to
        fill a drop-down with states or with pet types, or to retrieve a
        command object like Account in order to use it to represent the data
        on an HTML form. The latter case is further discussed in the next
        section.</p><p>Note the two styles of
        <code class="interfacename">@ModelAttribute</code> methods. In the first,
        the method adds an attribute implicitly by returning it. In the
        second, the method accepts a <code class="classname">Model</code> and adds any
        number of model attributes to it. You can choose between the two
        styles depending on your needs.</p><p>A controller can have any number of
        <code class="interfacename">@ModelAttribute</code> methods. All such
        methods are invoked before
        <code class="interfacename">@RequestMapping</code> methods of the same
        controller.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>What happens when a model attribute name is not explicitly
          specified? In such cases a default name is assigned to the model
          attribute based on its type. For example if the method returns an
          object of type <code class="classname">Account</code>, the default name used
          is "account". You can change that through the value of the
          <code class="interfacename">@ModelAttribute</code> annotation. If adding
          attributes directly to the <code class="classname">Model</code>, use the
          appropriate overloaded <code class="literal">addAttribute(..)</code> method -
          i.e., with or without an attribute name.</p></td></tr></table></div><p>The <code class="interfacename">@ModelAttribute</code> annotation
        can be used on <code class="interfacename">@RequestMapping</code> methods
        as well. In that case the return value of the
        <code class="interfacename">@RequestMapping</code> method is interpreted
        as a model attribute rather than as a view name. The view name is
        derived from view name conventions instead much like for methods
        returning void &#8212; see <a class="xref" href="#mvc-coc-r2vnt" title="16.12.3&nbsp;The View - RequestToViewNameTranslator">Section&nbsp;16.12.3, &#8220;The View -
      RequestToViewNameTranslator&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-modelattrib-method-args"></a>16.3.3.8&nbsp;Using <code class="interfacename">@ModelAttribute</code> on a
        method argument</h4></div></div></div><p>As explained in the previous section
        <code class="interfacename">@ModelAttribute</code> can be used on methods
        or on method arguments. This section explains its usage on method
        arguments.</p><p>An <code class="interfacename">@ModelAttribute</code> on a method
        argument indicates the argument should be retrieved from the model. If
        not present in the model, the argument should be instantiated first
        and then added to the model. Once present in the model, the argument's
        fields should be populated from all request parameters that have
        matching names. This is known as data binding in Spring MVC, a very
        useful mechanism that saves you from having to parse each form field
        individually.</p><pre class="programlisting">
@RequestMapping(value=<span class="hl-string">"/owners/{ownerId}/pets/{petId}/edit"</span>, method = RequestMethod.POST)
<span class="hl-keyword">public</span> String processSubmit(@ModelAttribute Pet pet) {
   
}</pre><p>Given the above example where can the Pet instance come from?
        There are several options:</p><div class="itemizedlist"><ul type="disc"><li><p>It may already be in the model due to use of
            <code class="interfacename">@SessionAttributes</code> &#8212; see <a class="xref" href="#mvc-ann-sessionattrib" title="16.3.3.9&nbsp;Using @SessionAttributes to store model attributes in the HTTP session between requests">Section&nbsp;16.3.3.9, &#8220;Using @SessionAttributes to store model
        attributes in the HTTP session between requests&#8221;</a>.</p></li><li><p>It may already be in the model due to an
            <code class="interfacename">@ModelAttribute</code> method in the same
            controller &#8212; as explained in the previous section.</p></li><li><p>It may be retrieved based on a URI template variable and
            type converter (explained in more detail below).</p></li><li><p>It may be instantiated using its default constructor.</p></li></ul></div><p>An <code class="interfacename">@ModelAttribute</code> method is a
        common way to to retrieve an attribute from the database, which may
        optionally be stored between requests through the use of
        <code class="interfacename">@SessionAttributes</code>. In some cases it
        may be convenient to retrieve the attribute by using an URI template
        variable and a type converter. Here is an example:</p><pre class="programlisting">
@RequestMapping(value=<span class="hl-string">"/accounts/{account}"</span>, method = RequestMethod.PUT)
<span class="hl-keyword">public</span> String save(@ModelAttribute(<span class="hl-string">"account"</span>) Account account) {

}</pre><p>In this example the name of the model attribute (i.e. "account")
        matches the name of a URI template variable. If you register
        <code class="classname">Converter&lt;String, Account&gt;</code> that can turn
        the <code class="literal">String</code> account value into an
        <code class="classname">Account</code> instance, then the above example will
        work without the need for an
        <code class="interfacename">@ModelAttribute</code> method.</p><p>The next step is data binding. The
        <code class="classname">WebDataBinder</code> class matches request parameter
        names &#8212; including query string parameters and form fields &#8212; to model
        attribute fields by name. Matching fields are populated after type
        conversion (from String to the target field type) has been applied
        where necessary. Data binding and validation are covered in <a class="xref" href="#validation" title="6.&nbsp;Validation, Data Binding, and Type Conversion">Chapter&nbsp;6, <i>Validation, Data Binding, and Type Conversion</i></a>. Customizing the data binding process for a
        controller level is covered in <a class="xref" href="#mvc-ann-webdatabinder" title="16.3.3.15&nbsp;Customizing WebDataBinder initialization">Section&nbsp;16.3.3.15, &#8220;Customizing WebDataBinder
        initialization&#8221;</a>.</p><p>As a result of data binding there may be errors such as missing
        required fields or type conversion errors. To check for such errors
        add a <code class="classname">BindingResult</code> argument immediately
        following the <code class="interfacename">@ModelAttribute</code>
        argument:</p><pre class="programlisting">
@RequestMapping(value=<span class="hl-string">"/owners/{ownerId}/pets/{petId}/edit"</span>, method = RequestMethod.POST)
<span class="hl-keyword">public</span> String processSubmit(@ModelAttribute(<span class="hl-string">"pet"</span>) Pet pet, BindingResult result) {
        
    <span class="hl-keyword">if</span> (result.hasErrors()) {
        <span class="hl-keyword">return</span> <span class="hl-string">"petForm"</span>;
    } 
    
    <span class="hl-comment">// ...       </span>

}</pre><p>With a <code class="classname">BindingResult</code> you can check if
        errors were found in which case it's common to render the same form
        where the errors can be shown with the help of Spring's
        <code class="literal">&lt;errors&gt;</code> form tag.</p><p>In addition to data binding you can also invoke validation using
        your own custom validator passing the same
        <code class="classname">BindingResult</code> that was used to record data
        binding errors. That allows for data binding and validation errors to
        be accumulated in one place and subsequently reported back to the
        user:</p><pre class="programlisting">
@RequestMapping(value=<span class="hl-string">"/owners/{ownerId}/pets/{petId}/edit"</span>, method = RequestMethod.POST)
<span class="hl-keyword">public</span> String processSubmit(@ModelAttribute(<span class="hl-string">"pet"</span>) Pet pet, BindingResult result) {

    <span class="hl-keyword">new</span> PetValidator().validate(pet, result);
    <span class="hl-keyword">if</span> (result.hasErrors()) {
        <span class="hl-keyword">return</span> <span class="hl-string">"petForm"</span>;
    }
    
    <span class="hl-comment">// ...</span>
}</pre><p>Or you can have validation invoked automatically by adding the
        JSR-303 <code class="interfacename">@Valid</code> annotation:</p><pre class="programlisting">
@RequestMapping(value=<span class="hl-string">"/owners/{ownerId}/pets/{petId}/edit"</span>, method = RequestMethod.POST)
<span class="hl-keyword">public</span> String processSubmit(@Valid @ModelAttribute(<span class="hl-string">"pet"</span>) Pet pet, BindingResult result) {

    <span class="hl-keyword">if</span> (result.hasErrors()) {
        <span class="hl-keyword">return</span> <span class="hl-string">"petForm"</span>;
    }
    
    <span class="hl-comment">// ...</span>
}</pre><p>See <a class="xref" href="#validation-beanvalidation" title="6.7&nbsp;Spring 3 Validation">Section&nbsp;6.7, &#8220;Spring 3 Validation&#8221;</a> and <a class="xref" href="#validation" title="6.&nbsp;Validation, Data Binding, and Type Conversion">Chapter&nbsp;6, <i>Validation, Data Binding, and Type Conversion</i></a> for details on how to configure and use
        validation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-sessionattrib"></a>16.3.3.9&nbsp;Using <code class="classname">@SessionAttributes</code> to store model
        attributes in the HTTP session between requests</h4></div></div></div><p>The type-level <code class="classname">@SessionAttributes</code>
        annotation declares session attributes used by a specific handler.
        This will typically list the names of model attributes or types of
        model attributes which should be transparently stored in the session
        or some conversational storage, serving as form-backing beans between
        subsequent requests.</p><p>The following code snippet shows the usage of this annotation,
        specifying the model attribute name:</p><pre class="programlisting">@Controller
@RequestMapping(<span class="hl-string">"/editPet.do"</span>)
@SessionAttributes(<span class="hl-string">"pet"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> EditPetForm {
    <span class="hl-comment">// ...</span>
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>When using controller interfaces (e.g., for AOP proxying),
          make sure to consistently put <span class="emphasis"><em>all</em></span> your mapping
          annotations - such as <code class="interfacename">@RequestMapping</code>
          and <code class="interfacename">@SessionAttributes</code> - on the
          controller <span class="emphasis"><em>interface</em></span> rather than on the
          implementation class.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-redirect-attributes"></a>16.3.3.10&nbsp;Specifying redirect and flash attributes</h4></div></div></div><p>By default all model attributes are considered to be exposed as
        URI template variables in the redirect URL. Of the remaining
        attributes those that are primitive types or collections/arrays of
        primitive types are automatically appended as query parameters.</p><p>In annotated controllers however the model may contain
        additional attributes originally added for rendering purposes (e.g.
        drop-down field values). To gain precise control over the attributes
        used in a redirect scenario, an
        <code class="interfacename">@RequestMapping</code> method can declare an
        argument of type <code class="interfacename">RedirectAttributes</code> and
        use it to add attributes for use in
        <code class="classname">RedirectView</code>. If the controller method does
        redirect, the content of
        <code class="interfacename">RedirectAttributes</code> is used. Otherwise
        the content of the default <code class="interfacename">Model</code> is
        used.</p><p>The <code class="classname">RequestMappingHandlerAdapter</code> provides
        a flag called <code class="literal">"ignoreDefaultModelOnRedirect"</code> that
        can be used to indicate the content of the default
        <code class="interfacename">Model</code> should never be used if a
        controller method redirects. Instead the controller method should
        declare an attribute of type
        <code class="interfacename">RedirectAttributes</code> or if it doesn't do
        so no attributes should be passed on to
        <code class="classname">RedirectView</code>. Both the MVC namespace and the
        MVC Java config (via <code class="interfacename">@EnableWebMvc</code>)
        keep this flag set to <code class="literal">false</code> in order to maintain
        backwards compatibility. However, for new applications we recommend
        setting it to <code class="literal">true</code></p><p>The <code class="interfacename">RedirectAttributes</code> interface
        can also be used to add flash attributes. Unlike other redirect
        attributes, which end up in the target redirect URL, flash attributes
        are saved in the HTTP session (and hence do not appear in the URL).
        The model of the controller serving the target redirect URL
        automatically receives these flash attributes after which they are
        removed from the session. See <a class="xref" href="#mvc-flash-attributes" title="16.6&nbsp;Using flash attributes">Section&nbsp;16.6, &#8220;Using flash attributes&#8221;</a>
        for an overview of the general support for flash attributes in Spring
        MVC.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-form-urlencoded-data"></a>16.3.3.11&nbsp;Working with
        <code class="literal">"application/x-www-form-urlencoded"</code> data</h4></div></div></div><p>The previous sections covered use of
        <code class="interfacename">@ModelAttribute</code> to support form
        submission requests from browser clients. The same annotation is
        recommended for use with requests from non-browser clients as well.
        However there is one notable difference when it comes to working with
        HTTP PUT requests. Browsers can submit form data via HTTP GET or HTTP
        POST. Non-browser clients can also submit forms via HTTP PUT. This
        presents a challenge because the Servlet specification requires the
        <code class="literal">ServletRequest.getParameter*()</code> family of methods to
        support form field access only for HTTP POST, not for HTTP PUT.</p><p>To support HTTP PUT requests, the <code class="literal">spring-web</code>
        module provides the filter
        <code class="classname">HttpPutFormContentFilter</code>, which can be
        configured in <code class="filename">web.xml</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">filter</span>&gt;
  &lt;<span class="hl-tag">filter-name</span>&gt;httpPutFormFilter&lt;<span class="hl-tag">/filter-name</span>&gt;
  &lt;<span class="hl-tag">filter-class</span>&gt;org.springframework.web.filter.HttpPutFormContentFilter&lt;<span class="hl-tag">/filter-class</span>&gt;
&lt;<span class="hl-tag">/filter</span>&gt;

&lt;<span class="hl-tag">filter-mapping</span>&gt;
  &lt;<span class="hl-tag">filter-name</span>&gt;httpPutFormFilter&lt;<span class="hl-tag">/filter-name</span>&gt;
  &lt;<span class="hl-tag">servlet-name</span>&gt;dispatcherServlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
&lt;<span class="hl-tag">/filter-mapping</span>&gt;

&lt;<span class="hl-tag">servlet</span>&gt;
  &lt;<span class="hl-tag">servlet-name</span>&gt;dispatcherServlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
  &lt;<span class="hl-tag">servlet-class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
&lt;<span class="hl-tag">/servlet</span>&gt;</pre><p>The above filter intercepts HTTP PUT requests with content type
        <code class="literal">application/x-www-form-urlencoded</code>, reads the form
        data from the body of the request, and wraps the
        <code class="classname">ServletRequest</code> in order to make the form data
        available through the
        <code class="literal">ServletRequest.getParameter*()</code> family of
        methods.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-cookievalue"></a>16.3.3.12&nbsp;Mapping cookie values with the @CookieValue annotation</h4></div></div></div><p>The <code class="interfacename">@CookieValue</code> annotation
        allows a method parameter to be bound to the value of an HTTP
        cookie.</p><p>Let us consider that the following cookie has been received with
        an http request:</p><pre class="programlisting">JSESSIONID=415A4AC178C59DACE0B2C9CA727CDD84</pre><p>The following code sample demonstrates how to get the value of
        the <code class="literal">JSESSIONID</code> cookie:</p><pre class="programlisting">@RequestMapping(<span class="hl-string">"/displayHeaderInfo.do"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> displayHeaderInfo(@CookieValue(<span class="hl-string">"JSESSIONID"</span>) String cookie)  {

  <span class="hl-comment">//...</span>

}</pre><p>Type conversion is applied automatically if the target method
        parameter type is not <code class="classname">String</code>. See <a class="xref" href="#mvc-ann-typeconversion" title="16.3.3.14&nbsp;Method Parameters And Type Conversion">Section&nbsp;16.3.3.14, &#8220;Method Parameters And Type Conversion&#8221;</a>.</p><p>This annotation is supported for annotated handler methods in
        Servlet and Portlet environments.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestheader"></a>16.3.3.13&nbsp;Mapping request header attributes with the @RequestHeader
        annotation</h4></div></div></div><p>The <code class="interfacename">@RequestHeader</code> annotation
        allows a method parameter to be bound to a request header.</p><p>Here is a sample request header:</p><pre class="programlisting">
Host                    localhost:8080
Accept                  text/html,application/xhtml+xml,application/xml;q=0.9
Accept-Language         fr,en-gb;q=0.7,en;q=0.3
Accept-Encoding         gzip,deflate
Accept-Charset          ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive              300</pre><p>The following code sample demonstrates how to get the value of
        the <code class="literal">Accept-Encoding</code> and
        <code class="literal">Keep-Alive</code> headers:</p><pre class="programlisting">@RequestMapping(<span class="hl-string">"/displayHeaderInfo.do"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> displayHeaderInfo(@RequestHeader(<span class="hl-string">"Accept-Encoding"</span>) String encoding,
                              @RequestHeader(<span class="hl-string">"Keep-Alive"</span>) <span class="hl-keyword">long</span> keepAlive)  {

  <span class="hl-comment">//...</span>

}</pre><p>Type conversion is applied automatically if the method parameter
        is not <code class="classname">String</code>. See <a class="xref" href="#mvc-ann-typeconversion" title="16.3.3.14&nbsp;Method Parameters And Type Conversion">Section&nbsp;16.3.3.14, &#8220;Method Parameters And Type Conversion&#8221;</a>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Built-in support is available for converting a comma-separated
          string into an array/collection of strings or other types known to
          the type conversion system. For example a method parameter annotated
          with <code class="literal">@RequestHeader("Accept")</code> may be of type
          <code class="classname">String</code> but also
          <code class="classname">String[]</code> or
          <code class="classname">List&lt;String&gt;</code>.</p></td></tr></table></div><p>This annotation is supported for annotated handler methods in
        Servlet and Portlet environments.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-typeconversion"></a>16.3.3.14&nbsp;Method Parameters And Type Conversion</h4></div></div></div><p>String-based values extracted from the request including request
        parameters, path variables, request headers, and cookie values may
        need to be converted to the target type of the method parameter or
        field (e.g., binding a request parameter to a field in an
        <code class="interfacename">@ModelAttribute</code> parameter) they're
        bound to. If the target type is not <code class="classname">String</code>,
        Spring automatically converts to the appropriate type. All simple
        types such as int, long, Date, etc. are supported. You can further
        customize the conversion process through a
        <code class="classname">WebDataBinder</code> (see <a class="xref" href="#mvc-ann-webdatabinder" title="16.3.3.15&nbsp;Customizing WebDataBinder initialization">Section&nbsp;16.3.3.15, &#8220;Customizing WebDataBinder
        initialization&#8221;</a>) or by registering
        <code class="classname">Formatters</code> with the
        <code class="classname">FormattingConversionService</code> (see <a class="xref" href="#format" title="6.6&nbsp;Spring 3 Field Formatting">Section&nbsp;6.6, &#8220;Spring 3 Field Formatting&#8221;</a>).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-webdatabinder"></a>16.3.3.15&nbsp;Customizing <code class="classname">WebDataBinder</code>
        initialization</h4></div></div></div><p>To customize request parameter binding with PropertyEditors
        through Spring's <code class="classname">WebDataBinder</code>, you can use
        either <code class="interfacename">@InitBinder</code>-annotated methods
        within your controller or externalize your configuration by providing
        a custom <code class="interfacename">WebBindingInitializer</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="mvc-ann-initbinder"></a>Customizing data binding with
          <code class="interfacename">@InitBinder</code></h5></div></div></div><p>Annotating controller methods with
          <code class="interfacename">@InitBinder</code> allows you to configure
          web data binding directly within your controller class.
          <code class="interfacename">@InitBinder</code> identifies methods that
          initialize the <code class="classname">WebDataBinder</code> that will be
          used to populate command and form object arguments of annotated
          handler methods.</p><p>Such init-binder methods support all arguments that
          <code class="interfacename">@RequestMapping</code> supports, except for
          command/form objects and corresponding validation result objects.
          Init-binder methods must not have a return value. Thus, they are
          usually declared as <code class="literal">void</code>. Typical arguments
          include <code class="classname">WebDataBinder</code> in combination with
          <code class="interfacename">WebRequest</code> or
          <code class="classname">java.util.Locale</code>, allowing code to register
          context-specific editors.</p><p>The following example demonstrates the use of
          <code class="interfacename">@InitBinder</code> to configure a
          <code class="classname">CustomDateEditor</code> for all
          <code class="classname">java.util.Date</code> form properties.</p><pre class="programlisting">@Controller
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyFormController {

    @InitBinder
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> initBinder(WebDataBinder binder) {
        SimpleDateFormat dateFormat = <span class="hl-keyword">new</span> SimpleDateFormat(<span class="hl-string">"yyyy-MM-dd"</span>);
        dateFormat.setLenient(false);
        binder.registerCustomEditor(Date.<span class="hl-keyword">class</span>, <span class="hl-keyword">new</span> CustomDateEditor(dateFormat, false));
    }

    <span class="hl-comment">// ...</span>
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="mvc-ann-webbindinginitializer"></a>Configuring a custom
          <code class="interfacename">WebBindingInitializer</code></h5></div></div></div><p>To externalize data binding initialization, you can provide a
          custom implementation of the
          <code class="interfacename">WebBindingInitializer</code> interface,
          which you then enable by supplying a custom bean configuration for
          an <code class="classname">AnnotationMethodHandlerAdapter</code>, thus
          overriding the default configuration.</p><p>The following example from the PetClinic application shows a
          configuration using a custom implementation of the
          <code class="interfacename">WebBindingInitializer</code> interface,
          <code class="classname">org.springframework.samples.petclinic.web.ClinicBindingInitializer</code>,
          which configures PropertyEditors required by several of the
          PetClinic controllers.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"cacheSeconds"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"0"</span> /&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"webBindingInitializer"</span>&gt;
        &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.petclinic.web.ClinicBindingInitializer"</span> /&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-lastmodified"></a>16.3.3.16&nbsp;Support for the 'Last-Modified' Response Header To Facilitate
        Content Caching</h4></div></div></div><p>An <code class="interfacename">@RequestMapping</code> method may
        wish to support <code class="literal">'Last-Modified'</code> HTTP requests, as
        defined in the contract for the Servlet API's
        <code class="literal">getLastModified</code> method, to facilitate content
        caching. This involves calculating a lastModified
        <code class="literal">long</code> value for a given request, comparing it
        against the <code class="literal">'If-Modified-Since'</code> request header
        value, and potentially returning a response with status code 304 (Not
        Modified). An annotated controller method can achieve that as
        follows:</p><pre class="programlisting">
@RequestMapping
<span class="hl-keyword">public</span> String myHandleMethod(WebRequest webRequest, Model model) {

    <span class="hl-keyword">long</span> lastModified = <span class="hl-comment">// 1. application-specific calculation</span>

    <span class="hl-keyword">if</span> (request.checkNotModified(lastModified)) {
        <span class="hl-comment">// 2. shortcut exit - no further processing necessary</span>
        <span class="hl-keyword">return</span> null;
     }

    <span class="hl-comment">// 3. or otherwise further request processing, actually preparing content</span>
    model.addAttribute(...);
    <span class="hl-keyword">return</span> <span class="hl-string">"myViewName"</span>;
}</pre><p>There are two key elements to note: calling
        <code class="code">request.checkNotModified(lastModified)</code> and returning
        <code class="literal">null</code>. The former sets the response status to 304
        before it returns <code class="literal">true</code>. The latter, in combination
        with the former, causes Spring MVC to do no further processing of the
        request.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-handlermapping"></a>16.4&nbsp;Handler mappings</h2></div></div></div><p>In previous versions of Spring, users were required to define one or
    more <code class="interfacename">HandlerMapping</code> beans in the web
    application context to map incoming web requests to appropriate handlers.
    With the introduction of annotated controllers, you generally don't need
    to do that because the <code class="classname">RequestMappingHandlerMapping</code>
    automatically looks for <code class="interfacename">@RequestMapping</code>
    annotations on all <code class="interfacename">@Controller</code> beans.
    However, do keep in mind that all <code class="classname">HandlerMapping</code>
    classes extending from <code class="classname">AbstractHandlerMapping</code> have
    the following properties that you can use to customize their
    behavior:</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">interceptors</code></span></dt><dd><p>List of interceptors to use.
          <code class="interfacename">HandlerInterceptor</code>s are discussed in
          <a class="xref" href="#mvc-handlermapping-interceptor" title="16.4.1&nbsp;Intercepting requests with a HandlerInterceptor">Section&nbsp;16.4.1, &#8220;Intercepting requests with a
      HandlerInterceptor&#8221;</a>.</p></dd><dt><span class="term"><code class="literal">defaultHandler</code></span></dt><dd><p>Default handler to use, when this handler mapping does not
          result in a matching handler.</p></dd><dt><span class="term"><code class="literal">order</code></span></dt><dd><p>Based on the value of the order property (see the
          <code class="literal">org.springframework.core.Ordered</code> interface),
          Spring sorts all handler mappings available in the context and
          applies the first matching handler.</p></dd><dt><span class="term"><code class="literal">alwaysUseFullPath</code></span></dt><dd><p>If <code class="literal">true</code> , Spring uses the full path within
          the current Servlet context to find an appropriate handler. If
          <code class="literal">false</code> (the default), the path within the current
          Servlet mapping is used. For example, if a Servlet is mapped using
          <code class="literal">/testing/*</code> and the
          <code class="literal">alwaysUseFullPath</code> property is set to true,
          <code class="literal">/testing/viewPage.html</code> is used, whereas if the
          property is set to false, <code class="literal">/viewPage.html</code> is
          used.</p></dd><dt><span class="term"><code class="literal">urlDecode</code></span></dt><dd><p>Defaults to <code class="literal">true</code>, as of Spring 2.5. If you
          prefer to compare encoded paths, set this flag to
          <code class="literal">false</code>. However, the
          <code class="interfacename">HttpServletRequest</code> always exposes the
          Servlet path in decoded form. Be aware that the Servlet path will
          not match when compared with encoded paths.</p></dd></dl></div><p>The following example shows how to configure an interceptor:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"handlerMapping"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptors"</span>&gt;
      &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.MyInterceptor"</span>/&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">beans</span>&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-handlermapping-interceptor"></a>16.4.1&nbsp;Intercepting requests with a
      <code class="interfacename">HandlerInterceptor</code></h3></div></div></div><p>Spring's handler mapping mechanism includes handler interceptors,
      which are useful when you want to apply specific functionality to
      certain requests, for example, checking for a principal.</p><p>Interceptors located in the handler mapping must implement
      <code class="interfacename">HandlerInterceptor</code> from the
      <code class="literal">org.springframework.web.servlet</code> package. This
      interface defines three methods: <code class="literal">preHandle(..)</code> is
      called <span class="emphasis"><em>before</em></span> the actual handler is executed;
      <code class="literal">postHandle(..)</code> is called <span class="emphasis"><em>after</em></span>
      the handler is executed; and <code class="literal">afterCompletion(..)</code> is
      called <span class="emphasis"><em>after the complete request has finished</em></span>.
      These three methods should provide enough flexibility to do all kinds of
      preprocessing and postprocessing.</p><p>The <code class="literal">preHandle(..)</code> method returns a boolean
      value. You can use this method to break or continue the processing of
      the execution chain. When this method returns <code class="literal">true</code>,
      the handler execution chain will continue; when it returns false, the
      <code class="classname">DispatcherServlet</code> assumes the interceptor itself
      has taken care of requests (and, for example, rendered an appropriate
      view) and does not continue executing the other interceptors and the
      actual handler in the execution chain.</p><p>Interceptors can be configured using the
      <code class="literal">interceptors</code> property, which is present on all
      <code class="classname">HandlerMapping</code> classes extending from
      <code class="classname">AbstractHandlerMapping</code>. This is shown in the
      example below:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"handlerMapping"</span>
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptors"</span>&gt;
            &lt;<span class="hl-tag">list</span>&gt;
                &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"officeHoursInterceptor"</span>/&gt;
            &lt;<span class="hl-tag">/list</span>&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"officeHoursInterceptor"</span>
          <span class="hl-attribute">class</span>=<span class="hl-value">"samples.TimeBasedAccessInterceptor"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"openingTime"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"9"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"closingTime"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"18"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">beans</span>&gt;</pre><pre class="programlisting"><span class="hl-keyword">package</span> samples;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TimeBasedAccessInterceptor <span class="hl-keyword">extends</span> HandlerInterceptorAdapter {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> openingTime;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> closingTime;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setOpeningTime(<span class="hl-keyword">int</span> openingTime) {
        <span class="hl-keyword">this</span>.openingTime = openingTime;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setClosingTime(<span class="hl-keyword">int</span> closingTime) {
        <span class="hl-keyword">this</span>.closingTime = closingTime;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> preHandle(
            HttpServletRequest request,
            HttpServletResponse response,
            Object handler) <span class="hl-keyword">throws</span> Exception {

        Calendar cal = Calendar.getInstance();
        <span class="hl-keyword">int</span> hour = cal.get(HOUR_OF_DAY);
        <span class="hl-keyword">if</span> (openingTime &lt;= hour &amp;&amp; hour &lt; closingTime) {
            <span class="hl-keyword">return</span> true;
        } <span class="hl-keyword">else</span> {
            response.sendRedirect(<span class="hl-string">"http://host.com/outsideOfficeHours.html"</span>);
            <span class="hl-keyword">return</span> false;
        }
    }
}</pre><p>Any request handled by this mapping is intercepted by the
      <code class="classname">TimeBasedAccessInterceptor</code>. If the current time
      is outside office hours, the user is redirected to a static HTML file
      that says, for example, you can only access the website during office
      hours.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>When using the
        <code class="classname">RequestMappingHandlerMapping</code> the actual handler
        is an instance of <code class="classname">HandlerMethod</code> which
        identifies the specific controller method that will be invoked.</p></td></tr></table></div><p>As you can see, the Spring adapter class
      <code class="classname">HandlerInterceptorAdapter</code> makes it easier to
      extend the <code class="interfacename">HandlerInterceptor</code>
      interface.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>In the example above, the configured interceptor will apply to
        all requests handled with annotated controller methods. If you want to
        narrow down the URL paths to which an interceptor applies, you can use
        the MVC namespace to do that. See <a class="xref" href="#">???</a>.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-viewresolver"></a>16.5&nbsp;Resolving views</h2></div></div></div><p>All MVC frameworks for web applications provide a way to address
    views. Spring provides view resolvers, which enable you to render models
    in a browser without tying you to a specific view technology. Out of the
    box, Spring enables you to use JSPs, Velocity templates and XSLT views,
    for example. See <a class="xref" href="#view" title="17.&nbsp;View technologies">Chapter&nbsp;17, <i>View technologies</i></a> for a discussion of how to
    integrate and use a number of disparate view technologies.</p><p>The two interfaces that are important to the way Spring handles
    views are <code class="interfacename">ViewResolver</code> and
    <code class="interfacename">View</code>. The
    <code class="interfacename">ViewResolver</code> provides a mapping between
    view names and actual views. The <code class="interfacename">View</code>
    interface addresses the preparation of the request and hands the request
    over to one of the view technologies.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-viewresolver-resolver"></a>16.5.1&nbsp;Resolving views with the
      <code class="interfacename">ViewResolver</code> interface</h3></div></div></div><p>As discussed in <a class="xref" href="#mvc-controller" title="16.3&nbsp;Implementing Controllers">Section&nbsp;16.3, &#8220;Implementing Controllers&#8221;</a>, all handler
      methods in the Spring Web MVC controllers must resolve to a logical view
      name, either explicitly (e.g., by returning a <code class="literal">String</code>,
      <code class="literal">View</code>, or <code class="literal">ModelAndView</code>) or
      implicitly (i.e., based on conventions). Views in Spring are addressed
      by a logical view name and are resolved by a view resolver. Spring comes
      with quite a few view resolvers. This table lists most of them; a couple
      of examples follow.</p><div class="table"><a name="mvc-view-resolvers-tbl"></a><p class="title"><b>Table&nbsp;16.3.&nbsp;View resolvers</b></p><div class="table-contents"><table summary="View resolvers" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="interfacename">ViewResolver</code></th><th style="border-bottom: 1.0pt solid ; ">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">AbstractCachingViewResolver</code></td><td style="border-bottom: 1.0pt solid ; ">Abstract view resolver that caches views. Often views
              need preparation before they can be used; extending this view
              resolver provides caching.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">XmlViewResolver</code></td><td style="border-bottom: 1.0pt solid ; ">Implementation of
              <code class="interfacename">ViewResolver</code> that accepts a
              configuration file written in XML with the same DTD as Spring's
              XML bean factories. The default configuration file is
              <code class="literal">/WEB-INF/views.xml</code>.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">ResourceBundleViewResolver</code></td><td style="border-bottom: 1.0pt solid ; ">Implementation of
              <code class="interfacename">ViewResolver</code> that uses bean
              definitions in a <code class="classname">ResourceBundle</code>,
              specified by the bundle base name. Typically you define the
              bundle in a properties file, located in the classpath. The
              default file name is
              <code class="literal">views.properties</code>.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">UrlBasedViewResolver</code></td><td style="border-bottom: 1.0pt solid ; ">Simple implementation of the
              <code class="interfacename">ViewResolver</code> interface that
              effects the direct resolution of logical view names to URLs,
              without an explicit mapping definition. This is appropriate if
              your logical names match the names of your view resources in a
              straightforward manner, without the need for arbitrary
              mappings.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">InternalResourceViewResolver</code></td><td style="border-bottom: 1.0pt solid ; ">Convenient subclass of
              <code class="classname">UrlBasedViewResolver</code> that supports
              <code class="classname">InternalResourceView</code> (in effect, Servlets
              and JSPs) and subclasses such as <code class="classname">JstlView</code>
              and <code class="classname">TilesView</code>. You can specify the view
              class for all views generated by this resolver by using
              <code class="literal">setViewClass(..)</code>. See the Javadocs for the
              <code class="classname">UrlBasedViewResolver</code> class for
              details.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">VelocityViewResolver</code> /
              <code class="classname">FreeMarkerViewResolver</code></td><td style="border-bottom: 1.0pt solid ; ">Convenient subclass of
              <code class="classname">UrlBasedViewResolver</code> that supports
              <code class="classname">VelocityView</code> (in effect, Velocity
              templates) or <code class="classname">FreeMarkerView</code>
              ,respectively, and custom subclasses of them.</td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="classname">ContentNegotiatingViewResolver</code></td><td style="">Implementation of the
              <code class="interfacename">ViewResolver</code> interface that
              resolves a view based on the request file name or
              <code class="literal">Accept</code> header. See <a class="xref" href="#mvc-multiple-representations" title="16.5.4&nbsp;ContentNegotiatingViewResolver">Section&nbsp;16.5.4, &#8220;ContentNegotiatingViewResolver&#8221;</a>.</td></tr></tbody></table></div></div><br class="table-break"><p>As an example, with JSP as a view technology, you can use the
      <code class="classname">UrlBasedViewResolver</code>. This view resolver
      translates a view name to a URL and hands the request over to the
      RequestDispatcher to render the view.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewResolver"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.UrlBasedViewResolver"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewClass"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.web.servlet.view.JstlView"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"prefix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/jsp/"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"suffix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">".jsp"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>When returning <code class="literal">test</code> as a logical view name,
      this view resolver forwards the request to the
      <code class="classname">RequestDispatcher</code> that will send the request to
      <code class="literal">/WEB-INF/jsp/test.jsp</code>.</p><p>When you combine different view technologies in a web application,
      you can use the
      <code class="classname">ResourceBundleViewResolver</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewResolver"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.ResourceBundleViewResolver"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"basename"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"views"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"defaultParentView"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"parentView"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The <code class="classname">ResourceBundleViewResolver</code> inspects the
      <code class="classname">ResourceBundle</code> identified by the basename, and
      for each view it is supposed to resolve, it uses the value of the
      property <code class="literal">[viewname].(class)</code> as the view class and the
      value of the property <code class="literal">[viewname].url</code> as the view url.
      Examples can be found in the next chapter which covers view
      technologies. As you can see, you can identify a parent view, from which
      all views in the properties file &#8220;<span class="quote">extend</span>&#8221;. This way you can
      specify a default view class, for example.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Subclasses of <code class="classname">AbstractCachingViewResolver</code>
        cache view instances that they resolve. Caching improves performance
        of certain view technologies. It's possible to turn off the cache by
        setting the <code class="literal">cache</code> property to
        <code class="literal">false</code>. Furthermore, if you must refresh a certain
        view at runtime (for example when a Velocity template is modified),
        you can use the <code class="literal">removeFromCache(String viewName, Locale
        loc)</code> method.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-viewresolver-chaining"></a>16.5.2&nbsp;Chaining ViewResolvers</h3></div></div></div><p>Spring supports multiple view resolvers. Thus you can chain
      resolvers and, for example, override specific views in certain
      circumstances. You chain view resolvers by adding more than one resolver
      to your application context and, if necessary, by setting the
      <code class="literal">order</code> property to specify ordering. Remember, the
      higher the order property, the later the view resolver is positioned in
      the chain.</p><p>In the following example, the chain of view resolvers consists of
      two resolvers, an <code class="classname">InternalResourceViewResolver</code>,
      which is always automatically positioned as the last resolver in the
      chain, and an <code class="classname">XmlViewResolver</code> for specifying
      Excel views. Excel views are not supported by the
      <code class="classname">InternalResourceViewResolver</code>.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jspViewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewClass"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.web.servlet.view.JstlView"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"prefix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/jsp/"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"suffix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">".jsp"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"excelViewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.XmlViewResolver"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"order"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"location"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/views.xml"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-comment">!-- in views.xml --</span>&gt;

&lt;<span class="hl-tag">beans</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"report"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.example.ReportExcelView"</span>/&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>If a specific view resolver does not result in a view, Spring
      examines the context for other view resolvers. If additional view
      resolvers exist, Spring continues to inspect them until a view is
      resolved. If no view resolver returns a view, Spring throws a
      <code class="classname">ServletException</code>.</p><p>The contract of a view resolver specifies that a view resolver
      <span class="emphasis"><em>can</em></span> return null to indicate the view could not be
      found. Not all view resolvers do this, however, because in some cases,
      the resolver simply cannot detect whether or not the view exists. For
      example, the <code class="classname">InternalResourceViewResolver</code> uses
      the <code class="classname">RequestDispatcher</code> internally, and dispatching
      is the only way to figure out if a JSP exists, but this action can only
      execute once. The same holds for the
      <code class="classname">VelocityViewResolver</code> and some others. Check the
      Javadoc for the view resolver to see whether it reports non-existing
      views. Thus, putting an
      <code class="classname">InternalResourceViewResolver</code> in the chain in a
      place other than the last, results in the chain not being fully
      inspected, because the
      <code class="classname">InternalResourceViewResolver</code> will
      <span class="emphasis"><em>always</em></span> return a view!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-redirecting"></a>16.5.3&nbsp;Redirecting to views</h3></div></div></div><p>As mentioned previously, a controller typically returns a logical
      view name, which a view resolver resolves to a particular view
      technology. For view technologies such as JSPs that are processed
      through the Servlet or JSP engine, this resolution is usually handled
      through the combination of
      <code class="classname">InternalResourceViewResolver</code> and
      <code class="classname">InternalResourceView</code>, which issues an internal
      forward or include via the Servlet API's
      <code class="literal">RequestDispatcher.forward(..)</code> method or
      <code class="literal">RequestDispatcher.include()</code> method. For other view
      technologies, such as Velocity, XSLT, and so on, the view itself writes
      the content directly to the response stream.</p><p>It is sometimes desirable to issue an HTTP redirect back to the
      client, before the view is rendered. This is desirable, for example,
      when one controller has been called with <code class="literal">POST</code>ed data,
      and the response is actually a delegation to another controller (for
      example on a successful form submission). In this case, a normal
      internal forward will mean that the other controller will also see the
      same <code class="literal">POST</code> data, which is potentially problematic if
      it can confuse it with other expected data. Another reason to perform a
      redirect before displaying the result is to eliminate the possibility of
      the user submitting the form data multiple times. In this scenario, the
      browser will first send an initial <code class="literal">POST</code>; it will then
      receive a response to redirect to a different URL; and finally the
      browser will perform a subsequent <code class="literal">GET</code> for the URL
      named in the redirect response. Thus, from the perspective of the
      browser, the current page does not reflect the result of a
      <code class="literal">POST</code> but rather of a <code class="literal">GET</code>. The end
      effect is that there is no way the user can accidentally
      re-<code class="literal">POST</code> the same data by performing a refresh. The
      refresh forces a <code class="literal">GET</code> of the result page, not a resend
      of the initial <code class="literal">POST</code> data.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-redirecting-redirect-view"></a>16.5.3.1&nbsp;<code class="classname">RedirectView</code></h4></div></div></div><p>One way to force a redirect as the result of a controller
        response is for the controller to create and return an instance of
        Spring's <code class="classname">RedirectView</code>. In this case,
        <code class="classname">DispatcherServlet</code> does not use the normal view
        resolution mechanism. Rather because it has been given the (redirect)
        view already, the <code class="classname">DispatcherServlet</code> simply
        instructs the view to do its work.</p><p>The <code class="classname">RedirectView</code> issues an
        <code class="literal">HttpServletResponse.sendRedirect()</code> call that
        returns to the client browser as an HTTP redirect. By default all
        model attributes are considered to be exposed as URI template
        variables in the redirect URL. Of the remaining attributes those that
        are primitive types or collections/arrays of primitive types are
        automatically appended as query parameters.</p><p>Appending primitive type attributes as query parameters may be
        the desired result if a model instance was prepared specifically for
        the redirect. However, in annotated controllers the model may contain
        additional attributes added for rendering purposes (e.g. drop-down
        field values). To avoid the possibility of having such attributes
        appear in the URL an annotated controller can declare an argument of
        type <code class="interfacename">RedirectAttributes</code> and use it to
        specify the exact attributes to make available to
        <code class="classname">RedirectView</code>. If the controller method decides
        to redirect, the content of
        <code class="interfacename">RedirectAttributes</code> is used. Otherwise
        the content of the model is used.</p><p>Note that URI template variables from the present request are
        automatically made available when expanding a redirect URL and do not
        need to be added explicitly neither through
        <code class="interfacename">Model</code> nor
        <code class="interfacename">RedirectAttributes</code>. For example:</p><pre class="programlisting">@RequestMapping(value = <span class="hl-string">"/files/{path}"</span>, method = RequestMethod.POST)
<span class="hl-keyword">public</span> String upload(...) {
    <span class="hl-comment">// ...</span>
    <span class="hl-keyword">return</span> <span class="hl-string">"redirect:files/{path}"</span>;
}</pre><p>If you use <code class="classname">RedirectView</code> and the view is
        created by the controller itself, it is recommended that you configure
        the redirect URL to be injected into the controller so that it is not
        baked into the controller but configured in the context along with the
        view names. The next section discusses this process.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-redirecting-redirect-prefix"></a>16.5.3.2&nbsp;The <code class="literal">redirect:</code> prefix</h4></div></div></div><p>While the use of <code class="classname">RedirectView</code> works fine,
        if the controller itself creates the
        <code class="classname">RedirectView</code>, there is no avoiding the fact
        that the controller is aware that a redirection is happening. This is
        really suboptimal and couples things too tightly. The controller
        should not really care about how the response gets handled. In general
        it should operate only in terms of view names that have been injected
        into it.</p><p>The special <code class="literal">redirect:</code> prefix allows you to
        accomplish this. If a view name is returned that has the prefix
        <code class="literal">redirect:</code>, the
        <code class="classname">UrlBasedViewResolver</code> (and all subclasses) will
        recognize this as a special indication that a redirect is needed. The
        rest of the view name will be treated as the redirect URL.</p><p>The net effect is the same as if the controller had returned a
        <code class="classname">RedirectView</code>, but now the controller itself can
        simply operate in terms of logical view names. A logical view name
        such as <code class="literal">redirect:/myapp/some/resource</code> will redirect
        relative to the current Servlet context, while a name such as
        <code class="literal">redirect:http://myhost.com/some/arbitrary/path</code> will
        redirect to an absolute URL.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-redirecting-forward-prefix"></a>16.5.3.3&nbsp;The <code class="literal">forward:</code> prefix</h4></div></div></div><p>It is also possible to use a special <code class="literal">forward:</code>
        prefix for view names that are ultimately resolved by
        <code class="classname">UrlBasedViewResolver</code> and subclasses. This
        creates an <code class="classname">InternalResourceView</code> (which
        ultimately does a <code class="literal">RequestDispatcher.forward()</code>)
        around the rest of the view name, which is considered a URL.
        Therefore, this prefix is not useful with
        <code class="classname">InternalResourceViewResolver</code> and
        <code class="classname">InternalResourceView</code> (for JSPs for example).
        But the prefix can be helpful when you are primarily using another
        view technology, but still want to force a forward of a resource to be
        handled by the Servlet/JSP engine. (Note that you may also chain
        multiple view resolvers, instead.)</p><p>As with the <code class="literal">redirect:</code> prefix, if the view
        name with the <code class="literal">forward:</code> prefix is injected into the
        controller, the controller does not detect that anything special is
        happening in terms of handling the response.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multiple-representations"></a>16.5.4&nbsp;<code class="classname">ContentNegotiatingViewResolver</code></h3></div></div></div><p>The <code class="classname">ContentNegotiatingViewResolver</code> does not
      resolve views itself but rather delegates to other view resolvers,
      selecting the view that resembles the representation requested by the
      client. Two strategies exist for a client to request a representation
      from the server:</p><div class="itemizedlist"><ul type="disc"><li><p>Use a distinct URI for each resource, typically by using a
          different file extension in the URI. For example, the URI<code class="literal">
          http://www.example.com/users/fred.pdf</code> requests a PDF
          representation of the user fred, and
          <code class="literal">http://www.example.com/users/fred.xml</code> requests an
          XML representation.</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>Use the same URI for the client to locate the resource, but
          set the <code class="literal">Accept</code> HTTP request header to list the
          <a class="ulink" href="http://en.wikipedia.org/wiki/Internet_media_type" target="_top">media
          types</a> that it understands. For example, an HTTP request for
          <code class="literal">http://www.example.com/users/fred</code> with an
          <code class="literal">Accept</code> header set to <code class="literal">application/pdf
          </code>requests a PDF representation of the user fred, while
          <code class="literal">http://www.example.com/users/fred</code> with an
          <code class="literal">Accept</code> header set to <code class="literal">text/xml</code>
          requests an XML representation. This strategy is known as <a class="ulink" href="http://en.wikipedia.org/wiki/Content_negotiation" target="_top">content
          negotiation</a>.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>One issue with the <code class="literal">Accept</code> header is that it
        is impossible to set it in a web browser within HTML. For example, in
        Firefox, it is fixed to:</p><pre class="programlisting">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</pre><p>For this reason it is common to see the use of a distinct URI
        for each representation when developing browser based web
        applications.</p></td></tr></table></div><p>To support multiple representations of a resource, Spring provides
      the <code class="classname">ContentNegotiatingViewResolver</code> to resolve a
      view based on the file extension or <code class="literal">Accept</code> header of
      the HTTP request. <code class="classname">ContentNegotiatingViewResolver</code>
      does not perform the view resolution itself but instead delegates to a
      list of view resolvers that you specify through the bean property
      <code class="literal">ViewResolvers</code>.</p><p>The <code class="classname">ContentNegotiatingViewResolver</code> selects
      an appropriate <code class="classname">View</code> to handle the request by
      comparing the request media type(s) with the media type (also known as
      <code class="literal">Content-Type</code>) supported by the
      <code class="classname">View</code> associated with each of its
      <code class="classname">ViewResolvers</code>. The first
      <code class="classname">View</code> in the list that has a compatible
      <code class="literal">Content-Type</code> returns the representation to the
      client. If a compatible view cannot be supplied by the
      <code class="classname">ViewResolver</code> chain, then the list of views
      specified through the <code class="literal">DefaultViews</code> property will be
      consulted. This latter option is appropriate for singleton
      <code class="classname">Views</code> that can render an appropriate
      representation of the current resource regardless of the logical view
      name. The <code class="literal">Accept</code> header may include wild cards, for
      example <code class="literal">text/*</code>, in which case a
      <code class="classname">View</code> whose Content-Type was
      <code class="literal">text/xml</code> is a compatible match.</p><p>To support the resolution of a view based on a file extension, use
      the <code class="classname">ContentNegotiatingViewResolver </code>bean property
      <code class="literal">mediaTypes</code> to specify a mapping of file extensions to
      media types. For more information on the algorithm used to determine the
      request media type, refer to the API documentation for
      <code class="classname">ContentNegotiatingViewResolver</code>.</p><p>Here is an example configuration of a
      <code class="classname">ContentNegotiatingViewResolver:</code></p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.ContentNegotiatingViewResolver"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mediaTypes"</span>&gt;
    &lt;<span class="hl-tag">map</span>&gt;
      &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"atom"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"application/atom+xml"</span>/&gt;
      &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"html"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"text/html"</span>/&gt;
      &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"json"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"application/json"</span>/&gt;
    &lt;<span class="hl-tag">/map</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewResolvers"</span>&gt;
    &lt;<span class="hl-tag">list</span>&gt;
      &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.BeanNameViewResolver"</span>/&gt;
      &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"prefix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/jsp/"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"suffix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">".jsp"</span>/&gt;
      &lt;<span class="hl-tag">/bean</span>&gt;
    &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"defaultViews"</span>&gt;
    &lt;<span class="hl-tag">list</span>&gt;
      &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.json.MappingJacksonJsonView"</span> /&gt;
    &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;


&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"content"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.springsource.samples.rest.SampleContentAtomView"</span>/&gt;</pre><p>The <code class="classname">InternalResourceViewResolver</code> handles
      the translation of view names and JSP pages, while the
      <code class="classname">BeanNameViewResolver</code> returns a view based on the
      name of a bean. (See "<a class="link" href="#mvc-viewresolver-resolver" title="16.5.1&nbsp;Resolving views with the ViewResolver interface">Resolving views with the
      ViewResolver interface</a>" for more details on how Spring looks up
      and instantiates a view.) In this example, the
      <code class="literal">content</code> bean is a class that inherits from
      <code class="classname">AbstractAtomFeedView</code>, which returns an Atom RSS
      feed. For more information on creating an Atom Feed representation, see
      the section Atom Views.</p><p>In the above configuration, if a request is made with an
      <code class="literal">.html</code> extension, the view resolver looks for a view
      that matches the <code class="literal">text/html</code> media type. The
      <code class="classname">InternalResourceViewResolver</code> provides the
      matching view for <code class="literal">text/html</code>. If the request is made
      with the file extension <code class="literal">.atom</code>, the view resolver
      looks for a view that matches the
      <code class="literal">application/atom+xml</code> media type. This view is
      provided by the <code class="classname">BeanNameViewResolver</code> that maps to
      the <code class="classname">SampleContentAtomView</code> if the view name
      returned is <code class="classname">content</code>. If the request is made with
      the file extension <code class="literal">.json</code>, the
      <code class="classname">MappingJacksonJsonView</code> instance from the
      <code class="literal">DefaultViews</code> list will be selected regardless of the
      view name. Alternatively, client requests can be made without a file
      extension but with the <code class="literal">Accept</code> header set to the
      preferred media-type, and the same resolution of request to views would
      occur.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If <code class="classname">ContentNegotiatingViewResolver</code>'s list
        of ViewResolvers is not configured explicitly, it automatically uses
        any ViewResolvers defined in the application context.</p></td></tr></table></div><p>The corresponding controller code that returns an Atom RSS feed
      for a URI of the form <code class="literal">http://localhost/content.atom</code>
      or <code class="literal">http://localhost/content</code> with an
      <code class="literal">Accept</code> header of application/atom+xml is shown
      below.</p><pre class="programlisting">@Controller
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContentController {

    <span class="hl-keyword">private</span> List&lt;SampleContent&gt; contentList = <span class="hl-keyword">new</span> ArrayList&lt;SampleContent&gt;();

    @RequestMapping(value=<span class="hl-string">"/content"</span>, method=RequestMethod.GET)
    <span class="hl-keyword">public</span> ModelAndView getContent() {
        ModelAndView mav = <span class="hl-keyword">new</span> ModelAndView();
        mav.setViewName(<span class="hl-string">"content"</span>);
        mav.addObject(<span class="hl-string">"sampleContentList"</span>, contentList);
        <span class="hl-keyword">return</span> mav;
    }

}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-flash-attributes"></a>16.6&nbsp;Using flash attributes</h2></div></div></div><p>Flash attributes provide a way for one request to store attributes
    intended for use in another. This is most commonly needed when redirecting
    &#8212; for example, the <span class="emphasis"><em>Post/Redirect/Get</em></span> pattern. Flash
    attributes are saved temporarily before the redirect (typically in the
    session) to be made available to the request after the redirect and
    removed immediately.</p><p>Spring MVC has two main abstractions in support of flash attributes.
    <code class="classname">FlashMap</code> is used to hold flash attributes while
    <code class="interfacename">FlashMapManager</code> is used to store, retrieve,
    and manage <code class="classname">FlashMap</code> instances.</p><p>Flash attribute support is always "on" and does not need to enabled
    explicitly although if not used, it never causes HTTP session creation. On
    each request there is an "input" <code class="classname">FlashMap</code> with
    attributes passed from a previous request (if any) and an "output"
    <code class="classname">FlashMap</code> with attributes to save for a subsequent
    request. Both <code class="classname">FlashMap</code> instances are accessible
    from anywhere in Spring MVC through static methods in
    <code class="classname">RequestContextUtils</code>.</p><p>Annotated controllers typically do not need to work with
    <code class="classname">FlashMap</code> directly. Instead an
    <code class="interfacename">@RequestMapping</code> method can accept an
    argument of type <code class="interfacename">RedirectAttributes</code> and use
    it to add flash attributes for a redirect scenario. Flash attributes added
    via <code class="interfacename">RedirectAttributes</code> are automatically
    propagated to the "output" FlashMap. Similarly after the redirect
    attributes from the "input" <code class="classname">FlashMap</code> are
    automatically added to the <code class="interfacename">Model</code> of the
    controller serving the target URL.</p><div class="sidebar"><a name="mvc-flash-attributes-concurrency"></a><p class="title"><b>Matching requests to flash attributes</b></p><p>The concept of flash attributes exists in many other Web
      frameworks and has proven to be exposed sometimes to concurrency issues.
      This is because by definition flash attributes are to be stored until
      the next request. However the very "next" request may not be the
      intended recipient but another asynchronous request (e.g. polling or
      resource requests) in which case the flash attributes are removed too
      early.</p><p>To reduce the possibility of such issues,
      <code class="classname">RedirectView</code> automatically "stamps"
      <code class="classname">FlashMap</code> instances with the path and query
      parameters of the target redirect URL. In turn the default
      <code class="classname">FlashMapManager</code> matches that information to
      incoming requests when looking up the "input"
      <code class="classname">FlashMap</code>.</p><p>This does not eliminate the possibility of a concurrency issue
      entirely but nevertheless reduces it greatly with information that is
      already available in the redirect URL. Therefore the use of flash
      attributes is recommended mainly for redirect scenarios .</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-construct-encode-uri"></a>16.7&nbsp;Building <code class="literal">URI</code>s</h2></div></div></div><p>Spring MVC provides a mechanism for building and encoding a URI
    using <code class="classname">UriComponentsBuilder</code> and
    <code class="classname">UriComponents</code>.
    </p><p>For example you can expand and encode a URI template string:</p><pre class="programlisting">UriComponents uriComponents = 
        UriComponentsBuilder.fromUriString(<span class="hl-string">"http://example.com/hotels/{hotel}/bookings/{booking}"</span>).build();
        
URI uri = uriComponents.expand(<span class="hl-string">"42"</span>, <span class="hl-string">"21"</span>).encode().toUri();
</pre><p>Note that <code class="classname">UriComponents</code> is immutable and 
    the <code class="literal">expand()</code> and <code class="literal">encode()</code> 
    operations return new instances if necessary.</p><p>You can also expand and encode using individual URI components:</p><pre class="programlisting">UriComponents uriComponents = 
        UriComponentsBuilder.newInstance()
            .scheme(<span class="hl-string">"http"</span>).host(<span class="hl-string">"example.com"</span>).path(<span class="hl-string">"/hotels/{hotel}/bookings/{booking}"</span>).build()
            .expand(<span class="hl-string">"42"</span>, <span class="hl-string">"21"</span>)
            .encode();
</pre><p>In a Servlet environment the 
	<code class="classname">ServletUriComponentsBuilder</code> sub-class provides
	static factory methods to copy available URL information from a 
	Servlet requests: 
	</p><pre class="programlisting">HttpServletRequest request = ...

<span class="hl-comment">// Re-use host, scheme, port, path and query string</span>
<span class="hl-comment">// Replace the "accountId" query param</span>

ServletUriComponentsBuilder ucb = 
        ServletUriComponentsBuilder.fromRequest(request).replaceQueryParam(<span class="hl-string">"accountId"</span>, <span class="hl-string">"{id}"</span>).build()
            .expand(<span class="hl-string">"123"</span>)
            .encode();
</pre><p>Alternatively, you may choose to copy a subset of the available 
    information up to and including the context path:</p><pre class="programlisting"><span class="hl-comment">// Re-use host, port and context path</span>
<span class="hl-comment">// Append "/accounts" to the path</span>

ServletUriComponentsBuilder ucb = 
        ServletUriComponentsBuilder.fromContextPath(request).path(<span class="hl-string">"/accounts"</span>).build()
</pre><p>Or in cases where the <code class="classname">DispatcherServlet</code> is mapped
    by name (e.g. <code class="literal">/main/*</code>), you can also have the literal part 
    of the servlet mapping included:</p><pre class="programlisting"><span class="hl-comment">// Re-use host, port, context path</span>
<span class="hl-comment">// Append the literal part of the servlet mapping to the path</span>
<span class="hl-comment">// Append "/accounts" to the path</span>

ServletUriComponentsBuilder ucb = 
        ServletUriComponentsBuilder.fromServletMapping(request).path(<span class="hl-string">"/accounts"</span>).build()
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-localeresolver"></a>16.8&nbsp;Using locales</h2></div></div></div><p>Most parts of Spring's architecture support internationalization,
    just as the Spring web MVC framework does.
    <code class="classname">DispatcherServlet</code> enables you to automatically
    resolve messages using the client's locale. This is done with
    <code class="interfacename">LocaleResolver</code> objects.</p><p>When a request comes in, the
    <code class="classname">DispatcherServlet</code> looks for a locale resolver, and
    if it finds one it tries to use it to set the locale. Using the
    <code class="literal">RequestContext.getLocale()</code> method, you can always
    retrieve the locale that was resolved by the locale resolver.</p><p>In addition to automatic locale resolution, you can also attach an
    interceptor to the handler mapping (see <a class="xref" href="#mvc-handlermapping-interceptor" title="16.4.1&nbsp;Intercepting requests with a HandlerInterceptor">Section&nbsp;16.4.1, &#8220;Intercepting requests with a
      HandlerInterceptor&#8221;</a> for more information on
    handler mapping interceptors) to change the locale under specific
    circumstances, for example, based on a parameter in the request.</p><p>Locale resolvers and interceptors are defined in the
    <code class="literal">org.springframework.web.servlet.i18n</code> package and are
    configured in your application context in the normal way. Here is a
    selection of the locale resolvers included in Spring.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-localeresolver-acceptheader"></a>16.8.1&nbsp;<code class="classname">AcceptHeaderLocaleResolver</code></h3></div></div></div><p>This locale resolver inspects the
      <code class="literal">accept-language</code> header in the request that was sent
      by the client (e.g., a web browser). Usually this header field contains
      the locale of the client's operating system.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-localeresolver-cookie"></a>16.8.2&nbsp;<code class="classname">CookieLocaleResolver</code></h3></div></div></div><p>This locale resolver inspects a <code class="classname">Cookie</code> that
      might exist on the client to see if a locale is specified. If so, it
      uses the specified locale. Using the properties of this locale resolver,
      you can specify the name of the cookie as well as the maximum age. Find
      below an example of defining a
      <code class="classname">CookieLocaleResolver</code>.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"localeResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.i18n.CookieLocaleResolver"</span>&gt;

    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"cookieName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"clientlanguage"</span>/&gt;
    
    &lt;<span class="hl-comment">!-- in seconds. If set to -1, the cookie is not persisted (deleted when browser shuts down) --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"cookieMaxAge"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100000"</span>&gt;

&lt;<span class="hl-tag">/bean</span>&gt;</pre><div class="table"><a name="mvc-cookie-locale-resolver-props-tbl"></a><p class="title"><b>Table&nbsp;16.4.&nbsp;<code class="classname">CookieLocaleResolver</code> properties</b></p><div class="table-contents"><table summary="CookieLocaleResolver properties" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Property</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Default</th><th style="border-bottom: 1.0pt solid ; ">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">cookieName</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">classname + LOCALE</td><td style="border-bottom: 1.0pt solid ; ">The name of the cookie</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">cookieMaxAge</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Integer.MAX_INT</td><td style="border-bottom: 1.0pt solid ; ">The maximum time a cookie will stay persistent on the
              client. If -1 is specified, the cookie will not be persisted; it
              will only be available until the client shuts down his or her
              browser.</td></tr><tr><td style="border-right: 1.0pt solid ; ">cookiePath</td><td style="border-right: 1.0pt solid ; ">/</td><td style="">Limits the visibility of the cookie to a certain part of
              your site. When cookiePath is specified, the cookie will only be
              visible to that path and the paths below it.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-localeresolver-session"></a>16.8.3&nbsp;<code class="classname">SessionLocaleResolver</code></h3></div></div></div><p>The <code class="classname">SessionLocaleResolver</code> allows you to
      retrieve locales from the session that might be associated with the
      user's request.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-localeresolver-interceptor"></a>16.8.4&nbsp;<code class="classname">LocaleChangeInterceptor</code></h3></div></div></div><p>You can enable changing of locales by adding the
      <code class="classname">LocaleChangeInterceptor</code> to one of the handler
      mappings (see <a class="xref" href="#mvc-handlermapping" title="16.4&nbsp;Handler mappings">Section&nbsp;16.4, &#8220;Handler mappings&#8221;</a>). It will detect a
      parameter in the request and change the locale. It calls
      <code class="literal">setLocale()</code> on the
      <code class="interfacename">LocaleResolver</code> that also exists in the
      context. The following example shows that calls to all
      <code class="literal">*.view</code> resources containing a parameter named
      <code class="literal">siteLanguage</code> will now change the locale. So, for
      example, a request for the following URL,
      <code class="literal">http://www.sf.net/home.view?siteLanguage=nl</code> will
      change the site language to Dutch.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"localeChangeInterceptor"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.i18n.LocaleChangeInterceptor"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"paramName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"siteLanguage"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"localeResolver"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.i18n.CookieLocaleResolver"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"urlMapping"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptors"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"localeChangeInterceptor"</span>/&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappings"</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;/**/*.view=someController&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-themeresolver"></a>16.9&nbsp;Using themes</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-themeresolver-introduction"></a>16.9.1&nbsp;Overview of themes</h3></div></div></div><p>You can apply Spring Web MVC framework themes to set the overall
      look-and-feel of your application, thereby enhancing user experience. A
      theme is a collection of static resources, typically style sheets and
      images, that affect the visual style of the application.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-themeresolver-defining"></a>16.9.2&nbsp;Defining themes</h3></div></div></div><p>To use themes in your web application, you must set up an
      implementation of the
      <code class="interfacename">org.springframework.ui.context.ThemeSource</code>
      interface. The <code class="interfacename">WebApplicationContext</code>
      interface extends <code class="interfacename">ThemeSource</code> but
      delegates its responsibilities to a dedicated implementation. By default
      the delegate will be an
      <code class="classname">org.springframework.ui.context.support.ResourceBundleThemeSource</code>
      implementation that loads properties files from the root of the
      classpath. To use a custom <code class="interfacename">ThemeSource</code>
      implementation or to configure the base name prefix of the
      <code class="classname">ResourceBundleThemeSource</code>, you can register a
      bean in the application context with the reserved name
      <code class="classname">themeSource</code>. The web application context
      automatically detects a bean with that name and uses it.</p><p>When using the <code class="classname">ResourceBundleThemeSource</code>, a
      theme is defined in a simple properties file. The
      properties file lists the resources that make up the theme. Here is an
      example:</p><pre class="programlisting">styleSheet=/themes/cool/style.css
background=/themes/cool/img/coolBg.jpg</pre><p>The keys of the properties are the names that refer to the themed
      elements from view code. For a JSP, you typically do this using the
      <code class="literal">spring:theme</code> custom tag, which is very similar to the
      <code class="literal">spring:message</code> tag. The following JSP fragment uses
      the theme defined in the previous example to customize the look and
      feel:</p><pre class="programlisting">&lt;<span class="hl-tag">%@</span> <span class="hl-attribute">taglib</span> <span class="hl-attribute">prefix</span>=<span class="hl-value">"spring"</span> <span class="hl-attribute">uri</span>=<span class="hl-value">"http://www.springframework.org/tags"</span><span class="hl-attribute">%&gt;</span>
<span class="hl-attribute">&lt;html&gt;</span>
   <span class="hl-attribute">&lt;head&gt;</span>
      <span class="hl-attribute">&lt;link</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">href</span>=<span class="hl-value">"&lt;spring:theme code='styleSheet'/&gt;"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/css"</span>/&gt;
   &lt;<span class="hl-tag">/head</span>&gt;
   &lt;<span class="hl-tag">body</span> <span class="hl-attribute">style</span>=<span class="hl-value">"background=&lt;spring:theme code='background'/&gt;"</span>&gt;
      ...
   &lt;<span class="hl-tag">/body</span>&gt;
&lt;<span class="hl-tag">/html</span>&gt;</pre><p>By default, the <code class="classname">ResourceBundleThemeSource</code>
      uses an empty base name prefix. As a result, the properties files are
      loaded from the root of the classpath. Thus you would put the
      <code class="literal">cool.properties</code> theme definition in a directory at
      the root of the classpath, for example, in
      <code class="literal">/WEB-INF/classes</code>. The
      <code class="classname">ResourceBundleThemeSource</code> uses the standard Java
      resource bundle loading mechanism, allowing for full
      internationalization of themes. For example, we could have a
      <code class="literal">/WEB-INF/classes/cool_nl.properties</code> that references a
      special background image with Dutch text on it.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-themeresolver-resolving"></a>16.9.3&nbsp;Theme resolvers</h3></div></div></div><p>After you define themes, as in the preceding section, you decide
      which theme to use. The <code class="classname">DispatcherServlet</code> will
      look for a bean named <code class="classname">themeResolver</code> to find out
      which <code class="interfacename">ThemeResolver</code> implementation to
      use. A theme resolver works in much the same way as a
      <code class="interfacename">LocaleResolver</code>. It detects the theme to
      use for a particular request and can also alter the request's theme. The
      following theme resolvers are provided by Spring:</p><div class="table"><a name="mvc-theme-resolver-impls-tbl"></a><p class="title"><b>Table&nbsp;16.5.&nbsp;<code class="interfacename">ThemeResolver</code>
        implementations</b></p><div class="table-contents"><table summary="ThemeResolver&#xA;        implementations" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Class</th><th style="border-bottom: 1.0pt solid ; ">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">FixedThemeResolver</code></td><td style="border-bottom: 1.0pt solid ; ">Selects a fixed theme, set using the
              <code class="classname">defaultThemeName</code> property.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">SessionThemeResolver</code></td><td style="border-bottom: 1.0pt solid ; ">The theme is maintained in the user's HTTP session. It
              only needs to be set once for each session, but is not persisted
              between sessions.</td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="classname">CookieThemeResolver</code></td><td style="">The selected theme is stored in a cookie on the
              client.</td></tr></tbody></table></div></div><br class="table-break"><p>Spring also provides a
      <code class="classname">ThemeChangeInterceptor</code> that allows theme changes
      on every request with a simple request parameter.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-multipart"></a>16.10&nbsp;Spring's multipart (file upload) support</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multipart-introduction"></a>16.10.1&nbsp;Introduction</h3></div></div></div><p>Spring's built-in multipart support handles file uploads in web
      applications. You enable this multipart support with pluggable
      <code class="interfacename">MultipartResolver</code> objects, defined in the
      <code class="literal">org.springframework.web.multipart</code> package. Spring
      provides one <code class="interfacename">MultipartResolver</code>
      implementation for use with <a class="ulink" href="http://jakarta.apache.org/commons/fileupload" target="_top"> <span class="emphasis"><em>Commons
      FileUpload</em></span></a> and another for use with Servlet 3.0
      multipart request parsing.</p><p>By default, Spring does no multipart handling, because some
      developers want to handle multiparts themselves. You enable Spring
      multipart handling by adding a multipart resolver to the web
      application's context. Each request is inspected to see if it contains a
      multipart. If no multipart is found, the request continues as expected.
      If a multipart is found in the request, the
      <code class="classname">MultipartResolver</code> that has been declared in your
      context is used. After that, the multipart attribute in your request is
      treated like any other attribute.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multipart-resolver-commons"></a>16.10.2&nbsp;Using a <code class="interfacename">MultipartResolver</code> with
      <span class="emphasis"><em>Commons FileUpload</em></span></h3></div></div></div><p>The following example shows how to use the
      <code class="classname">CommonsMultipartResolver</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"multipartResolver"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;

    &lt;<span class="hl-comment">!-- one of the properties available; the maximum file size in bytes --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"maxUploadSize"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100000"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Of course you also need to put the appropriate jars in your
      classpath for the multipart resolver to work. In the case of the
      <code class="classname">CommonsMultipartResolver</code>, you need to use
      <code class="literal">commons-fileupload.jar</code>.</p><p>When the Spring <code class="classname">DispatcherServlet</code> detects a
      multi-part request, it activates the resolver that has been declared in
      your context and hands over the request. The resolver then wraps the
      current <code class="classname">HttpServletRequest</code> into a
      <code class="classname">MultipartHttpServletRequest</code> that supports
      multipart file uploads. Using the
      <code class="classname">MultipartHttpServletRequest</code>, you can get
      information about the multiparts contained by this request and actually
      get access to the multipart files themselves in your controllers.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multipart-resolver-standard"></a>16.10.3&nbsp;Using a <code class="interfacename">MultipartResolver</code> with
      <span class="emphasis"><em>Servlet 3.0</em></span></h3></div></div></div><p>In order to use Servlet 3.0 based multipart parsing, you need to
      mark the <code class="classname">DispatcherServlet</code> with a
      <code class="literal">"multipart-config"</code> section in
      <code class="filename">web.xml</code>, or with a
      <code class="classname">javax.servlet.MultipartConfigElement</code> in
      programmatic Servlet registration, or in case of a custom Servlet class
      possibly with a
      <code class="classname">javax.servlet.annotation.MultipartConfig</code>
      annotation on your Servlet class. Configuration settings such as maximum
      sizes or storage locations need to be applied at that Servlet
      registration level as Servlet 3.0 does not allow for those settings to
      be done from the MultipartResolver.</p><p>Once Servlet 3.0 multipart parsing has been enabled in one of the
      above mentioned ways you can add the
      <code class="classname">StandardServletMultipartResolver</code> to your Spring
      configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"multipartResolver"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.multipart.support.StandardServletMultipartResolver"</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multipart-forms"></a>16.10.4&nbsp;Handling a file upload in a form</h3></div></div></div><p>After the <code class="classname">MultipartResolver</code> completes its
      job, the request is processed like any other. First, create a form with
      a file input that will allow the user to upload a form. The encoding
      attribute (<code class="literal">enctype="multipart/form-data"</code>) lets the
      browser know how to encode the form as multipart request:</p><pre class="programlisting">&lt;<span class="hl-tag">html</span>&gt;
    &lt;<span class="hl-tag">head</span>&gt;
        &lt;<span class="hl-tag">title</span>&gt;Upload a file please&lt;<span class="hl-tag">/title</span>&gt;
    &lt;<span class="hl-tag">/head</span>&gt;
    &lt;<span class="hl-tag">body</span>&gt;
        &lt;<span class="hl-tag">h1</span>&gt;Please upload a file&lt;<span class="hl-tag">/h1</span>&gt;
        &lt;<span class="hl-tag">form</span> <span class="hl-attribute">method</span>=<span class="hl-value">"post"</span> <span class="hl-attribute">action</span>=<span class="hl-value">"/form"</span> <span class="hl-attribute">enctype</span>=<span class="hl-value">"multipart/form-data"</span>&gt;
            &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span>/&gt;
            &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"file"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"file"</span>/&gt;
            &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span>/&gt;
        &lt;<span class="hl-tag">/form</span>&gt;
    &lt;<span class="hl-tag">/body</span>&gt;
&lt;<span class="hl-tag">/html</span>&gt;</pre><p>The next step is to create a controller that handles the file
      upload. This controller is very similar to a <a class="link" href="#mvc-ann-controller" title="16.3.1&nbsp;Defining a controller with @Controller">normal annotated
      <code class="interfacename">@Controller</code></a>, except that we use
      <code class="classname">MultipartHttpServletRequest</code> or
      <code class="filename">MultipartFile</code> in the method parameters:</p><pre class="programlisting">@Controller
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadController {

    @RequestMapping(value = <span class="hl-string">"/form"</span>, method = RequestMethod.POST)
    <span class="hl-keyword">public</span> String handleFormUpload(@RequestParam(<span class="hl-string">"name"</span>) String name, 
        @RequestParam(<span class="hl-string">"file"</span>) MultipartFile file) {

        <span class="hl-keyword">if</span> (!file.isEmpty()) {
            <span class="hl-keyword">byte</span>[] bytes = file.getBytes();
            <span class="hl-comment">// store the bytes somewhere</span>
           <span class="hl-keyword">return</span> <span class="hl-string">"redirect:uploadSuccess"</span>;
       } <span class="hl-keyword">else</span> {
           <span class="hl-keyword">return</span> <span class="hl-string">"redirect:uploadFailure"</span>;
       }
    }

}</pre><p>Note how the <code class="interfacename">@RequestParam</code> method
      parameters map to the input elements declared in the form. In this
      example, nothing is done with the <code class="literal">byte[]</code>, but in
      practice you can save it in a database, store it on the file system, and
      so on.</p><p>When using Servlet 3.0 multipart parsing you can also use
      <code class="classname">javax.servlet.http.Part</code> for the method
      parameter:</p><pre class="programlisting">@Controller
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadController {

    @RequestMapping(value = <span class="hl-string">"/form"</span>, method = RequestMethod.POST)
    <span class="hl-keyword">public</span> String handleFormUpload(@RequestParam(<span class="hl-string">"name"</span>) String name,
        @RequestParam(<span class="hl-string">"file"</span>) Part file) {

        InputStream inputStream = file.getInputStream();
        <span class="hl-comment">// store bytes from uploaded file somewhere</span>
        
        <span class="hl-keyword">return</span> <span class="hl-string">"redirect:uploadSuccess"</span>;
    }

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multipart-forms-non-browsers"></a>16.10.5&nbsp;Handling a file upload request from programmatic clients</h3></div></div></div><p>Multipart requests can also be submitted from non-browser clients
      in a RESTful service scenario. All of the above examples and
      configuration apply here as well. However, unlike browsers that
      typically submit files and simple form fields, a programmatic client can
      also send more complex data of a specific content type &#8212; for example a
      multipart request with a file and second part with JSON formatted data:
      </p><pre class="programlisting">POST /someUrl
Content-Type: multipart/mixed
 
--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
Content-Disposition: form-data; name="meta-data"
Content-Type: application/json; charset=UTF-8
Content-Transfer-Encoding: 8bit
 
{
  "name": "value"
}
--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
Content-Disposition: form-data; name="file-data"; filename="file.properties"
Content-Type: text/xml
Content-Transfer-Encoding: 8bit
... File Data ...</pre><p>You could access the part named "meta-data" with a
      <code class="interfacename">@RequestParam("meta-data") String
      metadata</code> controller method argument. However, you would
      probably prefer to accept a strongly typed object initialized from the
      JSON formatted data in the body of the request part, very similar to the
      way <code class="interfacename">@RequestBody</code> converts the body of a
      non-multipart request to a target object with the help of an
      <code class="classname">HttpMessageConverter</code>.</p><p>You can use the <code class="interfacename">@RequestPart</code>
      annotation instead of the <code class="interfacename">@RequestParam</code>
      annotation for this purpose. It allows you to have the content of a
      specific multipart passed through an
      <code class="classname">HttpMessageConverter</code> taking into consideration
      the <code class="literal">'Content-Type'</code> header of the multipart:</p><pre class="programlisting">@RequestMapping(value=<span class="hl-string">"/someUrl"</span>, method = RequestMethod.POST)
<span class="hl-keyword">public</span> String onSubmit(@RequestPart(<span class="hl-string">"meta-data"</span>) MetaData metadata,
                       @RequestPart(<span class="hl-string">"file-data"</span>) MultipartFile file) {
    <span class="hl-comment">// ...</span>

}</pre><p>Notice how <code class="classname">MultipartFile</code> method arguments
      can be accessed with <code class="interfacename">@RequestParam</code> or
      with <code class="interfacename">@RequestPart</code> interchangeably.
      However, the <code class="literal">@RequestPart("meta-data") MetaData</code>
      method argument in this case is read as JSON content based on its
      <code class="literal">'Content-Type'</code> header and converted with the help of
      the <code class="classname">MappingJacksonHttpMessageConverter</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-exceptionhandlers"></a>16.11&nbsp;Handling exceptions</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e32002"></a>16.11.1&nbsp;<code class="interfacename">HandlerExceptionResolver</code></h3></div></div></div><p>Spring <code class="literal">HandlerExceptionResolver</code> implementations
      deal with unexpected exceptions that occur during controller execution.
      A <code class="literal">HandlerExceptionResolver</code> somewhat resembles the
      exception mappings you can define in the web application descriptor
      <code class="literal">web.xml</code>. However, they provide a more flexible way to
      do so. For example they provide information about which handler was
      executing when the exception was thrown. Furthermore, a programmatic way
      of handling exceptions gives you more options for responding
      appropriately before the request is forwarded to another URL (the same
      end result as when you use the Servlet specific exception
      mappings).</p><p>Besides implementing the
      <code class="interfacename">HandlerExceptionResolver</code> interface, which
      is only a matter of implementing the
      <code class="literal">resolveException(Exception, Handler)</code> method and
      returning a <code class="classname">ModelAndView</code>, you may also use the
      <code class="classname">SimpleMappingExceptionResolver</code>. This resolver
      enables you to take the class name of any exception that might be thrown
      and map it to a view name. This is functionally equivalent to the
      exception mapping feature from the Servlet API, but it is also possible
      to implement more finely grained mappings of exceptions from different
      handlers.</p><p>By default, the <code class="classname">DispatcherServlet</code> registers
      the <code class="classname">DefaultHandlerExceptionResolver</code>. This
      resolver handles certain standard Spring MVC exceptions by setting a
      specific response status code: </p><div class="informaltable"><table style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Exception</th><th style="border-bottom: 1.0pt solid ; ">HTTP Status Code</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">ConversionNotSupportedException</code></td><td style="border-bottom: 1.0pt solid ; ">500 (Internal Server Error)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">HttpMediaTypeNotAcceptableException</code></td><td style="border-bottom: 1.0pt solid ; ">406 (Not Acceptable)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">HttpMediaTypeNotSupportedException</code></td><td style="border-bottom: 1.0pt solid ; ">415 (Unsupported Media Type)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">HttpMessageNotReadableException</code></td><td style="border-bottom: 1.0pt solid ; ">400 (Bad Request)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">HttpMessageNotWritableException</code></td><td style="border-bottom: 1.0pt solid ; ">500 (Internal Server Error)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">HttpRequestMethodNotSupportedException</code></td><td style="border-bottom: 1.0pt solid ; ">405 (Method Not Allowed)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">MissingServletRequestParameterException</code></td><td style="border-bottom: 1.0pt solid ; ">400 (Bad Request)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">NoSuchRequestHandlingMethodException</code></td><td style="border-bottom: 1.0pt solid ; ">404 (Not Found)</td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="classname">TypeMismatchException</code></td><td style="">400 (Bad Request)</td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-ann-exceptionhandler"></a>16.11.2&nbsp;<code class="interfacename">@ExceptionHandler</code></h3></div></div></div><p>An alternative to the
      <code class="interfacename">HandlerExceptionResolver</code> interface is the
      <code class="interfacename">@ExceptionHandler</code> annotation. You use the
      <code class="classname">@ExceptionHandler</code> method annotation within a
      controller to specify which method is invoked when an exception of a
      specific type is thrown during the execution of controller methods. For
      example:</p><pre class="programlisting">@Controller
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleController {

  <span class="hl-comment">// other controller method omitted</span>

  @ExceptionHandler(IOException.<span class="hl-keyword">class</span>)
  <span class="hl-keyword">public</span> String handleIOException(IOException ex, HttpServletRequest request) {
    <span class="hl-keyword">return</span> ClassUtils.getShortName(ex.getClass());
  }
}</pre><p>will invoke the 'handlerIOException' method when a
      <code class="classname">java.io.IOException</code> is thrown.</p><p>The <code class="classname">@ExceptionHandler</code> value can be set to
      an array of Exception types. If an exception is thrown matches one of
      the types in the list, then the method annotated with the matching
      <code class="classname">@ExceptionHandler</code> will be invoked. If the
      annotation value is not set then the exception types listed as method
      arguments are used.</p><p>Much like standard controller methods annotated with a
      <code class="classname">@RequestMapping</code> annotation, the method arguments
      and return values of <code class="classname">@ExceptionHandler</code> methods
      are very flexible. For example, the
      <code class="classname">HttpServletRequest</code> can be accessed in Servlet
      environments and the <code class="classname">PortletRequest</code> in Portlet
      environments. The return type can be a <code class="classname">String</code>,
      which is interpreted as a view name or a
      <code class="classname">ModelAndView</code> object. Refer to the API
      documentation for more details.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-coc"></a>16.12&nbsp;Convention over configuration support</h2></div></div></div><p>For a lot of projects, sticking to established conventions and
    having reasonable defaults is just what they (the projects) need, and
    Spring Web MVC now has explicit support for <span class="emphasis"><em>convention over
    configuration</em></span>. What this means is that if you establish a set
    of naming conventions and suchlike, you can
    <span class="emphasis"><em>substantially</em></span> cut down on the amount of configuration
    that is required to set up handler mappings, view resolvers,
    <code class="classname">ModelAndView</code> instances, etc. This is a great boon
    with regards to rapid prototyping, and can also lend a degree of (always
    good-to-have) consistency across a codebase should you choose to move
    forward with it into production.</p><p>Convention-over-configuration support addresses the three core areas
    of MVC: models, views, and controllers.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-coc-ccnhm"></a>16.12.1&nbsp;The Controller
      <code class="classname">ControllerClassNameHandlerMapping</code></h3></div></div></div><p>The <code class="classname">ControllerClassNameHandlerMapping</code> class
      is a <code class="interfacename">HandlerMapping</code> implementation that
      uses a convention to determine the mapping between request URLs and the
      <code class="interfacename">Controller</code> instances that are to handle
      those requests.</p><p>Consider the following simple
      <code class="interfacename">Controller</code> implementation. Take special
      notice of the <span class="emphasis"><em>name</em></span> of the class.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ViewShoppingCartController <span class="hl-keyword">implements</span> Controller {

    <span class="hl-keyword">public</span> ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        <span class="hl-comment">// the implementation is not hugely important for this example...</span>
    }
}</pre><p>Here is a snippet from the corresponding Spring Web MVC
      configuration file:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping"</span>/&gt;
                
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewShoppingCart"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.z.ViewShoppingCartController"</span>&gt;
    &lt;<span class="hl-comment">!-- inject dependencies as required... --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The <code class="classname">ControllerClassNameHandlerMapping</code> finds
      all of the various handler (or
      <code class="interfacename">Controller</code>) beans defined in its
      application context and strips <code class="literal">Controller</code> off the
      name to define its handler mappings. Thus,
      <code class="classname">ViewShoppingCartController</code> maps to the
      <code class="literal">/viewshoppingcart*</code> request URL.</p><p>Let's look at some more examples so that the central idea becomes
      immediately familiar. (Notice all lowercase in the URLs, in contrast to
      camel-cased <code class="interfacename">Controller</code> class
      names.)</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">WelcomeController</code> maps to the
          <code class="literal">/welcome*</code> request URL</p></li><li><p><code class="classname">HomeController</code> maps to the
          <code class="literal">/home*</code> request URL</p></li><li><p><code class="classname">IndexController</code> maps to the
          <code class="literal">/index*</code> request URL</p></li><li><p><code class="classname">RegisterController</code> maps to the
          <code class="literal">/register*</code> request URL</p></li></ul></div><p>In the case of <code class="classname">MultiActionController</code>
      handler classes, the mappings generated are slightly more complex. The
      <code class="interfacename">Controller</code> names in the following
      examples are assumed to be <code class="classname">MultiActionController</code>
      implementations:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">AdminController</code> maps to the
          <code class="literal">/admin/*</code> request URL</p></li><li><p><code class="classname">CatalogController</code> maps to the
          <code class="literal">/catalog/*</code> request URL</p></li></ul></div><p>If you follow the convention of naming your
      <code class="interfacename">Controller</code> implementations as
      <code class="literal">xxx</code><span class="bold"><strong>Controller</strong></span>, the
      <code class="classname">ControllerClassNameHandlerMapping</code> saves you the
      tedium of defining and maintaining a potentially
      <span class="emphasis"><em>looooong</em></span>
      <code class="classname">SimpleUrlHandlerMapping</code> (or suchlike).</p><p>The <code class="classname">ControllerClassNameHandlerMapping</code> class
      extends the <code class="classname">AbstractHandlerMapping</code> base class so
      you can define <code class="interfacename">HandlerInterceptor</code>
      instances and everything else just as you would with many other
      <code class="interfacename">HandlerMapping</code> implementations.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-coc-modelmap"></a>16.12.2&nbsp;The Model <code class="classname">ModelMap</code>
      (<code class="classname">ModelAndView</code>)</h3></div></div></div><p>The <code class="classname">ModelMap</code> class is essentially a
      glorified <code class="interfacename">Map</code> that can make adding
      objects that are to be displayed in (or on) a
      <code class="interfacename">View</code> adhere to a common naming
      convention. Consider the following
      <code class="interfacename">Controller</code> implementation; notice that
      objects are added to the <code class="classname">ModelAndView</code> without any
      associated name specified.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DisplayShoppingCartController <span class="hl-keyword">implements</span> Controller {

    <span class="hl-keyword">public</span> ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        
        List cartItems = <span class="hl-comment">// get a List of CartItem objects</span>
        User user = <span class="hl-comment">// get the User doing the shopping</span>
        
        ModelAndView mav = <span class="hl-keyword">new</span> ModelAndView(<span class="hl-string">"displayShoppingCart"</span>); &lt;-- the logical view name

        mav.addObject(cartItems); &lt;-- look ma, no name, just the object
        mav.addObject(user); &lt;-- and again ma!

        <span class="hl-keyword">return</span> mav;
    }
}</pre><p>The <code class="classname">ModelAndView</code> class uses a
      <code class="classname">ModelMap</code> class that is a custom
      <code class="interfacename">Map</code> implementation that automatically
      generates a key for an object when an object is added to it. The
      strategy for determining the name for an added object is, in the case of
      a scalar object such as <code class="classname">User</code>, to use the short
      class name of the object's class. The following examples are names that
      are generated for scalar objects put into a
      <code class="classname">ModelMap</code> instance.</p><div class="itemizedlist"><ul type="disc"><li><p>An <code class="classname">x.y.User</code> instance added will have
          the name <code class="literal">user</code> generated.</p></li><li><p>An <code class="classname">x.y.Registration</code> instance added will
          have the name <code class="literal">registration</code> generated.</p></li><li><p>An <code class="classname">x.y.Foo</code> instance added will have the
          name <code class="literal">foo</code> generated.</p></li><li><p>A <code class="classname">java.util.HashMap</code> instance added will
          have the name <code class="literal">hashMap</code> generated. You probably
          want to be explicit about the name in this case because
          <code class="literal">hashMap</code> is less than intuitive.</p></li><li><p>Adding <code class="literal">null</code> will result in an
          <code class="classname">IllegalArgumentException</code> being thrown. If the
          object (or objects) that you are adding could be
          <code class="literal">null</code>, then you will also want to be explicit
          about the name.</p></li></ul></div><div class="sidebar"><p class="title"><b>What, no automatic pluralization?</b></p><p>Spring Web MVC's convention-over-configuration support does not
        support automatic pluralization. That is, you cannot add a
        <code class="interfacename">List</code> of <code class="classname">Person</code>
        objects to a <code class="classname">ModelAndView</code> and have the
        generated name be <code class="classname">people</code>.</p><p>This decision was made after some debate, with the
        &#8220;<span class="quote">Principle of Least Surprise</span>&#8221; winning out in the
        end.</p></div><p>The strategy for generating a name after adding a
      <code class="interfacename">Set</code> or a
      <code class="interfacename">List</code> is to peek into the collection, take
      the short class name of the first object in the collection, and use that
      with <code class="literal">List</code> appended to the name. The same applies to
      arrays although with arrays it is not necessary to peek into the array
      contents. A few examples will make the semantics of name generation for
      collections clearer:</p><div class="itemizedlist"><ul type="disc"><li><p>An <code class="classname">x.y.User[]</code> array with zero or more
          <code class="classname">x.y.User</code> elements added will have the name
          <code class="literal">userList</code> generated.</p></li><li><p>An <code class="classname">x.y.Foo[]</code> array with zero or more
          <code class="classname">x.y.User</code> elements added will have the name
          <code class="literal">fooList</code> generated.</p></li><li><p>A <code class="classname">java.util.ArrayList</code> with one or more
          <code class="classname">x.y.User</code> elements added will have the name
          <code class="literal">userList</code> generated.</p></li><li><p>A <code class="classname">java.util.HashSet</code> with one or more
          <code class="classname">x.y.Foo</code> elements added will have the name
          <code class="literal">fooList</code> generated.</p></li><li><p>An <span class="bold"><strong>empty</strong></span>
          <code class="classname">java.util.ArrayList</code> will not be added at all
          (in effect, the <code class="methodname">addObject(..)</code> call will
          essentially be a no-op).</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-coc-r2vnt"></a>16.12.3&nbsp;The View -
      <code class="interfacename">RequestToViewNameTranslator</code></h3></div></div></div><p>The <code class="interfacename">RequestToViewNameTranslator</code>
      interface determines a logical <code class="interfacename">View</code> name
      when no such logical view name is explicitly supplied. It has just one
      implementation, the
      <code class="classname">DefaultRequestToViewNameTranslator</code> class.</p><p>The <code class="classname">DefaultRequestToViewNameTranslator</code> maps
      request URLs to logical view names, as with this example:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RegistrationController <span class="hl-keyword">implements</span> Controller {
                
    <span class="hl-keyword">public</span> ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        <span class="hl-comment">// process the request...</span>
        ModelAndView mav = <span class="hl-keyword">new</span> ModelAndView();
        <span class="hl-comment">// add data as necessary to the model...</span>
        <span class="hl-keyword">return</span> mav;
        <span class="hl-comment">// notice that no View or logical view name has been set</span>
    }
}</pre><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span> 
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans 
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

    &lt;<span class="hl-comment">!-- this bean with the well known name generates view names for us --</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewNameTranslator"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator"</span>/&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.RegistrationController"</span>&gt;
        &lt;<span class="hl-comment">!-- inject dependencies as necessary --</span>&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
    
    &lt;<span class="hl-comment">!-- maps request URLs to Controller names --</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping"</span>/&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"prefix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/jsp/"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"suffix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">".jsp"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Notice how in the implementation of the
      <code class="literal">handleRequest(..)</code> method no
      <code class="interfacename">View</code> or logical view name is ever set on
      the <code class="classname">ModelAndView</code> that is returned. The
      <code class="classname">DefaultRequestToViewNameTranslator</code> is tasked with
      generating a <span class="emphasis"><em>logical view name</em></span> from the URL of the
      request. In the case of the above
      <code class="classname">RegistrationController</code>, which is used in
      conjunction with the
      <code class="classname">ControllerClassNameHandlerMapping</code>, a request URL
      of <code class="literal">http://localhost/registration.html</code> results in a
      logical view name of <code class="literal">registration</code> being generated by
      the <code class="classname">DefaultRequestToViewNameTranslator</code>. This
      logical view name is then resolved into the
      <code class="literal">/WEB-INF/jsp/registration.jsp</code> view by the
      <code class="classname">InternalResourceViewResolver</code> bean.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You do not need to define a
        <code class="classname">DefaultRequestToViewNameTranslator</code> bean
        explicitly. If you like the default settings of the
        <code class="classname">DefaultRequestToViewNameTranslator</code>, you can
        rely on the Spring Web MVC <code class="classname">DispatcherServlet</code> to
        instantiate an instance of this class if one is not explicitly
        configured.</p></td></tr></table></div><p>Of course, if you need to change the default settings, then you do
      need to configure your own
      <code class="classname">DefaultRequestToViewNameTranslator</code> bean
      explicitly. Consult the comprehensive Javadoc for the
      <code class="classname">DefaultRequestToViewNameTranslator</code> class for
      details of the various properties that can be configured.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-etag"></a>16.13&nbsp;ETag support</h2></div></div></div><p>An <a class="ulink" href="http://en.wikipedia.org/wiki/HTTP_ETag" target="_top">ETag</a>
    (entity tag) is an HTTP response header returned by an HTTP/1.1 compliant
    web server used to determine change in content at a given URL. It can be
    considered to be the more sophisticated successor to the
    <code class="literal">Last-Modified</code> header. When a server returns a
    representation with an ETag header, the client can use this header in
    subsequent GETs, in an <code class="literal">If-None-Match</code> header. If the
    content has not changed, the server returns <code class="literal">304: Not
    Modified</code>.</p><p>Support for ETags is provided by the Servlet filter
    <code class="classname">ShallowEtagHeaderFilter</code>. It is a plain Servlet
    Filter, and thus can be used in combination with any web framework. The
    <code class="classname">ShallowEtagHeaderFilter</code> filter creates so-called
    shallow ETags (as opposed to deep ETags, more about that later).The
    filter caches the content of the rendered JSP (or other content),
    generates an MD5 hash over that, and returns that as an ETag header in the
    response. The next time a client sends a request for the same resource, it
    uses that hash as the <code class="literal">If-None-Match</code> value. The filter
    detects this, renders the view again, and compares the two hashes. If they
    are equal, a <code class="literal">304</code> is returned. This filter will not save
    processing power, as the view is still rendered. The only thing it saves
    is bandwidth, as the rendered response is not sent back over the
    wire.</p><p>You configure the <code class="classname">ShallowEtagHeaderFilter</code> in
    <code class="filename">web.xml</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">filter</span>&gt;
  &lt;<span class="hl-tag">filter-name</span>&gt;etagFilter&lt;<span class="hl-tag">/filter-name</span>&gt;
    &lt;<span class="hl-tag">filter-class</span>&gt;org.springframework.web.filter.ShallowEtagHeaderFilter&lt;<span class="hl-tag">/filter-class</span>&gt;
&lt;<span class="hl-tag">/filter</span>&gt;

&lt;<span class="hl-tag">filter-mapping</span>&gt;
  &lt;<span class="hl-tag">filter-name</span>&gt;etagFilter&lt;<span class="hl-tag">/filter-name</span>&gt;
  &lt;<span class="hl-tag">servlet-name</span>&gt;petclinic&lt;<span class="hl-tag">/servlet-name</span>&gt;
&lt;<span class="hl-tag">/filter-mapping</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-config"></a>16.14&nbsp;Configuring Spring MVC</h2></div></div></div><p><a class="xref" href="#mvc-servlet-special-bean-types" title="16.2.1&nbsp;Special Bean Types In the WebApplicationContext">Section&nbsp;16.2.1, &#8220;Special Bean Types In the WebApplicationContext&#8221;</a> and 
	<a class="xref" href="#mvc-servlet-config" title="16.2.2&nbsp;Default DispatcherServlet Configuration">Section&nbsp;16.2.2, &#8220;Default DispatcherServlet Configuration&#8221;</a> explained about
	Spring MVC's special beans and the default implementations 
	used by the <code class="classname">DispatcherServlet</code>.
	In this section you'll learn about two additional ways of 
	configuring Spring MVC. Namely the MVC Java config and
	the MVC XML namespace.
	</p><p>The MVC Java config and the MVC namespace provide 
    similar default configuration that overrides 
    the <code class="classname">DispatcherServlet</code> defaults.
	The goal is to spare most applications from having to 
    having to create the same configuration and also to
	provide higher-level constructs for configuring 
    Spring MVC that serve as a simple starting point and
	require little or no prior knowledge of the underlying
    configuration.</p><p>You can choose either the MVC Java config or the 
    MVC namespace depending on your preference. Also as you
    will see further below, with the MVC Java config it is
    easier to see the underlying configuration as well as 
    to make fine-grained customizations directly to the	
    created Spring MVC beans. 
    But let's start from the beginning.
	</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-enable"></a>16.14.1&nbsp;Enabling MVC Java Config or the MVC XML Namespace</h3></div></div></div><p>To enable MVC Java config add the annotation 
		<code class="interfacename">@EnableWebMvc</code> to one of your 
		<code class="interfacename">@Configuration</code> classes:</p><pre class="programlisting">@EnableWebMvc
@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig {

}</pre><p>To achieve the same in XML use the <code class="literal">mvc:annotation-driven</code> element:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans 
        http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
        http://www.springframework.org/schema/mvc 
        http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd"</span>&gt;

    &lt;<span class="hl-tag">mvc:annotation-driven</span> /&gt;

&lt;<span class="hl-tag">beans</span>&gt;</pre><p>The above registers a
      <code class="classname">RequestMappingHandlerMapping</code>, a 
      <code class="classname">RequestMappingHandlerAdapter</code>, and an
      <code class="classname">ExceptionHandlerExceptionResolver</code> (among others)
      in support of processing requests with annotated controller methods using
      annotations such as <code class="interfacename">@RequestMapping </code>,
      <code class="interfacename">@ExceptionHandler</code>, and others.</p><p>It also enables the following:
	  </p><div class="orderedlist"><ol type="1"><li><p>Spring 3 style type conversion through a <a class="link" href="#core-convert" title="6.5&nbsp;Spring 3 Type Conversion">ConversionService</a> instance 
            in addition to the JavaBeans PropertyEditors used for Data Binding.</p></li><li><p>Support for <a class="link" href="#format" title="6.6&nbsp;Spring 3 Field Formatting">formatting</a> Number
            fields using the <code class="interfacename">@NumberFormat</code> 
            annotation through the
            <code class="interfacename">ConversionService</code>.</p></li><li><p>Support for <a class="link" href="#format" title="6.6&nbsp;Spring 3 Field Formatting">formatting</a> Date,
            Calendar, Long, and Joda Time fields using the 
            <code class="interfacename">@DateTimeFormat</code>
            annotation, if Joda Time 1.3 or higher is present on the
            classpath.</p></li><li><p>Support for <a class="link" href="#validation-mvc-jsr303" title="6.7.4.3&nbsp;Configuring a JSR-303 Validator for use by Spring MVC">validating</a> @Controller
            inputs with <code class="interfacename">@Valid</code>, 
            if a JSR-303 Provider is present on the classpath.</p></li><li><p>HttpMessageConverter support for 
            <code class="interfacename">@RequestBody</code> method
            parameters and <code class="interfacename">@ResponseBody</code>
            method return values from 
            <code class="interfacename">@RequestMapping</code> or
            <code class="interfacename">@ExceptionHandler</code> methods.</p><p>This is the complete list of HttpMessageConverters set up by
            mvc:annotation-driven: </p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">ByteArrayHttpMessageConverter</code>
                  converts byte arrays.</p></li><li><p><code class="classname">StringHttpMessageConverter</code>
                  converts strings.</p></li><li><p><code class="classname">ResourceHttpMessageConverter</code>
                  converts to/from
                  <code class="classname">org.springframework.core.io.Resource</code>
                  for all media types.</p></li><li><p><code class="classname">SourceHttpMessageConverter</code>
                  converts to/from a
                  <code class="classname">javax.xml.transform.Source</code>.</p></li><li><p><code class="classname">FormHttpMessageConverter</code>
                  converts form data to/from a
                  <code class="classname">MultiValueMap&lt;String,
                  String&gt;</code>.</p></li><li><p><code class="classname">Jaxb2RootElementHttpMessageConverter</code>
                  converts Java objects to/from XML &#8212; added if JAXB2 is
                  present on the classpath.</p></li><li><p><code class="classname">MappingJacksonHttpMessageConverter</code>
                  converts to/from JSON &#8212; added if Jackson is present on the
                  classpath.</p></li><li><p><code class="classname">AtomFeedHttpMessageConverter</code>
                  converts Atom feeds &#8212; added if Rome is present on the
                  classpath.</p></li><li><p><code class="classname">RssChannelHttpMessageConverter</code>
                  converts RSS feeds &#8212; added if Rome is present on the
                  classpath.</p></li></ul></div></li></ol></div><p>
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-customize"></a>16.14.2&nbsp;Customizing the Provided Configuration</h3></div></div></div><p>To customize the default configuration in Java you simply
		implement the <code class="interfacename">WebMvcConfigurer</code> 
		interface or more likely extend the class
		<code class="classname">WebMvcConfigurerAdapter</code> and override
		the methods you need. Below is an example of some of the available
		methods to override. See <code class="interfacename">WebMvcConifgurer</code> for 
		a list of all methods and the Javadoc for further details:</p><pre class="programlisting">@EnableWebMvc
@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

  @Override
  <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> addFormatters(FormatterRegistry registry) {
    <span class="hl-comment">// Add formatters and/or converters</span>
  }

  @Override
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
    <span class="hl-comment">// Configure the list of HttpMessageConverters to use </span>
  }
  
}</pre><p>To customize the default configuration of 
        <code class="literal">&lt;mvc:annotation-driven /&gt;</code> check what
		attributes and sub-elements it supports. You can view the 
		<a class="ulink" href="http://static.springsource.org/schema/mvc/spring-mvc-3.1.xsd" target="_top">Spring MVC XML schema</a>
		or use the code completion feature of your IDE to discover
		what attributes and sub-elements are available. 
		The sample below shows a subset of what is available:</p><pre class="programlisting">&lt;<span class="hl-tag">mvc:annotation-driven</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"conversionService"</span>&gt;
    &lt;<span class="hl-tag">mvc:message-converters</span>&gt;
        &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.MyHttpMessageConverter"</span>/&gt;
        &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.MyOtherHttpMessageConverter"</span>/&gt;
    &lt;<span class="hl-tag">/mvc:message-converters</span>&gt;
&lt;<span class="hl-tag">/mvc:annotation-driven</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"conversionService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.format.support.FormattingConversionServiceFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"formatters"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.MyFormatter"</span>/&gt;
            &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.MyOtherFormatter"</span>/&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-interceptors"></a>16.14.3&nbsp;Configuring Interceptors</h3></div></div></div><p>You can configure <code class="interfacename">HandlerInterceptors</code>
      or <code class="interfacename">WebRequestInterceptors</code> to be applied
      to all incoming requests or restricted to specific URL path patterns.</p><p>An example of registering interceptors in Java:</p><pre class="programlisting">@EnableWebMvc
@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {
      
  @Override
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addInterceptors(InterceptorRegistry registry) {
    registry.addInterceptor(<span class="hl-keyword">new</span> LocalInterceptor());
    registry.addInterceptor(<span class="hl-keyword">new</span> SecurityInterceptor()).addPathPatterns(<span class="hl-string">"/secure/*"</span>);
 }

}</pre><p>And in XML use the <code class="literal">&lt;mvc:interceptors&gt;</code> element:</p><pre class="programlisting">&lt;<span class="hl-tag">mvc:interceptors</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.i18n.LocaleChangeInterceptor"</span> /&gt;
    &lt;<span class="hl-tag">mvc:interceptor</span>&gt;
        &lt;<span class="hl-tag">mapping</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/secure/*"</span>/&gt;
        &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.SecurityInterceptor"</span> /&gt;
    &lt;<span class="hl-tag">/mvc:interceptor</span>&gt;
&lt;<span class="hl-tag">/mvc:interceptors</span>&gt;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-view-controller"></a>16.14.4&nbsp;Configuring View Controllers</h3></div></div></div><p>This is a shortcut for defining a
      <code class="classname">ParameterizableViewController</code> that immediately
      forwards to a view when invoked. Use it in static cases when there is no
      Java controller logic to execute before the view generates the
      response.</p><p>An example of forwarding a request for <code class="literal">"/"</code>
      to a view called <code class="literal">"home"</code> in Java:</p><pre class="programlisting">@EnableWebMvc
@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {
      
  @Override
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addViewControllers(ViewControllerRegistry registry) {
    registry.addViewController(<span class="hl-string">"/"</span>).setViewName(<span class="hl-string">"home"</span>);
  }

}</pre><p>And the same in XML use the <code class="literal">&lt;mvc:view-controller&gt;</code> element:</p><pre class="programlisting">&lt;<span class="hl-tag">mvc:view-controller</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/"</span> <span class="hl-attribute">view-name</span>=<span class="hl-value">"home"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-static-resources"></a>16.14.5&nbsp;Configuring Serving of Resources</h3></div></div></div><p>This option allows static resource requests following a particular
      URL pattern to be served by a
      <code class="classname">ResourceHttpRequestHandler</code> from any of a list of
      <code class="classname">Resource</code> locations. This provides a convenient
      way to serve static resources from locations other than the web
      application root, including locations on the classpath. The
      <code class="code">cache-period</code> property may be used to set far future
      expiration headers (1 year is the recommendation of optimization tools
      such as Page Speed and YSlow) so that they will be more efficiently
      utilized by the client. The handler also properly evaluates the
      <code class="code">Last-Modified</code> header (if present) so that a
      <code class="code">304</code> status code will be returned as appropriate, avoiding
      unnecessary overhead for resources that are already cached by the
      client. For example, to serve resource requests with a URL pattern of
      <code class="code">/resources/**</code> from a <code class="code">public-resources</code>
      directory within the web application root you would use:</p><pre class="programlisting">@EnableWebMvc
@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {
      
  @Override
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
    registry.addResourceHandler(<span class="hl-string">"/resources/**"</span>).addResourceLocations(<span class="hl-string">"/public-resources/"</span>);
  }

}</pre><p>And the same in XML:</p><pre class="programlisting">&lt;<span class="hl-tag">mvc:resources</span> <span class="hl-attribute">mapping</span>=<span class="hl-value">"/resources/**"</span> <span class="hl-attribute">location</span>=<span class="hl-value">"/public-resources/"</span>/&gt;</pre><p>To serve these resources with a 1-year future expiration to ensure
      maximum use of the browser cache and a reduction in HTTP requests made
      by the browser:</p><pre class="programlisting">@EnableWebMvc
@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {
      
  @Override
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
    registry.addResourceHandler(<span class="hl-string">"/resources/**"</span>).addResourceLocations(<span class="hl-string">"/public-resources/"</span>).setCachePeriod(31556926);
  }

}</pre><p>And in XML:</p><pre class="programlisting">&lt;<span class="hl-tag">mvc:resources</span> <span class="hl-attribute">mapping</span>=<span class="hl-value">"/resources/**"</span> <span class="hl-attribute">location</span>=<span class="hl-value">"/public-resources/"</span> <span class="hl-attribute">cache-period</span>=<span class="hl-value">"31556926"</span>/&gt;</pre><p>The <code class="code">mapping</code> attribute must be an Ant pattern that can
      be used by <code class="classname">SimpleUrlHandlerMapping</code>, and the
      <code class="code">location</code> attribute must specify one or more valid resource
      directory locations. Multiple resource locations may be specified using
      a comma-separated list of values. The locations specified will be
      checked in the specified order for the presence of the resource for any
      given request. For example, to enable the serving of resources from both
      the web application root and from a known path of
      <code class="code">/META-INF/public-web-resources/</code> in any jar on the
      classpath use:</p><pre class="programlisting">@EnableWebMvc
@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {
      
  @Override
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
    registry.addResourceHandler(<span class="hl-string">"/resources/**"</span>)
      .addResourceLocations(<span class="hl-string">"/"</span>, <span class="hl-string">"classpath:/META-INF/public-web-resources/"</span>);
  }

}</pre><p>And in XML:</p><pre class="programlisting">&lt;<span class="hl-tag">mvc:resources</span> <span class="hl-attribute">mapping</span>=<span class="hl-value">"/resources/**"</span> <span class="hl-attribute">location</span>=<span class="hl-value">"/, classpath:/META-INF/public-web-resources/"</span>/&gt;</pre><p>When serving resources that may change when a new version of the
      application is deployed, it is recommended that you incorporate a
      version string into the mapping pattern used to request the resources,
      so that you may force clients to request the newly deployed version of
      your application's resources. Such a version string can be parameterized
      and accessed using SpEL so that it may be easily managed in a single
      place when deploying new versions.</p><p>As an example, let's consider an application that uses a
      performance-optimized custom build (as recommended) of the Dojo
      JavaScript library in production, and that the build is generally
      deployed within the web application at a path of
      <code class="code">/public-resources/dojo/dojo.js</code>. Since different parts of
      Dojo may be incorporated into the custom build for each new version of
      the application, the client web browsers need to be forced to
      re-download that custom-built <code class="code">dojo.js</code> resource any time a
      new version of the application is deployed. A simple way to achieve this
      would be to manage the version of the application in a properties file,
      such as:</p><pre class="programlisting">application.version=1.0.0</pre><p>and then to make the properties file's values accessible to SpEL
      as a bean using the <code class="code">util:properties</code> tag:</p><pre class="programlisting">&lt;<span class="hl-tag">util:properties</span> <span class="hl-attribute">id</span>=<span class="hl-value">"applicationProps"</span> <span class="hl-attribute">location</span>=<span class="hl-value">"/WEB-INF/spring/application.properties"</span>/&gt;</pre><p>With the application version now accessible via SpEL, we can
      incorporate this into the use of the <code class="code">resources</code> tag:</p><pre class="programlisting">&lt;<span class="hl-tag">mvc:resources</span> <span class="hl-attribute">mapping</span>=<span class="hl-value">"/resources-#{applicationProps['application.version']}/**"</span> <span class="hl-attribute">location</span>=<span class="hl-value">"/public-resources/"</span>/&gt;</pre><p>In Java, you can use the <code class="interfacename">@PropertySouce</code>
      annotation and then inject the <code class="classname">Environment</code> 
      abstraction for access to all defined properties:</p><pre class="programlisting">@EnableWebMvc
@Configuration
@PropertySource(<span class="hl-string">"/WEB-INF/spring/application.properties"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

  @Inject Environment env;

  @Override
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
    registry.addResourceHandler(<span class="hl-string">"/resources-"</span> + env.getProperty(<span class="hl-string">"application.version"</span>) + <span class="hl-string">"/**"</span>)
      .addResourceLocations(<span class="hl-string">"/public-resources/"</span>);
  }

}</pre><p>and finally, to request the resource with the proper URL, we can
      take advantage of the Spring JSP tags:</p><pre class="programlisting">&lt;<span class="hl-tag">spring:eval</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"@applicationProps['application.version']"</span> <span class="hl-attribute">var</span>=<span class="hl-value">"applicationVersion"</span>/&gt;

&lt;<span class="hl-tag">spring:url</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/resources-{applicationVersion}"</span> <span class="hl-attribute">var</span>=<span class="hl-value">"resourceUrl"</span>&gt;
    &lt;<span class="hl-tag">spring:param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"applicationVersion"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${applicationVersion}"</span>/&gt;
&lt;<span class="hl-tag">/spring:url</span>&gt;

&lt;<span class="hl-tag">script</span> <span class="hl-attribute">src</span>=<span class="hl-value">"${resourceUrl}/dojo/dojo.js"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span>&gt; &lt;<span class="hl-tag">/script</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-default-servlet-handler"></a>16.14.6&nbsp;mvc:default-servlet-handler</h3></div></div></div><p>This tag allows for mapping the <code class="code">DispatcherServlet</code> to
      "/" (thus overriding the mapping of the container's default Servlet),
      while still allowing static resource requests to be handled by the
      container's default Servlet. It configures a
      <code class="code">DefaultServletHttpRequestHandler</code> with a URL mapping of
      "/**" and the lowest priority relative to other URL mappings.</p><p>This handler will forward all requests to the default Servlet.
      Therefore it is important that it remains last in the order of all other
      URL <code class="code">HandlerMappings</code>. That will be the case if you use
      <code class="code">&lt;mvc:annotation-driven&gt;</code> or alternatively if you are
      setting up your own customized <code class="code">HandlerMapping</code> instance be
      sure to set its <code class="code">order</code> property to a value lower than that
      of the <code class="code">DefaultServletHttpRequestHandler</code>, which is
      <code class="code">Integer.MAX_VALUE</code>.</p><p>To enable the feature using the default setup use:</p><pre class="programlisting">@EnableWebMvc
@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {
      
  @Override
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
    configurer.enable(); 
  }

}</pre><p>Or in XML:</p><pre class="programlisting">&lt;<span class="hl-tag">mvc:default-servlet-handler</span>/&gt;</pre><p>The caveat to overriding the "/" Servlet mapping is that the
      <code class="code">RequestDispatcher</code> for the default Servlet must be retrieved
      by name rather than by path. The
      <code class="code">DefaultServletHttpRequestHandler</code> will attempt to
      auto-detect the default Servlet for the container at startup time, using
      a list of known names for most of the major Servlet containers
      (including Tomcat, Jetty, Glassfish, JBoss, Resin, WebLogic, and
      WebSphere). If the default Servlet has been custom configured with a
      different name, or if a different Servlet container is being used where
      the default Servlet name is unknown, then the default Servlet's name
      must be explicitly provided as in the following example:</p><pre class="programlisting">@EnableWebMvc
@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {
      
  @Override
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
    configurer.enable(<span class="hl-string">"myCustomDefaultServlet"</span>); 
  }

}</pre><p>Or in XML:</p><pre class="programlisting">&lt;<span class="hl-tag">mvc:default-servlet-handler</span> <span class="hl-attribute">default-servlet-name</span>=<span class="hl-value">"myCustomDefaultServlet"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-resources"></a>16.14.7&nbsp;More Spring Web MVC Resources</h3></div></div></div><p>See the following links and pointers for more resources about Spring Web MVC:</p><div class="itemizedlist"><ul type="disc"><li><p>There are many excellent articles and tutorials that show how to
          build web applications with Spring MVC. Read them at the <a class="ulink" href="http://www.springsource.org/documentation" target="_top">Spring
          Documentation</a> page.</p></li><li><p>&#8220;<span class="quote">Expert Spring Web MVC and Web Flow</span>&#8221; by Seth Ladd
          and others (published by Apress) is an excellent hard copy source of
          Spring Web MVC goodness.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-advanced-java"></a>16.14.8&nbsp;Advanced Customizations with MVC Java Config</h3></div></div></div><p>As you can see from the above examples, MVC Java config and
      the MVC namespace provide higher level constructs that do not 
      require deep knowledge of the underlying beans created for you. 
      Instead it helps you to focus on your application needs.
      However, at some point you may need more fine-grained control
      or you may simply wish to understand the underlying configuration.</p><p>The first step towards more fine-grained control is to see the 
      underlying beans created for you. In MVC Java config you can 
      see the Javadoc and the <code class="interfacename">@Bean</code>
      methods in <code class="classname">WebMvcConfigurationSupport</code>.
      The configuration in this class is automatically imported 
      through the <code class="interfacename">@EnableWebMvc</code> annotation. 
      In fact if you open <code class="interfacename">@EnableWebMvc</code> you can
      see the <code class="interfacename">@Import</code> statement.</p><p>The next step towards more fine-grained control is to 
      customize a property on one of the beans created in
      <code class="classname">WebMvcConfigurationSupport</code> or perhaps
      to provide your own instance. This requires two things -- 
      remove the <code class="interfacename">@EnableWebMvc</code> 
      annotation in order to prevent the import and then 
      extend directly from <code class="classname">WebMvcConfigurationSupport</code>.
      Here is an example:
      </p><pre class="programlisting">@Configuration
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurationSupport {

  @Override
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addInterceptors(InterceptorRegistry registry){
    <span class="hl-comment">// ...</span>
  }

  @Override
  @Bean
  <span class="hl-keyword">public</span> RequestMappingHandlerAdapter requestMappingHandlerAdapter() {

      <span class="hl-comment">// Create or let "super" create the adapter </span>
      <span class="hl-comment">// Then customize one of its properties </span>
  }
  
}</pre><p>Note that modifying beans in this way does not prevent
      you from using any of the higher-level constructs shown earlier in 
      this section. </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-advanced-xml"></a>16.14.9&nbsp;Advanced Customizations with the MVC Namespace</h3></div></div></div><p>Fine-grained control over the configuration created for
      you is a bit harder with the MVC namespace.</p><p>If you do need to do that, rather than replicating the 
      configuration it provides, consider configuring a 
      <code class="interfacename">BeanPostProcessor</code> that detects
      the bean you want to customize by type and then modifying its 
      properties as necessary. For example:</p><pre class="programlisting">@Component
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyPostProcessor <span class="hl-keyword">implements</span> BeanPostProcessor {

  <span class="hl-keyword">public</span> Object postProcessBeforeInitialization(Object bean, String name) <span class="hl-keyword">throws</span> BeansException {
    <span class="hl-keyword">if</span> (bean <span class="hl-keyword">instanceof</span> RequestMappingHandlerAdapter) {
      <span class="hl-comment">// Modify properties of the adapter </span>
    }
  }

}</pre><p>Note that <code class="classname">MyPostProcessor</code> needs to be 
      included in an <code class="interfacename">&lt;component scan /&gt;</code> 
      in order for it to be detected or if you prefer you can declare it
      explicitly with an XML bean declaration.</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="view"></a>17.&nbsp;View technologies</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-introduction"></a>17.1&nbsp;Introduction</h2></div></div></div><p>One of the areas in which Spring excels is in the separation of view
    technologies from the rest of the MVC framework. For example, deciding to
    use Velocity or XSLT in place of an existing JSP is primarily a matter of
    configuration. This chapter covers the major view technologies that work
    with Spring and touches briefly on how to add new ones. This chapter
    assumes you are already familiar with <a class="xref" href="#mvc-viewresolver" title="16.5&nbsp;Resolving views">Section&nbsp;16.5, &#8220;Resolving views&#8221;</a>
    which covers the basics of how views in general are coupled to the MVC
    framework.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-jsp"></a>17.2&nbsp;JSP &amp; JSTL</h2></div></div></div><p>Spring provides a couple of out-of-the-box solutions for JSP and
    JSTL views. Using JSP or JSTL is done using a normal view resolver defined
    in the <code class="interfacename">WebApplicationContext</code>. Furthermore,
    of course you need to write some JSPs that will actually render the
    view.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
        Setting up your application to use JSTL is a common source of error,
        mainly caused by confusion over the different servlet spec., JSP and JSTL
        version numbers, what they mean and how to declare the taglibs correctly. 
        The article
        <a class="ulink" href="http://www.mularien.com/blog/2008/04/24/how-to-reference-and-use-jstl-in-your-web-application/" target="_top">
        How to Reference and Use JSTL in your Web Application</a> provides a 
        useful guide to the common pitfalls and how to avoid them. Note that as of
        Spring 3.0, the minimum supported servlet version is 2.4 (JSP 2.0 and JSTL 1.1),
        which reduces the scope for confusion somewhat.
      </p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jsp-resolver"></a>17.2.1&nbsp;View resolvers</h3></div></div></div><p>Just as with any other view technology you're integrating with
      Spring, for JSPs you'll need a view resolver that will resolve your
      views. The most commonly used view resolvers when developing with JSPs
      are the <code class="classname">InternalResourceViewResolver</code> and the
      <code class="classname">ResourceBundleViewResolver</code>. Both are declared in
      the <code class="interfacename">WebApplicationContext</code>:</p><pre class="programlisting">&lt;<span class="hl-comment">!-- the ResourceBundleViewResolver --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.ResourceBundleViewResolver"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"basename"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"views"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

# And a sample properties file is uses (views.properties in WEB-INF/classes):
welcome.(class)=org.springframework.web.servlet.view.JstlView
welcome.url=/WEB-INF/jsp/welcome.jsp

productList.(class)=org.springframework.web.servlet.view.JstlView
productList.url=/WEB-INF/jsp/productlist.jsp</pre><p>As you can see, the
      <code class="classname">ResourceBundleViewResolver</code> needs a properties
      file defining the view names mapped to 1) a class and 2) a URL. With a
      <code class="classname">ResourceBundleViewResolver</code> you can mix different
      types of views using only one resolver.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewClass"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.web.servlet.view.JstlView"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"prefix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/jsp/"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"suffix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">".jsp"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The <code class="classname">InternalResourceBundleViewResolver</code> can
      be configured for using JSPs as described above. As a best practice, we
      strongly encourage placing your JSP files in a directory under the
      <code class="filename">'WEB-INF'</code> directory, so there can
      be no direct access by clients.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jsp-jstl"></a>17.2.2&nbsp;'Plain-old' JSPs versus JSTL</h3></div></div></div><p>When using the Java Standard Tag Library you must use a special
      view class, the <code class="classname">JstlView</code>, as JSTL needs some
      preparation before things such as the I18N features will work.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jsp-tags"></a>17.2.3&nbsp;Additional tags facilitating development</h3></div></div></div><p>Spring provides data binding of request parameters to command
      objects as described in earlier chapters. To facilitate the development
      of JSP pages in combination with those data binding features, Spring
      provides a few tags that make things even easier. All Spring tags have
      <span class="emphasis"><em>HTML escaping</em></span> features to enable or disable
      escaping of characters.</p><p>The tag library descriptor (TLD) is included in the <code class="filename">spring-webmvc.jar</code>.
      Further information about the individual tags can be found in
      the appendix entitled <a class="xref" href="#spring.tld" title="Appendix&nbsp;F.&nbsp;spring.tld">Appendix&nbsp;F, <i>spring.tld</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jsp-formtaglib"></a>17.2.4&nbsp;Using Spring's form tag library</h3></div></div></div><p>As of version 2.0, Spring provides a comprehensive set of data
      binding-aware tags for handling form elements when using JSP and Spring
      Web MVC. Each tag provides support for the set of attributes of its
      corresponding HTML tag counterpart, making the tags familiar and
      intuitive to use. The tag-generated HTML is HTML 4.01/XHTML 1.0
      compliant.</p><p>Unlike other form/input tag libraries, Spring's form tag library
      is integrated with Spring Web MVC, giving the tags access to the command
      object and reference data your controller deals with. As you will see in
      the following examples, the form tags make JSPs easier to develop, read
      and maintain.</p><p>Let's go through the form tags and look at an example of how each
      tag is used. We have included generated HTML snippets where certain tags
      require further commentary.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-configuration"></a>17.2.4.1&nbsp;Configuration</h4></div></div></div><p>The form tag library comes bundled in
        <code class="literal">spring-webmvc.jar</code>.
        The library descriptor is called
        <code class="literal">spring-form.tld</code>.</p><p>To use the tags from this library, add the following directive
        to the top of your JSP page:</p><pre class="programlisting">&lt;<span class="hl-tag">%@</span> <span class="hl-attribute">taglib</span> <span class="hl-attribute">prefix</span>=<span class="hl-value">"form"</span> <span class="hl-attribute">uri</span>=<span class="hl-value">"http://www.springframework.org/tags/form"</span> <span class="hl-attribute">%&gt;</span></pre><p>... where <code class="literal">form</code> is the tag name prefix you
        want to use for the tags from this library.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-formtag"></a>17.2.4.2&nbsp;The <code class="literal">form</code> tag</h4></div></div></div><p>This tag renders an HTML 'form' tag and exposes a binding path
        to inner tags for binding. It puts the command object in the
        <code class="literal">PageContext</code> so that the command object can be
        accessed by inner tags. <span class="emphasis"><em>All the other tags in this library
        are nested tags of the <code class="literal">form</code> tag</em></span>.</p><p>Let's assume we have a domain object called
        <code class="classname">User</code>. It is a JavaBean with properties such as
        <code class="literal">firstName</code> and <code class="literal">lastName</code>. We will
        use it as the form backing object of our form controller which returns
        <code class="literal">form.jsp</code>. Below is an example of what
        <code class="literal">form.jsp</code> would look like:</p><pre class="programlisting">&lt;<span class="hl-tag">form:form</span>&gt;
      &lt;<span class="hl-tag">table</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;First Name:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">"firstName"</span> /&gt;&lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;Last Name:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">"lastName"</span> /&gt;&lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">"2"</span>&gt;
                  &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Save Changes"</span> /&gt;
              &lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
      &lt;<span class="hl-tag">/table</span>&gt;
  &lt;<span class="hl-tag">/form:form</span>&gt;</pre><p>The <code class="literal">firstName</code> and <code class="literal">lastName</code>
        values are retrieved from the command object placed in the
        <code class="interfacename">PageContext</code> by the page controller.
        Keep reading to see more complex examples of how inner tags are used
        with the <code class="literal">form</code> tag.</p><p>The generated HTML looks like a standard form:</p><pre class="programlisting">&lt;<span class="hl-tag">form</span> <span class="hl-attribute">method</span>=<span class="hl-value">"POST"</span>&gt;
      &lt;<span class="hl-tag">table</span>&gt;
        &lt;<span class="hl-tag">tr</span>&gt;
            &lt;<span class="hl-tag">td</span>&gt;First Name:&lt;<span class="hl-tag">/td</span>&gt;
            &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"firstName"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Harry"</span>/&gt;&lt;<span class="hl-tag">/td</span>&gt;
        &lt;<span class="hl-tag">/tr</span>&gt;
        &lt;<span class="hl-tag">tr</span>&gt;
            &lt;<span class="hl-tag">td</span>&gt;Last Name:&lt;<span class="hl-tag">/td</span>&gt;
            &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lastName"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Potter"</span>/&gt;&lt;<span class="hl-tag">/td</span>&gt;
        &lt;<span class="hl-tag">/tr</span>&gt;
        &lt;<span class="hl-tag">tr</span>&gt;
            &lt;<span class="hl-tag">td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">"2"</span>&gt;
              &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Save Changes"</span> /&gt;
            &lt;<span class="hl-tag">/td</span>&gt;
        &lt;<span class="hl-tag">/tr</span>&gt;
      &lt;<span class="hl-tag">/table</span>&gt;
  &lt;<span class="hl-tag">/form</span>&gt;</pre><p>The preceding JSP assumes that the variable name of the form
        backing object is <code class="literal">'command'</code>. If you have put the
        form backing object into the model under another name (definitely a
        best practice), then you can bind the form to the named variable like
        so:</p><pre class="programlisting">&lt;<span class="hl-tag">form:form</span> <span class="hl-attribute">commandName</span>=<span class="hl-value">"user"</span>&gt;
      &lt;<span class="hl-tag">table</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;First Name:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">"firstName"</span> /&gt;&lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;Last Name:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">"lastName"</span> /&gt;&lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">"2"</span>&gt;
                  &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Save Changes"</span> /&gt;
              &lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
      &lt;<span class="hl-tag">/table</span>&gt;
  &lt;<span class="hl-tag">/form:form</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-inputtag"></a>17.2.4.3&nbsp;The <code class="literal">input</code> tag</h4></div></div></div><p>This tag renders an HTML 'input' tag using the bound value
        and type='text' by default. For an example of this tag, see <a class="xref" href="#view-jsp-formtaglib-formtag" title="17.2.4.2&nbsp;The form tag">Section&nbsp;17.2.4.2, &#8220;The form tag&#8221;</a>. Starting with Spring 3.1
        you can use other types such HTML5-specific types like 'email', 
        'tel', 'date', and others.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-checkboxtag"></a>17.2.4.4&nbsp;The <code class="literal">checkbox</code> tag</h4></div></div></div><p>This tag renders an HTML 'input' tag with type
        'checkbox'.</p><p>Let's assume our <code class="classname">User</code> has preferences
        such as newsletter subscription and a list of hobbies. Below is an
        example of the <code class="classname">Preferences</code> class:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Preferences {

      <span class="hl-keyword">private</span> <span class="hl-keyword">boolean</span> receiveNewsletter;

      <span class="hl-keyword">private</span> String[] interests;

      <span class="hl-keyword">private</span> String favouriteWord;

      <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> isReceiveNewsletter() {
          <span class="hl-keyword">return</span> receiveNewsletter;
      }

      <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setReceiveNewsletter(<span class="hl-keyword">boolean</span> receiveNewsletter) {
          <span class="hl-keyword">this</span>.receiveNewsletter = receiveNewsletter;
      }

      <span class="hl-keyword">public</span> String[] getInterests() {
          <span class="hl-keyword">return</span> interests;
      }

      <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setInterests(String[] interests) {
          <span class="hl-keyword">this</span>.interests = interests;
      }

      <span class="hl-keyword">public</span> String getFavouriteWord() {
          <span class="hl-keyword">return</span> favouriteWord;
      }

      <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setFavouriteWord(String favouriteWord) {
          <span class="hl-keyword">this</span>.favouriteWord = favouriteWord;
      }
  }</pre><p>The <code class="literal">form.jsp</code> would look like:</p><pre class="programlisting">&lt;<span class="hl-tag">form:form</span>&gt;
      &lt;<span class="hl-tag">table</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;Subscribe to newsletter?:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">%--</span> <span class="hl-attribute">Approach</span> <span class="hl-attribute">1:</span> <span class="hl-attribute">Property</span> <span class="hl-attribute">is</span> <span class="hl-attribute">of</span> <span class="hl-attribute">type</span> <span class="hl-attribute">java.lang.Boolean</span> <span class="hl-attribute">--%&gt;</span>
              <span class="hl-attribute">&lt;td&gt;&lt;form:checkbox</span> <span class="hl-attribute">path</span>=<span class="hl-value">"preferences.receiveNewsletter"</span>/&gt;&lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;

          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;Interests:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;
                  &lt;<span class="hl-tag">%--</span> <span class="hl-attribute">Approach</span> <span class="hl-attribute">2:</span> <span class="hl-attribute">Property</span> <span class="hl-attribute">is</span> <span class="hl-attribute">of</span> <span class="hl-attribute">an</span> <span class="hl-attribute">array</span> <span class="hl-attribute">or</span> <span class="hl-attribute">of</span> <span class="hl-attribute">type</span> <span class="hl-attribute">java.util.Collection</span> <span class="hl-attribute">--%&gt;</span>
                  <span class="hl-attribute">Quidditch:</span> <span class="hl-attribute">&lt;form:checkbox</span> <span class="hl-attribute">path</span>=<span class="hl-value">"preferences.interests"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Quidditch"</span>/&gt;
                  Herbology: &lt;<span class="hl-tag">form:checkbox</span> <span class="hl-attribute">path</span>=<span class="hl-value">"preferences.interests"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Herbology"</span>/&gt;
                  Defence Against the Dark Arts: &lt;<span class="hl-tag">form:checkbox</span> <span class="hl-attribute">path</span>=<span class="hl-value">"preferences.interests"</span>
                      <span class="hl-attribute">value</span>=<span class="hl-value">"Defence Against the Dark Arts"</span>/&gt;
              &lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;Favourite Word:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;
                  &lt;<span class="hl-tag">%--</span> <span class="hl-attribute">Approach</span> <span class="hl-attribute">3:</span> <span class="hl-attribute">Property</span> <span class="hl-attribute">is</span> <span class="hl-attribute">of</span> <span class="hl-attribute">type</span> <span class="hl-attribute">java.lang.Object</span> <span class="hl-attribute">--%&gt;</span>
                  <span class="hl-attribute">Magic:</span> <span class="hl-attribute">&lt;form:checkbox</span> <span class="hl-attribute">path</span>=<span class="hl-value">"preferences.favouriteWord"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Magic"</span>/&gt;
              &lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
      &lt;<span class="hl-tag">/table</span>&gt;
  &lt;<span class="hl-tag">/form:form</span>&gt;</pre><p>There are 3 approaches to the <code class="literal">checkbox</code> tag
      which should meet all your checkbox needs.</p><div class="itemizedlist"><ul type="disc"><li><p>Approach One - When the bound value is of type
            <code class="literal">java.lang.Boolean</code>, the
            <code class="literal">input(checkbox)</code> is marked as 'checked' if the
            bound value is <code class="literal">true</code>. The
            <code class="literal">value</code> attribute corresponds to the resolved
            value of the <code class="literal">setValue(Object)</code> value
            property.</p></li><li><p>Approach Two - When the bound value is of type
            <code class="literal">array</code> or
            <code class="interfacename">java.util.Collection</code>, the
            <code class="literal">input(checkbox)</code> is marked as 'checked' if the
            configured <code class="literal">setValue(Object)</code> value is present in
            the bound <code class="interfacename">Collection</code>.</p></li><li><p>Approach Three - For any other bound value type, the
            <code class="literal">input(checkbox)</code> is marked as 'checked' if the
            configured <code class="literal">setValue(Object)</code> is equal to the
            bound value.</p></li></ul></div><p>Note that regardless of the approach, the same HTML structure is
      generated. Below is an HTML snippet of some checkboxes:</p><pre class="programlisting">&lt;<span class="hl-tag">tr</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;Interests:&lt;<span class="hl-tag">/td</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;
          Quidditch: &lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"preferences.interests"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"checkbox"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Quidditch"</span>/&gt;
          &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"hidden"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"_preferences.interests"</span>/&gt;
          Herbology: &lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"preferences.interests"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"checkbox"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Herbology"</span>/&gt;
          &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"hidden"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"_preferences.interests"</span>/&gt;
          Defence Against the Dark Arts: &lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"preferences.interests"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"checkbox"</span>
              <span class="hl-attribute">value</span>=<span class="hl-value">"Defence Against the Dark Arts"</span>/&gt;
          &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"hidden"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"_preferences.interests"</span>/&gt;
      &lt;<span class="hl-tag">/td</span>&gt;
  &lt;<span class="hl-tag">/tr</span>&gt;</pre><p>What you might not expect to see is the additional hidden field
      after each checkbox. When a checkbox in an HTML page is
      <span class="emphasis"><em>not</em></span> checked, its value will not be sent to the
      server as part of the HTTP request parameters once the form is
      submitted, so we need a workaround for this quirk in HTML in order for
      Spring form data binding to work. The <code class="literal">checkbox</code> tag
      follows the existing Spring convention of including a hidden parameter
      prefixed by an underscore ("_") for each checkbox. By doing this, you
      are effectively telling Spring that &#8220;<span class="quote">
          <span class="emphasis"><em>the checkbox was visible in the form and I want my object
          to which the form data will be bound to reflect the state of the
          checkbox no matter what</em></span>
        </span>&#8221;.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-checkboxestag"></a>17.2.4.5&nbsp;The <code class="literal">checkboxes</code> tag</h4></div></div></div><p>This tag renders multiple HTML 'input' tags with type
        'checkbox'.</p><p>Building on the example from the previous
        <code class="classname">checkbox</code> tag section. Sometimes you prefer not
        to have to list all the possible hobbies in your JSP page. You would
        rather provide a list at runtime of the available options and pass
        that in to the tag. That is the purpose of the
        <code class="classname">checkboxes</code> tag. You pass in an
        <code class="classname">Array</code>, a <code class="classname">List</code> or a
        <code class="classname">Map</code> containing the available options in the
        "items" property. Typically the bound property is a collection so it
        can hold multiple values selected by the user. Below is an example of
        the JSP using this tag:</p><pre class="programlisting">&lt;<span class="hl-tag">form:form</span>&gt;
      &lt;<span class="hl-tag">table</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;Interests:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;
                  &lt;<span class="hl-tag">%--</span> <span class="hl-attribute">Property</span> <span class="hl-attribute">is</span> <span class="hl-attribute">of</span> <span class="hl-attribute">an</span> <span class="hl-attribute">array</span> <span class="hl-attribute">or</span> <span class="hl-attribute">of</span> <span class="hl-attribute">type</span> <span class="hl-attribute">java.util.Collection</span> <span class="hl-attribute">--%&gt;</span>
                  <span class="hl-attribute">&lt;form:checkboxes</span> <span class="hl-attribute">path</span>=<span class="hl-value">"preferences.interests"</span> <span class="hl-attribute">items</span>=<span class="hl-value">"${interestList}"</span>/&gt;
              &lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
      &lt;<span class="hl-tag">/table</span>&gt;
  &lt;<span class="hl-tag">/form:form</span>&gt;</pre><p>This example assumes that the "interestList" is a
      <code class="classname">List</code> available as a model attribute containing
      strings of the values to be selected from. In the case where you use a
      Map, the map entry key will be used as the value and the map entry's
      value will be used as the label to be displayed. You can also use a
      custom object where you can provide the property names for the value
      using "itemValue" and the label using "itemLabel".</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-radiobuttontag"></a>17.2.4.6&nbsp;The <code class="literal">radiobutton</code> tag</h4></div></div></div><p>This tag renders an HTML 'input' tag with type 'radio'.</p><p>A typical usage pattern will involve multiple tag instances
        bound to the same property but with different values.</p><pre class="programlisting">&lt;<span class="hl-tag">tr</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;Sex:&lt;<span class="hl-tag">/td</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;Male: &lt;<span class="hl-tag">form:radiobutton</span> <span class="hl-attribute">path</span>=<span class="hl-value">"sex"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"M"</span>/&gt; &lt;<span class="hl-tag">br</span>/&gt;
          Female: &lt;<span class="hl-tag">form:radiobutton</span> <span class="hl-attribute">path</span>=<span class="hl-value">"sex"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"F"</span>/&gt; &lt;<span class="hl-tag">/td</span>&gt;
  &lt;<span class="hl-tag">/tr</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-radiobuttonstag"></a>17.2.4.7&nbsp;The <code class="literal">radiobuttons</code> tag</h4></div></div></div><p>This tag renders multiple HTML 'input' tags with type
        'radio'.</p><p>Just like the <code class="classname">checkboxes</code> tag above, you
        might want to pass in the available options as a runtime variable. For
        this usage you would use the <code class="classname">radiobuttons</code> tag.
        You pass in an <code class="classname">Array</code>, a
        <code class="classname">List</code> or a <code class="classname">Map</code> containing
        the available options in the "items" property. In the case where you
        use a Map, the map entry key will be used as the value and the map
        entry's value will be used as the label to be displayed. You can also
        use a custom object where you can provide the property names for the
        value using "itemValue" and the label using "itemLabel".</p><pre class="programlisting">&lt;<span class="hl-tag">tr</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;Sex:&lt;<span class="hl-tag">/td</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:radiobuttons</span> <span class="hl-attribute">path</span>=<span class="hl-value">"sex"</span> <span class="hl-attribute">items</span>=<span class="hl-value">"${sexOptions}"</span>/&gt;&lt;<span class="hl-tag">/td</span>&gt;
  &lt;<span class="hl-tag">/tr</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-passwordtag"></a>17.2.4.8&nbsp;The <code class="literal">password</code> tag</h4></div></div></div><p>This tag renders an HTML 'input' tag with type 'password' using
        the bound value.</p><pre class="programlisting">&lt;<span class="hl-tag">tr</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;Password:&lt;<span class="hl-tag">/td</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;
          &lt;<span class="hl-tag">form:password</span> <span class="hl-attribute">path</span>=<span class="hl-value">"password"</span> /&gt;
      &lt;<span class="hl-tag">/td</span>&gt;
  &lt;<span class="hl-tag">/tr</span>&gt;</pre><p>Please note that by default, the password value is
        <span class="emphasis"><em>not</em></span> shown. If you do want the password value to
        be shown, then set the value of the <code class="literal">'showPassword'</code>
        attribute to true, like so.</p><pre class="programlisting">&lt;<span class="hl-tag">tr</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;Password:&lt;<span class="hl-tag">/td</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;
          &lt;<span class="hl-tag">form:password</span> <span class="hl-attribute">path</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"^76525bvHGq"</span> <span class="hl-attribute">showPassword</span>=<span class="hl-value">"true"</span> /&gt;
      &lt;<span class="hl-tag">/td</span>&gt;
  &lt;<span class="hl-tag">/tr</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-selecttag"></a>17.2.4.9&nbsp;The <code class="literal">select</code> tag</h4></div></div></div><p>This tag renders an HTML 'select' element. It supports data
        binding to the selected option as well as the use of nested
        <code class="literal">option</code> and <code class="literal">options</code> tags.</p><p>Let's assume a <code class="classname">User</code> has a list of
        skills.</p><pre class="programlisting">&lt;<span class="hl-tag">tr</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;Skills:&lt;<span class="hl-tag">/td</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:select</span> <span class="hl-attribute">path</span>=<span class="hl-value">"skills"</span> <span class="hl-attribute">items</span>=<span class="hl-value">"${skills}"</span>/&gt;&lt;<span class="hl-tag">/td</span>&gt;
  &lt;<span class="hl-tag">/tr</span>&gt;</pre><p>If the <code class="literal">User's</code> skill were in Herbology, the
        HTML source of the 'Skills' row would look like:</p><pre class="programlisting">&lt;<span class="hl-tag">tr</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;Skills:&lt;<span class="hl-tag">/td</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">select</span> <span class="hl-attribute">name</span>=<span class="hl-value">"skills"</span> <span class="hl-attribute">multiple</span>=<span class="hl-value">"true"</span>&gt;
          &lt;<span class="hl-tag">option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Potions"</span>&gt;Potions&lt;<span class="hl-tag">/option</span>&gt;
          &lt;<span class="hl-tag">option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Herbology"</span> <span class="hl-attribute">selected</span>=<span class="hl-value">"selected"</span>&gt;Herbology&lt;<span class="hl-tag">/option</span>&gt;
          &lt;<span class="hl-tag">option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Quidditch"</span>&gt;Quidditch&lt;<span class="hl-tag">/option</span>&gt;&lt;<span class="hl-tag">/select</span>&gt;
      &lt;<span class="hl-tag">/td</span>&gt;
  &lt;<span class="hl-tag">/tr</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-optiontag"></a>17.2.4.10&nbsp;The <code class="literal">option</code> tag</h4></div></div></div><p>This tag renders an HTML 'option'. It sets 'selected' as
        appropriate based on the bound value.</p><pre class="programlisting">&lt;<span class="hl-tag">tr</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;House:&lt;<span class="hl-tag">/td</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;
          &lt;<span class="hl-tag">form:select</span> <span class="hl-attribute">path</span>=<span class="hl-value">"house"</span>&gt;
              &lt;<span class="hl-tag">form:option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Gryffindor"</span>/&gt;
              &lt;<span class="hl-tag">form:option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Hufflepuff"</span>/&gt;
              &lt;<span class="hl-tag">form:option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Ravenclaw"</span>/&gt;
              &lt;<span class="hl-tag">form:option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Slytherin"</span>/&gt;
          &lt;<span class="hl-tag">/form:select</span>&gt;
      &lt;<span class="hl-tag">/td</span>&gt;
  &lt;<span class="hl-tag">/tr</span>&gt;</pre><p>If the <code class="literal">User's</code> house was in Gryffindor, the
        HTML source of the 'House' row would look like:</p><pre class="programlisting">&lt;<span class="hl-tag">tr</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;House:&lt;<span class="hl-tag">/td</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;
          &lt;<span class="hl-tag">select</span> <span class="hl-attribute">name</span>=<span class="hl-value">"house"</span>&gt;
              &lt;<span class="hl-tag">option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Gryffindor"</span> <span class="hl-attribute">selected</span>=<span class="hl-value">"selected"</span>&gt;Gryffindor&lt;<span class="hl-tag">/option</span>&gt;
              &lt;<span class="hl-tag">option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Hufflepuff"</span>&gt;Hufflepuff&lt;<span class="hl-tag">/option</span>&gt;
              &lt;<span class="hl-tag">option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Ravenclaw"</span>&gt;Ravenclaw&lt;<span class="hl-tag">/option</span>&gt;
              &lt;<span class="hl-tag">option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Slytherin"</span>&gt;Slytherin&lt;<span class="hl-tag">/option</span>&gt;
          &lt;<span class="hl-tag">/select</span>&gt;
      &lt;<span class="hl-tag">/td</span>&gt;
   &lt;<span class="hl-tag">/tr</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-optionstag"></a>17.2.4.11&nbsp;The <code class="literal">options</code> tag</h4></div></div></div><p>This tag renders a list of HTML 'option' tags. It sets the
        'selected' attribute as appropriate based on the bound value.</p><pre class="programlisting">&lt;<span class="hl-tag">tr</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;Country:&lt;<span class="hl-tag">/td</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;
          &lt;<span class="hl-tag">form:select</span> <span class="hl-attribute">path</span>=<span class="hl-value">"country"</span>&gt;
              &lt;<span class="hl-tag">form:option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"-"</span> <span class="hl-attribute">label</span>=<span class="hl-value">"--Please Select"</span>/&gt;
              &lt;<span class="hl-tag">form:options</span> <span class="hl-attribute">items</span>=<span class="hl-value">"${countryList}"</span> <span class="hl-attribute">itemValue</span>=<span class="hl-value">"code"</span> <span class="hl-attribute">itemLabel</span>=<span class="hl-value">"name"</span>/&gt;
          &lt;<span class="hl-tag">/form:select</span>&gt;
      &lt;<span class="hl-tag">/td</span>&gt;
  &lt;<span class="hl-tag">/tr</span>&gt;</pre><p>If the <code class="classname">User</code> lived in the UK, the HTML
        source of the 'Country' row would look like:</p><pre class="programlisting">&lt;<span class="hl-tag">tr</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;Country:&lt;<span class="hl-tag">/td</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;
          &lt;<span class="hl-tag">select</span> <span class="hl-attribute">name</span>=<span class="hl-value">"country"</span>&gt;
              &lt;<span class="hl-tag">option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"-"</span>&gt;--Please Select&lt;<span class="hl-tag">/option</span>&gt;
              &lt;<span class="hl-tag">option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AT"</span>&gt;Austria&lt;<span class="hl-tag">/option</span>&gt;
              &lt;<span class="hl-tag">option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"UK"</span> <span class="hl-attribute">selected</span>=<span class="hl-value">"selected"</span>&gt;United Kingdom&lt;<span class="hl-tag">/option</span>&gt;
              &lt;<span class="hl-tag">option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"US"</span>&gt;United States&lt;<span class="hl-tag">/option</span>&gt;
          &lt;<span class="hl-tag">/select</span>&gt;
      &lt;<span class="hl-tag">/td</span>&gt;
  &lt;<span class="hl-tag">/tr</span>&gt;</pre><p>As the example shows, the combined usage of an
        <code class="literal">option</code> tag with the <code class="literal">options</code> tag
        generates the same standard HTML, but allows you to explicitly specify
        a value in the JSP that is for display only (where it belongs) such as
        the default string in the example: "-- Please Select".</p><p>The <code class="literal">items</code> attribute is typically populated
        with a collection or array of item objects.
        <code class="literal">itemValue</code> and <code class="literal">itemLabel</code> simply
        refer to bean properties of those item objects, if specified;
        otherwise, the item objects themselves will be stringified.
        Alternatively, you may specify a <code class="literal">Map</code> of items, in
        which case the map keys are interpreted as option values and the map
        values correspond to option labels. If <code class="literal">itemValue</code>
        and/or <code class="literal">itemLabel</code> happen to be specified as well,
        the item value property will apply to the map key and the item label
        property will apply to the map value.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-textAreatag"></a>17.2.4.12&nbsp;The <code class="literal">textarea</code> tag</h4></div></div></div><p>This tag renders an HTML 'textarea'.</p><pre class="programlisting">&lt;<span class="hl-tag">tr</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;Notes:&lt;<span class="hl-tag">/td</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:textarea</span> <span class="hl-attribute">path</span>=<span class="hl-value">"notes"</span> <span class="hl-attribute">rows</span>=<span class="hl-value">"3"</span> <span class="hl-attribute">cols</span>=<span class="hl-value">"20"</span> /&gt;&lt;<span class="hl-tag">/td</span>&gt;
      &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:errors</span> <span class="hl-attribute">path</span>=<span class="hl-value">"notes"</span> /&gt;&lt;<span class="hl-tag">/td</span>&gt;
  &lt;<span class="hl-tag">/tr</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-hiddeninputtag"></a>17.2.4.13&nbsp;The <code class="literal">hidden</code> tag</h4></div></div></div><p>This tag renders an HTML 'input' tag with type 'hidden' using
        the bound value. To submit an unbound hidden value, use the HTML
        <code class="literal">input</code> tag with type 'hidden'.</p><pre class="programlisting">&lt;<span class="hl-tag">form:hidden</span> <span class="hl-attribute">path</span>=<span class="hl-value">"house"</span> /&gt;
  </pre><p>If we choose to submit the 'house' value as a hidden one, the
        HTML would look like:</p><pre class="programlisting">&lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"house"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"hidden"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Gryffindor"</span>/&gt;
  </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-errorstag"></a>17.2.4.14&nbsp;The <code class="literal">errors</code> tag</h4></div></div></div><p>This tag renders field errors in an HTML 'span' tag. It provides
        access to the errors created in your controller or those that were
        created by any validators associated with your controller.</p><p>Let's assume we want to display all error messages for the
        <code class="literal">firstName</code> and <code class="literal">lastName</code> fields
        once we submit the form. We have a validator for instances of the
        <code class="classname">User</code> class called
        <code class="classname">UserValidator</code>.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UserValidator <span class="hl-keyword">implements</span> Validator {

      <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> supports(Class candidate) {
          <span class="hl-keyword">return</span> User.<span class="hl-keyword">class</span>.isAssignableFrom(candidate);
      }

      <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validate(Object obj, Errors errors) {
          ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="hl-string">"firstName"</span>, <span class="hl-string">"required"</span>, <span class="hl-string">"Field is required."</span>);
          ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="hl-string">"lastName"</span>, <span class="hl-string">"required"</span>, <span class="hl-string">"Field is required."</span>);
      }
  }</pre><p>The <code class="literal">form.jsp</code> would look like:</p><pre class="programlisting">&lt;<span class="hl-tag">form:form</span>&gt;
      &lt;<span class="hl-tag">table</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;First Name:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">"firstName"</span> /&gt;&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">%--</span> <span class="hl-attribute">Show</span> <span class="hl-attribute">errors</span> <span class="hl-attribute">for</span> <span class="hl-attribute">firstName</span> <span class="hl-attribute">field</span> <span class="hl-attribute">--%&gt;</span>
              <span class="hl-attribute">&lt;td&gt;&lt;form:errors</span> <span class="hl-attribute">path</span>=<span class="hl-value">"firstName"</span> /&gt;&lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;

          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;Last Name:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">"lastName"</span> /&gt;&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">%--</span> <span class="hl-attribute">Show</span> <span class="hl-attribute">errors</span> <span class="hl-attribute">for</span> <span class="hl-attribute">lastName</span> <span class="hl-attribute">field</span> <span class="hl-attribute">--%&gt;</span>
              <span class="hl-attribute">&lt;td&gt;&lt;form:errors</span> <span class="hl-attribute">path</span>=<span class="hl-value">"lastName"</span>  /&gt;&lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">"3"</span>&gt;
                  &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Save Changes"</span> /&gt;
              &lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
      &lt;<span class="hl-tag">/table</span>&gt;
  &lt;<span class="hl-tag">/form:form</span>&gt;</pre><p>If we submit a form with empty values in the
        <code class="literal">firstName</code> and <code class="literal">lastName</code> fields,
        this is what the HTML would look like:</p><pre class="programlisting">&lt;<span class="hl-tag">form</span> <span class="hl-attribute">method</span>=<span class="hl-value">"POST"</span>&gt;
      &lt;<span class="hl-tag">table</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;First Name:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"firstName"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">value</span>=<span class="hl-value">""</span>/&gt;&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">%--</span> <span class="hl-attribute">Associated</span> <span class="hl-attribute">errors</span> <span class="hl-attribute">to</span> <span class="hl-attribute">firstName</span> <span class="hl-attribute">field</span> <span class="hl-attribute">displayed</span> <span class="hl-attribute">--%&gt;</span>
              <span class="hl-attribute">&lt;td&gt;&lt;span</span> <span class="hl-attribute">name</span>=<span class="hl-value">"firstName.errors"</span>&gt;Field is required.&lt;<span class="hl-tag">/span</span>&gt;&lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;

          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;Last Name:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lastName"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">value</span>=<span class="hl-value">""</span>/&gt;&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">%--</span> <span class="hl-attribute">Associated</span> <span class="hl-attribute">errors</span> <span class="hl-attribute">to</span> <span class="hl-attribute">lastName</span> <span class="hl-attribute">field</span> <span class="hl-attribute">displayed</span> <span class="hl-attribute">--%&gt;</span>
              <span class="hl-attribute">&lt;td&gt;&lt;span</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lastName.errors"</span>&gt;Field is required.&lt;<span class="hl-tag">/span</span>&gt;&lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">"3"</span>&gt;
                  &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Save Changes"</span> /&gt;
              &lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
      &lt;<span class="hl-tag">/table</span>&gt;
  &lt;<span class="hl-tag">/form</span>&gt;</pre><p>What if we want to display the entire list of errors for a given
        page? The example below shows that the <code class="literal">errors</code> tag
        also supports some basic wildcarding functionality.</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">path="*"</code> - displays all errors</p></li><li><p><code class="literal">path="lastName"</code> - displays all errors
            associated with the <code class="literal">lastName</code> field</p></li><li><p>if <code class="literal">path</code> is omitted - object errors only are displayed</p></li></ul></div><p>The example below will display a list of errors at the top of
        the page, followed by field-specific errors next to the fields:</p><pre class="programlisting">&lt;<span class="hl-tag">form:form</span>&gt;
      &lt;<span class="hl-tag">form:errors</span> <span class="hl-attribute">path</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">cssClass</span>=<span class="hl-value">"errorBox"</span> /&gt;
      &lt;<span class="hl-tag">table</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;First Name:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">"firstName"</span> /&gt;&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:errors</span> <span class="hl-attribute">path</span>=<span class="hl-value">"firstName"</span> /&gt;&lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;Last Name:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">"lastName"</span> /&gt;&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">form:errors</span> <span class="hl-attribute">path</span>=<span class="hl-value">"lastName"</span>  /&gt;&lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">"3"</span>&gt;
                  &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Save Changes"</span> /&gt;
              &lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
      &lt;<span class="hl-tag">/table</span>&gt;
  &lt;<span class="hl-tag">/form:form</span>&gt;</pre><p>The HTML would look like:</p><pre class="programlisting">&lt;<span class="hl-tag">form</span> <span class="hl-attribute">method</span>=<span class="hl-value">"POST"</span>&gt;
      &lt;<span class="hl-tag">span</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*.errors"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"errorBox"</span>&gt;Field is required.&lt;<span class="hl-tag">br</span>/&gt;Field is required.&lt;<span class="hl-tag">/span</span>&gt;
      &lt;<span class="hl-tag">table</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;First Name:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"firstName"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">value</span>=<span class="hl-value">""</span>/&gt;&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">span</span> <span class="hl-attribute">name</span>=<span class="hl-value">"firstName.errors"</span>&gt;Field is required.&lt;<span class="hl-tag">/span</span>&gt;&lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;

          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;Last Name:&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lastName"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">value</span>=<span class="hl-value">""</span>/&gt;&lt;<span class="hl-tag">/td</span>&gt;
              &lt;<span class="hl-tag">td</span>&gt;&lt;<span class="hl-tag">span</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lastName.errors"</span>&gt;Field is required.&lt;<span class="hl-tag">/span</span>&gt;&lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
          &lt;<span class="hl-tag">tr</span>&gt;
              &lt;<span class="hl-tag">td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">"3"</span>&gt;
                  &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Save Changes"</span> /&gt;
              &lt;<span class="hl-tag">/td</span>&gt;
          &lt;<span class="hl-tag">/tr</span>&gt;
  &lt;<span class="hl-tag">/form</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="rest-method-conversion"></a>17.2.4.15&nbsp;HTTP Method Conversion</h4></div></div></div><p>A key principle of REST is the use of the Uniform Interface.
        This means that all resources (URLs) can be manipulated using the same
        four HTTP methods: GET, PUT, POST, and DELETE. For each method, the
        HTTP specification defines the exact semantics. For instance, a GET
        should always be a safe operation, meaning that is has no side
        effects, and a PUT or DELETE should be idempotent, meaning that you
        can repeat these operations over and over again, but the end result
        should be the same. While HTTP defines these four methods, HTML only
        supports two: GET and POST. Fortunately, there are two possible
        workarounds: you can either use JavaScript to do your PUT or DELETE,
        or simply do a POST with the 'real' method as an additional parameter
        (modeled as a hidden input field in an HTML form). This latter trick
        is what Spring's <code class="classname">HiddenHttpMethodFilter</code> does.
        This filter is a plain Servlet Filter and therefore it can be used in
        combination with any web framework (not just Spring MVC). Simply add
        this filter to your web.xml, and a POST with a hidden _method
        parameter will be converted into the corresponding HTTP method
        request.</p><p>To support HTTP method conversion the Spring MVC form tag was
        updated to support setting the HTTP method. For example, the following
        snippet taken from the updated Petclinic sample</p><pre class="programlisting">&lt;<span class="hl-tag">form:form</span> <span class="hl-attribute">method</span>=<span class="hl-value">"delete"</span>&gt;
      &lt;<span class="hl-tag">p</span> <span class="hl-attribute">class</span>=<span class="hl-value">"submit"</span>&gt;&lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Delete Pet"</span>/&gt;&lt;<span class="hl-tag">/p</span>&gt;
&lt;<span class="hl-tag">/form:form</span>&gt;</pre><p>This will actually perform an HTTP POST, with the 'real' DELETE
        method hidden behind a request parameter, to be picked up by the
        <code class="classname">HiddenHttpMethodFilter</code>, as defined in web.xml:</p><pre class="programlisting">&lt;filter&gt;
    &lt;filter-name&gt;httpMethodFilter&lt;/filter-name&gt;
    &lt;filter-<span class="hl-keyword">class</span>&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;/filter-<span class="hl-keyword">class</span>&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;httpMethodFilter&lt;/filter-name&gt;
    &lt;servlet-name&gt;petclinic&lt;/servlet-name&gt;
&lt;/filter-mapping&gt;</pre><p>The corresponding @Controller method
        is shown below:</p><pre class="programlisting">@RequestMapping(method = RequestMethod.DELETE)
<span class="hl-keyword">public</span> String deletePet(@PathVariable <span class="hl-keyword">int</span> ownerId, @PathVariable <span class="hl-keyword">int</span> petId) {
  <span class="hl-keyword">this</span>.clinic.deletePet(petId);
  <span class="hl-keyword">return</span> <span class="hl-string">"redirect:/owners/"</span> + ownerId;
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jsp-formtaglib-html5"></a>17.2.4.16&nbsp;HTML5 Tags</h4></div></div></div><p>Starting with Spring 3, the Spring form tag library allows entering
		dynamic attributes, which means you can enter any HTML5 specific attributes.
		</p><p>In Spring 3.1, the form input tag supports entering a type attribute
		other than 'text'. This is intended to allow rendering new HTML5 specific
        input types such as 'email', 'date', 'range', and others. Note that 
        entering type='text' is not required since 'text' is the default type.    
		</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-tiles"></a>17.3&nbsp;Tiles</h2></div></div></div><p>It is possible to integrate Tiles - just as any other view
    technology - in web applications using Spring. The following describes in
    a broad way how to do this.</p><p><span class="emphasis"><em>NOTE:</em></span> This section focuses on Spring's support
    for Tiles 2 (the standalone version of Tiles, requiring Java 5+) in the
    <code class="literal">org.springframework.web.servlet.view.tiles2</code> package.
    Spring also continues to support Tiles 1.x (a.k.a. "Struts Tiles", as
    shipped with Struts 1.1+; compatible with Java 1.4) in the original
    <code class="literal">org.springframework.web.servlet.view.tiles</code>
    package.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-tiles-dependencies"></a>17.3.1&nbsp;Dependencies</h3></div></div></div><p>To be able to use Tiles you have to have a couple of additional
      dependencies included in your project. The following is the list of
      dependencies you need.</p><div class="itemizedlist"><ul type="disc" compact><li><p><code class="literal">Tiles version 2.1.2 or higher</code></p></li><li><p><code class="literal">Commons BeanUtils</code></p></li><li><p><code class="literal">Commons Digester</code></p></li><li><p><code class="literal">Commons Logging</code></p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-tiles-integrate"></a>17.3.2&nbsp;How to integrate Tiles</h3></div></div></div><p>To be able to use Tiles, you have to configure it using files
      containing definitions (for basic information on definitions and other
      Tiles concepts, please have a look at <a class="ulink" href="http://tiles.apache.org" target="_top">http://tiles.apache.org</a>). In Spring this is done using the
      <code class="classname">TilesConfigurer</code>. Have a look at the following
      piece of example ApplicationContext configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"tilesConfigurer"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.tiles2.TilesConfigurer"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"definitions"</span>&gt;
    &lt;<span class="hl-tag">list</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;/WEB-INF/defs/general.xml&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;/WEB-INF/defs/widgets.xml&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;/WEB-INF/defs/administrator.xml&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;/WEB-INF/defs/customer.xml&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;/WEB-INF/defs/templates.xml&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>As you can see, there are five files containing definitions, which
      are all located in the <code class="filename">'WEB-INF/defs'</code> directory. At initialization
      of the <code class="interfacename">WebApplicationContext</code>, the files
      will be loaded and the definitions factory will be initialized. After
      that has been done, the Tiles includes in the definition files can be
      used as views within your Spring web application. To be able to use the
      views you have to have a <code class="interfacename">ViewResolver</code>
      just as with any other view technology used with Spring. Below you can
      find two possibilities, the <code class="classname">UrlBasedViewResolver</code>
      and the <code class="classname">ResourceBundleViewResolver</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-tiles-url"></a>17.3.2.1&nbsp;
          <code class="classname">UrlBasedViewResolver</code>
        </h4></div></div></div><p>The <code class="classname">UrlBasedViewResolver</code> instantiates the
        given <code class="literal">viewClass</code> for each view it has to
        resolve.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.UrlBasedViewResolver"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewClass"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.web.servlet.view.tiles2.TilesView"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-tiles-resource"></a>17.3.2.2&nbsp;
          <code class="classname">ResourceBundleViewResolver</code>
        </h4></div></div></div><p>The <code class="classname">ResourceBundleViewResolver</code> has to be
        provided with a property file containing viewnames and viewclasses the
        resolver can use:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.ResourceBundleViewResolver"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"basename"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"views"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><pre class="programlisting">...
welcomeView.(<span class="hl-keyword">class</span>)=org.springframework.web.servlet.view.tiles2.TilesView
welcomeView.url=welcome (<span class="hl-keyword">this</span> is the name of a Tiles definition)

vetsView.(<span class="hl-keyword">class</span>)=org.springframework.web.servlet.view.tiles2.TilesView
vetsView.url=vetsView (again, <span class="hl-keyword">this</span> is the name of a Tiles definition)

findOwnersForm.(<span class="hl-keyword">class</span>)=org.springframework.web.servlet.view.JstlView
findOwnersForm.url=/WEB-INF/jsp/findOwners.jsp
...</pre><p>As you can see, when using the
        <code class="classname">ResourceBundleViewResolver</code>, you can easily mix
        different view technologies.</p><p>Note that the <code class="classname">TilesView</code> class for Tiles 2
	      supports JSTL (the JSP Standard Tag Library) out of the box, whereas
	      there is a separate <code class="classname">TilesJstlView</code> subclass in the
	      Tiles 1.x support.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-tiles-preparer"></a>17.3.2.3&nbsp;<code class="classname">SimpleSpringPreparerFactory</code> and
        <code class="classname">SpringBeanPreparerFactory</code></h4></div></div></div><p>As an advanced feature, Spring also supports two special Tiles 2
        <code class="interfacename">PreparerFactory</code> implementations. Check
        out the Tiles documentation for details on how to use
        <code class="interfacename">ViewPreparer</code> references in your Tiles
        definition files.</p><p>Specify <code class="classname">SimpleSpringPreparerFactory</code> to
        autowire ViewPreparer instances based on specified preparer classes,
        applying Spring's container callbacks as well as applying configured
        Spring BeanPostProcessors. If Spring's context-wide annotation-config
        has been activated, annotations in ViewPreparer classes will be
        automatically detected and applied. Note that this expects preparer
        <span class="emphasis"><em>classes</em></span> in the Tiles definition files, just like
        the default <code class="classname">PreparerFactory</code> does.</p><p>Specify <code class="classname">SpringBeanPreparerFactory</code> to
        operate on specified preparer <span class="emphasis"><em>names</em></span> instead of
        classes, obtaining the corresponding Spring bean from the
        DispatcherServlet's application context. The full bean creation
        process will be in the control of the Spring application context in
        this case, allowing for the use of explicit dependency injection
        configuration, scoped beans etc. Note that you need to define one
        Spring bean definition per preparer name (as used in your Tiles
        definitions).</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"tilesConfigurer"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.tiles2.TilesConfigurer"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"definitions"</span>&gt;
    &lt;<span class="hl-tag">list</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;/WEB-INF/defs/general.xml&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;/WEB-INF/defs/widgets.xml&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;/WEB-INF/defs/administrator.xml&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;/WEB-INF/defs/customer.xml&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;/WEB-INF/defs/templates.xml&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;

  &lt;<span class="hl-comment">!-- resolving preparer names as Spring bean definition names --</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"preparerFactoryClass"</span>
       <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.web.servlet.view.tiles2.SpringBeanPreparerFactory"</span>/&gt;

&lt;<span class="hl-tag">/bean</span>&gt;</pre></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-velocity"></a>17.4&nbsp;Velocity &amp; FreeMarker</h2></div></div></div><p><a class="ulink" href="http://velocity.apache.org" target="_top">Velocity</a> and <a class="ulink" href="http://www.freemarker.org" target="_top">FreeMarker</a> are two templating
    languages that can be used as view technologies within Spring MVC
    applications. The languages are quite similar and serve similar needs and
    so are considered together in this section. For semantic and syntactic
    differences between the two languages, see the <a class="ulink" href="http://www.freemarker.org" target="_top">FreeMarker</a> web site.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-velocity-dependencies"></a>17.4.1&nbsp;Dependencies</h3></div></div></div><p>Your web application will need to include <code class="filename">velocity-1.x.x.jar</code> or <code class="filename">freemarker-2.x.jar</code> in order to work with
      Velocity or FreeMarker respectively and <code class="filename">commons-collections.jar</code> is required for
      Velocity. Typically they are included in the
      <code class="literal">WEB-INF/lib</code> folder where they are guaranteed to be
      found by a Java EE server and added to the classpath for your application.
      It is of course assumed that you already have the <code class="filename">spring-webmvc.jar</code> in your <code class="filename">'WEB-INF/lib'</code> directory too! If you make use of
      Spring's 'dateToolAttribute' or 'numberToolAttribute' in your Velocity
      views, you will also need to include the <code class="filename">velocity-tools-generic-1.x.jar</code></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-velocity-contextconfig"></a>17.4.2&nbsp;Context configuration</h3></div></div></div><p>A suitable configuration is initialized by adding the relevant
      configurer bean definition to your <code class="filename">'*-servlet.xml'</code>
      as shown below:</p><pre class="programlisting">&lt;<span class="hl-comment">!-- 
  This bean sets up the Velocity environment for us based on a root path for templates.
  Optionally, a properties file can be specified for more control over the Velocity
  environment, but the defaults are pretty sane for file based template loading.
--</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"velocityConfig"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.velocity.VelocityConfigurer"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"resourceLoaderPath"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/velocity/"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-comment">!-- 

  View resolvers can also be configured with ResourceBundles or XML files. If you need
  different view resolving based on Locale, you have to use the resource bundle resolver.

--</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.velocity.VelocityViewResolver"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"cache"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"prefix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">""</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"suffix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">".vm"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&lt;!-- freemarker config --&gt;</span></em>
&lt;bean id="freemarkerConfig" class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer"&gt;
  &lt;property name="templateLoaderPath" value="/WEB-INF/freemarker/"/&gt;
&lt;/bean&gt;

<em class="lineannotation"><span class="lineannotation">&lt;!-- 

  View resolvers can also be configured with ResourceBundles or XML files. If you need
  different view resolving based on Locale, you have to use the resource bundle resolver.

--&gt;</span></em>
&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver"&gt;
  &lt;property name="cache" value="true"/&gt;
  &lt;property name="prefix" value=""/&gt;
  &lt;property name="suffix" value=".ftl"/&gt;
&lt;/bean&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>For non web-apps add a
        <code class="classname">VelocityConfigurationFactoryBean</code> or a
        <code class="classname">FreeMarkerConfigurationFactoryBean</code> to your
        application context definition file.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-velocity-createtemplates"></a>17.4.3&nbsp;Creating templates</h3></div></div></div><p>Your templates need to be stored in the directory specified by the
      <code class="literal">*Configurer</code> bean shown above. This document does not
      cover details of creating templates for the two languages - please see
      their relevant websites for information. If you use the view resolvers
      highlighted, then the logical view names relate to the template file
      names in similar fashion to
      <code class="classname">InternalResourceViewResolver</code> for JSP's. So if
      your controller returns a ModelAndView object containing a view name of
      "welcome" then the resolvers will look for the
      <code class="literal">/WEB-INF/freemarker/welcome.ftl</code> or
      <code class="literal">/WEB-INF/velocity/welcome.vm</code> template as
      appropriate.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-velocity-advancedconfig"></a>17.4.4&nbsp;Advanced configuration</h3></div></div></div><p>The basic configurations highlighted above will be suitable for
      most application requirements, however additional configuration options
      are available for when unusual or advanced requirements dictate.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-velocity-example-velocityproperties"></a>17.4.4.1&nbsp;velocity.properties</h4></div></div></div><p>This file is completely optional, but if specified, contains the
        values that are passed to the Velocity runtime in order to configure
        velocity itself. Only required for advanced configurations, if you
        need this file, specify its location on the
        <code class="literal">VelocityConfigurer</code> bean definition above.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"velocityConfig"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.velocity.VelocityConfigurer"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"configLocation"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/velocity.properties"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Alternatively, you can specify velocity properties directly in
        the bean definition for the Velocity config bean by replacing the
        "configLocation" property with the following inline properties.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"velocityConfig"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.velocity.VelocityConfigurer"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"velocityProperties"</span>&gt;
    &lt;<span class="hl-tag">props</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"resource.loader"</span>&gt;file&lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"file.resource.loader.class"</span>&gt;
        org.apache.velocity.runtime.resource.loader.FileResourceLoader
      &lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"file.resource.loader.path"</span>&gt;${webapp.root}/WEB-INF/velocity&lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"file.resource.loader.cache"</span>&gt;false&lt;<span class="hl-tag">/prop</span>&gt;
    &lt;<span class="hl-tag">/props</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Refer to the <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/ui/velocity/VelocityEngineFactory.html" target="_top">API
        documentation</a> for Spring configuration of Velocity, or the
        Velocity documentation for examples and definitions of the
        <code class="filename">'velocity.properties'</code> file itself.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="views-freemarker"></a>17.4.4.2&nbsp;FreeMarker</h4></div></div></div><p>FreeMarker 'Settings' and 'SharedVariables' can be passed
        directly to the FreeMarker <code class="literal">Configuration</code> object
        managed by Spring by setting the appropriate bean properties on the
        <code class="literal">FreeMarkerConfigurer</code> bean. The
        <code class="literal">freemarkerSettings</code> property requires a
        <code class="literal">java.util.Properties</code> object and the
        <code class="literal">freemarkerVariables</code> property requires a
        <code class="literal">java.util.Map</code>.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"freemarkerConfig"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"templateLoaderPath"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/freemarker/"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"freemarkerVariables"</span>&gt;
    &lt;<span class="hl-tag">map</span>&gt;
      &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"xml_escape"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"fmXmlEscape"</span>/&gt;
    &lt;<span class="hl-tag">/map</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fmXmlEscape"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"freemarker.template.utility.XmlEscape"</span>/&gt;</pre><p>See the FreeMarker documentation for details of settings and
        variables as they apply to the <code class="classname">Configuration</code>
        object.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-velocity-forms"></a>17.4.5&nbsp;Bind support and form handling</h3></div></div></div><p>Spring provides a tag library for use in JSP's that contains
      (amongst other things) a <code class="literal">&lt;spring:bind/&gt;</code> tag.
      This tag primarily enables forms to display values from form backing
      objects and to show the results of failed validations from a
      <code class="literal">Validator</code> in the web or business tier. From version
      1.1, Spring now has support for the same functionality in both Velocity
      and FreeMarker, with additional convenience macros for generating form
      input elements themselves.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-bind-macros"></a>17.4.5.1&nbsp;The bind macros</h4></div></div></div><p>A standard set of macros are maintained within the
        <code class="literal">spring-webmvc.jar</code> file for both languages, so they are
        always available to a suitably configured application.</p><p>Some of the macros defined in the Spring libraries are
        considered internal (private) but no such scoping exists in the macro
        definitions making all macros visible to calling code and user
        templates. The following sections concentrate only on the macros you
        need to be directly calling from within your templates. If you wish to
        view the macro code directly, the files are called spring.vm /
        spring.ftl and are in the packages
        <code class="literal">org.springframework.web.servlet.view.velocity</code> or
        <code class="literal">org.springframework.web.servlet.view.freemarker</code>
        respectively.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-simple-binding"></a>17.4.5.2&nbsp;Simple binding</h4></div></div></div><p>In your html forms (vm / ftl templates) that act as the
        'formView' for a Spring form controller, you can use code similar to
        the following to bind to field values and display error messages for
        each input field in similar fashion to the JSP equivalent. Note that
        the name of the command object is "command" by default, but can be
        overridden in your MVC configuration by setting the 'commandName' bean
        property on your form controller. Example code is shown below for the
        <code class="literal">personFormV</code> and <code class="literal">personFormF</code>
        views configured earlier;</p><pre class="programlisting">&lt;<span class="hl-comment">!-- velocity macros are automatically available --</span>&gt;
&lt;<span class="hl-tag">html</span>&gt;
...
&lt;<span class="hl-tag">form</span> <span class="hl-attribute">action</span>=<span class="hl-value">""</span> <span class="hl-attribute">method</span>=<span class="hl-value">"POST"</span>&gt;
  Name: 
  #springBind( "command.name" )
  &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text"</span> 
    <span class="hl-attribute">name</span>=<span class="hl-value">"${status.expression}"</span> 
    <span class="hl-attribute">value</span>=<span class="hl-value">"$!status.value"</span> /&gt;&lt;<span class="hl-tag">br</span>&gt;
  #foreach($error in $status.errorMessages) &lt;<span class="hl-tag">b</span>&gt;$error&lt;<span class="hl-tag">/b</span>&gt; &lt;<span class="hl-tag">br</span>&gt; #end
  &lt;<span class="hl-tag">br</span>&gt;
  ... 
  &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"submit"</span>/&gt;
&lt;<span class="hl-tag">/form</span>&gt;
...
&lt;<span class="hl-tag">/html</span>&gt;</pre><pre class="programlisting">&lt;<span class="hl-comment">!-- freemarker macros have to be imported into a namespace.  We strongly
recommend sticking to 'spring' --</span>&gt;
&lt;<span class="hl-tag">#import</span> <span class="hl-attribute">"/spring.ftl"</span> <span class="hl-attribute">as</span> <span class="hl-attribute">spring</span> /&gt;
&lt;<span class="hl-tag">html</span>&gt;
...
&lt;<span class="hl-tag">form</span> <span class="hl-attribute">action</span>=<span class="hl-value">""</span> <span class="hl-attribute">method</span>=<span class="hl-value">"POST"</span>&gt;
  Name: 
  &lt;<span class="hl-tag">@spring.bind</span> <span class="hl-attribute">"command.name"</span> /&gt; 
  &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text"</span> 
    <span class="hl-attribute">name</span>=<span class="hl-value">"${spring.status.expression}"</span> 
    <span class="hl-attribute">value</span>=<span class="hl-value">"${spring.status.value?default("</span><span class="hl-attribute">")}"</span> /&gt;&lt;<span class="hl-tag">br</span>&gt;
  &lt;<span class="hl-tag">#list</span> <span class="hl-attribute">spring.status.errorMessages</span> <span class="hl-attribute">as</span> <span class="hl-attribute">error&gt;</span> <span class="hl-attribute">&lt;b&gt;${error}&lt;/b&gt;</span> <span class="hl-attribute">&lt;br&gt;</span> <span class="hl-attribute">&lt;/#list&gt;</span>
  <span class="hl-attribute">&lt;br&gt;</span>
  <span class="hl-attribute">...</span> 
  <span class="hl-attribute">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"submit"</span>/&gt;
&lt;<span class="hl-tag">/form</span>&gt;
...
&lt;<span class="hl-tag">/html</span>&gt;</pre><p><code class="literal">#springBind</code> /
        <code class="literal">&lt;@spring.bind&gt;</code> requires a 'path' argument
        which consists of the name of your command object (it will be
        'command' unless you changed it in your FormController properties)
        followed by a period and the name of the field on the command object
        you wish to bind to. Nested fields can be used too such as
        "command.address.street". The <code class="literal">bind</code> macro assumes
        the default HTML escaping behavior specified by the ServletContext
        parameter <code class="literal">defaultHtmlEscape</code> in web.xml</p><p>The optional form of the macro called
        <code class="literal">#springBindEscaped</code> /
        <code class="literal">&lt;@spring.bindEscaped&gt;</code> takes a second argument
        and explicitly specifies whether HTML escaping should be used in the
        status error messages or values. Set to true or false as required.
        Additional form handling macros simplify the use of HTML escaping and
        these macros should be used wherever possible. They are explained in
        the next section.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="views-form-macros"></a>17.4.5.3&nbsp;Form input generation macros</h4></div></div></div><p>Additional convenience macros for both languages simplify both
        binding and form generation (including validation error display). It
        is never necessary to use these macros to generate form input fields,
        and they can be mixed and matched with simple HTML or calls direct to
        the spring bind macros highlighted previously.</p><p>The following table of available macros show the VTL and FTL
        definitions and the parameter list that each takes.</p><div class="table"><a name="views-macros-defs-tbl"></a><p class="title"><b>Table&nbsp;17.1.&nbsp;Table of macro definitions</b></p><div class="table-contents"><table summary="Table of macro definitions" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="left"><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">macro</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">VTL definition</th><th style="border-bottom: 1.0pt solid ; " align="center">FTL definition</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><span class="bold"><strong>message</strong></span> (output a
                string from a resource bundle based on the code
                parameter)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">#springMessage($code)</code></td><td style="border-bottom: 1.0pt solid ; "><code class="literal">&lt;@spring.message
                code/&gt;</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><span class="bold"><strong>messageText</strong></span> (output a
                string from a resource bundle based on the code parameter,
                falling back to the value of the default parameter)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">#springMessageText($code
                $text)</code></td><td style="border-bottom: 1.0pt solid ; "><code class="literal">&lt;@spring.messageText code,
                text/&gt;</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><span class="bold"><strong>url</strong></span> (prefix a relative
                URL with the application's context root)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">#springUrl($relativeUrl)</code></td><td style="border-bottom: 1.0pt solid ; "><code class="literal">&lt;@spring.url
                relativeUrl/&gt;</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><span class="bold"><strong>formInput</strong></span> (standard
                input field for gathering user input)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">#springFormInput($path
                $attributes)</code></td><td style="border-bottom: 1.0pt solid ; "><code class="literal">&lt;@spring.formInput path, attributes,
                fieldType/&gt;</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><span class="bold"><strong>formHiddenInput *</strong></span>
                (hidden input field for submitting non-user input)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">#springFormHiddenInput($path
                $attributes)</code></td><td style="border-bottom: 1.0pt solid ; "><code class="literal">&lt;@spring.formHiddenInput path,
                attributes/&gt;</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><span class="bold"><strong>formPasswordInput</strong></span> *
                (standard input field for gathering passwords. Note that no
                value will ever be populated in fields of this type)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">#springFormPasswordInput($path
                $attributes)</code></td><td style="border-bottom: 1.0pt solid ; "><code class="literal">&lt;@spring.formPasswordInput path,
                attributes/&gt;</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><span class="bold"><strong>formTextarea</strong></span> (large
                text field for gathering long, freeform text input)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">#springFormTextarea($path
                $attributes)</code></td><td style="border-bottom: 1.0pt solid ; "><code class="literal">&lt;@spring.formTextarea path,
                attributes/&gt;</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><span class="bold"><strong>formSingleSelect</strong></span> (drop
                down box of options allowing a single required value to be
                selected)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">#springFormSingleSelect( $path $options
                $attributes)</code></td><td style="border-bottom: 1.0pt solid ; "><code class="literal">&lt;@spring.formSingleSelect path, options,
                attributes/&gt;</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><span class="bold"><strong>formMultiSelect</strong></span> (a
                list box of options allowing the user to select 0 or more
                values)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">#springFormMultiSelect($path $options
                $attributes)</code></td><td style="border-bottom: 1.0pt solid ; "><code class="literal">&lt;@spring.formMultiSelect path, options,
                attributes/&gt;</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><span class="bold"><strong>formRadioButtons</strong></span> (a
                set of radio buttons allowing a single selection to be made
                from the available choices)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">#springFormRadioButtons($path $options
                $separator $attributes)</code></td><td style="border-bottom: 1.0pt solid ; "><code class="literal">&lt;@spring.formRadioButtons path, options
                separator, attributes/&gt;</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><span class="bold"><strong>formCheckboxes</strong></span> (a set
                of checkboxes allowing 0 or more values to be
                selected)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">#springFormCheckboxes($path $options
                $separator $attributes)</code></td><td style="border-bottom: 1.0pt solid ; "><code class="literal">&lt;@spring.formCheckboxes path, options,
                separator, attributes/&gt;</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><span class="bold"><strong>formCheckbox</strong></span> (a single
                checkbox)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">#springFormCheckbox($path
                $attributes)</code></td><td style="border-bottom: 1.0pt solid ; "><code class="literal">&lt;@spring.formCheckbox path,
                attributes/&gt;</code></td></tr><tr><td style="border-right: 1.0pt solid ; " align="left"><span class="bold"><strong>showErrors</strong></span> (simplify
                display of validation errors for the bound field)</td><td style="border-right: 1.0pt solid ; "><code class="literal">#springShowErrors($separator
                $classOrStyle)</code></td><td style=""><code class="literal">&lt;@spring.showErrors separator,
                classOrStyle/&gt;</code></td></tr></tbody></table></div></div><br class="table-break"><p>* In FTL (FreeMarker), these two macros are not actually
        required as you can use the normal <code class="literal">formInput</code> macro,
        specifying '<code class="literal">hidden</code>' or
        '<code class="literal">password</code>' as the value for the
        <code class="literal">fieldType</code> parameter.</p><p>The parameters to any of the above macros have consistent
        meanings:</p><div class="itemizedlist"><ul type="disc"><li><p>path: the name of the field to bind to (ie
            "command.name")</p></li><li><p>options: a Map of all the available values that can be
            selected from in the input field. The keys to the map represent
            the values that will be POSTed back from the form and bound to the
            command object. Map objects stored against the keys are the labels
            displayed on the form to the user and may be different from the
            corresponding values posted back by the form. Usually such a map
            is supplied as reference data by the controller. Any Map
            implementation can be used depending on required behavior. For
            strictly sorted maps, a <code class="literal">SortedMap</code> such as a
            <code class="literal">TreeMap</code> with a suitable Comparator may be used
            and for arbitrary Maps that should return values in insertion
            order, use a <code class="literal">LinkedHashMap</code> or a
            <code class="literal">LinkedMap</code> from commons-collections.</p></li><li><p>separator: where multiple options are available as discreet
            elements (radio buttons or checkboxes), the sequence of characters
            used to separate each one in the list (ie "&lt;br&gt;").</p></li><li><p>attributes: an additional string of arbitrary tags or text
            to be included within the HTML tag itself. This string is echoed
            literally by the macro. For example, in a textarea field you may
            supply attributes as 'rows="5" cols="60"' or you could pass style
            information such as 'style="border:1px solid silver"'.</p></li><li><p>classOrStyle: for the showErrors macro, the name of the CSS
            class that the span tag wrapping each error will use. If no
            information is supplied (or the value is empty) then the errors
            will be wrapped in &lt;b&gt;&lt;/b&gt; tags.</p></li></ul></div><p>Examples of the macros are outlined below some in FTL and some
        in VTL. Where usage differences exist between the two languages, they
        are explained in the notes.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="views-form-macros-input"></a>Input Fields</h5></div></div></div><pre class="programlisting">&lt;<span class="hl-comment">!-- the Name field example from above using form macros in VTL --</span>&gt;
...
    Name:
    #springFormInput("command.name" "")&lt;<span class="hl-tag">br</span>&gt;
    #springShowErrors("&lt;<span class="hl-tag">br</span>&gt;" "")&lt;<span class="hl-tag">br</span>&gt;</pre><p>The formInput macro takes the path parameter (command.name)
          and an additional attributes parameter which is empty in the example
          above. The macro, along with all other form generation macros,
          performs an implicit spring bind on the path parameter. The binding
          remains valid until a new bind occurs so the showErrors macro
          doesn't need to pass the path parameter again - it simply operates
          on whichever field a bind was last created for.</p><p>The showErrors macro takes a separator parameter (the
          characters that will be used to separate multiple errors on a given
          field) and also accepts a second parameter, this time a class name
          or style attribute. Note that FreeMarker is able to specify default
          values for the attributes parameter, unlike Velocity, and the two
          macro calls above could be expressed as follows in FTL:</p><pre class="programlisting">&lt;<span class="hl-tag">@spring.formInput</span> <span class="hl-attribute">"command.name"/&gt;</span>
<span class="hl-attribute">&lt;@spring.showErrors</span> <span class="hl-attribute">"&lt;br&gt;"/&gt;</span></pre><p>Output is shown below of the form fragment generating the name
          field, and displaying a validation error after the form was
          submitted with no value in the field. Validation occurs through
          Spring's Validation framework.</p><p>The generated HTML looks like this:</p><pre class="programlisting">Name:
  &lt;input type="text" name="name" value=""     
&gt;
&lt;br&gt;
  &lt;b&gt;required&lt;/b&gt;
&lt;br&gt;
&lt;br&gt;</pre><p>The formTextarea macro works the same way as the formInput
          macro and accepts the same parameter list. Commonly, the second
          parameter (attributes) will be used to pass style information or
          rows and cols attributes for the textarea.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="views-form-macros-select"></a>Selection Fields</h5></div></div></div><p>Four selection field macros can be used to generate common UI
          value selection inputs in your HTML forms.</p><div class="itemizedlist"><ul type="disc"><li><p>formSingleSelect</p></li><li><p>formMultiSelect</p></li><li><p>formRadioButtons</p></li><li><p>formCheckboxes</p></li></ul></div><p>Each of the four macros accepts a Map of options containing
          the value for the form field, and the label corresponding to that
          value. The value and the label can be the same.</p><p>An example of radio buttons in FTL is below. The form backing
          object specifies a default value of 'London' for this field and so
          no validation is necessary. When the form is rendered, the entire
          list of cities to choose from is supplied as reference data in the
          model under the name 'cityMap'.</p><pre class="programlisting">...
  Town:
  &lt;@spring.formRadioButtons "command.address.town", cityMap, "" /&gt;&lt;br&gt;&lt;br&gt;</pre><p>This renders a line of radio buttons, one for each value in
          <code class="literal">cityMap</code> using the separator "". No additional
          attributes are supplied (the last parameter to the macro is
          missing). The cityMap uses the same String for each key-value pair
          in the map. The map's keys are what the form actually submits as
          POSTed request parameters, map values are the labels that the user
          sees. In the example above, given a list of three well known cities
          and a default value in the form backing object, the HTML would
          be</p><pre class="programlisting">Town:
&lt;input type="radio" name="address.town" value="London"
   
&gt;
London
&lt;input type="radio" name="address.town" value="Paris"
  checked="checked" 
&gt;
Paris
&lt;input type="radio" name="address.town" value="New York"
   
&gt;
New York</pre><p>If your application expects to handle cities by internal codes
          for example, the map of codes would be created with suitable keys
          like the example below.</p><pre class="programlisting"><span class="hl-keyword">protected</span> Map referenceData(HttpServletRequest request) <span class="hl-keyword">throws</span> Exception {
  Map cityMap = <span class="hl-keyword">new</span> LinkedHashMap();
  cityMap.put(<span class="hl-string">"LDN"</span>, <span class="hl-string">"London"</span>);
  cityMap.put(<span class="hl-string">"PRS"</span>, <span class="hl-string">"Paris"</span>);
  cityMap.put(<span class="hl-string">"NYC"</span>, <span class="hl-string">"New York"</span>);
  
  Map m = <span class="hl-keyword">new</span> HashMap();
  m.put(<span class="hl-string">"cityMap"</span>, cityMap);
  <span class="hl-keyword">return</span> m;
}</pre><p>The code would now produce output where the radio values are
          the relevant codes but the user still sees the more user friendly
          city names.</p><pre class="programlisting">Town:
&lt;input type="radio" name="address.town" value="LDN"
   
&gt;
London
&lt;input type="radio" name="address.town" value="PRS"
  checked="checked" 
&gt;
Paris
&lt;input type="radio" name="address.town" value="NYC"
   
&gt;
New York</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="views-form-macros-html-escaping"></a>17.4.5.4&nbsp;HTML escaping and XHTML compliance</h4></div></div></div><p>Default usage of the form macros above will result in HTML tags
        that are HTML 4.01 compliant and that use the default value for HTML
        escaping defined in your web.xml as used by Spring's bind support. In
        order to make the tags XHTML compliant or to override the default HTML
        escaping value, you can specify two variables in your template (or in
        your model where they will be visible to your templates). The
        advantage of specifying them in the templates is that they can be
        changed to different values later in the template processing to
        provide different behavior for different fields in your form.</p><p>To switch to XHTML compliance for your tags, specify a value of
        'true' for a model/context variable named xhtmlCompliant:</p><pre class="programlisting">## for Velocity..
#set($springXhtmlCompliant = true)

&lt;#-- for FreeMarker --&gt;
&lt;#assign xhtmlCompliant = true in spring&gt;</pre><p>Any tags generated by the Spring macros will now be XHTML
        compliant after processing this directive.</p><p>In similar fashion, HTML escaping can be specified per
        field:</p><pre class="programlisting">&lt;<span class="hl-tag">#--</span> <span class="hl-attribute">until</span> <span class="hl-attribute">this</span> <span class="hl-attribute">point,</span> <span class="hl-attribute">default</span> <span class="hl-attribute">HTML</span> <span class="hl-attribute">escaping</span> <span class="hl-attribute">is</span> <span class="hl-attribute">used</span> <span class="hl-attribute">--&gt;</span>

<span class="hl-attribute">&lt;#assign</span> <span class="hl-attribute">htmlEscape</span> = <span class="hl-value">true</span> <span class="hl-attribute">in</span> <span class="hl-attribute">spring&gt;</span>
<span class="hl-attribute">&lt;#--</span> <span class="hl-attribute">next</span> <span class="hl-attribute">field</span> <span class="hl-attribute">will</span> <span class="hl-attribute">use</span> <span class="hl-attribute">HTML</span> <span class="hl-attribute">escaping</span> <span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;@spring.formInput</span> <span class="hl-attribute">"command.name"</span> /&gt;

&lt;<span class="hl-tag">#assign</span> <span class="hl-attribute">htmlEscape</span> = <span class="hl-value">false</span> <span class="hl-attribute">in</span> <span class="hl-attribute">spring&gt;</span>
<span class="hl-attribute">&lt;#--</span> <span class="hl-attribute">all</span> <span class="hl-attribute">future</span> <span class="hl-attribute">fields</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">bound</span> <span class="hl-attribute">with</span> <span class="hl-attribute">HTML</span> <span class="hl-attribute">escaping</span> <span class="hl-attribute">off</span> <span class="hl-attribute">--&gt;</span></pre></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-xslt"></a>17.5&nbsp;XSLT</h2></div></div></div><p>XSLT is a transformation language for XML and is popular as a view
    technology within web applications. XSLT can be a good choice as a view
    technology if your application naturally deals with XML, or if your model
    can easily be converted to XML. The following section shows how to produce
    an XML document as model data and have it transformed with XSLT in a
    Spring Web MVC application.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-xslt-firstwords"></a>17.5.1&nbsp;My First Words</h3></div></div></div><p>This example is a trivial Spring application that creates a list
      of words in the <code class="interfacename">Controller</code> and adds them
      to the model map. The map is returned along with the view name of our
      XSLT view. See <a class="xref" href="#mvc-controller" title="16.3&nbsp;Implementing Controllers">Section&nbsp;16.3, &#8220;Implementing Controllers&#8221;</a> for details of Spring Web MVC's
      <code class="interfacename">Controller</code> interface. The XSLT view will
      turn the list of words into a simple XML document ready for
      transformation.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-xslt-beandefs"></a>17.5.1.1&nbsp;Bean definitions</h4></div></div></div><p>Configuration is standard for a simple Spring application. The
        dispatcher servlet config file contains a reference to a
        <code class="interfacename">ViewResolver</code>, URL mappings and a single
        controller bean...</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"homeController"</span><span class="hl-attribute">class</span>=<span class="hl-value">"xslt.HomeController"</span>/&gt;</pre><p>... that encapsulates our word generation logic.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-xslt-controllercode"></a>17.5.1.2&nbsp;Standard MVC controller code</h4></div></div></div><p>The controller logic is encapsulated in a subclass of
        <code class="classname">AbstractController</code>, with the handler method
        being defined like so...</p><pre class="programlisting"><span class="hl-keyword">protected</span> ModelAndView handleRequestInternal(
    HttpServletRequest request,
    HttpServletResponse response) <span class="hl-keyword">throws</span> Exception {
        
    Map map = <span class="hl-keyword">new</span> HashMap();
    List wordList = <span class="hl-keyword">new</span> ArrayList();
        
    wordList.add(<span class="hl-string">"hello"</span>);
    wordList.add(<span class="hl-string">"world"</span>);
       
    map.put(<span class="hl-string">"wordList"</span>, wordList);
      
    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ModelAndView(<span class="hl-string">"home"</span>, map);
}</pre><p>So far we've done nothing that's XSLT specific. The model data
        has been created in the same way as you would for any other Spring MVC
        application. Depending on the configuration of the application now,
        that list of words could be rendered by JSP/JSTL by having them added
        as request attributes, or they could be handled by Velocity by adding
        the object to the <code class="classname">VelocityContext</code>. In order to
        have XSLT render them, they of course have to be converted into an XML
        document somehow. There are software packages available that will
        automatically 'domify' an object graph, but within Spring, you have
        complete flexibility to create the DOM from your model in any way you
        choose. This prevents the transformation of XML playing too great a
        part in the structure of your model data which is a danger when using
        tools to manage the domification process.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-xslt-subclassing"></a>17.5.1.3&nbsp;Convert the model data to XML</h4></div></div></div><p>In order to create a DOM document from our list of words or any
        other model data, we must subclass the (provided)
        <code class="classname">org.springframework.web.servlet.view.xslt.AbstractXsltView</code>
        class. In doing so, we must also typically implement the abstract
        method <code class="methodname">createXsltSource(..)</code> method. The first
        parameter passed to this method is our model map. Here's the complete
        listing of the <code class="classname">HomePage</code> class in our trivial
        word application:</p><pre class="programlisting">
<span class="hl-keyword">package</span> xslt;

<span class="hl-comment">// imports omitted for brevity</span>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HomePage <span class="hl-keyword">extends</span> AbstractXsltView {

    <span class="hl-keyword">protected</span> Source createXsltSource(Map model, String rootName, HttpServletRequest
        request, HttpServletResponse response) <span class="hl-keyword">throws</span> Exception {

        Document document = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();
        Element root = document.createElement(rootName);

        List words = (List) model.get(<span class="hl-string">"wordList"</span>);
        <span class="hl-keyword">for</span> (Iterator it = words.iterator(); it.hasNext();) {
            String nextWord = (String) it.next();
            Element wordNode = document.createElement(<span class="hl-string">"word"</span>);
            Text textNode = document.createTextNode(nextWord);
            wordNode.appendChild(textNode);
            root.appendChild(wordNode);
        }
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> DOMSource(root);
    }

}</pre><p>A series of parameter name/value pairs can optionally be defined
        by your subclass which will be added to the transformation object. The
        parameter names must match those defined in your XSLT template
        declared with <code class="literal">&lt;xsl:param
        name="myParam"&gt;defaultValue&lt;/xsl:param&gt;</code>. To specify
        the parameters, override the <code class="methodname">getParameters()</code>
        method of the <code class="classname">AbstractXsltView</code> class and return
        a <code class="interfacename">Map</code> of the name/value pairs. If your
        parameters need to derive information from the current request, you
        can override the <code class="methodname">getParameters(HttpServletRequest
        request)</code> method instead.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-xslt-viewdefinitions"></a>17.5.1.4&nbsp;Defining the view properties</h4></div></div></div><p>The views.properties file (or equivalent xml definition if
        you're using an XML based view resolver as we did in the Velocity
        examples above) looks like this for the one-view application that is
        'My First Words':</p><pre class="programlisting">home.(class)=xslt.HomePage
home.stylesheetLocation=/WEB-INF/xsl/home.xslt
home.root=words</pre><p>Here, you can see how the view is tied in with the
        <code class="classname">HomePage</code> class just written which handles the
        model domification in the first property <code class="literal">'.(class)'</code>.
        The <code class="literal">'stylesheetLocation'</code> property points to the
        XSLT file which will handle the XML transformation into HTML for us
        and the final property <code class="literal">'.root'</code> is the name that
        will be used as the root of the XML document. This gets passed to the
        <code class="classname">HomePage</code> class above in the second parameter to
        the <code class="methodname">createXsltSource(..)</code> method(s).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-xslt-transforming"></a>17.5.1.5&nbsp;Document transformation</h4></div></div></div><p>Finally, we have the XSLT code used for transforming the above
        document. As shown in the above
        <code class="filename">'views.properties'</code> file, the stylesheet is called
        <code class="filename">'home.xslt'</code> and it lives in the war file in the
        <code class="filename">'WEB-INF/xsl'</code> directory.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="utf-8"?</span>&gt;
&lt;<span class="hl-tag">xsl:stylesheet</span> <span class="hl-attribute">version</span>=<span class="hl-value">"1.0"</span> <span class="hl-attribute">xmlns:xsl</span>=<span class="hl-value">"http://www.w3.org/1999/XSL/Transform"</span>&gt;

    &lt;<span class="hl-tag">xsl:output</span> <span class="hl-attribute">method</span>=<span class="hl-value">"html"</span> <span class="hl-attribute">omit-xml-declaration</span>=<span class="hl-value">"yes"</span>/&gt;

    &lt;<span class="hl-tag">xsl:template</span> <span class="hl-attribute">match</span>=<span class="hl-value">"/"</span>&gt;
        &lt;<span class="hl-tag">html</span>&gt;
            &lt;<span class="hl-tag">head</span>&gt;&lt;<span class="hl-tag">title</span>&gt;Hello!&lt;<span class="hl-tag">/title</span>&gt;&lt;<span class="hl-tag">/head</span>&gt;
            &lt;<span class="hl-tag">body</span>&gt;
                &lt;<span class="hl-tag">h1</span>&gt;My First Words&lt;<span class="hl-tag">/h1</span>&gt;
                &lt;<span class="hl-tag">xsl:apply-templates</span>/&gt;
            &lt;<span class="hl-tag">/body</span>&gt;
        &lt;<span class="hl-tag">/html</span>&gt;
    &lt;<span class="hl-tag">/xsl:template</span>&gt;

    &lt;<span class="hl-tag">xsl:template</span> <span class="hl-attribute">match</span>=<span class="hl-value">"word"</span>&gt;
        &lt;<span class="hl-tag">xsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"."</span>/&gt;&lt;<span class="hl-tag">br</span>/&gt;
    &lt;<span class="hl-tag">/xsl:template</span>&gt;

&lt;<span class="hl-tag">/xsl:stylesheet</span>&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-xslt-summary"></a>17.5.2&nbsp;Summary</h3></div></div></div><p>A summary of the files discussed and their location in the WAR
      file is shown in the simplified WAR structure below.</p><pre class="programlisting">ProjectRoot
  |
  +- WebContent
      |
      +- WEB-INF
          |
          +- classes
          |    |
          |    +- xslt
          |    |   |
          |    |   +- HomePageController.class 
          |    |   +- HomePage.class
          |    |
          |    +- views.properties
          |
          +- lib
          |   |
          |   +- spring-*.jar
          |
          +- xsl
          |   |
          |   +- home.xslt
          |
          +- frontcontroller-servlet.xml</pre><p>You will also need to ensure that an XML parser and an XSLT engine
      are available on the classpath. JDK 1.4 provides them by default, and
      most Java EE containers will also make them available by default, but it's
      a possible source of errors to be aware of.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-document"></a>17.6&nbsp;Document views (PDF/Excel)</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-document-intro"></a>17.6.1&nbsp;Introduction</h3></div></div></div><p>Returning an HTML page isn't always the best way for the user to
      view the model output, and Spring makes it simple to generate a PDF
      document or an Excel spreadsheet dynamically from the model data. The
      document is the view and will be streamed from the server with the
      correct content type to (hopefully) enable the client PC to run their
      spreadsheet or PDF viewer application in response.</p><p>In order to use Excel views, you need to add the 'poi' library to
      your classpath, and for PDF generation, the iText library.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-document-config"></a>17.6.2&nbsp;Configuration and setup</h3></div></div></div><p>Document based views are handled in an almost identical fashion to
      XSLT views, and the following sections build upon the previous one by
      demonstrating how the same controller used in the XSLT example is
      invoked to render the same model as both a PDF document and an Excel
      spreadsheet (which can also be viewed or manipulated in Open
      Office).</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-document-configviews"></a>17.6.2.1&nbsp;Document view definitions</h4></div></div></div><p>First, let's amend the views.properties file (or xml
        equivalent) and add a simple view definition for both document types.
        The entire file now looks like this with the XSLT view shown from
        earlier:</p><pre class="programlisting">home.(class)=xslt.HomePage
home.stylesheetLocation=/WEB-INF/xsl/home.xslt
home.root=words

xl.(class)=excel.HomePage

pdf.(class)=pdf.HomePage</pre><p><span class="emphasis"><em>If you want to start with a
        template spreadsheet or a fillable PDF form to add your model data to, specify the location
        as the 'url' property in the view definition</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-document-configcontroller"></a>17.6.2.2&nbsp;Controller code</h4></div></div></div><p>The controller code we'll use remains exactly the same from the
        XSLT example earlier other than to change the name of the view to use.
        Of course, you could be clever and have this selected based on a URL
        parameter or some other logic - proof that Spring really is very good
        at decoupling the views from the controllers!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-document-configsubclasses"></a>17.6.2.3&nbsp;Subclassing for Excel views</h4></div></div></div><p>Exactly as we did for the XSLT example, we'll subclass suitable
        abstract classes in order to implement custom behavior in generating
        our output documents. For Excel, this involves writing a subclass of
        <code class="literal">org.springframework.web.servlet.view.document.AbstractExcelView</code>
        (for Excel files generated by POI) or
        <code class="literal">org.springframework.web.servlet.view.document.AbstractJExcelView</code>
        (for JExcelApi-generated Excel files) and implementing the
        <code class="literal">buildExcelDocument()</code> method.</p><p>Here's the complete listing for our POI Excel view which
        displays the word list from the model map in consecutive rows of the
        first column of a new spreadsheet:</p><pre class="programlisting"><span class="hl-keyword">package</span> excel;

<span class="hl-comment">// imports omitted for brevity</span>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HomePage <span class="hl-keyword">extends</span> AbstractExcelView {

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> buildExcelDocument(
        Map model,
        HSSFWorkbook wb,
        HttpServletRequest req,
        HttpServletResponse resp)
        <span class="hl-keyword">throws</span> Exception {
    
        HSSFSheet sheet;
        HSSFRow sheetRow;
        HSSFCell cell;

        <span class="hl-comment">// Go to the first sheet</span>
        <span class="hl-comment">// getSheetAt: only if wb is created from an existing document</span>
        <span class="hl-comment">// sheet = wb.getSheetAt(0);</span>
        sheet = wb.createSheet(<span class="hl-string">"Spring"</span>);
        sheet.setDefaultColumnWidth((<span class="hl-keyword">short</span>) 12);

        <span class="hl-comment">// write a text at A1</span>
        cell = getCell(sheet, 0, 0);
        setText(cell, <span class="hl-string">"Spring-Excel test"</span>);

        List words = (List) model.get(<span class="hl-string">"wordList"</span>);
        <span class="hl-keyword">for</span> (<span class="hl-keyword">int</span> i=0; i &lt; words.size(); i++) {
            cell = getCell(sheet, 2+i, 0);
            setText(cell, (String) words.get(i));

        }
    }
}</pre><p>And the following is a view generating the same Excel file, now using
        JExcelApi:</p><pre class="programlisting"><span class="hl-keyword">package</span> excel;

<span class="hl-comment">// imports omitted for brevity</span>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HomePage <span class="hl-keyword">extends</span> AbstractJExcelView {

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> buildExcelDocument(Map model,
        WritableWorkbook wb,
        HttpServletRequest request,
        HttpServletResponse response)
    <span class="hl-keyword">throws</span> Exception {
			
        WritableSheet sheet = wb.createSheet(<span class="hl-string">"Spring"</span>, 0);

        sheet.addCell(<span class="hl-keyword">new</span> Label(0, 0, <span class="hl-string">"Spring-Excel test"</span>));
		
        List words = (List) model.get(<span class="hl-string">"wordList"</span>);
        <span class="hl-keyword">for</span> (<span class="hl-keyword">int</span> i = 0; i &lt; words.size(); i++) {
            sheet.addCell(<span class="hl-keyword">new</span> Label(2+i, 0, (String) words.get(i)));
        }
    }
}</pre><p>Note the differences between the APIs. We've found that the
        JExcelApi is somewhat more intuitive, and furthermore, JExcelApi has
        slightly better image-handling capabilities. There have been memory
        problems with large Excel files when using JExcelApi however.</p><p>If you now amend the controller such that it returns
        <code class="literal">xl</code> as the name of the view (<code class="literal">return new
        ModelAndView("xl", map);</code>) and run your application again,
        you should find that the Excel spreadsheet is created and downloaded
        automatically when you request the same page as before.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-document-configsubclasspdf"></a>17.6.2.4&nbsp;Subclassing for PDF views</h4></div></div></div><p>The PDF version of the word list is even simpler. This time, the
        class extends
        <code class="literal">org.springframework.web.servlet.view.document.AbstractPdfView</code>
        and implements the <code class="literal">buildPdfDocument()</code> method as
        follows:</p><pre class="programlisting"><span class="hl-keyword">package</span> pdf;

<span class="hl-comment">// imports omitted for brevity</span>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PDFPage <span class="hl-keyword">extends</span> AbstractPdfView {

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> buildPdfDocument(
        Map model,
        Document doc,
        PdfWriter writer,
        HttpServletRequest req,
        HttpServletResponse resp)
        <span class="hl-keyword">throws</span> Exception {
        
        List words = (List) model.get(<span class="hl-string">"wordList"</span>);
        
        <span class="hl-keyword">for</span> (<span class="hl-keyword">int</span> i=0; i&lt;words.size(); i++)
            doc.add( <span class="hl-keyword">new</span> Paragraph((String) words.get(i)));
    
    }
}</pre><p>Once again, amend the controller to return the
        <code class="literal">pdf</code> view with <code class="literal">return new
        ModelAndView("pdf", map);</code>, and reload the URL in your
        application. This time a PDF document should appear listing each of
        the words in the model map.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-jasper-reports"></a>17.7&nbsp;JasperReports</h2></div></div></div><p>JasperReports (<a class="ulink" href="http://jasperreports.sourceforge.net" target="_top">http://jasperreports.sourceforge.net</a>) is a powerful
    open-source reporting engine that supports the creation of report designs
    using an easily understood XML file format. JasperReports is capable of
    rendering reports in four different formats: CSV, Excel, HTML and
    PDF.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jasper-reports-dependencies"></a>17.7.1&nbsp;Dependencies</h3></div></div></div><p>Your application will need to include the latest release of
      JasperReports, which at the time of writing was 0.6.1. JasperReports
      itself depends on the following projects:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>BeanShell</p></li><li style="list-style-type: disc"><p>Commons BeanUtils</p></li><li style="list-style-type: disc"><p>Commons Collections</p></li><li style="list-style-type: disc"><p>Commons Digester</p></li><li style="list-style-type: disc"><p>Commons Logging</p></li><li style="list-style-type: disc"><p>iText</p></li><li style="list-style-type: disc"><p>POI</p></li></ul></div><p>JasperReports also requires a JAXP compliant XML parser.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jasper-reports-configuration"></a>17.7.2&nbsp;Configuration</h3></div></div></div><p>To configure JasperReports views in your Spring container
      configuration you need to define a
      <code class="interfacename">ViewResolver</code> to map view names to the
      appropriate view class depending on which format you want your report
      rendered in.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jasper-reports-configuration-resolver"></a>17.7.2.1&nbsp;Configuring the
        <code class="interfacename">ViewResolver</code></h4></div></div></div><p>Typically, you will use the
        <code class="classname">ResourceBundleViewResolver</code> to map view names to
        view classes and files in a properties file.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.ResourceBundleViewResolver"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"basename"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"views"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Here we've configured an instance of the
        <code class="classname">ResourceBundleViewResolver</code> class that will look
        for view mappings in the resource bundle with base name
        <code class="literal">views</code>. (The content of this file is described in
        the next section.)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jasper-reports-configuration-views"></a>17.7.2.2&nbsp;Configuring the <code class="literal">View</code>s</h4></div></div></div><p>The Spring Framework contains five different
        <code class="interfacename">View</code> implementations for JasperReports,
        four of which correspond to one of the four output formats supported
        by JasperReports, and one that allows for the format to be determined
        at runtime:</p><div class="table"><a name="view-jasper-reports-configuration-views-classes"></a><p class="title"><b>Table&nbsp;17.2.&nbsp;JasperReports <code class="interfacename">View</code>
          classes</b></p><div class="table-contents"><table summary="JasperReports View&#xA;          classes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Class Name</th><th style="border-bottom: 1.0pt solid ; ">Render Format</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">JasperReportsCsvView</code></td><td style="border-bottom: 1.0pt solid ; ">CSV</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">JasperReportsHtmlView</code></td><td style="border-bottom: 1.0pt solid ; ">HTML</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">JasperReportsPdfView</code></td><td style="border-bottom: 1.0pt solid ; ">PDF</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">JasperReportsXlsView</code></td><td style="border-bottom: 1.0pt solid ; ">Microsoft Excel</td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="classname">JasperReportsMultiFormatView</code></td><td style="">The view is <a class="link" href="#view-jasper-reports-configuration-multiformat-view" title="17.7.2.4&nbsp;Using JasperReportsMultiFormatView">decided
                upon at runtime</a></td></tr></tbody></table></div></div><br class="table-break"><p>Mapping one of these classes to a view name and a report file is
        a matter of adding the appropriate entries in the resource bundle
        configured in the previous section as shown here:</p><pre class="programlisting">simpleReport.(class)=org.springframework.web.servlet.view.jasperreports.JasperReportsPdfView
simpleReport.url=/WEB-INF/reports/DataSourceReport.jasper</pre><p>Here you can see that the view with name
        <code class="literal">simpleReport</code> is mapped to the
        <code class="classname">JasperReportsPdfView</code> class, causing the output
        of this report to be rendered in PDF format. The
        <code class="literal">url</code> property of the view is set to the location of
        the underlying report file.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jasper-reports-configuration-report-files"></a>17.7.2.3&nbsp;About Report Files</h4></div></div></div><p>JasperReports has two distinct types of report file: the design
        file, which has a <code class="literal">.jrxml</code> extension, and the
        compiled report file, which has a <code class="literal">.jasper</code>
        extension. Typically, you use the JasperReports Ant task to compile
        your <code class="literal">.jrxml</code> design file into a
        <code class="literal">.jasper</code> file before deploying it into your
        application. With the Spring Framework you can map either of these
        files to your report file and the framework will take care of
        compiling the <code class="literal">.jrxml</code> file on the fly for you. You
        should note that after a <code class="literal">.jrxml</code> file is compiled by
        the Spring Framework, the compiled report is cached for the lifetime
        of the application. Thus, to make changes to the file you will need to
        restart your application.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jasper-reports-configuration-multiformat-view"></a>17.7.2.4&nbsp;Using
        <code class="classname">JasperReportsMultiFormatView</code></h4></div></div></div><p>The <code class="classname">JasperReportsMultiFormatView</code> allows
        for the report format to be specified at runtime. The actual rendering of
        the report is delegated to one of the other JasperReports view classes
        - the <code class="classname">JasperReportsMultiFormatView</code> class simply
        adds a wrapper layer that allows for the exact implementation to be
        specified at runtime.</p><p>The <code class="classname">JasperReportsMultiFormatView</code> class
        introduces two concepts: the format key and the discriminator key. The
        <code class="classname">JasperReportsMultiFormatView</code> class uses the
        mapping key to look up the actual view implementation class, and it uses
        the format key to lookup up the mapping key. From a coding perspective
        you add an entry to your model with the format key as the key and the
        mapping key as the value, for example:</p><pre class="programlisting"><span class="hl-keyword">public</span> ModelAndView handleSimpleReportMulti(HttpServletRequest request,
HttpServletResponse response) <span class="hl-keyword">throws</span> Exception {

  String uri = request.getRequestURI();
  String format = uri.substring(uri.lastIndexOf(<span class="hl-string">"."</span>) + 1);

  Map model = getModel();
  model.put(<span class="hl-string">"format"</span>, format);

  <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ModelAndView(<span class="hl-string">"simpleReportMulti"</span>, model);
}</pre><p>In this example, the mapping key is determined from the
        extension of the request URI and is added to the model under the
        default format key: <code class="literal">format</code>. If you wish to use a
        different format key then you can configure this using the
        <code class="literal">formatKey</code> property of the
        <code class="classname">JasperReportsMultiFormatView</code> class.</p><p>By default the following mapping key mappings are configured in
        <code class="classname">JasperReportsMultiFormatView</code>:</p><div class="table"><a name="view-jasper-reports-configuration-multiformat-view-mappings"></a><p class="title"><b>Table&nbsp;17.3.&nbsp;<code class="classname">JasperReportsMultiFormatView</code> Default
          Mapping Key Mappings</b></p><div class="table-contents"><table summary="JasperReportsMultiFormatView Default&#xA;          Mapping Key Mappings" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Mapping Key</th><th style="border-bottom: 1.0pt solid ; ">View Class</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">csv</td><td style="border-bottom: 1.0pt solid ; "><code class="classname">JasperReportsCsvView</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">html</td><td style="border-bottom: 1.0pt solid ; "><code class="classname">JasperReportsHtmlView</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">pdf</td><td style="border-bottom: 1.0pt solid ; "><code class="classname">JasperReportsPdfView</code></td></tr><tr><td style="border-right: 1.0pt solid ; ">xls</td><td style=""><code class="classname">JasperReportsXlsView</code></td></tr></tbody></table></div></div><br class="table-break"><p>So in the example above a request to URI /foo/myReport.pdf would
        be mapped to the <code class="literal">JasperReportsPdfView</code> class. You
        can override the mapping key to view class mappings using the
        <code class="literal">formatMappings</code> property of
        <code class="classname">JasperReportsMultiFormatView</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jasper-reports-model"></a>17.7.3&nbsp;Populating the <code class="classname">ModelAndView</code></h3></div></div></div><p>In order to render your report correctly in the format you have
      chosen, you must supply Spring with all of the data needed to populate
      your report. For JasperReports this means you must pass in all report
      parameters along with the report datasource. Report parameters are
      simple name/value pairs and can be added to the
      <code class="interfacename">Map</code> for your model as you would add any
      name/value pair.</p><p>When adding the datasource to the model you have two approaches to
      choose from. The first approach is to add an instance of
      <code class="classname">JRDataSource</code> or a
      <code class="interfacename">Collection</code> type to the model
      <code class="interfacename">Map</code> under any arbitrary key. Spring will
      then locate this object in the model and treat it as the report
      datasource. For example, you may populate your model like so:</p><pre class="programlisting"><span class="hl-keyword">private</span> Map getModel() {
  Map model = <span class="hl-keyword">new</span> HashMap();
  Collection beanData = getBeanData();
  model.put(<span class="hl-string">"myBeanData"</span>, beanData);
  <span class="hl-keyword">return</span> model;
}</pre><p>The second approach is to add the instance of
      <code class="literal">JRDataSource</code> or <code class="literal">Collection</code> under a
      specific key and then configure this key using the
      <code class="literal">reportDataKey</code> property of the view class. In both
      cases Spring will wrap instances of <code class="literal">Collection</code> in a
      <code class="literal">JRBeanCollectionDataSource</code> instance. For
      example:</p><pre class="programlisting"><span class="hl-keyword">private</span> Map getModel() {
  Map model = <span class="hl-keyword">new</span> HashMap();
  Collection beanData = getBeanData();
  Collection someData = getSomeData();
  model.put(<span class="hl-string">"myBeanData"</span>, beanData);
  model.put(<span class="hl-string">"someData"</span>, someData);
  <span class="hl-keyword">return</span> model;
}</pre><p>Here you can see that two <code class="literal">Collection</code> instances
      are being added to the model. To ensure that the correct one is used, we
      simply modify our view configuration as appropriate:</p><pre class="programlisting">simpleReport.(class)=org.springframework.web.servlet.view.jasperreports.JasperReportsPdfView
simpleReport.url=/WEB-INF/reports/DataSourceReport.jasper
simpleReport.reportDataKey=myBeanData</pre><p>Be aware that when using the first approach, Spring will use the
      first instance of <code class="literal">JRDataSource</code> or
      <code class="literal">Collection</code> that it encounters. If you need to place
      multiple instances of <code class="literal">JRDataSource</code> or
      <code class="literal">Collection</code> into the model you need to use the
      second approach.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jasper-reports-subreports"></a>17.7.4&nbsp;Working with Sub-Reports</h3></div></div></div><p>JasperReports provides support for embedded sub-reports within
      your master report files. There are a wide variety of mechanisms for
      including sub-reports in your report files. The easiest way is to hard
      code the report path and the SQL query for the sub report into your
      design files. The drawback of this approach is obvious: the values are
      hard-coded into your report files reducing reusability and making it
      harder to modify and update report designs. To overcome this you can
      configure sub-reports declaratively, and you can include additional data
      for these sub-reports directly from your controllers.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jasper-reports-subreports-config-reports"></a>17.7.4.1&nbsp;Configuring Sub-Report Files</h4></div></div></div><p>To control which sub-report files are included in a master
        report using Spring, your report file must be configured to accept
        sub-reports from an external source. To do this you declare a
        parameter in your report file like so:</p><pre class="programlisting">&lt;<span class="hl-tag">parameter</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ProductsSubReport"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"net.sf.jasperreports.engine.JasperReport"</span>/&gt;</pre><p>Then, you define your sub-report to use this sub-report
        parameter:</p><pre class="programlisting">&lt;<span class="hl-tag">subreport</span>&gt;
    &lt;<span class="hl-tag">reportElement</span> <span class="hl-attribute">isPrintRepeatedValues</span>=<span class="hl-value">"false"</span> <span class="hl-attribute">x</span>=<span class="hl-value">"5"</span> <span class="hl-attribute">y</span>=<span class="hl-value">"25"</span> <span class="hl-attribute">width</span>=<span class="hl-value">"325"</span>
        <span class="hl-attribute">height</span>=<span class="hl-value">"20"</span> <span class="hl-attribute">isRemoveLineWhenBlank</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">backcolor</span>=<span class="hl-value">"#ffcc99"</span>/&gt;
    &lt;<span class="hl-tag">subreportParameter</span> <span class="hl-attribute">name</span>=<span class="hl-value">"City"</span>&gt;
        &lt;<span class="hl-tag">subreportParameterExpression</span>&gt;&lt;<span class="hl-tag">![CDATA[$F{city}]]</span>&gt;&lt;<span class="hl-tag">/subreportParameterExpression</span>&gt;
    &lt;<span class="hl-tag">/subreportParameter</span>&gt;
    &lt;<span class="hl-tag">dataSourceExpression</span>&gt;&lt;<span class="hl-tag">![CDATA[$P{SubReportData}]]</span>&gt;&lt;<span class="hl-tag">/dataSourceExpression</span>&gt;
    &lt;<span class="hl-tag">subreportExpression</span> <span class="hl-attribute">class</span>=<span class="hl-value">"net.sf.jasperreports.engine.JasperReport"</span>&gt;
                  &lt;<span class="hl-tag">![CDATA[$P{ProductsSubReport}]]</span>&gt;&lt;<span class="hl-tag">/subreportExpression</span>&gt;
&lt;<span class="hl-tag">/subreport</span>&gt;</pre><p>This defines a master report file that expects the sub-report to
        be passed in as an instance of
        <code class="literal">net.sf.jasperreports.engine.JasperReports</code> under the
        parameter <code class="literal">ProductsSubReport</code>. When configuring your
        Jasper view class, you can instruct Spring to load a report file and
        pass it into the JasperReports engine as a sub-report using the
        <code class="literal">subReportUrls</code> property:</p><pre class="programlisting">&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"subReportUrls"</span>&gt;
    &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"ProductsSubReport"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/reports/subReportChild.jrxml"</span>/&gt;
    &lt;<span class="hl-tag">/map</span>&gt;
&lt;<span class="hl-tag">/property</span>&gt;</pre><p>Here, the key of the <code class="interfacename">Map</code>
        corresponds to the name of the sub-report parameter in the report
        design file, and the entry is the URL of the report file. Spring will
        load this report file, compiling it if necessary, and pass it into
        the JasperReports engine under the given key.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-jasper-reports-subreports-config-datasources"></a>17.7.4.2&nbsp;Configuring Sub-Report Data Sources</h4></div></div></div><p>This step is entirely optional when using Spring to configure your
        sub-reports. If you wish, you can still configure the data source for
        your sub-reports using static queries. However, if you want Spring to
        convert data returned in your <code class="literal">ModelAndView</code> into
        instances of <code class="literal">JRDataSource</code> then you need to specify
        which of the parameters in your <code class="literal">ModelAndView</code> Spring
        should convert. To do this, configure the list of parameter names using
        the <code class="literal">subReportDataKeys</code> property of your chosen
        view class:</p><pre class="programlisting">&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"subReportDataKeys"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"SubReportData"</span>/&gt;</pre><p>Here, the key you supply <span class="bold"><strong>must</strong></span>
        correspond to both the key used in your <code class="literal">ModelAndView</code>
        and the key used in your report design file.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-jasper-reports-exporter-parameters"></a>17.7.5&nbsp;Configuring Exporter Parameters</h3></div></div></div><p>If you have special requirements for exporter configuration --
      perhaps you want a specific page size for your PDF report -- you can
      configure these exporter parameters declaratively in your Spring
      configuration file using the <code class="literal">exporterParameters</code>
      property of the view class. The <code class="literal">exporterParameters</code>
      property is typed as a <code class="interfacename">Map</code>. In your
      configuration the key of an entry should be the fully-qualified name of
      a static field that contains the exporter parameter definition, and the
      value of an entry should be the value you want to assign to the
      parameter. An example of this is shown below:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"htmlReport"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.jasperreports.JasperReportsHtmlView"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/reports/simpleReport.jrxml"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"exporterParameters"</span>&gt;
    &lt;<span class="hl-tag">map</span>&gt;
      &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"net.sf.jasperreports.engine.export.JRHtmlExporterParameter.HTML_FOOTER"</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;Footer by Spring!
          &amp;lt;/td&amp;gt;&amp;lt;td width="50%"&amp;gt;&amp;amp;nbsp; &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
          &amp;lt;/table&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;
        &lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">/entry</span>&gt;
    &lt;<span class="hl-tag">/map</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Here you can see that the
      <code class="classname">JasperReportsHtmlView</code> is configured with an
      exporter parameter for
      <code class="literal">net.sf.jasperreports.engine.export.JRHtmlExporterParameter.HTML_FOOTER</code>
      which will output a footer in the resulting HTML.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-feeds"></a>17.8&nbsp;Feed Views</h2></div></div></div><p>Both <code class="classname">AbstractAtomFeedView</code> and
    <code class="classname">AbstractRssFeedView</code> inherit from the base class
    <code class="classname">AbstractFeedView</code> and are used to provide Atom and
    RSS Feed views respectfully. They are based on java.net's <a class="ulink" href="https://rome.dev.java.net" target="_top">ROME</a> project and are located in
    the package
    <code class="literal">org.springframework.web.servlet.view.feed</code>.</p><p><code class="classname">AbstractAtomFeedView</code> requires you to
    implement the <code class="methodname">buildFeedEntries()</code> method and
    optionally override the <code class="methodname">buildFeedMetadata()</code> method
    (the default implementation is empty), as shown below.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SampleContentAtomView <span class="hl-keyword">extends</span> AbstractAtomFeedView {

  @Override
  <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> buildFeedMetadata(Map&lt;String, Object&gt; model, Feed feed,
      HttpServletRequest request) {
    <span class="hl-comment">// implementation omitted</span>
  }

  @Override
  <span class="hl-keyword">protected</span> List&lt;Entry&gt; buildFeedEntries(Map&lt;String, Object&gt; model,
      HttpServletRequest request, HttpServletResponse response)
      <span class="hl-keyword">throws</span> Exception {

    <span class="hl-comment">// implementation omitted</span>
  }
}</pre><p>Similar requirements apply for implementing
    <code class="classname">AbstractRssFeedView</code>, as shown below.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SampleContentAtomView <span class="hl-keyword">extends</span> AbstractRssFeedView {

  @Override
  <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> buildFeedMetadata(Map&lt;String, Object&gt; model, Channel feed,
                                   HttpServletRequest request) {
    <span class="hl-comment">// implementation omitted</span>
  }

  @Override
  <span class="hl-keyword">protected</span> List&lt;Item&gt; buildFeedItems(Map&lt;String, Object&gt; model,
      HttpServletRequest request, HttpServletResponse response)
      <span class="hl-keyword">throws</span> Exception {
    <span class="hl-comment">// implementation omitted</span>
  }

}</pre><p>The <code class="methodname">buildFeedItems()</code> and
    <code class="methodname">buildFeedEntires()</code> methods pass in the HTTP request in case
    you need to access the Locale. The HTTP response is passed in only for the
    setting of cookies or other HTTP headers. The feed will automatically be
    written to the response object after the method returns.</p><p>For an example of creating an Atom view please refer to Alef
    Arendsen's SpringSource Team Blog <a class="ulink" href="http://blog.springsource.com/2009/03/16/adding-an-atom-view-to-an-application-using-springs-rest-support/" target="_top">entry</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-xml-marshalling"></a>17.9&nbsp;XML Marshalling View</h2></div></div></div><p>The <code class="classname">MarhsallingView</code> uses an XML
    <code class="interfacename">Marshaller</code> defined in the
    <code class="classname">org.springframework.oxm</code> package to render the
    response content as XML. The object to be marshalled can be set explicitly
    using <code class="classname">MarhsallingView</code>'s
    <span class="property">modelKey</span> bean property. Alternatively, the view will
    iterate over all model properties and marshal only those types that are
    supported by the <code class="interfacename">Marshaller</code>. For more
    information on the functionality in the
    <code class="classname">org.springframework.oxm</code> package refer to the
    chapter <a class="link" href="#oxm" title="15.&nbsp;Marshalling XML using O/X Mappers">Marshalling XML using O/X
    Mappers</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-json-mapping"></a>17.10&nbsp;JSON Mapping View</h2></div></div></div><p>The <code class="classname">MappingJacksonJsonView</code> uses the Jackson 
  	library's <code class="classname">ObjectMapper</code> to render the response content 
  	as JSON. By default, the entire contents of the model map (with the exception 
  	of framework-specific classes) will be encoded as JSON. For cases where the 
  	contents of the map need to be filtered, users may specify a specific set of 
  	model attributes to encode via the <code class="literal">RenderedAttributes</code> 
  	property. The <code class="literal">extractValueFromSingleKeyModel</code> property
  	may also be  used to have the value in single-key models extracted and 
  	serialized directly rather than as a map of model attributes.</p><p>JSON mapping can be customized as needed through the use of Jackson's provided 
	annotations. When further control is needed, a custom 
	<code class="interfacename">ObjectMapper</code> can be injected through the 
	<code class="literal">ObjectMapper</code> property for cases where custom JSON 
	serializers/deserializers need to be provided for specific types.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="web-integration"></a>18.&nbsp;Integrating with other web frameworks</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="intro"></a>18.1&nbsp;Introduction</h2></div></div></div><p>This chapter details Spring's integration with third party web
    frameworks such as <a class="ulink" href="http://java.sun.com/javaee/javaserverfaces/" target="_top">JSF</a>, <a class="ulink" href="http://struts.apache.org/" target="_top">Struts</a>, <a class="ulink" href="http://www.opensymphony.com/webwork/" target="_top">WebWork</a>, and <a class="ulink" href="http://tapestry.apache.org/" target="_top">Tapestry</a>.</p><div class="sidebar"><p class="title"><b>Spring Web Flow</b></p><p>Spring Web Flow (SWF) aims to be the best solution for the management
  of web application page flow.</p><p>SWF integrates with existing frameworks like Spring MVC, Struts, and
  JSF, in both servlet and portlet environments. If you have a business
  process (or processes) that would benefit from a conversational model as
  opposed to a purely request model, then SWF may be the solution.</p><p>SWF allows you to capture logical page flows as self-contained modules
  that are reusable in different situations, and as such is ideal for building
  web application modules that guide the user through controlled navigations
  that drive business processes.</p><p>For more information about SWF, consult the
  <a class="ulink" href="http://www.springframework.org/webflow" target="_top">Spring Web Flow website</a>.
  </p></div><p>One of the core value propositions of the Spring Framework is that
    of enabling <span class="emphasis"><em>choice</em></span>. In a general sense, Spring does
    not force one to use or buy into any particular architecture, technology,
    or methodology (although it certainly recommends some over others). This
    freedom to pick and choose the architecture, technology, or methodology
    that is most relevant to a developer and his or her development team is
    arguably most evident in the web area, where Spring provides its own web
    framework (<a class="link" href="#mvc" title="16.&nbsp;Web MVC framework">Spring MVC</a>), while at the same time
    providing integration with a number of popular third party web frameworks.
    This allows one to continue to leverage any and all of the skills one may
    have acquired in a particular web framework such as Struts, while at the
    same time being able to enjoy the benefits afforded by Spring in other
    areas such as data access, declarative transaction management, and
    flexible configuration and application assembly.</p><p>Having dispensed with the woolly sales patter (c.f. the previous
    paragraph), the remainder of this chapter will concentrate upon the meaty
    details of integrating your favorite web framework with Spring. One thing
    that is often commented upon by developers coming to Java from other
    languages is the seeming super-abundance of web frameworks available in
    Java. There are indeed a great number of web frameworks in the Java
    space; in fact there are far too many to cover with any semblance of
    detail in a single chapter. This chapter thus picks four of the more
    popular web frameworks in Java, starting with the Spring configuration
    that is common to all of the supported web frameworks, and then detailing
    the specific integration options for each supported web framework.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Please note that this chapter does not attempt to explain
        how to use any of the supported web frameworks. For example, if you want
        to use Struts for the presentation layer of your web application, the
        assumption is that you are already familiar with Struts. If you need
        further details about any of the supported web frameworks themselves,
        please do consult <a class="xref" href="#web-integration-resources" title="18.7&nbsp;Further Resources">Section&nbsp;18.7, &#8220;Further Resources&#8221;</a> at the end
        of this chapter.
        </p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="web-integration-common"></a>18.2&nbsp;Common configuration</h2></div></div></div><p>Before diving into the integration specifics of each supported web
    framework, let us first take a look at the Spring configuration that is
    <span class="emphasis"><em>not</em></span> specific to any one web framework. (This section
    is equally applicable to Spring's own web framework, Spring MVC.)</p><p>One of the concepts (for want of a better word) espoused by
    (Spring's) lightweight application model is that of a layered
    architecture. Remember that in a 'classic' layered architecture, the web
    layer is but one of many layers; it serves as one of the entry points
    into a server side application and it delegates to service objects
    (facades) defined in a service layer to satisfy business specific (and
    presentation-technology agnostic) use cases. In Spring, these service
    objects, any other business-specific objects, data access objects, etc.
    exist in a distinct 'business context', which contains
    <span class="emphasis"><em>no</em></span> web or presentation layer objects (presentation
    objects such as Spring MVC controllers are typically configured in a
    distinct 'presentation context'). This section details how one configures
    a Spring container (a <code class="classname">WebApplicationContext</code>) that
    contains all of the 'business beans' in one's application.</p><p>On to specifics: all that one need do is to declare a <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/context/ContextLoaderListener.html" target="_top"><code class="classname">ContextLoaderListener</code></a>
    in the standard Java EE servlet <code class="literal">web.xml</code> file of one's web
    application, and add a <code class="literal">contextConfigLocation</code>
    &lt;context-param/&gt; section (in the same file) that defines which set
    of Spring XML configuration files to load.</p><p>Find below the &lt;listener/&gt; configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">listener</span>&gt;
  &lt;<span class="hl-tag">listener-class</span>&gt;org.springframework.web.context.ContextLoaderListener&lt;<span class="hl-tag">/listener-class</span>&gt;
&lt;<span class="hl-tag">/listener</span>&gt;</pre><p>Find below the &lt;context-param/&gt; configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">context-param</span>&gt;
  &lt;<span class="hl-tag">param-name</span>&gt;contextConfigLocation&lt;<span class="hl-tag">/param-name</span>&gt;
  &lt;<span class="hl-tag">param-value</span>&gt;/WEB-INF/applicationContext*.xml&lt;<span class="hl-tag">/param-value</span>&gt;
&lt;<span class="hl-tag">/context-param</span>&gt;</pre><p>If you don't specify the <code class="literal">contextConfigLocation</code>
    context parameter, the <code class="classname">ContextLoaderListener</code> will
    look for a file called <code class="literal">/WEB-INF/applicationContext.xml</code>
    to load. Once the context files are loaded, Spring creates a <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/context/WebApplicationContext.html" target="_top"><code class="classname">WebApplicationContext</code></a>
    object based on the bean definitions and stores it in the
    <span class="interface">ServletContext</span> of the web application.</p><p>All Java web frameworks are built on top of the Servlet API, and so
    one can use the following code snippet to get access to this 'business
    context' <span class="interface">ApplicationContext</span> created by the
    <code class="classname">ContextLoaderListener</code>.</p><pre class="programlisting">WebApplicationContext ctx = WebApplicationContextUtils.getWebApplicationContext(servletContext);</pre><p>The <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/context/support/WebApplicationContextUtils.html" target="_top"><code class="classname">WebApplicationContextUtils</code></a>
    class is for convenience, so you don't have to remember the name of the
    <span class="interface">ServletContext</span> attribute. Its
    <span class="emphasis"><em>getWebApplicationContext()</em></span> method will return
    <code class="literal">null</code> if an object doesn't exist under the
    <code class="literal">WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE</code>
    key. Rather than risk getting <code class="classname">NullPointerExceptions</code>
    in your application, it's better to use the
    <code class="literal">getRequiredWebApplicationContext()</code> method. This method
    throws an exception when the <span class="interface">ApplicationContext</span> is
    missing.</p><p>Once you have a reference to the
    <code class="classname">WebApplicationContext</code>, you can retrieve beans by
    their name or type. Most developers retrieve beans by name and then cast them
    to one of their implemented interfaces.</p><p>Fortunately, most of the frameworks in this section have simpler
    ways of looking up beans. Not only do they make it easy to get beans from
    a Spring container, but they also allow you to use dependency injection on
    their controllers. Each web framework section has more detail on its
    specific integration strategies.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jsf"></a>18.3&nbsp;JavaServer Faces 1.1 and 1.2</h2></div></div></div><p>JavaServer Faces (JSF) is the JCP's standard component-based,
    event-driven web user interface framework. As of Java EE 5, it is an
    official part of the Java EE umbrella.</p><p>For a popular JSF runtime as well as for popular JSF component
    libraries, check out the <a class="ulink" href="http://myfaces.apache.org/" target="_top">Apache
    MyFaces project</a>. The MyFaces project also provides common JSF
    extensions such as <a class="ulink" href="http://myfaces.apache.org/orchestra/" target="_top">MyFaces Orchestra</a>: a
    Spring-based JSF extension that provides rich conversation scope
    support.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Spring Web Flow 2.0 provides rich JSF support through its newly
      established Spring Faces module, both for JSF-centric usage (as
      described in this section) and for Spring-centric usage (using JSF views
      within a Spring MVC dispatcher). Check out the <a class="ulink" href="http://www.springframework.org/webflow" target="_top">Spring Web Flow
      website</a> for details!</p></td></tr></table></div><p>The key element in Spring's JSF integration is the JSF 1.1
    <code class="classname">VariableResolver</code> mechanism. On JSF 1.2, Spring
    supports the <code class="classname">ELResolver</code> mechanism as a
    next-generation version of JSF EL integration.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jsf-delegatingvariableresolver"></a>18.3.1&nbsp;DelegatingVariableResolver (JSF 1.1/1.2)</h3></div></div></div><p>The easiest way to integrate one's Spring middle-tier with one's
      JSF web layer is to use the <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/jsf/DelegatingVariableResolver.html" target="_top">
      <code class="classname">DelegatingVariableResolver</code></a> class. To
      configure this variable resolver in one's application, one will need to
      edit one's <span class="emphasis"><em>faces-context.xml</em></span> file. After the
      opening <code class="literal">&lt;faces-config/&gt;</code> element, add an
      <code class="literal">&lt;application/&gt;</code> element and a
      <code class="literal">&lt;variable-resolver/&gt;</code> element within it. The
      value of the variable resolver should reference Spring's
      <code class="classname">DelegatingVariableResolver</code>; for example:</p><pre class="programlisting">&lt;<span class="hl-tag">faces-config</span>&gt;
  &lt;<span class="hl-tag">application</span>&gt;
    &lt;<span class="hl-tag">variable-resolver</span>&gt;org.springframework.web.jsf.DelegatingVariableResolver&lt;<span class="hl-tag">/variable-resolver</span>&gt;
    &lt;<span class="hl-tag">locale-config</span>&gt;
      &lt;<span class="hl-tag">default-locale</span>&gt;en&lt;<span class="hl-tag">/default-locale</span>&gt;
      &lt;<span class="hl-tag">supported-locale</span>&gt;en&lt;<span class="hl-tag">/supported-locale</span>&gt;
      &lt;<span class="hl-tag">supported-locale</span>&gt;es&lt;<span class="hl-tag">/supported-locale</span>&gt;
    &lt;<span class="hl-tag">/locale-config</span>&gt;
    &lt;<span class="hl-tag">message-bundle</span>&gt;messages&lt;<span class="hl-tag">/message-bundle</span>&gt;
  &lt;<span class="hl-tag">/application</span>&gt;
&lt;<span class="hl-tag">/faces-config</span>&gt;</pre><p>The <code class="classname">DelegatingVariableResolver</code> will first
      delegate value lookups to the default resolver of the underlying JSF
      implementation and then to Spring's 'business context'
      <code class="classname">WebApplicationContext</code>. This allows one to easily
      inject dependencies into one's JSF-managed beans.</p><p>Managed beans are defined in one's
      <code class="literal">faces-config.xml</code> file. Find below an example where
      <code class="literal">#{userManager}</code> is a bean that is retrieved from the
      Spring 'business context'.</p><pre class="programlisting">&lt;<span class="hl-tag">managed-bean</span>&gt;
  &lt;<span class="hl-tag">managed-bean-name</span>&gt;userList&lt;<span class="hl-tag">/managed-bean-name</span>&gt;
  &lt;<span class="hl-tag">managed-bean-class</span>&gt;com.whatever.jsf.UserList&lt;<span class="hl-tag">/managed-bean-class</span>&gt;
  &lt;<span class="hl-tag">managed-bean-scope</span>&gt;request&lt;<span class="hl-tag">/managed-bean-scope</span>&gt;
  &lt;<span class="hl-tag">managed-property</span>&gt;
    &lt;<span class="hl-tag">property-name</span>&gt;userManager&lt;<span class="hl-tag">/property-name</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;#{userManager}&lt;<span class="hl-tag">/value</span>&gt;
  &lt;<span class="hl-tag">/managed-property</span>&gt;
&lt;<span class="hl-tag">/managed-bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jsf-springbeanvariableresolver"></a>18.3.2&nbsp;SpringBeanVariableResolver (JSF 1.1/1.2)</h3></div></div></div><p><code class="classname">SpringBeanVariableResolver</code> is a variant of
      <code class="classname">DelegatingVariableResolver</code>. It delegates to the
      Spring's 'business context' <code class="classname">WebApplicationContext</code>
      <span class="emphasis"><em>first</em></span> and then to the default resolver of the
      underlying JSF implementation. This is useful in particular when using
      request/session-scoped beans with special Spring resolution rules, e.g.
      Spring <code class="interfacename">FactoryBean</code>
      implementations.</p><p>Configuration-wise, simply define
      <code class="classname">SpringBeanVariableResolver</code> in your
      <span class="emphasis"><em>faces-context.xml</em></span> file:</p><pre class="programlisting">&lt;<span class="hl-tag">faces-config</span>&gt;
  &lt;<span class="hl-tag">application</span>&gt;
    &lt;<span class="hl-tag">variable-resolver</span>&gt;org.springframework.web.jsf.SpringBeanVariableResolver&lt;<span class="hl-tag">/variable-resolver</span>&gt;
    ...
  &lt;<span class="hl-tag">/application</span>&gt;
&lt;<span class="hl-tag">/faces-config</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jsf-springbeanfaceselresolver"></a>18.3.3&nbsp;SpringBeanFacesELResolver (JSF 1.2+)</h3></div></div></div><p><code class="classname">SpringBeanFacesELResolver</code> is a JSF 1.2
      compliant <code class="classname">ELResolver</code> implementation, integrating
      with the standard Unified EL as used by JSF 1.2 and JSP 2.1. Like
      <code class="classname">SpringBeanVariableResolver</code>, it delegates to the
      Spring's 'business context' <code class="classname">WebApplicationContext</code>
      <span class="emphasis"><em>first</em></span>, then to the default resolver of the
      underlying JSF implementation.</p><p>Configuration-wise, simply define
      <code class="classname">SpringBeanFacesELResolver</code> in your JSF 1.2
      <span class="emphasis"><em>faces-context.xml</em></span> file:</p><pre class="programlisting">&lt;<span class="hl-tag">faces-config</span>&gt;
  &lt;<span class="hl-tag">application</span>&gt;
    &lt;<span class="hl-tag">el-resolver</span>&gt;org.springframework.web.jsf.el.SpringBeanFacesELResolver&lt;<span class="hl-tag">/el-resolver</span>&gt;
    ...
  &lt;<span class="hl-tag">/application</span>&gt;
&lt;<span class="hl-tag">/faces-config</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jsf-facescontextutils"></a>18.3.4&nbsp;FacesContextUtils</h3></div></div></div><p>A custom <code class="interfacename">VariableResolver</code> works
      well when mapping one's properties to beans in
      <span class="emphasis"><em>faces-config.xml</em></span>, but at times one may need to grab
      a bean explicitly. The <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/jsf/FacesContextUtils.html" target="_top">
      <code class="classname">FacesContextUtils</code></a> class makes this easy.
      It is similar to <code class="classname">WebApplicationContextUtils</code>,
      except that it takes a <code class="classname">FacesContext</code> parameter
      rather than a <span class="interface">ServletContext</span> parameter.</p><pre class="programlisting">ApplicationContext ctx = FacesContextUtils.getWebApplicationContext(FacesContext.getCurrentInstance());</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="struts"></a>18.4&nbsp;Apache Struts 1.x and 2.x</h2></div></div></div><p><a class="ulink" href="http://struts.apache.org" target="_top">Struts</a> used to be the
    <span class="emphasis"><em>de facto</em></span> web framework for Java applications, mainly
    because it was one of the first to be released (June 2001). It has now been renamed to <span class="emphasis"><em>Struts 1</em></span> 
	(as opposed to Struts 2). Many applications still use it. 
	Invented by Craig McClanahan, Struts is an open source project hosted by the Apache
    Software Foundation. At the time, it greatly simplified the JSP/Servlet
    programming paradigm and won over many developers who were using
    proprietary frameworks. It simplified the programming model, it was open
    source (and thus free as in beer), and it had a large community, which
    allowed the project to grow and become popular among Java web
    developers.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><span class="emphasis"><em>The following section discusses Struts 1 a.k.a. "Struts
      Classic".</em></span></p><p>Struts 2 is effectively a different product - a successor of
      WebWork 2.2 (as discussed in <a class="xref" href="#webwork" title="18.5&nbsp;WebWork 2.x">Section&nbsp;18.5, &#8220;WebWork 2.x&#8221;</a>), carrying the
      Struts brand now. Check out the Struts 2 <a class="ulink" href="http://struts.apache.org/2.x/docs/spring-plugin.html" target="_top">Spring
      Plugin</a> for the built-in Spring integration shipped with Struts
      2. In general, Struts 2 is closer to WebWork 2.2 than to Struts 1 in
      terms of its Spring integration implications.</p></td></tr></table></div><p>To integrate your Struts 1.x application with Spring, you have two
    options:</p><div class="itemizedlist"><ul type="disc"><li><p>Configure Spring to manage your Actions as beans, using the
        <code class="classname">ContextLoaderPlugin</code>, and set their dependencies
        in a Spring context file.</p></li><li><p>Subclass Spring's <code class="classname">ActionSupport</code> classes
        and grab your Spring-managed beans explicitly using a
        <span class="emphasis"><em>getWebApplicationContext()</em></span> method.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="struts-contextloaderplugin"></a>18.4.1&nbsp;ContextLoaderPlugin</h3></div></div></div><p>The <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/struts/ContextLoaderPlugIn.html" target="_top"><code class="classname">ContextLoaderPlugin</code></a>
      is a Struts 1.1+ plug-in that loads a Spring context file for the Struts
      <code class="classname">ActionServlet</code>. This context refers to the root
      <code class="classname">WebApplicationContext</code> (loaded by the
      <code class="classname">ContextLoaderListener</code>) as its parent. The default
      name of the context file is the name of the mapped servlet, plus
      <span class="emphasis"><em>-servlet.xml</em></span>. If
      <code class="classname">ActionServlet</code> is defined in web.xml as
      <code class="literal">&lt;servlet-name&gt;action&lt;/servlet-name&gt;</code>, the
      default is <span class="emphasis"><em>/WEB-INF/action-servlet.xml</em></span>.</p><p>To configure this plug-in, add the following XML to the plug-ins
      section near the bottom of your <span class="emphasis"><em>struts-config.xml</em></span>
      file:</p><pre class="programlisting">&lt;<span class="hl-tag">plug-in</span> <span class="hl-attribute">className</span>=<span class="hl-value">"org.springframework.web.struts.ContextLoaderPlugIn"</span>/&gt;</pre><p>The location of the context configuration files can be customized
      using the '<code class="literal">contextConfigLocation</code>' property.</p><pre class="programlisting">&lt;<span class="hl-tag">plug-in</span> <span class="hl-attribute">className</span>=<span class="hl-value">"org.springframework.web.struts.ContextLoaderPlugIn"</span>&gt;
  &lt;<span class="hl-tag">set-property</span> <span class="hl-attribute">property</span>=<span class="hl-value">"contextConfigLocation"</span>
      <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/action-servlet.xml,/WEB-INF/applicationContext.xml"</span>/&gt;
&lt;<span class="hl-tag">/plug-in</span>&gt;</pre><p>It is possible to use this plugin to load all your context files,
      which can be useful when using testing tools like StrutsTestCase.
      StrutsTestCase's <code class="classname">MockStrutsTestCase</code> won't
      initialize Listeners on startup so putting all your context files in the
      plugin is a workaround. (A <a class="ulink" href="http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1088866&amp;group_id=39190&amp;atid=424562" target="_top">
      bug has been filed</a> for this issue, but has been closed as 'Wont
      Fix').</p><p>After configuring this plug-in in
      <span class="emphasis"><em>struts-config.xml</em></span>, you can configure your
      <code class="classname">Action</code> to be managed by Spring. Spring (1.1.3+)
      provides two ways to do this:</p><div class="itemizedlist"><ul type="disc"><li><p>Override Struts' default
          <code class="classname">RequestProcessor</code> with Spring's
          <code class="classname">DelegatingRequestProcessor</code>.</p></li><li><p>Use the <code class="classname">DelegatingActionProxy</code> class in
          the <code class="literal">type</code> attribute of your
          <code class="literal">&lt;action-mapping&gt;</code>.</p></li></ul></div><p>Both of these methods allow you to manage your Actions and their
      dependencies in the <span class="emphasis"><em>action-servlet.xml</em></span> file. The
      bridge between the Action in <span class="emphasis"><em>struts-config.xml</em></span> and
      <span class="emphasis"><em>action-servlet.xml</em></span> is built with the
      action-mapping's "path" and the bean's "name". If you have the following
      in your <span class="emphasis"><em>struts-config.xml</em></span> file:</p><pre class="programlisting">&lt;<span class="hl-tag">action</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/users"</span> <span class="hl-attribute">.../&gt;</span></pre><p>You must define that Action's bean with the "/users" name in
      <span class="emphasis"><em>action-servlet.xml</em></span>:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"/users"</span> <span class="hl-attribute">.../&gt;</span></pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="struts-delegatingrequestprocessor"></a>18.4.1.1&nbsp;DelegatingRequestProcessor</h4></div></div></div><p>To configure the <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/struts/DelegatingRequestProcessor.html" target="_top">
        <code class="literal">DelegatingRequestProcessor</code></a> in your
        <span class="emphasis"><em>struts-config.xml</em></span> file, override the
        "processorClass" property in the &lt;controller&gt; element. These
        lines follow the &lt;action-mapping&gt; element.</p><pre class="programlisting">&lt;<span class="hl-tag">controller</span>&gt;
  &lt;<span class="hl-tag">set-property</span> <span class="hl-attribute">property</span>=<span class="hl-value">"processorClass"</span>
      <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.web.struts.DelegatingRequestProcessor"</span>/&gt;
&lt;<span class="hl-tag">/controller</span>&gt;</pre><p>After adding this setting, your Action will automatically be
        looked up in Spring's context file, no matter what the type. In fact,
        you don't even need to specify a type. Both of the following snippets
        will work:</p><pre class="programlisting">&lt;<span class="hl-tag">action</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/user"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"com.whatever.struts.UserAction"</span>/&gt;
&lt;<span class="hl-tag">action</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/user"</span>/&gt;</pre><p>If you're using Struts' <span class="emphasis"><em>modules</em></span> feature,
        your bean names must contain the module prefix. For example, an action
        defined as <code class="literal">&lt;action path="/user"/&gt;</code> with module
        prefix "admin" requires a bean name with <code class="literal">&lt;bean
        name="/admin/user"/&gt;</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you are using Tiles in your Struts application, you must
          configure your &lt;controller&gt; with the <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/struts/DelegatingTilesRequestProcessor.html" target="_top"><code class="classname">DelegatingTilesRequestProcessor</code></a>
          instead.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="struts-delegatingactionproxy"></a>18.4.1.2&nbsp;DelegatingActionProxy</h4></div></div></div><p>If you have a custom <code class="classname">RequestProcessor</code> and
        can't use the <code class="classname">DelegatingRequestProcessor</code> or
        <code class="classname">DelegatingTilesRequestProcessor</code> approaches, you
        can use the <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/struts/DelegatingActionProxy.html" target="_top">
        <code class="classname">DelegatingActionProxy</code></a> as the type in
        your action-mapping.</p><pre class="programlisting">&lt;<span class="hl-tag">action</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/user"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"org.springframework.web.struts.DelegatingActionProxy"</span>
    <span class="hl-attribute">name</span>=<span class="hl-value">"userForm"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"request"</span> <span class="hl-attribute">validate</span>=<span class="hl-value">"false"</span> <span class="hl-attribute">parameter</span>=<span class="hl-value">"method"</span>&gt;
  &lt;<span class="hl-tag">forward</span> <span class="hl-attribute">name</span>=<span class="hl-value">"list"</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/userList.jsp"</span>/&gt;
  &lt;<span class="hl-tag">forward</span> <span class="hl-attribute">name</span>=<span class="hl-value">"edit"</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/userForm.jsp"</span>/&gt;
&lt;<span class="hl-tag">/action</span>&gt;</pre><p>The bean definition in <span class="emphasis"><em>action-servlet.xml</em></span>
        remains the same, whether you use a custom
        <code class="literal">RequestProcessor</code> or the
        <code class="classname">DelegatingActionProxy</code>.</p><p>If you define your <code class="classname">Action</code> in a context
        file, the full feature set of Spring's bean container will be
        available for it: dependency injection as well as the option to
        instantiate a new <code class="classname">Action</code> instance for each
        request. To activate the latter, add
        <span class="emphasis"><em>scope="prototype"</em></span> to your Action's bean
        definition.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"/user"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span> <span class="hl-attribute">autowire</span>=<span class="hl-value">"byName"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.web.UserAction"</span>/&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="struts-actionsupport"></a>18.4.2&nbsp;ActionSupport Classes</h3></div></div></div><p>As previously mentioned, you can retrieve the
      <code class="classname">WebApplicationContext</code> from the
      <span class="interface">ServletContext</span> using the
      <code class="classname">WebApplicationContextUtils</code> class. An easier way
      is to extend Spring's <code class="classname">Action</code> classes for Struts.
      For example, instead of subclassing Struts'
      <code class="classname">Action</code> class, you can subclass Spring's <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/struts/ActionSupport.html" target="_top">
      <code class="classname">ActionSupport</code></a> class.</p><p>The <code class="classname">ActionSupport</code> class provides additional
      convenience methods, like
      <span class="emphasis"><em>getWebApplicationContext()</em></span>. Below is an example of
      how you might use this in an Action:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UserAction <span class="hl-keyword">extends</span> DispatchActionSupport {

    <span class="hl-keyword">public</span> ActionForward execute(ActionMapping mapping,
                                 ActionForm form,
                                 HttpServletRequest request,
                                 HttpServletResponse response) <span class="hl-keyword">throws</span> Exception {
        <span class="hl-keyword">if</span> (log.isDebugEnabled()) {
            log.debug(<span class="hl-string">"entering 'delete' method..."</span>);
        }
        WebApplicationContext ctx = getWebApplicationContext();
        UserManager mgr = (UserManager) ctx.getBean(<span class="hl-string">"userManager"</span>);
        <span class="hl-comment">// talk to manager for business logic</span>
        <span class="hl-keyword">return</span> mapping.findForward(<span class="hl-string">"success"</span>);
    }
}</pre><p>Spring includes subclasses for all of the standard Struts Actions
      - the Spring versions merely have <span class="emphasis"><em>Support</em></span> appended
      to the name: </p><div class="itemizedlist"><ul type="disc" compact><li><p><a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/struts/ActionSupport.html" target="_top"><code class="classname">ActionSupport</code></a>,</p></li><li><p><a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/struts/DispatchActionSupport.html" target="_top"><code class="literal">DispatchActionSupport</code></a>,</p></li><li><p><a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/struts/LookupDispatchActionSupport.html" target="_top"><code class="literal">LookupDispatchActionSupport</code></a>
            and</p></li><li><p><a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/struts/MappingDispatchActionSupport.html" target="_top"><code class="literal">MappingDispatchActionSupport</code></a>.</p></li></ul></div><p>The recommended strategy is to use the approach that best suits
      your project. Subclassing makes your code more readable, and you know
      exactly how your dependencies are resolved. In contrast, using the
      <code class="classname">ContextLoaderPlugin</code> allows you to easily add new
      dependencies in your context XML file. Either way, Spring provides some
      nice options for integrating with Struts.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="webwork"></a>18.5&nbsp;WebWork 2.x</h2></div></div></div><p>From the <a class="ulink" href="http://www.opensymphony.com/webwork/" target="_top">WebWork
    homepage</a>:</p><p>
        &#8220;<span class="quote">
          <span class="emphasis"><em>WebWork is a Java web-application development framework. It is
          built specifically with developer productivity and code simplicity in
          mind, providing robust support for building reusable UI templates, such
          as form controls, UI themes, internationalization, dynamic form
          parameter mapping to JavaBeans, robust client and server side
          validation, and much more.</em></span>
        </span>&#8221;
    </p><p>Web work's architecture and concepts are easy to
    understand, and the framework also has an extensive tag library as well as
    nicely decoupled validation.</p><p>One of the key enablers in WebWork's technology stack is <a class="ulink" href="http://www.opensymphony.com/webwork/wikidocs/IoC%20Overview.html" target="_top">an
    IoC container</a> to manage Webwork Actions, handle the "wiring" of
    business objects, etc. Prior to WebWork version 2.2, WebWork used its own
    proprietary IoC container (and provided integration points so that one
    could integrate an IoC container such as Spring's into the mix). However,
    as of WebWork version 2.2, the default IoC container that is used within
    WebWork <span class="emphasis"><em>is</em></span> Spring. This is obviously great news if
    one is a Spring developer, because it means that one is immediately
    familiar with the basics of IoC configuration, idioms, and suchlike within
    WebWork.</p><p>Now in the interests of adhering to the DRY (Don't Repeat Yourself)
    principle, it would be foolish to document the Spring-WebWork integration
    in light of the fact that the WebWork team have already written such a
    writeup. Please consult the <a class="ulink" href="http://www.opensymphony.com/webwork/wikidocs/Spring.html" target="_top">Spring-WebWork
    integration page</a> on the <a class="ulink" href="http://wiki.opensymphony.com/display/WW/WebWork" target="_top">WebWork wiki</a>
    for the full lowdown.</p><p>Note that the Spring-WebWork integration code was developed (and
    continues to be maintained and improved) by the WebWork developers
    themselves. So please refer first to the WebWork site and forums if you are
    having issues with the integration. But feel free to
    post comments and queries regarding the Spring-WebWork integration on the
    <a class="ulink" href="http://forum.springframework.org/forumdisplay.php?f=25" target="_top">Spring
    support forums</a>, too.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tapestry"></a>18.6&nbsp;Tapestry 3.x and 4.x</h2></div></div></div><p>From the <a class="ulink" href="http://tapestry.apache.org/" target="_top">Tapestry
    homepage</a>:</p><p>
        &#8220;<span class="quote">
          <span class="emphasis"><em>Tapestry is an open-source framework for creating dynamic,
          robust, highly scalable web applications in Java. Tapestry complements
          and builds upon the standard Java Servlet API, and so it works in any
          servlet container or application server.</em></span>
        </span>&#8221;
    </p><p>While Spring has its own <a class="link" href="#mvc" title="16.&nbsp;Web MVC framework">powerful web
    layer</a>, there are a number of unique advantages to building an
    enterprise Java application using a combination of Tapestry for the web
    user interface and the Spring container for the lower layers. This section
    of the web integration chapter attempts to detail a few best practices for
    combining these two frameworks.</p><p>A <span class="emphasis"><em>typical</em></span> layered enterprise Java application
    built with Tapestry and Spring will consist of a top user interface (UI)
    layer built with Tapestry, and a number of lower layers, all wired together
    by one or more Spring containers. Tapestry's own reference documentation
    contains the following snippet of best practice advice. (Text that the
    author of this Spring section has added is contained within
    <code class="literal">[]</code> brackets.)</p><p>
        &#8220;<span class="quote">
          <span class="emphasis"><em>A very succesful design pattern in Tapestry is to keep pages
          and components very simple, and <span class="bold"><strong>delegate</strong></span> as much logic as possible out to
          HiveMind [or Spring, or whatever] services. Listener methods should
          ideally do little more than marshal together the correct information
          and pass it over to a service.</em></span>
        </span>&#8221;
    </p><p>The key question then is: how does one supply Tapestry pages with
    collaborating services? The answer, ideally, is that one would want to
    dependency inject those services directly into one's Tapestry pages. In
    Tapestry, one can effect this dependency injection by a variety of
    means. This section is only going to enumerate the dependency injection
    means afforded by Spring. The real beauty of the rest of this
    Spring-Tapestry integration is that the elegant and flexible design of
    Tapestry itself makes doing this dependency injection of Spring-managed
    beans a cinch. (Another nice thing is that this Spring-Tapestry
    integration code was written - and continues to be maintained - by the
    Tapestry creator <a class="ulink" href="http://howardlewisship.com/blog/" target="_top">Howard M.
    Lewis Ship</a>, so hats off to him for what is really some silky
    smooth integration).</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tapestry-di"></a>18.6.1&nbsp;Injecting Spring-managed beans</h3></div></div></div><p>Assume we have the following simple Spring container definition
      (in the ubiquitous XML format):</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:jee</span>=<span class="hl-value">"http://www.springframework.org/schema/jee"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-3.0.xsd"</span>&gt;
 
&lt;<span class="hl-tag">beans</span>&gt;
    &lt;<span class="hl-comment">!-- the DataSource --</span>&gt;
    &lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"java:DefaultDS"</span>/&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"hibSessionFactory"</span> 
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate3.LocalSessionFactoryBean"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionManager"</span> 
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.jta.JtaTransactionManager"</span>/&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mapper"</span> 
          <span class="hl-attribute">class</span>=<span class="hl-value">"com.whatever.dataaccess.mapper.hibernate.MapperImpl"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"hibSessionFactory"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

    &lt;<span class="hl-comment">!-- (transactional) AuthenticationService --</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"authenticationService"</span> 
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionProxyFactoryBean"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span>&gt;
            &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.whatever.services.service.user.AuthenticationServiceImpl"</span>&gt;
                &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mapper"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"mapper"</span>/&gt;
            &lt;<span class="hl-tag">/bean</span>&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"proxyInterfacesOnly"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributes"</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;
                *=PROPAGATION_REQUIRED
            &lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;  
 
    &lt;<span class="hl-comment">!-- (transactional) UserService --</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userService"</span> 
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionProxyFactoryBean"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span>&gt;
             &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.whatever.services.service.user.UserServiceImpl"</span>&gt;
                 &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mapper"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"mapper"</span>/&gt;
             &lt;<span class="hl-tag">/bean</span>&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"proxyInterfacesOnly"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributes"</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;
                *=PROPAGATION_REQUIRED
            &lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;  
 
 &lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Inside the Tapestry application, the above bean definitions need
      to be <a class="link" href="#web-integration-common" title="18.2&nbsp;Common configuration">loaded into a Spring
      container</a>, and any relevant Tapestry pages need to be supplied
      (injected) with the <code class="literal">authenticationService</code> and
      <code class="literal">userService</code> beans, which implement the
      <code class="interfacename">AuthenticationService</code> and
      <code class="interfacename">UserService</code> interfaces,
      respectively.</p><p>At this point, the application context is available to a web
      application by calling Spring's static utility function
      <code class="literal">WebApplicationContextUtils.getApplicationContext(servletContext)</code>,
      where servletContext is the standard
      <span class="interface">ServletContext</span> from the Java EE Servlet
      specification. As such, one simple mechanism for a page to get an
      instance of the <code class="interfacename">UserService</code>, for example,
      would be with code such as:</p><pre class="programlisting">WebApplicationContext appContext = WebApplicationContextUtils.getApplicationContext(
    getRequestCycle().getRequestContext().getServlet().getServletContext());
UserService userService = (UserService) appContext.getBean(<span class="hl-string">"userService"</span>);
<span class="hl-comment">// ... some code which uses UserService</span></pre><p>This mechanism does work. Having said that, it can be made a lot
      less verbose by encapsulating most of the functionality in a method in
      the base class for the page or component. However, in some respects it
      goes against the IoC principle; ideally you would like the page to not
      have to ask the context for a specific bean by name, and in fact, the
      page would ideally not know about the context at all.</p><p>Luckily, there is a mechanism to allow this. We rely upon the fact
      that Tapestry already has a mechanism to declaratively add properties to
      a page, and it is in fact the preferred approach to manage all
      properties on a page in this declarative fashion, so that Tapestry can
      properly manage their lifecycle as part of the page and component
      lifecycle.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>This next section is applicable to Tapestry 3.x. If you are
        using Tapestry version 4.x, please consult the section entitled <a class="xref" href="#tapestry-4-style-di" title="18.6.1.4&nbsp;Dependency Injecting Spring Beans into Tapestry pages - Tapestry 4.x style">Section&nbsp;18.6.1.4, &#8220;Dependency Injecting Spring Beans into Tapestry pages -
        Tapestry 4.x style&#8221;</a>.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tapestry-pre4-style-di"></a>18.6.1.1&nbsp;Dependency Injecting Spring Beans into Tapestry pages</h4></div></div></div><p>First we need to make the
        <span class="interface">ApplicationContext</span> available to the Tapestry
        page or Component without having to have the
        <span class="interface">ServletContext</span>; this is because at the stage in
        the page's/component's lifecycle when we need to access the
        <span class="interface">ApplicationContext</span>, the
        <span class="interface">ServletContext</span> won't be easily available to the
        page, so we can't use
        <code class="literal">WebApplicationContextUtils.getApplicationContext(servletContext)</code>
        directly. One way is by defining a custom version of the Tapestry
        <code class="interfacename">IEngine</code> which exposes this for
        us:</p><pre class="programlisting"><span class="hl-keyword">package</span> com.whatever.web.xportal;

<span class="hl-comment">// import ...</span>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyEngine <span class="hl-keyword">extends</span> org.apache.tapestry.engine.BaseEngine {
 
    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> String APPLICATION_CONTEXT_KEY = <span class="hl-string">"appContext"</span>;
 
    <span class="hl-comment">/**
     * @see org.apache.tapestry.engine.AbstractEngine#setupForRequest(org.apache.tapestry.request.RequestContext)
     */</span>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> setupForRequest(RequestContext context) {
        <span class="hl-keyword">super</span>.setupForRequest(context);
     
        <span class="hl-comment">// insert ApplicationContext in global, if not there</span>
        Map global = (Map) getGlobal();
        ApplicationContext ac = (ApplicationContext) global.get(APPLICATION_CONTEXT_KEY);
        <span class="hl-keyword">if</span> (ac == null) {
            ac = WebApplicationContextUtils.getWebApplicationContext(
                context.getServlet().getServletContext()
            );
            global.put(APPLICATION_CONTEXT_KEY, ac);
        }
    }
}</pre><p>This engine class places the Spring Application Context as an
        attribute called "appContext" in this Tapestry app's 'Global' object.
        Make sure to register the fact that this special IEngine instance
        should be used for this Tapestry application, with an entry in the
        Tapestry application definition file. For example:</p><pre class="programlisting">file: xportal.application:
&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">!DOCTYPE</span> <span class="hl-attribute">application</span> <span class="hl-attribute">PUBLIC</span> 
    <span class="hl-attribute">"-//Apache</span> <span class="hl-attribute">Software</span> <span class="hl-attribute">Foundation//Tapestry</span> <span class="hl-attribute">Specification</span> <span class="hl-attribute">3.0//EN"</span> 
    <span class="hl-attribute">"http://jakarta.apache.org/tapestry/dtd/Tapestry_3_0.dtd"&gt;</span>
<span class="hl-attribute">&lt;application</span>
    <span class="hl-attribute">name</span>=<span class="hl-value">"Whatever xPortal"</span>
    <span class="hl-attribute">engine-class</span>=<span class="hl-value">"com.whatever.web.xportal.MyEngine"</span>&gt;
&lt;<span class="hl-tag">/application</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tapestry-componentdefs"></a>18.6.1.2&nbsp;Component definition files</h4></div></div></div><p>Now in our page or component definition file (*.page or *.jwc),
        we simply add property-specification elements to grab the beans we
        need out of the <code class="interfacename">ApplicationContext</code>, and
        create page or component properties for them. For example:</p><pre class="programlisting">    &lt;<span class="hl-tag">property-specification</span> <span class="hl-attribute">name</span>=<span class="hl-value">"userService"</span>
                            <span class="hl-attribute">type</span>=<span class="hl-value">"com.whatever.services.service.user.UserService"</span>&gt;
        global.appContext.getBean("userService")
    &lt;<span class="hl-tag">/property-specification</span>&gt;
    &lt;<span class="hl-tag">property-specification</span> <span class="hl-attribute">name</span>=<span class="hl-value">"authenticationService"</span>
                            <span class="hl-attribute">type</span>=<span class="hl-value">"com.whatever.services.service.user.AuthenticationService"</span>&gt;
        global.appContext.getBean("authenticationService")
    &lt;<span class="hl-tag">/property-specification</span>&gt;</pre><p>The OGNL expression inside the property-specification specifies
        the initial value for the property, as a bean obtained from the
        context. The entire page definition might look like this:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">!DOCTYPE</span> <span class="hl-attribute">page-specification</span> <span class="hl-attribute">PUBLIC</span> 
    <span class="hl-attribute">"-//Apache</span> <span class="hl-attribute">Software</span> <span class="hl-attribute">Foundation//Tapestry</span> <span class="hl-attribute">Specification</span> <span class="hl-attribute">3.0//EN"</span> 
    <span class="hl-attribute">"http://jakarta.apache.org/tapestry/dtd/Tapestry_3_0.dtd"&gt;</span>
     
<span class="hl-attribute">&lt;page-specification</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.whatever.web.xportal.pages.Login"</span>&gt;
 
    &lt;<span class="hl-tag">property-specification</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"java.lang.String"</span>/&gt;
    &lt;<span class="hl-tag">property-specification</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"java.lang.String"</span>/&gt;
    &lt;<span class="hl-tag">property-specification</span> <span class="hl-attribute">name</span>=<span class="hl-value">"error"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"java.lang.String"</span>/&gt;
    &lt;<span class="hl-tag">property-specification</span> <span class="hl-attribute">name</span>=<span class="hl-value">"callback"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"org.apache.tapestry.callback.ICallback"</span> <span class="hl-attribute">persistent</span>=<span class="hl-value">"yes"</span>/&gt;
    &lt;<span class="hl-tag">property-specification</span> <span class="hl-attribute">name</span>=<span class="hl-value">"userService"</span>
                            <span class="hl-attribute">type</span>=<span class="hl-value">"com.whatever.services.service.user.UserService"</span>&gt;
        global.appContext.getBean("userService")
    &lt;<span class="hl-tag">/property-specification</span>&gt;
    &lt;<span class="hl-tag">property-specification</span> <span class="hl-attribute">name</span>=<span class="hl-value">"authenticationService"</span>
                            <span class="hl-attribute">type</span>=<span class="hl-value">"com.whatever.services.service.user.AuthenticationService"</span>&gt;
        global.appContext.getBean("authenticationService")
    &lt;<span class="hl-tag">/property-specification</span>&gt;
   
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"delegate"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.whatever.web.xportal.PortalValidationDelegate"</span>/&gt;
 
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"validator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.tapestry.valid.StringValidator"</span> <span class="hl-attribute">lifecycle</span>=<span class="hl-value">"page"</span>&gt;
        &lt;<span class="hl-tag">set-property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"required"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"true"</span>/&gt;
        &lt;<span class="hl-tag">set-property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"clientScriptingEnabled"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"true"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
 
    &lt;<span class="hl-tag">component</span> <span class="hl-attribute">id</span>=<span class="hl-value">"inputUsername"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"ValidField"</span>&gt;
        &lt;<span class="hl-tag">static-binding</span> <span class="hl-attribute">name</span>=<span class="hl-value">"displayName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Username"</span>/&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">name</span>=<span class="hl-value">"value"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"username"</span>/&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">name</span>=<span class="hl-value">"validator"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"beans.validator"</span>/&gt;
    &lt;<span class="hl-tag">/component</span>&gt;
   
    &lt;<span class="hl-tag">component</span> <span class="hl-attribute">id</span>=<span class="hl-value">"inputPassword"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"ValidField"</span>&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">name</span>=<span class="hl-value">"value"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"password"</span>/&gt;
       &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">name</span>=<span class="hl-value">"validator"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"beans.validator"</span>/&gt;
       &lt;<span class="hl-tag">static-binding</span> <span class="hl-attribute">name</span>=<span class="hl-value">"displayName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Password"</span>/&gt;
       &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hidden"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"true"</span>/&gt;
    &lt;<span class="hl-tag">/component</span>&gt;
 
&lt;<span class="hl-tag">/page-specification</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tapestry-getters"></a>18.6.1.3&nbsp;Adding abstract accessors</h4></div></div></div><p>Now in the Java class definition for the page or component
        itself, all we need to do is add an abstract getter method for the
        properties we have defined (in order to be able to access the
        properties).</p><pre class="programlisting"><span class="hl-comment">// our UserService implementation; will come from page definition</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> UserService getUserService();
<span class="hl-comment">// our AuthenticationService implementation; will come from page definition</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> AuthenticationService getAuthenticationService();</pre><p>For the sake of completeness, the entire Java class, for a login
        page in this example, might look like this:</p><pre class="programlisting"><span class="hl-keyword">package</span> com.whatever.web.xportal.pages;
 
<span class="hl-comment">/**
 *  Allows the user to login, by providing username and password.
 *  After successfully logging in, a cookie is placed on the client browser
 *  that provides the default username for future logins (the cookie
 *  persists for a week).
 */</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> Login <span class="hl-keyword">extends</span> BasePage <span class="hl-keyword">implements</span> ErrorProperty, PageRenderListener {
 
    <span class="hl-comment">/** the key under which the authenticated user object is stored in the visit as */</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> String USER_KEY = <span class="hl-string">"user"</span>;
   
    <span class="hl-comment">/** The name of the cookie that identifies a user **/</span>
    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> String COOKIE_NAME = Login.<span class="hl-keyword">class</span>.getName() + <span class="hl-string">".username"</span>;  
    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> <span class="hl-keyword">static</span> <span class="hl-keyword">int</span> ONE_WEEK = 7 * 24 * 60 * 60;
 
    <span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> String getUsername();
    <span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">void</span> setUsername(String username);
 
    <span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> String getPassword();
    <span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">void</span> setPassword(String password);
 
    <span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> ICallback getCallback();
    <span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">void</span> setCallback(ICallback value);
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> UserService getUserService();
    <span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> AuthenticationService getAuthenticationService();
 
    <span class="hl-keyword">protected</span> IValidationDelegate getValidationDelegate() {
        <span class="hl-keyword">return</span> (IValidationDelegate) getBeans().getBean(<span class="hl-string">"delegate"</span>);
    }
 
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> setErrorField(String componentId, String message) {
        IFormComponent field = (IFormComponent) getComponent(componentId);
        IValidationDelegate delegate = getValidationDelegate();
        delegate.setFormComponent(field);
        delegate.record(<span class="hl-keyword">new</span> ValidatorException(message));
    }
 
    <span class="hl-comment">/**
     *  Attempts to login. 
     * &lt;p&gt;
     *  If the user name is not known, or the password is invalid, then an error
     *  message is displayed.
     **/</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> attemptLogin(IRequestCycle cycle) {
     
        String password = getPassword();
 
        <span class="hl-comment">// Do a little extra work to clear out the password.</span>
        setPassword(null);
        IValidationDelegate delegate = getValidationDelegate();
 
        delegate.setFormComponent((IFormComponent) getComponent(<span class="hl-string">"inputPassword"</span>));
        delegate.recordFieldInputValue(null);
 
        <span class="hl-comment">// An error, from a validation field, may already have occurred.</span>
        <span class="hl-keyword">if</span> (delegate.getHasErrors()) {
            <span class="hl-keyword">return</span>;
        }

        <span class="hl-keyword">try</span> {
            User user = getAuthenticationService().login(getUsername(), getPassword());
           loginUser(user, cycle);
        }
        <span class="hl-keyword">catch</span> (FailedLoginException ex) {
            <span class="hl-keyword">this</span>.setError(<span class="hl-string">"Login failed: "</span> + ex.getMessage());
            <span class="hl-keyword">return</span>;
        }
    }
 
    <span class="hl-comment">/**
     *  Sets up the {@link User} as the logged in user, creates
     *  a cookie for their username (for subsequent logins),
     *  and redirects to the appropriate page, or
     *  a specified page).
     **/</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> loginUser(User user, IRequestCycle cycle) {
     
        String username = user.getUsername();
 
        <span class="hl-comment">// Get the visit object; this will likely force the</span>
        <span class="hl-comment">// creation of the visit object and an HttpSession</span>
        Map visit = (Map) getVisit();
        visit.put(USER_KEY, user);
 
        <span class="hl-comment">// After logging in, go to the MyLibrary page, unless otherwise specified</span>
        ICallback callback = getCallback();
 
        <span class="hl-keyword">if</span> (callback == null) {
            cycle.activate(<span class="hl-string">"Home"</span>);
        }
        <span class="hl-keyword">else</span> {
            callback.performCallback(cycle);
        }

        IEngine engine = getEngine();
        Cookie cookie = <span class="hl-keyword">new</span> Cookie(COOKIE_NAME, username);
        cookie.setPath(engine.getServletPath());
        cookie.setMaxAge(ONE_WEEK);
 
        <span class="hl-comment">// Record the user's username in a cookie</span>
        cycle.getRequestContext().addCookie(cookie);
        engine.forgetPage(getPageName());
    }
   
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> pageBeginRender(PageEvent event) {
        <span class="hl-keyword">if</span> (getUsername() == null) {
            setUsername(getRequestCycle().getRequestContext().getCookieValue(COOKIE_NAME));
        }
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tapestry-4-style-di"></a>18.6.1.4&nbsp;Dependency Injecting Spring Beans into Tapestry pages -
        Tapestry 4.x style</h4></div></div></div><p>Effecting the dependency injection of Spring-managed beans into
        Tapestry pages in Tapestry version 4.x is <span class="emphasis"><em>so</em></span> much
        simpler. All that is needed is a single <a class="ulink" href="http://howardlewisship.com/tapestry-javaforge/tapestry-spring/" target="_top">add-on
        library</a>, and some (small) amount of (essentially boilerplate)
        configuration. Simply package and deploy this library with the (any of
        the) other libraries required by your web application (typically in
        <code class="literal">WEB-INF/lib</code>).</p><p>You will then need to create and expose the Spring container
        using the <a class="link" href="#web-integration-common" title="18.2&nbsp;Common configuration">method detailed
        previously</a>. You can then inject Spring-managed beans into
        Tapestry very easily; if we are using Java 5, consider the
        <code class="classname">Login</code> page from above: we simply need to
        annotate the appropriate getter methods in order to dependency inject
        the Spring-managed <code class="literal">userService</code> and
        <code class="literal">authenticationService</code> objects (lots of the class
        definition has been elided for clarity).</p><pre class="programlisting"><span class="hl-keyword">package</span> com.whatever.web.xportal.pages;

<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> Login <span class="hl-keyword">extends</span> BasePage <span class="hl-keyword">implements</span> ErrorProperty, PageRenderListener {
    
    @InjectObject(<span class="hl-string">"spring:userService"</span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> UserService getUserService();
    
    @InjectObject(<span class="hl-string">"spring:authenticationService"</span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> AuthenticationService getAuthenticationService();

}</pre><p>We are almost done. All that remains is the HiveMind
        configuration that exposes the Spring container stored in the
        <code class="interfacename">ServletContext</code> as a HiveMind service;
        for example:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0"?</span>&gt;
&lt;<span class="hl-tag">module</span> <span class="hl-attribute">id</span>=<span class="hl-value">"com.javaforge.tapestry.spring"</span> <span class="hl-attribute">version</span>=<span class="hl-value">"0.1.1"</span>&gt;

    &lt;<span class="hl-tag">service-point</span> <span class="hl-attribute">id</span>=<span class="hl-value">"SpringApplicationInitializer"</span>
        <span class="hl-attribute">interface</span>=<span class="hl-value">"org.apache.tapestry.services.ApplicationInitializer"</span>
        <span class="hl-attribute">visibility</span>=<span class="hl-value">"private"</span>&gt;
        &lt;<span class="hl-tag">invoke-factory</span>&gt;
            &lt;<span class="hl-tag">construct</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.javaforge.tapestry.spring.SpringApplicationInitializer"</span>&gt;
                &lt;<span class="hl-tag">set-object</span> <span class="hl-attribute">property</span>=<span class="hl-value">"beanFactoryHolder"</span>
                    <span class="hl-attribute">value</span>=<span class="hl-value">"service:hivemind.lib.DefaultSpringBeanFactoryHolder"</span> /&gt;
            &lt;<span class="hl-tag">/construct</span>&gt;
        &lt;<span class="hl-tag">/invoke-factory</span>&gt;
    &lt;<span class="hl-tag">/service-point</span>&gt;

    &lt;<span class="hl-comment">!-- Hook the Spring setup into the overall application initialization. --</span>&gt;
    &lt;<span class="hl-tag">contribution</span>
        <span class="hl-attribute">configuration-id</span>=<span class="hl-value">"tapestry.init.ApplicationInitializers"</span>&gt;
        &lt;<span class="hl-tag">command</span> <span class="hl-attribute">id</span>=<span class="hl-value">"spring-context"</span>
            <span class="hl-attribute">object</span>=<span class="hl-value">"service:SpringApplicationInitializer"</span> /&gt;
    &lt;<span class="hl-tag">/contribution</span>&gt;

&lt;<span class="hl-tag">/module</span>&gt;</pre><p>If you are using Java 5 (and thus have access to annotations),
        then that really is it.</p><p>If you are not using Java 5, then one obviously doesn't annotate
        one's Tapestry page classes with annotations; instead, one simply uses
        good old fashioned XML to declare the dependency injection; for
        example, inside the <code class="literal">.page</code> or
        <code class="literal">.jwc</code> file for the <code class="classname">Login</code> page
        (or component):</p><pre class="programlisting">&lt;<span class="hl-tag">inject</span> <span class="hl-attribute">property</span>=<span class="hl-value">"userService"</span> <span class="hl-attribute">object</span>=<span class="hl-value">"spring:userService"</span>/&gt;
&lt;<span class="hl-tag">inject</span> <span class="hl-attribute">property</span>=<span class="hl-value">"authenticationService"</span> <span class="hl-attribute">object</span>=<span class="hl-value">"spring:authenticationService"</span>/&gt;</pre><p>In this example, we've managed to allow service beans defined in a
        Spring container to be provided to the Tapestry page in a declarative
        fashion. The page class does not know where the service implementations
        are coming from, and in fact it is easy to slip in another implementation,
        for example, during testing. This inversion of control is one of the prime
        goals and benefits of the Spring Framework, and we have managed to extend
        it throughout the stack in this Tapestry application.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="web-integration-resources"></a>18.7&nbsp;Further Resources</h2></div></div></div><p>Find below links to further resources about the various web
    frameworks described in this chapter.</p><div class="itemizedlist"><ul type="disc"><li><p>The <a class="ulink" href="http://java.sun.com/javaee/javaserverfaces/" target="_top">JSF</a>
        homepage</p></li><li><p>The <a class="ulink" href="http://struts.apache.org/" target="_top">Struts</a>
        homepage</p></li><li><p>The <a class="ulink" href="http://www.opensymphony.com/webwork/" target="_top">WebWork</a>
        homepage</p></li><li><p>The <a class="ulink" href="http://tapestry.apache.org/" target="_top">Tapestry</a>
        homepage</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="portlet"></a>19.&nbsp;Portlet MVC Framework</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-introduction"></a>19.1&nbsp;Introduction</h2></div></div></div><div class="sidebar"><p class="title"><b>JSR-168 The Java Portlet Specification</b></p><p>For more general information about portlet development, please
      review a whitepaper from Sun entitled
      <a class="ulink" href="http://developers.sun.com/prodtech/portalserver/reference/techart/jsr168/" target="_top">"Introduction to JSR 168"</a>,
      and of course the
      <a class="ulink" href="http://jcp.org/aboutJava/communityprocess/final/jsr168/" target="_top">JSR-168 Specification</a> itself.</p></div><p>In addition to supporting conventional (servlet-based) Web development,
    Spring also supports JSR-168 Portlet development. As much as possible, the
    Portlet MVC framework is a mirror image of the Web MVC framework, and also
    uses the same underlying view abstractions and integration technology. So, be
    sure to review the chapters entitled <a class="xref" href="#mvc" title="16.&nbsp;Web MVC framework">Chapter&nbsp;16, <i>Web MVC framework</i></a> and
    <a class="xref" href="#view" title="17.&nbsp;View technologies">Chapter&nbsp;17, <i>View technologies</i></a> before continuing with this chapter.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Bear in mind that while the concepts of Spring MVC are the
      same in Spring Portlet MVC, there are some notable differences
      created by the unique workflow of JSR-168 portlets.</p></td></tr></table></div><p>The main way in which portlet workflow differs from servlet
    workflow is that the request to the portlet can have two distinct
    phases: the action phase and the render phase. The action phase is
    executed only once and is where any 'backend' changes or actions occur,
    such as making changes in a database. The render phase then produces
    what is displayed to the user each time the display is refreshed.
    The critical point here is that for a single overall request, the action
    phase is executed only once, but the render phase may be executed
    multiple times. This provides (and requires) a clean separation between
    the activities that modify the persistent state of your system and the
    activities that generate what is displayed to the user.</p><div class="sidebar"><p class="title"><b>Spring Web Flow</b></p><p>Spring Web Flow (SWF) aims to be the best solution for the management
  of web application page flow.</p><p>SWF integrates with existing frameworks like Spring MVC, Struts, and
  JSF, in both servlet and portlet environments. If you have a business
  process (or processes) that would benefit from a conversational model as
  opposed to a purely request model, then SWF may be the solution.</p><p>SWF allows you to capture logical page flows as self-contained modules
  that are reusable in different situations, and as such is ideal for building
  web application modules that guide the user through controlled navigations
  that drive business processes.</p><p>For more information about SWF, consult the
  <a class="ulink" href="http://www.springframework.org/webflow" target="_top">Spring Web Flow website</a>.
  </p></div><p>The dual phases of portlet requests are one of the real strengths
    of the JSR-168 specification. For example, dynamic search results can be
    updated routinely on the display without the user explicitly rerunning
    the search. Most other portlet MVC frameworks attempt to completely
    hide the two phases from the developer and make it look as much like
    traditional servlet development as possible - we think this
    approach removes one of the main benefits of using portlets. So, the
    separation of the two phases is preserved throughout the Spring Portlet
    MVC framework. The primary manifestation of this approach is that where
    the servlet version of the MVC classes will have one method that deals
    with the request, the portlet version of the MVC classes will have two
    methods that deal with the request: one for the action phase and one for
    the render phase. For example, where the servlet version of
    <code class="classname">AbstractController</code> has the
    <code class="methodname">handleRequestInternal(..)</code> method, the portlet
    version of <code class="classname">AbstractController</code> has
    <code class="methodname">handleActionRequestInternal(..)</code> and
    <code class="methodname">handleRenderRequestInternal(..)</code> methods.</p><p>The framework is designed around a
    <code class="classname">DispatcherPortlet</code> that dispatches requests to
    handlers, with configurable handler mappings and view resolution, just
    as the <code class="classname">DispatcherServlet</code> in the web framework
    does. File upload is also supported in the same way.</p><p>Locale resolution and theme resolution are not supported in
    Portlet MVC - these areas are in the purview of the
    portal/portlet container and are not appropriate at the Spring level.
    However, all mechanisms in Spring that depend on the locale (such as
    internationalization of messages) will still function properly because
    <code class="classname">DispatcherPortlet</code> exposes the current locale in
    the same way as <code class="classname">DispatcherServlet</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-introduction-controller"></a>19.1.1&nbsp;Controllers - The C in MVC</h3></div></div></div><p>The default handler is still a very simple
      <code class="interfacename">Controller</code> interface, offering just two
      methods:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="methodname">void handleActionRequest(request,response)</code> </p></li><li><p><code class="methodname">ModelAndView handleRenderRequest(request,response)</code> </p></li></ul></div><p>The framework also includes most of the same controller
      implementation hierarchy, such as <code class="classname">AbstractController</code>,
      <code class="classname">SimpleFormController</code>, and so on. Data binding,
      command object usage, model handling, and view resolution are all the
      same as in the servlet framework.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-introduction-view"></a>19.1.2&nbsp;Views - The V in MVC</h3></div></div></div><p>All the view rendering capabilities of the servlet framework are
      used directly via a special bridge servlet named
      <code class="classname">ViewRendererServlet</code>. By using this servlet, the
      portlet request is converted into a servlet request and the view can be
      rendered using the entire normal servlet infrastructure. This means all
      the existing renderers, such as JSP, Velocity, etc., can still be used
      within the portlet.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-introduction-scope"></a>19.1.3&nbsp;Web-scoped beans</h3></div></div></div><p>Spring Portlet MVC supports beans whose lifecycle is scoped to the
      current HTTP request or HTTP <code class="interfacename">Session</code> (both
      normal and global). This is not a specific feature of Spring Portlet MVC
      itself, but rather of the <code class="interfacename">WebApplicationContext</code>
      container(s) that Spring Portlet MVC uses. These bean scopes are described
      in detail in <a class="xref" href="#beans-factory-scopes-other" title="4.5.4&nbsp;Request, session, and global session scopes">Section&nbsp;4.5.4, &#8220;Request, session, and global session scopes&#8221;</a></p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-dispatcher"></a>19.2&nbsp;The <code class="classname">DispatcherPortlet</code></h2></div></div></div><p>Portlet MVC is a request-driven web MVC framework, designed around
    a portlet that dispatches requests to controllers and offers other
    functionality facilitating the development of portlet applications.
    Spring's <code class="classname">DispatcherPortlet</code> however, does more
    than just that. It is completely integrated with the Spring
    <code class="interfacename">ApplicationContext</code> and allows you to use
    every other feature Spring has.</p><p>Like ordinary portlets, the
    <code class="classname">DispatcherPortlet</code> is declared in the
    <code class="literal">portlet.xml</code> file of your web application:</p><pre class="programlisting">&lt;<span class="hl-tag">portlet</span>&gt;
    &lt;<span class="hl-tag">portlet-name</span>&gt;sample&lt;<span class="hl-tag">/portlet-name</span>&gt;
    &lt;<span class="hl-tag">portlet-class</span>&gt;org.springframework.web.portlet.DispatcherPortlet&lt;<span class="hl-tag">/portlet-class</span>&gt;
    &lt;<span class="hl-tag">supports</span>&gt;
        &lt;<span class="hl-tag">mime-type</span>&gt;text/html&lt;<span class="hl-tag">/mime-type</span>&gt;
        &lt;<span class="hl-tag">portlet-mode</span>&gt;view&lt;<span class="hl-tag">/portlet-mode</span>&gt;
    &lt;<span class="hl-tag">/supports</span>&gt;
    &lt;<span class="hl-tag">portlet-info</span>&gt;
        &lt;<span class="hl-tag">title</span>&gt;Sample Portlet&lt;<span class="hl-tag">/title</span>&gt;
    &lt;<span class="hl-tag">/portlet-info</span>&gt;
&lt;<span class="hl-tag">/portlet</span>&gt;</pre><p>The <code class="classname">DispatcherPortlet</code> now needs to be
    configured.</p><p>In the Portlet MVC framework, each
    <code class="classname">DispatcherPortlet</code> has its own
    <code class="interfacename">WebApplicationContext</code>, which inherits all
    the beans already defined in the Root
    <code class="interfacename">WebApplicationContext</code>. These inherited
    beans can be overridden in the portlet-specific scope, and new
    scope-specific beans can be defined local to a given portlet instance.</p><p>The framework will, on initialization of a
    <code class="classname">DispatcherPortlet</code>, look for a file named
    <code class="literal">[portlet-name]-portlet.xml</code> in the <code class="literal">WEB-INF</code>
    directory of your web application and create the beans defined there
    (overriding the definitions of any beans defined with the same name in
    the global scope).</p><p>The config location used by the
    <code class="classname">DispatcherPortlet</code> can be modified through a
    portlet initialization parameter (see below for details).</p><p>The Spring <code class="classname">DispatcherPortlet</code> has a few
    special beans it uses, in order to be able to process requests and
    render the appropriate views. These beans are included in the Spring
    framework and can be configured in the
    <code class="interfacename">WebApplicationContext</code>, just as any other
    bean would be configured. Each of those beans is described in more
    detail below. Right now, we'll just mention them, just to let you know
    they exist and to enable us to go on talking about the
    <code class="classname">DispatcherPortlet</code>. For most of the beans,
    defaults are provided so you don't have to worry about configuring
    them.</p><div class="table"><a name="portlet-webappctx-special-beans-tbl"></a><p class="title"><b>Table&nbsp;19.1.&nbsp;Special beans in the <code class="interfacename">WebApplicationContext</code></b></p><div class="table-contents"><table summary="Special beans in the WebApplicationContext" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="left"><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Expression</th><th style="border-bottom: 1.0pt solid ; ">Explanation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">handler mapping(s)</td><td style="border-bottom: 1.0pt solid ; ">(<a class="xref" href="#portlet-handlermapping" title="19.5&nbsp;Handler mappings">Section&nbsp;19.5, &#8220;Handler mappings&#8221;</a>) a
            list of pre- and post-processors and controllers that
            will be executed if they match certain criteria (for
            instance a matching portlet mode specified with the
            controller)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">controller(s)</td><td style="border-bottom: 1.0pt solid ; ">(<a class="xref" href="#portlet-controller" title="19.4&nbsp;Controllers">Section&nbsp;19.4, &#8220;Controllers&#8221;</a>) the beans
            providing the actual functionality (or at least, access
            to the functionality) as part of the MVC triad</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">view resolver</td><td style="border-bottom: 1.0pt solid ; ">(<a class="xref" href="#portlet-viewresolver" title="19.6&nbsp;Views and resolving them">Section&nbsp;19.6, &#8220;Views and resolving them&#8221;</a>) capable
            of resolving view names to view definitions</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">multipart resolver</td><td style="border-bottom: 1.0pt solid ; ">(<a class="xref" href="#portlet-multipart" title="19.7&nbsp;Multipart (file upload) support">Section&nbsp;19.7, &#8220;Multipart (file upload) support&#8221;</a>) offers
            functionality to process file uploads from HTML
            forms</td></tr><tr><td style="border-right: 1.0pt solid ; " align="left">handler exception resolver</td><td style="">(<a class="xref" href="#portlet-exceptionresolver" title="19.8&nbsp;Handling exceptions">Section&nbsp;19.8, &#8220;Handling exceptions&#8221;</a>)
            offers functionality to map exceptions to views or
            implement other more complex exception handling
            code</td></tr></tbody></table></div></div><br class="table-break"><p>When a <code class="classname">DispatcherPortlet</code> is setup for use
    and a request comes in for that specific
    <code class="classname">DispatcherPortlet</code>, it starts processing the
    request. The list below describes the complete process a request goes
    through if handled by a <code class="classname">DispatcherPortlet</code>:</p><div class="orderedlist"><ol type="1"><li><p>The locale returned by
      <code class="literal">PortletRequest.getLocale()</code> is bound to the
      request to let elements in the process resolve the locale to use
      when processing the request (rendering the view, preparing data,
      etc.).</p></li><li><p>If a multipart resolver is specified and this is an
      <code class="interfacename">ActionRequest</code>, the request is
      inspected for multiparts and if they are found, it is wrapped in a
      <code class="interfacename">MultipartActionRequest</code> for further
      processing by other elements in the process. (See <a class="xref" href="#portlet-multipart" title="19.7&nbsp;Multipart (file upload) support">Section&nbsp;19.7, &#8220;Multipart (file upload) support&#8221;</a> for further information about
      multipart handling).</p></li><li><p>An appropriate handler is searched for. If a handler
      is found, the execution chain associated with the handler
      (pre-processors, post-processors, controllers) will be executed in order
      to prepare a model.</p></li><li><p>If a model is returned, the view is rendered, using
      the view resolver that has been configured with the
      <code class="interfacename">WebApplicationContext</code>. If no model is
      returned (which could be due to a pre- or post-processor
      intercepting the request, for example, for security reasons), no
      view is rendered, since the request could already have been
      fulfilled.</p></li></ol></div><p>Exceptions that are thrown during processing of the request
    get picked up by any of the handler exception resolvers that are
    declared in the <code class="interfacename">WebApplicationContext</code>.
    Using these exception resolvers you can define custom behavior in case
    such exceptions get thrown.</p><p>You can customize Spring's <code class="classname">DispatcherPortlet</code>
    by adding context parameters in the <code class="literal">portlet.xml</code> file or
    portlet init-parameters. The possibilities are listed below.</p><div class="table"><a name="portlet-dpp-init-params"></a><p class="title"><b>Table&nbsp;19.2.&nbsp;<code class="classname">DispatcherPortlet</code> initialization parameters</b></p><div class="table-contents"><table summary="DispatcherPortlet initialization parameters" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="left"><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Parameter</th><th style="border-bottom: 1.0pt solid ; ">Explanation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">contextClass</code></td><td style="border-bottom: 1.0pt solid ; ">Class that implements
            <code class="interfacename">WebApplicationContext</code>,
            which will be used to instantiate the context used by
            this portlet. If this parameter isn't specified, the
            <code class="classname">XmlPortletApplicationContext</code> will
            be used.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">contextConfigLocation</code></td><td style="border-bottom: 1.0pt solid ; ">String which is passed to the context instance
            (specified by <code class="literal">contextClass</code>) to
            indicate where context(s) can be found. The String is
            potentially split up into multiple Strings (using a
            comma as a delimiter) to support multiple contexts (in
            case of multiple context locations, for beans that are
            defined twice, the latest takes precedence).</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">namespace</code></td><td style="border-bottom: 1.0pt solid ; ">The namespace of the
            <code class="interfacename">WebApplicationContext</code>.
            Defaults to <code class="literal">[portlet-name]-portlet</code>.</td></tr><tr><td style="border-right: 1.0pt solid ; " align="left"><code class="literal">viewRendererUrl</code></td><td style="">The URL at which
            <code class="classname">DispatcherPortlet</code> can access an
            instance of <code class="classname">ViewRendererServlet</code>
            (see <a class="xref" href="#portlet-viewservlet" title="19.3&nbsp;The ViewRendererServlet">Section&nbsp;19.3, &#8220;The ViewRendererServlet&#8221;</a>).</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-viewservlet"></a>19.3&nbsp;The <code class="classname">ViewRendererServlet</code></h2></div></div></div><p>The rendering process in Portlet MVC is a bit more complex than in
    Web MVC. In order to reuse all the <a class="link" href="#view" title="17.&nbsp;View technologies">view technologies</a>
    from Spring Web MVC, we must convert the
    <code class="interfacename">PortletRequest</code> /
    <code class="interfacename">PortletResponse</code> to
    <code class="interfacename">HttpServletRequest</code> /
    <code class="interfacename">HttpServletResponse</code> and then call the
    <code class="literal">render</code> method of the
    <code class="interfacename">View</code>. To do this,
    <code class="classname">DispatcherPortlet</code> uses a special servlet that
    exists for just this purpose: the
    <code class="classname">ViewRendererServlet</code>.</p><p>In order for <code class="classname">DispatcherPortlet</code> rendering to
    work, you must declare an instance of the
    <code class="classname">ViewRendererServlet</code> in the
    <code class="literal">web.xml</code> file for your web application as
    follows:</p><pre class="programlisting">&lt;<span class="hl-tag">servlet</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;ViewRendererServlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">servlet-class</span>&gt;org.springframework.web.servlet.ViewRendererServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
&lt;<span class="hl-tag">/servlet</span>&gt;

&lt;<span class="hl-tag">servlet-mapping</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;ViewRendererServlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">url-pattern</span>&gt;/WEB-INF/servlet/view&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/servlet-mapping</span>&gt;</pre><p>To perform the actual rendering, <code class="classname">DispatcherPortlet</code>
    does the following:</p><div class="orderedlist"><ol type="1"><li><p>Binds the
      <code class="interfacename">WebApplicationContext</code> to the request
      as an attribute under the same
      <code class="literal">WEB_APPLICATION_CONTEXT_ATTRIBUTE</code> key that
      <code class="classname">DispatcherServlet</code> uses.</p></li><li><p>Binds the <code class="interfacename">Model</code> and
      <code class="interfacename">View</code> objects to the request to make
      them available to the
      <code class="classname">ViewRendererServlet</code>.</p></li><li><p>Constructs a
      <code class="interfacename">PortletRequestDispatcher</code> and performs
      an <code class="literal">include</code> using the <code class="literal">/WEB-
      INF/servlet/view</code> URL that is mapped to the
      <code class="classname">ViewRendererServlet</code>.</p></li></ol></div><p>The <code class="classname">ViewRendererServlet</code> is then able to
    call the <code class="literal">render</code> method on the
    <code class="interfacename">View</code> with the appropriate
    arguments.</p><p>The actual URL for the <code class="classname">ViewRendererServlet</code>
    can be changed using <code class="classname">DispatcherPortlet</code>&#8217;s
    <code class="literal">viewRendererUrl</code> configuration parameter.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-controller"></a>19.4&nbsp;Controllers</h2></div></div></div><p>The controllers in Portlet MVC are very similar to the Web MVC
    Controllers, and porting code from one to the other should be
    simple.</p><p>The basis for the Portlet MVC controller architecture is the
    <code class="interfacename">org.springframework.web.portlet.mvc.Controller</code>
    interface, which is listed below.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Controller {

    <span class="hl-comment">/**
     * Process the render request and return a ModelAndView object which the
     * DispatcherPortlet will render.
     */</span>
    ModelAndView handleRenderRequest(RenderRequest request, RenderResponse response)
        <span class="hl-keyword">throws</span> Exception;

    <span class="hl-comment">/**
     * Process the action request. There is nothing to return.
     */</span>
    <span class="hl-keyword">void</span> handleActionRequest(ActionRequest request, ActionResponse response)
        <span class="hl-keyword">throws</span> Exception;
}</pre><p>As you can see, the Portlet
    <code class="interfacename">Controller</code> interface requires two methods
    that handle the two phases of a portlet request: the action request and
    the render request. The action phase should be capable of handling an
    action request, and the render phase should be capable of handling a
    render request and returning an appropriate model and view. While the
    <code class="interfacename">Controller</code> interface is quite abstract,
    Spring Portlet MVC offers several controllers that already contain a
    lot of the functionality you might need; most of these are very similar
    to controllers from Spring Web MVC. The
    <code class="interfacename">Controller</code> interface just defines the
    most common functionality required of every controller: handling an
    action request, handling a render request, and returning a model and a
    view.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-controller-abstractcontroller"></a>19.4.1&nbsp;<code class="classname">AbstractController</code> and <code class="classname">PortletContentGenerator</code></h3></div></div></div><p>Of course, just a <code class="interfacename">Controller</code>
      interface isn't enough. To provide a basic infrastructure, all of
      Spring Portlet MVC's <code class="interfacename">Controller</code>s
      inherit from <code class="classname">AbstractController</code>, a class
      offering access to Spring's
      <code class="interfacename">ApplicationContext</code> and control over
      caching.</p><div class="table"><a name="portlet-ac-features"></a><p class="title"><b>Table&nbsp;19.3.&nbsp;Features offered by the <code class="classname">AbstractController</code></b></p><div class="table-contents"><table summary="Features offered by the AbstractController" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="left"><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Parameter</th><th style="border-bottom: 1.0pt solid ; ">Explanation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">requireSession</code></td><td style="border-bottom: 1.0pt solid ; ">Indicates whether or not this
              <code class="interfacename">Controller</code> requires a
              session to do its work. This feature is offered to
              all controllers. If a session is not present when
              such a controller receives a request, the user is
              informed using a
              <code class="classname">SessionRequiredException</code>.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">synchronizeSession</code></td><td style="border-bottom: 1.0pt solid ; ">Use this if you want handling by this
              controller to be synchronized on the user's session.
              To be more specific, the extending controller will
              override the <code class="methodname">handleRenderRequestInternal(..)</code> and
              <code class="methodname">handleActionRequestInternal(..)</code> methods, which will be
              synchronized on the user&#8217;s session if you specify
              this variable.</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">renderWhenMinimized</code></td><td style="border-bottom: 1.0pt solid ; ">If you want your controller to actually
              render the view when the portlet is in a minimized
              state, set this to true. By default, this is set to
              false so that portlets that are in a minimized state
              don&#8217;t display any content.</td></tr><tr><td style="border-right: 1.0pt solid ; " align="left"><code class="literal">cacheSeconds</code></td><td style="">When you want a controller to override the
              default cache expiration defined for the portlet,
              specify a positive integer here. By default it is
              set to <code class="literal">-1</code>, which does not change
              the default caching. Setting it to <code class="literal">0</code>
              will ensure the result is never cached.</td></tr></tbody></table></div></div><br class="table-break"><p>The <code class="literal">requireSession</code> and
      <code class="literal">cacheSeconds</code> properties are declared on the
      <code class="classname">PortletContentGenerator</code> class, which is the
      superclass of <code class="classname">AbstractController</code>) but are
      included here for completeness.</p><p>When using the <code class="classname">AbstractController</code> as a
      baseclass for your controllers (which is not recommended since there
      are a lot of other controllers that might already do the job for
      you) you only have to override either the
      <code class="methodname">handleActionRequestInternal(ActionRequest,
      ActionResponse)</code> method or the
      <code class="methodname">handleRenderRequestInternal(RenderRequest,
      RenderResponse)</code> method (or both), implement your logic,
      and return a <code class="classname">ModelAndView</code> object (in the case
      of <code class="literal">handleRenderRequestInternal</code>).</p><p>The default implementations of both
      <code class="methodname">handleActionRequestInternal(..)</code> and
      <code class="methodname">handleRenderRequestInternal(..)</code> throw a
      <code class="classname">PortletException</code>. This is consistent with
      the behavior of <code class="classname">GenericPortlet</code> from the JSR-
      168 Specification API. So you only need to override the method that
      your controller is intended to handle.</p><p>Here is short example consisting of a class and a declaration
      in the web application context.</p><pre class="programlisting"><span class="hl-keyword">package</span> samples;

<span class="hl-keyword">import</span> javax.portlet.RenderRequest;
<span class="hl-keyword">import</span> javax.portlet.RenderResponse;

<span class="hl-keyword">import</span> org.springframework.web.portlet.mvc.AbstractController;
<span class="hl-keyword">import</span> org.springframework.web.portlet.ModelAndView;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SampleController <span class="hl-keyword">extends</span> AbstractController {

    <span class="hl-keyword">public</span> ModelAndView handleRenderRequestInternal(RenderRequest request, RenderResponse response) {
        ModelAndView mav = <span class="hl-keyword">new</span> ModelAndView(<span class="hl-string">"foo"</span>);
        mav.addObject(<span class="hl-string">"message"</span>, <span class="hl-string">"Hello World!"</span>);
        <span class="hl-keyword">return</span> mav;
    }
}

&lt;bean id=<span class="hl-string">"sampleController"</span> <span class="hl-keyword">class</span>=<span class="hl-string">"samples.SampleController"</span>&gt;
    &lt;property name=<span class="hl-string">"cacheSeconds"</span> value=<span class="hl-string">"120"</span>/&gt;
&lt;/bean&gt;</pre><p>The class above and the declaration in the web application
      context is all you need besides setting up a handler mapping (see
      <a class="xref" href="#portlet-handlermapping" title="19.5&nbsp;Handler mappings">Section&nbsp;19.5, &#8220;Handler mappings&#8221;</a>) to get this very simple
      controller working.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-controller-simple"></a>19.4.2&nbsp;Other simple controllers</h3></div></div></div><p>Although you can extend <code class="classname">AbstractController</code>,
      Spring Portlet MVC provides a number of concrete implementations which offer
      functionality that is commonly used in simple MVC applications.</p><p>The <code class="classname">ParameterizableViewController</code> is
      basically the same as the example above, except for the fact that
      you can specify the view name that it will return in the web
      application context (no need to hard-code the view name).</p><p>The <code class="classname">PortletModeNameViewController</code> uses
      the current mode of the portlet as the view name. So, if your
      portlet is in View mode (i.e. <code class="literal">PortletMode.VIEW</code>)
      then it uses "view" as the view name.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-controller-command"></a>19.4.3&nbsp;Command Controllers</h3></div></div></div><p>Spring Portlet MVC has the exact same hierarchy of
      <span class="emphasis"><em>command controllers</em></span> as Spring Web MVC. They
      provide a way to interact with data objects and dynamically bind
      parameters from the <code class="interfacename">PortletRequest</code> to
      the data object specified. Your data objects don't have to
      implement a framework-specific interface, so you can directly
      manipulate your persistent objects if you desire. Let's examine what
      command controllers are available, to get an overview of what you can do
      with them:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">AbstractCommandController</code>
        - a command controller you can use to create your own command
        controller, capable of binding request parameters to a data
        object you specify. This class does not offer form
        functionality, it does however offer validation features and
        lets you specify in the controller itself what to do with the
        command object that has been filled with the parameters from the
        request.</p></li><li><p><code class="classname">AbstractFormController</code> -
        an abstract controller offering form submission support. Using
        this controller you can model forms and populate them using a
        command object you retrieve in the controller. After a user has
        filled the form, <code class="classname">AbstractFormController</code>
        binds the fields, validates, and hands the object back to the
        controller to take appropriate action. Supported features are:
        invalid form submission (resubmission), validation, and normal
        form workflow. You implement methods to determine which views
        are used for form presentation and success. Use this controller
        if you need forms, but don't want to specify what views you're
        going to show the user in the application
        context.</p></li><li><p><code class="classname">SimpleFormController</code> - a
        concrete <code class="classname">AbstractFormController</code> that
        provides even more support when creating a form with a
        corresponding command object. The
        <code class="classname">SimpleFormController</code> lets you specify a
        command object, a viewname for the form, a viewname for the page you
        want to show the user when form submission has succeeded, and
        more.</p></li><li><p><code class="classname">AbstractWizardFormController</code> &#8211;
        a concrete <code class="classname">AbstractFormController</code> that
        provides a wizard-style interface for editing the contents of a
        command object across multiple display pages. Supports multiple
        user actions: finish, cancel, or page change, all of which are
        easily specified in request parameters from the
        view.</p></li></ul></div><p>These command controllers are quite powerful, but they do
      require a detailed understanding of how they operate in order to use
      them efficiently. Carefully review the Javadocs for this entire
      hierarchy and then look at some sample implementations before you
      start using them.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-controller-wrapping"></a>19.4.4&nbsp;<code class="classname">PortletWrappingController</code></h3></div></div></div><p>Instead of developing new controllers, it is possible to use
      existing portlets and map requests to them from a
      <code class="classname">DispatcherPortlet</code>. Using the
      <code class="classname">PortletWrappingController</code>, you can
      instantiate an existing <code class="interfacename">Portlet</code> as a
      <code class="interfacename">Controller</code> as follows:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myPortlet"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.portlet.mvc.PortletWrappingController"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"portletClass"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"sample.MyPortlet"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"portletName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"my-portlet"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"initParameters"</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;config=/WEB-INF/my-portlet-config.xml&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>This can be very valuable since you can then use interceptors
      to pre-process and post-process requests going to these portlets.
      Since JSR-168 does not support any kind of filter mechanism, this is
      quite handy. For example, this can be used to wrap the Hibernate
      <code class="classname">OpenSessionInViewInterceptor</code> around a MyFaces
      JSF Portlet.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-handlermapping"></a>19.5&nbsp;Handler mappings</h2></div></div></div><p>Using a handler mapping you can map incoming portlet requests to
    appropriate handlers. There are some handler mappings you can use out
    of the box, for example, the
    <code class="classname">PortletModeHandlerMapping</code>, but let's first
    examine the general concept of a
    <code class="interfacename">HandlerMapping</code>.</p><p>Note: We are intentionally using the term &#8220;Handler&#8221; here instead
    of &#8220;Controller&#8221;. <code class="classname">DispatcherPortlet</code> is designed
    to be used with other ways to process requests than just Spring Portlet
    MVC&#8217;s own Controllers. A Handler is any Object that can handle portlet
    requests. Controllers are an example of Handlers, and they are of
    course the default. To use some other framework with
    <code class="classname">DispatcherPortlet</code>, a corresponding implementation
    of <code class="interfacename">HandlerAdapter</code> is all that is needed.</p><p>The functionality a basic
    <code class="interfacename">HandlerMapping</code> provides is the delivering
    of a <code class="classname">HandlerExecutionChain</code>, which must contain
    the handler that matches the incoming request, and may also contain a
    list of handler interceptors that are applied to the request. When a
    request comes in, the <code class="classname">DispatcherPortlet</code> will hand
    it over to the handler mapping to let it inspect the request and come up
    with an appropriate <code class="classname">HandlerExecutionChain</code>. Then
    the <code class="classname">DispatcherPortlet</code> will execute the handler
    and interceptors in the chain (if any). These concepts are all exactly
    the same as in Spring Web MVC.</p><p>The concept of configurable handler mappings that can optionally
    contain interceptors (executed before or after the actual handler was
    executed, or both) is extremely powerful. A lot of supporting
    functionality can be built into a custom
    <code class="interfacename">HandlerMapping</code>. Think of a custom handler
    mapping that chooses a handler not only based on the portlet mode of the
    request coming in, but also on a specific state of the session
    associated with the request.</p><p>In Spring Web MVC, handler mappings are commonly based on URLs.
    Since there is really no such thing as a URL within a Portlet, we must
    use other mechanisms to control mappings. The two most common are the
    portlet mode and a request parameter, but anything available to the
    portlet request can be used in a custom handler mapping.</p><p>The rest of this section describes three of Spring Portlet MVC's
    most commonly used handler mappings. They all extend
    <code class="classname">AbstractHandlerMapping</code> and share the following
    properties:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">interceptors</code>: The list of
      interceptors to use.
      <code class="interfacename">HandlerInterceptor</code>s are discussed in
      <a class="xref" href="#portlet-handlermapping-interceptor" title="19.5.4&nbsp;Adding HandlerInterceptors">Section&nbsp;19.5.4, &#8220;Adding HandlerInterceptors&#8221;</a>.</p></li><li><p><code class="literal">defaultHandler</code>: The default
      handler to use, when this handler mapping does not result in a
      matching handler.</p></li><li><p><code class="literal">order</code>: Based on the value of the
      order property (see the
      <code class="interfacename">org.springframework.core.Ordered</code>
      interface), Spring will sort all handler mappings available in the
      context and apply the first matching handler.</p></li><li><p><code class="literal">lazyInitHandlers</code>: Allows for lazy
      initialization of singleton handlers (prototype handlers are always
      lazily initialized). Default value is false. This property is
      directly implemented in the three concrete
      Handlers.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-handlermapping-portletmode"></a>19.5.1&nbsp;<code class="classname">PortletModeHandlerMapping</code></h3></div></div></div><p>This is a simple handler mapping that maps incoming requests
      based on the current mode of the portlet (e.g. &#8216;view&#8217;, &#8216;edit&#8217;,
      &#8216;help&#8217;). An example:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.portlet.handler.PortletModeHandlerMapping"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"portletModeMap"</span>&gt;
        &lt;<span class="hl-tag">map</span>&gt;
            &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"view"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"viewHandler"</span>/&gt;
            &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"edit"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"editHandler"</span>/&gt;
            &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"help"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"helpHandler"</span>/&gt;
        &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-handlermapping-parameter"></a>19.5.2&nbsp;<code class="classname">ParameterHandlerMapping</code></h3></div></div></div><p>If we need to navigate around to multiple controllers without
      changing portlet mode, the simplest way to do this is with a request
      parameter that is used as the key to control the mapping.</p><p><code class="classname">ParameterHandlerMapping</code> uses the value
      of a specific request parameter to control the mapping. The default
      name of the parameter is <code class="literal">'action'</code>, but can be changed
      using the <code class="literal">'parameterName'</code> property.</p><p>The bean configuration for this mapping will look something
      like this:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.portlet.handler.ParameterHandlerMapping&#8221;&gt;
    &lt;property name="</span><span class="hl-attribute">parameterMap"&gt;</span>
        <span class="hl-attribute">&lt;map&gt;</span>
            <span class="hl-attribute">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"add"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"addItemHandler"</span>/&gt;
            &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"edit"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"editItemHandler"</span>/&gt;
            &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"delete"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"deleteItemHandler"</span>/&gt;
        &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-handlermapping-portletmodeparameter"></a>19.5.3&nbsp;<code class="classname">PortletModeParameterHandlerMapping</code></h3></div></div></div><p>The most powerful built-in handler mapping,
      <code class="classname">PortletModeParameterHandlerMapping</code> combines
      the capabilities of the two previous ones to allow different
      navigation within each portlet mode.</p><p>Again the default name of the parameter is "action", but can
      be changed using the <code class="literal">parameterName</code>
      property.</p><p>By default, the same parameter value may not be used in two
      different portlet modes. This is so that if the portal itself
      changes the portlet mode, the request will no longer be valid in the
      mapping. This behavior can be changed by setting the
      <code class="literal">allowDupParameters</code> property to true. However,
      this is not recommended.</p><p>The bean configuration for this mapping will look something
      like this:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.portlet.handler.PortletModeParameterHandlerMapping"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"portletModeParameterMap"</span>&gt;
        &lt;<span class="hl-tag">map</span>&gt;
            &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"view"</span>&gt; &lt;<span class="hl-comment">!-- 'view' portlet mode --</span>&gt;
                &lt;<span class="hl-tag">map</span>&gt;
                    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"add"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"addItemHandler"</span>/&gt;
                    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"edit"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"editItemHandler"</span>/&gt;
                    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"delete"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"deleteItemHandler"</span>/&gt;
                &lt;<span class="hl-tag">/map</span>&gt;
            &lt;<span class="hl-tag">/entry</span>&gt;
            &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"edit"</span>&gt; &lt;<span class="hl-comment">!-- 'edit' portlet mode --</span>&gt;
                &lt;<span class="hl-tag">map</span>&gt;
                    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"prefs"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"prefsHandler"</span>/&gt;
                    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"resetPrefs"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"resetPrefsHandler"</span>/&gt;
                &lt;<span class="hl-tag">/map</span>&gt;
            &lt;<span class="hl-tag">/entry</span>&gt;
        &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>This mapping can be chained ahead of a
      <code class="classname">PortletModeHandlerMapping</code>, which can then provide
      defaults for each mode and an overall default as well.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-handlermapping-interceptor"></a>19.5.4&nbsp;Adding <code class="interfacename">HandlerInterceptor</code>s</h3></div></div></div><p>Spring's handler mapping mechanism has a notion of handler
      interceptors, which can be extremely useful when you want to apply
      specific functionality to certain requests, for example, checking
      for a principal. Again Spring Portlet MVC implements these concepts
      in the same way as Web MVC.</p><p>Interceptors located in the handler mapping must implement
      <code class="interfacename">HandlerInterceptor</code> from the
      <code class="literal">org.springframework.web.portlet</code> package. Just
      like the servlet version, this interface defines three methods: one
      that will be called before the actual handler will be executed
      (<code class="literal">preHandle</code>), one that will be called after the
      handler is executed (<code class="literal">postHandle</code>), and one that is
      called after the complete request has finished
      (<code class="literal">afterCompletion</code>). These three methods should
      provide enough flexibility to do all kinds of pre- and post-
      processing.</p><p>The <code class="literal">preHandle</code> method returns a boolean
      value. You can use this method to break or continue the processing
      of the execution chain. When this method returns
      <code class="literal">true</code>, the handler execution chain will continue.
      When it returns <code class="literal">false</code>, the
      <code class="classname">DispatcherPortlet</code> assumes the interceptor
      itself has taken care of requests (and, for example, rendered an
      appropriate view) and does not continue executing the other
      interceptors and the actual handler in the execution chain.</p><p>The <code class="literal">postHandle</code> method is only called on a
      <code class="interfacename">RenderRequest</code>. The
      <code class="literal">preHandle</code> and <code class="literal">afterCompletion</code>
      methods are called on both an
      <code class="interfacename">ActionRequest</code> and a
      <code class="interfacename">RenderRequest</code>. If you need to
      execute logic in these methods for just one type of request, be sure
      to check what kind of request it is before processing it.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-handlermapping-interceptoradapter"></a>19.5.5&nbsp;<code class="classname">HandlerInterceptorAdapter</code></h3></div></div></div><p>As with the servlet package, the portlet package has a
      concrete implementation of
      <code class="interfacename">HandlerInterceptor</code> called
      <code class="classname">HandlerInterceptorAdapter</code>. This class has
      empty versions of all the methods so that you can inherit from this
      class and implement just one or two methods when that is all you
      need.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-handlermapping-parameterinterceptor"></a>19.5.6&nbsp;<code class="classname">ParameterMappingInterceptor</code></h3></div></div></div><p>The portlet package also has a concrete interceptor named
      <code class="classname">ParameterMappingInterceptor</code> that is meant to
      be used directly with <code class="classname">ParameterHandlerMapping</code>
      and <code class="classname">PortletModeParameterHandlerMapping</code>. This
      interceptor will cause the parameter that is being used to control
      the mapping to be forwarded from an
      <code class="interfacename">ActionRequest</code> to the subsequent
      <code class="interfacename">RenderRequest</code>. This will help ensure
      that the <code class="interfacename">RenderRequest</code> is mapped to
      the same Handler as the
      <code class="interfacename">ActionRequest</code>. This is done in the
      <code class="literal">preHandle</code> method of the interceptor, so you can
      still modify the parameter value in your handler to change where the
      <code class="interfacename">RenderRequest</code> will be mapped.</p><p>Be aware that this interceptor is calling
      <code class="literal">setRenderParameter</code> on the
      <code class="interfacename">ActionResponse</code>, which means that you
      cannot call <code class="literal">sendRedirect</code> in your handler when
      using this interceptor. If you need to do external redirects then
      you will either need to forward the mapping parameter manually or
      write a different interceptor to handle this for you.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-viewresolver"></a>19.6&nbsp;Views and resolving them</h2></div></div></div><p>As mentioned previously, Spring Portlet MVC directly reuses all
    the view technologies from Spring Web MVC. This includes not only the
    various <code class="interfacename">View</code> implementations themselves,
    but also the <code class="interfacename">ViewResolver</code> implementations.
    For more information, refer to <a class="xref" href="#view" title="17.&nbsp;View technologies">Chapter&nbsp;17, <i>View technologies</i></a> and
    <a class="xref" href="#mvc-viewresolver" title="16.5&nbsp;Resolving views">Section&nbsp;16.5, &#8220;Resolving views&#8221;</a> respectively.</p><p>A few items on using the existing <code class="interfacename">View</code> and
    <code class="interfacename">ViewResolver</code> implementations  are worth mentioning:</p><div class="itemizedlist"><ul type="disc"><li><p>Most portals expect the result of rendering a
      portlet to be an HTML fragment. So, things like JSP/JSTL, Velocity,
      FreeMarker, and XSLT all make sense. But it is unlikely that views
      that return other document types will make any sense in a portlet
      context.</p></li><li><p>There is no such thing as an HTTP redirect from
      within a portlet (the <code class="literal">sendRedirect(..)</code> method of
      <code class="interfacename">ActionResponse</code> cannot
      be used to stay within the portal). So, <code class="classname">RedirectView</code>
      and use of the <code class="literal">'redirect:'</code> prefix will
      <span class="bold"><strong>not</strong></span> work correctly from within Portlet MVC.</p></li><li><p>It may be possible to use the <code class="literal">'forward:'</code> prefix from
      within Portlet MVC. However, remember that since you are in a
      portlet, you have no idea what the current URL looks like. This
      means you cannot use a relative URL to access other resources in
      your web application and that you will have to use an absolute
      URL.</p></li></ul></div><p>Also, for JSP development, the new Spring Taglib and the new
    Spring Form Taglib both work in portlet views in exactly the same way
    that they work in servlet views.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-multipart"></a>19.7&nbsp;Multipart (file upload) support</h2></div></div></div><p>Spring Portlet MVC has built-in multipart support to handle file
    uploads in portlet applications, just like Web MVC does. The design for
    the multipart support is done with pluggable
    <code class="interfacename">PortletMultipartResolver</code> objects, defined
    in the <code class="literal">org.springframework.web.portlet.multipart</code>
    package. Spring provides a <code class="interfacename">PortletMultipartResolver</code>
    for use with
    <a class="ulink" href="http://jakarta.apache.org/commons/fileupload" target="_top">Commons FileUpload</a>.
    How uploading files is supported will be described in the rest of this section.</p><p>By default, no multipart handling will be done by Spring Portlet
    MVC, as some developers will want to handle multiparts themselves. You
    will have to enable it yourself by adding a multipart resolver to the
    web application's context. After you have done that,
    <code class="classname">DispatcherPortlet</code> will inspect each request to
    see if it contains a multipart. If no multipart is found, the request
    will continue as expected. However, if a multipart is found in the
    request, the <code class="interfacename">PortletMultipartResolver</code>
    that has been declared in your context will be used. After that, the
    multipart attribute in your request will be treated like any other
    attribute.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Any configured <code class="interfacename">PortletMultipartResolver</code>
      bean <span class="emphasis"><em>must</em></span> have the following id (or name):
      "<code class="literal">portletMultipartResolver</code>". If you have defined your
      <code class="interfacename">PortletMultipartResolver</code> with any other name,
      then the <code class="classname">DispatcherPortlet</code> will <span class="emphasis"><em>not</em></span>
      find your <code class="interfacename">PortletMultipartResolver</code>, and
      consequently no multipart support will be in effect.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-multipart-resolver"></a>19.7.1&nbsp;Using the <code class="interfacename">PortletMultipartResolver</code></h3></div></div></div><p>The following example shows how to use the
      <code class="classname">CommonsPortletMultipartResolver</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"portletMultipartResolver"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.portlet.multipart.CommonsPortletMultipartResolver"</span>&gt;

    &lt;<span class="hl-comment">!-- one of the properties available; the maximum file size in bytes --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"maxUploadSize"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100000"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Of course you also need to put the appropriate jars in your
      classpath for the multipart resolver to work. In the case of the
      <code class="classname">CommonsMultipartResolver</code>, you need to use
      <code class="literal">commons-fileupload.jar</code>. Be sure to use at least
      version 1.1 of Commons FileUpload as previous versions do not
      support JSR-168 Portlet applications.</p><p>Now that you have seen how to set Portlet MVC up to handle
      multipart requests, let's talk about how to actually use it. When
      <code class="classname">DispatcherPortlet</code> detects a multipart
      request, it activates the resolver that has been declared in your
      context and hands over the request. What the resolver then does is
      wrap the current <code class="interfacename">ActionRequest</code> in a
      <code class="interfacename">MultipartActionRequest</code> that has
      support for multipart file uploads. Using the
      <code class="interfacename">MultipartActionRequest</code> you can get
      information about the multiparts contained by this request and
      actually get access to the multipart files themselves in your
      controllers.</p><p>Note that you can only receive multipart file uploads as part
      of an <code class="interfacename">ActionRequest</code>, not as part of a
      <code class="interfacename">RenderRequest</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-multipart-forms"></a>19.7.2&nbsp;Handling a file upload in a form</h3></div></div></div><p>After the
      <code class="interfacename">PortletMultipartResolver</code> has finished
      doing its job, the request will be processed like any other. To use
      the <code class="interfacename">PortletMultipartResolver</code>, create
      a form with an upload field (see example below),
      then let Spring bind the file onto your form (backing object). To
      actually let the user upload a file, we have to create a (JSP/HTML)
      form:</p><pre class="programlisting">&lt;<span class="hl-tag">h1</span>&gt;Please upload a file&lt;<span class="hl-tag">/h1</span>&gt;
&lt;<span class="hl-tag">form</span> <span class="hl-attribute">method</span>=<span class="hl-value">"post"</span> <span class="hl-attribute">action</span>=<span class="hl-value">"&lt;portlet:actionURL/&gt;"</span> <span class="hl-attribute">enctype</span>=<span class="hl-value">"multipart/form-data"</span>&gt;
    &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"file"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"file"</span>/&gt;
    &lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span>/&gt;
&lt;<span class="hl-tag">/form</span>&gt;</pre><p>As you can see, we've created a field named &#8220;file&#8221; that matches the
      property of the bean that holds the <code class="literal">byte[]</code> array.
      Furthermore we've added the encoding attribute
      (<code class="literal">enctype="multipart/form-data"</code>), which is
      necessary to let the browser know how to encode the multipart fields
      (do not forget this!).</p><p>Just as with any other property that's not automagically
      convertible to a string or primitive type, to be able to put binary
      data in your objects you have to register a custom editor with the
      <code class="classname">PortletRequestDataBinder</code>. There are a couple
      of editors available for handling files and setting the results on
      an object. There's a
      <code class="classname">StringMultipartFileEditor</code> capable of
      converting files to Strings (using a user-defined character set), and
      there is a <code class="classname">ByteArrayMultipartFileEditor</code> which
      converts files to byte arrays. They function analogous to the
      <code class="classname">CustomDateEditor</code>.</p><p>So, to be able to upload files using a form, declare the
      resolver, a mapping to a controller that will process the bean, and
      the controller itself.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"portletMultipartResolver"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.portlet.multipart.CommonsPortletMultipartResolver"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.portlet.handler.PortletModeHandlerMapping"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"portletModeMap"</span>&gt;
        &lt;<span class="hl-tag">map</span>&gt;
            &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"view"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"fileUploadController"</span>/&gt;
        &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fileUploadController"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.FileUploadController"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"commandClass"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"examples.FileUploadBean"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"formView"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"fileuploadform"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"successView"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"confirmation"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>After that, create the controller and the actual class to hold
      the file property.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadController <span class="hl-keyword">extends</span> SimpleFormController {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onSubmitAction(ActionRequest request, ActionResponse response,
            Object command, BindException errors) <span class="hl-keyword">throws</span> Exception {

        <span class="hl-comment">// cast the bean</span>
        FileUploadBean bean = (FileUploadBean) command;

        <span class="hl-comment">// let's see if there's content there</span>
        <span class="hl-keyword">byte</span>[] file = bean.getFile();
        <span class="hl-keyword">if</span> (file == null) {
            <span class="hl-comment">// hmm, that's strange, the user did not upload anything</span>
        }

        <span class="hl-comment">// do something with the file here</span>
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> initBinder(
            PortletRequest request, PortletRequestDataBinder binder) <span class="hl-keyword">throws</span> Exception {
        <span class="hl-comment">// to actually be able to convert Multipart instance to byte[]</span>
        <span class="hl-comment">// we have to register a custom editor</span>
        binder.registerCustomEditor(<span class="hl-keyword">byte</span>[].<span class="hl-keyword">class</span>, <span class="hl-keyword">new</span> ByteArrayMultipartFileEditor());
        <span class="hl-comment">// now Spring knows how to handle multipart object and convert</span>
    }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadBean {

    <span class="hl-keyword">private</span> <span class="hl-keyword">byte</span>[] file;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setFile(<span class="hl-keyword">byte</span>[] file) {
        <span class="hl-keyword">this</span>.file = file;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">byte</span>[] getFile() {
        <span class="hl-keyword">return</span> file;
    }
}</pre><p>As you can see, the <code class="classname">FileUploadBean</code> has
      a property of type <code class="literal">byte[]</code> that holds the file. The
      controller registers a custom editor to let Spring know how to
      actually convert the multipart objects the resolver has found to
      properties specified by the bean. In this example, nothing is done
      with the <code class="literal">byte[]</code> property of the bean itself, but
      in practice you can do whatever you want (save it in a database,
      mail it to somebody, etc).</p><p>An equivalent example in which a file is bound straight to a
      String-typed property on a form backing object might look like
      this:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadController <span class="hl-keyword">extends</span> SimpleFormController {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onSubmitAction(ActionRequest request, ActionResponse response,
            Object command, BindException errors) <span class="hl-keyword">throws</span> Exception {

        <span class="hl-comment">// cast the bean</span>
        FileUploadBean bean = (FileUploadBean) command;

        <span class="hl-comment">// let's see if there's content there</span>
        String file = bean.getFile();
        <span class="hl-keyword">if</span> (file == null) {
            <span class="hl-comment">// hmm, that's strange, the user did not upload anything</span>
        }

        <span class="hl-comment">// do something with the file here</span>
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> initBinder(
        PortletRequest request, PortletRequestDataBinder binder) <span class="hl-keyword">throws</span> Exception {

        <span class="hl-comment">// to actually be able to convert Multipart instance to a String</span>
        <span class="hl-comment">// we have to register a custom editor</span>
        binder.registerCustomEditor(String.<span class="hl-keyword">class</span>,
            <span class="hl-keyword">new</span> StringMultipartFileEditor());
        <span class="hl-comment">// now Spring knows how to handle multipart objects and convert</span>
    }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadBean {

    <span class="hl-keyword">private</span> String file;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setFile(String file) {
        <span class="hl-keyword">this</span>.file = file;
    }

    <span class="hl-keyword">public</span> String getFile() {
        <span class="hl-keyword">return</span> file;
    }
}</pre><p>Of course, this last example only makes (logical) sense in the
      context of uploading a plain text file (it wouldn't work so well in
      the case of uploading an image file).</p><p>The third (and final) option is where one binds directly to a
      <code class="interfacename">MultipartFile</code> property declared on
      the (form backing) object's class. In this case one does not need to
      register any custom property editor because there is no type
      conversion to be performed.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadController <span class="hl-keyword">extends</span> SimpleFormController {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onSubmitAction(ActionRequest request, ActionResponse response,
            Object command, BindException errors) <span class="hl-keyword">throws</span> Exception {

        <span class="hl-comment">// cast the bean</span>
        FileUploadBean bean = (FileUploadBean) command;

        <span class="hl-comment">// let's see if there's content there</span>
        MultipartFile file = bean.getFile();
        <span class="hl-keyword">if</span> (file == null) {
            <span class="hl-comment">// hmm, that's strange, the user did not upload anything</span>
        }

        <span class="hl-comment">// do something with the file here</span>
    }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadBean {

    <span class="hl-keyword">private</span> MultipartFile file;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setFile(MultipartFile file) {
        <span class="hl-keyword">this</span>.file = file;
    }

    <span class="hl-keyword">public</span> MultipartFile getFile() {
        <span class="hl-keyword">return</span> file;
    }
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-exceptionresolver"></a>19.8&nbsp;Handling exceptions</h2></div></div></div><p>Just like Servlet MVC, Portlet MVC provides
    <code class="interfacename">HandlerExceptionResolver</code>s to ease the
    pain of unexpected exceptions that occur while your request is being
    processed by a handler that matched the request. Portlet MVC also
    provides a portlet-specific, concrete
    <code class="classname">SimpleMappingExceptionResolver</code> that enables you
    to take the class name of any exception that might be thrown and map it
    to a view name.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-annotation"></a>19.9&nbsp;Annotation-based controller configuration</h2></div></div></div><p>Spring 2.5 introduced an annotation-based programming model for MVC
    controllers, using annotations such as
    <code class="interfacename">@RequestMapping</code>,
    <code class="interfacename">@RequestParam</code>,
    <code class="interfacename">@ModelAttribute</code>, etc. This annotation
    support is available for both Servlet MVC and Portlet MVC. Controllers
    implemented in this style do not have to extend specific base classes or
    implement specific interfaces. Furthermore, they do not usually have
    direct dependencies on Servlet or Portlet API's, although they can easily
    get access to Servlet or Portlet facilities if desired.</p><p>The following sections document these annotations and how they are
    most commonly used in a Portlet environment.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-ann-setup"></a>19.9.1&nbsp;Setting up the dispatcher for annotation support</h3></div></div></div><p><span class="emphasis"><em><code class="interfacename">@RequestMapping</code> will only be processed
      if a corresponding <code class="interfacename">HandlerMapping</code> (for type level annotations)
      and/or <code class="interfacename">HandlerAdapter</code> (for method level annotations) is
      present in the dispatcher.</em></span> This is the case by default in both
      <code class="classname">DispatcherServlet</code> and <code class="classname">DispatcherPortlet</code>.</p><p>However, if you are defining custom <code class="interfacename">HandlerMappings</code> or
      <code class="interfacename">HandlerAdapters</code>, then you need to make sure that a
      corresponding custom <code class="classname">DefaultAnnotationHandlerMapping</code>
      and/or <code class="classname">AnnotationMethodHandlerAdapter</code> is defined as well
      - provided that you intend to use <code class="interfacename">@RequestMapping</code>.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.portlet.mvc.annotation.DefaultAnnotationHandlerMapping"</span>/&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.portlet.mvc.annotation.AnnotationMethodHandlerAdapter"</span>/&gt;

    // ... (controller bean definitions) ...

&lt;<span class="hl-tag">/beans</span>&gt;
</pre><p>Defining a <code class="classname">DefaultAnnotationHandlerMapping</code>
      and/or <code class="classname">AnnotationMethodHandlerAdapter</code> explicitly
      also makes sense if you would like to customize the mapping strategy, e.g.
      specifying a custom <code class="interfacename">WebBindingInitializer</code> (see below).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-ann-controller"></a>19.9.2&nbsp;Defining a controller with
      <code class="interfacename">@Controller</code></h3></div></div></div><p>The <code class="interfacename">@Controller</code> annotation indicates
      that a particular class serves the role of a <span class="emphasis"><em>controller</em></span>.
      There is no need to extend any controller base class or reference the
      Portlet API. You are of course still able to reference Portlet-specific
      features if you need to.</p><p>The basic purpose of the <code class="interfacename">@Controller</code>
      annotation is to act as a stereotype for the annotated class, indicating
      its role. The dispatcher will scan such annotated classes for mapped
      methods, detecting <code class="interfacename">@RequestMapping</code>
      annotations (see the next section).</p><p>Annotated controller beans may be defined explicitly,
      using a standard Spring bean definition in the dispatcher's context.
      However, the <code class="interfacename">@Controller</code> stereotype also
      allows for autodetection, aligned with Spring 2.5's general support for
      detecting component classes in the classpath and auto-registering bean
      definitions for them.</p><p>To enable autodetection of such annotated controllers, you have to add
      component scanning to your configuration. This is easily achieved by using
      the <span class="emphasis"><em>spring-context</em></span> schema as shown in the following
      XML snippet:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">"http://www.springframework.org/schema/p"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.springframework.samples.petportal.portlet"</span>/&gt;

    // ...

&lt;<span class="hl-tag">/beans</span>&gt;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-ann-requestmapping"></a>19.9.3&nbsp;Mapping requests with
      <code class="interfacename">@RequestMapping</code></h3></div></div></div><p>The <code class="interfacename">@RequestMapping</code> annotation is used
      to map portlet modes like 'VIEW'/'EDIT' onto an entire class or a particular
      handler method. Typically the type-level annotation maps a specific mode
      (or mode plus parameter condition) onto a form controller, with additional
      method-level annotations 'narrowing' the primary mapping for specific
      portlet request parameters.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p><code class="interfacename">@RequestMapping</code> at the type
        level may be used for plain implementations of the
        <code class="interfacename">Controller</code> interface as well.
        In this case, the request processing code would follow the
        traditional <code class="literal">handle(Action|Render)Request</code> signature,
        while the controller's mapping would be expressed through an
        <code class="interfacename">@RequestMapping</code> annotation.
        This works for pre-built <code class="interfacename">Controller</code>
        base classes, such as <code class="classname">SimpleFormController</code>,
        too.</p><p>In the following discussion, we'll focus on controllers
        that are based on annotated handler methods.</p></td></tr></table></div><p>The following is an example of a form controller from the
      PetPortal sample application using this annotation:</p><pre class="programlisting">@Controller
@RequestMapping(<span class="hl-string">"EDIT"</span>)
@SessionAttributes(<span class="hl-string">"site"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PetSitesEditController {

    <span class="hl-keyword">private</span> Properties petSites;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setPetSites(Properties petSites) {
        <span class="hl-keyword">this</span>.petSites = petSites;
    }

    @ModelAttribute(<span class="hl-string">"petSites"</span>)
    <span class="hl-keyword">public</span> Properties getPetSites() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.petSites;
    }

    @RequestMapping  <span class="hl-comment">// default (action=list)</span>
    <span class="hl-keyword">public</span> String showPetSites() {
        <span class="hl-keyword">return</span> <span class="hl-string">"petSitesEdit"</span>;
    }

    @RequestMapping(params = <span class="hl-string">"action=add"</span>)  <span class="hl-comment">// render phase</span>
    <span class="hl-keyword">public</span> String showSiteForm(Model model) {
        <span class="hl-comment">// Used for the initial form as well as for redisplaying with errors.</span>
        <span class="hl-keyword">if</span> (!model.containsAttribute(<span class="hl-string">"site"</span>)) {
            model.addAttribute(<span class="hl-string">"site"</span>, <span class="hl-keyword">new</span> PetSite());
        }
        <span class="hl-keyword">return</span> <span class="hl-string">"petSitesAdd"</span>;
    }

    @RequestMapping(params = <span class="hl-string">"action=add"</span>)  <span class="hl-comment">// action phase</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> populateSite(
            @ModelAttribute(<span class="hl-string">"site"</span>) PetSite petSite, BindingResult result,
            SessionStatus status, ActionResponse response) {

        <span class="hl-keyword">new</span> PetSiteValidator().validate(petSite, result);
        <span class="hl-keyword">if</span> (!result.hasErrors()) {
            <span class="hl-keyword">this</span>.petSites.put(petSite.getName(), petSite.getUrl());
            status.setComplete();
            response.setRenderParameter(<span class="hl-string">"action"</span>, <span class="hl-string">"list"</span>);
        }
    }

    @RequestMapping(params = <span class="hl-string">"action=delete"</span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> removeSite(@RequestParam(<span class="hl-string">"site"</span>) String site, ActionResponse response) {
        <span class="hl-keyword">this</span>.petSites.remove(site);
        response.setRenderParameter(<span class="hl-string">"action"</span>, <span class="hl-string">"list"</span>);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-ann-requestmapping-arguments"></a>19.9.4&nbsp;Supported handler method arguments</h3></div></div></div><p>Handler methods which are annotated with
      <code class="classname">@RequestMapping</code> are allowed to have very flexible
      signatures. They may have arguments of the following types, in arbitrary
      order (except for validation results, which need to follow right after
      the corresponding command object, if desired):

      </p><div class="itemizedlist"><ul type="disc"><li><p>Request and/or response objects (Portlet API).
          You may choose any specific request/response type, e.g. PortletRequest /
          ActionRequest / RenderRequest. An explicitly declared action/render
          argument is also used for mapping specific request types onto a handler
          method (in case of no other information given that differentiates
          between action and render requests).</p></li><li><p>Session object (Portlet API): of type PortletSession. An argument
          of this type will enforce the presence of a corresponding session.
          As a consequence, such an argument will never be <code class="literal">null</code>.</p></li><li><p><code class="classname">org.springframework.web.context.request.WebRequest</code>
          or <code class="classname">org.springframework.web.context.request.NativeWebRequest</code>.
          Allows for generic request parameter access as well as request/session
          attribute access, without ties to the native Servlet/Portlet API.</p></li><li><p><code class="classname">java.util.Locale</code> for the current request
          locale (the portal locale in a Portlet environment).</p></li><li><p><code class="classname">java.io.InputStream</code> /
          <code class="classname">java.io.Reader</code> for access to the request's content.
          This will be the raw InputStream/Reader as exposed by the Portlet API.</p></li><li><p><code class="classname">java.io.OutputStream</code> /
          <code class="classname">java.io.Writer</code> for generating the response's content.
          This will be the raw OutputStream/Writer as exposed by the Portlet API.</p></li><li><p><code class="classname">@RequestParam</code> annotated parameters
          for access to specific Portlet request parameters. Parameter values
          will be converted to the declared method argument type.</p></li><li><p><code class="interfacename">java.util.Map</code> /
          <code class="interfacename">org.springframework.ui.Model</code> /
          <code class="classname">org.springframework.ui.ModelMap</code> for
          enriching the implicit model that will be exposed to the web view.</p></li><li><p>Command/form objects to bind parameters to: as bean
          properties or fields, with customizable type conversion, depending
          on <code class="classname">@InitBinder</code> methods and/or the
          HandlerAdapter configuration - see the
          "<code class="literal">webBindingInitializer</code>" property on
          <code class="classname">AnnotationMethodHandlerAdapter</code>. Such
          command objects along with their validation results will be
          exposed as model attributes, by default using the non-qualified
          command class name in property notation (e.g. "orderAddress" for
          type "mypackage.OrderAddress"). Specify a parameter-level
          <code class="classname">ModelAttribute</code> annotation for declaring a
          specific model attribute name.</p></li><li><p><code class="classname">org.springframework.validation.Errors</code> /
          <code class="classname">org.springframework.validation.BindingResult</code>
          validation results for a preceding command/form object (the
          immediate preceding argument).</p></li><li><p><code class="classname">org.springframework.web.bind.support.SessionStatus</code>
          status handle for marking form processing as complete (triggering
          the cleanup of session attributes that have been indicated by the
          <code class="classname">@SessionAttributes</code> annotation at the
          handler type level).</p></li></ul></div><p>The following return types are supported for handler methods:

      </p><div class="itemizedlist"><ul type="disc"><li><p>A <code class="classname">ModelAndView</code> object, with the model implicitly
          enriched with command objects and the results of <code class="literal">@ModelAttribute</code>
          annotated reference data accessor methods.</p></li><li><p>A <code class="interfacename">Model</code> object, with the view name implicitly
          determined through a <code class="interfacename">RequestToViewNameTranslator</code>
          and the model implicitly enriched with command objects and the results of
          <code class="literal">@ModelAttribute</code> annotated reference data accessor methods.</p></li><li><p>A <code class="interfacename">Map</code> object for exposing a model, with the view name
          implicitly determined through a <code class="interfacename">RequestToViewNameTranslator</code>
          and the model implicitly enriched with command objects and the results of
          <code class="literal">@ModelAttribute</code> annotated reference data accessor methods.</p></li><li><p>A <code class="interfacename">View</code> object, with the model implicitly
          determined through command objects and <code class="literal">@ModelAttribute</code>
          annotated reference data accessor methods. The handler method may also
          programmatically enrich the model by declaring a <code class="interfacename">Model</code>
          argument (see above).</p></li><li><p>A <code class="classname">String</code> value which is interpreted as view name,
          with the model implicitly determined through command objects and
          <code class="literal">@ModelAttribute</code> annotated reference data accessor methods.
          The handler method may also programmatically enrich the model by declaring a
          <code class="interfacename">Model</code> argument (see above).</p></li><li><p><code class="literal">void</code> if the method handles the response itself
          (e.g. by writing the response content directly).</p></li><li><p>Any other return type will be considered a single model attribute
          to be exposed to the view, using the attribute name specified through
          <code class="literal">@ModelAttribute</code> at the method level (or the default
          attribute name based on the return type's class name otherwise). The model
          will be implicitly enriched with command objects and the results of
          <code class="literal">@ModelAttribute</code> annotated reference data accessor methods.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-ann-requestparam"></a>19.9.5&nbsp;Binding request parameters to method parameters with
      <code class="classname">@RequestParam</code></h3></div></div></div><p>The <code class="classname">@RequestParam</code> annotation is used to
      bind request parameters to a method parameter in your controller.</p><p>The following code snippet from the PetPortal sample application
      shows the usage:</p><pre class="programlisting">@Controller
@RequestMapping(<span class="hl-string">"EDIT"</span>)
@SessionAttributes(<span class="hl-string">"site"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PetSitesEditController {

    <span class="hl-comment">// ...</span>

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> removeSite(@RequestParam(<span class="hl-string">"site"</span>) String site, ActionResponse response) {
        <span class="hl-keyword">this</span>.petSites.remove(site);
        response.setRenderParameter(<span class="hl-string">"action"</span>, <span class="hl-string">"list"</span>);
    }

    <span class="hl-comment">// ...</span>
}
</pre><p>Parameters using this annotation are required by default, but you
      can specify that a parameter is optional by setting
      <code class="interfacename">@RequestParam</code>'s
      <code class="literal">required</code> attribute to <code class="literal">false</code> (e.g.,
      <code class="literal">@RequestParam(value="id", required=false)</code>).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-ann-modelattrib"></a>19.9.6&nbsp;Providing a link to data from the model with
      <code class="classname">@ModelAttribute</code></h3></div></div></div><p><code class="classname">@ModelAttribute</code> has two usage scenarios in
      controllers. When placed on a method parameter,
      <code class="classname">@ModelAttribute</code> is used to map a model attribute
      to the specific, annotated method parameter (see the
      <code class="literal">populateSite()</code> method below). This is how the
      controller gets a reference to the object holding the data entered in
      the form. In addition, the parameter can be declared as the specific
      type of the form backing object rather than as a generic
      <code class="classname">java.lang.Object</code>, thus increasing type
      safety.</p><p><code class="classname">@ModelAttribute</code> is also used at the method
      level to provide <span class="emphasis"><em>reference data</em></span> for the model (see
      the <code class="literal">getPetSites()</code> method below). For this usage
      the method signature can contain the same types as documented above for
      the <code class="classname">@RequestMapping</code> annotation.</p><p><span class="emphasis"><em>Note:</em></span> <code class="classname">@ModelAttribute</code>
      annotated methods will be executed <span class="emphasis"><em>before</em></span> the
      chosen <code class="classname">@RequestMapping</code> annotated handler method.
      They effectively pre-populate the implicit model with specific attributes,
      often loaded from a database. Such an attribute can then already be
      accessed through <code class="classname">@ModelAttribute</code> annotated
      handler method parameters in the chosen handler method, potentially
      with binding and validation applied to it.</p><p>The following code snippet shows these two usages of this
      annotation:</p><pre class="programlisting">@Controller
@RequestMapping(<span class="hl-string">"EDIT"</span>)
@SessionAttributes(<span class="hl-string">"site"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PetSitesEditController {

    <span class="hl-comment">// ...</span>

    @ModelAttribute(<span class="hl-string">"petSites"</span>)
    <span class="hl-keyword">public</span> Properties getPetSites() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.petSites;
    }

    @RequestMapping(params = <span class="hl-string">"action=add"</span>)  <span class="hl-comment">// action phase</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> populateSite(
            @ModelAttribute(<span class="hl-string">"site"</span>) PetSite petSite, BindingResult result,
            SessionStatus status, ActionResponse response) {

        <span class="hl-keyword">new</span> PetSiteValidator().validate(petSite, result);
        <span class="hl-keyword">if</span> (!result.hasErrors()) {
            <span class="hl-keyword">this</span>.petSites.put(petSite.getName(), petSite.getUrl());
            status.setComplete();
            response.setRenderParameter(<span class="hl-string">"action"</span>, <span class="hl-string">"list"</span>);
        }
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-ann-sessionattrib"></a>19.9.7&nbsp;Specifying attributes to store in a Session with
      <code class="classname">@SessionAttributes</code></h3></div></div></div><p>The type-level <code class="classname">@SessionAttributes</code>
      annotation declares session attributes used by a specific handler.
      This will typically list the names of model attributes or types of
      model attributes which should be
      transparently stored in the session or some conversational storage,
      serving as form-backing beans between subsequent requests.</p><p>The following code snippet shows the usage of this
      annotation:</p><pre class="programlisting">@Controller
@RequestMapping(<span class="hl-string">"EDIT"</span>)
@SessionAttributes(<span class="hl-string">"site"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PetSitesEditController {
  <span class="hl-comment">// ...</span>
}
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-ann-webdatabinder"></a>19.9.8&nbsp;Customizing <code class="classname">WebDataBinder</code>
      initialization</h3></div></div></div><p>To customize request parameter binding with PropertyEditors, etc.
      via Spring's <code class="classname">WebDataBinder</code>, you can either use
      <code class="interfacename">@InitBinder</code>-annotated methods within your
      controller or externalize your configuration by providing a custom
      <code class="interfacename">WebBindingInitializer</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="portlet-ann-initbinder"></a>19.9.8.1&nbsp;Customizing data binding with
        <code class="interfacename">@InitBinder</code></h4></div></div></div><p>Annotating controller methods with
        <code class="interfacename">@InitBinder</code> allows you to configure web
        data binding directly within your controller class.
        <code class="interfacename">@InitBinder</code> identifies methods which
        initialize the <code class="classname">WebDataBinder</code> which will be used
        for populating command and form object arguments of annotated handler
        methods.</p><p>Such init-binder methods support all arguments that
        <code class="interfacename">@RequestMapping</code> supports, except for
        command/form objects and corresponding validation result objects.
        Init-binder methods must not have a return value. Thus, they are
        usually declared as <code class="literal">void</code>. Typical arguments include
        <code class="classname">WebDataBinder</code> in combination with
        <code class="interfacename">WebRequest</code> or
        <code class="classname">java.util.Locale</code>, allowing code to register
        context-specific editors.</p><p>The following example demonstrates the use of
        <code class="interfacename">@InitBinder</code> for configuring a
        <code class="classname">CustomDateEditor</code> for all
        <code class="classname">java.util.Date</code> form properties.</p><pre class="programlisting">@Controller
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyFormController {

    @InitBinder
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> initBinder(WebDataBinder binder) {
        SimpleDateFormat dateFormat = <span class="hl-keyword">new</span> SimpleDateFormat(<span class="hl-string">"yyyy-MM-dd"</span>);
        dateFormat.setLenient(false);
        binder.registerCustomEditor(Date.<span class="hl-keyword">class</span>, <span class="hl-keyword">new</span> CustomDateEditor(dateFormat, false));
    }

    <span class="hl-comment">// ...</span>
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="portlet-ann-webbindinginitializer"></a>19.9.8.2&nbsp;Configuring a custom
        <code class="interfacename">WebBindingInitializer</code></h4></div></div></div><p>To externalize data binding initialization, you can provide a
        custom implementation of the
        <code class="interfacename">WebBindingInitializer</code> interface, which
        you then enable by supplying a custom bean configuration for an
        <code class="classname">AnnotationMethodHandlerAdapter</code>, thus overriding
        the default configuration.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-deployment"></a>19.10&nbsp;Portlet application deployment</h2></div></div></div><p>The process of deploying a Spring Portlet MVC application is no
    different than deploying any JSR-168 Portlet application. However, this
    area is confusing enough in general that it is worth talking about here
    briefly.</p><p>Generally, the portal/portlet container runs in one webapp in your
    servlet container and your portlets run in another webapp in your
    servlet container. In order for the portlet container webapp to make
    calls into your portlet webapp it must make cross-context calls to a
    well-known servlet that provides access to the portlet services defined
    in your <code class="literal">portlet.xml</code> file.</p><p>The JSR-168 specification does not specify exactly how this should
    happen, so each portlet container has its own mechanism for this, which
    usually involves some kind of &#8220;deployment process&#8221; that makes changes to
    the portlet webapp itself and then registers the portlets within the
    portlet container.</p><p>At a minimum, the <code class="literal">web.xml</code> file in your portlet
    webapp is modified to inject the well-known servlet that the portlet
    container will call. In some cases a single servlet will service all
    portlets in the webapp, in other cases there will be an instance of the
    servlet for each portlet.</p><p>Some portlet containers will also inject libraries and/or
    configuration files into the webapp as well. The portlet container must
    also make its implementation of the Portlet JSP Tag Library available to
    your webapp.</p><p>The bottom line is that it is important to understand the
    deployment needs of your target portal and make sure they are met
    (usually by following the automated deployment process it provides).
    Be sure to carefully review the documentation from your portal for this
    process.</p><p>Once you have deployed your portlet, review the resulting
    <code class="literal">web.xml</code> file for sanity. Some older portals have
    been known to corrupt the definition of the
    <code class="classname">ViewRendererServlet</code>, thus breaking the rendering
    of your portlets.</p></div></div></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="spring-integration"></a>Part&nbsp;VI.&nbsp;Integration</h1></div></div></div><div class="partintro" lang="en"><div></div><p>This part of the reference documentation covers the Spring
      Framework's integration with a number of Java EE (and related)
      technologies.</p><div class="itemizedlist"><ul type="disc"><li><p><a class="xref" href="#remoting" title="20.&nbsp;Remoting and web services using Spring">Chapter&nbsp;20, <i>Remoting and web services using Spring</i></a></p></li><li><p><a class="xref" href="#ejb" title="21.&nbsp;Enterprise JavaBeans (EJB) integration">Chapter&nbsp;21, <i>Enterprise JavaBeans (EJB) integration</i></a></p></li><li><p><a class="xref" href="#jms" title="22.&nbsp;JMS (Java Message Service)">Chapter&nbsp;22, <i>JMS (Java Message Service)</i></a></p></li><li><p><a class="xref" href="#jmx" title="23.&nbsp;JMX">Chapter&nbsp;23, <i>JMX</i></a></p></li><li><p><a class="xref" href="#cci" title="24.&nbsp;JCA CCI">Chapter&nbsp;24, <i>JCA CCI</i></a></p></li><li><p><a class="xref" href="#mail" title="25.&nbsp;Email">Chapter&nbsp;25, <i>Email</i></a></p></li><li><p><a class="xref" href="#scheduling" title="26.&nbsp;Task Execution and Scheduling">Chapter&nbsp;26, <i>Task Execution and Scheduling</i></a></p></li><li><p><a class="xref" href="#dynamic-language" title="27.&nbsp;Dynamic language support">Chapter&nbsp;27, <i>Dynamic language support</i></a></p></li><li><p><a class="xref" href="#cache" title="28.&nbsp;Cache Abstraction">Chapter&nbsp;28, <i>Cache Abstraction</i></a></p></li></ul></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="remoting"></a>20.&nbsp;Remoting and web services using Spring</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-introduction"></a>20.1&nbsp;Introduction</h2></div></div></div><p>Spring features integration classes for remoting support using
    various technologies. The remoting support eases the development of
    remote-enabled services, implemented by your usual (Spring) POJOs.
    Currently, Spring supports the following remoting technologies: </p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>Remote Method Invocation (RMI)</em></span>. Through
          the use of the <code class="classname">RmiProxyFactoryBean</code> and the
          <code class="classname">RmiServiceExporter</code> Spring supports both
          traditional RMI (with <code class="interfacename">java.rmi.Remote</code>
          interfaces and
          <code class="exceptionname">java.rmi.RemoteException</code>) and
          transparent remoting via RMI invokers (with any Java
          interface).</p></li><li><p><span class="emphasis"><em>Spring's HTTP invoker</em></span>. Spring provides a
          special remoting strategy which allows for Java serialization via
          HTTP, supporting any Java interface (just like the RMI invoker). The
          corresponding support classes are
          <code class="classname">HttpInvokerProxyFactoryBean</code> and
          <code class="classname">HttpInvokerServiceExporter</code>.</p></li><li><p><span class="emphasis"><em>Hessian</em></span>. By using Spring's
          <code class="classname">HessianProxyFactoryBean</code> and the
          <code class="classname">HessianServiceExporter</code> you can transparently
          expose your services using the lightweight binary HTTP-based
          protocol provided by Caucho.</p></li><li><p><span class="emphasis"><em>Burlap</em></span>. Burlap is Caucho's XML-based
          alternative to Hessian. Spring provides support classes such as
          <code class="classname">BurlapProxyFactoryBean</code> and
          <code class="classname">BurlapServiceExporter</code>.</p></li><li><p><span class="emphasis"><em>JAX-RPC</em></span>. Spring provides remoting support
          for web services via JAX-RPC (J2EE 1.4's web service API).</p></li><li><p><span class="emphasis"><em>JAX-WS</em></span>. Spring provides remoting support
          for web services via JAX-WS (the successor of JAX-RPC, as introduced
          in Java EE 5 and Java 6).</p></li><li><p><span class="emphasis"><em>JMS</em></span>. Remoting using JMS as the underlying
          protocol is supported via the
          <code class="classname">JmsInvokerServiceExporter</code> and
          <code class="classname">JmsInvokerProxyFactoryBean</code> classes.</p></li></ul></div><p>While discussing the remoting capabilities of Spring, we'll use the
    following domain model and corresponding services:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Account <span class="hl-keyword">implements</span> Serializable{

    <span class="hl-keyword">private</span> String name;

    <span class="hl-keyword">public</span> String getName(){
        <span class="hl-keyword">return</span> name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
      <span class="hl-keyword">this</span>.name = name;
    }
}</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> AccountService {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account account);

    <span class="hl-keyword">public</span> List&lt;Account&gt; getAccounts(String name);
}</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> RemoteAccountService <span class="hl-keyword">extends</span> Remote {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account account) <span class="hl-keyword">throws</span> RemoteException;

    <span class="hl-keyword">public</span> List&lt;Account&gt; getAccounts(String name) <span class="hl-keyword">throws</span> RemoteException;
}</pre><pre class="programlisting"><span class="hl-comment">// the implementation doing nothing at the moment</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountServiceImpl <span class="hl-keyword">implements</span> AccountService {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account acc) {
        <span class="hl-comment">// do something...</span>
    }
  
    <span class="hl-keyword">public</span> List&lt;Account&gt; getAccounts(String name) {
        <span class="hl-comment">// do something...</span>
    }
}</pre><p>We will start exposing the service to a remote client by using RMI
    and talk a bit about the drawbacks of using RMI. We'll then continue to
    show an example using Hessian as the protocol.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-rmi"></a>20.2&nbsp;Exposing services using RMI</h2></div></div></div><p>Using Spring's support for RMI, you can transparently expose your
    services through the RMI infrastructure. After having this set up, you
    basically have a configuration similar to remote EJBs, except for the fact
    that there is no standard support for security context propagation or
    remote transaction propagation. Spring does provide hooks for such
    additional invocation context when using the RMI invoker, so you can for
    example plug in security frameworks or custom security credentials
    here.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-rmi-server"></a>20.2.1&nbsp;Exporting the service using the
      <code class="classname">RmiServiceExporter</code></h3></div></div></div><p>Using the <code class="classname">RmiServiceExporter</code>, we can expose
      the interface of our AccountService object as RMI object. The interface
      can be accessed by using <code class="classname">RmiProxyFactoryBean</code>, or
      via plain RMI in case of a traditional RMI service. The
      <code class="classname">RmiServiceExporter</code> explicitly supports the
      exposing of any non-RMI services via RMI invokers.</p><p>Of course, we first have to set up our service in the Spring
      container:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.AccountServiceImpl"</span>&gt;
    &lt;<span class="hl-comment">!-- any additional properties, maybe a DAO? --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Next we'll have to expose our service using the
      <code class="classname">RmiServiceExporter</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.rmi.RmiServiceExporter"</span>&gt;
    &lt;<span class="hl-comment">!-- does not necessarily have to be the same name as the bean to be exported --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AccountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"service"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.AccountService"</span>/&gt;
    &lt;<span class="hl-comment">!-- defaults to 1099 --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"registryPort"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1199"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>As you can see, we're overriding the port for the RMI registry.
      Often, your application server also maintains an RMI registry and it is
      wise to not interfere with that one. Furthermore, the service name is
      used to bind the service under. So right now, the service will be bound
      at <code class="literal">'rmi://HOST:1199/AccountService'</code>. We'll use the
      URL later on to link in the service at the client side.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">servicePort</code> property has been omitted (it
        defaults to 0). This means that an anonymous port will be used to
        communicate with the service.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-rmi-client"></a>20.2.2&nbsp;Linking in the service at the client</h3></div></div></div><p>Our client is a simple object using the
      <code class="interfacename">AccountService</code> to manage accounts:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleObject {

    <span class="hl-keyword">private</span> AccountService accountService;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAccountService(AccountService accountService) {
        <span class="hl-keyword">this</span>.accountService = accountService;
    }

    <span class="hl-comment">// additional methods using the accountService</span>

}</pre><p>To link in the service on the client, we'll create a separate
      Spring container, containing the simple object and the service linking
      configuration bits:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleObject"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.rmi.RmiProxyFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceUrl"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"rmi://HOST:1199/AccountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.AccountService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>That's all we need to do to support the remote account service on
      the client. Spring will transparently create an invoker and remotely
      enable the account service through the
      <code class="classname">RmiServiceExporter</code>. At the client we're linking
      it in using the <code class="classname">RmiProxyFactoryBean</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-caucho-protocols"></a>20.3&nbsp;Using Hessian or Burlap to remotely call services via HTTP</h2></div></div></div><p>Hessian offers a binary HTTP-based remoting protocol. It is
    developed by Caucho and more information about Hessian itself can be found
    at <a class="ulink" href="http://www.caucho.com" target="_top">http://www.caucho.com</a>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-caucho-protocols-hessian"></a>20.3.1&nbsp;Wiring up the <code class="classname">DispatcherServlet</code> for
      Hessian and co.</h3></div></div></div><p>Hessian communicates via HTTP and does so using a custom servlet.
      Using Spring's <code class="classname">DispatcherServlet</code> principles, as
      known from Spring Web MVC usage, you can easily wire up such a servlet
      exposing your services. First we'll have to create a new servlet in your
      application (this is an excerpt from
      <code class="filename">'web.xml'</code>):</p><pre class="programlisting">&lt;<span class="hl-tag">servlet</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;remoting&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">servlet-class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
    &lt;<span class="hl-tag">load-on-startup</span>&gt;1&lt;<span class="hl-tag">/load-on-startup</span>&gt;
&lt;<span class="hl-tag">/servlet</span>&gt;

&lt;<span class="hl-tag">servlet-mapping</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;remoting&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">url-pattern</span>&gt;/remoting/*&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/servlet-mapping</span>&gt;</pre><p>You're probably familiar with Spring's
      <code class="classname">DispatcherServlet</code> principles and if so, you know
      that now you'll have to create a Spring container configuration resource
      named <code class="filename">'remoting-servlet.xml'</code> (after the name of
      your servlet) in the <code class="filename">'WEB-INF'</code>
      directory. The application context will be used in the next
      section.</p><p>Alternatively, consider the use of Spring's simpler
      <code class="classname">HttpRequestHandlerServlet</code>. This allows you to
      embed the remote exporter definitions in your root application context
      (by default in <code class="filename">'WEB-INF/applicationContext.xml'</code>),
      with individual servlet definitions pointing to specific exporter beans.
      Each servlet name needs to match the bean name of its target exporter in
      this case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-caucho-protocols-hessian-server"></a>20.3.2&nbsp;Exposing your beans by using the
      <code class="classname">HessianServiceExporter</code></h3></div></div></div><p>In the newly created application context called
      <code class="literal">remoting-servlet.xml</code>, we'll create a
      <code class="classname">HessianServiceExporter</code> exporting your
      services:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.AccountServiceImpl"</span>&gt;
    &lt;<span class="hl-comment">!-- any additional properties, maybe a DAO? --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"/AccountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.caucho.HessianServiceExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"service"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.AccountService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Now we're ready to link in the service at the client. No explicit
      handler mapping is specified, mapping request URLs onto services, so
      <code class="classname">BeanNameUrlHandlerMapping</code> will be used: Hence,
      the service will be exported at the URL indicated through its bean name
      within the containing <code class="classname">DispatcherServlet</code>'s mapping
      (as defined above):
      <code class="literal">'http://HOST:8080/remoting/AccountService'</code>.</p><p>Alternatively, create a
      <code class="classname">HessianServiceExporter</code> in your root application
      context (e.g. in
      <code class="filename">'WEB-INF/applicationContext.xml'</code>):</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accountExporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.caucho.HessianServiceExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"service"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.AccountService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>In the latter case, define a corresponding servlet for this
      exporter in <code class="filename">'web.xml'</code>, with the same end result:
      The exporter getting mapped to the request path
      <code class="literal">/remoting/AccountService</code>. Note that the servlet name
      needs to match the bean name of the target exporter.</p><pre class="programlisting">&lt;<span class="hl-tag">servlet</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;accountExporter&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">servlet-class</span>&gt;org.springframework.web.context.support.HttpRequestHandlerServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
&lt;<span class="hl-tag">/servlet</span>&gt;

&lt;<span class="hl-tag">servlet-mapping</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;accountExporter&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">url-pattern</span>&gt;/remoting/AccountService&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/servlet-mapping</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-caucho-protocols-hessian-client"></a>20.3.3&nbsp;Linking in the service on the client</h3></div></div></div><p>Using the <code class="classname">HessianProxyFactoryBean</code> we can
      link in the service at the client. The same principles apply as with the
      RMI example. We'll create a separate bean factory or application context
      and mention the following beans where the
      <code class="classname">SimpleObject</code> is using the
      <code class="interfacename">AccountService</code> to manage accounts:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleObject"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.caucho.HessianProxyFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceUrl"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"http://remotehost:8080/remoting/AccountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.AccountService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-caucho-protocols-burlap"></a>20.3.4&nbsp;Using Burlap</h3></div></div></div><p>We won't discuss Burlap, the XML-based equivalent of Hessian, in
      detail here, since it is configured and set up in exactly the same way
      as the Hessian variant explained above. Just replace the word
      <code class="literal">Hessian</code> with <code class="literal">Burlap</code> and you're all
      set to go.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-caucho-protocols-security"></a>20.3.5&nbsp;Applying HTTP basic authentication to a service exposed through
      Hessian or Burlap</h3></div></div></div><p>One of the advantages of Hessian and Burlap is that we can easily
      apply HTTP basic authentication, because both protocols are HTTP-based.
      Your normal HTTP server security mechanism can easily be applied through
      using the <code class="literal">web.xml</code> security features, for example.
      Usually, you don't use per-user security credentials here, but rather
      shared credentials defined at the
      <code class="literal">Hessian/BurlapProxyFactoryBean</code> level (similar to a
      JDBC <code class="interfacename">DataSource</code>).</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptors"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"authorizationInterceptor"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"authorizationInterceptor"</span> 
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.handler.UserRoleAuthorizationInterceptor"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"authorizedRoles"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"administrator,operator"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>This is an example where we explicitly mention the
      <code class="classname">BeanNameUrlHandlerMapping</code> and set an interceptor
      allowing only administrators and operators to call the beans mentioned
      in this application context.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Of course, this example doesn't show a flexible kind of security
        infrastructure. For more options as far as security is concerned, have
        a look at the Spring Security project at <a class="ulink" href="http://static.springsource.org/spring-security/site/" target="_top">http://static.springsource.org/spring-security/site/</a>.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-httpinvoker"></a>20.4&nbsp;Exposing services using HTTP invokers</h2></div></div></div><p>As opposed to Burlap and Hessian, which are both lightweight
    protocols using their own slim serialization mechanisms, Spring HTTP
    invokers use the standard Java serialization mechanism to expose services
    through HTTP. This has a huge advantage if your arguments and return types
    are complex types that cannot be serialized using the serialization
    mechanisms Hessian and Burlap use (refer to the next section for more
    considerations when choosing a remoting technology).</p><p>Under the hood, Spring uses either the standard facilities provided
    by J2SE to perform HTTP calls or Commons
    <code class="classname">HttpClient</code>. Use the latter if you need more
    advanced and easy-to-use functionality. Refer to <a class="ulink" href="http://jakarta.apache.org/commons/httpclient" target="_top">jakarta.apache.org/commons/httpclient</a>
    for more info.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-httpinvoker-server"></a>20.4.1&nbsp;Exposing the service object</h3></div></div></div><p>Setting up the HTTP invoker infrastructure for a service object
      resembles closely the way you would do the same using Hessian or Burlap.
      Just as Hessian support provides the
      <code class="classname">HessianServiceExporter</code>, Spring's HttpInvoker
      support provides the
      <code class="classname">org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter</code>.</p><p>To expose the <code class="literal">AccountService</code> (mentioned above)
      within a Spring Web MVC <code class="classname">DispatcherServlet</code>, the
      following configuration needs to be in place in the dispatcher's
      application context:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"/AccountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"service"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.AccountService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
</pre><p>Such an exporter definition will be exposed through the
      <code class="classname">DispatcherServlet</code>'s standard mapping facilities,
      as explained in the section on Hessian.</p><p>Alternatively, create an
      <code class="classname">HttpInvokerServiceExporter</code> in your root
      application context (e.g. in
      <code class="filename">'WEB-INF/applicationContext.xml'</code>):</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accountExporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"service"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.AccountService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>In addition, define a corresponding servlet for this exporter in
      <code class="filename">'web.xml'</code>, with the servlet name matching the bean
      name of the target exporter:</p><pre class="programlisting">&lt;<span class="hl-tag">servlet</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;accountExporter&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">servlet-class</span>&gt;org.springframework.web.context.support.HttpRequestHandlerServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
&lt;<span class="hl-tag">/servlet</span>&gt;

&lt;<span class="hl-tag">servlet-mapping</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;accountExporter&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">url-pattern</span>&gt;/remoting/AccountService&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/servlet-mapping</span>&gt;</pre><p>If you are running outside of a servlet container and are using
      Sun's Java 6, then you can use the built-in HTTP server implementation.
      You can configure the <code class="classname">SimpleHttpServerFactoryBean</code> together with a
      <code class="classname">SimpleHttpInvokerServiceExporter</code> as is shown in this example:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accountExporter"</span> 
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.httpinvoker.SimpleHttpInvokerServiceExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"service"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.AccountService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"httpServer"</span> 
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.support.SimpleHttpServerFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"contexts"</span>&gt;
        &lt;<span class="hl-tag">util:map</span>&gt;
            &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"/remoting/AccountService"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"accountExporter"</span>/&gt;
        &lt;<span class="hl-tag">/util:map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"port"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"8080"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-httpinvoker-client"></a>20.4.2&nbsp;Linking in the service at the client</h3></div></div></div><p>Again, linking in the service from the client much resembles the
      way you would do it when using Hessian or Burlap. Using a proxy, Spring
      will be able to translate your calls to HTTP POST requests to the URL
      pointing to the exported service.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"httpInvokerProxy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.httpinvoker.HttpInvokerProxyFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceUrl"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"http://remotehost:8080/remoting/AccountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.AccountService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
</pre><p>As mentioned before, you can choose what HTTP client you want to
      use. By default, the <code class="classname">HttpInvokerProxy</code> uses the
      J2SE HTTP functionality, but you can also use the Commons
      <code class="classname">HttpClient</code> by setting the
      <code class="literal">httpInvokerRequestExecutor</code> property:</p><pre class="programlisting">&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"httpInvokerRequestExecutor"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.httpinvoker.CommonsHttpInvokerRequestExecutor"</span>/&gt;
&lt;<span class="hl-tag">/property</span>&gt;
</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-web-services"></a>20.5&nbsp;Web services</h2></div></div></div><p>Spring provides full support for standard Java web services
    APIs:</p><div class="itemizedlist"><ul type="disc"><li><p>Exposing web services using JAX-RPC</p></li><li><p>Accessing web services using JAX-RPC</p></li><li><p>Exposing web services using JAX-WS</p></li><li><p>Accessing web services using JAX-WS</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Why two standard Java web services APIs?</p><p>JAX-RPC 1.1 is the standard web service API in J2EE 1.4. As its
      name indicates, it focuses on on RPC bindings, which became less and
      less popular in the past couple of years. As a consequence, it has been
      superseded by JAX-WS 2.0 in Java EE 5, being more flexible in terms of
      bindings but also being heavily annotation-based. JAX-WS 2.1 is also
      included in Java 6 (or more specifically, in Sun's JDK 1.6.0_04 and
      above; previous Sun JDK 1.6.0 releases included JAX-WS 2.0), integrated
      with the JDK's built-in HTTP server.</p><p>Spring can work with both standard Java web services APIs. On Java
      EE 5 / Java 6, the obvious choice is JAX-WS. On J2EE 1.4 environments
      that run on Java 5, you might have the option to plug in a JAX-WS
      provider; check your Java EE server's documentation.</p></td></tr></table></div><p>In addition to stock support for JAX-RPC and JAX-WS in Spring Core,
    the Spring portfolio also features <a class="ulink" href="http://www.springframework.org/spring-ws" target="_top">Spring Web
    Services</a>, a solution for contract-first, document-driven web
    services - highly recommended for building modern, future-proof web
    services.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-web-services-jaxrpc-export"></a>20.5.1&nbsp;Exposing servlet-based web services using JAX-RPC</h3></div></div></div><p>Spring provides a convenience base class for JAX-RPC servlet
      endpoint implementations -
      <code class="classname">ServletEndpointSupport</code>. To expose our
      <code class="interfacename">AccountService</code> we extend Spring's
      <code class="classname">ServletEndpointSupport</code> class and implement our
      business logic here, usually delegating the call to the business
      layer.</p><pre class="programlisting"><span class="hl-comment">/**
 * JAX-RPC compliant RemoteAccountService implementation that simply delegates
 * to the AccountService implementation in the root web application context.
 *
 * This wrapper class is necessary because JAX-RPC requires working with dedicated
 * endpoint classes. If an existing service needs to be exported, a wrapper that
 * extends ServletEndpointSupport for simple application context access is
 * the simplest JAX-RPC compliant way.
 *
 * This is the class registered with the server-side JAX-RPC implementation.
 * In the case of Axis, this happens in "server-config.wsdd" respectively via
 * deployment calls. The web service engine manages the lifecycle of instances
 * of this class: A Spring application context can just be accessed here.
 */</span><span class="hl-keyword">import</span> org.springframework.remoting.jaxrpc.ServletEndpointSupport;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountServiceEndpoint <span class="hl-keyword">extends</span> ServletEndpointSupport <span class="hl-keyword">implements</span> RemoteAccountService {
    
    <span class="hl-keyword">private</span> AccountService biz;

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> onInit() {
        <span class="hl-keyword">this</span>.biz = (AccountService) getWebApplicationContext().getBean(<span class="hl-string">"accountService"</span>);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account acc) <span class="hl-keyword">throws</span> RemoteException {
        biz.insertAccount(acc);
    }
  
    <span class="hl-keyword">public</span> Account[] getAccounts(String name) <span class="hl-keyword">throws</span> RemoteException {
        <span class="hl-keyword">return</span> biz.getAccounts(name);
    }
}</pre><p>Our <code class="classname">AccountServletEndpoint</code> needs to run in
      the same web application as the Spring context to allow for access to
      Spring's facilities. In case of Axis, copy the
      <code class="classname">AxisServlet</code> definition into your
      <code class="filename">'web.xml'</code>, and set up the endpoint in
      <code class="filename">'server-config.wsdd'</code> (or use the deploy tool). See
      the sample application JPetStore where the
      <code class="interfacename">OrderService</code> is exposed as a web service
      using Axis.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-web-services-jaxrpc-access"></a>20.5.2&nbsp;Accessing web services using JAX-RPC</h3></div></div></div><p>Spring provides two factory beans to create JAX-RPC web service
      proxies, namely <code class="classname">LocalJaxRpcServiceFactoryBean</code> and
      <code class="classname">JaxRpcPortProxyFactoryBean</code>. The former can only
      return a JAX-RPC service class for us to work with. The latter is the
      full-fledged version that can return a proxy that implements our
      business service interface. In this example we use the latter to create
      a proxy for the <code class="interfacename">AccountService</code> endpoint
      we exposed in the previous section. You will see that Spring has great
      support for web services requiring little coding efforts - most of the
      setup is done in the Spring configuration file as usual:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountWebService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.jaxrpc.JaxRpcPortProxyFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.RemoteAccountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"wsdlDocumentUrl"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"http://localhost:8080/account/services/accountService?WSDL"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"namespaceUri"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"http://localhost:8080/account/services/accountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AccountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"portName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AccountPort"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Where <code class="literal">serviceInterface</code> is our remote business
      interface the clients will use. <code class="literal">wsdlDocumentUrl</code> is
      the URL for the WSDL file. Spring needs this at startup time to create
      the JAX-RPC Service. <code class="literal">namespaceUri</code> corresponds to the
      targetNamespace in the .wsdl file. <code class="literal">serviceName</code>
      corresponds to the service name in the .wsdl file.
      <code class="literal">portName</code> corresponds to the port name in the .wsdl
      file.</p><p>Accessing the web service is now very easy as we have a bean
      factory for it that will expose it as
      <code class="literal">RemoteAccountService</code> interface. We can wire this up
      in Spring:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"client"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.AccountClientImpl"</span>&gt;
    ...
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"service"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountWebService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>From the client code we can access the web service just as if it
      was a normal class, except that it throws
      <code class="exceptionname">RemoteException</code>.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountClientImpl {

    <span class="hl-keyword">private</span> RemoteAccountService service;
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setService(RemoteAccountService service) {
        <span class="hl-keyword">this</span>.service = service;
    }
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> foo() {
        <span class="hl-keyword">try</span> {
            service.insertAccount(...);
        }
        <span class="hl-keyword">catch</span> (RemoteException ex) {
            <span class="hl-comment">// ouch</span>
        }
    }
}
</pre><p>We can get rid of the checked
      <code class="exceptionname">RemoteException</code> since Spring supports
      automatic conversion to its corresponding unchecked
      <code class="exceptionname">RemoteException</code>. This requires that we
      provide a non-RMI interface also. Our configuration is now:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountWebService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.jaxrpc.JaxRpcPortProxyFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.AccountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"portInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.RemoteAccountService"</span>/&gt;
    ...
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Where <code class="literal">serviceInterface</code> is changed to our non
      RMI interface. Our RMI interface is now defined using the property
      <code class="literal">portInterface</code>. Our client code can now avoid handling
      <code class="exceptionname">java.rmi.RemoteException</code>:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountClientImpl {

    <span class="hl-keyword">private</span> AccountService service;
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setService(AccountService service) {
        <span class="hl-keyword">this</span>.service = service;
    }
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> foo() {
        service.insertAccount(...);
    }
}</pre><p>Note that you can also drop the "portInterface" part and specify a
      plain business interface as "serviceInterface". In this case,
      <code class="classname">JaxRpcPortProxyFactoryBean</code> will automatically
      switch to the JAX-RPC "Dynamic Invocation Interface", performing dynamic
      invocations without a fixed port stub. The advantage is that you don't
      even need to have an RMI-compliant Java port interface around (e.g. in
      case of a non-Java target web service); all you need is a matching
      business interface. Check out
      <code class="classname">JaxRpcPortProxyFactoryBean</code>'s javadoc for details
      on the runtime implications.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-web-services-jaxrpc-mapping-registration"></a>20.5.3&nbsp;Registering JAX-RPC Bean Mappings</h3></div></div></div><p>To transfer complex objects over the wire such as
      <code class="classname">Account</code> we must register bean mappings on the
      client side.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>On the server side using Axis registering bean mappings is
        usually done in the <code class="filename">'server-config.wsdd'</code>
        file.</p></td></tr></table></div><p>We will use Axis to register bean mappings on the client side. To
      do this we need to register the bean mappings programmatically:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AxisPortProxyFactoryBean <span class="hl-keyword">extends</span> JaxRpcPortProxyFactoryBean {

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> postProcessJaxRpcService(Service service) {
        TypeMappingRegistry registry = service.getTypeMappingRegistry();
        TypeMapping mapping = registry.createTypeMapping();
        registerBeanMapping(mapping, Account.<span class="hl-keyword">class</span>, <span class="hl-string">"Account"</span>);
        registry.register(<span class="hl-string">"http://schemas.xmlsoap.org/soap/encoding/"</span>, mapping);
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> registerBeanMapping(TypeMapping mapping, Class type, String name) {
        QName qName = <span class="hl-keyword">new</span> QName(<span class="hl-string">"http://localhost:8080/account/services/accountService"</span>, name);
        mapping.register(type, qName,
                <span class="hl-keyword">new</span> BeanSerializerFactory(type, qName),
                <span class="hl-keyword">new</span> BeanDeserializerFactory(type, qName));
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-web-services-jaxrpc-handler-registration"></a>20.5.4&nbsp;Registering your own JAX-RPC Handler</h3></div></div></div><p>In this section we will register our own
      <code class="interfacename">javax.rpc.xml.handler.Handler</code> to the web
      service proxy where we can do custom code before the SOAP message is
      sent over the wire. The <code class="interfacename">Handler</code> is a
      callback interface. There is a convenience base class provided in
      <code class="filename">jaxrpc.jar</code>, namely
      <code class="classname">javax.rpc.xml.handler.GenericHandler</code> that we will
      extend:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountHandler <span class="hl-keyword">extends</span> GenericHandler {

    <span class="hl-keyword">public</span> QName[] getHeaders() {
        <span class="hl-keyword">return</span> null;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> handleRequest(MessageContext context) {
        SOAPMessageContext smc = (SOAPMessageContext) context;
        SOAPMessage msg = smc.getMessage();
        <span class="hl-keyword">try</span> {
            SOAPEnvelope envelope = msg.getSOAPPart().getEnvelope();
            SOAPHeader header = envelope.getHeader();
            ...
        }
        <span class="hl-keyword">catch</span> (SOAPException ex) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> JAXRPCException(ex);
        }
        <span class="hl-keyword">return</span> true;
    }
}</pre><p>What we need to do now is to register our AccountHandler to
      JAX-RPC Service so it would invoke
      <code class="methodname">handleRequest(..)</code> before the message is sent
      over the wire. Spring has at this time of writing no declarative support
      for registering handlers, so we must use the programmatic approach.
      However Spring has made it very easy for us to do this as we can
      override the <code class="methodname">postProcessJaxRpcService(..)</code>
      method that is designed for this:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountHandlerJaxRpcPortProxyFactoryBean <span class="hl-keyword">extends</span> JaxRpcPortProxyFactoryBean {

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> postProcessJaxRpcService(Service service) {
        QName port = <span class="hl-keyword">new</span> QName(<span class="hl-keyword">this</span>.getNamespaceUri(), <span class="hl-keyword">this</span>.getPortName());
        List list = service.getHandlerRegistry().getHandlerChain(port);
        list.add(<span class="hl-keyword">new</span> HandlerInfo(AccountHandler.<span class="hl-keyword">class</span>, null, null));
        logger.info(<span class="hl-string">"Registered JAX-RPC AccountHandler on port "</span> + port);
    }
}</pre><p>The last thing we must remember to do is to change the Spring
      configuration to use our factory bean:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountWebService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.AccountHandlerJaxRpcPortProxyFactoryBean"</span>&gt;
    ...
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-web-services-jaxws-export-servlet"></a>20.5.5&nbsp;Exposing servlet-based web services using JAX-WS</h3></div></div></div><p>Spring provides a convenient base class for JAX-WS servlet
      endpoint implementations -
      <code class="classname">SpringBeanAutowiringSupport</code>. To expose our
      <code class="interfacename">AccountService</code> we extend Spring's
      <code class="classname">SpringBeanAutowiringSupport</code> class and implement
      our business logic here, usually delegating the call to the business
      layer. We'll simply use Spring 2.5's <code class="literal">@Autowired</code>
      annotation for expressing such dependencies on Spring-managed
      beans.</p><pre class="programlisting"><span class="hl-comment">/**
 * JAX-WS compliant AccountService implementation that simply delegates
 * to the AccountService implementation in the root web application context.
 *
 * This wrapper class is necessary because JAX-WS requires working with dedicated
 * endpoint classes. If an existing service needs to be exported, a wrapper that
 * extends SpringBeanAutowiringSupport for simple Spring bean autowiring (through
 * the @Autowired annotation) is the simplest JAX-WS compliant way.
 *
 * This is the class registered with the server-side JAX-WS implementation.
 * In the case of a Java EE 5 server, this would simply be defined as a servlet
 * in web.xml, with the server detecting that this is a JAX-WS endpoint and reacting
 * accordingly. The servlet name usually needs to match the specified WS service name.
 *
 * The web service engine manages the lifecycle of instances of this class.
 * Spring bean references will just be wired in here.
 */</span>
<span class="hl-keyword">import</span> org.springframework.web.context.support.SpringBeanAutowiringSupport;

@WebService(serviceName=<span class="hl-string">"AccountService"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountServiceEndpoint <span class="hl-keyword">extends</span> SpringBeanAutowiringSupport {

    @Autowired
    <span class="hl-keyword">private</span> AccountService biz;

    @WebMethod
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account acc) {
       biz.insertAccount(acc);
    }

    @WebMethod
    <span class="hl-keyword">public</span> Account[] getAccounts(String name) {
       <span class="hl-keyword">return</span> biz.getAccounts(name);
    }
}</pre><p>Our <code class="classname">AccountServletEndpoint</code> needs to run in
      the same web application as the Spring context to allow for access to
      Spring's facilities. This is the case by default in Java EE 5
      environments, using the standard contract for JAX-WS servlet endpoint
      deployment. See Java EE 5 web service tutorials for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-web-services-jaxws-export-standalone"></a>20.5.6&nbsp;Exporting standalone web services using JAX-WS</h3></div></div></div><p>The built-in JAX-WS provider that comes with Sun's JDK 1.6
      supports exposure of web services using the built-in HTTP server that's
      included in JDK 1.6 as well. Spring's
      <code class="classname">SimpleJaxWsServiceExporter</code> detects all
      <code class="literal">@WebService</code> annotated beans in the Spring application
      context, exporting them through the default JAX-WS server (the JDK 1.6
      HTTP server).</p><p>In this scenario, the endpoint instances are defined and managed
      as Spring beans themselves; they will be registered with the JAX-WS
      engine but their lifecycle will be up to the Spring application context.
      This means that Spring functionality like explicit dependency injection
      may be applied to the endpoint instances. Of course, annotation-driven
      injection through <code class="literal">@Autowired</code> will work as
      well.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.jaxws.SimpleJaxWsServiceExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"baseAddress"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"http://localhost:8080/"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountServiceEndpoint"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.AccountServiceEndpoint"</span>&gt;
    ...
&lt;<span class="hl-tag">/bean</span>&gt;

...</pre><p>The <code class="classname">AccountServiceEndpoint</code> may derive from
      Spring's <code class="classname">SpringBeanAutowiringSupport</code> but doesn't
      have to since the endpoint is a fully Spring-managed bean here. This
      means that the endpoint implementation may look like as follows, without
      any superclass declared - and Spring's <code class="literal">@Autowired</code>
      configuration annotation still being honored:</p><pre class="programlisting">@WebService(serviceName=<span class="hl-string">"AccountService"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountServiceEndpoint {

    @Autowired
    <span class="hl-keyword">private</span> AccountService biz;

    @WebMethod
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account acc) {
       biz.insertAccount(acc);
    }

    @WebMethod
    <span class="hl-keyword">public</span> List&lt;Account&gt; getAccounts(String name) {
       <span class="hl-keyword">return</span> biz.getAccounts(name);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-web-services-jaxws-export-ri"></a>20.5.7&nbsp;Exporting web services using the JAX-WS RI's Spring
      support</h3></div></div></div><p>Sun's JAX-WS RI, developed as part of the GlassFish project, ships
      Spring support as part of its JAX-WS Commons project. This allows for
      defining JAX-WS endpoints as Spring-managed beans, similar to the
      standalone mode discussed in the previous section - but this time in a
      Servlet environment. <span class="emphasis"><em>Note that this is not portable in a Java
      EE 5 environment; it is mainly intended for non-EE environments such as
      Tomcat, embedding the JAX-WS RI as part of the web
      application.</em></span></p><p>The difference to the standard style of exporting servlet-based
      endpoints is that the lifecycle of the endpoint instances themselves
      will be managed by Spring here, and that there will be only one JAX-WS
      servlet defined in <code class="literal">web.xml</code>. With the standard Java EE
      5 style (as illustrated above), you'll have one servlet definition per
      service endpoint, with each endpoint typically delegating to Spring
      beans (through the use of <code class="literal">@Autowired</code>, as shown
      above).</p><p>Check out <a class="ulink" href="https://jax-ws-commons.dev.java.net/spring/" target="_top">https://jax-ws-commons.dev.java.net/spring/</a>
      for the details on setup and usage style.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-web-services-jaxws-access"></a>20.5.8&nbsp;Accessing web services using JAX-WS</h3></div></div></div><p>Analogous to the JAX-RPC support, Spring provides two factory
      beans to create JAX-WS web service proxies, namely
      <code class="classname">LocalJaxWsServiceFactoryBean</code> and
      <code class="classname">JaxWsPortProxyFactoryBean</code>. The former can only
      return a JAX-WS service class for us to work with. The latter is the
      full-fledged version that can return a proxy that implements our
      business service interface. In this example we use the latter to create
      a proxy for the <code class="interfacename">AccountService</code> endpoint
      (again):</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountWebService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.AccountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"wsdlDocumentUrl"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"http://localhost:8888/AccountServiceEndpoint?WSDL"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"namespaceUri"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"http://example/"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AccountService"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"portName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AccountServiceEndpointPort"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Where <code class="literal">serviceInterface</code> is our business
      interface the clients will use. <code class="literal">wsdlDocumentUrl</code> is
      the URL for the WSDL file. Spring needs this a startup time to create
      the JAX-WS Service. <code class="literal">namespaceUri</code> corresponds to the
      targetNamespace in the .wsdl file. <code class="literal">serviceName</code>
      corresponds to the service name in the .wsdl file.
      <code class="literal">portName</code> corresponds to the port name in the .wsdl
      file.</p><p>Accessing the web service is now very easy as we have a bean
      factory for it that will expose it as <code class="literal">AccountService</code>
      interface. We can wire this up in Spring:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"client"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.AccountClientImpl"</span>&gt;
    ...
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"service"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountWebService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>From the client code we can access the web service just as if it
      was a normal class:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountClientImpl {

    <span class="hl-keyword">private</span> AccountService service;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setService(AccountService service) {
        <span class="hl-keyword">this</span>.service = service;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> foo() {
        service.insertAccount(...);
    }
}</pre><p><span class="emphasis"><em>NOTE:</em></span> The above is slightly simplified in
      that JAX-WS requires endpoint interfaces and implementation classes to
      be annotated with <code class="literal">@WebService</code>,
      <code class="literal">@SOAPBinding</code> etc annotations. This means that you
      cannot (easily) use plain Java interfaces and implementation classes as
      JAX-WS endpoint artifacts; you need to annotate them accordingly first.
      Check the JAX-WS documentation for details on those requirements.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-jms"></a>20.6&nbsp;JMS</h2></div></div></div><p>It is also possible to expose services transparently using JMS as
    the underlying communication protocol. The JMS remoting support in the
    Spring Framework is pretty basic - it sends and receives on the
    <code class="interfacename">same thread</code> and in the <span class="emphasis"><em>same
    non-transactional</em></span> <code class="interfacename">Session</code>, and
    as such throughput will be very implementation dependent. Note that
    these single-threaded and non-transactional constraints apply only to
    Spring's JMS <span class="bold"><strong>remoting</strong></span> support. See
    <a class="xref" href="#jms" title="22.&nbsp;JMS (Java Message Service)">Chapter&nbsp;22, <i>JMS (Java Message Service)</i></a> for information on Spring's rich support for
    JMS-based <span class="bold"><strong>messaging</strong></span>.</p><p>The following interface is used on both the server and the client
    side.</p><pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> CheckingAccountService {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> cancelAccount(Long accountId);
}</pre><p>The following simple implementation of the above interface is used
    on the server-side.</p><pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleCheckingAccountService <span class="hl-keyword">implements</span> CheckingAccountService {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> cancelAccount(Long accountId) {
        System.out.println(<span class="hl-string">"Cancelling account ["</span> + accountId + <span class="hl-string">"]"</span>);
    }
}</pre><p>This configuration file contains the JMS-infrastructure beans that
    are shared on both the client and server.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"brokerURL"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"tcp://ep-t43:61616"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"queue"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.activemq.command.ActiveMQQueue"</span>&gt;
        &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">"mmm"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-jms-server"></a>20.6.1&nbsp;Server-side configuration</h3></div></div></div><p>On the server, you just need to expose the service object using
      the <code class="classname">JmsInvokerServiceExporter</code>.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
         http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"checkingAccountService"</span>
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jms.remoting.JmsInvokerServiceExporter"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.foo.CheckingAccountService"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"service"</span>&gt;
            &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.SimpleCheckingAccountService"</span>/&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
   &lt;<span class="hl-tag">/bean</span>&gt;

   &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jms.listener.SimpleMessageListenerContainer"</span>&gt;
       &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"connectionFactory"</span>/&gt;
       &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"destination"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"queue"</span>/&gt;
       &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"concurrentConsumers"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"3"</span>/&gt;
       &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messageListener"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"checkingAccountService"</span>/&gt;
   &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Server {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) <span class="hl-keyword">throws</span> Exception {
        <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-keyword">new</span> String[]{<span class="hl-string">"com/foo/server.xml"</span>, <span class="hl-string">"com/foo/jms.xml"</span>});
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="remoting-jms-client"></a>20.6.2&nbsp;Client-side configuration</h3></div></div></div><p>The client merely needs to create a client-side proxy that will
      implement the agreed upon interface
      (<code class="interfacename">CheckingAccountService</code>). The resulting
      object created off the back of the following bean definition can be
      injected into other client side objects, and the proxy will take care of
      forwarding the call to the server-side object via JMS.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"checkingAccountService"</span>
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jms.remoting.JmsInvokerProxyFactoryBean"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.foo.CheckingAccountService"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"connectionFactory"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"queue"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"queue"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">import</span> org.springframework.context.ApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Client {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) <span class="hl-keyword">throws</span> Exception {
        ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(
                <span class="hl-keyword">new</span> String[] {<span class="hl-string">"com/foo/client.xml"</span>, <span class="hl-string">"com/foo/jms.xml"</span>});
        CheckingAccountService service = (CheckingAccountService) ctx.getBean(<span class="hl-string">"checkingAccountService"</span>);
        service.cancelAccount(<span class="hl-keyword">new</span> Long(10));
    }
}</pre></div><p>You may also wish to investigate the support provided by the <a class="ulink" href="http://lingo.codehaus.org/" target="_top">Lingo</a> project, which (to quote
    the homepage blurb) &#8220;<span class="quote">
        <span class="emphasis"><em>... is a lightweight POJO based remoting and messaging
        library based on the Spring Framework's remoting libraries which
        extends it to support JMS.</em></span>
      </span>&#8221;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-autodection-remote-interfaces"></a>20.7&nbsp;Auto-detection is not implemented for remote interfaces</h2></div></div></div><p>The main reason why auto-detection of implemented interfaces does
    not occur for remote interfaces is to avoid opening too many doors to
    remote callers. The target object might implement internal callback
    interfaces like <code class="interfacename">InitializingBean</code> or
    <code class="interfacename">DisposableBean</code> which one would not want to
    expose to callers.</p><p>Offering a proxy with all interfaces implemented by the target
    usually does not matter in the local case. But when exporting a remote
    service, you should expose a specific service interface, with specific
    operations intended for remote usage. Besides internal callback
    interfaces, the target might implement multiple business interfaces, with
    just one of them intended for remote exposure. For these reasons, we
    <span class="emphasis"><em>require</em></span> such a service interface to be
    specified.</p><p>This is a trade-off between configuration convenience and the risk
    of accidental exposure of internal methods. Always specifying a service
    interface is not too much effort, and puts you on the safe side regarding
    controlled exposure of specific methods.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="remoting-considerations"></a>20.8&nbsp;Considerations when choosing a technology</h2></div></div></div><p>Each and every technology presented here has its drawbacks. You
    should carefully consider your needs, the services you are exposing and the
    objects you'll be sending over the wire when choosing a technology.</p><p>When using RMI, it's not possible to access the objects through the
    HTTP protocol, unless you're tunneling the RMI traffic. RMI is a fairly
    heavy-weight protocol in that it supports full-object serialization which
    is important when using a complex data model that needs serialization over
    the wire. However, RMI-JRMP is tied to Java clients: It is a Java-to-Java
    remoting solution.</p><p>Spring's HTTP invoker is a good choice if you need HTTP-based
    remoting but also rely on Java serialization. It shares the basic
    infrastructure with RMI invokers, just using HTTP as transport. Note that
    HTTP invokers are not only limited to Java-to-Java remoting but also to
    Spring on both the client and server side. (The latter also applies to
    Spring's RMI invoker for non-RMI interfaces.)</p><p>Hessian and/or Burlap might provide significant value when operating
    in a heterogeneous environment, because they explicitly allow for non-Java
    clients. However, non-Java support is still limited. Known issues include
    the serialization of Hibernate objects in combination with
    lazily-initialized collections. If you have such a data model, consider
    using RMI or HTTP invokers instead of Hessian.</p><p>JMS can be useful for providing clusters of services and allowing
    the JMS broker to take care of load balancing, discovery and
    auto-failover. By default: Java serialization is used when using JMS
    remoting but the JMS provider could use a different mechanism for the wire
    formatting, such as XStream to allow servers to be implemented in other
    technologies.</p><p>Last but not least, EJB has an advantage over RMI in that it
    supports standard role-based authentication and authorization and remote
    transaction propagation. It is possible to get RMI invokers or HTTP
    invokers to support security context propagation as well, although this is
    not provided by core Spring: There are just appropriate hooks for plugging
    in third-party or custom solutions here.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-client-access"></a>20.9&nbsp;Accessing RESTful services on the Client</h2></div></div></div><p>The <code class="classname">RestTemplate</code> is the core class for
    client-side access to RESTful services. It is conceptually similar to
    other template classes in Spring, such as
    <code class="classname">JdbcTemplate</code> and <code class="classname">JmsTemplate</code>
    and other template classes found in other Spring portfolio projects.
    <code class="classname">RestTemplate</code>'s behavior is customized by providing
    callback methods and configuring the
    <code class="interfacename">HttpMessageConverter</code> used to marshal
    objects into the HTTP request body and to unmarshal any response back
    into an object. As it is common to use XML as a message format, Spring
    provides a <code class="classname">MarshallingHttpMessageConverter</code> that
    uses the Object-to-XML framework that is part of the
    <code class="classname">org.springframework.oxm</code> package. This gives you a
    wide range of choices of XML to Object mapping technologies to choose
    from.</p><p>This section describes how to use the
    <code class="classname">RestTemplate</code> and its associated
    <code class="interfacename">HttpMessageConverters</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="rest-resttemplate"></a>20.9.1&nbsp;RestTemplate</h3></div></div></div><p>Invoking RESTful services in Java is typically done using a helper
      class such as Jakarta Commons <code class="classname">HttpClient</code>. For
      common REST operations this approach is too low level as shown
      below.</p><pre class="programlisting">String uri = "http://example.com/hotels/1/bookings";

PostMethod post = new PostMethod(uri);
String request = // create booking request content
post.setRequestEntity(new StringRequestEntity(request));

httpClient.executeMethod(post);

if (HttpStatus.SC_CREATED == post.getStatusCode()) {
  Header location = post.getRequestHeader("Location");
  if (location != null) {
    System.out.println("Created new booking at :" + location.getValue());
  }
}</pre><p>RestTemplate provides higher level methods that correspond to each
      of the six main HTTP methods that make invoking many RESTful services a
      one-liner and enforce REST best practices.</p><div class="table"><a name="d0e38722"></a><p class="title"><b>Table&nbsp;20.1.&nbsp;Overview of RestTemplate methods</b></p><div class="table-contents"><table summary="Overview of RestTemplate methods" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><span class="bold"><strong>HTTP Method</strong></span></td><td style="border-bottom: 1.0pt solid ; "><span class="bold"><strong>RestTemplate
              Method</strong></span></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">DELETE</td><td style="border-bottom: 1.0pt solid ; "><a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/client/RestTemplate.html#delete(String,%20Object...)" target="_top">delete</a></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">GET</td><td style="border-bottom: 1.0pt solid ; "><a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/client/RestTemplate.html#getForObject(String,%20Class,%20Object...)" target="_top">getForObject</a></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">&nbsp;</td><td style="border-bottom: 1.0pt solid ; "><a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/client/RestTemplate.html#getForEntity(String,%20Class,%20Object...)" target="_top">getForEntity</a></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">HEAD</td><td style="border-bottom: 1.0pt solid ; "><a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/client/RestTemplate.html#headForHeaders(String,%20Object...)" target="_top">headForHeaders(String
              url, String&#8230; urlVariables)</a></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">OPTIONS</td><td style="border-bottom: 1.0pt solid ; "><a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/client/RestTemplate.html#optionsForAllow(String,%20Object...)" target="_top">optionsForAllow(String
              url, String&#8230; urlVariables)</a></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">POST</td><td style="border-bottom: 1.0pt solid ; "><a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/client/RestTemplate.html#postForLocation(String,%20Object,%20Object...)" target="_top">postForLocation(String
              url, Object request, String&#8230; urlVariables)</a></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">&nbsp;</td><td style="border-bottom: 1.0pt solid ; "><a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/client/RestTemplate.html#postForObject(java.lang.String,%20java.lang.Object,%20java.lang.Class,%20java.lang.String...)" target="_top">postForObject(String
				  url, Object request, Class&lt;T&gt; responseType, String&#8230;
				  uriVariables)</a></td></tr><tr><td style="border-right: 1.0pt solid ; ">PUT</td><td style=""><a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/client/RestTemplate.html#put(String,%20Object,%20Object...)" target="_top">put(String
              url, Object request, String&#8230;urlVariables)</a></td></tr></tbody></table></div></div><br class="table-break"><p>The names of <code class="classname">RestTemplate</code> methods follow a
      naming convention, the first part indicates what HTTP method is being
      invoked and the second part indicates what is returned. For example, the
      method <code class="methodname">getForObject()</code> will perform a GET, convert
      the HTTP response into an object type of your choice and return that
      object. The method <code class="methodname">postForLocation()</code> will do a
      POST, converting the given object into a HTTP request and return the
      response HTTP Location header where the newly created object can be
      found. In case of an exception processing the HTTP request, an exception
      of the type <code class="classname">RestClientException</code> will be
      thrown; this behavior can be changed by plugging in another <code class="interfacename">ResponseErrorHandler</code>
	  implementation into the <code class="classname">RestTemplate</code>.</p><p>Objects passed to and returned from these methods are converted to
      and from HTTP messages by
      <code class="interfacename">HttpMessageConverter</code> instances.
      Converters for the main mime types are registered by default, but you
      can also write your own converter and register it via the
      <code class="methodname">messageConverters()</code> bean property. The default
      converter instances registered with the template are
      <code class="classname">ByteArrayHttpMessageConverter</code>,
      <code class="classname">StringHttpMessageConverter</code>,
      <code class="classname">FormHttpMessageConverter</code> and
      <code class="classname">SourceHttpMessageConverter</code>. You can override
      these defaults using the <code class="methodname">messageConverters()</code> bean
      property as would be required if using the
      <code class="classname">MarshallingHttpMessageConverter</code> or 
      <code class="classname">MappingJacksonHttpMessageConverter</code>.</p><p>Each method takes URI template arguments in two forms, either as a
      <code class="literal">String</code> variable length argument or a
      <code class="literal">Map&lt;String,String&gt;</code>. For example,</p><pre class="programlisting">String result = restTemplate.getForObject(<span class="hl-string">"http://example.com/hotels/{hotel}/bookings/{booking}"</span>,
                                          String.<span class="hl-keyword">class</span>,<span class="hl-string">"42"</span>, <span class="hl-string">"21"</span>);
</pre><p>using variable length arguments and</p><pre class="programlisting">Map&lt;String, String&gt; vars = Collections.singletonMap(<span class="hl-string">"hotel"</span>, <span class="hl-string">"42"</span>);
String result =
  restTemplate.getForObject(<span class="hl-string">"http://example.com/hotels/{hotel}/rooms/{hotel}"</span>, String.<span class="hl-keyword">class</span>, vars);
</pre><p>using a <code class="literal">Map&lt;String,String&gt;</code>.</p><p>To create an instance of <code class="classname">RestTemplate</code> you can
      simply call the default no-arg constructor. This will use standard Java
      classes from the <code class="literal">java.net</code> package as the underlying
      implementation to create HTTP requests. This can be overridden by
      specifying an implementation of
      <code class="interfacename">ClientHttpRequestFactory</code>. Spring provides
      the implementation
      <code class="classname">CommonsClientHttpRequestFactory</code> that uses the
      Jakarta Commons <code class="classname">HttpClient</code> to create requests.
      <code class="classname">CommonsClientHttpRequestFactory</code> is configured
      using an instance of
      <code class="classname">org.apache.commons.httpclient.HttpClient</code> which
      can in turn be configured with credentials information or connection
      pooling functionality.</p><p>The previous example using Jakarta Commons
      <code class="classname">HttpClient</code> directly rewritten to use the
      <code class="classname">RestTemplate</code> is shown below</p><pre class="programlisting">uri = "http://example.com/hotels/{id}/bookings";

RestTemplate template = new RestTemplate();

Booking booking = // create booking object

URI location = template.postForLocation(uri, booking, "1");
</pre><p>The general callback interface is
      <code class="interfacename">RequestCallback</code> and is called when the
      execute method is invoked.</p><pre class="programlisting"><span class="hl-keyword">public</span> &lt;T&gt; T execute(String url, HttpMethod method, RequestCallback requestCallback,
                     ResponseExtractor&lt;T&gt; responseExtractor,
                     String... urlVariables)


<span class="hl-comment">// also has an overload with urlVariables as a Map&lt;String, String&gt;.</span></pre><p>The <code class="interfacename">RequestCallback</code> interface is
      defined as</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> RequestCallback {
 <span class="hl-keyword">void</span> doWithRequest(ClientHttpRequest request) <span class="hl-keyword">throws</span> IOException;
}</pre><p>and allows you to manipulate the request headers and write to the
      request body. When using the execute method you do not have to worry
      about any resource management, the template will always close the
      request and handle any errors. Refer to the API documentation for more
      information on using the execute method and the meaning of its other
      method arguments.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e38897"></a>20.9.1.1&nbsp;Working with the URI</h4></div></div></div><p>For each of the main HTTP methods, the <code class="classname">RestTemplate</code>
        provides variants that either take a String URI or <code class="classname">java.net.URI</code>
        as the first argument.
        </p><p>The String URI variants accept template arguments as a
        String variable length argument or as a <code class="classname">Map&lt;String,String&gt;</code>.
        They also assume the URL String is not encoded and needs to be encoded. 
        For example the following: 
        </p><pre class="programlisting">restTemplate.getForObject(<span class="hl-string">"http://example.com/hotel list"</span>, String.<span class="hl-keyword">class</span>);</pre><p>will perform a GET on <code class="filename">http://example.com/hotel%20list</code>.
        That means if the input URL String is already encoded, it will be encoded twice -- 
        i.e. <code class="filename">http://example.com/hotel%20list</code> will become 
        <code class="filename">http://example.com/hotel%2520list</code>. 
        If this is not the intended effect, use the 
        <code class="classname">java.net.URI</code> method variant, which assumes
        the URL is already encoded is also generally useful if you want
        to reuse a single (fully expanded) <code class="classname">URI</code>
        multiple times.</p><p>The <code class="classname">UriComponentsBuilder</code> class can be used
        to build and encode the <code class="classname">URI</code> including support 
        for URI templates. For example you can start with a URL String:
        </p><pre class="programlisting">UriComponents uriComponents = 
        UriComponentsBuilder.fromUriString(<span class="hl-string">"http://example.com/hotels/{hotel}/bookings/{booking}"</span>).build()
            .expand(<span class="hl-string">"42"</span>, <span class="hl-string">"21"</span>)
            .encode();
            
URI uri = uriComponents.toUri();</pre><p>Or specify each URI component indiviudally:</p><pre class="programlisting">UriComponents uriComponents = 
        UriComponentsBuilder.newInstance()
            .scheme(<span class="hl-string">"http"</span>).host(<span class="hl-string">"example.com"</span>).path(<span class="hl-string">"/hotels/{hotel}/bookings/{booking}"</span>).build()
            .expand(<span class="hl-string">"42"</span>, <span class="hl-string">"21"</span>)
            .encode();

URI uri = uriComponents.toUri();</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e38946"></a>20.9.1.2&nbsp;Dealing with request and response headers</h4></div></div></div><p>Besides the methods described above, the <code class="classname">RestTemplate</code>
        also has the <code class="methodname">exchange()</code> method, which can be
        used for arbitrary HTTP method execution based on the <code class="classname">HttpEntity</code>
        class.</p><p>Perhaps most importantly, the <code class="methodname">exchange()</code> 
        method can be used to add request headers and read response headers.
        For example:</p><pre class="programlisting">HttpHeaders requestHeaders = <span class="hl-keyword">new</span> HttpHeaders();
requestHeaders.set(<span class="hl-string">"MyRequestHeader"</span>, <span class="hl-string">"MyValue"</span>);
HttpEntity&lt;?&gt; requestEntity = <span class="hl-keyword">new</span> HttpEntity(requestHeaders);

HttpEntity&lt;String&gt; response = template.exchange(<span class="hl-string">"http://example.com/hotels/{hotel}"</span>,
  HttpMethod.GET, requestEntity, String.<span class="hl-keyword">class</span>, <span class="hl-string">"42"</span>);

String responseHeader = response.getHeaders().getFirst(<span class="hl-string">"MyResponseHeader"</span>);
String body = response.getBody();</pre><p>In the above example, we first prepare a request entity that contains the
        <code class="literal">MyRequestHeader</code> header. We then retrieve the response, and
        read the <code class="literal">MyResponseHeader</code> and body.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="rest-message-conversion"></a>20.9.2&nbsp;HTTP Message Conversion</h3></div></div></div><p>Objects passed to and returned from the methods
      <code class="methodname">getForObject()</code>,
      <code class="methodname">postForLocation()</code>, and
      <code class="methodname">put()</code> are converted to HTTP requests and from
      HTTP responses by <code class="interfacename">HttpMessageConverters</code>.
      The <code class="interfacename">HttpMessageConverter</code> interface is
      shown below to give you a better feel for its functionality</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> HttpMessageConverter&lt;T&gt; {

      <span class="hl-comment">// Indicate whether the given class and media type can be read by this converter.</span>
      <span class="hl-keyword">boolean</span> canRead(Class&lt;?&gt; clazz, MediaType mediaType);

      <span class="hl-comment">// Indicate whether the given class and media type can be written by this converter.</span>
      <span class="hl-keyword">boolean</span> canWrite(Class&lt;?&gt; clazz, MediaType mediaType);

      <span class="hl-comment">// Return the list of MediaType objects supported by this converter.</span>
      List&lt;MediaType&gt; getSupportedMediaTypes();

      <span class="hl-comment">// Read an object of the given type from the given input message, and returns it.</span>
      T read(Class&lt;T&gt; clazz, HttpInputMessage inputMessage) <span class="hl-keyword">throws</span> IOException,
                                                                   HttpMessageNotReadableException;

      <span class="hl-comment">// Write an given object to the given output message.</span>
      <span class="hl-keyword">void</span> write(T t, HttpOutputMessage outputMessage) <span class="hl-keyword">throws</span> IOException,
                                                              HttpMessageNotWritableException;

    }</pre><p>Concrete implementations for the main media (mime) types are
      provided in the framework and are registered by default with the
      <code class="classname">RestTemplate</code> on the client-side and with
      <code class="classname">AnnotationMethodHandlerAdapter</code> on the
      server-side.</p><p>The implementations of
      <code class="classname">HttpMessageConverter</code>s are described in the
      following sections. For all converters a default media type is used but
      can be overridden by setting the
      <code class="classname">supportedMediaTypes</code> bean property</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="rest-string-converter"></a>20.9.2.1&nbsp;StringHttpMessageConverter</h4></div></div></div><p>An <code class="interfacename">HttpMessageConverter</code>
        implementation that can read and write Strings from the HTTP request
        and response. By default, this converter supports all text media types
        (<code class="literal">text/*</code>), and writes with a
        <code class="literal">Content-Type</code> of
        <code class="literal">text/plain</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="rest-form-converter"></a>20.9.2.2&nbsp;FormHttpMessageConverter</h4></div></div></div><p>An <code class="interfacename">HttpMessageConverter</code>
        implementation that can read and write form data from the HTTP request
        and response. By default, this converter reads and writes the media
        type <code class="literal">application/x-www-form-urlencoded</code>. Form data
        is read from and written into a <code class="literal">MultiValueMap&lt;String,
        String&gt;</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="rest-byte-converter"></a>20.9.2.3&nbsp;ByteArrayHttpMessageConverter</h4></div></div></div><p>An <code class="interfacename">HttpMessageConverter</code>
        implementation that can read and write byte arrays from the HTTP
        request and response. By default, this converter supports all media
        types (<code class="literal">*/*</code>), and writes with a
        <code class="literal">Content-Type</code> of
        <code class="literal">application/octet-stream</code>. This can be overridden by
        setting the <span class="property">supportedMediaTypes</span> property, and
        overriding <code class="literal">getContentType(byte[])</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="rest-marhsalling-converter"></a>20.9.2.4&nbsp;MarshallingHttpMessageConverter</h4></div></div></div><p>An <code class="interfacename">HttpMessageConverter</code>
        implementation that can read and write XML using Spring's
        <code class="interfacename">Marshaller</code> and
        <code class="interfacename">Unmarshaller</code> abstractions from the
        <code class="classname">org.springframework.oxm</code> package. This converter
        requires a <code class="interfacename">Marshaller</code> and
        <code class="interfacename">Unmarshaller</code> before it can be used.
        These can be injected via constructor or bean properties. By default
        this converter supports (<code class="literal">text/xml</code>) and
        (<code class="literal">application/xml</code>).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="rest-mapping-json-converter"></a>20.9.2.5&nbsp;MappingJacksonHttpMessageConverter</h4></div></div></div><p>An <code class="interfacename">HttpMessageConverter</code> 
        implementation that can read and write JSON using Jackson's 
        <code class="interfacename">ObjectMapper</code>. JSON mapping can be 
        customized as needed through the use of Jackson's provided annotations. When 
        further control is needed, a custom 
        <code class="interfacename">ObjectMapper</code> can be injected through 
        the <code class="literal">ObjectMapper</code> property for cases where custom 
        JSON serializers/deserializers need to be provided for specific types. 
        By default this converter supports (<code class="literal">application/json</code>).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="rest-source-converter"></a>20.9.2.6&nbsp;SourceHttpMessageConverter</h4></div></div></div><p>An <code class="interfacename">HttpMessageConverter</code>
        implementation that can read and write
        <code class="classname">javax.xml.transform.Source</code> from the HTTP
        request and response. Only <code class="classname">DOMSource</code>,
        <code class="classname">SAXSource</code>, and
        <code class="classname">StreamSource</code> are supported. By default, this
        converter supports (<code class="literal">text/xml</code>) and
        (<code class="literal">application/xml</code>).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="rest-buffered-image-converter"></a>20.9.2.7&nbsp;BufferedImageHttpMessageConverter</h4></div></div></div><p>An <code class="interfacename">HttpMessageConverter</code>
        implementation that can read and write
        <code class="classname">java.awt.image.BufferedImage</code> from the HTTP
        request and response. This converter reads and writes the media type
        supported by the Java I/O API.</p></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="ejb"></a>21.&nbsp;Enterprise JavaBeans (EJB) integration</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ejb-introduction"></a>21.1&nbsp;Introduction</h2></div></div></div><p>
      As a lightweight container, Spring is often considered an EJB
      replacement. We do believe that for many if not most applications and use
      cases, Spring as a container, combined with its rich supporting
      functionality in the area of transactions, ORM and JDBC access, is a better
      choice than implementing equivalent functionality via an EJB container and
      EJBs.
      </p><p>
      However, it is important to note that using Spring does not prevent
      you from using EJBs. In fact, Spring makes it much easier to access EJBs and
      implement EJBs and functionality within them. Additionally, using Spring to
      access services provided by EJBs allows the implementation of those services
      to later transparently be switched between local EJB, remote EJB, or POJO
      (plain old Java object) variants, without the client code having to
      be changed.
      </p><p>
      In this chapter, we look at how Spring can help you access and
      implement EJBs. Spring provides particular value when accessing stateless
      session beans (SLSBs), so we'll begin by discussing this.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ejb-access"></a>21.2&nbsp;Accessing EJBs</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ejb-access-concepts"></a>21.2.1&nbsp;Concepts</h3></div></div></div><p>
				To invoke a method on a local or remote stateless session bean,
				client code must normally perform a JNDI lookup to obtain the (local or
				remote) EJB Home object, then use a 'create' method call on that object
				to obtain the actual (local or remote) EJB object. One or more methods
				are then invoked on the EJB.
      </p><p>
				To avoid repeated low-level code, many EJB applications use the
				Service Locator and Business Delegate patterns. These are better than
				spraying JNDI lookups throughout client code, but their usual
				implementations have significant disadvantages. For example:
            </p><div class="itemizedlist"><ul type="disc"><li><p>
						Typically code using EJBs depends on Service Locator or
						Business Delegate singletons, making it hard to test.
					</p></li><li><p>
						In the case of the Service Locator pattern used without a
						Business Delegate, application code still ends up having to invoke
						the create() method on an EJB home, and deal with the resulting
						exceptions. Thus it remains tied to the EJB API and the complexity
						of the EJB programming model.
					</p></li><li><p>
						Implementing the Business Delegate pattern typically results
						in significant code duplication, where we have to write numerous
						methods that simply call the same method on the EJB.
					</p></li></ul></div><p>
				The Spring approach is to allow the creation and use of proxy objects,
				normally configured inside a Spring container, which act as codeless
				business delegates. You do not need	to write another Service Locator, another
				JNDI lookup, or duplicate methods in a hand-coded Business Delegate unless
				you are actually adding real value in such code.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ejb-access-local"></a>21.2.2&nbsp;Accessing local SLSBs</h3></div></div></div><p>
				Assume that we have a web controller that needs to use a local
				EJB. We&#8217;ll follow best practice and use the EJB Business Methods
				Interface pattern, so that the EJB&#8217;s local interface extends a non
				EJB-specific business methods interface. Let&#8217;s call this business
				methods interface <code class="classname">MyComponent</code>.
			</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MyComponent {
    ...
}</pre><p>
				One of the main reasons to use the Business Methods Interface pattern
				is to ensure that synchronization between method signatures in local
				interface and bean implementation class is automatic. Another reason is
				that it later makes it much easier for us to switch to a POJO (plain old
				Java object) implementation of the service if it makes sense to do so.
				Of course we&#8217;ll also need to implement the local home interface and
				provide an implementation class that implements <code class="classname">SessionBean</code>
				and the <code class="classname">MyComponent</code> business methods interface. Now the
				only Java coding we&#8217;ll  need to do to hook up our web tier controller to the
				EJB implementation is to expose a setter method of type <code class="classname">MyComponent</code>
				on the controller. This will save the reference as an instance variable in the
				controller:
			</p><pre class="programlisting"><span class="hl-keyword">private</span> MyComponent myComponent;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMyComponent(MyComponent myComponent) {
    <span class="hl-keyword">this</span>.myComponent = myComponent;
}</pre><p>
				We can subsequently use this instance variable in any business
				method in the controller. Now assuming we are obtaining our controller
				object out of a Spring container, we can (in the same context) configure a
				<code class="classname">LocalStatelessSessionProxyFactoryBean</code> instance, which
				will be the EJB proxy object. The configuration of the proxy, and setting of
				the <code class="literal">myComponent</code> property of the controller is done
				with a configuration entry such as:
			</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myComponent"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jndiName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"ejb/myBean"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"businessInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.mycom.MyComponent"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myController"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycom.myController"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"myComponent"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myComponent"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>
				There&#8217;s a lot of work happening behind the scenes, courtesy of
				the Spring AOP framework, although you aren&#8217;t forced to work with AOP
				concepts to enjoy the results. The <code class="literal">myComponent</code> bean
				definition creates a proxy for the EJB, which implements the business
				method interface. The EJB local home is cached on startup, so there&#8217;s
				only a single JNDI lookup. Each time the EJB is invoked, the proxy
				invokes the <code class="literal">classname</code> method on the local EJB and
				invokes the	corresponding business method on the EJB.
			</p><p>
				The <code class="literal">myController</code> bean definition sets the
				<code class="literal">myComponent</code> property of the controller class to the
				EJB proxy.
			</p><p>
        Alternatively (and preferably in case of many such proxy definitions),
        consider using the <code class="literal">&lt;jee:local-slsb&gt;</code>
        configuration element in Spring's "jee" namespace:
      </p><pre class="programlisting">&lt;<span class="hl-tag">jee:local-slsb</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myComponent"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"ejb/myBean"</span>
      <span class="hl-attribute">business-interface</span>=<span class="hl-value">"com.mycom.MyComponent"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myController"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycom.myController"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"myComponent"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myComponent"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>
				This EJB access mechanism delivers huge simplification of
				application code: the web tier code (or other EJB client code) has no
				dependence on the use of EJB. If we want to replace this EJB reference
				with a POJO or a mock object or other test stub, we could simply change
				the <code class="literal">myComponent</code> bean definition without changing a
				line of Java code. Additionally, we haven&#8217;t had to write a single line of
				JNDI lookup or other EJB plumbing code as part of our application.
			</p><p>
				Benchmarks and experience in real applications indicate that the
				performance overhead of this approach (which involves reflective
				invocation of the target EJB) is minimal, and is typically undetectable
				in typical use. Remember that we don&#8217;t want to make fine-grained calls
				to EJBs anyway, as there&#8217;s a cost associated with the EJB infrastructure
				in the application server.
			</p><p>
				There is one caveat with regards to the JNDI lookup. In a bean
				container, this class is normally best used as a singleton (there simply
				is no reason to make it a prototype). However, if that bean container
				pre-instantiates singletons (as do the various XML
				<code class="classname">ApplicationContext</code> variants)
				you may have a problem if the bean container is loaded before the EJB
				container loads the target EJB. That is because the JNDI lookup will be
				performed in the <code class="literal">init()</code> method of this class and then
				cached, but the EJB will not have been bound at the target location yet.
				The solution is to not pre-instantiate this factory object, but allow it
				to be created on first use. In the XML containers, this is controlled via
				the <code class="literal">lazy-init</code> attribute.
			</p><p>
				Although this will not be of interest to the majority of Spring
				users, those doing programmatic AOP work with EJBs may want to look at
				<code class="classname">LocalSlsbInvokerInterceptor</code>.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ejb-access-remote"></a>21.2.3&nbsp;Accessing remote SLSBs</h3></div></div></div><p>
				Accessing remote EJBs is essentially identical to accessing local
				EJBs, except that the
				<code class="classname">SimpleRemoteStatelessSessionProxyFactoryBean</code> or
        <code class="literal">&lt;jee:remote-slsb&gt;</code> configuration element is used.
				Of course, with or without Spring, remote invocation semantics apply; a
				call to a method on an object in another VM in another computer does
				sometimes have to be treated differently in terms of usage scenarios and
				failure handling.
			</p><p>
				Spring's EJB client support adds one more advantage over the
				non-Spring approach. Normally it is problematic for EJB client code to
				be easily switched back and forth between calling EJBs locally or
				remotely. This is because the remote interface methods must declare that
				they throw <code class="classname">RemoteException</code>, and client code must deal
				with this, while the local interface methods don't. Client code
				written for local EJBs which needs to be moved to remote EJBs
				typically has to be modified to add handling for the remote exceptions,
				and client code written for remote EJBs which needs to be moved to local
				EJBs, can either stay the same but do a lot of unnecessary handling of
				remote exceptions, or needs to be modified to remove that code. With the
				Spring remote EJB proxy, you can instead not declare any thrown
				<code class="classname">RemoteException</code> in your Business Method Interface and
				implementing EJB code, have a remote interface which is identical except
				that it does throw <code class="classname">RemoteException</code>, and rely on the
				proxy to dynamically treat the two interfaces as if they were the same.
				That is, client code does not have to deal with the checked
				<code class="classname">RemoteException</code> class. Any actual
				<code class="classname">RemoteException</code> that is thrown during the EJB
				invocation will be re-thrown as the non-checked
				<code class="classname">RemoteAccessException</code> class, which is a subclass of
				<code class="classname">RuntimeException</code>. The target service can then be
				switched at will between a local EJB or remote EJB (or even plain Java
				object) implementation, without the client code knowing or caring. Of
				course, this is optional; there is nothing stopping you from declaring
				<code class="classname">RemoteExceptions</code> in your business interface.
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ejb-access-ejb2-ejb3"></a>21.2.4&nbsp;Accessing EJB 2.x SLSBs versus EJB 3 SLSBs</h3></div></div></div><p>
        Accessing EJB 2.x Session Beans and EJB 3 Session Beans via Spring
        is largely transparent. Spring's EJB accessors, including the
        <code class="literal">&lt;jee:local-slsb&gt;</code> and <code class="literal">&lt;jee:remote-slsb&gt;</code>
        facilities, transparently adapt to the actual component at runtime.
        They handle a home interface if found (EJB 2.x style), or perform straight
        component invocations if no home interface is available (EJB 3 style).
      </p><p>
        Note: For EJB 3 Session Beans, you could effectively use a
        <code class="classname">JndiObjectFactoryBean</code> / <code class="literal">&lt;jee:jndi-lookup&gt;</code>
        as well, since fully usable component references are exposed for plain
        JNDI lookups there. Defining explicit <code class="literal">&lt;jee:local-slsb&gt;</code>
        / <code class="literal">&lt;jee:remote-slsb&gt;</code> lookups simply provides
        consistent and more explicit EJB access configuration.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ejb-implementation"></a>21.3&nbsp;Using Spring's EJB implementation support classes</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ejb-implementation-ejb2"></a>21.3.1&nbsp;EJB 2.x base classes</h3></div></div></div><p>
        Spring provides convenience classes to help you implement EJBs.
        These are designed to encourage the good practice of putting business
        logic behind EJBs in POJOs, leaving EJBs responsible for transaction
        demarcation and (optionally) remoting.
      </p><p>
        To implement a Stateless or Stateful session bean, or a Message Driven
        bean, you need only derive your implementation class from
        <code class="classname">AbstractStatelessSessionBean</code>,
        <code class="classname">AbstractStatefulSessionBean</code>, and
        <code class="classname">AbstractMessageDrivenBean</code>/<code class="classname">AbstractJmsMessageDrivenBean</code>,
        respectively.
      </p><p>
        Consider an example Stateless Session bean which actually delegates
        the implementation to a plain java service object. We have the business
        interface:
      </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MyComponent {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> myMethod(...);
    ...
}</pre><p>We also have the plain Java implementation object:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyComponentImpl <span class="hl-keyword">implements</span> MyComponent {
    <span class="hl-keyword">public</span> String myMethod(...) {
        ...
    }
    ...
}</pre><p>And finally the Stateless Session Bean itself:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyFacadeEJB <span class="hl-keyword">extends</span> AbstractStatelessSessionBean
        <span class="hl-keyword">implements</span> MyFacadeLocal {

    <span class="hl-keyword">private</span> MyComponent myComp;

    <span class="hl-comment">/**
     * Obtain our POJO service object from the BeanFactory/ApplicationContext
     * @see org.springframework.ejb.support.AbstractStatelessSessionBean#onEjbCreate()
     */</span>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> onEjbCreate() <span class="hl-keyword">throws</span> CreateException {
        myComp = (MyComponent) getBeanFactory().getBean(
            ServicesConstants.CONTEXT_MYCOMP_ID);
    }

    <span class="hl-comment">// for business method, delegate to POJO service impl.</span>
    <span class="hl-keyword">public</span> String myFacadeMethod(...) {
        <span class="hl-keyword">return</span> myComp.myMethod(...);
    }
    ...
}</pre><p>
        The Spring EJB support base classes will by default create and load
        a Spring IoC container as part of their lifecycle, which is then available
        to the EJB (for example, as used in the code above to obtain the POJO
        service object). The loading is	done via a strategy object which is a subclass of
        <code class="classname">BeanFactoryLocator</code>. The actual implementation of
        <code class="classname">BeanFactoryLocator</code> used by default is
        <code class="classname">ContextJndiBeanFactoryLocator</code>, which creates the
        ApplicationContext from a resource locations specified as a JNDI
        environment variable (in the case of the EJB classes, at
        <code class="literal">java:comp/env/ejb/BeanFactoryPath</code>). If there is a need
        to change the BeanFactory/ApplicationContext loading strategy, the default
        <code class="classname">BeanFactoryLocator</code> implementation used may be overridden
        by calling the <code class="literal">setBeanFactoryLocator()</code> method, either
        in <code class="literal">setSessionContext()</code>, or in the actual constructor of
        the EJB. Please see the Javadocs for more details.
      </p><p>
        As described in the Javadocs, Stateful Session beans expecting to be
        passivated and reactivated as part of their lifecycle, and which use a
        non-serializable container instance (which is the normal case) will have
        to manually call <code class="literal">unloadBeanFactory()</code> and
        <code class="literal">loadBeanFactory()</code> from <code class="literal">ejbPassivate()</code>
        and <code class="literal">ejbActivate()</code>, respectively, to unload and reload the
        BeanFactory on passivation and activation, since it can not be saved by
        the EJB container.
      </p><p>
        The default behavior of the
        <code class="classname">ContextJndiBeanFactoryLocator</code> class is to load an
        <code class="classname">ApplicationContext</code> for use by an EJB, and is
        adequate for some situations. However, it is problematic when the
        <code class="classname">ApplicationContext</code> is loading a number of beans,
        or the initialization of those beans is time consuming or memory
        intensive (such as a Hibernate <code class="classname">SessionFactory</code>
        initialization, for example), since every EJB will have their own copy.
        In this case, the user may want to override the default
        <code class="classname">ContextJndiBeanFactoryLocator</code> usage and use
        another <code class="classname">BeanFactoryLocator</code> variant, such as the
        <code class="classname">ContextSingletonBeanFactoryLocator</code> which can load
        and use a shared container to be used by multiple EJBs or other clients.
        Doing this is relatively simple, by adding code similar to this to the
        EJB:
      </p><pre class="programlisting">   <span class="hl-comment">/**
    * Override default BeanFactoryLocator implementation
    * @see javax.ejb.SessionBean#setSessionContext(javax.ejb.SessionContext)
    */</span>
   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSessionContext(SessionContext sessionContext) {
       <span class="hl-keyword">super</span>.setSessionContext(sessionContext);
       setBeanFactoryLocator(ContextSingletonBeanFactoryLocator.getInstance());
       setBeanFactoryLocatorKey(ServicesConstants.PRIMARY_CONTEXT_ID);
   }</pre><p>
        You would then need to create a bean definition file named <code class="literal">beanRefContext.xml</code>.
        This file defines all bean factories (usually in the form of application contexts) that may be used
        in the EJB. In many cases, this file will only contain a single bean definition such as this (where
        <code class="literal">businessApplicationContext.xml</code> contains the bean	definitions for all business
        service POJOs):
      </p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessBeanFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.support.ClassPathXmlApplicationContext"</span>&gt;
        &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">"businessApplicationContext.xml"</span> /&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>
        In the above example, the <code class="literal">ServicesConstants.PRIMARY_CONTEXT_ID</code> constant
        would be defined as follows:
        </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> String ServicesConstants.PRIMARY_CONTEXT_ID = <span class="hl-string">"businessBeanFactory"</span>;</pre><p>
        Please see the respective Javadocs for the <code class="classname">BeanFactoryLocator</code> and
        <code class="classname">ContextSingletonBeanFactoryLocator</code> classes for more information on
        their usage.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ejb-implementation-ejb3"></a>21.3.2&nbsp;EJB 3 injection interceptor</h3></div></div></div><p>
        For EJB 3 Session Beans and Message-Driven Beans, Spring provides a convenient
        interceptor that resolves Spring 2.5's <code class="literal">@Autowired</code> annotation
        in the EJB component class:
        <code class="classname">org.springframework.ejb.interceptor.SpringBeanAutowiringInterceptor</code>.
        This interceptor can be applied through an <code class="code">@Interceptors</code> annotation
        in the EJB component class, or through an <code class="literal">interceptor-binding</code>
        XML element in the EJB deployment descriptor.
      </p><pre class="programlisting">@Stateless
@Interceptors(SpringBeanAutowiringInterceptor.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyFacadeEJB <span class="hl-keyword">implements</span> MyFacadeLocal {

    <span class="hl-comment">// automatically injected with a matching Spring bean</span>
    @Autowired
    <span class="hl-keyword">private</span> MyComponent myComp;

    <span class="hl-comment">// for business method, delegate to POJO service impl.</span>
    <span class="hl-keyword">public</span> String myFacadeMethod(...) {
        <span class="hl-keyword">return</span> myComp.myMethod(...);
    }
    ...
}</pre><p>
        <code class="classname">SpringBeanAutowiringInterceptor</code> by default obtains target
        beans from a <code class="classname">ContextSingletonBeanFactoryLocator</code>, with the
        context defined in a bean definition file named <code class="literal">beanRefContext.xml</code>.
        By default, a single context definition is expected, which is obtained by type rather
        than by name. However, if you need to choose between multiple context definitions,
        a specific locator key is required. The locator key (i.e. the name of the context
        definition in <code class="literal">beanRefContext.xml</code>) can be explicitly specified
        either through overriding the <code class="literal">getBeanFactoryLocatorKey</code> method
        in a custom <code class="classname">SpringBeanAutowiringInterceptor</code> subclass.
      </p><p>
        Alternatively, consider overriding <code class="classname">SpringBeanAutowiringInterceptor</code>'s
        <code class="literal">getBeanFactory</code> method, e.g. obtaining a shared
        <code class="interfacename">ApplicationContext</code> from a custom holder class.
      </p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="jms"></a>22.&nbsp;JMS (Java Message Service)</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-introduction"></a>22.1&nbsp;Introduction</h2></div></div></div><p>Spring provides a JMS integration framework that simplifies the use
    of the JMS API much like Spring's integration does for the JDBC
    API.</p><p>JMS can be roughly divided into two areas of functionality, namely
    the production and consumption of messages. The
    <code class="classname">JmsTemplate</code> class is used for message production
    and synchronous message reception. For asynchronous reception similar to
    Java EE's message-driven bean style, Spring provides a number of message
    listener containers that are used to create Message-Driven POJOs
    (MDPs).</p><p>The package <code class="literal">org.springframework.jms.core</code> provides
    the core functionality for using JMS. It contains JMS template classes
    that simplify the use of the JMS by handling the creation and release of
    resources, much like the <code class="classname">JdbcTemplate</code> does for
    JDBC. The design principle common to Spring template classes is to provide
    helper methods to perform common operations and for more sophisticated
    usage, delegate the essence of the processing task to user implemented
    callback interfaces. The JMS template follows the same design. The classes
    offer various convenience methods for the sending of messages, consuming a
    message synchronously, and exposing the JMS session and message producer
    to the user.</p><p>The package <code class="literal">org.springframework.jms.support</code>
    provides <code class="classname">JMSException</code> translation functionality.
    The translation converts the checked <code class="classname">JMSException</code>
    hierarchy to a mirrored hierarchy of unchecked exceptions. If there are
    any provider specific subclasses of the checked
    <code class="classname">javax.jms.JMSException</code>, this exception is wrapped
    in the unchecked <code class="classname">UncategorizedJmsException</code>.</p><p>The package
    <code class="literal">org.springframework.jms.support.converter</code> provides a
    <code class="interfacename">MessageConverter</code> abstraction to convert
    between Java objects and JMS messages.</p><p>The package
    <code class="literal">org.springframework.jms.support.destination</code> provides
    various strategies for managing JMS destinations, such as providing a
    service locator for destinations stored in JNDI.</p><p>Finally, the package
    <code class="literal">org.springframework.jms.connection</code> provides an
    implementation of the <code class="classname">ConnectionFactory</code> suitable
    for use in standalone applications. It also contains an implementation of
    Spring's <code class="interfacename">PlatformTransactionManager</code> for JMS
    (the cunningly named <code class="classname">JmsTransactionManager</code>). This
    allows for seamless integration of JMS as a transactional resource into
    Spring's transaction management mechanisms.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-using"></a>22.2&nbsp;Using Spring JMS</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-jmstemplate"></a>22.2.1&nbsp;<code class="classname">JmsTemplate</code></h3></div></div></div><p>The <code class="classname">JmsTemplate</code> class is the central class
      in the JMS core package. It simplifies the use of JMS since it handles
      the creation and release of resources when sending or synchronously
      receiving messages.</p><p>Code that uses the <code class="classname">JmsTemplate</code> only needs
      to implement callback interfaces giving them a clearly defined high
      level contract. The <code class="classname">MessageCreator</code> callback
      interface creates a message given a
      <code class="interfacename">Session</code> provided by the calling code in
      <code class="classname">JmsTemplate</code>. In order to allow for more complex
      usage of the JMS API, the callback
      <code class="classname">SessionCallback</code> provides the user with the JMS
      session and the callback <code class="classname">ProducerCallback</code> exposes
      a <code class="interfacename">Session</code> and
      <code class="interfacename">MessageProducer</code> pair.</p><p>The JMS API exposes two types of send methods, one that takes
      delivery mode, priority, and time-to-live as Quality of Service (QOS)
      parameters and one that takes no QOS parameters which uses default
      values. Since there are many send methods in
      <code class="classname">JmsTemplate</code>, the setting of the QOS parameters
      have been exposed as bean properties to avoid duplication in the number
      of send methods. Similarly, the timeout value for synchronous receive
      calls is set using the property
      <code class="classname">setReceiveTimeout</code>.</p><p>Some JMS providers allow the setting of default QOS values
      administratively through the configuration of the ConnectionFactory.
      This has the effect that a call to
      <code class="classname">MessageProducer</code>'s send method
      <code class="methodname">send(Destination destination, Message message)</code>
      will use different QOS default values than those specified in the JMS
      specification. In order to provide consistent management of QOS values,
      the <code class="classname">JmsTemplate</code> must therefore be specifically
      enabled to use its own QOS values by setting the boolean property
      <span class="property">isExplicitQosEnabled</span> to
      <code class="literal">true</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Instances of the <code class="classname">JmsTemplate</code> class are
        <span class="emphasis"><em>thread-safe once configured</em></span>. This is important
        because it means that you can configure a single instance of a
        <code class="classname">JmsTemplate</code> and then safely inject this
        <span class="emphasis"><em>shared</em></span> reference into multiple collaborators. To
        be clear, the <code class="classname">JmsTemplate</code> is stateful, in that
        it maintains a reference to a
        <code class="interfacename">ConnectionFactory</code>, but this state is
        <span class="emphasis"><em>not</em></span> conversational state.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-connections"></a>22.2.2&nbsp;Connections</h3></div></div></div><p>The <code class="classname">JmsTemplate</code> requires a reference to a
      <code class="classname">ConnectionFactory</code>. The
      <code class="classname">ConnectionFactory</code> is part of the JMS
      specification and serves as the entry point for working with JMS. It is
      used by the client application as a factory to create connections with
      the JMS provider and encapsulates various configuration parameters, many
      of which are vendor specific such as SSL configuration options.</p><p>When using JMS inside an EJB, the vendor provides implementations
      of the JMS interfaces so that they can participate in declarative
      transaction management and perform pooling of connections and sessions.
      In order to use this implementation, Java EE containers typically
      require that you declare a JMS connection factory as a
      <span class="property">resource-ref</span> inside the EJB or servlet deployment
      descriptors. To ensure the use of these features with the
      <code class="classname">JmsTemplate</code> inside an EJB, the client application
      should ensure that it references the managed implementation of the
      <code class="classname">ConnectionFactory</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e39676"></a>22.2.2.1&nbsp;Caching Messaging Resources</h4></div></div></div><p>The standard API involves creating many intermediate objects. To
        send a message the following 'API' walk is performed</p><pre class="programlisting">ConnectionFactory-&gt;Connection-&gt;Session-&gt;MessageProducer-&gt;send</pre><p>Between the ConnectionFactory and the Send operation there are
        three intermediate objects that are created and destroyed. To optimise
        the resource usage and increase performance two implementations of
        IConnectionFactory are provided.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e39685"></a>22.2.2.2&nbsp;SingleConnectionFactory</h4></div></div></div><p>Spring provides an implementation of the
        <code class="classname">ConnectionFactory</code> interface,
        <code class="classname">SingleConnectionFactory</code>, that will return the
        same <code class="classname">Connection</code> on all
        <code class="methodname">createConnection()</code> calls and ignore calls to
        <code class="methodname">close()</code>. This is useful for testing and
        standalone environments so that the same connection can be used for
        multiple <code class="classname">JmsTemplate</code> calls that may span any
        number of transactions. <code class="classname">SingleConnectionFactory</code>
        takes a reference to a standard
        <code class="classname">ConnectionFactory</code> that would typically come
        from JNDI.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e39714"></a>22.2.2.3&nbsp;CachingConnectionFactory</h4></div></div></div><p>The <code class="classname">CachingConnectionFactory</code> extends the
        functionality of <code class="classname">SingleConnectionFactory</code> and
        adds the caching of Sessions, MessageProducers, and MessageConsumers.
        The initial cache size is set to 1, use the property
        <span class="property">SessionCacheSize</span> to increase the number of cached
        sessions. Note that the number of actual cached sessions will be more
        than that number as sessions are cached based on their acknowledgment
        mode, so there can be up to 4 cached session instances when
        <span class="property">SessionCacheSize</span> is set to one, one for each
        AcknowledgementMode. MessageProducers and MessageConsumers are cached
        within their owning session and also take into account the unique
        properties of the producers and consumers when caching.
        MessageProducers are cached based on their destination.
        MessageConsumers are cached based on a key composed of the
        destination, selector, noLocal delivery flag, and the durable
        subscription name (if creating durable consumers).</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-destinations"></a>22.2.3&nbsp;Destination Management</h3></div></div></div><p>Destinations, like ConnectionFactories, are JMS administered
      objects that can be stored and retrieved in JNDI. When configuring a
      Spring application context you can use the JNDI factory class
      <code class="classname">JndiObjectFactoryBean</code> /
      <code class="literal">&lt;jee:jndi-lookup&gt;</code> to perform dependency
      injection on your object's references to JMS destinations. However,
      often this strategy is cumbersome if there are a large number of
      destinations in the application or if there are advanced destination
      management features unique to the JMS provider. Examples of such
      advanced destination management would be the creation of dynamic
      destinations or support for a hierarchical namespace of destinations.
      The <code class="classname">JmsTemplate</code> delegates the resolution of a
      destination name to a JMS destination object to an implementation of the
      interface <code class="classname">DestinationResolver</code>.
      <code class="classname">DynamicDestinationResolver</code> is the default
      implementation used by <code class="classname">JmsTemplate</code> and
      accommodates resolving dynamic destinations. A
      <code class="classname">JndiDestinationResolver</code> is also provided that
      acts as a service locator for destinations contained in JNDI and
      optionally falls back to the behavior contained in
      <code class="classname">DynamicDestinationResolver</code>.</p><p>Quite often the destinations used in a JMS application are only
      known at runtime and therefore cannot be administratively created when
      the application is deployed. This is often because there is shared
      application logic between interacting system components that create
      destinations at runtime according to a well-known naming convention.
      Even though the creation of dynamic destinations is not part of the JMS
      specification, most vendors have provided this functionality. Dynamic
      destinations are created with a name defined by the user which
      differentiates them from temporary destinations and are often not
      registered in JNDI. The API used to create dynamic destinations varies
      from provider to provider since the properties associated with the
      destination are vendor specific. However, a simple implementation choice
      that is sometimes made by vendors is to disregard the warnings in the
      JMS specification and to use the <code class="classname">TopicSession</code>
      method <code class="methodname">createTopic(String topicName)</code> or the
      <code class="classname">QueueSession</code> method
      <code class="methodname">createQueue(String queueName)</code> to create a new
      destination with default destination properties. Depending on the vendor
      implementation, <code class="classname">DynamicDestinationResolver</code> may
      then also create a physical destination instead of only resolving
      one.</p><p>The boolean property <span class="property">pubSubDomain</span> is used to
      configure the <code class="classname">JmsTemplate</code> with knowledge of what
      JMS domain is being used. By default the value of this property is
      false, indicating that the point-to-point domain, Queues, will be used.
      This property used by <code class="classname">JmsTemplate</code> determines the
      behavior of dynamic destination resolution via implementations of the
      <code class="interfacename">DestinationResolver</code> interface.</p><p>You can also configure the <code class="classname">JmsTemplate</code> with
      a default destination via the property
      <span class="property">defaultDestination</span>. The default destination will be
      used with send and receive operations that do not refer to a specific
      destination.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-mdp"></a>22.2.4&nbsp;Message Listener Containers</h3></div></div></div><p>One of the most common uses of JMS messages in the EJB world is to
      drive message-driven beans (MDBs). Spring offers a solution to create
      message-driven POJOs (MDPs) in a way that does not tie a user to an EJB
      container. (See <a class="xref" href="#jms-asynchronousMessageReception" title="22.4.2&nbsp;Asynchronous Reception - Message-Driven POJOs">Section&nbsp;22.4.2, &#8220;Asynchronous Reception - Message-Driven POJOs&#8221;</a>
      for detailed coverage of Spring's MDP support.)</p><p>A message listener container is used to receive messages from a
      JMS message queue and drive the MessageListener that is injected into
      it. The listener container is responsible for all threading of message
      reception and dispatches into the listener for processing. A message
      listener container is the intermediary between an MDP and a messaging
      provider, and takes care of registering to receive messages,
      participating in transactions, resource acquisition and release,
      exception conversion and suchlike. This allows you as an application
      developer to write the (possibly complex) business logic associated with
      receiving a message (and possibly responding to it), and delegates
      boilerplate JMS infrastructure concerns to the framework.</p><p>There are two standard JMS message listener containers packaged
      with Spring, each with its specialised feature set.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="jms-mdp-simple"></a>22.2.4.1&nbsp;SimpleMessageListenerContainer</h4></div></div></div><p>This message listener container is the simpler of the two
        standard flavors. It creates a fixed number of JMS sessions and
        consumers at startup, registers the listener using the standard JMS
        <code class="methodname">MessageConsumer.setMessageListener()</code> method,
        and leaves it up the JMS provider to perform listener callbacks.
        This variant does not allow for dynamic adaption to runtime demands or
        for participation in externally managed transactions. Compatibility-wise,
        it stays very close to the spirit of the standalone JMS specification
        - but is generally not compatible with Java EE's JMS restrictions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="jms-mdp-default"></a>22.2.4.2&nbsp;DefaultMessageListenerContainer</h4></div></div></div><p>This message listener container is the one used in most cases.
        In contrast to <code class="classname">SimpleMessageListenerContainer</code>,
        this container variant does allow for dynamic adaption to runtime
        demands and is able to participate in externally managed transactions.
        Each received message is registered with an XA transaction when
        configured with a <code class="classname">JtaTransactionManager</code>; so
        processing may take advantage of XA transaction semantics. This
        listener container strikes a good balance between low requirements on
        the JMS provider, advanced functionality such as transaction
        participation, and compatibility with Java EE environments.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-tx"></a>22.2.5&nbsp;Transaction management</h3></div></div></div><p>Spring provides a <code class="classname">JmsTransactionManager</code>
      that manages transactions for a single JMS
      <code class="classname">ConnectionFactory</code>. This allows JMS applications
      to leverage the managed transaction features of Spring as described in
      <a class="xref" href="#transaction" title="11.&nbsp;Transaction Management">Chapter&nbsp;11, <i>Transaction Management</i></a>. The
      <code class="classname">JmsTransactionManager</code> performs local resource
      transactions, binding a JMS Connection/Session pair from the specified
      <code class="classname">ConnectionFactory</code> to the thread.
      <code class="classname">JmsTemplate</code> automatically detects such
      transactional resources and operates on them accordingly.</p><p>In a Java EE environment, the
      <code class="classname">ConnectionFactory</code> will pool Connections and
      Sessions, so those resources are efficiently reused across transactions.
      In a standalone environment, using Spring's
      <code class="classname">SingleConnectionFactory</code> will result in a shared
      JMS <code class="classname">Connection</code>, with each transaction having its
      own independent <code class="classname">Session</code>. Alternatively, consider
      the use of a provider-specific pooling adapter such as ActiveMQ's
      <code class="classname">PooledConnectionFactory</code> class.</p><p><code class="classname">JmsTemplate</code> can also be used with the
      <code class="classname">JtaTransactionManager</code> and an XA-capable JMS
      <code class="classname">ConnectionFactory</code> for performing distributed
      transactions. Note that this requires the use of a JTA transaction
      manager as well as a properly XA-configured ConnectionFactory! (Check
      your Java EE server's / JMS provider's documentation.)</p><p>Reusing code across a managed and unmanaged transactional
      environment can be confusing when using the JMS API to create a
      <code class="classname">Session</code> from a <code class="classname">Connection</code>.
      This is because the JMS API has only one factory method to create a
      <code class="classname">Session</code> and it requires values for the
      transaction and acknowledgement modes. In a managed environment, setting
      these values is the responsibility of the environment's transactional
      infrastructure, so these values are ignored by the vendor's wrapper to
      the JMS Connection. When using the <code class="classname">JmsTemplate</code> in
      an unmanaged environment you can specify these values through the use of
      the properties <code class="literal">sessionTransacted</code> and
      <code class="literal">sessionAcknowledgeMode</code>. When using a
      <code class="classname">PlatformTransactionManager</code> with
      <code class="classname">JmsTemplate</code>, the template will always be given a
      transactional JMS <code class="classname">Session</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-sending"></a>22.3&nbsp;Sending a <code class="interfacename">Message</code></h2></div></div></div><p>The <code class="classname">JmsTemplate</code> contains many convenience
    methods to send a message. There are send methods that specify the
    destination using a <code class="classname">javax.jms.Destination</code> object
    and those that specify the destination using a string for use in a JNDI
    lookup. The send method that takes no destination argument uses the
    default destination. Here is an example that sends a message to a queue
    using the 1.0.2 implementation.</p><pre class="programlisting"><span class="hl-keyword">import</span> javax.jms.ConnectionFactory;
<span class="hl-keyword">import</span> javax.jms.JMSException;
<span class="hl-keyword">import</span> javax.jms.Message;
<span class="hl-keyword">import</span> javax.jms.Queue;
<span class="hl-keyword">import</span> javax.jms.Session;

<span class="hl-keyword">import</span> org.springframework.jms.core.MessageCreator;
<span class="hl-keyword">import</span> org.springframework.jms.core.JmsTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JmsQueueSender {

    <span class="hl-keyword">private</span> JmsTemplate jmsTemplate;
    <span class="hl-keyword">private</span> Queue queue;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setConnectionFactory(ConnectionFactory cf) {
        <span class="hl-keyword">this</span>.jmsTemplate = <span class="hl-keyword">new</span> JmsTemplate(cf);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setQueue(Queue queue) {
        <span class="hl-keyword">this</span>.queue = queue;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> simpleSend() {
        <span class="hl-keyword">this</span>.jmsTemplate.send(<span class="hl-keyword">this</span>.queue, <span class="hl-keyword">new</span> MessageCreator() {
            <span class="hl-keyword">public</span> Message createMessage(Session session) <span class="hl-keyword">throws</span> JMSException {
              <span class="hl-keyword">return</span> session.createTextMessage(<span class="hl-string">"hello queue world"</span>);
            }
        });
    }
}</pre><p>This example uses the <code class="classname">MessageCreator</code> callback
    to create a text message from the supplied <code class="classname">Session</code>
    object. The <code class="classname">JmsTemplate</code> is constructed by passing a
    reference to a <code class="classname">ConnectionFactory</code>. As an alternative,
    a zero argument constructor and <span class="property">connectionFactory</span>
    is provided and can be used for constructing the instance in JavaBean style
    (using a BeanFactory or plain Java code). Alternatively, consider deriving
    from Spring's <code class="classname">JmsGatewaySupport</code> convenience base class,
    which provides pre-built bean properties for JMS configuration.</p><p>The method <code class="methodname">send(String destinationName, MessageCreator
    creator)</code> lets you send a message using the string name of
    the destination. If these names are registered in JNDI, you should set the
    <span class="property">destinationResolver</span> property of the template to an
    instance of <code class="classname">JndiDestinationResolver</code>.</p><p>If you created the <code class="classname">JmsTemplate</code> and specified
    a default destination, the <code class="methodname">send(MessageCreator c)</code>
    sends a message to that destination.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-msg-conversion"></a>22.3.1&nbsp;Using Message Converters</h3></div></div></div><p>In order to facilitate the sending of domain model objects, the
      <code class="classname">JmsTemplate</code> has various send methods that take a
      Java object as an argument for a message's data content. The overloaded
      methods <code class="methodname">convertAndSend()</code> and
      <code class="methodname">receiveAndConvert()</code> in
      <code class="classname">JmsTemplate</code> delegate the conversion process to an
      instance of the <code class="literal">MessageConverter</code> interface. This
      interface defines a simple contract to convert between Java objects and
      JMS messages. The default implementation
      <code class="classname">SimpleMessageConverter</code> supports conversion
      between <code class="classname">String</code> and
      <code class="classname">TextMessage</code>, <code class="classname">byte[]</code> and
      <code class="classname">BytesMesssage</code>, and
      <code class="classname">java.util.Map</code> and
      <code class="classname">MapMessage</code>. By using the converter, you and your
      application code can focus on the business object that is being sent or
      received via JMS and not be concerned with the details of how it is
      represented as a JMS message.</p><p>The sandbox currently includes a
      <code class="classname">MapMessageConverter</code> which uses reflection to
      convert between a JavaBean and a <code class="classname">MapMessage</code>.
      Other popular implementation choices you might implement yourself are
      Converters that use an existing XML marshalling package, such as JAXB,
      Castor, XMLBeans, or XStream, to create a
      <code class="interfacename">TextMessage</code> representing the
      object.</p><p>To accommodate the setting of a message's properties, headers, and
      body that can not be generically encapsulated inside a converter class,
      the <code class="interfacename">MessagePostProcessor</code> interface gives
      you access to the message after it has been converted, but before it is
      sent. The example below demonstrates how to modify a message header and
      a property after a <code class="interfacename">java.util.Map</code> is
      converted to a message.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> sendWithConversion() {
    Map map = <span class="hl-keyword">new</span> HashMap();
    map.put(<span class="hl-string">"Name"</span>, <span class="hl-string">"Mark"</span>);
    map.put(<span class="hl-string">"Age"</span>, <span class="hl-keyword">new</span> Integer(47));
    jmsTemplate.convertAndSend(<span class="hl-string">"testQueue"</span>, map, <span class="hl-keyword">new</span> MessagePostProcessor() {
        <span class="hl-keyword">public</span> Message postProcessMessage(Message message) <span class="hl-keyword">throws</span> JMSException {
            message.setIntProperty(<span class="hl-string">"AccountID"</span>, 1234);
            message.setJMSCorrelationID(<span class="hl-string">"123-00001"</span>);
            <span class="hl-keyword">return</span> message;
        }
    });
}</pre><p>This results in a message of the form:</p><pre class="programlisting">MapMessage={
    Header={
        ... standard headers ...
        CorrelationID={123-00001}
    }
    Properties={
        AccountID={Integer:1234}
    }
    Fields={
        Name={String:Mark}
        Age={Integer:47}
    } 
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-callbacks"></a>22.3.2&nbsp;<code class="interfacename">SessionCallback</code> and
      <code class="interfacename">ProducerCallback</code></h3></div></div></div><p>While the send operations cover many common usage scenarios, there
      are cases when you want to perform multiple operations on a JMS
      <code class="interfacename">Session</code> or
      <code class="interfacename">MessageProducer</code>. The
      <code class="interfacename">SessionCallback</code> and
      <code class="interfacename">ProducerCallback</code> expose the JMS
      <code class="interfacename">Session</code> and
      <code class="interfacename">Session</code> /
      <code class="interfacename">MessageProducer</code> pair respectively. The
      <code class="methodname">execute()</code> methods on
      <code class="classname">JmsTemplate</code> execute these callback
      methods.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-receiving"></a>22.4&nbsp;Receiving a message</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-receiving-sync"></a>22.4.1&nbsp;Synchronous Reception</h3></div></div></div><p>While JMS is typically associated with asynchronous processing, it
      is possible to consume messages synchronously. The overloaded
      <code class="methodname">receive(..)</code> methods provide this functionality.
      During a synchronous receive, the calling thread blocks until a message
      becomes available. This can be a dangerous operation since the calling
      thread can potentially be blocked indefinitely. The property
      <span class="property">receiveTimeout</span> specifies how long the receiver
      should wait before giving up waiting for a message.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-asynchronousMessageReception"></a>22.4.2&nbsp;Asynchronous Reception - Message-Driven POJOs</h3></div></div></div><p>In a fashion similar to a Message-Driven Bean (MDB) in the EJB
      world, the Message-Driven POJO (MDP) acts as a receiver for JMS
      messages. The one restriction (but see also below for the discussion of
      the <code class="classname">MessageListenerAdapter</code> class) on an MDP is
      that it must implement the
      <code class="interfacename">javax.jms.MessageListener</code> interface.
      Please also be aware that in the case where your POJO will be receiving
      messages on multiple threads, it is important to ensure that your
      implementation is thread-safe.</p><p>Below is a simple implementation of an MDP:</p><pre class="programlisting"><span class="hl-keyword">import</span> javax.jms.JMSException;
<span class="hl-keyword">import</span> javax.jms.Message;
<span class="hl-keyword">import</span> javax.jms.MessageListener;
<span class="hl-keyword">import</span> javax.jms.TextMessage;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleListener <span class="hl-keyword">implements</span> MessageListener {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onMessage(Message message) {
        <span class="hl-keyword">if</span> (message <span class="hl-keyword">instanceof</span> TextMessage) {
            <span class="hl-keyword">try</span> {
                System.out.println(((TextMessage) message).getText());
            }
            <span class="hl-keyword">catch</span> (JMSException ex) {
                <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> RuntimeException(ex);
            }
        }
        <span class="hl-keyword">else</span> {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> IllegalArgumentException(<span class="hl-string">"Message must be of type TextMessage"</span>);
        }
    }
}</pre><p>Once you've implemented your
      <code class="interfacename">MessageListener</code>, it's time to create a
      message listener container.</p><p>Find below an example of how to define and configure one of the
      message listener containers that ships with Spring (in this case the
      <code class="classname">DefaultMessageListenerContainer</code>).</p><pre class="programlisting">&lt;<span class="hl-comment">!-- this is the Message Driven POJO (MDP) --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messageListener"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"jmsexample.ExampleListener"</span> /&gt;

&lt;<span class="hl-comment">!-- and this is the message listener container --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jmsContainer"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jms.listener.DefaultMessageListenerContainer"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"connectionFactory"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"destination"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"destination"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messageListener"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"messageListener"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Please refer to the Spring Javadoc of the various message listener
      containers for a full description of the features supported by each
      implementation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-receiving-async-session-aware-message-listener"></a>22.4.3&nbsp;The <code class="interfacename">SessionAwareMessageListener</code>
      interface</h3></div></div></div><p>The <code class="interfacename">SessionAwareMessageListener</code>
      interface is a Spring-specific interface that provides a similar
      contract to the JMS <code class="interfacename">MessageListener</code>
      interface, but also provides the message handling method with access to
      the JMS <code class="interfacename">Session</code> from which the
      <code class="interfacename">Message</code> was received.</p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.jms.listener;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> SessionAwareMessageListener {

    <span class="hl-keyword">void</span> onMessage(Message message, Session session) <span class="hl-keyword">throws</span> JMSException;
}</pre><p>You can choose to have your MDPs implement this interface (in
      preference to the standard JMS
      <code class="interfacename">MessageListener</code> interface) if you want
      your MDPs to be able to respond to any received messages (using the
      <code class="interfacename">Session</code> supplied in the
      <code class="literal">onMessage(Message, Session)</code> method). All of the
      message listener container implementations that ship with Spring have
      support for MDPs that implement either the
      <code class="interfacename">MessageListener</code> or
      <code class="interfacename">SessionAwareMessageListener</code> interface.
      Classes that implement the
      <code class="interfacename">SessionAwareMessageListener</code> come with the
      caveat that they are then tied to Spring through the interface. The
      choice of whether or not to use it is left entirely up to you as an
      application developer or architect.</p><p>Please note that the <code class="literal">'onMessage(..)'</code> method of
      the <code class="interfacename">SessionAwareMessageListener</code> interface
      throws <code class="classname">JMSException</code>. In contrast to the standard
      JMS <code class="interfacename">MessageListener</code> interface, when using
      the <code class="interfacename">SessionAwareMessageListener</code>
      interface, it is the responsibility of the client code to handle any
      exceptions thrown.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-receiving-async-message-listener-adapter"></a>22.4.4&nbsp;The <code class="classname">MessageListenerAdapter</code></h3></div></div></div><p>The <code class="classname">MessageListenerAdapter</code> class is the
      final component in Spring's asynchronous messaging support: in a
      nutshell, it allows you to expose almost <span class="emphasis"><em>any</em></span> class
      as a MDP (there are of course some constraints).</p><p>Consider the following interface definition. Notice that although
      the interface extends neither the
      <code class="interfacename">MessageListener</code> nor
      <code class="interfacename">SessionAwareMessageListener</code> interfaces,
      it can still be used as a MDP via the use of the
      <code class="classname">MessageListenerAdapter</code> class. Notice also how the
      various message handling methods are strongly typed according to the
      <span class="emphasis"><em>contents</em></span> of the various
      <code class="interfacename">Message</code> types that they can receive and
      handle.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MessageDelegate {

    <span class="hl-keyword">void</span> handleMessage(String message);

    <span class="hl-keyword">void</span> handleMessage(Map message);

    <span class="hl-keyword">void</span> handleMessage(<span class="hl-keyword">byte</span>[] message);

    <span class="hl-keyword">void</span> handleMessage(Serializable message);
}</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultMessageDelegate <span class="hl-keyword">implements</span> MessageDelegate {
    <span class="hl-comment">// implementation elided for clarity...</span>
}</pre><p>In particular, note how the above implementation of the
      <code class="interfacename">MessageDelegate</code> interface (the above
      <code class="classname">DefaultMessageDelegate</code> class) has
      <span class="emphasis"><em>no</em></span> JMS dependencies at all. It truly is a POJO that
      we will make into an MDP via the following configuration.</p><pre class="programlisting">&lt;<span class="hl-comment">!-- this is the Message Driven POJO (MDP) --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messageListener"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jms.listener.adapter.MessageListenerAdapter"</span>&gt;
    &lt;<span class="hl-tag">constructor-arg</span>&gt;
        &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"jmsexample.DefaultMessageDelegate"</span>/&gt;
    &lt;<span class="hl-tag">/constructor-arg</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-comment">!-- and this is the message listener container... --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jmsContainer"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jms.listener.DefaultMessageListenerContainer"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"connectionFactory"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"destination"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"destination"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messageListener"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"messageListener"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Below is an example of another MDP that can only handle the
      receiving of JMS <code class="interfacename">TextMessage</code> messages.
      Notice how the message handling method is actually called
      <code class="literal">'receive'</code> (the name of the message handling method in
      a <code class="classname">MessageListenerAdapter</code> defaults to
      <code class="literal">'handleMessage'</code>), but it is configurable (as you will
      see below). Notice also how the <code class="literal">'receive(..)'</code> method
      is strongly typed to receive and respond only to JMS
      <code class="interfacename">TextMessage</code> messages.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> TextMessageDelegate {

    <span class="hl-keyword">void</span> receive(TextMessage message);
}</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultTextMessageDelegate <span class="hl-keyword">implements</span> TextMessageDelegate {
    <span class="hl-comment">// implementation elided for clarity...</span>
}</pre><p>The configuration of the attendant
      <code class="classname">MessageListenerAdapter</code> would look like
      this:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messageListener"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jms.listener.adapter.MessageListenerAdapter"</span>&gt;
    &lt;<span class="hl-tag">constructor-arg</span>&gt;
        &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"jmsexample.DefaultTextMessageDelegate"</span>/&gt;
    &lt;<span class="hl-tag">/constructor-arg</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"defaultListenerMethod"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"receive"</span>/&gt;
    &lt;<span class="hl-comment">!-- we don't want automatic message context extraction --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messageConverter"</span>&gt;
        &lt;<span class="hl-tag">null</span>/&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Please note that if the above <code class="literal">'messageListener'</code>
      receives a JMS <code class="interfacename">Message</code> of a type other
      than <code class="interfacename">TextMessage</code>, an
      <code class="classname">IllegalStateException</code> will be thrown (and
      subsequently swallowed). Another of the capabilities of the
      <code class="classname">MessageListenerAdapter</code> class is the ability to
      automatically send back a response
      <code class="interfacename">Message</code> if a handler method returns a
      non-void value. Consider the interface and class:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ResponsiveTextMessageDelegate {

    <span class="hl-comment">// notice the return type...</span>
    String receive(TextMessage message);
}</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultResponsiveTextMessageDelegate <span class="hl-keyword">implements</span> ResponsiveTextMessageDelegate {
    <span class="hl-comment">// implementation elided for clarity...</span>
}</pre><p>If the above
      <code class="classname">DefaultResponsiveTextMessageDelegate</code> is used in
      conjunction with a <code class="classname">MessageListenerAdapter</code> then
      any non-null value that is returned from the execution of the
      <code class="literal">'receive(..)'</code> method will (in the default
      configuration) be converted into a
      <code class="interfacename">TextMessage</code>. The resulting
      <code class="interfacename">TextMessage</code> will then be sent to the
      <code class="interfacename">Destination</code> (if one exists) defined in
      the JMS Reply-To property of the original
      <code class="interfacename">Message</code>, or the default
      <code class="interfacename">Destination</code> set on the
      <code class="classname">MessageListenerAdapter</code> (if one has been
      configured); if no <code class="interfacename">Destination</code> is found
      then an <code class="classname">InvalidDestinationException</code> will be
      thrown (and please note that this exception <span class="emphasis"><em>will
      not</em></span> be swallowed and <span class="emphasis"><em>will</em></span> propagate up
      the call stack).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jms-tx-participation"></a>22.4.5&nbsp;Processing messages within transactions</h3></div></div></div><p>Invoking a message listener within a transaction only requires
      reconfiguration of the listener container.</p><p>Local resource transactions can simply be activated through the
      <code class="literal">sessionTransacted</code> flag on the listener container
      definition. Each message listener invocation will then operate within an
      active JMS transaction, with message reception rolled back in case of
      listener execution failure. Sending a response message (via
      <code class="interfacename">SessionAwareMessageListener</code>) will be part
      of the same local transaction, but any other resource operations (such
      as database access) will operate independently. This usually requires
      duplicate message detection in the listener implementation, covering the
      case where database processing has committed but message processing
      failed to commit.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jmsContainer"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jms.listener.DefaultMessageListenerContainer"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"connectionFactory"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"destination"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"destination"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messageListener"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"messageListener"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionTransacted"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>For participating in an externally managed transaction, you will
      need to configure a transaction manager and use a listener container
      which supports externally managed transactions: typically
      <code class="classname">DefaultMessageListenerContainer</code>.</p><p>To configure a message listener container for XA transaction
      participation, you'll want to configure a
      <code class="classname">JtaTransactionManager</code> (which, by default,
      delegates to the Java EE server's transaction subsystem). Note that the
      underlying JMS ConnectionFactory needs to be XA-capable and properly
      registered with your JTA transaction coordinator! (Check your Java EE
      server's configuration of JNDI resources.) This allows message reception
      as well as e.g. database access to be part of the same transaction (with
      unified commit semantics, at the expense of XA transaction log
      overhead).</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.jta.JtaTransactionManager"</span>/&gt;
</pre><p>Then you just need to add it to our earlier container
      configuration. The container will take care of the rest.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jmsContainer"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jms.listener.DefaultMessageListenerContainer"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"connectionFactory"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"destination"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"destination"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messageListener"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"messageListener"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-jca-message-endpoint-manager"></a>22.5&nbsp;Support for JCA Message Endpoints</h2></div></div></div><p>Beginning with version 2.5, Spring also provides support for a
    JCA-based <code class="interfacename">MessageListener</code> container. The
    <code class="classname">JmsMessageEndpointManager</code> will attempt to
    automatically determine the <code class="interfacename">ActivationSpec</code>
    class name from the provider's
    <code class="interfacename">ResourceAdapter</code> class name. Therefore, it
    is typically possible to just provide Spring's generic
    <code class="classname">JmsActivationSpecConfig</code> as shown in the following
    example.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jms.listener.endpoint.JmsMessageEndpointManager"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"resourceAdapter"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"resourceAdapter"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"activationSpecConfig"</span>&gt;
        &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jms.listener.endpoint.JmsActivationSpecConfig"</span>&gt;
            &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"destinationName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"myQueue"</span>/&gt;
        &lt;<span class="hl-tag">/bean</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messageListener"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myMessageListener"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Alternatively, you may set up a
    <code class="classname">JmsMessageEndpointManager</code> with a given
    <code class="interfacename">ActivationSpec</code> object. The
    <code class="interfacename">ActivationSpec</code> object may also come from a
    JNDI lookup (using <code class="literal">&lt;jee:jndi-lookup&gt;</code>).</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jms.listener.endpoint.JmsMessageEndpointManager"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"resourceAdapter"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"resourceAdapter"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"activationSpec"</span>&gt;
        &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.activemq.ra.ActiveMQActivationSpec"</span>&gt;
            &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"destination"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"myQueue"</span>/&gt;
            &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"destinationType"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"javax.jms.Queue"</span>/&gt;
        &lt;<span class="hl-tag">/bean</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messageListener"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myMessageListener"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Using Spring's <code class="classname">ResourceAdapterFactoryBean</code>,
    the target <code class="interfacename">ResourceAdapter</code> may be
    configured locally as depicted in the following example.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"resourceAdapter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.support.ResourceAdapterFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"resourceAdapter"</span>&gt;
        &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.activemq.ra.ActiveMQResourceAdapter"</span>&gt;
            &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serverUrl"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"tcp://localhost:61616"</span>/&gt;
        &lt;<span class="hl-tag">/bean</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"workManager"</span>&gt;
        &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.work.SimpleTaskWorkManager"</span>/&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The specified <code class="interfacename">WorkManager</code> may also
    point to an environment-specific thread pool - typically through
    <code class="classname">SimpleTaskWorkManager's</code> "asyncTaskExecutor"
    property. Consider defining a shared thread pool for all your
    <code class="interfacename">ResourceAdapter</code> instances if you happen to
    use multiple adapters.</p><p>In some environments (e.g. WebLogic 9 or above), the entire
    <code class="interfacename">ResourceAdapter</code> object may be obtained from
    JNDI instead (using <code class="literal">&lt;jee:jndi-lookup&gt;</code>). The
    Spring-based message listeners can then interact with the server-hosted
    <code class="interfacename">ResourceAdapter</code>, also using the server's
    built-in <code class="interfacename">WorkManager</code>.</p><p>Please consult the JavaDoc for
    <code class="classname">JmsMessageEndpointManager</code>,
    <code class="classname">JmsActivationSpecConfig</code>, and
    <code class="classname">ResourceAdapterFactoryBean</code> for more details.</p><p>Spring also provides a generic JCA message endpoint manager which is
    not tied to JMS:
    <code class="classname">org.springframework.jca.endpoint.GenericMessageEndpointManager</code>.
    This component allows for using any message listener type (e.g. a CCI
    MessageListener) and any provider-specific ActivationSpec object. Check
    out your JCA provider's documentation to find out about the actual
    capabilities of your connector, and consult
    <code class="classname">GenericMessageEndpointManager</code>'s JavaDoc for the
    Spring-specific configuration details.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>JCA-based message endpoint management is very analogous to EJB 2.1
      Message-Driven Beans; it uses the same underlying resource provider
      contract. Like with EJB 2.1 MDBs, any message listener interface
      supported by your JCA provider can be used in the Spring context as
      well. Spring nevertheless provides explicit 'convenience' support for
      JMS, simply because JMS is the most common endpoint API used with the
      JCA endpoint management contract.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-namespace"></a>22.6&nbsp;JMS Namespace Support</h2></div></div></div><p>Spring 2.5 introduces an XML namespace for simplifying JMS
    configuration. To use the JMS namespace elements you will need to
    reference the JMS schema:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:jms</span>=<span class="hl-value">"http://www.springframework.org/schema/jms"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms-3.0.xsd"</span>&gt;

&lt;<span class="hl-comment">!-- &lt;bean/&gt; definitions here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The namespace consists of two top-level elements:
    <code class="literal">&lt;listener-container/&gt;</code> and
    <code class="literal">&lt;jca-listener-container/&gt;</code> both of which may
    contain one or more <code class="literal">&lt;listener/&gt;</code> child elements.
    Here is an example of a basic configuration for two listeners.</p><pre class="programlisting">&lt;<span class="hl-tag">jms:listener-container</span>&gt;

    &lt;<span class="hl-tag">jms:listener</span> <span class="hl-attribute">destination</span>=<span class="hl-value">"queue.orders"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"orderService"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"placeOrder"</span>/&gt;

    &lt;<span class="hl-tag">jms:listener</span> <span class="hl-attribute">destination</span>=<span class="hl-value">"queue.confirmations"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"confirmationLogger"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"log"</span>/&gt;

&lt;<span class="hl-tag">/jms:listener-container</span>&gt;</pre><p>The example above is equivalent to creating two distinct listener
    container bean definitions and two distinct
    <code class="classname">MessageListenerAdapter</code> bean definitions as
    demonstrated in <a class="xref" href="#jms-receiving-async-message-listener-adapter" title="22.4.4&nbsp;The MessageListenerAdapter">Section&nbsp;22.4.4, &#8220;The MessageListenerAdapter&#8221;</a>.
    In addition to the attributes shown above, the <code class="literal">listener</code> element
    may contain several optional ones. The following table describes all available
    attributes:</p><div class="table"><a name="jms-namespace-listener-tbl"></a><p class="title"><b>Table&nbsp;22.1.&nbsp;Attributes of the JMS <code class="literal">&lt;listener&gt;</code>
      element</b></p><div class="table-contents"><table summary="Attributes of the JMS <listener&gt;&#xA;      element" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Attribute</th><th style="border-bottom: 1.0pt solid ; ">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">id</td><td style="border-bottom: 1.0pt solid ; "><p>A bean name for the hosting listener container. If
            not specified, a bean name will be automatically
            generated.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">destination <span class="bold"><strong>(required)</strong></span></td><td style="border-bottom: 1.0pt solid ; "><p>The destination name for this listener, resolved
            through the <code class="interfacename">DestinationResolver</code>
            strategy.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">ref <span class="bold"><strong>(required)</strong></span></td><td style="border-bottom: 1.0pt solid ; "><p>The bean name of the handler object.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">method</td><td style="border-bottom: 1.0pt solid ; "><p>The name of the handler method to invoke. If the
            <code class="literal">ref</code> points to a
            <code class="interfacename">MessageListener</code> or Spring
            <code class="interfacename">SessionAwareMessageListener</code>, this
            attribute may be omitted.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">response-destination</td><td style="border-bottom: 1.0pt solid ; "><p>The name of the default response destination to send
            response messages to. This will be applied in case of a request
            message that does not carry a "JMSReplyTo" field. The type of this
            destination will be determined by the listener-container's
            "destination-type" attribute. Note: This only applies to a
            listener method with a return value, for which each result object
            will be converted into a response message.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">subscription</td><td style="border-bottom: 1.0pt solid ; "><p>The name of the durable subscription, if
            any.</p></td></tr><tr><td style="border-right: 1.0pt solid ; ">selector</td><td style=""><p>An optional message selector for this
            listener.</p></td></tr></tbody></table></div></div><br class="table-break"><p>The <code class="literal">&lt;listener-container/&gt;</code> element also
    accepts several optional attributes. This allows for customization of the
    various strategies (for example, <span class="property">taskExecutor</span> and
    <span class="property">destinationResolver</span>) as well as basic JMS settings
    and resource references. Using these attributes, it is possible to define
    highly-customized listener containers while still benefiting from the
    convenience of the namespace.</p><pre class="programlisting">&lt;<span class="hl-tag">jms:listener-container</span> <span class="hl-attribute">connection-factory</span>=<span class="hl-value">"myConnectionFactory"</span>
                        <span class="hl-attribute">task-executor</span>=<span class="hl-value">"myTaskExecutor"</span>
                        <span class="hl-attribute">destination-resolver</span>=<span class="hl-value">"myDestinationResolver"</span>
                        <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"myTransactionManager"</span>
                        <span class="hl-attribute">concurrency</span>=<span class="hl-value">"10"</span>&gt;

    &lt;<span class="hl-tag">jms:listener</span> <span class="hl-attribute">destination</span>=<span class="hl-value">"queue.orders"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"orderService"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"placeOrder"</span>/&gt;

    &lt;<span class="hl-tag">jms:listener</span> <span class="hl-attribute">destination</span>=<span class="hl-value">"queue.confirmations"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"confirmationLogger"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"log"</span>/&gt;

&lt;<span class="hl-tag">/jms:listener-container</span>&gt;</pre><p>The following table describes all available attributes. Consult the
    class-level Javadoc of the
    <code class="classname">AbstractMessageListenerContainer</code> and its concrete
    subclasses for more details on the individual properties. The Javadoc also
    provides a discussion of transaction choices and message redelivery
    scenarios.</p><div class="table"><a name="jms-namespace-listener-container-tbl"></a><p class="title"><b>Table&nbsp;22.2.&nbsp;Attributes of the JMS
      <code class="literal">&lt;listener-container&gt;</code> element</b></p><div class="table-contents"><table summary="Attributes of the JMS&#xA;      <listener-container&gt; element" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Attribute</th><th style="border-bottom: 1.0pt solid ; ">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">container-type</td><td style="border-bottom: 1.0pt solid ; "><p>The type of this listener container. Available
            options are: <code class="literal">default</code>,
            <code class="literal">simple</code>, <code class="literal">default102</code>, or
            <code class="literal">simple102</code> (the default value is
            <code class="literal">'default'</code>).</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">connection-factory</td><td style="border-bottom: 1.0pt solid ; "><p>A reference to the JMS
            <code class="interfacename">ConnectionFactory</code> bean (the default
            bean name is
            <code class="literal">'connectionFactory'</code>).</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">task-executor</td><td style="border-bottom: 1.0pt solid ; "><p>A reference to the Spring
            <code class="interfacename">TaskExecutor</code> for the JMS listener
            invokers.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">destination-resolver</td><td style="border-bottom: 1.0pt solid ; "><p>A reference to the
            <code class="interfacename">DestinationResolver</code> strategy for
            resolving JMS
            <code class="interfacename">Destinations</code>.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">message-converter</td><td style="border-bottom: 1.0pt solid ; "><p>A reference to the
            <code class="interfacename">MessageConverter</code> strategy for
            converting JMS Messages to listener method arguments. Default is a
            <code class="classname">SimpleMessageConverter</code>.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">destination-type</td><td style="border-bottom: 1.0pt solid ; "><p>The JMS destination type for this listener:
            <code class="literal">queue</code>, <code class="literal">topic</code> or
            <code class="literal">durableTopic</code>. The default is
            <code class="literal">queue</code>.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">client-id</td><td style="border-bottom: 1.0pt solid ; "><p>The JMS client id for this listener container. Needs
            to be specified when using durable subscriptions.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">cache</td><td style="border-bottom: 1.0pt solid ; "><p>The cache level for JMS resources:
            <code class="literal">none</code>, <code class="literal">connection</code>,
            <code class="literal">session</code>, <code class="literal">consumer</code> or
            <code class="literal">auto</code>. By default (<code class="literal">auto</code>), the
            cache level will effectively be "consumer", unless an external
            transaction manager has been specified - in which case the
            effective default will be <code class="literal">none</code> (assuming
            Java EE-style transaction management where the given
            ConnectionFactory is an XA-aware pool).</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">acknowledge</td><td style="border-bottom: 1.0pt solid ; "><p>The native JMS acknowledge mode:
            <code class="literal">auto</code>, <code class="literal">client</code>,
            <code class="literal">dups-ok</code> or <code class="literal">transacted</code>. A
            value of <code class="literal">transacted</code> activates a locally
            transacted <code class="interfacename">Session</code>. As an
            alternative, specify the <code class="literal">transaction-manager</code>
            attribute described below. Default is
            <code class="literal">auto</code>.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">transaction-manager</td><td style="border-bottom: 1.0pt solid ; "><p>A reference to an external
            <code class="interfacename">PlatformTransactionManager</code>
            (typically an XA-based transaction coordinator, e.g. Spring's
            <code class="classname">JtaTransactionManager</code>). If not specified,
            native acknowledging will be used (see "acknowledge"
            attribute).</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">concurrency</td><td style="border-bottom: 1.0pt solid ; "><p>The number of concurrent sessions/consumers to start
            for each listener. Can either be a simple number indicating the
            maximum number (e.g. "5") or a range indicating the lower as well
            as the upper limit (e.g. "3-5"). Note that a specified minimum is
            just a hint and might be ignored at runtime. Default is 1; keep
            concurrency limited to 1 in case of a topic listener or if queue
            ordering is important; consider raising it for general
            queues.</p></td></tr><tr><td style="border-right: 1.0pt solid ; ">prefetch</td><td style=""><p>The maximum number of messages to load into a single
            session. Note that raising this number might lead to starvation of
            concurrent consumers!</p></td></tr></tbody></table></div></div><br class="table-break"><p>Configuring a JCA-based listener container with the "jms" schema
    support is very similar.</p><pre class="programlisting">&lt;<span class="hl-tag">jms:jca-listener-container</span> <span class="hl-attribute">resource-adapter</span>=<span class="hl-value">"myResourceAdapter"</span>
                            <span class="hl-attribute">destination-resolver</span>=<span class="hl-value">"myDestinationResolver"</span>
                            <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"myTransactionManager"</span>
                            <span class="hl-attribute">concurrency</span>=<span class="hl-value">"10"</span>&gt;

    &lt;<span class="hl-tag">jms:listener</span> <span class="hl-attribute">destination</span>=<span class="hl-value">"queue.orders"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myMessageListener"</span>/&gt;

&lt;<span class="hl-tag">/jms:jca-listener-container</span>&gt;</pre><p>The available configuration options for the JCA variant are
    described in the following table:</p><div class="table"><a name="jms-namespace-jca-listener-container-tbl"></a><p class="title"><b>Table&nbsp;22.3.&nbsp;Attributes of the JMS
      <code class="literal">&lt;jca-listener-container/&gt;</code> element</b></p><div class="table-contents"><table summary="Attributes of the JMS&#xA;      <jca-listener-container/&gt; element" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Attribute</th><th style="border-bottom: 1.0pt solid ; ">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">resource-adapter</td><td style="border-bottom: 1.0pt solid ; "><p>A reference to the JCA
            <code class="interfacename">ResourceAdapter</code> bean (the default
            bean name is <code class="literal">'resourceAdapter'</code>).</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">activation-spec-factory</td><td style="border-bottom: 1.0pt solid ; "><p>A reference to the
            <code class="interfacename">JmsActivationSpecFactory</code>. The
            default is to autodetect the JMS provider and its
            <code class="interfacename">ActivationSpec</code> class (see
            <code class="classname">DefaultJmsActivationSpecFactory</code>)</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">destination-resolver</td><td style="border-bottom: 1.0pt solid ; "><p>A reference to the
            <code class="interfacename">DestinationResolver</code> strategy for
            resolving JMS <code class="interfacename">Destinations</code>.
            </p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">message-converter</td><td style="border-bottom: 1.0pt solid ; "><p>A reference to the
            <code class="interfacename">MessageConverter</code> strategy for
            converting JMS Messages to listener method arguments. Default is a
            <code class="classname">SimpleMessageConverter</code>.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">destination-type</td><td style="border-bottom: 1.0pt solid ; "><p>The JMS destination type for this listener:
            <code class="literal">queue</code>, <code class="literal">topic</code> or
            <code class="literal">durableTopic</code>. The default is
            <code class="literal">queue</code>.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">client-id</td><td style="border-bottom: 1.0pt solid ; "><p>The JMS client id for this listener container. Needs
            to be specified when using durable subscriptions.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">acknowledge</td><td style="border-bottom: 1.0pt solid ; "><p>The native JMS acknowledge mode:
            <code class="literal">auto</code>, <code class="literal">client</code>,
            <code class="literal">dups-ok</code> or <code class="literal">transacted</code>. A
            value of <code class="literal">transacted</code> activates a locally
            transacted <code class="interfacename">Session</code>. As an
            alternative, specify the <code class="literal">transaction-manager</code>
            attribute described below. Default is
            <code class="literal">auto</code>.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">transaction-manager</td><td style="border-bottom: 1.0pt solid ; "><p>A reference to a Spring
            <code class="classname">JtaTransactionManager</code> or a
            <code class="interfacename">javax.transaction.TransactionManager</code>
            for kicking off an XA transaction for each incoming message. If
            not specified, native acknowledging will be used (see the
            "acknowledge" attribute).</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">concurrency</td><td style="border-bottom: 1.0pt solid ; "><p>The number of concurrent sessions/consumers to start
            for each listener. Can either be a simple number indicating the
            maximum number (e.g. "5") or a range indicating the lower as well
            as the upper limit (e.g. "3-5"). Note that a specified minimum is
            just a hint and will typically be ignored at runtime when using a
            JCA listener container. Default is 1.</p></td></tr><tr><td style="border-right: 1.0pt solid ; ">prefetch</td><td style=""><p>The maximum number of messages to load into a single
            session. Note that raising this number might lead to starvation of
            concurrent consumers!</p></td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="jmx"></a>23.&nbsp;JMX</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-introduction"></a>23.1&nbsp;Introduction</h2></div></div></div><p>The JMX support in Spring provides you with the features to easily
    and transparently integrate your Spring application into a JMX
    infrastructure.</p><div class="sidebar"><p class="title"><b>JMX?</b></p><p>This chapter is not an introduction to JMX... it doesn't try to
      explain the motivations of why one might want to use JMX (or indeed what
      the letters JMX actually stand for). If you are new to JMX, check out
      <a class="xref" href="#jmx-resources" title="23.8&nbsp;Further Resources">Section&nbsp;23.8, &#8220;Further Resources&#8221;</a> at the end of this chapter.</p></div><p>Specifically, Spring's JMX support provides four core
    features:</p><div class="itemizedlist"><ul type="disc"><li><p>The automatic registration of <span class="emphasis"><em>any</em></span> Spring
        bean as a JMX MBean</p></li><li><p>A flexible mechanism for controlling the management interface of
        your beans</p></li><li><p>The declarative exposure of MBeans over remote, JSR-160
        connectors</p></li><li><p>The simple proxying of both local and remote MBean
        resources</p></li></ul></div><p>These features are designed to work without coupling your
    application components to either Spring or JMX interfaces and classes.
    Indeed, for the most part your application classes need not be aware of
    either Spring or JMX in order to take advantage of the Spring JMX
    features.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-exporting"></a>23.2&nbsp;Exporting your beans to JMX</h2></div></div></div><p>The core class in Spring's JMX framework is the
    <code class="classname">MBeanExporter</code>. This class is responsible for taking
    your Spring beans and registering them with a JMX
    <code class="interfacename">MBeanServer</code>. For example, consider the following
    class:</p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.jmx;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JmxTestBean <span class="hl-keyword">implements</span> IJmxTestBean {

    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;
    <span class="hl-keyword">private</span> <span class="hl-keyword">boolean</span> isSuperman;

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getAge() {
        <span class="hl-keyword">return</span> age;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAge(<span class="hl-keyword">int</span> age) {
        <span class="hl-keyword">this</span>.age = age;
    }
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> add(<span class="hl-keyword">int</span> x, <span class="hl-keyword">int</span> y) {
        <span class="hl-keyword">return</span> x + y;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> dontExposeMe() {
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> RuntimeException();
    }
}</pre><p>To expose the properties and methods of this bean as attributes and
    operations of an MBean you simply configure an instance of the
    <code class="classname">MBeanExporter</code> class in your configuration file and
    pass in the bean as shown below:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-comment">!-- this bean must not be lazily initialized if the exporting is to happen --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span> <span class="hl-attribute">lazy-init</span>=<span class="hl-value">"false"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beans"</span>&gt;
      &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"bean:name=testBean1"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"testBean"</span>/&gt;
      &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.JmxTestBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TEST"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The pertinent bean definition from the above configuration snippet
    is the <code class="literal">exporter</code> bean. The <code class="literal">beans</code>
    property tells the <code class="classname">MBeanExporter</code> exactly which of
    your beans must be exported to the JMX <code class="interfacename">MBeanServer</code>.
    In the default configuration, the key of each entry in the
    <code class="literal">beans</code> <code class="interfacename">Map</code> is used as the
    <code class="classname">ObjectName</code> for the bean referenced by the
    corresponding entry value. This behavior can be changed as described in
    <a class="xref" href="#jmx-naming" title="23.4&nbsp;Controlling the ObjectNames for your beans">Section&nbsp;23.4, &#8220;Controlling the ObjectNames for your beans&#8221;</a>.</p><p>With this configuration the <code class="literal">testBean</code> bean is
    exposed as an MBean under the <code class="classname">ObjectName</code>
    <code class="literal">bean:name=testBean1</code>. By default, all
    <span class="emphasis"><em>public</em></span> properties of the bean are exposed as
    attributes and all <span class="emphasis"><em>public</em></span> methods (bar those
    inherited from the <code class="classname">Object</code> class) are exposed as
    operations.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-exporting-mbeanserver"></a>23.2.1&nbsp;Creating an <code class="interfacename">MBeanServer</code></h3></div></div></div><p>The above configuration assumes that the application is running in
      an environment that has one (and only one)
      <code class="interfacename">MBeanServer</code> already running. In this case, Spring
      will attempt to locate the running <code class="interfacename">MBeanServer</code>
      and register your beans with that server (if any). This behavior is
      useful when your application is running inside a container such as
      Tomcat or IBM WebSphere that has its own
      <code class="interfacename">MBeanServer</code>.</p><p>However, this approach is of no use in a standalone environment,
      or when running inside a container that does not provide an
      <code class="interfacename">MBeanServer</code>. To address this you can create an
      <code class="interfacename">MBeanServer</code> instance declaratively by adding an
      instance of the
      <code class="classname">org.springframework.jmx.support.MBeanServerFactoryBean</code>
      class to your configuration. You can also ensure that a specific
      <code class="interfacename">MBeanServer</code> is used by setting the value of the
      <code class="classname">MBeanExporter</code>'s <code class="literal">server</code>
      property to the <code class="interfacename">MBeanServer</code> value returned by an
      <code class="classname">MBeanServerFactoryBean</code>; for example:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mbeanServer"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.support.MBeanServerFactoryBean"</span>/&gt;

  &lt;<span class="hl-comment">!--
    this bean needs to be eagerly pre-instantiated in order for the exporting to occur;
    this means that it must not be marked as lazily initialized
  --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beans"</span>&gt;
      &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"bean:name=testBean1"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"testBean"</span>/&gt;
      &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"server"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"mbeanServer"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.JmxTestBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TEST"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Here an instance of <code class="interfacename">MBeanServer</code> is created
      by the <code class="classname">MBeanServerFactoryBean</code> and is supplied to
      the <code class="classname">MBeanExporter</code> via the server property. When
      you supply your own <code class="interfacename">MBeanServer</code> instance, the
      <code class="classname">MBeanExporter</code> will not attempt to locate a
      running <code class="interfacename">MBeanServer</code> and will use the supplied
      <code class="interfacename">MBeanServer</code> instance. For this to work correctly,
      you must (of course) have a JMX implementation on your classpath.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-mbean-server"></a>23.2.2&nbsp;Reusing an existing <code class="interfacename">MBeanServer</code></h3></div></div></div><p>If no server is specified, the <code class="classname">MBeanExporter</code>
      tries to automatically detect a running <code class="interfacename">MBeanServer</code>.
      This works in most environment where only one
      <code class="interfacename">MBeanServer</code> instance is used, however when multiple
      instances exist, the exporter might pick the wrong server. In such
      cases, one should use the <code class="interfacename">MBeanServer</code>
      <code class="literal">agentId</code> to indicate which instance to be used:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
   &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mbeanServer"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.support.MBeanServerFactoryBean"</span>&gt;
     &lt;<span class="hl-comment">!-- indicate to first look for a server --</span>&gt;
     &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"locateExistingServerIfPossible"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
     &lt;<span class="hl-comment">!-- search for the MBeanServer instance with the given agentId --</span>&gt;
     &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"agentId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"&lt;MBeanServer instance agentId&gt;"</span>/&gt;
   &lt;<span class="hl-tag">/bean</span>&gt;
   
   &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
     &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"server"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"mbeanServer"</span>/&gt;
   ...
   &lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>For platforms/cases where the existing <code class="interfacename">MBeanServer</code>
      has a dynamic (or unknown) <code class="literal">agentId</code> which is retrieved through lookup
      methods, one should use <a class="link" href="#beans-factory-class-static-factory-method" title="4.3.2.2&nbsp;Instantiation with a static factory method">factory-method</a>:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
   &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
     &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"server"</span>&gt;
       &lt;<span class="hl-comment">!-- Custom MBeanServerLocator --</span>&gt;
       &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"platform.package.MBeanServerLocator"</span> <span class="hl-attribute">factory-method</span>=<span class="hl-value">"locateMBeanServer"</span>/&gt;
     &lt;<span class="hl-tag">/property</span>&gt;
     
     &lt;<span class="hl-comment">!-- other beans here --</span>&gt;
     
   &lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-exporting-lazy"></a>23.2.3&nbsp;Lazy-initialized MBeans</h3></div></div></div><p>If you configure a bean with the
      <code class="classname">MBeanExporter</code> that is also configured for lazy
      initialization, then the <code class="classname">MBeanExporter</code> will
      <span class="bold"><strong>not</strong></span> break this contract and will avoid
      instantiating the bean. Instead, it will register a proxy with
      the <code class="interfacename">MBeanServer</code> and will defer obtaining the bean
      from the container until the first invocation on the proxy occurs.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-exporting-auto"></a>23.2.4&nbsp;Automatic registration of MBeans</h3></div></div></div><p>Any beans that are exported through the
      <code class="classname">MBeanExporter</code> and are already valid MBeans are
      registered as-is with the <code class="interfacename">MBeanServer</code> without
      further intervention from Spring. MBeans can be automatically detected
      by the <code class="classname">MBeanExporter</code> by setting the
      <code class="literal">autodetect</code> property to <code class="literal">true</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"autodetect"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"spring:mbean=true"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.TestDynamicMBean"</span>/&gt;</pre><p>Here, the bean called <code class="literal">spring:mbean=true</code> is
      already a valid JMX MBean and will be automatically registered by
      Spring. By default, beans that are autodetected for JMX registration
      have their bean name used as the <code class="classname">ObjectName</code>. This
      behavior can be overridden as detailed in <a class="xref" href="#jmx-naming" title="23.4&nbsp;Controlling the ObjectNames for your beans">Section&nbsp;23.4, &#8220;Controlling the ObjectNames for your beans&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-exporting-registration-behavior"></a>23.2.5&nbsp;Controlling the registration behavior</h3></div></div></div><p>Consider the scenario where a Spring
      <code class="classname">MBeanExporter</code> attempts to register an
      <code class="classname">MBean</code> with an <code class="interfacename">MBeanServer</code>
      using the <code class="classname">ObjectName</code>
      <code class="literal">'bean:name=testBean1'</code>. If an
      <code class="classname">MBean</code> instance has already been registered under
      that same <code class="classname">ObjectName</code>, the default behavior is to
      fail (and throw an
      <code class="exceptionname">InstanceAlreadyExistsException</code>).</p><p>It is possible to control the behavior of exactly what happens
      when an <code class="classname">MBean</code> is registered with an
      <code class="interfacename">MBeanServer</code>. Spring's JMX support allows for
      three different registration behaviors to control the registration
      behavior when the registration process finds that an
      <code class="classname">MBean</code> has already been registered under the same
      <code class="classname">ObjectName</code>; these registration behaviors are
      summarized on the following table:</p><div class="table"><a name="jmx-registration-behaviors"></a><p class="title"><b>Table&nbsp;23.1.&nbsp;Registration Behaviors</b></p><div class="table-contents"><table summary="Registration Behaviors" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="left"><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Registration behavior</th><th style="border-bottom: 1.0pt solid ; " align="center">Explanation</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="literal">REGISTRATION_FAIL_ON_EXISTING</code></p></td><td style="border-bottom: 1.0pt solid ; "><p> This is the default registration behavior. If an
                <code class="classname">MBean</code> instance has already been
                registered under the same <code class="classname">ObjectName</code>,
                the <code class="classname">MBean</code> that is being registered will
                not be registered and an
                <code class="exceptionname">InstanceAlreadyExistsException</code> will be
                thrown. The existing <code class="classname">MBean</code> is
                unaffected. </p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><p><code class="literal">REGISTRATION_IGNORE_EXISTING</code></p></td><td style="border-bottom: 1.0pt solid ; "><p> If an <code class="classname">MBean</code> instance has
                already been registered under the same
                <code class="classname">ObjectName</code>, the
                <code class="classname">MBean</code> that is being registered will
                <span class="emphasis"><em>not</em></span> be registered. The existing
                <code class="classname">MBean</code> is unaffected, and no
                <code class="exceptionname">Exception</code> will be thrown. </p>
                <p> This is useful in settings where multiple applications
                want to share a common <code class="classname">MBean</code> in a
                shared <code class="interfacename">MBeanServer</code>. </p></td></tr><tr><td style="border-right: 1.0pt solid ; " align="left"><p><code class="literal">REGISTRATION_REPLACE_EXISTING</code></p></td><td style=""><p> If an <code class="classname">MBean</code> instance has
                already been registered under the same
                <code class="classname">ObjectName</code>, the existing
                <code class="classname">MBean</code> that was previously registered
                will be unregistered and the new <code class="classname">MBean</code>
                will be registered in its place (the new
                <code class="classname">MBean</code> effectively replaces the previous
                instance). </p></td></tr></tbody></table></div></div><br class="table-break"><p>The above values are defined as constants on the
      <code class="classname">MBeanRegistrationSupport</code> class (the
      <code class="classname">MBeanExporter</code> class derives from this
      superclass). If you want to change the default registration behavior,
      you simply need to set the value of the
      <code class="literal">registrationBehaviorName</code> property on your
      <code class="classname">MBeanExporter</code> definition to one of those
      values.</p><p>The following example illustrates how to effect a change from the
      default registration behavior to the
      <code class="literal">REGISTRATION_REPLACE_EXISTING</code> behavior:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beans"</span>&gt;
            &lt;<span class="hl-tag">map</span>&gt;
                &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"bean:name=testBean1"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"testBean"</span>/&gt;
            &lt;<span class="hl-tag">/map</span>&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"registrationBehaviorName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"REGISTRATION_REPLACE_EXISTING"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.JmxTestBean"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TEST"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-interface"></a>23.3&nbsp;Controlling the management interface of your beans</h2></div></div></div><p>In the previous example, you had little control over the management
    interface of your bean; <span class="emphasis"><em>all</em></span> of the
    <span class="emphasis"><em>public</em></span> properties and methods of each exported bean
    was exposed as JMX attributes and operations respectively. To exercise
    finer-grained control over exactly which properties and methods of your
    exported beans are actually exposed as JMX attributes and operations,
    Spring JMX provides a comprehensive and extensible mechanism for
    controlling the management interfaces of your beans.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-interface-assembler"></a>23.3.1&nbsp;The <code class="interfacename">MBeanInfoAssembler</code>
      Interface</h3></div></div></div><p>Behind the scenes, the <code class="classname">MBeanExporter</code>
      delegates to an implementation of the
      <code class="classname">org.springframework.jmx.export.assembler.MBeanInfoAssembler</code>
      interface which is responsible for defining the management interface of
      each bean that is being exposed. The default implementation,
      <code class="classname">org.springframework.jmx.export.assembler.SimpleReflectiveMBeanInfoAssembler</code>,
      simply defines a management interface that exposes all public properties
      and methods (as you saw in the previous examples). Spring provides two
      additional implementations of the
      <code class="interfacename">MBeanInfoAssembler</code> interface that allow
      you to control the generated management interface using either
      source-level metadata or any arbitrary interface.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-interface-metadata"></a>23.3.2&nbsp;Using Source-Level Metadata (JDK 5.0 annotations)</h3></div></div></div><p>Using the <code class="classname">MetadataMBeanInfoAssembler</code> you
      can define the management interfaces for your beans using source level
      metadata. The reading of metadata is encapsulated by the
      <code class="classname">org.springframework.jmx.export.metadata.JmxAttributeSource</code>
      interface. Spring JMX provides a default implementation which uses JDK 5.0 annotations, namely
      <code class="classname">org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource</code>. The
      <code class="classname">MetadataMBeanInfoAssembler</code>
      <span class="emphasis"><em>must</em></span> be configured with an implementation instance
      of the <code class="classname">JmxAttributeSource</code> interface for it to
      function correctly (there is <span class="emphasis"><em>no</em></span> default).</p><p>To mark a bean for export to JMX, you should annotate the bean
      class with the <code class="classname">ManagedResource</code> annotation. Each
      method you wish to expose as an operation must be marked with the
      <code class="classname">ManagedOperation</code> annotation and each property you
      wish to expose must be marked with the
      <code class="classname">ManagedAttribute</code> annotation. When marking
      properties you can omit either the annotation of the getter or the
      setter to create a write-only or read-only attribute
      respectively.</p><p>The example below shows the annotated version of the 
        <code class="classname">JmxTestBean</code> class that you saw earlier:</p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.jmx;

<span class="hl-keyword">import</span> org.springframework.jmx.export.annotation.ManagedResource;
<span class="hl-keyword">import</span> org.springframework.jmx.export.annotation.ManagedOperation;
<span class="hl-keyword">import</span> org.springframework.jmx.export.annotation.ManagedAttribute;

@ManagedResource(objectName=<span class="hl-string">"bean:name=testBean4"</span>, description=<span class="hl-string">"My Managed Bean"</span>, log=true,
    logFile=<span class="hl-string">"jmx.log"</span>, currencyTimeLimit=15, persistPolicy=<span class="hl-string">"OnUpdate"</span>, persistPeriod=200,
    persistLocation=<span class="hl-string">"foo"</span>, persistName=<span class="hl-string">"bar"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AnnotationTestBean <span class="hl-keyword">implements</span> IJmxTestBean {

  <span class="hl-keyword">private</span> String name;
  <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;

  @ManagedAttribute(description=<span class="hl-string">"The Age Attribute"</span>, currencyTimeLimit=15)
  <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getAge() {
    <span class="hl-keyword">return</span> age;
  }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAge(<span class="hl-keyword">int</span> age) {
    <span class="hl-keyword">this</span>.age = age;
  }

  @ManagedAttribute(description=<span class="hl-string">"The Name Attribute"</span>,
      currencyTimeLimit=20,
      defaultValue=<span class="hl-string">"bar"</span>,
      persistPolicy=<span class="hl-string">"OnUpdate"</span>)
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
    <span class="hl-keyword">this</span>.name = name;
  }

  @ManagedAttribute(defaultValue=<span class="hl-string">"foo"</span>, persistPeriod=300)
  <span class="hl-keyword">public</span> String getName() {
    <span class="hl-keyword">return</span> name;
  }

  @ManagedOperation(description=<span class="hl-string">"Add two numbers"</span>)
  @ManagedOperationParameters({
    @ManagedOperationParameter(name = <span class="hl-string">"x"</span>, description = <span class="hl-string">"The first number"</span>),
    @ManagedOperationParameter(name = <span class="hl-string">"y"</span>, description = <span class="hl-string">"The second number"</span>)})
  <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> add(<span class="hl-keyword">int</span> x, <span class="hl-keyword">int</span> y) {
    <span class="hl-keyword">return</span> x + y;
  }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> dontExposeMe() {
    <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> RuntimeException();
  }
}</pre><p>Here you can see that the <code class="classname">JmxTestBean</code> class
      is marked with the <code class="classname">ManagedResource</code> annotation and
        that this <code class="classname">ManagedResource</code> annotation is configured
      with a set of properties. These properties can be used to configure
      various aspects of the MBean that is generated by the
      <code class="classname">MBeanExporter</code>, and are explained in greater
      detail later in section entitled <a class="xref" href="#jmx-interface-metadata-types" title="23.3.3&nbsp;Source-Level Metadata Types">Section&nbsp;23.3.3, &#8220;Source-Level Metadata Types&#8221;</a>.</p><p>You will also notice that both the <code class="literal">age</code> and
      <code class="literal">name</code> properties are annotated with the
      <code class="classname">ManagedAttribute</code> annotation, but in the case of
      the <code class="literal">age</code> property, only the getter is marked. This
      will cause both of these properties to be included in the management
      interface as attributes, but the <code class="literal">age</code> attribute will
      be read-only.</p><p>Finally, you will notice that the <code class="literal">add(int, int)</code>
      method is marked with the <code class="classname">ManagedOperation</code>
      attribute whereas the <code class="literal">dontExposeMe()</code> method is not.
      This will cause the management interface to contain only one operation,
      <code class="literal">add(int, int)</code>, when using the
      <code class="classname">MetadataMBeanInfoAssembler</code>.</p><p>The configuration below shows how you configure the
      <code class="classname">MBeanExporter</code> to use the
      <code class="classname">MetadataMBeanInfoAssembler</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"assembler"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"assembler"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"namingStrategy"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"namingStrategy"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"autodetect"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jmxAttributeSource"</span>
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource"</span>/&gt;

    &lt;<span class="hl-comment">!-- will create management interface using annotation metadata --</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"assembler"</span>
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"attributeSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"jmxAttributeSource"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

    &lt;<span class="hl-comment">!-- will pick up the ObjectName from the annotation --</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"namingStrategy"</span>
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.naming.MetadataNamingStrategy"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"attributeSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"jmxAttributeSource"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.AnnotationTestBean"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TEST"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Here you can see that an
      <code class="classname">MetadataMBeanInfoAssembler</code> bean has been
      configured with an instance of the
        <code class="classname">AnnotationJmxAttributeSource</code> class and passed to
      the <code class="classname">MBeanExporter</code> through the assembler property.
      This is all that is required to take advantage of metadata-driven
      management interfaces for your Spring-exposed MBeans.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-interface-metadata-types"></a>23.3.3&nbsp;Source-Level Metadata Types</h3></div></div></div><p>The following source level metadata types are available for use in
      Spring JMX:</p><div class="table"><a name="jmx-metadata-types"></a><p class="title"><b>Table&nbsp;23.2.&nbsp;Source-Level Metadata Types</b></p><div class="table-contents"><table summary="Source-Level Metadata Types" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="left"><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Purpose</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Annotation</th><th style="border-bottom: 1.0pt solid ; " align="center">Annotation Type</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Mark all instances of a <code class="classname">Class</code> as
                JMX managed resources</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">@ManagedResource</code></td><td style="border-bottom: 1.0pt solid ; ">Class</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Mark a method as a JMX operation</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">@ManagedOperation</code></td><td style="border-bottom: 1.0pt solid ; ">Method</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left">Mark a getter or setter as one half of a JMX
                attribute</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="classname">@ManagedAttribute</code></td><td style="border-bottom: 1.0pt solid ; ">Method (only getters and setters)</td></tr><tr><td style="border-right: 1.0pt solid ; " align="left">Define descriptions for operation parameters</td><td style="border-right: 1.0pt solid ; "><code class="classname">@ManagedOperationParameter</code> and
                <code class="classname">@ManagedOperationParameters</code></td><td style="">Method</td></tr></tbody></table></div></div><p><br class="table-break"></p><p>The following configuration parameters are available for use on
      these source-level metadata types:</p><div class="table"><a name="jmx-metadata-parameters"></a><p class="title"><b>Table&nbsp;23.3.&nbsp;Source-Level Metadata Parameters</b></p><div class="table-contents"><table summary="Source-Level Metadata Parameters" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="left"><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Parameter</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Description</th><th style="border-bottom: 1.0pt solid ; " align="center">Applies to</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="classname">ObjectName</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Used by <code class="classname">MetadataNamingStrategy</code>
                to determine the <code class="classname">ObjectName</code> of a
                managed resource</td><td style="border-bottom: 1.0pt solid ; "><code class="classname">ManagedResource</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">description</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Sets the friendly description of the resource,
                attribute or operation</td><td style="border-bottom: 1.0pt solid ; "><code class="classname">ManagedResource</code>,
                <code class="classname">ManagedAttribute</code>,
                <code class="classname">ManagedOperation</code>,
                <code class="classname">ManagedOperationParameter</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">currencyTimeLimit</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Sets the value of the
                <code class="literal">currencyTimeLimit</code> descriptor field</td><td style="border-bottom: 1.0pt solid ; "><code class="classname">ManagedResource</code>,
                <code class="classname">ManagedAttribute</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">defaultValue</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Sets the value of the <code class="literal">defaultValue</code>
                descriptor field</td><td style="border-bottom: 1.0pt solid ; "><code class="classname">ManagedAttribute</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">log</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Sets the value of the <code class="literal">log</code> descriptor
                field</td><td style="border-bottom: 1.0pt solid ; "><code class="classname">ManagedResource</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">logFile</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Sets the value of the <code class="literal">logFile</code>
                descriptor field</td><td style="border-bottom: 1.0pt solid ; "><code class="classname">ManagedResource</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">persistPolicy</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Sets the value of the <code class="literal">persistPolicy</code>
                descriptor field</td><td style="border-bottom: 1.0pt solid ; "><code class="classname">ManagedResource</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">persistPeriod</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Sets the value of the <code class="literal">persistPeriod</code>
                descriptor field</td><td style="border-bottom: 1.0pt solid ; "><code class="classname">ManagedResource</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">persistLocation</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Sets the value of the
                <code class="literal">persistLocation</code> descriptor field</td><td style="border-bottom: 1.0pt solid ; "><code class="classname">ManagedResource</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">persistName</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Sets the value of the <code class="literal">persistName</code>
                descriptor field</td><td style="border-bottom: 1.0pt solid ; "><code class="classname">ManagedResource</code></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="left"><code class="literal">name</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Sets the display name of an operation parameter</td><td style="border-bottom: 1.0pt solid ; "><code class="literal">ManagedOperationParameter</code></td></tr><tr><td style="border-right: 1.0pt solid ; " align="left"><code class="literal">index</code></td><td style="border-right: 1.0pt solid ; ">Sets the index of an operation parameter</td><td style=""><code class="literal">ManagedOperationParameter</code></td></tr></tbody></table></div></div><p><br class="table-break"></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-interface-autodetect"></a>23.3.4&nbsp;The <code class="classname">AutodetectCapableMBeanInfoAssembler</code>
      interface</h3></div></div></div><p>To simplify configuration even further, Spring introduces the
      <code class="classname">AutodetectCapableMBeanInfoAssembler</code> interface
      which extends the <code class="interfacename">MBeanInfoAssembler</code>
      interface to add support for autodetection of MBean resources. If you
      configure the <code class="classname">MBeanExporter</code> with an instance of
      <code class="classname">AutodetectCapableMBeanInfoAssembler</code> then it is
      allowed to "vote" on the inclusion of beans for exposure to JMX.</p><p>Out of the box, the only implementation of the
      <code class="classname">AutodetectCapableMBeanInfo</code> interface is the
      <code class="classname">MetadataMBeanInfoAssembler</code> which will vote to
      include any bean which is marked with the
      <code class="classname">ManagedResource</code> attribute. The default approach
      in this case is to use the bean name as the
      <code class="classname">ObjectName</code> which results in a configuration like
      this:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
    &lt;<span class="hl-comment">!-- notice how no 'beans' are explicitly configured here --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"autodetect"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"assembler"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"assembler"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.JmxTestBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TEST"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"assembler"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"attributeSource"</span>&gt;
        &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource"</span>/&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Notice that in this configuration no beans are passed to the
      <code class="classname">MBeanExporter</code>; however, the
      <code class="classname">JmxTestBean</code> will still be registered since it is
      marked with the <code class="classname">ManagedResource</code> attribute and the
      <code class="classname">MetadataMBeanInfoAssembler</code> detects this and votes
      to include it. The only problem with this approach is that the name of
      the <code class="classname">JmxTestBean</code> now has business meaning. You can
      address this issue by changing the default behavior for
      <code class="classname">ObjectName</code> creation as defined in
      <a class="xref" href="#jmx-naming" title="23.4&nbsp;Controlling the ObjectNames for your beans">Section&nbsp;23.4, &#8220;Controlling the ObjectNames for your beans&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-interface-java"></a>23.3.5&nbsp;Defining management interfaces using Java interfaces</h3></div></div></div><p>In addition to the
      <code class="classname">MetadataMBeanInfoAssembler</code>, Spring also includes
      the <code class="classname">InterfaceBasedMBeanInfoAssembler</code> which allows
      you to constrain the methods and properties that are exposed based on
      the set of methods defined in a collection of interfaces.</p><p>Although the standard mechanism for exposing MBeans is to use
      interfaces and a simple naming scheme, the
      <code class="classname">InterfaceBasedMBeanInfoAssembler</code> extends this
      functionality by removing the need for naming conventions, allowing you
      to use more than one interface and removing the need for your beans to
      implement the MBean interfaces.</p><p>Consider this interface that is used to define a management
      interface for the <code class="classname">JmxTestBean</code> class that you saw
      earlier:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IJmxTestBean {

  <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> add(<span class="hl-keyword">int</span> x, <span class="hl-keyword">int</span> y);

  <span class="hl-keyword">public</span> <span class="hl-keyword">long</span> myOperation();

  <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getAge();

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAge(<span class="hl-keyword">int</span> age);

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name);

  <span class="hl-keyword">public</span> String getName();
}</pre><p>This interface defines the methods and properties that will be
      exposed as operations and attributes on the JMX MBean. The code below
      shows how to configure Spring JMX to use this interface as the
      definition for the management interface:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beans"</span>&gt;
      &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"bean:name=testBean5"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"testBean"</span>/&gt;
      &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"assembler"</span>&gt;
      &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.assembler.InterfaceBasedMBeanInfoAssembler"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"managedInterfaces"</span>&gt;
          &lt;<span class="hl-tag">value</span>&gt;org.springframework.jmx.IJmxTestBean&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
      &lt;<span class="hl-tag">/bean</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.JmxTestBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TEST"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>Here you can see that the
      <code class="classname">InterfaceBasedMBeanInfoAssembler</code> is configured to
      use the <code class="interfacename">IJmxTestBean</code> interface when
      constructing the management interface for any bean. It is important to
      understand that beans processed by the
      <code class="classname">InterfaceBasedMBeanInfoAssembler</code> are
      <span class="emphasis"><em>not</em></span> required to implement the interface used to
      generate the JMX management interface.</p><p>In the case above, the <code class="interfacename">IJmxTestBean</code>
      interface is used to construct all management interfaces for all beans.
      In many cases this is not the desired behavior and you may want to use
      different interfaces for different beans. In this case, you can pass
      <code class="classname">InterfaceBasedMBeanInfoAssembler</code> a
      <code class="classname">Properties</code> instance via the
      <code class="literal">interfaceMappings</code> property, where the key of each
      entry is the bean name and the value of each entry is a comma-separated
      list of interface names to use for that bean.</p><p>If no management interface is specified through either the
      <code class="literal">managedInterfaces</code> or
      <code class="literal">interfaceMappings</code> properties, then the
      <code class="classname">InterfaceBasedMBeanInfoAssembler</code> will reflect on
      the bean and use all of the interfaces implemented by that bean to
      create the management interface.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-interface-methodnames"></a>23.3.6&nbsp;Using
      <code class="classname">MethodNameBasedMBeanInfoAssembler</code></h3></div></div></div><p>The <code class="classname">MethodNameBasedMBeanInfoAssembler</code>
      allows you to specify a list of method names that will be exposed to JMX
      as attributes and operations. The code below shows a sample
      configuration for this:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beans"</span>&gt;
      &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"bean:name=testBean5"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"testBean"</span>/&gt;
      &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"assembler"</span>&gt;
      &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.assembler.MethodNameBasedMBeanInfoAssembler"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"managedMethods"</span>&gt;
          &lt;<span class="hl-tag">value</span>&gt;add,myOperation,getName,setName,getAge&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">/property</span>&gt;
      &lt;<span class="hl-tag">/bean</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Here you can see that the methods <code class="literal">add</code> and
      <code class="literal">myOperation</code> will be exposed as JMX operations and
      <code class="literal">getName()</code>, <code class="literal">setName(String)</code> and
      <code class="literal">getAge()</code> will be exposed as the appropriate half of a
      JMX attribute. In the code above, the method mappings apply to beans
      that are exposed to JMX. To control method exposure on a bean-by-bean
      basis, use the <code class="literal">methodMappings</code> property of
      <code class="classname">MethodNameMBeanInfoAssembler</code> to map bean names to
      lists of method names.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-naming"></a>23.4&nbsp;Controlling the <code class="classname">ObjectName</code>s for your beans</h2></div></div></div><p>Behind the scenes, the <code class="classname">MBeanExporter</code>
    delegates to an implementation of the
    <code class="classname">ObjectNamingStrategy</code> to obtain
    <code class="classname">ObjectName</code>s for each of the beans it is
    registering. The default implementation,
    <code class="classname">KeyNamingStrategy</code>, will, by default, use the key of
    the <code class="literal">beans</code> <code class="interfacename">Map</code> as the
    <code class="classname">ObjectName</code>. In addition, the
    <code class="classname">KeyNamingStrategy</code> can map the key of the
    <code class="literal">beans</code> <code class="interfacename">Map</code> to an entry in a
    <code class="classname">Properties</code> file (or files) to resolve the
    <code class="classname">ObjectName</code>. In addition to the
    <code class="classname">KeyNamingStrategy</code>, Spring provides two additional
    <code class="classname">ObjectNamingStrategy</code> implementations: the
    <code class="classname">IdentityNamingStrategy</code> that builds an
    <code class="classname">ObjectName</code> based on the JVM identity of the bean
    and the <code class="classname">MetadataNamingStrategy</code> that uses source
    level metadata to obtain the <code class="classname">ObjectName</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-naming-properties"></a>23.4.1&nbsp;Reading <code class="classname">ObjectName</code>s from <code class="classname">Properties</code></h3></div></div></div><p>You can configure your own
      <code class="classname">KeyNamingStrategy</code> instance and configure it to
      read <code class="classname">ObjectName</code>s from a
      <code class="classname">Properties</code> instance rather than use bean key. The
      <code class="classname">KeyNamingStrategy</code> will attempt to locate an entry
      in the <code class="classname">Properties</code> with a key corresponding to the
      bean key. If no entry is found or if the
      <code class="classname">Properties</code> instance is <code class="literal">null</code>
      then the bean key itself is used.</p><p>The code below shows a sample configuration for the
      <code class="classname">KeyNamingStrategy</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beans"</span>&gt;
      &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"testBean"</span>/&gt;
      &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"namingStrategy"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"namingStrategy"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.JmxTestBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TEST"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"namingStrategy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.naming.KeyNamingStrategy"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappings"</span>&gt;
      &lt;<span class="hl-tag">props</span>&gt;
        &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"testBean"</span>&gt;bean:name=testBean1&lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">/props</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappingLocations"</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;names1.properties,names2.properties&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean

&lt;/beans</span>&gt;</pre><p>Here an instance of <code class="classname">KeyNamingStrategy</code> is
      configured with a <code class="classname">Properties</code> instance that is
      merged from the <code class="classname">Properties</code> instance defined by
      the mapping property and the properties files located in the paths
      defined by the mappings property. In this configuration, the
      <code class="literal">testBean</code> bean will be given the
      <code class="classname">ObjectName</code> <code class="literal">bean:name=testBean1</code>
      since this is the entry in the <code class="classname">Properties</code>
      instance that has a key corresponding to the bean key.</p><p>If no entry in the <code class="classname">Properties</code> instance can
      be found then the bean key name is used as the
      <code class="classname">ObjectName</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-naming-metadata"></a>23.4.2&nbsp;Using the <code class="classname">MetadataNamingStrategy</code></h3></div></div></div><p>The <code class="classname">MetadataNamingStrategy</code> uses
      the <code class="literal">objectName</code> property of the
      <code class="classname">ManagedResource</code> attribute on each bean to create
      the <code class="classname">ObjectName</code>. The code below shows the
      configuration for the
      <code class="classname">MetadataNamingStrategy</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beans"</span>&gt;
      &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"testBean"</span>/&gt;
      &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"namingStrategy"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"namingStrategy"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.JmxTestBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TEST"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"namingStrategy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.naming.MetadataNamingStrategy"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"attributeSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"attributeSource"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"attributeSource"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.metadata.AttributesJmxAttributeSource"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>If no <code class="literal">objectName</code> has been provided for
      the <code class="classname">ManagedResource</code> attribute, then an
      <code class="classname">ObjectName</code> will be created with the
      following format:
      <span class="emphasis"><em>[fully-qualified-package-name]:type=[short-classname],name=[bean-name]</em></span>.
      For example, the generated <code class="classname">ObjectName</code> for the
      following bean would be: <span class="emphasis"><em>com.foo:type=MyClass,name=myBean</em></span>.
      </p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.MyClass"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-context-mbeanexport"></a>23.4.3&nbsp;The <code class="literal">&lt;context:mbean-export/&gt;</code> element</h3></div></div></div><p>If you are using at least Java 5, then a convenience subclass of
      <code class="classname">MBeanExporter</code> is available:
      <code class="classname">AnnotationMBeanExporter</code>.
      When defining an instance of this subclass, the <code class="literal">namingStrategy</code>,
      <code class="literal">assembler</code>, and <code class="literal">attributeSource</code>
      configuration is no longer needed, since it will always use standard Java
      annotation-based metadata (autodetection is always enabled as well). In fact,
      an even simpler syntax is supported by Spring's
      '<code class="literal">context</code>' namespace.. Rather than defining an
      <code class="classname">MBeanExporter</code> bean, just provide this single element:</p><pre class="programlisting">&lt;<span class="hl-tag">context:mbean-export</span>/&gt;</pre><p>You can provide a reference to a particular MBean server if
      necessary, and the <code class="literal">defaultDomain</code> attribute
      (a property of <code class="classname">AnnotationMBeanExporter</code>)
      accepts an alternate value for the generated MBean
      <code class="classname">ObjectNames</code>' domains. This would be used
      in place of the fully qualified package name as described in the
      previous section on
      <a class="link" href="#jmx-naming-metadata" title="23.4.2&nbsp;Using the MetadataNamingStrategy"><code class="classname">MetadataNamingStrategy</code></a>.
      </p><pre class="programlisting">&lt;<span class="hl-tag">context:mbean-export</span> <span class="hl-attribute">server</span>=<span class="hl-value">"myMBeanServer"</span> <span class="hl-attribute">default-domain</span>=<span class="hl-value">"myDomain"</span>/&gt;</pre>.

      <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Do not use interface-based AOP proxies in combination with autodetection of
        JMX annotations in your bean classes. Interface-based proxies 'hide' the target class,
        which also hides the JMX managed resource annotations. Hence, use target-class proxies
        in that case: through setting the 'proxy-target-class' flag on <code class="literal">&lt;aop:config/&gt;</code>,
        <code class="literal">&lt;tx:annotation-driven/&gt;</code>, etc. Otherwise, your JMX beans
        might be silently ignored at startup...</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-jsr160"></a>23.5&nbsp;JSR-160 Connectors</h2></div></div></div><p>For remote access, Spring JMX module offers two
    <code class="classname">FactoryBean</code> implementations inside the
    <code class="literal">org.springframework.jmx.support</code> package for creating
    both server- and client-side connectors.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-jsr160-server"></a>23.5.1&nbsp;Server-side Connectors</h3></div></div></div><p>To have Spring JMX create, start and expose a JSR-160
      <code class="classname">JMXConnectorServer</code> use the following
      configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serverConnector"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.support.ConnectorServerFactoryBean"</span>/&gt;</pre><p>By default <code class="literal">ConnectorServerFactoryBean</code> creates a
      <code class="classname">JMXConnectorServer</code> bound to
      <code class="literal">"service:jmx:jmxmp://localhost:9875"</code>. The
      <code class="literal">serverConnector</code> bean thus exposes the local
      <code class="interfacename">MBeanServer</code> to clients through the JMXMP protocol
      on localhost, port 9875. Note that the JMXMP protocol is marked as
      optional by the JSR 160 specification: currently, the main open-source
      JMX implementation, MX4J, and the one provided with J2SE 5.0 do
      <span class="emphasis"><em>not</em></span> support JMXMP.</p><p>To specify another URL and register the
      <code class="classname">JMXConnectorServer</code> itself with the
      <code class="interfacename">MBeanServer</code> use the <code class="literal">serviceUrl</code>
      and <code class="classname">ObjectName</code> properties respectively:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serverConnector"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.support.ConnectorServerFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"objectName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"connector:name=rmi"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceUrl"</span> 
            <span class="hl-attribute">value</span>=<span class="hl-value">"service:jmx:rmi://localhost/jndi/rmi://localhost:1099/myconnector"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>If the <code class="classname">ObjectName</code> property is set Spring
      will automatically register your connector with the
      <code class="interfacename">MBeanServer</code> under that
      <code class="classname">ObjectName</code>. The example below shows the full set
      of parameters which you can pass to the
      <code class="classname">ConnectorServerFactoryBean</code> when creating a
      JMXConnector:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serverConnector"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.support.ConnectorServerFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"objectName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"connector:name=iiop"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceUrl"</span> 
               <span class="hl-attribute">value</span>=<span class="hl-value">"service:jmx:iiop://localhost/jndi/iiop://localhost:900/myconnector"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"threaded"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"daemon"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"environment"</span>&gt;
    &lt;<span class="hl-tag">map</span>&gt;
      &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"someKey"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"someValue"</span>/&gt;
    &lt;<span class="hl-tag">/map</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Note that when using a RMI-based connector you need the lookup
      service (tnameserv or rmiregistry) to be started in order for the name
      registration to complete. If you are using Spring to export remote
      services for you via RMI, then Spring will already have constructed an
      RMI registry. If not, you can easily start a registry using the
      following snippet of configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"registry"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.remoting.rmi.RmiRegistryFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"port"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1099"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-jsr160-client"></a>23.5.2&nbsp;Client-side Connectors</h3></div></div></div><p>To create an <code class="classname">MBeanServerConnection</code> to a
      remote JSR-160 enabled <code class="interfacename">MBeanServer</code> use the
      <code class="classname">MBeanServerConnectionFactoryBean</code> as shown
      below:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"clientConnector"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.support.MBeanServerConnectionFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceUrl"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"service:jmx:rmi://localhost/jndi/rmi://localhost:1099/jmxrmi"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-jsr160-protocols"></a>23.5.3&nbsp;JMX over Burlap/Hessian/SOAP</h3></div></div></div><p>JSR-160 permits extensions to the way in which communication is
      done between the client and the server. The examples above are using the
      mandatory RMI-based implementation required by the JSR-160 specification
      (IIOP and JRMP) and the (optional) JMXMP. By using other providers or
      JMX implementations (such as <a class="ulink" href="http://mx4j.sourceforge.net" target="_top">MX4J</a>) you can take advantage
      of protocols like SOAP, Hessian, Burlap over simple HTTP or SSL and
      others:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serverConnector"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.support.ConnectorServerFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"objectName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"connector:name=burlap"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceUrl"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"service:jmx:burlap://localhost:9874"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>In the case of the above example, MX4J 3.0.0 was used; see the
      official MX4J documentation for more information.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-proxy"></a>23.6&nbsp;Accessing MBeans via Proxies</h2></div></div></div><p>Spring JMX allows you to create proxies that re-route calls to
    MBeans registered in a local or remote <code class="interfacename">MBeanServer</code>.
    These proxies provide you with a standard Java interface through which you
    can interact with your MBeans. The code below shows how to configure a
    proxy for an MBean running in a local
    <code class="interfacename">MBeanServer</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"proxy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.access.MBeanProxyFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"objectName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"bean:name=testBean"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"proxyInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.jmx.IJmxTestBean"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Here you can see that a proxy is created for the MBean registered
    under the <code class="classname">ObjectName</code>:
    <code class="literal">bean:name=testBean</code>. The set of interfaces that the
    proxy will implement is controlled by the
    <code class="literal">proxyInterfaces</code> property and the rules for mapping
    methods and properties on these interfaces to operations and attributes on
    the MBean are the same rules used by the
    <code class="classname">InterfaceBasedMBeanInfoAssembler</code>.</p><p>The <code class="classname">MBeanProxyFactoryBean</code> can create a proxy
    to any MBean that is accessible via an
    <code class="classname">MBeanServerConnection</code>. By default, the local
    <code class="interfacename">MBeanServer</code> is located and used, but you can
    override this and provide an <code class="classname">MBeanServerConnection</code>
    pointing to a remote <code class="interfacename">MBeanServer</code> to cater for
    proxies pointing to remote MBeans:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"clientConnector"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.support.MBeanServerConnectionFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serviceUrl"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"service:jmx:rmi://remotehost:9875"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"proxy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.access.MBeanProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"objectName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"bean:name=testBean"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"proxyInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.jmx.IJmxTestBean"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"server"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"clientConnector"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Here you can see that we create an
    <code class="classname">MBeanServerConnection</code> pointing to a remote machine
    using the <code class="classname">MBeanServerConnectionFactoryBean</code>. This
    <code class="classname">MBeanServerConnection</code> is then passed to the
    <code class="classname">MBeanProxyFactoryBean</code> via the
    <code class="literal">server</code> property. The proxy that is created will forward
    all invocations to the <code class="interfacename">MBeanServer</code> via this
    <code class="classname">MBeanServerConnection</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-notifications"></a>23.7&nbsp;Notifications</h2></div></div></div><p>Spring's JMX offering includes comprehensive support for JMX
    notifications.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-notifications-listeners"></a>23.7.1&nbsp;Registering Listeners for Notifications</h3></div></div></div><p>Spring's JMX support makes it very easy to register any number of
      <code class="classname">NotificationListeners</code> with any number of MBeans
      (this includes MBeans exported by Spring's
      <code class="classname">MBeanExporter</code> and MBeans registered via some
      other mechanism). By way of an example, consider the scenario where one
	  would like to be informed (via a <code class="classname">Notification</code>)
	  each and every time an attribute of a target MBean changes.</p><pre class="programlisting"><span class="hl-keyword">package</span> com.example;

<span class="hl-keyword">import</span> javax.management.AttributeChangeNotification;
<span class="hl-keyword">import</span> javax.management.Notification;
<span class="hl-keyword">import</span> javax.management.NotificationFilter;
<span class="hl-keyword">import</span> javax.management.NotificationListener;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConsoleLoggingNotificationListener
               <span class="hl-keyword">implements</span> NotificationListener, NotificationFilter {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> handleNotification(Notification notification, Object handback) {
        System.out.println(notification);
        System.out.println(handback);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> isNotificationEnabled(Notification notification) {
        <span class="hl-keyword">return</span> AttributeChangeNotification.<span class="hl-keyword">class</span>.isAssignableFrom(notification.getClass());
    }
}</pre><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beans"</span>&gt;
      &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"bean:name=testBean1"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"testBean"</span>/&gt;
      &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"notificationListenerMappings"</span>&gt;
      &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"bean:name=testBean1"</span>&gt;
          &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.ConsoleLoggingNotificationListener"</span>/&gt;
        &lt;<span class="hl-tag">/entry</span>&gt;
      &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.JmxTestBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TEST"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>With the above configuration in place, every time a JMX
		<code class="classname">Notification</code> is broadcast from the target MBean
		(<code class="literal">bean:name=testBean1</code>), the
		<code class="classname">ConsoleLoggingNotificationListener</code> bean that was
		registered as a listener via the
		<code class="literal">notificationListenerMappings</code> property will be
		notified. The <code class="classname">ConsoleLoggingNotificationListener</code>
		bean can then take whatever action it deems appropriate in response to
		the <code class="classname">Notification</code>.</p><p>You can also use straight bean names as the link between exported beans
		and listeners:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beans"</span>&gt;
      &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"bean:name=testBean1"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"testBean"</span>/&gt;
      &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"notificationListenerMappings"</span>&gt;
      &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"testBean"</span>&gt;
          &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.ConsoleLoggingNotificationListener"</span>/&gt;
        &lt;<span class="hl-tag">/entry</span>&gt;
      &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.JmxTestBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TEST"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>If one wants to register a single <code class="classname">NotificationListener</code>
		instance for all of the beans that the enclosing <code class="classname">MBeanExporter</code>
		is exporting, one can use the special wildcard <code class="literal">'*'</code> (sans quotes)
		as the key for an entry in the <code class="literal">notificationListenerMappings</code>
		property map; for example:</p><pre class="programlisting">&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"notificationListenerMappings"</span>&gt;
  &lt;<span class="hl-tag">map</span>&gt;
    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"*"</span>&gt;
      &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.ConsoleLoggingNotificationListener"</span>/&gt;
    &lt;<span class="hl-tag">/entry</span>&gt;
  &lt;<span class="hl-tag">/map</span>&gt;
&lt;<span class="hl-tag">/property</span>&gt;</pre><p>If one needs to do the inverse (that is, register a number of distinct
      listeners against an MBean), then one has to use the
      <code class="literal">notificationListeners</code> list property instead (and in
      preference to the <code class="literal">notificationListenerMappings</code>
      property). This time, instead of configuring simply a
      <code class="classname">NotificationListener</code> for a single MBean, one
      configures <code class="classname">NotificationListenerBean</code> instances...
      a <code class="classname">NotificationListenerBean</code> encapsulates a
      <code class="classname">NotificationListener</code> and the
      <code class="classname">ObjectName</code> (or
      <code class="classname">ObjectNames</code>) that it is to be registered against
      in an <code class="interfacename">MBeanServer</code>. The
      <code class="classname">NotificationListenerBean</code> also encapsulates a
      number of other properties such as a
      <code class="classname">NotificationFilter</code> and an arbitrary handback
      object that can be used in advanced JMX notification scenarios.</p><p>The configuration when using
      <code class="classname">NotificationListenerBean</code> instances is not wildly
      different to what was presented previously:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beans"</span>&gt;
      &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"bean:name=testBean1"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"testBean"</span>/&gt;
      &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"notificationListeners"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.NotificationListenerBean"</span>&gt;
                &lt;<span class="hl-tag">constructor-arg</span>&gt;
                    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.ConsoleLoggingNotificationListener"</span>/&gt;
                &lt;<span class="hl-tag">/constructor-arg</span>&gt;
                &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappedObjectNames"</span>&gt;
                    &lt;<span class="hl-tag">list</span>&gt;
                        &lt;<span class="hl-tag">value</span>&gt;bean:name=testBean1&lt;<span class="hl-tag">/value</span>&gt;
                    &lt;<span class="hl-tag">/list</span>&gt;
                &lt;<span class="hl-tag">/property</span>&gt;
            &lt;<span class="hl-tag">/bean</span>&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.JmxTestBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TEST"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The above example is equivalent to the first notification example.
      Lets assume then that we want to be given a handback object every time a
      <code class="classname">Notification</code> is raised, and that additionally we
      want to filter out extraneous <code class="classname">Notifications</code> by
      supplying a <code class="classname">NotificationFilter</code>. (For a full
      discussion of just what a handback object is, and indeed what a
      <code class="classname">NotificationFilter</code> is, please do consult that
      section of the JMX specification (1.2) entitled <code class="literal">'The JMX
      Notification Model'</code>.)</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exporter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.MBeanExporter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beans"</span>&gt;
      &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"bean:name=testBean1"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"testBean1"</span>/&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"bean:name=testBean2"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"testBean2"</span>/&gt;
      &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"notificationListeners"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.export.NotificationListenerBean"</span>&gt;
                &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"customerNotificationListener"</span>/&gt;
                &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappedObjectNames"</span>&gt;
                    &lt;<span class="hl-tag">list</span>&gt;
                        &lt;<span class="hl-comment">!-- handles notifications from two distinct MBeans --</span>&gt;
                        &lt;<span class="hl-tag">value</span>&gt;bean:name=testBean1&lt;<span class="hl-tag">/value</span>&gt;
                        &lt;<span class="hl-tag">value</span>&gt;bean:name=testBean2&lt;<span class="hl-tag">/value</span>&gt;
                    &lt;<span class="hl-tag">/list</span>&gt;
                &lt;<span class="hl-tag">/property</span>&gt;
                &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"handback"</span>&gt;
                    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"java.lang.String"</span>&gt;
                        &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">"This could be anything..."</span>/&gt;
                    &lt;<span class="hl-tag">/bean</span>&gt;
                &lt;<span class="hl-tag">/property</span>&gt;
                &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"notificationFilter"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"customerNotificationListener"</span>/&gt;
            &lt;<span class="hl-tag">/bean</span>&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;
  
  &lt;<span class="hl-comment">!-- implements both the NotificationListener and NotificationFilter interfaces --</span>&gt;
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"customerNotificationListener"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.ConsoleLoggingNotificationListener"</span>/&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean1"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.JmxTestBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TEST"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean2"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jmx.JmxTestBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"ANOTHER TEST"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"200"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jmx-notifications-publishing"></a>23.7.2&nbsp;Publishing Notifications</h3></div></div></div><p>Spring provides support not just for registering to receive
      <code class="classname">Notifications</code>, but also for publishing
      <code class="classname">Notifications</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Please note that this section is really only relevant to Spring
        managed beans that have been exposed as MBeans via an
        <code class="classname">MBeanExporter</code>; any existing, user-defined
        MBeans should use the standard JMX APIs for notification publication.</p></td></tr></table></div><p>The key interface in Spring's JMX notification publication support
      is the <code class="classname">NotificationPublisher</code> interface (defined
      in the <code class="literal">org.springframework.jmx.export.notification</code>
      package). Any bean that is going to be exported as an MBean via an
      <code class="classname">MBeanExporter</code> instance can implement the related
      <code class="classname">NotificationPublisherAware</code> interface to gain
      access to a <code class="classname">NotificationPublisher</code> instance. The
      <code class="classname">NotificationPublisherAware</code> interface simply
      supplies an instance of a <code class="classname">NotificationPublisher</code>
      to the implementing bean via a simple setter method, which the bean can
      then use to publish <code class="classname">Notifications</code>.</p><p>As stated in the Javadoc for the
      <code class="classname">NotificationPublisher</code> class, managed beans that
      are publishing events via the
      <code class="classname">NotificationPublisher</code> mechanism are
      <span class="emphasis"><em>not</em></span> responsible for the state management of any
      notification listeners and the like ... Spring's JMX support will take
      care of handling all the JMX infrastructure issues. All one need do as
      an application developer is implement the
      <code class="classname">NotificationPublisherAware</code> interface and start
      publishing events using the supplied
      <code class="classname">NotificationPublisher</code> instance. Note that the
      <code class="classname">NotificationPublisher</code> will be set
      <span class="emphasis"><em>after</em></span> the managed bean has been registered with an
      <code class="interfacename">MBeanServer</code>.</p><p>Using a <code class="classname">NotificationPublisher</code> instance is
      quite straightforward... one simply creates a JMX
      <code class="classname">Notification</code> instance (or an instance of an
      appropriate <code class="classname">Notification</code> subclass), populates
      the notification with the data pertinent to the event that is to be
      published, and one then invokes the
      <code class="methodname">sendNotification(Notification)</code> on the
      <code class="classname">NotificationPublisher</code> instance, passing in the
      <code class="classname">Notification</code>.</p><p>Find below a simple example... in this scenario, exported
      instances of the <code class="classname">JmxTestBean</code> are going to publish
      a <code class="classname">NotificationEvent</code> every time the
      <code class="literal">add(int, int)</code> operation is invoked.</p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.jmx;
			
<span class="hl-keyword">import</span> org.springframework.jmx.export.notification.NotificationPublisherAware;
<span class="hl-keyword">import</span> org.springframework.jmx.export.notification.NotificationPublisher;
<span class="hl-keyword">import</span> javax.management.Notification;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JmxTestBean <span class="hl-keyword">implements</span> IJmxTestBean, NotificationPublisherAware {

    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;
    <span class="hl-keyword">private</span> <span class="hl-keyword">boolean</span> isSuperman;
    <span class="hl-keyword">private</span> NotificationPublisher publisher;

    <span class="hl-comment">// other getters and setters omitted for clarity</span>

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> add(<span class="hl-keyword">int</span> x, <span class="hl-keyword">int</span> y) {
        <span class="hl-keyword">int</span> answer = x + y;
        <span class="hl-keyword">this</span>.publisher.sendNotification(<span class="hl-keyword">new</span> Notification(<span class="hl-string">"add"</span>, <span class="hl-keyword">this</span>, 0));
        <span class="hl-keyword">return</span> answer;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> dontExposeMe() {
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> RuntimeException();
    }
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setNotificationPublisher(NotificationPublisher notificationPublisher) {
        <span class="hl-keyword">this</span>.publisher = notificationPublisher;
    }
}</pre><p>The <code class="classname">NotificationPublisher</code> interface and the
      machinery to get it all working is one of the nicer features of Spring's JMX support.
	  It does however come with the price tag of coupling your classes to both Spring and JMX; as
	  always, the advice here is to be pragmatic... if you need the functionality offered by the
      <code class="classname">NotificationPublisher</code> and you can accept the coupling to both Spring
	  and JMX, then do so.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jmx-resources"></a>23.8&nbsp;Further Resources</h2></div></div></div><p>This section contains links to further resources about JMX.</p><div class="itemizedlist"><ul type="disc"><li><p>The <a class="ulink" href="http://java.sun.com/products/JavaManagement/" target="_top">JMX homepage</a> at Sun</p></li><li><p>The <a class="ulink" href="http://jcp.org/aboutJava/communityprocess/final/jsr003/index3.html" target="_top">JMX specification</a> (JSR-000003)</p></li><li><p>The <a class="ulink" href="http://jcp.org/aboutJava/communityprocess/final/jsr160/index.html" target="_top">JMX Remote API specification</a> (JSR-000160)</p></li><li><p>The <a class="ulink" href="http://mx4j.sourceforge.net/" target="_top">MX4J
        homepage</a> (an Open Source implementation of various JMX
        specs)</p></li><li><p><a class="ulink" href="http://java.sun.com/developer/technicalArticles/J2SE/jmx.html" target="_top">Getting Started with JMX</a> - an introductory article from Sun.</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="cci"></a>24.&nbsp;JCA CCI</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cci-introduction"></a>24.1&nbsp;Introduction</h2></div></div></div><p>Java EE provides a specification to standardize access to enterprise
    information systems (EIS): the JCA (J2EE Connector Architecture). This
    specification is divided into several different parts:</p><div class="itemizedlist"><ul type="disc"><li><p>SPI (Service provider interfaces) that the connector provider
        must implement. These interfaces constitute a resource adapter which
        can be deployed on a Java EE application server. In such a scenario, the
        server manages connection pooling, transaction and security (managed
        mode). The application server is also responsible for managing the
        configuration, which is held outside the client application. A
        connector can be used without an application server as well; in this
        case, the application must configure it directly (non-managed
        mode).</p></li><li><p>CCI (Common Client Interface) that an application can use to
        interact with the connector and thus communicate with an EIS. An API
        for local transaction demarcation is provided as well.</p></li></ul></div><p>The aim of the Spring CCI support is to provide classes to access a
    CCI connector in typical Spring style, leveraging the Spring Framework's
    general resource and transaction management facilities.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The client side of connectors doesn't alway use CCI. Some
      connectors expose their own APIs, only providing JCA resource adapter to
      use the system contracts of a Java EE container (connection pooling, global
      transactions, security). Spring does not offer special support for such
      connector-specific APIs.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cci-config"></a>24.2&nbsp;Configuring CCI</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-config-connector"></a>24.2.1&nbsp;Connector configuration</h3></div></div></div><p>The base resource to use JCA CCI is the
      <code class="interfacename">ConnectionFactory</code> interface. The
      connector used must provide an implementation of this interface.</p><p>To use your connector, you can deploy it on your application
      server and fetch the <code class="interfacename">ConnectionFactory</code>
      from the server's JNDI environment (managed mode). The connector must be
      packaged as a RAR file (resource adapter archive) and contain a
      <code class="filename">ra.xml</code> file to describe its deployment
      characteristics. The actual name of the resource is specified when you
      deploy it. To access it within Spring, simply use Spring's
      <code class="classname">JndiObjectFactoryBean</code> /
      <code class="literal">&lt;jee:jndi-lookup&gt;</code> fetch the factory by its JNDI
      name.</p><p>Another way to use a connector is to embed it in your application
      (non-managed mode), not using an application server to deploy and
      configure it. Spring offers the possibility to configure a connector as
      a bean, through a provided <code class="literal">FactoryBean</code>
      (<code class="classname">LocalConnectionFactoryBean</code>). In this manner, you
      only need the connector library in the classpath (no RAR file and no
      <code class="filename">ra.xml</code> descriptor needed). The library must be
      extracted from the connector's RAR file, if necessary.</p><p>Once you have got access to your
      <code class="interfacename">ConnectionFactory</code> instance, you can
      inject it into your components. These components can either be coded
      against the plain CCI API or leverage Spring's support classes for CCI
      access (e.g. <code class="classname">CciTemplate</code>).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>When you use a connector in non-managed mode, you can't use
        global transactions because the resource is never enlisted / delisted
        in the current global transaction of the current thread. The resource
        is simply not aware of any global Java EE transactions that might be
        running.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-config-connectionfactory"></a>24.2.2&nbsp;<code class="interfacename">ConnectionFactory</code> configuration in
      Spring</h3></div></div></div><p>In order to make connections to the EIS, you need to obtain a
      <code class="interfacename">ConnectionFactory</code> from the application
      server if you are in a managed mode, or directly from Spring if you are
      in a non-managed mode.</p><p>In a managed mode, you access a
      <code class="interfacename">ConnectionFactory</code> from JNDI; its
      properties will be configured in the application server.</p><pre class="programlisting">&lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"eciConnectionFactory"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"eis/cicseci"</span>/&gt;</pre><p>In non-managed mode, you must configure the
      <code class="interfacename">ConnectionFactory</code> you want to use in the
      configuration of Spring as a JavaBean. The
      <code class="classname">LocalConnectionFactoryBean</code> class offers this
      setup style, passing in the
      <code class="classname">ManagedConnectionFactory</code> implementation of your
      connector, exposing the application-level CCI
      <code class="interfacename">ConnectionFactory</code>.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"eciManagedConnectionFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.ibm.connector2.cics.ECIManagedConnectionFactory"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serverName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TXSERIES"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionURL"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"tcp://localhost/"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"portNumber"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"2006"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"eciConnectionFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.support.LocalConnectionFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"managedConnectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"eciManagedConnectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can't directly instantiate a specific
        <code class="interfacename">ConnectionFactory</code>. You need to go
        through the corresponding implementation of the
        <code class="classname">ManagedConnectionFactory</code> interface for your
        connector. This interface is part of the JCA SPI specification.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-config-cci-connections"></a>24.2.3&nbsp;Configuring CCI connections</h3></div></div></div><p>JCA CCI allow the developer to configure the connections to the
      EIS using the <code class="interfacename">ConnectionSpec</code>
      implementation of your connector. In order to configure its properties,
      you need to wrap the target connection factory with a dedicated adapter,
      <code class="classname">ConnectionSpecConnectionFactoryAdapter</code>. So, the
      dedicated <code class="interfacename">ConnectionSpec</code> can be
      configured with the property <code class="literal">connectionSpec</code> (as an
      inner bean).</p><p>This property is not mandatory because the CCI
      <code class="interfacename">ConnectionFactory</code> interface defines two
      different methods to obtain a CCI connection. Some of the
      <code class="interfacename">ConnectionSpec</code> properties can often be
      configured in the application server (in managed mode) or on the
      corresponding local <code class="classname">ManagedConnectionFactory</code>
      implementation.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConnectionFactory <span class="hl-keyword">implements</span> Serializable, Referenceable {
  ...
  Connection getConnection() <span class="hl-keyword">throws</span> ResourceException;
  Connection getConnection(ConnectionSpec connectionSpec) <span class="hl-keyword">throws</span> ResourceException;
  ...
}</pre><p>Spring provides a
      <code class="classname">ConnectionSpecConnectionFactoryAdapter</code> that
      allows for specifying a <code class="interfacename">ConnectionSpec</code>
      instance to use for all operations on a given factory. If the adapter's
      <code class="literal">connectionSpec</code> property is specified, the adapter
      uses the <code class="literal">getConnection</code> variant without argument, else
      the one with the <code class="interfacename">ConnectionSpec</code>
      argument.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"managedConnectionFactory"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"com.sun.connector.cciblackbox.CciLocalTxManagedConnectionFactory"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionURL"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc:hsqldb:hsql://localhost:9001"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.hsqldb.jdbcDriver"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"targetConnectionFactory"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.support.LocalConnectionFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"managedConnectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"managedConnectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"connectionFactory"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetConnectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"targetConnectionFactory"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionSpec"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.sun.connector.cciblackbox.CciConnectionSpec"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"user"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"sa"</span>/&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">""</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-config-single-connection"></a>24.2.4&nbsp;Using a single CCI connection</h3></div></div></div><p>If you want to use a single CCI connection, Spring provides a
      further <code class="interfacename">ConnectionFactory</code> adapter to
      manage this. The <code class="classname">SingleConnectionFactory</code> adapter
      class will open a single connection lazily and close it when this bean
      is destroyed at application shutdown. This class will expose special
      <code class="interfacename">Connection</code> proxies that behave
      accordingly, all sharing the same underlying physical connection.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"eciManagedConnectionFactory"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"com.ibm.connector2.cics.ECIManagedConnectionFactory"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serverName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TEST"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionURL"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"tcp://localhost/"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"portNumber"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"2006"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"targetEciConnectionFactory"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.support.LocalConnectionFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"managedConnectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"eciManagedConnectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"eciConnectionFactory"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.cci.connection.SingleConnectionFactory"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetConnectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"targetEciConnectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>This <code class="interfacename">ConnectionFactory</code> adapter
        cannot directly be configured with a
        <code class="interfacename">ConnectionSpec</code>. Use an intermediary
        <code class="classname">ConnectionSpecConnectionFactoryAdapter</code> that the
        <code class="classname">SingleConnectionFactory</code> talks to if you require
        a single connection for a specific
        <code class="interfacename">ConnectionSpec</code>.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cci-using"></a>24.3&nbsp;Using Spring's CCI access support</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-record-creator"></a>24.3.1&nbsp;Record conversion</h3></div></div></div><p>One of the aims of the JCA CCI support is to provide convenient
      facilities for manipulating CCI records. The developer can specify the
      strategy to create records and extract datas from records, for use with
      Spring's <code class="classname">CciTemplate</code>. The following interfaces
      will configure the strategy to use input and output records if you don't
      want to work with records directly in your application.</p><p>In order to create an input <code class="interfacename">Record</code>,
      the developer can use a dedicated implementation of the
      <code class="interfacename">RecordCreator</code> interface.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> RecordCreator {

  Record createRecord(RecordFactory recordFactory) <span class="hl-keyword">throws</span> ResourceException, DataAccessException;
}</pre><p>As you can see, the <code class="literal">createRecord(..)</code> method
      receives a <code class="interfacename">RecordFactory</code> instance as
      parameter, which corresponds to the
      <code class="interfacename">RecordFactory</code> of the
      <code class="interfacename">ConnectionFactory</code> used. This reference
      can be used to create <code class="interfacename">IndexedRecord</code> or
      <code class="interfacename">MappedRecord</code> instances. The following
      sample shows how to use the <code class="interfacename">RecordCreator</code>
      interface and indexed/mapped records.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyRecordCreator <span class="hl-keyword">implements</span> RecordCreator {

  <span class="hl-keyword">public</span> Record createRecord(RecordFactory recordFactory) <span class="hl-keyword">throws</span> ResourceException {
    IndexedRecord input = recordFactory.createIndexedRecord(<span class="hl-string">"input"</span>);
    input.add(<span class="hl-keyword">new</span> Integer(id));
    <span class="hl-keyword">return</span> input;
  }
}</pre><p>An output <code class="interfacename">Record</code> can be used to
      receive data back from the EIS. Hence, a specific implementation of the
      <code class="interfacename">RecordExtractor</code> interface can be passed
      to Spring's <code class="classname">CciTemplate</code> for extracting data from
      the output <code class="interfacename">Record</code>.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> RecordExtractor {

  Object extractData(Record record) <span class="hl-keyword">throws</span> ResourceException, SQLException, DataAccessException;
}</pre><p>The following sample shows how to use the
      <code class="interfacename">RecordExtractor</code> interface.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyRecordExtractor <span class="hl-keyword">implements</span> RecordExtractor {

  <span class="hl-keyword">public</span> Object extractData(Record record) <span class="hl-keyword">throws</span> ResourceException {
    CommAreaRecord commAreaRecord = (CommAreaRecord) record;
    String str = <span class="hl-keyword">new</span> String(commAreaRecord.toByteArray());
    String field1 = string.substring(0,6);
    String field2 = string.substring(6,1);
    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> OutputObject(Long.parseLong(field1), field2);
  }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-using-template"></a>24.3.2&nbsp;The <code class="classname">CciTemplate</code></h3></div></div></div><p>The <code class="classname">CciTemplate</code> is the central class of the
      core CCI support package
      (<code class="literal">org.springframework.jca.cci.core</code>). It simplifies the
      use of CCI since it handles the creation and release of resources. This
      helps to avoid common errors like forgetting to always close the
      connection. It cares for the lifecycle of connection and interaction
      objects, letting application code focus on generating input records from
      application data and extracting application data from output
      records.</p><p>The JCA CCI specification defines two distinct methods to call
      operations on an EIS. The CCI <code class="interfacename">Interaction</code>
      interface provides two execute method signatures:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> javax.resource.cci.Interaction {
  ...
  <span class="hl-keyword">boolean</span> execute(InteractionSpec spec, Record input, Record output) <span class="hl-keyword">throws</span> ResourceException;

  Record execute(InteractionSpec spec, Record input) <span class="hl-keyword">throws</span> ResourceException;
  ...
}</pre><p>Depending on the template method called,
      <code class="classname">CciTemplate</code> will know which
      <code class="literal">execute</code> method to call on the interaction. In any
      case, a correctly initialized
      <code class="interfacename">InteractionSpec</code> instance is
      mandatory.</p><p><code class="literal">CciTemplate.execute(..)</code> can be used in two
      ways:</p><div class="itemizedlist"><ul type="disc"><li><p>With direct <code class="interfacename">Record</code> arguments.
          In this case, you simply need to pass the CCI input record in, and
          the returned object be the corresponding CCI output record.</p></li><li><p>With application objects, using record mapping. In this case,
          you need to provide corresponding
          <code class="interfacename">RecordCreator</code> and
          <code class="interfacename">RecordExtractor</code> instances.</p></li></ul></div><p>With the first approach, the following methods of the template
      will be used. These methods directly correspond to those on the
      <code class="interfacename">Interaction</code> interface.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CciTemplate <span class="hl-keyword">implements</span> CciOperations {

  <span class="hl-keyword">public</span> Record execute(InteractionSpec spec, Record inputRecord)
      <span class="hl-keyword">throws</span> DataAccessException { ... }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> execute(InteractionSpec spec, Record inputRecord, Record outputRecord)
      <span class="hl-keyword">throws</span> DataAccessException { ... }

}</pre><p>With the second approach, we need to specify the record creation
      and record extraction strategies as arguments. The interfaces used are
      those describe in the previous section on record conversion. The
      corresponding <code class="classname">CciTemplate</code> methods are the
      following:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CciTemplate <span class="hl-keyword">implements</span> CciOperations {

  <span class="hl-keyword">public</span> Record execute(InteractionSpec spec, RecordCreator inputCreator)
      <span class="hl-keyword">throws</span> DataAccessException { ... }

  <span class="hl-keyword">public</span> Object execute(InteractionSpec spec, Record inputRecord, RecordExtractor outputExtractor)
      <span class="hl-keyword">throws</span> DataAccessException { ... }

  <span class="hl-keyword">public</span> Object execute(InteractionSpec spec, RecordCreator creator, RecordExtractor extractor)
      <span class="hl-keyword">throws</span> DataAccessException { ... }

}</pre><p>Unless the <code class="literal">outputRecordCreator</code> property is set
      on the template (see the following section), every method will call the
      corresponding <code class="literal">execute</code> method of the CCI
      <code class="interfacename">Interaction</code> with two parameters:
      <code class="interfacename">InteractionSpec</code> and input
      <code class="interfacename">Record</code>, receiving an output
      <code class="interfacename">Record</code> as return value.</p><p><code class="classname">CciTemplate</code> also provides methods to create
      <code class="literal">IndexRecord</code> and <code class="literal">MappedRecord</code>
      outside a <code class="interfacename">RecordCreator</code> implementation,
      through its <code class="literal">createIndexRecord(..)</code> and
      <code class="literal">createMappedRecord(..)</code> methods. This can be used
      within DAO implementations to create
      <code class="interfacename">Record</code> instances to pass into
      corresponding <code class="literal">CciTemplate.execute(..)</code> methods.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CciTemplate <span class="hl-keyword">implements</span> CciOperations {

  <span class="hl-keyword">public</span> IndexedRecord createIndexedRecord(String name) <span class="hl-keyword">throws</span> DataAccessException { ... }

  <span class="hl-keyword">public</span> MappedRecord createMappedRecord(String name) <span class="hl-keyword">throws</span> DataAccessException { ... }

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-using-dao"></a>24.3.3&nbsp;DAO support</h3></div></div></div><p>Spring's CCI support provides a abstract class for DAOs,
      supporting injection of a
      <code class="interfacename">ConnectionFactory</code> or a
      <code class="classname">CciTemplate</code> instances. The name of the class is
      <code class="classname">CciDaoSupport</code>: It provides simple
      <code class="literal">setConnectionFactory</code> and
      <code class="literal">setCciTemplate</code> methods. Internally, this class will
      create a <code class="classname">CciTemplate</code> instance for a passed-in
      <code class="interfacename">ConnectionFactory</code>, exposing it to
      concrete data access implementations in subclasses.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> CciDaoSupport {

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setConnectionFactory(ConnectionFactory connectionFactory) { ... }
  <span class="hl-keyword">public</span> ConnectionFactory getConnectionFactory() { ... }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setCciTemplate(CciTemplate cciTemplate) { ... }
  <span class="hl-keyword">public</span> CciTemplate getCciTemplate() { ... }

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="automatic-output-generation"></a>24.3.4&nbsp;Automatic output record generation</h3></div></div></div><p>If the connector used only supports the
      <code class="methodname">Interaction.execute(..)</code> method with input and
      output records as parameters (that is, it requires the desired output
      record to be passed in instead of returning an appropriate output
      record), you can set the <code class="literal">outputRecordCreator</code> property
      of the <code class="classname">CciTemplate</code> to automatically generate an
      output record to be filled by the JCA connector when the response is
      received. This record will be then returned to the caller of the
      template.</p><p>This property simply holds an implementation of the
      <code class="interfacename">RecordCreator</code> interface, used for that
      purpose. The <code class="interfacename">RecordCreator</code> interface has
      already been discussed in <a class="xref" href="#cci-record-creator" title="24.3.1&nbsp;Record conversion">Section&nbsp;24.3.1, &#8220;Record conversion&#8221;</a>. The
      <code class="literal">outputRecordCreator</code> property must be directly
      specified on the <code class="classname">CciTemplate</code>. This could be done
      in the application code like so:</p><pre class="programlisting">cciTemplate.setOutputRecordCreator(<span class="hl-keyword">new</span> EciOutputRecordCreator());</pre><p>Or (recommended) in the Spring configuration, if the
      <code class="classname">CciTemplate</code> is configured as a dedicated bean
      instance:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"eciOutputRecordCreator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"eci.EciOutputRecordCreator"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"cciTemplate"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.cci.core.CciTemplate"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"eciConnectionFactory"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"outputRecordCreator"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"eciOutputRecordCreator"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>As the <code class="classname">CciTemplate</code> class is thread-safe,
        it will usually be configured as a shared instance.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="template-summary"></a>24.3.5&nbsp;Summary</h3></div></div></div><p>The following table summarizes the mechanisms of the
      <code class="classname">CciTemplate</code> class and the corresponding methods
      called on the CCI <code class="interfacename">Interaction</code>
      interface:</p><div class="table"><a name="cci-interaction-execute-methods"></a><p class="title"><b>Table&nbsp;24.1.&nbsp;Usage of <code class="interfacename">Interaction</code> execute
          methods</b></p><div class="table-contents"><table summary="Usage of Interaction execute&#xA;          methods" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">CciTemplate method signature</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">CciTemplate outputRecordCreator
                property</th><th style="border-bottom: 1.0pt solid ; " align="center">execute method called on the CCI
                Interaction</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Record execute(InteractionSpec,
                Record)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">not set</td><td style="border-bottom: 1.0pt solid ; " align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Record execute(InteractionSpec,
                Record)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">set</td><td style="border-bottom: 1.0pt solid ; " align="center">boolean execute(InteractionSpec, Record,
                Record)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">void execute(InteractionSpec, Record,
                Record)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">not set</td><td style="border-bottom: 1.0pt solid ; " align="center">void execute(InteractionSpec, Record,
                Record)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">void execute(InteractionSpec, Record,
                Record)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">set</td><td style="border-bottom: 1.0pt solid ; " align="center">void execute(InteractionSpec, Record,
                Record)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Record execute(InteractionSpec,
                RecordCreator)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">not set</td><td style="border-bottom: 1.0pt solid ; " align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Record execute(InteractionSpec,
                RecordCreator)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">set</td><td style="border-bottom: 1.0pt solid ; " align="center">void execute(InteractionSpec, Record,
                Record)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Record execute(InteractionSpec, Record,
                RecordExtractor)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">not set</td><td style="border-bottom: 1.0pt solid ; " align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Record execute(InteractionSpec, Record,
                RecordExtractor)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">set</td><td style="border-bottom: 1.0pt solid ; " align="center">void execute(InteractionSpec, Record,
                Record)</td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Record execute(InteractionSpec,
                RecordCreator, RecordExtractor)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">not set</td><td style="border-bottom: 1.0pt solid ; " align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">Record execute(InteractionSpec,
                RecordCreator, RecordExtractor)</td><td style="border-right: 1.0pt solid ; " align="center">set</td><td style="" align="center">void execute(InteractionSpec, Record,
                Record)</td></tr></tbody></table></div></div><p><br class="table-break"></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-straight"></a>24.3.6&nbsp;Using a CCI <code class="interfacename">Connection</code> and
      <code class="interfacename">Interaction</code> directly</h3></div></div></div><p><code class="classname">CciTemplate</code> also offers the possibility to
      work directly with CCI connections and interactions, in the same manner
      as <code class="classname">JdbcTemplate</code> and
      <code class="classname">JmsTemplate</code>. This is useful when you want to
      perform multiple operations on a CCI connection or interaction, for
      example.</p><p>The interface <code class="interfacename">ConnectionCallback</code>
      provides a CCI <code class="interfacename">Connection</code> as argument, in
      order to perform custom operations on it, plus the CCI
      <code class="interfacename">ConnectionFactory</code> which the
      <code class="interfacename">Connection</code> was created with. The latter
      can be useful for example to get an associated
      <code class="interfacename">RecordFactory</code> instance and create
      indexed/mapped records, for example.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConnectionCallback {

  Object doInConnection(Connection connection, ConnectionFactory connectionFactory)
      <span class="hl-keyword">throws</span> ResourceException, SQLException, DataAccessException;
}</pre><p>The interface <code class="interfacename">InteractionCallback</code>
      provides the CCI <code class="interfacename">Interaction</code>, in order to
      perform custom operations on it, plus the corresponding CCI
      <code class="interfacename">ConnectionFactory</code>.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> InteractionCallback {

  Object doInInteraction(Interaction interaction, ConnectionFactory connectionFactory)
      <span class="hl-keyword">throws</span> ResourceException, SQLException, DataAccessException;
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="interfacename">InteractionSpec</code> objects can
        either be shared across multiple template calls or newly created
        inside every callback method. This is completely up to the DAO
        implementation.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-template-example"></a>24.3.7&nbsp;Example for <code class="classname">CciTemplate</code> usage</h3></div></div></div><p>In this section, the usage of the
      <code class="classname">CciTemplate</code> will be shown to acces to a CICS with
      ECI mode, with the IBM CICS ECI connector.</p><p>Firstly, some initializations on the CCI
      <code class="interfacename">InteractionSpec</code> must be done to specify
      which CICS program to access and how to interact with it.</p><pre class="programlisting">ECIInteractionSpec interactionSpec = <span class="hl-keyword">new</span> ECIInteractionSpec();
interactionSpec.setFunctionName(<span class="hl-string">"MYPROG"</span>);
interactionSpec.setInteractionVerb(ECIInteractionSpec.SYNC_SEND_RECEIVE);</pre><p>Then the program can use CCI via Spring's template and specify
      mappings between custom objects and CCI
      <code class="literal">Records</code>.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyDaoImpl <span class="hl-keyword">extends</span> CciDaoSupport <span class="hl-keyword">implements</span> MyDao {

  <span class="hl-keyword">public</span> OutputObject getData(InputObject input) {
    ECIInteractionSpec interactionSpec = ...;

    OutputObject output = (ObjectOutput) getCciTemplate().execute(interactionSpec,
        <span class="hl-keyword">new</span> RecordCreator() {
          <span class="hl-keyword">public</span> Record createRecord(RecordFactory recordFactory) <span class="hl-keyword">throws</span> ResourceException {
            <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> CommAreaRecord(input.toString().getBytes());
          }
        },
        <span class="hl-keyword">new</span> RecordExtractor() {
          <span class="hl-keyword">public</span> Object extractData(Record record) <span class="hl-keyword">throws</span> ResourceException {
            CommAreaRecord commAreaRecord = (CommAreaRecord)record;
            String str = <span class="hl-keyword">new</span> String(commAreaRecord.toByteArray());
            String field1 = string.substring(0,6);
            String field2 = string.substring(6,1);
            <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> OutputObject(Long.parseLong(field1), field2);
          }
        });

    <span class="hl-keyword">return</span> output;
  }
}</pre><p>As discussed previously, callbacks can be used to work directly on
      CCI connections or interactions.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyDaoImpl <span class="hl-keyword">extends</span> CciDaoSupport <span class="hl-keyword">implements</span> MyDao {

  <span class="hl-keyword">public</span> OutputObject getData(InputObject input) {
    ObjectOutput output = (ObjectOutput) getCciTemplate().execute(
        <span class="hl-keyword">new</span> ConnectionCallback() {
          <span class="hl-keyword">public</span> Object doInConnection(Connection connection, ConnectionFactory factory)
              <span class="hl-keyword">throws</span> ResourceException {
              
            <span class="hl-comment">// do something...</span>
          }
        });
    }
    <span class="hl-keyword">return</span> output;
  }
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>With a <code class="interfacename">ConnectionCallback</code>, the
        <code class="interfacename">Connection</code> used will be managed and
        closed by the <code class="classname">CciTemplate</code>, but any interactions
        created on the connection must be managed by the callback
        implementation.</p></td></tr></table></div><p>For a more specific callback, you can implement an
      <code class="interfacename">InteractionCallback</code>. The passed-in
      <code class="interfacename">Interaction</code> will be managed and closed by
      the <code class="classname">CciTemplate</code> in this case.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyDaoImpl <span class="hl-keyword">extends</span> CciDaoSupport <span class="hl-keyword">implements</span> MyDao {

  <span class="hl-keyword">public</span> String getData(String input) {
    ECIInteractionSpec interactionSpec = ...;

    String output = (String) getCciTemplate().execute(interactionSpec,
        <span class="hl-keyword">new</span> InteractionCallback() {
          <span class="hl-keyword">public</span> Object doInInteraction(Interaction interaction, ConnectionFactory factory)
              <span class="hl-keyword">throws</span> ResourceException {
            Record input = <span class="hl-keyword">new</span> CommAreaRecord(inputString.getBytes());
            Record output = <span class="hl-keyword">new</span> CommAreaRecord();
            interaction.execute(holder.getInteractionSpec(), input, output);
            <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> String(output.toByteArray());
          }
        });

    <span class="hl-keyword">return</span> output;
  }
}</pre><p>For the examples above, the corresponding configuration of the
      involved Spring beans could look like this in non-managed mode:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"managedConnectionFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.ibm.connector2.cics.ECIManagedConnectionFactory"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serverName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TXSERIES"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionURL"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"local:"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"userName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"CICSUSER"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"CICS"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.support.LocalConnectionFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"managedConnectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"managedConnectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"component"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mypackage.MyDaoImpl"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"connectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>In managed mode (that is, in a Java EE environment), the
      configuration could look as follows:</p><pre class="programlisting">&lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"eis/cicseci"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"component"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"MyDaoImpl"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"connectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cci-object"></a>24.4&nbsp;Modeling CCI access as operation objects</h2></div></div></div><p>The <code class="literal">org.springframework.jca.cci.object</code> package
    contains support classes that allow you to access the EIS in a different
    style: through reusable operation objects, analogous to Spring's JDBC
    operation objects (see JDBC chapter). This will usually encapsulate the
    CCI API: an application-level input object will be passed to the operation
    object, so it can construct the input record and then convert the received
    record data to an application-level output object and return it.</p><p><span class="emphasis"><em>Note</em></span>: This approach is internally based on the
    <code class="classname">CciTemplate</code> class and the
    <code class="interfacename">RecordCreator</code> /
    <code class="interfacename">RecordExtractor</code> interfaces, reusing the
    machinery of Spring's core CCI support.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-object-mapping-record"></a>24.4.1&nbsp;<code class="classname">MappingRecordOperation</code></h3></div></div></div><p><code class="classname">MappingRecordOperation</code> essentially performs
      the same work as <code class="classname">CciTemplate</code>, but represents a
      specific, pre-configured operation as an object. It provides two
      template methods to specify how to convert an input object to a input
      record, and how to convert an output record to an output object (record
      mapping):</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">createInputRecord(..)</code> to specify how to
          convert an input object to an input
          <code class="interfacename">Record</code></p></li><li><p><code class="literal">extractOutputData(..)</code> to specify how to
          extract an output object from an output
          <code class="interfacename">Record</code></p></li></ul></div><p>Here are the signatures of these methods:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> MappingRecordOperation <span class="hl-keyword">extends</span> EisOperation {
  ...
  <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Record createInputRecord(RecordFactory recordFactory, Object inputObject)
      <span class="hl-keyword">throws</span> ResourceException, DataAccessException { ... }

  <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Object extractOutputData(Record outputRecord)
      <span class="hl-keyword">throws</span> ResourceException, SQLException, DataAccessException { ... }
  ...
}</pre><p>Thereafter, in order to execute an EIS operation, you need to use
      a single execute method, passing in an application-level input object
      and receiving an application-level output object as result:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> MappingRecordOperation <span class="hl-keyword">extends</span> EisOperation {
  ...
  <span class="hl-keyword">public</span> Object execute(Object inputObject) <span class="hl-keyword">throws</span> DataAccessException {
  ...
}</pre><p>As you can see, contrary to the <code class="classname">CciTemplate</code>
      class, this <code class="methodname">execute(..)</code> method does not have an
      <code class="interfacename">InteractionSpec</code> as argument. Instead, the
      <code class="interfacename">InteractionSpec</code> is global to the
      operation. The following constructor must be used to instantiate an
      operation object with a specific
      <code class="interfacename">InteractionSpec</code>:</p><pre class="programlisting">InteractionSpec spec = ...;
MyMappingRecordOperation eisOperation = <span class="hl-keyword">new</span> MyMappingRecordOperation(getConnectionFactory(), spec);
...</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-object-mapping-comm-area"></a>24.4.2&nbsp;<code class="classname">MappingCommAreaOperation</code></h3></div></div></div><p>Some connectors use records based on a COMMAREA which represents
      an array of bytes containing parameters to send to the EIS and data
      returned by it. Spring provides a special operation class for working
      directly on COMMAREA rather than on records. The
      <code class="classname">MappingCommAreaOperation</code> class extends the
      <code class="classname">MappingRecordOperation</code> class to provide such
      special COMMAREA support. It implicitly uses the
      <code class="classname">CommAreaRecord</code> class as input and output record
      type, and provides two new methods to convert an input object into an
      input COMMAREA and the output COMMAREA into an output object.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> MappingCommAreaOperation <span class="hl-keyword">extends</span> MappingRecordOperation {
  ...
  <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">byte</span>[] objectToBytes(Object inObject)
      <span class="hl-keyword">throws</span> IOException, DataAccessException;

  <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Object bytesToObject(<span class="hl-keyword">byte</span>[] bytes)
      <span class="hl-keyword">throws</span> IOException, DataAccessException;
  ...
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-automatic-record-gen"></a>24.4.3&nbsp;Automatic output record generation</h3></div></div></div><p>As every <code class="classname">MappingRecordOperation</code> subclass is
      based on CciTemplate internally, the same way to automatically generate
      output records as with <code class="classname">CciTemplate</code> is available.
      Every operation object provides a corresponding
      <code class="literal">setOutputRecordCreator(..)</code> method. For further
      information, see <a class="xref" href="#automatic-output-generation" title="24.3.4&nbsp;Automatic output record generation">Section&nbsp;24.3.4, &#8220;Automatic output record generation&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-object-summary"></a>24.4.4&nbsp;Summary</h3></div></div></div><p>The operation object approach uses records in the same manner as
      the <code class="classname">CciTemplate</code> class.</p><div class="table"><a name="cci-interaction-methods"></a><p class="title"><b>Table&nbsp;24.2.&nbsp;Usage of Interaction execute methods</b></p><div class="table-contents"><table summary="Usage of Interaction execute methods" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center"><code class="classname">MappingRecordOperation</code>
              method signature</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center"><code class="classname">MappingRecordOperation</code>
              <code class="literal">outputRecordCreator</code> property</th><th style="border-bottom: 1.0pt solid ; " align="center">execute method called on the CCI
              <code class="interfacename">Interaction</code></th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Object execute(Object)</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">not set</td><td style="border-bottom: 1.0pt solid ; " align="center">Record execute(InteractionSpec,
              Record)</td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">Object execute(Object)</td><td style="border-right: 1.0pt solid ; " align="center">set</td><td style="" align="center">boolean execute(InteractionSpec, Record,
              Record)</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-objects-mappring-record-example"></a>24.4.5&nbsp;Example for <code class="classname">MappingRecordOperation</code>
      usage</h3></div></div></div><p>In this section, the usage of the
      <code class="classname">MappingRecordOperation</code> will be shown to access a
      database with the Blackbox CCI connector.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The original version of this connector is provided by the Java EE
        SDK (version 1.3), available from Sun.</p></td></tr></table></div><p>Firstly, some initializations on the CCI
      <code class="interfacename">InteractionSpec</code> must be done to specify
      which SQL request to execute. In this sample, we directly define the way
      to convert the parameters of the request to a CCI record and the way to
      convert the CCI result record to an instance of the
      <code class="classname">Person</code> class.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PersonMappingOperation <span class="hl-keyword">extends</span> MappingRecordOperation {

  <span class="hl-keyword">public</span> PersonMappingOperation(ConnectionFactory connectionFactory) {
    setConnectionFactory(connectionFactory);
    CciInteractionSpec interactionSpec = <span class="hl-keyword">new</span> CciConnectionSpec();
    interactionSpec.setSql(<span class="hl-string">"select * from person where person_id=?"</span>);
    setInteractionSpec(interactionSpec);
  }

  <span class="hl-keyword">protected</span> Record createInputRecord(RecordFactory recordFactory, Object inputObject)
      <span class="hl-keyword">throws</span> ResourceException {
    Integer id = (Integer) inputObject;
    IndexedRecord input = recordFactory.createIndexedRecord(<span class="hl-string">"input"</span>);
    input.add(<span class="hl-keyword">new</span> Integer(id));
    <span class="hl-keyword">return</span> input;
  }

  <span class="hl-keyword">protected</span> Object extractOutputData(Record outputRecord)
      <span class="hl-keyword">throws</span> ResourceException, SQLException {
    ResultSet rs = (ResultSet) outputRecord;
    Person person = null;
    <span class="hl-keyword">if</span> (rs.next()) {
      Person person = <span class="hl-keyword">new</span> Person();
      person.setId(rs.getInt(<span class="hl-string">"person_id"</span>));
      person.setLastName(rs.getString(<span class="hl-string">"person_last_name"</span>));
      person.setFirstName(rs.getString(<span class="hl-string">"person_first_name"</span>));
    }
    <span class="hl-keyword">return</span> person;
  }
}</pre><p>Then the application can execute the operation object, with the
      person identifier as argument. Note that operation object could be set
      up as shared instance, as it is thread-safe.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyDaoImpl <span class="hl-keyword">extends</span> CciDaoSupport <span class="hl-keyword">implements</span> MyDao {

  <span class="hl-keyword">public</span> Person getPerson(<span class="hl-keyword">int</span> id) {
    PersonMappingOperation query = <span class="hl-keyword">new</span> PersonMappingOperation(getConnectionFactory());
    Person person = (Person) query.execute(<span class="hl-keyword">new</span> Integer(id));
    <span class="hl-keyword">return</span> person;
  }
}</pre><p>The corresponding configuration of Spring beans could look as
      follows in non-managed mode:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"managedConnectionFactory"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"com.sun.connector.cciblackbox.CciLocalTxManagedConnectionFactory"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionURL"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc:hsqldb:hsql://localhost:9001"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.hsqldb.jdbcDriver"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"targetConnectionFactory"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.support.LocalConnectionFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"managedConnectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"managedConnectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"connectionFactory"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetConnectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"targetConnectionFactory"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionSpec"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.sun.connector.cciblackbox.CciConnectionSpec"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"user"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"sa"</span>/&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">""</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"component"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"MyDaoImpl"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"connectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>In managed mode (that is, in a Java EE environment), the
      configuration could look as follows:</p><pre class="programlisting">&lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"targetConnectionFactory"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"eis/blackbox"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"connectionFactory"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetConnectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"targetConnectionFactory"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionSpec"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.sun.connector.cciblackbox.CciConnectionSpec"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"user"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"sa"</span>/&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">""</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"component"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"MyDaoImpl"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"connectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-objects-mapping-comm-area-example"></a>24.4.6&nbsp;Example for <code class="classname">MappingCommAreaOperation</code>
      usage</h3></div></div></div><p>In this section, the usage of the
      <code class="classname">MappingCommAreaOperation</code> will be shown: accessing
      a CICS with ECI mode with the IBM CICS ECI connector.</p><p>Firstly, the CCI <code class="interfacename">InteractionSpec</code>
      needs to be initialized to specify which CICS program to access and how
      to interact with it.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> EciMappingOperation <span class="hl-keyword">extends</span> MappingCommAreaOperation {

  <span class="hl-keyword">public</span> EciMappingOperation(ConnectionFactory connectionFactory, String programName) {
    setConnectionFactory(connectionFactory);
    ECIInteractionSpec interactionSpec = <span class="hl-keyword">new</span> ECIInteractionSpec(),
    interactionSpec.setFunctionName(programName);
    interactionSpec.setInteractionVerb(ECIInteractionSpec.SYNC_SEND_RECEIVE);
    interactionSpec.setCommareaLength(30);
    setInteractionSpec(interactionSpec);
    setOutputRecordCreator(<span class="hl-keyword">new</span> EciOutputRecordCreator());
  }

  <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> EciOutputRecordCreator <span class="hl-keyword">implements</span> RecordCreator {
    <span class="hl-keyword">public</span> Record createRecord(RecordFactory recordFactory) <span class="hl-keyword">throws</span> ResourceException {
      <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> CommAreaRecord();
    }
  }
}</pre><p>The abstract <code class="classname">EciMappingOperation</code> class can
      then be subclassed to specify mappings between custom objects and
      <code class="literal">Records</code>.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyDaoImpl <span class="hl-keyword">extends</span> CciDaoSupport <span class="hl-keyword">implements</span> MyDao {

  <span class="hl-keyword">public</span> OutputObject getData(Integer id) {
    EciMappingOperation query = <span class="hl-keyword">new</span> EciMappingOperation(getConnectionFactory(), <span class="hl-string">"MYPROG"</span>) {
      <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">byte</span>[] objectToBytes(Object inObject) <span class="hl-keyword">throws</span> IOException {
        Integer id = (Integer) inObject;
        <span class="hl-keyword">return</span> String.valueOf(id);
      }
      <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Object bytesToObject(<span class="hl-keyword">byte</span>[] bytes) <span class="hl-keyword">throws</span> IOException;
        String str = <span class="hl-keyword">new</span> String(bytes);
        String field1 = str.substring(0,6);
        String field2 = str.substring(6,1);
        String field3 = str.substring(7,1);
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> OutputObject(field1, field2, field3);
      }
    });

    <span class="hl-keyword">return</span> (OutputObject) query.execute(<span class="hl-keyword">new</span> Integer(id));
  }
}</pre><p>The corresponding configuration of Spring beans could look as
      follows in non-managed mode:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"managedConnectionFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.ibm.connector2.cics.ECIManagedConnectionFactory"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"serverName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TXSERIES"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionURL"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"local:"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"userName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"CICSUSER"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"CICS"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.support.LocalConnectionFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"managedConnectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"managedConnectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"component"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"MyDaoImpl"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"connectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>In managed mode (that is, in a Java EE environment), the
      configuration could look as follows:</p><pre class="programlisting">&lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"eis/cicseci"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"component"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"MyDaoImpl"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"connectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cci-tx"></a>24.5&nbsp;Transactions</h2></div></div></div><p>JCA specifies several levels of transaction support for resource
    adapters. The kind of transactions that your resource adapter supports is
    specified in its <code class="filename">ra.xml</code> file. There are essentially
    three options: none (for example with CICS EPI connector), local
    transactions (for example with a CICS ECI connector), global transactions
    (for example with an IMS connector).</p><pre class="programlisting">&lt;<span class="hl-tag">connector</span>&gt;

  &lt;<span class="hl-tag">resourceadapter</span>&gt;

    &lt;<span class="hl-comment">!-- &lt;transaction-support&gt;NoTransaction&lt;/transaction-support&gt; --</span>&gt;
    &lt;<span class="hl-comment">!-- &lt;transaction-support&gt;LocalTransaction&lt;/transaction-support&gt; --</span>&gt;
    &lt;<span class="hl-tag">transaction-support</span>&gt;XATransaction&lt;<span class="hl-tag">/transaction-support</span>&gt;

  &lt;<span class="hl-tag">resourceadapter</span>&gt;

&lt;<span class="hl-tag">connector</span>&gt;</pre><p>For global transactions, you can use Spring's generic transaction
    infrastructure to demarcate transactions, with
    <code class="classname">JtaTransactionManager</code> as backend (delegating to the
    Java EE server's distributed transaction coordinator underneath).</p><p>For local transactions on a single CCI
    <code class="interfacename">ConnectionFactory</code>, Spring provides a
    specific transaction management strategy for CCI, analogous to the
    <code class="classname">DataSourceTransactionManager</code> for JDBC. The CCI API
    defines a local transaction object and corresponding local transaction
    demarcation methods. Spring's
    <code class="classname">CciLocalTransactionManager</code> executes such local CCI
    transactions, fully compliant with Spring's generic
    <code class="interfacename">PlatformTransactionManager</code>
    abstraction.</p><pre class="programlisting">&lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"eciConnectionFactory"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"eis/cicseci"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"eciTransactionManager"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jca.cci.connection.CciLocalTransactionManager"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"connectionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"eciConnectionFactory"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Both transaction strategies can be used with any of Spring's
    transaction demarcation facilities, be it declarative or programmatic.
    This is a consequence of Spring's generic
    <code class="interfacename">PlatformTransactionManager</code> abstraction,
    which decouples transaction demarcation from the actual execution
    strategy. Simply switch between
    <code class="classname">JtaTransactionManager</code> and
    <code class="classname">CciLocalTransactionManager</code> as needed, keeping your
    transaction demarcation as-is.</p><p>For more information on Spring's transaction facilities, see the
    chapter entitled <a class="xref" href="#transaction" title="11.&nbsp;Transaction Management">Chapter&nbsp;11, <i>Transaction Management</i></a>.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="mail"></a>25.&nbsp;Email</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mail-introduction"></a>25.1&nbsp;Introduction</h2></div></div></div><div class="sidebar"><p class="title"><b>Library dependencies</b></p><p>The following additional jars to be on the classpath of your
		application in order to be able to use the Spring Framework's email library.</p><div class="itemizedlist"><ul type="disc"><li><p>The <a class="ulink" href="http://java.sun.com/products/javamail/" target="_top">JavaMail</a> <code class="filename">mail.jar</code> library</p></li><li><p>The <a class="ulink" href="http://java.sun.com/products/javabeans/jaf/downloads/index.html" target="_top">JAF</a> <code class="filename">activation.jar</code> library</p></li></ul></div><p>All of these libraries are freely available on the web.</p></div><p>The Spring Framework provides a helpful utility library for sending
	email that shields the user from the specifics of the underlying mailing
	system and is responsible for low level resource handling on behalf of
    the client.</p><p>The <code class="literal">org.springframework.mail</code> package is the root level package
	for the Spring Framework's email support. The central interface for sending
	emails is the <code class="interfacename">MailSender</code> interface; a simple value object
	encapsulating the properties of a simple mail such as <span class="emphasis"><em>from</em></span> and
	<span class="emphasis"><em>to</em></span> (plus many others) is the <code class="classname">SimpleMailMessage</code> class.
    This package also contains a hierarchy of checked exceptions which provide
    a higher level of abstraction over the lower level mail system exceptions
    with the root exception being <code class="exceptionname">MailException</code>. Please
    refer to the JavaDocs for more information on the rich mail exception hierarchy.</p><p>The <code class="interfacename">org.springframework.mail.javamail.JavaMailSender</code>
	interface adds specialized <span class="emphasis"><em>JavaMail</em></span> features such as MIME
    message support to the <code class="interfacename">MailSender</code> interface
	(from which it inherits). <code class="interfacename">JavaMailSender</code> also provides a
	callback interface for preparation of JavaMail MIME messages, called
    <code class="interfacename">org.springframework.mail.javamail.MimeMessagePreparator</code></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mail-usage"></a>25.2&nbsp;Usage</h2></div></div></div><p>Let's assume there is a business interface called <code class="interfacename">OrderManager</code>:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> OrderManager {

    <span class="hl-keyword">void</span> placeOrder(Order order);
}</pre><p>Let us also assume that there is a requirement stating that an email message
		with an order number needs to be generated and sent to a customer placing the
		relevant order.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mail-usage-simple"></a>25.2.1&nbsp;Basic <code class="interfacename">MailSender</code> and <code class="classname">SimpleMailMessage</code> usage</h3></div></div></div><pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.mail.MailException;
<span class="hl-keyword">import</span> org.springframework.mail.MailSender;
<span class="hl-keyword">import</span> org.springframework.mail.SimpleMailMessage;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleOrderManager <span class="hl-keyword">implements</span> OrderManager {

    <span class="hl-keyword">private</span> MailSender mailSender;
    <span class="hl-keyword">private</span> SimpleMailMessage templateMessage;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMailSender(MailSender mailSender) {
        <span class="hl-keyword">this</span>.mailSender = mailSender;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setTemplateMessage(SimpleMailMessage templateMessage) {
        <span class="hl-keyword">this</span>.templateMessage = templateMessage;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> placeOrder(Order order) {

        <span class="hl-comment">// Do the business calculations...</span>

        <span class="hl-comment">// Call the collaborators to persist the order...</span>

        <span class="hl-comment">// Create a thread safe "copy" of the template message and customize it</span>
        SimpleMailMessage msg = <span class="hl-keyword">new</span> SimpleMailMessage(<span class="hl-keyword">this</span>.templateMessage);
        msg.setTo(order.getCustomer().getEmailAddress());
        msg.setText(
            <span class="hl-string">"Dear "</span> + order.getCustomer().getFirstName()
                + order.getCustomer().getLastName()
                + <span class="hl-string">", thank you for placing order. Your order number is "</span>
                + order.getOrderNumber());
        <span class="hl-keyword">try</span>{
            <span class="hl-keyword">this</span>.mailSender.send(msg);
        }
        <span class="hl-keyword">catch</span>(MailException ex) {
            <span class="hl-comment">// simply log it and go on...</span>
            System.err.println(ex.getMessage());            
        }
    }
}</pre><p>Find below the bean definitions for the above code:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mailSender"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.mail.javamail.JavaMailSenderImpl"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"host"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"mail.mycompany.com"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-comment">!-- this is a template message that we can pre-load with default state --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"templateMessage"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.mail.SimpleMailMessage"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"from"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"customerservice@mycompany.com"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"subject"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Your order"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"orderManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.businessapp.support.SimpleOrderManager"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mailSender"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"mailSender"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"templateMessage"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"templateMessage"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mail-usage-mime"></a>25.2.2&nbsp;Using the <code class="interfacename">JavaMailSender</code> and the <code class="classname">MimeMessagePreparator</code></h3></div></div></div><p>Here is another implementation of <code class="interfacename">OrderManager</code> using
			the <code class="interfacename">MimeMessagePreparator</code> callback interface. Please note
			in this case that the <code class="literal">mailSender</code> property is of type
			<code class="interfacename">JavaMailSender</code> so that we are able to use the JavaMail
			<code class="classname">MimeMessage</code> class:</p><pre class="programlisting"><span class="hl-keyword">import</span> javax.mail.Message;
<span class="hl-keyword">import</span> javax.mail.MessagingException;
<span class="hl-keyword">import</span> javax.mail.internet.InternetAddress;
<span class="hl-keyword">import</span> javax.mail.internet.MimeMessage;

<span class="hl-keyword">import</span> javax.mail.internet.MimeMessage;
<span class="hl-keyword">import</span> org.springframework.mail.MailException;
<span class="hl-keyword">import</span> org.springframework.mail.javamail.JavaMailSender;
<span class="hl-keyword">import</span> org.springframework.mail.javamail.MimeMessagePreparator;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleOrderManager <span class="hl-keyword">implements</span> OrderManager {

    <span class="hl-keyword">private</span> JavaMailSender mailSender;
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMailSender(JavaMailSender mailSender) {
        <span class="hl-keyword">this</span>.mailSender = mailSender;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> placeOrder(<span class="hl-keyword">final</span> Order order) {

        <span class="hl-comment">// Do the business calculations...</span>

        <span class="hl-comment">// Call the collaborators to persist the order...</span>
        
        MimeMessagePreparator preparator = <span class="hl-keyword">new</span> MimeMessagePreparator() {
        
            <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> prepare(MimeMessage mimeMessage) <span class="hl-keyword">throws</span> Exception {
        
                mimeMessage.setRecipient(Message.RecipientType.TO, 
                        <span class="hl-keyword">new</span> InternetAddress(order.getCustomer().getEmailAddress()));
                mimeMessage.setFrom(<span class="hl-keyword">new</span> InternetAddress(<span class="hl-string">"mail@mycompany.com"</span>));
                mimeMessage.setText(
                    <span class="hl-string">"Dear "</span> + order.getCustomer().getFirstName() + <span class="hl-string">" "</span>
                        + order.getCustomer().getLastName()
                        + <span class="hl-string">", thank you for placing order. Your order number is "</span>
                        + order.getOrderNumber());
            }
        };
        <span class="hl-keyword">try</span> {
            <span class="hl-keyword">this</span>.mailSender.send(preparator);
        }
        <span class="hl-keyword">catch</span> (MailException ex) {
            <span class="hl-comment">// simply log it and go on...</span>
            System.err.println(ex.getMessage());            
        }
    }
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The mail code is a crosscutting concern and could well be a candidate
				for refactoring into a <a class="link" href="#aop" title="8.&nbsp;Aspect Oriented Programming with Spring">custom Spring AOP aspect</a>,
				which then could be executed at appropriate joinpoints on the
				<code class="interfacename">OrderManager</code> target.</p></td></tr></table></div><p>The Spring Framework's mail support ships with the standard JavaMail
			implementation. Please refer to the relevant JavaDocs for more information.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mail-javamail-mime"></a>25.3&nbsp;Using the JavaMail <code class="classname">MimeMessageHelper</code></h2></div></div></div><p>A class that comes in pretty handy when dealing with JavaMail messages is
		the <code class="classname">org.springframework.mail.javamail.MimeMessageHelper</code> class,
		which shields you from having to use the verbose JavaMail API. Using
		the <code class="classname">MimeMessageHelper</code> it is pretty easy to
		create a <code class="classname">MimeMessage</code>:</p><pre class="programlisting"><span class="hl-comment">// of course you would use DI in any real-world cases</span>
JavaMailSenderImpl sender = <span class="hl-keyword">new</span> JavaMailSenderImpl();
sender.setHost(<span class="hl-string">"mail.host.com"</span>);

MimeMessage message = sender.createMimeMessage();
MimeMessageHelper helper = <span class="hl-keyword">new</span> MimeMessageHelper(message);
helper.setTo(<span class="hl-string">"test@host.com"</span>);
helper.setText(<span class="hl-string">"Thank you for ordering!"</span>);

sender.send(message);</pre><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mail-javamail-mime-attachments"></a>25.3.1&nbsp;Sending attachments and inline resources</h3></div></div></div><p>Multipart email messages allow for both attachments and inline resources.
			Examples of inline resources would be images or a stylesheet you want to use
			in your message, but that you don't want displayed as an attachment.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mail-javamail-mime-attachments-attachment"></a>25.3.1.1&nbsp;Attachments</h4></div></div></div><p>The following example shows you how to use the
				<code class="classname">MimeMessageHelper</code> to send an email along with a
				single JPEG image attachment.</p><pre class="programlisting">JavaMailSenderImpl sender = <span class="hl-keyword">new</span> JavaMailSenderImpl();
sender.setHost(<span class="hl-string">"mail.host.com"</span>);

MimeMessage message = sender.createMimeMessage();

<span class="hl-comment">// use the true flag to indicate you need a multipart message</span>
MimeMessageHelper helper = <span class="hl-keyword">new</span> MimeMessageHelper(message, true);
helper.setTo(<span class="hl-string">"test@host.com"</span>);

helper.setText(<span class="hl-string">"Check out this image!"</span>);

<span class="hl-comment">// let's attach the infamous windows Sample file (this time copied to c:/)</span>
FileSystemResource file = <span class="hl-keyword">new</span> FileSystemResource(<span class="hl-keyword">new</span> File(<span class="hl-string">"c:/Sample.jpg"</span>));
helper.addAttachment(<span class="hl-string">"CoolImage.jpg"</span>, file);

sender.send(message);</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mail-javamail-mime-attachments-inline"></a>25.3.1.2&nbsp;Inline resources</h4></div></div></div><p>The following example shows you how to use the
				<code class="classname">MimeMessageHelper</code> to send an email along with an
				inline image.</p><pre class="programlisting">JavaMailSenderImpl sender = <span class="hl-keyword">new</span> JavaMailSenderImpl();
sender.setHost(<span class="hl-string">"mail.host.com"</span>);

MimeMessage message = sender.createMimeMessage();

<span class="hl-comment">// use the true flag to indicate you need a multipart message</span>
MimeMessageHelper helper = <span class="hl-keyword">new</span> MimeMessageHelper(message, true);
helper.setTo(<span class="hl-string">"test@host.com"</span>);

<span class="hl-comment">// use the true flag to indicate the text included is HTML</span>
helper.setText(<span class="hl-string">"&lt;html&gt;&lt;body&gt;&lt;img src='cid:identifier1234'&gt;&lt;/body&gt;&lt;/html&gt;"</span>, true);

<span class="hl-comment">// let's include the infamous windows Sample file (this time copied to c:/)</span>
FileSystemResource res = <span class="hl-keyword">new</span> FileSystemResource(<span class="hl-keyword">new</span> File(<span class="hl-string">"c:/Sample.jpg"</span>));
helper.addInline(<span class="hl-string">"identifier1234"</span>, res);

sender.send(message);</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.gif"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>Inline resources are added to the mime message using the
					specified <code class="literal">Content-ID</code> (<code class="literal">identifier1234</code>
					in the above example). The order in which you are adding the text and the
					resource are <span class="bold"><strong>very</strong></span> important. Be sure to
					<span class="emphasis"><em>first add the text</em></span> and after that the resources. If
					you are doing it the other way around, it won't work!</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mail-templates"></a>25.3.2&nbsp;Creating email content using a templating library</h3></div></div></div><p>The code in the previous examples explicitly created the
			content of the email message, using methods calls such as
			<code class="methodname">message.setText(..)</code>. This is fine for
			simple cases, and it is okay in the context of the aforementioned
			examples, where the intent was to show you the very basics of the API.</p><p>In your typical enterprise application though, you are not going
			to create the content of your emails using the above approach for a number
			of reasons.</p><p>
				</p><div class="itemizedlist"><ul type="disc"><li><p>Creating HTML-based email content in Java code is tedious and error prone</p></li><li><p>There is no clear separation between display logic and business logic</p></li><li><p>Changing the display structure of the email content requires writing Java code, recompiling, redeploying...</p></li></ul></div><p>
			</p><p>Typically the approach taken to address these issues is to use a template library
			such as FreeMarker or Velocity to define the display structure of email content. This leaves
			your code tasked only with creating the data that is to be rendered in the email
			template and sending the email. It is definitely a best practice for when
			the content of your emails becomes even moderately complex, and with
			the Spring Framework's support classes for FreeMarker and Velocity becomes
			quite easy to do. Find below an example of using the Velocity template library
			to create email content.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mail-templates-example"></a>25.3.2.1&nbsp;A Velocity-based example</h4></div></div></div><p>To use <a class="ulink" href="http://velocity.apache.org" target="_top">Velocity</a> to
				create your email template(s), you will need to have the Velocity libraries
				available on your classpath. You will also need to create one or more Velocity templates
				for the email content that your application needs. Find below the Velocity
				template that this example will be using. As you can see it is HTML-based,
				and since it is plain text it can be created using your favorite HTML
				or text editor.</p><pre class="programlisting"># in the com/foo/package
&lt;<span class="hl-tag">html</span>&gt;
&lt;<span class="hl-tag">body</span>&gt;
&lt;<span class="hl-tag">h3</span>&gt;Hi ${user.userName}, welcome to the Chipping Sodbury On-the-Hill message boards!&lt;<span class="hl-tag">/h3</span>&gt;

&lt;<span class="hl-tag">div</span>&gt;
   Your email address is &lt;<span class="hl-tag">a</span> <span class="hl-attribute">href</span>=<span class="hl-value">"mailto:${user.emailAddress}"</span>&gt;${user.emailAddress}&lt;<span class="hl-tag">/a</span>&gt;.
&lt;<span class="hl-tag">/div</span>&gt;
&lt;<span class="hl-tag">/body</span>&gt;

&lt;<span class="hl-tag">/html</span>&gt;</pre><p>Find below some simple code and Spring XML configuration that
				makes use of the above Velocity template to create email content and
				send email(s).</p><pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">import</span> org.apache.velocity.app.VelocityEngine;
<span class="hl-keyword">import</span> org.springframework.mail.javamail.JavaMailSender;
<span class="hl-keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;
<span class="hl-keyword">import</span> org.springframework.mail.javamail.MimeMessagePreparator;
<span class="hl-keyword">import</span> org.springframework.ui.velocity.VelocityEngineUtils;

<span class="hl-keyword">import</span> javax.mail.internet.MimeMessage;
<span class="hl-keyword">import</span> java.util.HashMap;
<span class="hl-keyword">import</span> java.util.Map;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleRegistrationService <span class="hl-keyword">implements</span> RegistrationService {

   <span class="hl-keyword">private</span> JavaMailSender mailSender;
   <span class="hl-keyword">private</span> VelocityEngine velocityEngine;

   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMailSender(JavaMailSender mailSender) {
      <span class="hl-keyword">this</span>.mailSender = mailSender;
   }

   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setVelocityEngine(VelocityEngine velocityEngine) {
      <span class="hl-keyword">this</span>.velocityEngine = velocityEngine;
   }

   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> register(User user) {

      <span class="hl-comment">// Do the registration logic...</span>

      sendConfirmationEmail(user);
   }

   <span class="hl-keyword">private</span> <span class="hl-keyword">void</span> sendConfirmationEmail(<span class="hl-keyword">final</span> User user) {
      MimeMessagePreparator preparator = <span class="hl-keyword">new</span> MimeMessagePreparator() {
         <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> prepare(MimeMessage mimeMessage) <span class="hl-keyword">throws</span> Exception {
            MimeMessageHelper message = <span class="hl-keyword">new</span> MimeMessageHelper(mimeMessage);
            message.setTo(user.getEmailAddress());
            message.setFrom(<span class="hl-string">"webmaster@csonth.gov.uk"</span>); <span class="hl-comment">// could be parameterized...</span>
            Map model = <span class="hl-keyword">new</span> HashMap();
            model.put(<span class="hl-string">"user"</span>, user);
            String text = VelocityEngineUtils.mergeTemplateIntoString(
               velocityEngine, <span class="hl-string">"com/dns/registration-confirmation.vm"</span>, model);
            message.setText(text, true);
         }
      };
      <span class="hl-keyword">this</span>.mailSender.send(preparator);
   }
}</pre><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

   &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mailSender"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.mail.javamail.JavaMailSenderImpl"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"host"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"mail.csonth.gov.uk"</span>/&gt;
   &lt;<span class="hl-tag">/bean</span>&gt;

   &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"registrationService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.SimpleRegistrationService"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mailSender"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"mailSender"</span>/&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"velocityEngine"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"velocityEngine"</span>/&gt;
   &lt;<span class="hl-tag">/bean</span>&gt;
   
   &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"velocityEngine"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.ui.velocity.VelocityEngineFactoryBean"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"velocityProperties"</span>&gt;
         &lt;<span class="hl-tag">value</span>&gt;
          resource.loader=class
          class.resource.loader.class=org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader
         &lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">/property</span>&gt;
   &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="scheduling"></a>26.&nbsp;Task Execution and Scheduling</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduling-introduction"></a>26.1&nbsp;Introduction</h2></div></div></div><p>The Spring Framework provides abstractions for asynchronous
    execution and scheduling of tasks with the
    <code class="interfacename">TaskExecutor</code> and
    <code class="interfacename">TaskScheduler</code> interfaces, respectively.
    Spring also features implementations of those interfaces that support
    thread pools or delegation to CommonJ within an application server
    environment. Ultimately the use of these implementations behind the common
    interfaces abstracts away the differences between Java SE 5, Java SE 6 and
    Java EE environments.</p><p>Spring also features integration classes for supporting scheduling
    with the <code class="classname">Timer</code>, part of the JDK since 1.3, and the
    Quartz Scheduler (<a class="ulink" href="http://quartz-scheduler.org" target="_top">http://quartz-scheduler.org</a>). Both of those
    schedulers are set up using a <code class="interfacename">FactoryBean</code>
    with optional references to <code class="classname">Timer</code> or
    <code class="classname">Trigger</code> instances, respectively. Furthermore, a
    convenience class for both the Quartz Scheduler and the
    <code class="classname">Timer</code> is available that allows you to invoke a
    method of an existing target object (analogous to the normal
    <code class="classname">MethodInvokingFactoryBean</code> operation).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduling-task-executor"></a>26.2&nbsp;The Spring <code class="interfacename">TaskExecutor</code>
    abstraction</h2></div></div></div><p>Spring 2.0 introduces a new abstraction for dealing with executors.
    Executors are the Java 5 name for the concept of thread pools. The
    "executor" naming is due to the fact that there is no guarantee that the
    underlying implementation is actually a pool; an executor may be
    single-threaded or even synchronous. Spring's abstraction hides
    implementation details between Java SE 1.4, Java SE 5 and Java EE
    environments.</p><p>Spring's <code class="interfacename">TaskExecutor</code> interface is
    identical to the <code class="classname">java.util.concurrent.Executor</code>
    interface. In fact, its primary reason for existence is to abstract away
    the need for Java 5 when using thread pools. The interface has a single
    method <code class="classname">execute(Runnable task)</code> that accepts a task
    for execution based on the semantics and configuration of the thread
    pool.</p><p>The <code class="interfacename">TaskExecutor</code> was originally
    created to give other Spring components an abstraction for thread pooling
    where needed. Components such as the
    <code class="classname">ApplicationEventMulticaster</code>, JMS's
    <code class="classname">AbstractMessageListenerContainer</code>, and Quartz
    integration all use the <code class="interfacename">TaskExecutor</code>
    abstraction to pool threads. However, if your beans need thread pooling
    behavior, it is possible to use this abstraction for your own
    needs.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-task-executor-types"></a>26.2.1&nbsp;<code class="interfacename">TaskExecutor</code> types</h3></div></div></div><p>There are a number of pre-built implementations of
      <code class="interfacename">TaskExecutor</code> included with the Spring
      distribution. In all likelihood, you shouldn't ever need to implement
      your own.</p><div class="itemizedlist"><ul type="disc"><li><p><code class="classname">SimpleAsyncTaskExecutor</code></p><p>This implementation does not reuse any threads, rather it
          starts up a new thread for each invocation. However, it does support
          a concurrency limit which will block any invocations that are over
          the limit until a slot has been freed up. If you're looking for true
          pooling, keep scrolling further down the page.</p></li><li><p><a name="syncTaskExecutor"></a><code class="classname">SyncTaskExecutor</code></p><p>This implementation doesn't execute invocations
          asynchronously. Instead, each invocation takes place in the calling
          thread. It is primarily used in situations where multithreading
          isn't necessary such as simple test cases.</p></li><li><p><a name="concurrentTaskExecutor"></a><code class="classname">ConcurrentTaskExecutor</code></p><p>This implementation is a wrapper for a Java 5
          <code class="classname">java.util.concurrent.Executor</code>. There is an
          alternative, <code class="classname">ThreadPoolTaskExecutor</code>, that
          exposes the <code class="classname">Executor</code> configuration parameters
          as bean properties. It is rare to need to use the
          <code class="classname">ConcurrentTaskExecutor</code> but if the <a class="link" href="#threadPoolTaskExecutor"><code class="classname">ThreadPoolTaskExecutor</code></a>
          isn't robust enough for your needs, the
          <code class="classname">ConcurrentTaskExecutor</code> is an
          alternative.</p></li><li><p><a name="simpleThreadPoolTaskExecutor"></a><code class="classname">SimpleThreadPoolTaskExecutor</code></p><p>This implementation is actually a subclass of Quartz's
          <code class="classname">SimpleThreadPool</code> which listens to Spring's
          lifecycle callbacks. This is typically used when you have a thread
          pool that may need to be shared by both Quartz and non-Quartz
          components.</p></li><li><p><a name="threadPoolTaskExecutor"></a><code class="classname">ThreadPoolTaskExecutor</code></p><div class="sidebar"><p class="title"><b></b></p><p>It is not possible to use any backport or alternate versions
            of the <code class="classname">java.util.concurrent</code> package with
            this implementation. Both Doug Lea's and Dawid Kurzyniec's
            implementations use different package structures which will
            prevent them from working correctly.</p></div><p>This implementation can only be used in a Java 5 environment
          but is also the most commonly used one in that environment. It
          exposes bean properties for configuring a
          <code class="classname">java.util.concurrent.ThreadPoolExecutor</code> and
          wraps it in a <code class="interfacename">TaskExecutor</code>. If you
          need something advanced such as a
          <code class="classname">ScheduledThreadPoolExecutor</code>, it is
          recommended that you use a <a class="link" href="#concurrentTaskExecutor"><code class="classname">ConcurrentTaskExecutor</code></a>
          instead.</p></li><li><p><code class="classname">TimerTaskExecutor</code></p><p>This implementation uses a single
          <code class="classname">TimerTask</code> as its backing implementation. It's
          different from the <a class="link" href="#syncTaskExecutor"><code class="classname">SyncTaskExecutor</code></a>
          in that the method invocations are executed in a separate thread,
          although they are synchronous in that thread.</p></li><li><p><code class="classname">WorkManagerTaskExecutor</code></p><div class="sidebar"><p class="title"><b></b></p><p>CommonJ is a set of specifications jointly developed between
            BEA and IBM. These specifications are not Java EE standards, but
            are standard across BEA's and IBM's Application Server
            implementations.</p></div><p>This implementation uses the CommonJ WorkManager as its
          backing implementation and is the central convenience class for
          setting up a CommonJ WorkManager reference in a Spring context.
          Similar to the <a class="link" href="#simpleThreadPoolTaskExecutor"><code class="classname">SimpleThreadPoolTaskExecutor</code></a>,
          this class implements the WorkManager interface and therefore can be
          used directly as a WorkManager as well.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-task-executor-usage"></a>26.2.2&nbsp;Using a <code class="interfacename">TaskExecutor</code></h3></div></div></div><p>Spring's <code class="interfacename">TaskExecutor</code>
      implementations are used as simple JavaBeans. In the example below, we
      define a bean that uses the
      <code class="classname">ThreadPoolTaskExecutor</code> to asynchronously print
      out a set of messages.</p><pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.core.task.TaskExecutor;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TaskExecutorExample {

  <span class="hl-keyword">private</span> <span class="hl-keyword">class</span> MessagePrinterTask <span class="hl-keyword">implements</span> Runnable {

    <span class="hl-keyword">private</span> String message;

    <span class="hl-keyword">public</span> MessagePrinterTask(String message) {
      <span class="hl-keyword">this</span>.message = message;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> run() {
      System.out.println(message);
    }

  }

  <span class="hl-keyword">private</span> TaskExecutor taskExecutor;

  <span class="hl-keyword">public</span> TaskExecutorExample(TaskExecutor taskExecutor) {
    <span class="hl-keyword">this</span>.taskExecutor = taskExecutor;
  }

  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> printMessages() {
    <span class="hl-keyword">for</span>(<span class="hl-keyword">int</span> i = 0; i &lt; 25; i++) {
      taskExecutor.execute(<span class="hl-keyword">new</span> MessagePrinterTask(<span class="hl-string">"Message"</span> + i));
    }
  }
}</pre><p>As you can see, rather than retrieving a thread from the pool and
      executing yourself, you add your <code class="classname">Runnable</code> to the
      queue and the <code class="interfacename">TaskExecutor</code> uses its
      internal rules to decide when the task gets executed.</p><p>To configure the rules that the
      <code class="interfacename">TaskExecutor</code> will use, simple bean
      properties have been exposed.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"taskExecutor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"corePoolSize"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"5"</span> /&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"maxPoolSize"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"10"</span> /&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"queueCapacity"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"25"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"taskExecutorExample"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"TaskExecutorExample"</span>&gt;
  &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"taskExecutor"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduling-task-scheduler"></a>26.3&nbsp;The Spring <code class="interfacename">TaskScheduler</code>
    abstraction</h2></div></div></div><p>In addition to the <code class="interfacename">TaskExecutor</code>
    abstraction, Spring 3.0 introduces a
    <code class="interfacename">TaskScheduler</code> with a variety of methods for
    scheduling tasks to run at some point in the future.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> TaskScheduler {

    ScheduledFuture schedule(Runnable task, Trigger trigger);

    ScheduledFuture schedule(Runnable task, Date startTime);

    ScheduledFuture scheduleAtFixedRate(Runnable task, Date startTime, <span class="hl-keyword">long</span> period);

    ScheduledFuture scheduleAtFixedRate(Runnable task, <span class="hl-keyword">long</span> period);

    ScheduledFuture scheduleWithFixedDelay(Runnable task, Date startTime, <span class="hl-keyword">long</span> delay);

    ScheduledFuture scheduleWithFixedDelay(Runnable task, <span class="hl-keyword">long</span> delay);

}</pre><p>The simplest method is the one named 'schedule' that takes a
    <code class="interfacename">Runnable</code> and <code class="classname">Date</code>
    only. That will cause the task to run once after the specified time. All
    of the other methods are capable of scheduling tasks to run repeatedly.
    The fixed-rate and fixed-delay methods are for simple, periodic execution,
    but the method that accepts a Trigger is much more flexible.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-trigger-interface"></a>26.3.1&nbsp;The <code class="interfacename">Trigger</code> interface</h3></div></div></div><p>The <code class="interfacename">Trigger</code> interface is
      essentially inspired by JSR-236, which, as of Spring 3.0, has not yet
      been officially implemented. The basic idea of the
      <code class="interfacename">Trigger</code> is that execution times may be
      determined based on past execution outcomes or even arbitrary
      conditions. If these determinations do take into account the outcome of
      the preceding execution, that information is available within a
      <code class="interfacename">TriggerContext</code>. The
      <code class="interfacename">Trigger</code> interface itself is quite
      simple:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Trigger {

    Date nextExecutionTime(TriggerContext triggerContext);

}</pre><p>As you can see, the <code class="interfacename">TriggerContext</code>
      is the most important part. It encapsulates all of the relevant data,
      and is open for extension in the future if necessary. The
      <code class="interfacename">TriggerContext</code> is an interface (a
      <code class="classname">SimpleTriggerContext</code> implementation is used by
      default). Here you can see what methods are available for
      <code class="interfacename">Trigger</code> implementations.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> TriggerContext {

    Date lastScheduledExecutionTime();

    Date lastActualExecutionTime();

    Date lastCompletionTime();

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-trigger-implementations"></a>26.3.2&nbsp;<code class="interfacename">Trigger</code> implementations</h3></div></div></div><p>Spring provides two implementations of the
      <code class="interfacename">Trigger</code> interface. The most interesting
      one is the <code class="classname">CronTrigger</code>. It enables the scheduling
      of tasks based on cron expressions. For example the following task is
      being scheduled to run 15 minutes past each hour but only during the
      9-to-5 "business hours" on weekdays.</p><pre class="programlisting">scheduler.schedule(task, <span class="hl-keyword">new</span> CronTrigger(<span class="hl-string">"* 15 9-17 * * MON-FRI"</span>));</pre><p>The other out-of-the-box implementation is a
      <code class="classname">PeriodicTrigger</code> that accepts a fixed period, an
      optional initial delay value, and a boolean to indicate whether the
      period should be interpreted as a fixed-rate or a fixed-delay. Since the
      <code class="interfacename">TaskScheduler</code> interface already defines
      methods for scheduling tasks at a fixed-rate or with a fixed-delay,
      those methods should be used directly whenever possible. The value of
      the <code class="classname">PeriodicTrigger</code> implementation is that it can
      be used within components that rely on the
      <code class="interfacename">Trigger</code> abstraction. For example, it may
      be convenient to allow periodic triggers, cron-based triggers, and even
      custom trigger implementations to be used interchangeably. Such a
      component could take advantage of dependency injection so that such
      <code class="interfacename">Triggers</code> could be configured
      externally.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-task-scheduler-implementations"></a>26.3.3&nbsp;<code class="interfacename">TaskScheduler</code>
      implementations</h3></div></div></div><p>As with Spring's <code class="interfacename">TaskExecutor</code>
      abstraction, the primary benefit of the
      <code class="interfacename">TaskScheduler</code> is that code relying on
      scheduling behavior need not be coupled to a particular scheduler
      implementation. The flexibility this provides is particularly relevant
      when running within Application Server environments where threads should
      not be created directly by the application itself. For such cases,
      Spring provides a <code class="classname">TimerManagerTaskScheduler</code> that
      delegates to a CommonJ TimerManager instance, typically configured with
      a JNDI-lookup.</p><p>A simpler alternative, the
      <code class="classname">ThreadPoolTaskScheduler</code>, can be used whenever
      external thread management is not a requirement. Internally, it
      delegates to a <code class="interfacename">ScheduledExecutorService</code>
      instance. <code class="classname">ThreadPoolTaskScheduler</code> actually
      implements Spring's <code class="interfacename">TaskExecutor</code>
      interface as well, so that a single instance can be used for
      asynchronous execution <span class="emphasis"><em>as soon as possible</em></span> as well
      as scheduled, and potentially recurring, executions.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduling-task-namespace"></a>26.4&nbsp;The Task Namespace</h2></div></div></div><p>Beginning with Spring 3.0, there is an XML namespace for configuring
    <code class="interfacename">TaskExecutor</code> and
    <code class="interfacename">TaskScheduler</code> instances. It also provides a
    convenient way to configure tasks to be scheduled with a trigger.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-task-namespace-scheduler"></a>26.4.1&nbsp;The 'scheduler' element</h3></div></div></div><p>The following element will create a
      <code class="classname">ThreadPoolTaskScheduler</code> instance with the
      specified thread pool size.</p><pre class="programlisting">&lt;<span class="hl-tag">task:scheduler</span> <span class="hl-attribute">id</span>=<span class="hl-value">"scheduler"</span> <span class="hl-attribute">pool-size</span>=<span class="hl-value">"10"</span>/&gt;</pre><p>The value provided for the 'id' attribute will be used as the
      prefix for thread names within the pool. The 'scheduler' element is
      relatively straightforward. If you do not provide a 'pool-size'
      attribute, the default thread pool will only have a single thread. There
      are no other configuration options for the scheduler.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-task-namespace-executor"></a>26.4.2&nbsp;The 'executor' element</h3></div></div></div><p>The following will create a
      <code class="classname">ThreadPoolTaskExecutor</code> instance: </p><pre class="programlisting">&lt;<span class="hl-tag">task:executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"executor"</span> <span class="hl-attribute">pool-size</span>=<span class="hl-value">"10"</span>/&gt;</pre><p>As with the scheduler above, the value provided for the 'id'
      attribute will be used as the prefix for thread names within the pool.
      As far as the pool size is concerned, the 'executor' element supports
      more configuration options than the 'scheduler' element. For one thing,
      the thread pool for a <code class="classname">ThreadPoolTaskExecutor</code> is
      itself more configurable. Rather than just a single size, an executor's
      thread pool may have different values for the <span class="emphasis"><em>core</em></span>
      and the <span class="emphasis"><em>max</em></span> size. If a single value is provided
      then the executor will have a fixed-size thread pool (the core and max
      sizes are the same). However, the 'executor' element's 'pool-size'
      attribute also accepts a range in the form of "min-max". </p><pre class="programlisting">&lt;<span class="hl-tag">task:executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"executorWithPoolSizeRange"</span>
	               <span class="hl-attribute">pool-size</span>=<span class="hl-value">"5-25"</span>
	               <span class="hl-attribute">queue-capacity</span>=<span class="hl-value">"100"</span>/&gt;</pre><p>As you can see from that configuration, a 'queue-capacity' value
      has also been provided. The configuration of the thread pool should also
      be considered in light of the executor's queue capacity. For the full
      description of the relationship between pool size and queue capacity,
      consult the documentation for <a class="ulink" href="http://java.sun.com/javase/6/docs/api/java/util/concurrent/ThreadPoolExecutor.html" target="_top">ThreadPoolExecutor</a>.
      The main idea is that when a task is submitted, the executor will first
      try to use a free thread if the number of active threads is currently
      less than the core size. If the core size has been reached, then the
      task will be added to the queue as long as its capacity has not yet been
      reached. Only then, if the queue's capacity <span class="emphasis"><em>has</em></span>
      been reached, will the executor create a new thread beyond the core
      size. If the max size has also been reached, then the executor will
      reject the task.</p><p>By default, the queue is <span class="emphasis"><em>unbounded</em></span>, but this
      is rarely the desired configuration, because it can lead to
      <code class="classname">OutOfMemoryErrors</code> if enough tasks are added to
      that queue while all pool threads are busy. Furthermore, if the queue is
      unbounded, then the max size has no effect at all. Since the executor
      will always try the queue before creating a new thread beyond the core
      size, a queue must have a finite capacity for the thread pool to grow
      beyond the core size (this is why a <span class="emphasis"><em>fixed size</em></span> pool
      is the only sensible case when using an unbounded queue).</p><p>In a moment, we will review the effects of the keep-alive setting
      which adds yet another factor to consider when providing a pool size
      configuration. First, let's consider the case, as mentioned above, when
      a task is rejected. By default, when a task is rejected, a thread pool
      executor will throw a <code class="classname">TaskRejectedException</code>.
      However, the rejection policy is actually configurable. The exception is
      thrown when using the default rejection policy which is the
      <code class="classname">AbortPolicy</code> implementation. For applications
      where some tasks can be skipped under heavy load, either the
      <code class="classname">DiscardPolicy</code> or
      <code class="classname">DiscardOldestPolicy</code> may be configured instead.
      Another option that works well for applications that need to throttle
      the submitted tasks under heavy load is the
      <code class="classname">CallerRunsPolicy</code>. Instead of throwing an
      exception or discarding tasks, that policy will simply force the thread
      that is calling the submit method to run the task itself. The idea is
      that such a caller will be busy while running that task and not able to
      submit other tasks immediately. Therefore it provides a simple way to
      throttle the incoming load while maintaining the limits of the thread
      pool and queue. Typically this allows the executor to "catch up" on the
      tasks it is handling and thereby frees up some capacity on the queue, in
      the pool, or both. Any of these options can be chosen from an
      enumeration of values available for the 'rejection-policy' attribute on
      the 'executor' element.</p><pre class="programlisting">&lt;<span class="hl-tag">task:executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"executorWithCallerRunsPolicy"</span>
               <span class="hl-attribute">pool-size</span>=<span class="hl-value">"5-25"</span>
               <span class="hl-attribute">queue-capacity</span>=<span class="hl-value">"100"</span>
               <span class="hl-attribute">rejection-policy</span>=<span class="hl-value">"CALLER_RUNS"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-task-namespace-scheduled-tasks"></a>26.4.3&nbsp;The 'scheduled-tasks' element</h3></div></div></div><p>The most powerful feature of Spring's task namespace is the
      support for configuring tasks to be scheduled within a Spring
      Application Context. This follows an approach similar to other
      "method-invokers" in Spring, such as that provided by the JMS namespace
      for configuring Message-driven POJOs. Basically a "ref" attribute can
      point to any Spring-managed object, and the "method" attribute provides
      the name of a method to be invoked on that object. Here is a simple
      example.</p><pre class="programlisting">&lt;<span class="hl-tag">task:scheduled-tasks</span> <span class="hl-attribute">scheduler</span>=<span class="hl-value">"myScheduler"</span>&gt;
    &lt;<span class="hl-tag">task:scheduled</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"someObject"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"someMethod"</span> <span class="hl-attribute">fixed-delay</span>=<span class="hl-value">"5000"</span>/&gt;
&lt;<span class="hl-tag">/task:scheduled-tasks</span>&gt;

&lt;<span class="hl-tag">task:scheduler</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myScheduler"</span> <span class="hl-attribute">pool-size</span>=<span class="hl-value">"10"</span>/&gt;</pre><p>As you can see, the scheduler is referenced by the outer element,
      and each individual task includes the configuration of its trigger
      metadata. In the preceding example, that metadata defines a periodic
      trigger with a fixed delay. It could also be configured with a
      "fixed-rate", or for more control, a "cron" attribute could be provided
      instead. Here's an example featuring these other options.</p><pre class="programlisting">&lt;<span class="hl-tag">task:scheduled-tasks</span> <span class="hl-attribute">scheduler</span>=<span class="hl-value">"myScheduler"</span>&gt;
    &lt;<span class="hl-tag">task:scheduled</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"someObject"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"someMethod"</span> <span class="hl-attribute">fixed-rate</span>=<span class="hl-value">"5000"</span>/&gt;
    &lt;<span class="hl-tag">task:scheduled</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"anotherObject"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"anotherMethod"</span> <span class="hl-attribute">cron</span>=<span class="hl-value">"*/5 * * * * MON-FRI"</span>/&gt;
&lt;<span class="hl-tag">/task:scheduled-tasks</span>&gt;

&lt;<span class="hl-tag">task:scheduler</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myScheduler"</span> <span class="hl-attribute">pool-size</span>=<span class="hl-value">"10"</span>/&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduling-annotation-support"></a>26.5&nbsp;Annotation Support for Scheduling and Asynchronous
    Execution</h2></div></div></div><p>Spring 3.0 also adds annotation support for both task scheduling and
    asynchronous method execution.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-annotation-support-scheduled"></a>26.5.1&nbsp;The @Scheduled Annotation</h3></div></div></div><p>The @Scheduled annotation can be added to a method along with
      trigger metadata. For example, the following method would be invoked
      every 5 seconds with a fixed delay, meaning that the period will be
      measured from the completion time of each preceding invocation.</p><pre class="programlisting">@Scheduled(fixedDelay=5000)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() {
    <span class="hl-comment">// something that should execute periodically</span>
}</pre><p>If a fixed rate execution is desired, simply change the property
      name specified within the annotation. The following would be executed
      every 5 seconds measured between the successive start times of each
      invocation.</p><pre class="programlisting">@Scheduled(fixedRate=5000)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() {
    <span class="hl-comment">// something that should execute periodically</span>
}</pre><p>If simple periodic scheduling is not expressive enough, then a
      cron expression may be provided. For example, the following will only
      execute on weekdays.</p><pre class="programlisting">@Scheduled(cron=<span class="hl-string">"*/5 * * * * MON-FRI"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() {
    <span class="hl-comment">// something that should execute on weekdays only</span>
}</pre><p>Notice that the methods to be scheduled must have void returns and
      must not expect any arguments. If the method needs to interact with
      other objects from the Application Context, then those would typically
      have been provided through dependency injection.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Make sure that you are not initializing multiple instances of
        the same @Scheduled annotation class at runtime, unless you do want to
        schedule callbacks to each such instance. Related to this, make sure
        that you do not use @Configurable on bean classes which are annotated
        with @Scheduled and registered as regular Spring beans with the
        container: You would get double initialization otherwise, once through
        the container and once through the @Configurable aspect, with the
        consequence of each @Scheduled method being invoked twice.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-annotation-support-async"></a>26.5.2&nbsp;The @Async Annotation</h3></div></div></div><p>The <code class="interfacename">@Async</code> annotation can be
      provided on a method so that invocation of that method will occur
      asynchronously. In other words, the caller will return immediately upon
      invocation and the actual execution of the method will occur in a task
      that has been submitted to a Spring
      <code class="interfacename">TaskExecutor</code>. In the simplest case, the
      annotation may be applied to a <code class="literal">void</code>-returning
      method.</p><pre class="programlisting">@Async
<span class="hl-keyword">void</span> doSomething() {
    <span class="hl-comment">// this will be executed asynchronously</span>
}</pre><p>Unlike the methods annotated with the
      <code class="interfacename">@Scheduled</code> annotation, these methods can
      expect arguments, because they will be invoked in the "normal" way by
      callers at runtime rather than from a scheduled task being managed by
      the container. For example, the following is a legitimate application of
      the <code class="interfacename">@Async</code> annotation.</p><pre class="programlisting">@Async
<span class="hl-keyword">void</span> doSomething(String s) {
    <span class="hl-comment">// this will be executed asynchronously</span>
}</pre><p>Even methods that return a value can be invoked asynchronously.
      However, such methods are required to have a
      <code class="interfacename">Future</code> typed return value. This still
      provides the benefit of asynchronous execution so that the caller can
      perform other tasks prior to calling <code class="methodname">get()</code> on
      that Future.</p><pre class="programlisting">@Async
Future&lt;String&gt; returnSomething(<span class="hl-keyword">int</span> i) {
    <span class="hl-comment">// this will be executed asynchronously</span>
}</pre><p><code class="interfacename">@Async</code> can not be used in
      conjunction with lifecycle callbacks such as
      <code class="interfacename">@PostConstruct</code>. To asynchonously
      initialize Spring beans you currently have to use a separate
      initializing Spring bean that invokes the
      <code class="interfacename">@Async</code> annotated method on the target
      then.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SampleBeanImpl <span class="hl-keyword">implements</span> SampleBean {

  @Async
  <span class="hl-keyword">void</span> doSomething() { &#8230; }
}


<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SampleBeanInititalizer {

  <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> SampleBean bean;

  <span class="hl-keyword">public</span> SampleBeanInitializer(SampleBean bean) {
    <span class="hl-keyword">this</span>.bean = bean;
  }

  @PostConstruct
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> initialize() {
    bean.doSomething();
  }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-annotation-support-namespace"></a>26.5.3&nbsp;The &lt;annotation-driven&gt; Element</h3></div></div></div><p>To enable both @Scheduled and @Async annotations, simply include
      the 'annotation-driven' element from the task namespace in your
      configuration.</p><pre class="programlisting">&lt;<span class="hl-tag">task:annotation-driven</span> <span class="hl-attribute">executor</span>=<span class="hl-value">"myExecutor"</span> <span class="hl-attribute">scheduler</span>=<span class="hl-value">"myScheduler"</span>/&gt;

&lt;<span class="hl-tag">task:executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myExecutor"</span> <span class="hl-attribute">pool-size</span>=<span class="hl-value">"5"</span>/&gt;

&lt;<span class="hl-tag">task:scheduler</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myScheduler"</span> <span class="hl-attribute">pool-size</span>=<span class="hl-value">"10"</span>/&gt;}</pre><p>Notice that an executor reference is provided for handling those
      tasks that correspond to methods with the @Async annotation, and the
      scheduler reference is provided for managing those methods annotated
      with @Scheduled.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduling-quartz"></a>26.6&nbsp;Using the Quartz Scheduler</h2></div></div></div><p>Quartz uses <code class="classname">Trigger</code>,
    <code class="classname">Job</code> and <code class="classname">JobDetail</code> objects to
    realize scheduling of all kinds of jobs. For the basic concepts behind
    Quartz, have a look at <a class="ulink" href="http://quartz-scheduler.org" target="_top">http://quartz-scheduler.org</a>. For convenience
    purposes, Spring offers a couple of classes that simplify the usage of
    Quartz within Spring-based applications.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-quartz-jobdetail"></a>26.6.1&nbsp;Using the JobDetailBean</h3></div></div></div><p><code class="classname">JobDetail</code> objects contain all information
      needed to run a job. The Spring Framework provides a
      <code class="classname">JobDetailBean</code> that makes the
      <code class="classname">JobDetail</code> more of an actual JavaBean with
      sensible defaults. Let's have a look at an example:</p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"exampleJob"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.scheduling.quartz.JobDetailBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jobClass"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.ExampleJob"</span> /&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jobDataAsMap"</span>&gt;
    &lt;<span class="hl-tag">map</span>&gt;
      &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"timeout"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"5"</span> /&gt;
    &lt;<span class="hl-tag">/map</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The job detail bean has all information it needs to run the job
      (<code class="classname">ExampleJob</code>). The timeout is specified in the job
      data map. The job data map is available through the
      <code class="classname">JobExecutionContext</code> (passed to you at execution
      time), but the <code class="classname">JobDetailBean</code> also maps the
      properties from the job data map to properties of the actual job. So in
      this case, if the <code class="classname">ExampleJob</code> contains a property
      named <code class="literal">timeout</code>, the
      <code class="classname">JobDetailBean</code> will automatically apply it:</p><pre class="programlisting"><span class="hl-keyword">package</span> example;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleJob <span class="hl-keyword">extends</span> QuartzJobBean {

  <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> timeout;
  
  <span class="hl-comment">/**
   * Setter called after the ExampleJob is instantiated
   * with the value from the JobDetailBean (5)
   */</span> 
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setTimeout(<span class="hl-keyword">int</span> timeout) {
    <span class="hl-keyword">this</span>.timeout = timeout;
  }
  
  <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> executeInternal(JobExecutionContext ctx) <span class="hl-keyword">throws</span> JobExecutionException {
      <span class="hl-comment">// do the actual work</span>
  }
}</pre><p>All additional settings from the job detail bean are of course
      available to you as well.</p><p><span class="emphasis"><em>Note: Using the <code class="literal">name</code> and
      <code class="literal">group</code> properties, you can modify the name and the
      group of the job, respectively. By default, the name of the job matches
      the bean name of the job detail bean (in the example above, this is
      <code class="literal">exampleJob</code>).</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-quartz-method-invoking-job"></a>26.6.2&nbsp;Using the
      <code class="classname">MethodInvokingJobDetailFactoryBean</code></h3></div></div></div><p>Often you just need to invoke a method on a specific object. Using
      the <code class="classname">MethodInvokingJobDetailFactoryBean</code> you can do
      exactly this:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jobDetail"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetObject"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"exampleBusinessObject"</span> /&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetMethod"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"doIt"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The above example will result in the <code class="literal">doIt</code>
      method being called on the <code class="literal">exampleBusinessObject</code>
      method (see below):</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBusinessObject {
  
  <span class="hl-comment">// properties and collaborators</span>
  
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doIt() {
    <span class="hl-comment">// do the actual work</span>
  }
}</pre><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBusinessObject"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBusinessObject"</span>/&gt;</pre><p>Using the
      <code class="classname">MethodInvokingJobDetailFactoryBean</code>, you don't
      need to create one-line jobs that just invoke a method, and you only
      need to create the actual business object and wire up the detail
      object.</p><p>By default, Quartz Jobs are stateless, resulting in the
      possibility of jobs interfering with each other. If you specify two
      triggers for the same <code class="classname">JobDetail</code>, it might be
      possible that before the first job has finished, the second one will
      start. If <code class="classname">JobDetail</code> classes implement the
      <code class="interfacename">Stateful</code> interface, this won't happen.
      The second job will not start before the first one has finished. To make
      jobs resulting from the
      <code class="classname">MethodInvokingJobDetailFactoryBean</code>
      non-concurrent, set the <code class="literal">concurrent</code> flag to
      <code class="literal">false</code>.</p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jobDetail"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetObject"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"exampleBusinessObject"</span> /&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetMethod"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"doIt"</span> /&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"concurrent"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"false"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>By default, jobs will run in a concurrent fashion.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-quartz-cron"></a>26.6.3&nbsp;Wiring up jobs using triggers and the
      <code class="classname">SchedulerFactoryBean</code></h3></div></div></div><p>We've created job details and jobs. We've also reviewed the
      convenience bean that allows you to invoke a method on a specific
      object. Of course, we still need to schedule the jobs themselves. This
      is done using triggers and a
      <code class="classname">SchedulerFactoryBean</code>. Several triggers are
      available within Quartz. Spring offers two subclassed triggers with
      convenient defaults: <code class="classname">CronTriggerBean</code> and
      <code class="classname">SimpleTriggerBean</code>.</p><p>Triggers need to be scheduled. Spring offers a
      <code class="classname">SchedulerFactoryBean</code> that exposes triggers to be
      set as properties. <code class="classname">SchedulerFactoryBean</code> schedules
      the actual jobs with those triggers.</p><p>Find below a couple of examples:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"simpleTrigger"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.scheduling.quartz.SimpleTriggerBean"</span>&gt;
    &lt;<span class="hl-comment">!-- see the example of method invoking job above --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jobDetail"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"jobDetail"</span> /&gt;
    &lt;<span class="hl-comment">!-- 10 seconds --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"startDelay"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"10000"</span> /&gt;
    &lt;<span class="hl-comment">!-- repeat every 50 seconds --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"repeatInterval"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"50000"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"cronTrigger"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.scheduling.quartz.CronTriggerBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jobDetail"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"exampleJob"</span> /&gt;
    &lt;<span class="hl-comment">!-- run every morning at 6 AM --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"cronExpression"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"0 0 6 * * ?"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Now we've set up two triggers, one running every 50 seconds with a
      starting delay of 10 seconds and one every morning at 6 AM. To finalize
      everything, we need to set up the
      <code class="classname">SchedulerFactoryBean</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.scheduling.quartz.SchedulerFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"triggers"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"cronTrigger"</span> /&gt;
            &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"simpleTrigger"</span> /&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>More properties are available for the
      <code class="classname">SchedulerFactoryBean</code> for you to set, such as the
      calendars used by the job details, properties to customize Quartz with,
      etc. Have a look at the <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/scheduling/quartz/SchedulerFactoryBean.html" target="_top">SchedulerFactoryBean
      Javadoc</a> for more information.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduling-jdk-timer"></a>26.7&nbsp;Using JDK Timer support</h2></div></div></div><p>The other way to schedule jobs in Spring is to use JDK
    <code class="classname">Timer</code> objects. You can create custom timers or use
    the timer that invokes methods. Wiring timers is done using the
    <code class="classname">TimerFactoryBean</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-jdk-timer-creating"></a>26.7.1&nbsp;Creating custom timers</h3></div></div></div><p>Using the <code class="classname">TimerTask</code> you can create customer
      timer tasks, similar to Quartz jobs:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CheckEmailAddresses <span class="hl-keyword">extends</span> TimerTask {

  <span class="hl-keyword">private</span> List emailAddresses;
  
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setEmailAddresses(List emailAddresses) {
    <span class="hl-keyword">this</span>.emailAddresses = emailAddresses;
  }
  
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> run() {
    <span class="hl-comment">// iterate over all email addresses and archive them</span>
  }
}</pre><p>Wiring it up is simple:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"checkEmail"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.CheckEmailAddress"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"emailAddresses"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;test@springframework.org&lt;<span class="hl-tag">/value</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;foo@bar.com&lt;<span class="hl-tag">/value</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;john@doe.net&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"scheduledTask"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.scheduling.timer.ScheduledTimerTask"</span>&gt;
    &lt;<span class="hl-comment">!-- wait 10 seconds before starting repeated execution --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"delay"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"10000"</span> /&gt;
    &lt;<span class="hl-comment">!-- run every 50 seconds --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"period"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"50000"</span> /&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"timerTask"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"checkEmail"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p><span class="emphasis"><em> Note that letting the task only run once can be done by
      changing the <code class="literal">period</code> property to 0 (or a negative
      value). </em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-jdk-timer-method-invoking-task"></a>26.7.2&nbsp;Using the
      <code class="classname">MethodInvokingTimerTaskFactoryBean</code></h3></div></div></div><p>Similar to the Quartz support, the <code class="classname">Timer</code>
      support also features a component that allows you to periodically invoke
      a method:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"doIt"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.scheduling.timer.MethodInvokingTimerTaskFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetObject"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"exampleBusinessObject"</span> /&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetMethod"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"doIt"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The above example will result in the <code class="literal">doIt</code>
      method being called on the <code class="literal">exampleBusinessObject</code> (see
      below):</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BusinessObject {
  
  <span class="hl-comment">// properties and collaborators</span>
  
  <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doIt() {
    <span class="hl-comment">// do the actual work</span>
  }
}</pre><p>Changing the <code class="literal">timerTask</code> reference of the
      <code class="classname">ScheduledTimerTask</code> example to the bean
      <code class="literal">doIt</code> will result in the <code class="literal">doIt</code>
      method being executed on a fixed schedule.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="scheduling-jdk-timer-factory-bean"></a>26.7.3&nbsp;Wrapping up: setting up the tasks using the
      <code class="classname">TimerFactoryBean</code></h3></div></div></div><p>The <code class="classname">TimerFactoryBean</code> is similar to the
      Quartz <code class="classname">SchedulerFactoryBean</code> in that it serves the
      same purpose: setting up the actual scheduling. The
      <code class="classname">TimerFactoryBean</code> sets up an actual
      <code class="classname">Timer</code> and schedules the tasks it has references
      to. You can specify whether or not daemon threads should be used.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"timerFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.scheduling.timer.TimerFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"scheduledTimerTasks"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-comment">!-- see the example above --</span>&gt;
            &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"scheduledTask"</span> /&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="dynamic-language"></a>27.&nbsp;Dynamic language support</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dynamic-language-introduction"></a>27.1&nbsp;Introduction</h2></div></div></div><div class="sidebar"><p class="title"><b>Why only these languages?</b></p><p>
        The supported languages were chosen because a) the languages
        have a lot of traction in the Java enterprise community, b) no requests were made
        for other languages within the Spring 2.0 development timeframe, and
        c) the Spring developers were most familiar with them.
      </p><p>
        There is nothing stopping the inclusion of further languages though. If you want
        to see support for &lt;<span class="emphasis"><em>insert your favourite dynamic language here</em></span>&gt;,
        you can always raise an issue on Spring's
        <a class="ulink" href="http://opensource.atlassian.com/projects/spring/secure/Dashboard.jspa" target="_top">JIRA</a>
        page (or implement such support yourself).
      </p></div><p>Spring 2.0 introduces comprehensive support for using classes and objects that have
    been defined using a dynamic language (such as JRuby) with Spring.
    This support allows you to write any number of classes in a supported dynamic language,
    and have the Spring container transparently instantiate, configure and dependency inject the
    resulting objects.</p><p>The dynamic languages currently supported are:</p><div class="itemizedlist"><ul type="disc"><li><p>JRuby 0.9 / 1.0</p></li><li><p>Groovy 1.0 / 1.5</p></li><li><p>BeanShell 2.0</p></li></ul></div><p>
      Fully working examples of where this dynamic language support can be immediately useful
      are described in <a class="xref" href="#dynamic-language-scenarios" title="27.4&nbsp;Scenarios">Section&nbsp;27.4, &#8220;Scenarios&#8221;</a>.
    </p><p>
      <span class="emphasis"><em>Note:</em></span> Only the specific versions as listed above are supported
      in Spring 2.5. In particular, JRuby 1.1 (which introduced many incompatible API
      changes) is <span class="emphasis"><em>not</em></span> supported at this point of time.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dynamic-language-a-first-example"></a>27.2&nbsp;A first example</h2></div></div></div><p>
      This bulk of this chapter is concerned with describing the dynamic language support
      in detail. Before diving into all of the ins and outs of the dynamic language support,
      let's look at a quick example of a bean defined in a dynamic language.
      The dynamic language for this first bean is Groovy (the basis of this example
      was taken from the Spring test suite, so if you want to see equivalent examples
      in any of the other supported languages, take a look at the source code).
    </p><p>
      Find below the <code class="interfacename">Messenger</code> interface that the
      Groovy bean is going to be implementing, and note that this interface is defined
      in plain Java. Dependent objects that are injected with a reference to the
      <code class="interfacename">Messenger</code> won't know that the underlying
      implementation is a Groovy script.
    </p><pre class="programlisting">package org.springframework.scripting;

public interface Messenger {

    String getMessage();
}</pre><p>
      Here is the definition of a class that has a dependency on the
      <code class="interfacename">Messenger</code> interface.
    </p><pre class="programlisting">package org.springframework.scripting;

public class DefaultBookingService implements BookingService {

    private Messenger messenger;

    public void setMessenger(Messenger messenger) {
        this.messenger = messenger;
    }

    public void processBooking() {
        // use the injected Messenger object...
    }
}</pre><p>Here is an implementation of the <code class="interfacename">Messenger</code> interface
    in Groovy.</p><pre class="programlisting">// from the file 'Messenger.groovy'
package org.springframework.scripting.groovy;

// import the Messenger interface (written in Java) that is to be implemented
import org.springframework.scripting.Messenger

// define the implementation in Groovy
class GroovyMessenger implements Messenger {

    String message
}</pre><p>
      Finally, here are the bean definitions that will effect the injection of the
      Groovy-defined <code class="interfacename">Messenger</code> implementation into
      an instance of the <code class="classname">DefaultBookingService</code> class.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
        To use the custom dynamic language tags to define dynamic-language-backed beans,
        you need to have the XML Schema preamble at the top of your Spring XML
        configuration file. You also need to be using a Spring
        <code class="interfacename">ApplicationContext</code> implementation as your
        IoC container. Using the dynamic-language-backed beans with a plain
        <code class="interfacename">BeanFactory</code> implementation is supported,
        but you have to manage the plumbing of the Spring internals to do so.
      </p><p>For more information on schema-based configuration, see <a class="xref" href="#xsd-config" title="Appendix&nbsp;C.&nbsp;XML Schema-based configuration">Appendix&nbsp;C, <i>XML Schema-based configuration</i></a>.</p></td></tr></table></div><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span> <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:lang</span>=<span class="hl-value">"http://www.springframework.org/schema/lang"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang-3.0.xsd"</span>&gt;

    &lt;<span class="hl-comment">!-- this is the bean definition for the Groovy-backed Messenger implementation --</span>&gt;
    &lt;<span class="hl-tag">lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messenger"</span> <span class="hl-attribute">script-source</span>=<span class="hl-value">"classpath:Messenger.groovy"</span>&gt;
        &lt;<span class="hl-tag">lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"message"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"I Can Do The Frug"</span> /&gt;
    &lt;<span class="hl-tag">/lang:groovy</span>&gt;

    &lt;<span class="hl-comment">!-- an otherwise normal bean that will be injected by the Groovy-backed Messenger --</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.DefaultBookingService"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messenger"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"messenger"</span> /&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>
      The <code class="literal">bookingService</code> bean (a
      <code class="classname">DefaultBookingService</code>) can now use its private
      <code class="literal">messenger</code> member variable as normal because the
      <code class="interfacename">Messenger</code> instance that was injected
      into it <span class="emphasis"><em>is</em></span> a <code class="interfacename">Messenger</code>
      instance. There is nothing special going on here, just plain Java and
      plain Groovy.
    </p><p>
      Hopefully the above XML snippet is self-explanatory, but don't worry
      unduly if it isn't. Keep reading for the in-depth detail on the whys
      and wherefores of the above configuration.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dynamic-language-beans"></a>27.3&nbsp;Defining beans that are backed by dynamic languages</h2></div></div></div><p>
      This section describes exactly how you define Spring managed beans in
      any of the supported dynamic languages.
    </p><p>
      Please note that this chapter does not attempt to explain the syntax and
      idioms of the supported dynamic languages. For example, if you want to
      use Groovy to write certain of the classes in your application, then the
      assumption is that you already know Groovy. If you need further details
      about the dynamic languages themselves, please consult
      <a class="xref" href="#dynamic-language-resources" title="27.6&nbsp;Further Resources">Section&nbsp;27.6, &#8220;Further Resources&#8221;</a> at the end of this chapter.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-beans-concepts"></a>27.3.1&nbsp;Common concepts</h3></div></div></div><p>The steps involved in using dynamic-language-backed beans are as follows:</p><div class="orderedlist"><ol type="1"><li><p>Write the test for the dynamic language source code (naturally)</p></li><li><p><span class="emphasis"><em>Then</em></span> write the dynamic language source code itself :)</p></li><li><p>
            Define your dynamic-language-backed beans using the appropriate
            <code class="literal">&lt;lang:language/&gt;</code> element in the XML
            configuration (you can of course define such beans programmatically
            using the Spring API - although you will have to consult the source
            code for directions on how to do this as this type of advanced
            configuration is not covered in this chapter). Note this is an iterative
            step. You will need at least one bean definition per dynamic
            language source file (although the same dynamic language source
            file can of course be referenced by multiple bean definitions).
          </p></li></ol></div><p>
        The first two steps (testing and writing your dynamic language source files)
        are beyond the scope of this chapter. Refer to the language specification
        and / or reference manual for your chosen dynamic language and crack on with
        developing your dynamic language source files. You <span class="emphasis"><em>will</em></span>
        first want to read the rest of this chapter though, as Spring's dynamic language
        support does make some (small) assumptions about the contents of your dynamic
        language source files.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="dynamic-language-beans-concepts-xml-language-element"></a>27.3.1.1&nbsp;The <code class="literal">&lt;lang:language/&gt;</code> element</h4></div></div></div><div class="sidebar"><p class="title"><b>XML Schema</b></p><p>
            All of the configuration examples in this chapter make use of the
            new XML Schema support that was added in Spring 2.0.
          </p><p>It is possible to forego the use of XML Schema and stick with the old-style
          DTD based validation of your Spring XML files, but then you lose out
          on the convenience offered by the <code class="literal">&lt;lang:language/&gt;</code>
          element. See the Spring test suite for examples of the older style
          configuration that doesn't require XML Schema-based validation
          (it is quite verbose and doesn't hide any of the underlying Spring
          implementation from you).</p></div><p>
          The final step involves defining dynamic-language-backed bean definitions,
          one for each bean that you want to configure (this is no different from
          normal JavaBean configuration). However, instead of specifying the
          fully qualified classname of the class that is to be instantiated and
          configured by the container, you use the <code class="literal">&lt;lang:language/&gt;</code>
          element to define the dynamic language-backed bean.
        </p><p>
          Each of the supported languages has a corresponding
          <code class="literal">&lt;lang:language/&gt;</code> element:
        </p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">&lt;lang:jruby/&gt;</code> (JRuby)</p></li><li><p><code class="literal">&lt;lang:groovy/&gt;</code> (Groovy)</p></li><li><p><code class="literal">&lt;lang:bsh/&gt;</code> (BeanShell)</p></li></ul></div><p>
          The exact attributes and child elements that are available for
          configuration depends on exactly which language the bean has been
          defined in (the language-specific sections below provide the full
          lowdown on this).
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="dynamic-language-refreshable-beans"></a>27.3.1.2&nbsp;Refreshable beans</h4></div></div></div><p>
          One of the (if not <span class="emphasis"><em>the</em></span>) most compelling value adds
          of the dynamic language support in Spring is the
          <em class="firstterm">'refreshable bean'</em> feature.
        </p><p>
          A refreshable bean is a dynamic-language-backed bean that with a small
          amount of configuration, a dynamic-language-backed bean can monitor
          changes in its underlying source file resource, and then reload itself
          when the dynamic language source file is changed (for example when a
          developer edits and saves changes to the file on the filesystem).
        </p><p>
          This allows a developer to deploy any number of dynamic language source
          files as part of an application, configure the Spring container to create
          beans backed by dynamic language source files (using the mechanisms
          described in this chapter), and then later, as requirements change or
          some other external factor comes into play, simply edit a dynamic language
          source file and have any change they make reflected in the bean that is
          backed by the changed dynamic language source file. There is no need to
          shut down a running application (or redeploy in the case of a web application).
          The dynamic-language-backed bean so amended will pick up the new state
          and logic from the changed dynamic language source file.
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Please note that this feature is <span class="emphasis"><em>off</em></span> by default.</p></td></tr></table></div><p>
          Let's take a look at an example to see just how easy it is to start using
          refreshable beans. To <span class="emphasis"><em>turn on</em></span> the refreshable beans
          feature, you simply have to specify exactly <span class="emphasis"><em>one</em></span>
          additional attribute on the <code class="literal">&lt;lang:language/&gt;</code> element
          of your bean definition. So if we stick with
          <a class="link" href="#dynamic-language-a-first-example" title="27.2&nbsp;A first example">the example</a> from earlier
          in this chapter, here's what we would change in the Spring XML configuration
          to effect refreshable beans:
        </p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

    &lt;<span class="hl-comment">!-- this bean is now 'refreshable' due to the presence of the 'refresh-check-delay' attribute --</span>&gt;
    &lt;<span class="hl-tag">lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messenger"</span>
          <span class="hl-attribute">refresh-check-delay</span>=<span class="hl-value">"5000"</span> <span class="hl-attribute">&lt;!--</span> <span class="hl-attribute">switches</span> <span class="hl-attribute">refreshing</span> <span class="hl-attribute">on</span> <span class="hl-attribute">with</span> <span class="hl-attribute">5</span> <span class="hl-attribute">seconds</span> <span class="hl-attribute">between</span> <span class="hl-attribute">checks</span> <span class="hl-attribute">--&gt;</span>
          <span class="hl-attribute">script-source</span>=<span class="hl-value">"classpath:Messenger.groovy"</span>&gt;
        &lt;<span class="hl-tag">lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"message"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"I Can Do The Frug"</span> /&gt;
    &lt;<span class="hl-tag">/lang:groovy</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.DefaultBookingService"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messenger"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"messenger"</span> /&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>
          That really is all you have to do. The <code class="literal">'refresh-check-delay'</code>
          attribute defined on the <code class="literal">'messenger'</code> bean definition
          is the number of milliseconds after which the bean will be refreshed with
          any changes made to the underlying dynamic language source file.
          You can turn off the refresh behavior by assigning a negative value
          to the <code class="literal">'refresh-check-delay'</code> attribute.
          Remember that, by default, the refresh behavior is disabled. If you don't
          want the refresh behavior, then simply don't define the attribute.
        </p><p>
          If we then run the following application we can exercise the refreshable feature;
          please do excuse the <span class="emphasis"><em>'jumping-through-hoops-to-pause-the-execution'</em></span>
          shenanigans in this next slice of code. The <code class="literal">System.in.read()</code>
          call is only there so that the execution of the program pauses while I (the author)
          go off and edit the underlying dynamic language source file so that the refresh will
          trigger on the dynamic-language-backed bean when the program resumes execution.</p><pre class="programlisting">import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.scripting.Messenger;

public final class Boot {

    public static void main(final String[] args) throws Exception {

        ApplicationContext ctx = new ClassPathXmlApplicationContext("beans.xml");
        Messenger messenger = (Messenger) ctx.getBean("messenger");
        System.out.println(messenger.getMessage());
        // pause execution while I go off and make changes to the source file...
        System.in.read();
        System.out.println(messenger.getMessage());
    }
}</pre><p>
          Let's assume then, for the purposes of this example, that all
          calls to the <code class="literal">getMessage()</code> method of
          <code class="interfacename">Messenger</code> implementations have to be
          changed such that the message is surrounded by quotes.
          Below are the changes that I (the author) make to the
          <code class="filename">Messenger.groovy</code> source file when the execution of
          the program is paused.
        </p><pre class="programlisting">package org.springframework.scripting

class GroovyMessenger implements Messenger {

    private String message = "Bingo"

    public String getMessage() {
        // change the implementation to surround the message in quotes
        return "'" + this.message + "'"
    }

    public void setMessage(String message) {
        this.message = message
    }
}</pre><p>
          When the program executes, the output before the input pause will be
          <code class="computeroutput">I Can Do The Frug</code>. After the change
          to the source file is made and saved, and the program resumes execution,
          the result of calling the <code class="literal">getMessage()</code> method on the
          dynamic-language-backed <code class="interfacename">Messenger</code> implementation
          will be <code class="computeroutput">'I Can Do The Frug'</code> (notice
          the inclusion of the additional quotes).
        </p><p>
          It is important to understand that changes to a script will
          <span class="emphasis"><em>not</em></span> trigger a refresh if the changes occur
          within the window of the <code class="literal">'refresh-check-delay'</code> value.
          It is equally important to understand that changes to the script are
          <span class="emphasis"><em>not</em></span> actually 'picked up' until a method is called
          on the dynamic-language-backed bean. It is only when a method is called on a
          dynamic-language-backed bean that it checks to see if its underlying script
          source has changed. Any exceptions relating to refreshing the script
          (such as encountering a compilation error, or finding that the script
          file has been deleted) will result in a <span class="emphasis"><em>fatal</em></span>
          exception being propagated to the calling code.
        </p><p>
          The refreshable bean behavior described above does
          <span class="emphasis"><em>not</em></span> apply to dynamic language source files
          defined using the <code class="literal">&lt;lang:inline-script/&gt;</code> element
          notation (see <a class="xref" href="#dynamic-language-beans-inline" title="27.3.1.3&nbsp;Inline dynamic language source files">Section&nbsp;27.3.1.3, &#8220;Inline dynamic language source files&#8221;</a>).
          Additionally, it <span class="emphasis"><em>only</em></span> applies to beans where
          changes to the underlying source file can actually be detected;
          for example, by code that checks the last modified date of a
          dynamic language source file that exists on the filesystem.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="dynamic-language-beans-inline"></a>27.3.1.3&nbsp;Inline dynamic language source files</h4></div></div></div><p>
          The dynamic language support can also cater for dynamic language
          source files that are embedded directly in Spring bean definitions.
          More specifically, the <code class="literal">&lt;lang:inline-script/&gt;</code>
          element allows you to define dynamic language source immediately
          inside a Spring configuration file. An example will perhaps make the
          inline script feature crystal clear:
        </p><pre class="programlisting">&lt;<span class="hl-tag">lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messenger"</span>&gt;
    &lt;<span class="hl-tag">lang:inline-script</span>&gt;
package org.springframework.scripting.groovy;

import org.springframework.scripting.Messenger

class GroovyMessenger implements Messenger {

    String message
}
    &lt;<span class="hl-tag">/lang:inline-script</span>&gt;
    &lt;<span class="hl-tag">lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"message"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"I Can Do The Frug"</span> /&gt;
&lt;<span class="hl-tag">/lang:groovy</span>&gt;</pre><p>
          If we put to one side the issues surrounding whether it is good practice
          to define dynamic language source inside a Spring configuration file, the
          <code class="literal">&lt;lang:inline-script/&gt;</code> element can be useful in
          some scenarios. For instance, we might want to quickly add a Spring
          <code class="interfacename">Validator</code> implementation to a Spring MVC
          <code class="interfacename">Controller</code>. This is but a moment's work
          using inline source. (See <a class="xref" href="#dynamic-language-scenarios-validators" title="27.4.2&nbsp;Scripted Validators">Section&nbsp;27.4.2, &#8220;Scripted Validators&#8221;</a>
          for such an example.)
        </p><p>
          Find below an example of defining the source for a JRuby-based bean
          directly in a Spring XML configuration file using the
          <code class="literal">inline:</code> notation. (Notice the use of the &amp;lt;
          characters to denote a <code class="literal">'&lt;'</code> character. In such a case
          surrounding the inline source in a <code class="literal">&lt;![CDATA[]]&gt;</code> region might be better.)
        </p><pre class="programlisting">&lt;<span class="hl-tag">lang:jruby</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messenger"</span> <span class="hl-attribute">script-interfaces</span>=<span class="hl-value">"org.springframework.scripting.Messenger"</span>&gt;
    &lt;<span class="hl-tag">lang:inline-script</span>&gt;
require 'java'

include_class 'org.springframework.scripting.Messenger'

class RubyMessenger &amp;lt; Messenger

 def setMessage(message)
  @@message = message
 end

 def getMessage
  @@message
 end
 
end
    &lt;<span class="hl-tag">/lang:inline-script</span>&gt;
    &lt;<span class="hl-tag">lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"message"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Hello World!"</span> /&gt;
&lt;<span class="hl-tag">/lang:jruby</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="dynamic-language-beans-ctor-injection"></a>27.3.1.4&nbsp;Understanding Constructor Injection in the context of dynamic-language-backed beans</h4></div></div></div><p>
          There is one <span class="emphasis"><em>very</em></span> important thing to be aware of
          with regard to Spring's dynamic language support. Namely, it is not (currently)
          possible to supply constructor arguments to dynamic-language-backed beans (and hence
          constructor-injection is not available for dynamic-language-backed beans).
          In the interests of making this special handling of constructors and
          properties 100% clear, the following mixture of code and configuration
          will <span class="emphasis"><em>not</em></span> work.
        </p><pre class="programlisting">// from the file 'Messenger.groovy'
package org.springframework.scripting.groovy;

import org.springframework.scripting.Messenger

class GroovyMessenger implements Messenger {

    GroovyMessenger() {}

    // this constructor is not available for Constructor Injection
    GroovyMessenger(String message) {
        this.message = message;
    }

    String message

    String anotherMessage
}</pre><pre class="programlisting">&lt;<span class="hl-tag">lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">"badMessenger"</span>
    <span class="hl-attribute">script-source</span>=<span class="hl-value">"classpath:Messenger.groovy"</span>&gt;

    &lt;<span class="hl-comment">!-- this next constructor argument will *not* be injected into the GroovyMessenger --</span>&gt;
    &lt;<span class="hl-comment">!--     in fact, this isn't even allowed according to the schema --</span>&gt;
    &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">"This will *not* work"</span> /&gt;
    
    &lt;<span class="hl-comment">!-- only property values are injected into the dynamic-language-backed object --</span>&gt;
    &lt;<span class="hl-tag">lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"anotherMessage"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Passed straight through to the dynamic-language-backed object"</span> /&gt;

&lt;<span class="hl-tag">/lang</span>&gt;</pre><p>
          In practice this limitation is not as significant as it first appears since
          setter injection is the injection style favored by the overwhelming majority
          of developers anyway (let's leave the discussion as to whether that is a good
          thing to another day).
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-beans-jruby"></a>27.3.2&nbsp;JRuby beans</h3></div></div></div><div class="sidebar"><p class="title"><b>The JRuby library dependencies</b></p><p>
          The JRuby scripting support in Spring requires the following
          libraries to be on the classpath of your application.
          (The  versions listed just happen to be the versions that the
          Spring team used in the development of the JRuby scripting support;
          you may well be able to use another version of a specific library.)
        </p><div class="itemizedlist"><ul type="disc"><li><p><code class="filename">jruby.jar</code></p></li><li><p><code class="filename">cglib-nodep-2.1_3.jar</code></p></li></ul></div></div><p>From the JRuby homepage...</p>&#8220;<span class="quote">
        <span class="emphasis"><em>JRuby is an 100% pure-Java implementation of the Ruby programming language.</em></span>
      </span>&#8221;<p>
        In keeping with the Spring philosophy of offering choice, Spring's
        dynamic language support also supports beans defined in the JRuby
        language. The JRuby language is based on the quite intuitive
        Ruby language, and has support for inline regular expressions, blocks
        (closures), and a whole host of other features that do make solutions
        for some domain problems a whole lot easier to develop.
      </p><p>
        The implementation of the JRuby dynamic language support in Spring is
        interesting in that what happens is this: Spring creates a JDK dynamic
        proxy implementing all of the interfaces that are specified in the
        <code class="literal">'script-interfaces'</code> attribute value of the
        <code class="literal">&lt;lang:ruby&gt;</code> element (this is why
        you <span class="emphasis"><em>must</em></span> supply at least one interface in the value
        of the attribute, and (accordingly) program to interfaces when using
        JRuby-backed beans).
      </p><p>
        Let us look at a fully working example of using a JRuby-based bean. Here is
        the JRuby implementation of the <code class="interfacename">Messenger</code>
        interface that was defined earlier in this chapter (for your convenience it
        is repeated below).
      </p><pre class="programlisting">package org.springframework.scripting;

public interface Messenger {

    String getMessage();
}</pre><pre class="programlisting">require 'java'

class RubyMessenger
    include org.springframework.scripting.Messenger

    def setMessage(message)
        @@message = message
    end

    def getMessage
        @@message
    end
end

# this last line is not essential (but see below)
RubyMessenger.new</pre><p>
        And here is the Spring XML that defines an instance of the
        <code class="classname">RubyMessenger</code> JRuby bean.
      </p><pre class="programlisting">&lt;<span class="hl-tag">lang:jruby</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messageService"</span>
            <span class="hl-attribute">script-interfaces</span>=<span class="hl-value">"org.springframework.scripting.Messenger"</span>
            <span class="hl-attribute">script-source</span>=<span class="hl-value">"classpath:RubyMessenger.rb"</span>&gt;
    
    &lt;<span class="hl-tag">lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"message"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Hello World!"</span> /&gt;

&lt;<span class="hl-tag">/lang:jruby</span>&gt;</pre><p>
        Take note of the last line of that JRuby source (<code class="literal">'RubyMessenger.new'</code>).
        When using JRuby in the context of Spring's dynamic language support, you are encouraged
        to instantiate and return a new instance of the JRuby class that you want to use as a
        dynamic-language-backed bean as the result of the execution of your JRuby source. You
        can achieve this by simply instantiating a new instance of your JRuby class on the last
        line of the source file like so:
      </p><pre class="programlisting">require 'java'

include_class 'org.springframework.scripting.Messenger'

# class definition same as above...

# instantiate and return a new instance of the RubyMessenger class
RubyMessenger.new</pre><p>
        If you forget to do this, it is not the end of the world; this will however result in
        Spring having to trawl (reflectively) through the type representation of your JRuby class
        looking for a class to instantiate. In the grand scheme of things this will be so fast
        that you'll never notice it, but it is something that can be avoided by simply
        having a line such as the one above as the last line of your JRuby script. If you don't
        supply such a line, or if Spring cannot find a JRuby class in your script to instantiate
        then an opaque <code class="classname">ScriptCompilationException</code>
        will be thrown immediately after the source is executed by the JRuby
        interpreter. The key text that identifies this as the root cause of an
        exception can be found immediately below (so if your Spring container
        throws the following exception when creating your dynamic-language-backed bean
        and the following text is there in the corresponding stacktrace, this will hopefully
        allow you to identify and then easily rectify the issue):
      </p><code class="computeroutput">org.springframework.scripting.ScriptCompilationException: Compilation of JRuby script returned ''</code><p>
        To rectify this, simply instantiate a new instance of whichever class
        you want to expose as a JRuby-dynamic-language-backed bean (as shown above). Please
        also note that you can actually define as many classes and objects
        as you want in your JRuby script; what is important is that the
        source file as a whole must return an object (for Spring to configure).
      </p><p>
        See <a class="xref" href="#dynamic-language-scenarios" title="27.4&nbsp;Scenarios">Section&nbsp;27.4, &#8220;Scenarios&#8221;</a> for some
        scenarios where you might want to use JRuby-based beans.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-beans-groovy"></a>27.3.3&nbsp;Groovy beans</h3></div></div></div><div class="sidebar"><p class="title"><b>The Groovy library dependencies</b></p><p>
          The Groovy scripting support in Spring requires the following
          libraries to be on the classpath of your application.
        </p><div class="itemizedlist"><ul type="disc"><li><p><code class="filename">groovy-1.5.5.jar</code></p></li><li><p><code class="filename">asm-2.2.2.jar</code></p></li><li><p><code class="filename">antlr-2.7.6.jar</code></p></li></ul></div></div><p>From the Groovy homepage...</p>&#8220;<span class="quote">
        <span class="emphasis"><em>Groovy is an agile dynamic language for the Java 2 Platform that has
        many of the  features that people like so much in languages like Python, Ruby
        and Smalltalk, making them available to Java developers using a Java-like syntax.
        </em></span>
      </span>&#8221;<p>
        If you have read this chapter straight from the top, you will already have
        <a class="link" href="#dynamic-language-a-first-example" title="27.2&nbsp;A first example">seen an example</a> of a
        Groovy-dynamic-language-backed bean. Let's look at another example (again
        using an example from the Spring test suite).
      </p><pre class="programlisting">package org.springframework.scripting;

public interface Calculator {

    int add(int x, int y);
}</pre><p>
        Here is an implementation of the <code class="interfacename">Calculator</code>
        interface in Groovy.
      </p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">// from the file 'calculator.groovy'</span></em>
package org.springframework.scripting.groovy

class GroovyCalculator implements Calculator {

    int add(int x, int y) {
        x + y
    }
}</pre><pre class="programlisting">&lt;<span class="hl-tag">--</span> <span class="hl-attribute">from</span> <span class="hl-attribute">the</span> <span class="hl-attribute">file</span> <span class="hl-attribute">'beans.xml'</span> <span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;beans&gt;</span>
    <span class="hl-attribute">&lt;lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">"calculator"</span> <span class="hl-attribute">script-source</span>=<span class="hl-value">"classpath:calculator.groovy"</span>/&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>
        Lastly, here is a small application to exercise the above configuration.
      </p><pre class="programlisting">package org.springframework.scripting;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class Main {

    public static void Main(String[] args) {
        ApplicationContext ctx = new ClassPathXmlApplicationContext("beans.xml");
        Calculator calc = (Calculator) ctx.getBean("calculator");
        System.out.println(calc.add(2, 8));
    }
}</pre><p>
        The resulting output from running the above program will be
        (unsurprisingly) <code class="computeroutput">10</code>.
        (Exciting example, huh? Remember that the intent is to illustrate the
        concept. Please consult the dynamic language showcase project for a
        more complex example, or indeed <a class="xref" href="#dynamic-language-scenarios" title="27.4&nbsp;Scenarios">Section&nbsp;27.4, &#8220;Scenarios&#8221;</a>
        later in this chapter).
      </p><p>
        It is important that you <span class="emphasis"><em>do not</em></span> define more than one
        class per Groovy source file. While this is perfectly legal in Groovy, it
        is (arguably) a bad practice: in the interests of a consistent approach,
        you should (in the opinion of this author) respect the standard Java
        conventions of one (public) class per source file.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="dynamic-language-beans-groovy-customizer"></a>27.3.3.1&nbsp;Customising Groovy objects via a callback</h4></div></div></div><p>
          The <code class="interfacename">GroovyObjectCustomizer</code>
          interface is a callback that allows you to hook additional
          creation logic into the process of creating a Groovy-backed bean.
          For example, implementations of this interface could invoke
          any required initialization method(s), or set some default property
          values, or specify a custom <code class="classname">MetaClass</code>.
        </p><pre class="programlisting">public interface GroovyObjectCustomizer {

   void customize(GroovyObject goo);
}</pre><p>
          The Spring Framework will instantiate an instance of your Groovy-backed
          bean, and will then pass the created <code class="interfacename">GroovyObject</code>
          to the specified <code class="interfacename">GroovyObjectCustomizer</code>
          if one has been defined. You can do whatever you like with the supplied
          <code class="interfacename">GroovyObject</code> reference: it is expected
          that the setting of a custom <code class="classname">MetaClass</code> is what most
          folks will want to do with this callback, and you can see an example
          of doing that below.
        </p><pre class="programlisting">public final class SimpleMethodTracingCustomizer implements GroovyObjectCustomizer {

   public void customize(GroovyObject goo) {
      DelegatingMetaClass metaClass = new DelegatingMetaClass(goo.getMetaClass()) {

         public Object invokeMethod(Object object, String methodName, Object[] arguments) {
            System.out.println("Invoking '" + methodName + "'.");
            return super.invokeMethod(object, methodName, arguments);
         }
      };
      metaClass.initialize();
      goo.setMetaClass(metaClass);
   }
}</pre><p>
          A full discussion of meta-programming in Groovy is beyond the scope of the
          Spring reference manual. Consult the relevant section of the Groovy
          reference manual, or do a search online: there are plenty of articles
          concerning this topic.
          Actually making use of a <code class="interfacename">GroovyObjectCustomizer</code>
          is easy if you are using the Spring 2.0 namespace support.
        </p><pre class="programlisting">&lt;<span class="hl-comment">!-- define the GroovyObjectCustomizer just like any other bean --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"tracingCustomizer"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMethodTracingCustomizer"</span> /&gt;

   &lt;<span class="hl-comment">!-- ... and plug it into the desired Groovy bean via the 'customizer-ref' attribute --</span>&gt;
   &lt;<span class="hl-tag">lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">"calculator"</span>
      <span class="hl-attribute">script-source</span>=<span class="hl-value">"classpath:org/springframework/scripting/groovy/Calculator.groovy"</span>
      <span class="hl-attribute">customizer-ref</span>=<span class="hl-value">"tracingCustomizer"</span> /&gt;</pre><p>
          If you are not using the Spring 2.0 namespace support, you can still
          use the <code class="interfacename">GroovyObjectCustomizer</code> functionality.
        </p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"calculator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.scripting.groovy.GroovyScriptFactory"</span>&gt;
      &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">"classpath:org/springframework/scripting/groovy/Calculator.groovy"</span>/&gt;
      &lt;<span class="hl-comment">!-- define the GroovyObjectCustomizer (as an inner bean) --</span>&gt;
      &lt;<span class="hl-tag">constructor-arg</span>&gt;
         &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"tracingCustomizer"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMethodTracingCustomizer"</span> /&gt;
      &lt;<span class="hl-tag">/constructor-arg</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.scripting.support.ScriptFactoryPostProcessor"</span>/&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-beans-bsh"></a>27.3.4&nbsp;BeanShell beans</h3></div></div></div><div class="sidebar"><p class="title"><b>The BeanShell library dependencies</b></p><p>
          The BeanShell scripting support in Spring requires the following
          libraries to be on the classpath of your application.
        </p><div class="itemizedlist"><ul type="disc"><li><p><code class="filename">bsh-2.0b4.jar</code></p></li><li><p><code class="filename">cglib-nodep-2.1_3.jar</code></p></li></ul></div></div><p>From the BeanShell homepage...</p>&#8220;<span class="quote">
        <span class="emphasis"><em>BeanShell is a small, free, embeddable Java source interpreter
        with dynamic language features, written in Java. BeanShell dynamically
        executes standard Java syntax and extends it with common scripting
        conveniences such as loose types, commands, and method closures like those
        in Perl and JavaScript.</em></span>
      </span>&#8221;<p>
        In contrast to Groovy, BeanShell-backed bean definitions require some (small)
        additional configuration. The implementation of the BeanShell dynamic language
        support in Spring is interesting in that what happens is this: Spring creates
        a JDK dynamic proxy implementing all of the interfaces that are specified in the
        <code class="literal">'script-interfaces'</code> attribute value of the
        <code class="literal">&lt;lang:bsh&gt;</code> element (this is why
        you <span class="emphasis"><em>must</em></span> supply at least one interface in the value
        of the attribute, and (accordingly) program to interfaces when using
        BeanShell-backed beans). This means that every method call on a BeanShell-backed
        object is going through the JDK dynamic proxy invocation mechanism.
      </p><p>
        Let's look at a fully working example of using a BeanShell-based bean
        that implements the <code class="interfacename">Messenger</code> interface
        that was defined earlier in this chapter (repeated below for your
        convenience).
      </p><pre class="programlisting">package org.springframework.scripting;

public interface Messenger {

    String getMessage();
}</pre><p>Here is the BeanShell 'implementation' (the term is used loosely here) of the
          <code class="interfacename">Messenger</code> interface.</p><pre class="programlisting">String message;

String getMessage() {
    return message;
}

void setMessage(String aMessage) {
    message = aMessage;
}</pre><p>
        And here is the Spring XML that defines an 'instance' of the above 'class'
        (again, the term is used very loosely here).
      </p><pre class="programlisting">&lt;<span class="hl-tag">lang:bsh</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messageService"</span> <span class="hl-attribute">script-source</span>=<span class="hl-value">"classpath:BshMessenger.bsh"</span>
    <span class="hl-attribute">script-interfaces</span>=<span class="hl-value">"org.springframework.scripting.Messenger"</span>&gt;

    &lt;<span class="hl-tag">lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"message"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Hello World!"</span> /&gt;
&lt;<span class="hl-tag">/lang:bsh</span>&gt;</pre><p>See <a class="xref" href="#dynamic-language-scenarios" title="27.4&nbsp;Scenarios">Section&nbsp;27.4, &#8220;Scenarios&#8221;</a> for some
      scenarios where you might want to use BeanShell-based beans.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dynamic-language-scenarios"></a>27.4&nbsp;Scenarios</h2></div></div></div><p>
      The possible scenarios where defining Spring managed beans in a scripting
      language would be beneficial are, of course, many and varied. This section
      describes two possible use cases for the dynamic language support in Spring.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-scenarios-controllers"></a>27.4.1&nbsp;Scripted Spring MVC Controllers</h3></div></div></div><p>
        One group of classes that may benefit from using dynamic-language-backed
        beans is that of Spring MVC controllers. In pure Spring MVC applications,
        the  navigational flow through a web application is to a large extent
        determined by code encapsulated within your Spring MVC controllers.
        As the navigational flow and other presentation layer logic of a web
        application needs to be updated to respond to support issues or changing
        business requirements, it may well be easier to effect any such required
        changes  by editing one or more dynamic language source files and seeing
        those changes being immediately reflected in the state of a running
        application.
      </p><p>
        Remember that in the lightweight architectural model espoused by projects
        such as Spring, you are typically aiming to have a really
        <span class="emphasis"><em>thin</em></span> presentation layer, with all the meaty business
        logic of an application being contained in the domain and service layer
        classes. Developing Spring MVC controllers as dynamic-language-backed beans
        allows you to change presentation layer logic by simply editing and saving
        text files; any changes to such dynamic language source files will (depending
        on the configuration) automatically be reflected in the beans that are backed
              by dynamic language source files.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
          In order to effect this automatic 'pickup' of any changes
          to dynamic-language-backed beans, you will have had to enable the
          'refreshable beans' functionality. See
           <a class="xref" href="#dynamic-language-refreshable-beans" title="27.3.1.2&nbsp;Refreshable beans">Section&nbsp;27.3.1.2, &#8220;Refreshable beans&#8221;</a> for a full treatment
           of this feature.
        </p></td></tr></table></div><p>
        Find below an example of an
        <code class="interfacename">org.springframework.web.servlet.mvc.Controller</code>
        implemented using the Groovy dynamic language.
      </p><pre class="programlisting">// from the file '/WEB-INF/groovy/FortuneController.groovy'
package org.springframework.showcase.fortune.web

import org.springframework.showcase.fortune.service.FortuneService
import org.springframework.showcase.fortune.domain.Fortune
import org.springframework.web.servlet.ModelAndView
import org.springframework.web.servlet.mvc.Controller

import javax.servlet.http.HttpServletRequest
import javax.servlet.http.HttpServletResponse

class FortuneController implements Controller {

    @Property FortuneService fortuneService

    ModelAndView handleRequest(
            HttpServletRequest request, HttpServletResponse httpServletResponse) {

        return new ModelAndView("tell", "fortune", this.fortuneService.tellFortune())
    }
}</pre><pre class="programlisting">&lt;<span class="hl-tag">lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fortune"</span>
             <span class="hl-attribute">refresh-check-delay</span>=<span class="hl-value">"3000"</span>
             <span class="hl-attribute">script-source</span>=<span class="hl-value">"/WEB-INF/groovy/FortuneController.groovy"</span>&gt;
    &lt;<span class="hl-tag">lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"fortuneService"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"fortuneService"</span>/&gt;
&lt;<span class="hl-tag">/lang:groovy</span>&gt;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-scenarios-validators"></a>27.4.2&nbsp;Scripted Validators</h3></div></div></div><p>
        Another area of application development with Spring that may benefit
        from the flexibility afforded by dynamic-language-backed beans is that of
        validation. It <span class="emphasis"><em>may</em></span> be easier to express complex validation
        logic using a loosely typed dynamic language (that may also have support
        for inline regular expressions) as opposed to regular Java.
      </p><p>
        Again, developing validators as dynamic-language-backed beans allows you to change
        validation logic by simply editing and saving a simple text file; any such
        changes will (depending on the configuration) automatically be reflected
        in the execution of a running application and would not require the restart
        of an application.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
          Please note that in order to effect the automatic 'pickup' of any changes
          to dynamic-language-backed beans, you will have had to enable the
          'refreshable beans' feature. See 
          <a class="xref" href="#dynamic-language-refreshable-beans" title="27.3.1.2&nbsp;Refreshable beans">Section&nbsp;27.3.1.2, &#8220;Refreshable beans&#8221;</a> for a full and
          detailed treatment of this feature.
        </p></td></tr></table></div><p>
        Find below an example of a Spring
        <code class="interfacename">org.springframework.validation.Validator</code>
        implemented using the Groovy dynamic language. (See <a class="xref" href="#validator" title="6.2&nbsp;Validation using Spring's Validator interface">Section&nbsp;6.2, &#8220;Validation using Spring's Validator
      interface&#8221;</a>
        for a discussion of the <code class="interfacename">Validator</code> interface.)
      </p><pre class="programlisting">import org.springframework.validation.Validator
import org.springframework.validation.Errors
import org.springframework.beans.TestBean

class TestBeanValidator implements Validator {

    boolean supports(Class clazz) {
        return TestBean.class.isAssignableFrom(clazz)
    }
    
    void validate(Object bean, Errors errors) {
        if(bean.name?.trim()?.size() &gt; 0) {
            return
        }
        errors.reject("whitespace", "Cannot be composed wholly of whitespace.")
    }
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dynamic-language-final-notes"></a>27.5&nbsp;Bits and bobs</h2></div></div></div><p>
      This last section contains some bits and bobs related to the dynamic language
      support.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-final-notes-aop"></a>27.5.1&nbsp;AOP - advising scripted beans</h3></div></div></div><p>
        It is possible to use the Spring AOP framework to advise scripted beans.
        The Spring AOP framework actually is unaware that a bean that is being
        advised might be a scripted bean, so all of the AOP use cases and functionality
        that you may be using or aim to use will work with scripted beans. There is
        just one (small) thing that you need to be aware of when advising scripted
        beans... you cannot use class-based proxies, you must use
        <a class="link" href="#aop-proxying" title="8.6&nbsp;Proxying mechanisms">interface-based proxies</a>.
      </p><p>
        You are of course not just limited to advising scripted beans... you can
        also write aspects themselves in a supported dynamic language and use such
        beans to advise other Spring beans. This really would be an advanced use of
        the dynamic language support though.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic-language-final-notes-scopes"></a>27.5.2&nbsp;Scoping</h3></div></div></div><p>
        In case it is not immediately obvious, scripted beans can of course be scoped
        just like any other bean. The <code class="literal">scope</code> attribute on the
        various <code class="literal">&lt;lang:language/&gt;</code> elements allows you to
        control the scope of the underlying scripted bean, just as it does with a
        regular bean. (The default scope is
        <a class="link" href="#beans-factory-scopes-singleton" title="4.5.1&nbsp;The singleton scope">singleton</a>, just as it
        is with 'regular' beans.)
      </p><p>
        Find below an example of using the <code class="literal">scope</code> attribute
        to define a Groovy bean scoped as a
        <a class="link" href="#beans-factory-scopes-prototype" title="4.5.2&nbsp;The prototype scope">prototype</a>.
      </p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span> <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:lang</span>=<span class="hl-value">"http://www.springframework.org/schema/lang"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang-3.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messenger"</span> <span class="hl-attribute">script-source</span>=<span class="hl-value">"classpath:Messenger.groovy"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span>&gt;
        &lt;<span class="hl-tag">lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"message"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"I Can Do The RoboCop"</span> /&gt;
    &lt;<span class="hl-tag">/lang:groovy</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.DefaultBookingService"</span>&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messenger"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"messenger"</span> /&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>
        See <a class="xref" href="#beans-factory-scopes" title="4.5&nbsp;Bean scopes">Section&nbsp;4.5, &#8220;Bean scopes&#8221;</a> in <a class="xref" href="#beans" title="4.&nbsp;The IoC container">Chapter&nbsp;4, <i>The IoC container</i></a>
        for a fuller discussion of the scoping support in the Spring Framework.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dynamic-language-resources"></a>27.6&nbsp;Further Resources</h2></div></div></div><p>
      Find below links to further resources about the various dynamic languages described
      in this chapter.
    </p><div class="itemizedlist"><ul type="disc"><li><p>The <a class="ulink" href="http://jruby.codehaus.org/" target="_top">JRuby</a> homepage</p></li><li><p>The <a class="ulink" href="http://groovy.codehaus.org/" target="_top">Groovy</a> homepage</p></li><li><p>The <a class="ulink" href="http://www.beanshell.org/" target="_top">BeanShell</a> homepage</p></li></ul></div><p>
      Some of the more active members of the Spring community have also added support for
      a number of additional dynamic languages above and beyond the ones covered in this
      chapter. While it is possible that such third party contributions may be added to the
      list of languages supported by the main Spring distribution, your best bet for seeing
      if your favourite scripting language is supported is the
      <a class="ulink" href="https://springmodules.dev.java.net/" target="_top">Spring Modules project</a>.
    </p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="cache"></a>28.&nbsp;Cache Abstraction</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cache-introduction"></a>28.1&nbsp;Introduction</h2></div></div></div><p>Since version 3.1, Spring Framework provides support for transparently
		adding caching into an existing Spring application. Similar to the <a class="link" href="#transaction" title="11.&nbsp;Transaction Management">transaction</a>
		support, the caching abstraction allows consistent use of various caching
		solutions with minimal impact on the code.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cache-strategies"></a>28.2&nbsp;Understanding the cache abstraction</h2></div></div></div><div class="sidebar"><p class="title"><b>Cache vs Buffer</b></p><p>The terms "buffer" and "cache" tend to be used interchangeably; note however they represent different things.
	A buffer is used traditionally as an intermediate temporary store for data between a fast and a slow entity. As one
	party would have to <span class="emphasis"><em>wait</em></span> for the other affecting performance, the buffer alleviates this by
	allowing entire blocks of data to move at once rather then in small chunks. The data is written and read only once from
	the buffer. Furthermore, the buffers are <span class="emphasis"><em>visible</em></span> to at least one party which is aware of it.</p><p>A cache on the other hand by definition is hidden and neither party is aware that caching occurs.It as well improves
	performance but does that by allowing the same data to be read multiple times in a fast fashion.</p><p>A further explanation of the differences between two can be found
	<a class="ulink" href="http://en.wikipedia.org/wiki/Cache#The_difference_between_buffer_and_cache" target="_top">here</a>.</p></div><p>At its core, the abstraction applies caching to Java methods, reducing thus the number of executions based on the
	information available in the cache. That is, each time a <span class="emphasis"><em>targeted</em></span> method is invoked, the abstraction
	will apply a caching behaviour checking whether the method has been already executed for the given arguments. If it has,
	then the cached result is returned without having to execute the actual method; if it has not, then method is executed, the
	result cached and returned to the user so that, the next time the method is invoked, the cached result is returned.
	This way, expensive methods (whether CPU or IO bound) can be executed only once for a given set of parameters and the result
	reused without having to actually execute the method again. The caching logic is applied transparently without any interference
	to the invoker.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.gif"></td><th align="left">Important</th></tr><tr><td align="left" valign="top">Obviously this approach works only for methods that are guaranteed to return the same output (result) for a given input
	(or arguments) no matter how many times it is being executed.</td></tr></table></div><p>To use the cache abstraction, the developer needs to take care of two aspects:
	</p><div class="itemizedlist"><ul type="disc"><li>caching declaration - identify the methods that need to be cached and their policy</li><li>cache configuration - the backing cache where the data is stored and read from</li></ul></div><p>
	</p><p>Note that just like other services in Spring Framework, the caching service is an abstraction (not a cache implementation) and requires
	the use of an actual storage to store the cache data - that is, the abstraction frees the developer from having to write the caching
	logic but does not provide the actual stores. There are two integrations available out of the box, for JDK <code class="literal">java.util.concurrent.ConcurrentMap</code>
	and <a class="ulink" href="http://ehcache.org/" target="_top">Ehcache</a> - see <a class="xref" href="#cache-plug" title="28.6&nbsp;Plugging-in different back-end caches">Section&nbsp;28.6, &#8220;Plugging-in different back-end caches&#8221;</a> for more information on plugging in other cache stores/providers.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cache-annotations"></a>28.3&nbsp;Declarative annotation-based caching</h2></div></div></div><p>For caching declaration, the abstraction provides two Java annotations: <code class="literal">@Cacheable</code> and <code class="literal">@CacheEvict</code> which allow methods
	to trigger cache population or cache eviction. Let us take a closer look at each annotation:</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cache-annotations-cacheable"></a>28.3.1&nbsp;<code class="literal">@Cacheable</code> annotation</h3></div></div></div><p>As the name implies, <code class="literal">@Cacheable</code> is used to demarcate methods that are cacheable - that is, methods for whom the result is stored into the cache
		so on subsequent invocations (with the same arguments), the value in the cache is returned without having to actually execute the method. In its simplest form,
		the annotation declaration requires the name of the cache associated with the annotated method:</p><pre class="programlisting">@Cacheable(<span class="hl-string">"books"</span>)
<span class="hl-keyword">public</span> Book findBook(ISBN isbn) {...}</pre><p>In the snippet above, the method <code class="literal">findBook</code> is associated with the cache named <code class="literal">books</code>. Each time the method is called, the cache
		is checked to see whether the invocation has been already executed and does not have to be repeated. While in most cases, only one cache is declared, the annotation allows multiple
		names to be specified so that more then one cache are being used. In this case, each of the caches will be checked before executing the method - if at least one cache is hit,
		then the associated value will be returned:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">All the other caches that do not contain the method will be updated as well even though the cached method was not actually
		executed.</td></tr></table></div><pre class="programlisting">@Cacheable({ <span class="hl-string">"books"</span>, <span class="hl-string">"isbns"</span> })
<span class="hl-keyword">public</span> Book findBook(ISBN isbn) {...}</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="cache-annotations-cacheable-default-key"></a>28.3.1.1&nbsp;Default Key Generation</h4></div></div></div><p>Since caches are essentially key-value stores, each invocation of a cached method needs to be translated into a suitable key for cache access.
			Out of the box, the caching abstraction uses a simple <code class="interfacename">KeyGenerator</code> based on the following algorithm:</p><div class="itemizedlist"><ul type="disc"><li>If no params are given, return 0.</li><li>If only one param is given, return that instance.</li><li>If more the one param is given, return a key computed from the hashes of all parameters.</li></ul></div><p>
			This approach works well for objects with <span class="emphasis"><em>natural keys</em></span> as long as the <code class="literal">hashCode()</code> reflects that. If that is not the case then
			for distributed or persistent environments, the strategy needs to be changed as the objects hashCode is not preserved.
			In fact, depending on the JVM implementation or running conditions, the same hashCode can be reused for different objects, in the same VM instance.</p><p>To provide a different <span class="emphasis"><em>default</em></span> key generator, one needs to implement the <code class="interfacename">org.springframework.cache.KeyGenerator</code> interface.
			Once configured, the generator will be used for each declaration that doesn not specify its own key generation strategy (see below).
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="cache-annotations-cacheable-key"></a>28.3.1.2&nbsp;Custom Key Generation Declaration</h4></div></div></div><p>Since caching is generic, it is quite likely the target methods have various signatures that cannot be simply mapped on top of the cache structure. This tends to become
			obvious when the target method has multiple arguments out of which only some are suitable for caching (while the rest are used only by the method logic). For example:</p><pre class="programlisting">@Cacheable(<span class="hl-string">"books"</span>)
<span class="hl-keyword">public</span> Book findBook(ISBN isbn, <span class="hl-keyword">boolean</span> checkWarehouse, <span class="hl-keyword">boolean</span> includeUsed</pre><p>At first glance, while the two <code class="literal">boolean</code> arguments influence the way the book is found, they are no use for the cache. Further more what if only one of the two
			is important while the other is not?</p><p>For such cases, the <code class="literal">@Cacheable</code> annotation allows the user to specify how the key is generated through its <code class="literal">key</code> attribute.
			The developer can use <a class="link" href="#expressions" title="7.&nbsp;Spring Expression Language (SpEL)">SpEL</a> to pick the arguments of interest (or their nested properties), perform operations or even invoke arbitrary methods without
			having to write any code or implement any interface. This is the recommended approach over the <a class="link" href="#cache-annotations-cacheable-default-key" title="28.3.1.1&nbsp;Default Key Generation">default</a> generator since
			methods tend to be quite different in signatures as the code base grows; while the default strategy might work for some methods, it rarely does for all methods.</p><p>
			Below are some examples of various SpEL declarations - if you are not familiar with it, do yourself a favour and read <a class="xref" href="#expressions" title="7.&nbsp;Spring Expression Language (SpEL)">Chapter&nbsp;7, <i>Spring Expression Language (SpEL)</i></a>:
			</p><pre class="programlisting">
@Cacheable(value=<span class="hl-string">"books"</span>, key=<span class="hl-string">"#isbn"</span>
<span class="hl-keyword">public</span> Book findBook(ISBN isbn, <span class="hl-keyword">boolean</span> checkWarehouse, <span class="hl-keyword">boolean</span> includeUsed)


@Cacheable(value=<span class="hl-string">"books"</span>, key=<span class="hl-string">"#isbn.rawNumber"</span>)
<span class="hl-keyword">public</span> Book findBook(ISBN isbn, <span class="hl-keyword">boolean</span> checkWarehouse, <span class="hl-keyword">boolean</span> includeUsed)


@Cacheable(value=<span class="hl-string">"books"</span>, key=<span class="hl-string">"T(someType).hash(#isbn)"</span>)
<span class="hl-keyword">public</span> Book findBook(ISBN isbn, <span class="hl-keyword">boolean</span> checkWarehouse, <span class="hl-keyword">boolean</span> includeUsed)</pre><p>The snippets above, show how easy it is to select a certain argument, one of its properties or even an arbitrary (static) method.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="cache-annotations-cacheable-condition"></a>28.3.1.3&nbsp;Conditional caching</h4></div></div></div><p>Sometimes, a method might not be suitable for caching all the time (for example, it might depend on the given arguments). The cache annotations support such functionality
			through the <code class="literal">conditional</code> parameter which takes a <code class="literal">SpEL</code> expression that is evaluated to either <code class="literal">true</code> or <code class="literal">false</code>.
			If <code class="literal">true</code>, the method is cached - if not, it behaves as if the method is not cached, that is executed every since time no matter what values are in the cache or what
			arguments are used. A quick example - the following method will be cached, only if the argument <code class="literal">name</code> has a length shorter then 32:</p><pre class="programlisting">@Cacheable(value=<span class="hl-string">"book"</span>, condition=<span class="hl-string">"#name.length &lt; 32"</span>)
<span class="hl-keyword">public</span> Book findBook(String name)</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="cache-spel-context"></a>28.3.1.4&nbsp;Available caching <code class="literal">SpEL</code> evaluation context</h4></div></div></div><p>Each <code class="literal">SpEL</code> expression evaluates again a dedicated <code class="literal"><a class="link" href="#expressions-language-ref" title="7.5&nbsp;Language Reference">context</a></code>. In addition
			to the build in parameters, the framework provides dedicated caching related metadata such as the argument names. The next table lists the items made available to the context
			so one can use them for key and conditional(see next section) computations:</p><div class="table"><a name="cache-spel-context-tbl"></a><p class="title"><b>Table&nbsp;28.1.&nbsp;Cache SpEL available metadata</b></p><div class="table-contents"><table summary="Cache SpEL available metadata" width="100%" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Name</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Location</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Description</th><th style="border-bottom: 1.0pt solid ; ">Example</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">methodName</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">root object</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">The name of the method being invoked</td><td style="border-bottom: 1.0pt solid ; "><pre class="screen">#root.methodName</pre></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">method</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">root object</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">The method being invoked</td><td style="border-bottom: 1.0pt solid ; "><pre class="screen">#root.method.name</pre></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">target</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">root object</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">The target object being invoked</td><td style="border-bottom: 1.0pt solid ; "><pre class="screen">#root.target</pre></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">targetClass</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">root object</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">The class of the target being invoked</td><td style="border-bottom: 1.0pt solid ; "><pre class="screen">#root.targetClass</pre></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">args</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">root object</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">The arguments (as array) used for invoking the target</td><td style="border-bottom: 1.0pt solid ; "><pre class="screen">#root.args[0]</pre></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">caches</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">root object</td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Collection of caches against which the current method is executed</td><td style="border-bottom: 1.0pt solid ; "><pre class="screen">#root.caches[0].name</pre></td></tr><tr><td style="border-right: 1.0pt solid ; " align="center"><span class="emphasis"><em>argument name</em></span></td><td style="border-right: 1.0pt solid ; ">evaluation context</td><td style="border-right: 1.0pt solid ; ">Name of any of the method argument. If for some reason the names are not available (ex: no debug information),
							the argument names are also available under the <code class="literal">a&lt;#arg&gt;</code> where
							<span class="emphasis"><em>#arg</em></span> stands for the argument index (starting from 0).</td><td style=""><pre class="screen">iban</pre> or <pre class="screen">a0</pre> (one can also use <pre class="screen">p0</pre> or <code class="literal">p&lt;#arg&gt;</code> notation as an alias).</td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cache-annotations-put"></a>28.3.2&nbsp;<code class="literal">@CachePut</code> annotation</h3></div></div></div><p>For cases where the cache needs to be updated without interferring with the method execution, one can use the <code class="literal">@CachePut</code> annotation. That is, the method will always
		be executed and its result placed into the cache (according to the <code class="literal">@CachePut</code> options). It supports the same options as <code class="literal">@Cacheable</code> and should be used
		for cache population rather then method flow optimization.</p><p>Note that using <code class="literal">@CachePut</code> and <code class="literal">@Cacheable</code> annotations on the same method is generaly discouraged because they have different behaviours. While the latter
		causes the method execution to be skipped by using the cache, the former forces the execution in order to execute a cache update. This leads to unexpected behaviour and with the exception of specific
		corner-cases (such as annotations having conditions that exclude them from each other), such declarations should be avoided.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cache-annotations-evict"></a>28.3.3&nbsp;<code class="literal">@CacheEvict</code> annotation</h3></div></div></div><p>The cache abstraction allows not just population of a cache store but also eviction. This process is useful for removing stale or unused data from the cache. Opposed to
		<code class="literal">@Cacheable</code>, annotation <code class="literal">@CacheEvict</code> demarcates methods that perform cache <span class="emphasis"><em>eviction</em></span>, that is methods that act as triggers
		for removing data from the cache. Just like its sibling, <code class="literal">@CacheEvict</code> requires one to specify one (or multiple) caches that are affected by the action, allows a
		key or a condition to be specified but in addition, features an extra parameter <code class="literal">allEntries</code> which indicates whether a cache-wide eviction needs to be performed
		rather then just an entry one (based on the key):</p><pre class="programlisting">@CacheEvict(value = <span class="hl-string">"books"</span>, allEntries=true)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> loadBooks(InputStream batch)</pre><p>This option comes in handy when an entire cache region needs to be cleared out - rather then evicting each entry (which would take a long time since it is inefficient),
		all the entires are removed in one operation as shown above. Note that the framework will ignore any key specified in this scenario as it does not apply (the entire cache is evicted not just
		one entry).</p><p>One can also indicate whether the eviction should occur after (the default) or before the method executes through the <code class="literal">beforeInvocation</code> attribute.
		The former provides the same semantics as the rest of the annotations - once the method completes successfully, an action (in this case eviction) on the cache is executed. If the method does not
		execute (as it might be cached) or an exception is thrown, the eviction does not occur. The latter (<code class="literal">beforeInvocation=true</code>) causes the eviction to occur always, before the method
		is invoked - this is useful in cases where the eviction does not need to be tied to the method outcome.</p><p>It is important to note that void methods can be used with <code class="literal">@CacheEvict</code> - as the methods act as triggers, the return values are ignored (as they don't interact with
		the cache) - this is not the case with <code class="literal">@Cacheable</code> which adds/update data into the cache and thus requires a result.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cache-annotations-caching"></a>28.3.4&nbsp;<code class="literal">@Caching</code> annotation</h3></div></div></div><p>There are cases when multiple annotations of the same type, such as <code class="literal">@CacheEvict</code> or <code class="literal">@CachePut</code> need to be specified, for example because the condition or the key
		expression is different between different caches. Unfortunately Java does not support such declarations however there is a workaround - using a <span class="emphasis"><em>enclosing</em></span> annotation, in this case,
		<code class="literal">@Caching</code>. <code class="literal">@Caching</code> allows multiple nested <code class="literal">@Cacheable</code>, <code class="literal">@CachePut</code> and <code class="literal">@CacheEvict</code> to be used on the same method:</p><pre class="programlisting">@Caching(evict = { @CacheEvict(<span class="hl-string">"primary"</span>), @CacheEvict(value = <span class="hl-string">"secondary"</span>, key = <span class="hl-string">"#p0"</span>) })
<span class="hl-keyword">public</span> Book importBooks(String deposit, Date date)</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cache-annotation-enable"></a>28.3.5&nbsp;Enable caching annotations</h3></div></div></div><p>It is important to note that even though declaring the cache annotations does not automatically triggers their actions - like many things in Spring, the feature has to be declaratively
		enabled (which means if you ever suspect caching is to blame, you can disable it by removing only one configuration line rather then all the annotations in your code). In practice, this
		translates to one line that informs Spring that it should process the cache annotations, namely:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span> <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="hl-attribute">xmlns:cache</span>=<span class="hl-value">"http://www.springframework.org/schema/cache"</span>
	<span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd"</span>&gt;
	&lt;<span class="hl-tag">cache:annotation-driven</span> /&gt;
&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The namespace allows various options to be specified that influence the way the caching behaviour is added to the application through AOP. The configuration is similar (on purpose)
		with that of <code class="literal"><a class="ulink" href="tx-annotation-driven-settings" target="_top">tx:annotation-driven</a></code>:
		</p><div class="table"><a name="cache-annotation-driven-settings"></a><p class="title"><b>Table&nbsp;28.2.&nbsp;<code class="literal">&lt;cache:annotation-driven/&gt;</code>
			settings</b></p><div class="table-contents"><table summary="<cache:annotation-driven/&gt;&#xA;settings" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">Default</th><th style="border-bottom: 1.0pt solid ; ">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">cache-manager</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">cacheManager</td><td style="border-bottom: 1.0pt solid ; "><p>Name of cache manager to use. Only required
				if the name of the cache manager is not
				<code class="literal">cacheManager</code>, as in the example
				above.</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">mode</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">proxy</td><td style="border-bottom: 1.0pt solid ; "><p>The default mode "proxy" processes annotated
				beans to be proxied using Spring's AOP framework (following
				proxy semantics, as discussed above, applying to method calls
				coming in through the proxy only). The alternative mode
				"aspectj" instead weaves the affected classes with Spring's
				AspectJ caching aspect, modifying the target class byte
				code to apply to any kind of method call. AspectJ weaving
				requires spring-aspects.jar in the classpath as well as
				load-time weaving (or compile-time weaving) enabled. (See
				<a class="xref" href="#aop-aj-ltw-spring" title="8.8.4.5&nbsp;Spring configuration">Section&nbsp;8.8.4.5, &#8220;Spring configuration&#8221;</a> for details on how to set
				up load-time weaving.)</p></td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; "><code class="literal">proxy-target-class</code></td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; ">false</td><td style="border-bottom: 1.0pt solid ; "><p>Applies to proxy mode only. Controls what type of
				caching proxies are created for classes annotated with
				the <code class="interfacename">@Cacheable</code> or <code class="interfacename">@CacheEvict</code> annotations.
				If the <code class="literal">proxy-target-class</code> attribute is set
				to <code class="literal">true</code>, then class-based proxies are
				created. If <code class="literal">proxy-target-class</code> is
				<code class="literal">false</code> or if the attribute is omitted, then
				standard JDK interface-based proxies are created. (See <a class="xref" href="#aop-proxying" title="8.6&nbsp;Proxying mechanisms">Section&nbsp;8.6, &#8220;Proxying mechanisms&#8221;</a> for a detailed examination of the
				different proxy types.)</p></td></tr><tr><td style="border-right: 1.0pt solid ; "><code class="literal">order</code></td><td style="border-right: 1.0pt solid ; ">Ordered.LOWEST_PRECEDENCE</td><td style=""><p>Defines the order of the cache advice that
				is applied to beans annotated with
				<code class="interfacename">@Cacheable</code> or <code class="interfacename">@CacheEvict</code>.
				(For more
				information about the rules related to ordering of AOP advice,
				see <a class="xref" href="#aop-ataspectj-advice-ordering" title="8.2.4.7&nbsp;Advice ordering">Section&nbsp;8.2.4.7, &#8220;Advice ordering&#8221;</a>.) No
				specified ordering means that the AOP subsystem determines the
				order of the advice.</p></td></tr></tbody></table></div></div><p><br class="table-break"></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">&lt;cache:annotation-driven/&gt;</code> only looks for
		<code class="interfacename">@Cacheable/@CacheEvict</code> on beans in the same
		application context it is defined in. This means that, if you put
		<code class="literal">&lt;cache:annotation-driven/&gt;</code> in a
		<code class="interfacename">WebApplicationContext</code> for a
		<code class="classname">DispatcherServlet</code>, it only checks for
		<code class="interfacename">@Cacheable/@CacheEvict</code> beans in your
		controllers, and not your services. See <a class="xref" href="#mvc-servlet" title="16.2&nbsp;The DispatcherServlet">Section&nbsp;16.2, &#8220;The DispatcherServlet&#8221;</a> for more information.</p></td></tr></table></div><div class="sidebar"><p class="title"><b>Method visibility and
		<code class="interfacename">@Cacheable/@CachePut/@CacheEvict</code></b></p><p>When using proxies, you should apply the
		<code class="interfacename">@Cache*</code> annotations only to
		methods with <span class="emphasis"><em>public</em></span> visibility. If you do
		annotate protected, private or package-visible methods with these annotations,
		no error is raised, but the annotated method does not exhibit the configured
		caching settings. Consider the use of AspectJ (see below) if you
		need to annotate non-public methods as it changes the bytecode itself.</p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Spring recommends that you only annotate concrete classes (and
			methods of concrete classes) with the
			<code class="interfacename">@Cache*</code> annotation, as opposed
			to annotating interfaces. You certainly can place the
			<code class="interfacename">@Cache*</code> annotation on an
			interface (or an interface method), but this works only as you would
			expect it to if you are using interface-based proxies. The fact that
			Java annotations are <span class="emphasis"><em>not inherited from interfaces</em></span>
			means that if you are using class-based proxies
			(<code class="literal">proxy-target-class="true"</code>) or the weaving-based
			aspect (<code class="literal">mode="aspectj"</code>), then the caching
			settings are not recognized by the proxying and weaving
			infrastructure, and the object will not be wrapped in a
			caching proxy, which would be decidedly
			<span class="emphasis"><em>bad</em></span>.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In proxy mode (which is the default), only external method calls
		coming in through the proxy are intercepted. This means that
		self-invocation, in effect, a method within the target object calling
		another method of the target object, will not lead to an actual
		caching at runtime even if the invoked method is marked with
		<code class="interfacename">@Cacheable</code> - considering using the aspectj mode in this case.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cache-annotation-stereotype"></a>28.3.6&nbsp;Using custom annotations</h3></div></div></div><p>The caching abstraction allows one to use her own annotations to identify what method trigger cache population or eviction. This is quite handy as a template mechanism as it eliminates
		the need to duplicate cache annotation declarations (especially useful if the key or condition are specified) or if the foreign imports (<code class="literal">org.springframework</code>) are not allowed
		in your code base. Similar to the rest of the <a class="link" href="#beans-stereotype-annotations" title="4.10.1&nbsp;@Component and further stereotype annotations">stereotype</a> annotations, both <code class="literal">@Cacheable</code> and <code class="literal">@CacheEvict</code>
		can be used as meta-annotations, that is annotations that can annotate other annotations. To wit, let us replace a common <code class="literal">@Cacheable</code> declaration with our own, custom
		annotation:
		</p><pre class="programlisting">@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.METHOD})
@Cacheable(value=&#8220;books&#8221;, key=<span class="hl-string">"#isbn"</span>)
<span class="hl-keyword">public</span> @<span class="hl-keyword">interface</span> SlowService {
}</pre><p>Above, we have defined our own <code class="literal">SlowService</code> annotation which itself is annotated with <code class="literal">@Cacheable</code> - now we can replace the following code:</p><pre class="programlisting">@Cacheable(value=<span class="hl-string">"books"</span>, key=<span class="hl-string">"#isbn"</span>)
<span class="hl-keyword">public</span> Book findBook(ISBN isbn, <span class="hl-keyword">boolean</span> checkWarehouse, <span class="hl-keyword">boolean</span> includeUsed)</pre><p>with:</p><pre class="programlisting">@SlowService
<span class="hl-keyword">public</span> Book findBook(ISBN isbn, <span class="hl-keyword">boolean</span> checkWarehouse, <span class="hl-keyword">boolean</span> includeUsed)</pre><p>Even though <code class="literal">@SlowService</code> is not a Spring annotation, the container automatically picks up its declaration at runtime and understands its meaning. Note that as
		mentined <a class="link" href="#cache-annotation-enable" title="28.3.5&nbsp;Enable caching annotations">above</a>, the annotation-driven behaviour needs to be enabled.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cache-declarative-xml"></a>28.4&nbsp;Declarative XML-based caching</h2></div></div></div><p>If annotations are not an option (no access to the sources or no external code), one can use XML for declarative caching. So instead of annotating the methods for caching, one specifies
		the target method and the caching directives externally (similar to the declarative transaction management <a class="link" href="#transaction-declarative-first-example" title="11.5.2&nbsp;Example of declarative transaction implementation">advice</a>). The previous example
		can be translated into:</p><pre class="programlisting">&lt;<span class="hl-comment">!-- the service we want to make cacheable --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultBookService"</span>/&gt;

&lt;<span class="hl-comment">!-- cache definitions --</span>&gt;
&lt;<span class="hl-tag">cache:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"cacheAdvice"</span> <span class="hl-attribute">cache-manager</span>=<span class="hl-value">"cacheManager"</span>&gt;
	&lt;<span class="hl-tag">cache:caching</span> <span class="hl-attribute">cache</span>=<span class="hl-value">"books"</span>&gt;
		&lt;<span class="hl-tag">cache:cacheable</span> <span class="hl-attribute">method</span>=<span class="hl-value">"findBook"</span> <span class="hl-attribute">key</span>=<span class="hl-value">"#isbn"</span>/&gt;
		&lt;<span class="hl-tag">cache:cache-evict</span> <span class="hl-attribute">method</span>=<span class="hl-value">"loadBooks"</span> <span class="hl-attribute">all-entries</span>=<span class="hl-value">"true"</span>/&gt;
	&lt;<span class="hl-tag">/cache:caching</span>&gt;
&lt;<span class="hl-tag">/cache:advice</span>&gt;

&lt;<span class="hl-comment">!-- apply the cacheable behaviour to all BookService interfaces --</span>&gt;
&lt;<span class="hl-tag">aop:config</span>&gt;
	&lt;<span class="hl-tag">aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"cacheAdvice"</span> <span class="hl-attribute">pointcut</span>=<span class="hl-value">"execution(* x.y.BookService.*(..))"</span>/&gt;
&lt;<span class="hl-tag">/aop:config</span>&gt;
...
// cache manager definition omitted

		</pre><p>In the configuration above, the <code class="literal">bookService</code> is made cacheable. The caching semantics to apply are encapsulated in the <code class="literal">cache:advice</code> definition which
		instructs method <code class="literal">findBooks</code> to be used for putting data into the cache while method <code class="literal">loadBooks</code> for evicting data. Both definitions are working against the
		<code class="literal">books</code> cache.</p><p>The <code class="literal">aop:config</code> definition applies the cache advice to the appropriate points in the program by using the AspectJ pointcut expression (more information is available
		in <a class="xref" href="#aop" title="8.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;8, <i>Aspect Oriented Programming with Spring</i></a>). In the example above, all methods from the <code class="interfacename">BookService</code> are considered and the cache advice applied to them.</p><p>The declarative XML caching supports all of the annotation-based model so moving between the two should be fairly easy - further more both can be used inside the same application.
		The XML based approach does not touch the target code however it is inherently more verbose; when dealing with classes with overloaded methods that are targeted for caching, identifying the
		proper methods does take an extra effort since the <code class="literal">method</code> argument is not a good discriminator - in these cases, the AspectJ pointcut can be used to cherry pick the target
		methods and apply the appropriate caching functionality. Howeve through XML, it is easier to apply a package/group/interface-wide caching (again due to the AspectJ poincut) and to create
		template-like definitions (as we did in the example above by defining the target cache through the <code class="literal">cache:definitions </code><code class="literal">cache</code> attribute).
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cache-store-configuration"></a>28.5&nbsp;Configuring the cache storage</h2></div></div></div><p>Out of the box, the cache abstraction provides integration with two storages - one on top of the JDK <code class="interfacename">ConcurrentMap</code> and one
	for <a class="ulink" href="ehcache.org" target="_top">ehcache</a> library. To use them, one needs to simply declare an appropriate <code class="interfacename">CacheManager</code> - an entity that controls and manages
	<code class="interfacename">Cache</code>s and can be used to retrieve these for storage.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cache-store-configuration-jdk"></a>28.5.1&nbsp;JDK <code class="interfacename">ConcurrentMap</code>-based <code class="interfacename">Cache</code></h3></div></div></div><p>The JDK-based <code class="interfacename">Cache</code> implementation resides under <code class="literal">org.springframework.cache.concurrent</code> package. It allows one to use <code class="classname">
		ConcurrentHashMap</code> as a backing <code class="interfacename">Cache</code> store.</p><pre class="programlisting">&lt;<span class="hl-comment">!-- generic cache manager --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"cacheManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.cache.support.SimpleCacheManager"</span>&gt;
	&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"caches"</span>&gt;
	&lt;<span class="hl-tag">set</span>&gt;
		&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean"</span> <span class="hl-attribute">p:name</span>=<span class="hl-value">"default"</span>/&gt;
		&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean"</span> <span class="hl-attribute">p:name</span>=<span class="hl-value">"books"</span>/&gt;
	&lt;<span class="hl-tag">/set</span>&gt;
	&lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The snippet above uses the <code class="classname">SimpleCacheManager</code> to create a <code class="interfacename">CacheManager</code> for the two, nested <code class="interfacename">Concurrent</code>
		<code class="interfacename">Cache</code> implementations named <span class="emphasis"><em>default</em></span> and <span class="emphasis"><em>books</em></span>.
		Note that the names are configured directly for each cache.</p><p>As the cache is created by the application, it is bound to its lifecycle, making it suitable for basic use cases, tests or simple applications. The cache scales well and is very fast
		but it does not provide any management or persistence capabilities nor eviction contracts.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cache-store-configuration-ehcache"></a>28.5.2&nbsp;Ehcache-based <code class="interfacename">Cache</code></h3></div></div></div><p>The Ehcache implementation is located under <code class="literal">org.springframework.cache.ehcache</code> package. Again, to use it, one simply needs to declare the appropriate
		<code class="interfacename">CacheManager</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"cacheManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.cache.ehcache.EhCacheCacheManager"</span> <span class="hl-attribute">p:cache-manager-ref</span>=<span class="hl-value">"ehcache"</span>/&gt;

&lt;<span class="hl-comment">!-- Ehcache library setup --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"ehcache"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.cache.ehcache.EhCacheManagerFactoryBean"</span> <span class="hl-attribute">p:config-location</span>=<span class="hl-value">"ehcache.xml"</span>/&gt;</pre><p>This setup bootstraps ehcache library inside Spring IoC (through bean <code class="literal">ehcache</code>) which is then wired into the dedicated <code class="interfacename">CacheManager</code>
		implementation. Note the entire ehcache-specific configuration is read from the resource <code class="literal">ehcache.xml</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cache-store-configuration-noop"></a>28.5.3&nbsp;Dealing with caches without a backing store</h3></div></div></div><p>Sometimes when switching environments or doing testing, one might have cache declarations without an actual backing cache configured. As this is an invalid configuration, at runtime an
		exception will be through since the caching infrastructure is unable to find a suitable store. In situations like this, rather then removing the cache declarations (which can prove tedious),
		one can wire in a simple, dummy cache that performs no caching - that is, forces the cached methods to be executed every time:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"cacheManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.cache.support.CompositeCacheManager"</span>&gt;
	&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"cacheManagers"</span>&gt;&lt;<span class="hl-tag">list</span>&gt;
		&lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"jdkCache"</span>/&gt;
		&lt;<span class="hl-tag">ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"gemfireCache"</span>/&gt;
	&lt;<span class="hl-tag">/list</span>&gt;&lt;<span class="hl-tag">/property</span>&gt;
	&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"addNoOpCache"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The <code class="literal">CompositeCacheManager</code> above chains multiple <code class="literal">CacheManager</code>s and aditionally, through the <code class="literal">addNoOpManager</code> flag, adds a
		<span class="emphasis"><em>no op</em></span> cache that for all the definitions not handled by the configured cache managers. That is, every cache definition not found in either <code class="literal">jdkCache</code>
		or <code class="literal">gemfireCache</code> (configured above) will be handled by the no op cache, which will not store any information causing the target method to be executed every time.
		</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cache-plug"></a>28.6&nbsp;Plugging-in different back-end caches</h2></div></div></div><p>Clearly there are plenty of caching products out there that can be used as a backing store. To plug them in, one needs to provide a <code class="interfacename">CacheManager</code> and
	<code class="interfacename">Cache</code> implementation since unfortunately there is no available standard that we can use instead. This may sound harder then it is since in practice,
	the classes tend to be simple <a class="ulink" href="http://en.wikipedia.org/wiki/Adapter_pattern" target="_top">adapter</a>s that map the caching abstraction framework on top of the storage API as the <code class="literal">ehcache</code> classes can show.
	Most <code class="interfacename">CacheManager</code> classes can use the classes in <code class="literal">org.springframework.cache.support</code> package, such as <code class="classname">AbstractCacheManager</code>
	which takes care of the boiler-plate code leaving only the actual <span class="emphasis"><em>mapping</em></span> to be completed. We hope that in time, the libraries that provide integration with Spring
	can fill in this small configuration gap.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cache-specific-config"></a>28.7&nbsp;How can I set the TTL/TTI/Eviction policy/XXX feature?</h2></div></div></div><p>Directly through your cache provider. The cache abstraction is... well, an abstraction not a cache implementation. The solution you are using might support various data policies and different
		topologies which other solutions do not (take for example the JDK <code class="literal">ConcurrentHashMap</code>) - exposing that in the cache abstraction would be useless simply because there would
		no backing support. Such functionality should be controlled directly through the backing cache, when configuring it or through its native API.
	</p></div></div></div><div class="part" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="spring-appendices"></a>Part&nbsp;VII.&nbsp;Appendices</h1></div></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="classic-spring"></a>Appendix&nbsp;A.&nbsp;Classic Spring Usage</h2></div></div></div><p>This appendix discusses some classic Spring usage patterns as a
  reference for developers maintaining legacy Spring applications. These usage
  patterns no longer reflect the recommended way of using these features and
  the current recommended usage is covered in the respective sections of the
  reference manual.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="classic-spring-orm"></a>A.1&nbsp;Classic ORM usage</h2></div></div></div><p>This section documents the classic usage patterns that you might
    encounter in a legacy Spring application. For the currently recommended
    usage patterns, please refer to the <a class="xref" href="#orm" title="14.&nbsp;Object Relational Mapping (ORM) Data Access">Chapter&nbsp;14, <i>Object Relational Mapping (ORM) Data Access</i></a> chapter.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-spring-hibernate"></a>A.1.1&nbsp;Hibernate</h3></div></div></div><p>For the currently recommended usage patterns for Hibernate see
      <a class="xref" href="#orm-hibernate" title="14.3&nbsp;Hibernate">Section&nbsp;14.3, &#8220;Hibernate&#8221;</a></p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-hibernate-template"></a>A.1.1.1&nbsp;The <code class="classname">HibernateTemplate</code></h4></div></div></div><p>The basic programming model for templating looks as follows, for
        methods that can be part of any custom data access object or business
        service. There are no restrictions on the implementation of the
        surrounding object at all, it just needs to provide a Hibernate
        <code class="interfacename">SessionFactory</code>. It can get the latter
        from anywhere, but preferably as bean reference from a Spring IoC
        container - via a simple
        <code class="methodname">setSessionFactory(..)</code> bean property setter.
        The following snippets show a DAO definition in a Spring container,
        referencing the above defined
        <code class="interfacename">SessionFactory</code>, and an example for a
        DAO method implementation.</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductDaoImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"mySessionFactory"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductDaoImpl <span class="hl-keyword">implements</span> ProductDao {

    <span class="hl-keyword">private</span> HibernateTemplate hibernateTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSessionFactory(SessionFactory sessionFactory) {
        <span class="hl-keyword">this</span>.hibernateTemplate = <span class="hl-keyword">new</span> HibernateTemplate(sessionFactory);
    }

    <span class="hl-keyword">public</span> Collection loadProductsByCategory(String category) <span class="hl-keyword">throws</span> DataAccessException {
    	<span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.hibernateTemplate.find(<span class="hl-string">"from test.Product product where product.category=?"</span>, category);
    }
}</pre><p>The <code class="classname">HibernateTemplate</code> class provides many
        methods that mirror the methods exposed on the Hibernate
        <code class="interfacename">Session</code> interface, in addition to a
        number of convenience methods such as the one shown above. If you need
        access to the <code class="interfacename">Session</code> to invoke methods
        that are not exposed on the <code class="classname">HibernateTemplate</code>,
        you can always drop down to a callback-based approach like so.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductDaoImpl <span class="hl-keyword">implements</span> ProductDao {

    <span class="hl-keyword">private</span> HibernateTemplate hibernateTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSessionFactory(SessionFactory sessionFactory) {
        <span class="hl-keyword">this</span>.hibernateTemplate = <span class="hl-keyword">new</span> HibernateTemplate(sessionFactory);
    }

    <span class="hl-keyword">public</span> Collection loadProductsByCategory(<span class="hl-keyword">final</span> String category) <span class="hl-keyword">throws</span> DataAccessException {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.hibernateTemplate.execute(<span class="hl-keyword">new</span> HibernateCallback() {

            <span class="hl-keyword">public</span> Object doInHibernate(Session session) {
                Criteria criteria = session.createCriteria(Product.<span class="hl-keyword">class</span>);
                criteria.add(Expression.eq(<span class="hl-string">"category"</span>, category));
                criteria.setMaxResults(6);
                <span class="hl-keyword">return</span> criteria.list();
            }
        };
    }
}</pre><p>A callback implementation effectively can be used for any
        Hibernate data access. <code class="classname">HibernateTemplate</code> will
        ensure that <code class="interfacename">Session</code> instances are
        properly opened and closed, and automatically participate in
        transactions. The template instances are thread-safe and reusable,
        they can thus be kept as instance variables of the surrounding class.
        For simple single step actions like a single find, load, saveOrUpdate,
        or delete call, <code class="classname">HibernateTemplate</code> offers
        alternative convenience methods that can replace such one line
        callback implementations. Furthermore, Spring provides a convenient
        <code class="classname">HibernateDaoSupport</code> base class that provides a
        <code class="methodname">setSessionFactory(..)</code> method for receiving a
        <code class="interfacename">SessionFactory</code>, and
        <code class="methodname">getSessionFactory()</code> and
        <code class="methodname">getHibernateTemplate()</code>for use by subclasses.
        In combination, this allows for very simple DAO implementations for
        typical requirements:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductDaoImpl <span class="hl-keyword">extends</span> HibernateDaoSupport <span class="hl-keyword">implements</span> ProductDao {

    <span class="hl-keyword">public</span> Collection loadProductsByCategory(String category) <span class="hl-keyword">throws</span> DataAccessException {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.getHibernateTemplate().find(
            <span class="hl-string">"from test.Product product where product.category=?"</span>, category);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-hibernate-daos"></a>A.1.1.2&nbsp;Implementing Spring-based DAOs without callbacks</h4></div></div></div><p>As alternative to using Spring's
        <code class="classname">HibernateTemplate</code> to implement DAOs, data
        access code can also be written in a more traditional fashion, without
        wrapping the Hibernate access code in a callback, while still
        respecting and participating in Spring's generic
        <code class="classname">DataAccessException</code> hierarchy. The
        <code class="classname">HibernateDaoSupport</code> base class offers methods
        to access the current transactional
        <code class="interfacename">Session</code> and to convert exceptions in
        such a scenario; similar methods are also available as static helpers
        on the <code class="classname">SessionFactoryUtils</code> class. Note that
        such code will usually pass '<code class="literal">false</code>' as the value of
        the <code class="methodname">getSession(..)</code> methods
        '<code class="literal">allowCreate</code>' argument, to enforce running within a
        transaction (which avoids the need to close the returned
        <code class="interfacename">Session</code>, as its lifecycle is managed by
        the transaction).</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HibernateProductDao <span class="hl-keyword">extends</span> HibernateDaoSupport <span class="hl-keyword">implements</span> ProductDao {

    <span class="hl-keyword">public</span> Collection loadProductsByCategory(String category) <span class="hl-keyword">throws</span> DataAccessException, MyException {
        Session session = getSession(false);
        <span class="hl-keyword">try</span> {
            Query query = session.createQuery(<span class="hl-string">"from test.Product product where product.category=?"</span>);
            query.setString(0, category);
            List result = query.list();
            <span class="hl-keyword">if</span> (result == null) {
                <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> MyException(<span class="hl-string">"No search results."</span>);
            }
            <span class="hl-keyword">return</span> result;
        }
        <span class="hl-keyword">catch</span> (HibernateException ex) {
            <span class="hl-keyword">throw</span> convertHibernateAccessException(ex);
        }
    }
}</pre><p>The advantage of such direct Hibernate access code is that it
        allows <span class="emphasis"><em>any</em></span> checked application exception to be
        thrown within the data access code; contrast this to the
        <code class="classname">HibernateTemplate</code> class which is restricted to
        throwing only unchecked exceptions within the callback. Note that you
        can often defer the corresponding checks and the throwing of
        application exceptions to after the callback, which still allows
        working with <code class="classname">HibernateTemplate</code>. In general, the
        <code class="classname">HibernateTemplate</code> class' convenience methods
        are simpler and more convenient for many scenarios.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-spring-jdo"></a>A.1.2&nbsp;JDO</h3></div></div></div><p>For the currently recommended usage patterns for JDO see <a class="xref" href="#orm-jdo" title="14.4&nbsp;JDO">Section&nbsp;14.4, &#8220;JDO&#8221;</a></p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jdo-template"></a>A.1.2.1&nbsp;<code class="classname">JdoTemplate</code> and
        <code class="classname">JdoDaoSupport</code></h4></div></div></div><p>Each JDO-based DAO will then receive the
        <code class="interfacename">PersistenceManagerFactory</code> through
        dependency injection. Such a DAO could be coded against plain JDO API,
        working with the given
        <code class="interfacename">PersistenceManagerFactory</code>, but will
        usually rather be used with the Spring Framework's
        <code class="classname">JdoTemplate</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;
  
  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductDaoImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"persistenceManagerFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myPmf"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;
  
&lt;<span class="hl-tag">/beans</span>&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductDaoImpl <span class="hl-keyword">implements</span> ProductDao {
  
    <span class="hl-keyword">private</span> JdoTemplate jdoTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setPersistenceManagerFactory(PersistenceManagerFactory pmf) {
        <span class="hl-keyword">this</span>.jdoTemplate = <span class="hl-keyword">new</span> JdoTemplate(pmf);
    }

    <span class="hl-keyword">public</span> Collection loadProductsByCategory(<span class="hl-keyword">final</span> String category) <span class="hl-keyword">throws</span> DataAccessException {
        <span class="hl-keyword">return</span> (Collection) <span class="hl-keyword">this</span>.jdoTemplate.execute(<span class="hl-keyword">new</span> JdoCallback() {
            <span class="hl-keyword">public</span> Object doInJdo(PersistenceManager pm) <span class="hl-keyword">throws</span> JDOException {
                Query query = pm.newQuery(Product.<span class="hl-keyword">class</span>, <span class="hl-string">"category = pCategory"</span>);
                query.declareParameters(<span class="hl-string">"String pCategory"</span>); 
                List result = query.execute(category);
                <span class="hl-comment">// do some further stuff with the result list</span>
                <span class="hl-keyword">return</span> result;
            }
        });
    }
}</pre><p>A callback implementation can effectively be used for any JDO
        data access. <code class="classname">JdoTemplate</code> will ensure that
        <code class="classname">PersistenceManager</code>s are properly opened and
        closed, and automatically participate in transactions. The template
        instances are thread-safe and reusable, they can thus be kept as
        instance variables of the surrounding class. For simple single-step
        actions such as a single <code class="literal">find</code>,
        <code class="literal">load</code>, <code class="literal">makePersistent</code>, or
        <code class="literal">delete</code> call, <code class="classname">JdoTemplate</code>
        offers alternative convenience methods that can replace such one line
        callback implementations. Furthermore, Spring provides a convenient
        <code class="classname">JdoDaoSupport</code> base class that provides a
        <code class="literal">setPersistenceManagerFactory(..)</code> method for
        receiving a <code class="classname">PersistenceManagerFactory</code>, and
        <code class="methodname">getPersistenceManagerFactory()</code> and
        <code class="methodname">getJdoTemplate()</code> for use by subclasses. In
        combination, this allows for very simple DAO implementations for
        typical requirements:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductDaoImpl <span class="hl-keyword">extends</span> JdoDaoSupport <span class="hl-keyword">implements</span> ProductDao {
  
    <span class="hl-keyword">public</span> Collection loadProductsByCategory(String category) <span class="hl-keyword">throws</span> DataAccessException {
        <span class="hl-keyword">return</span> getJdoTemplate().find(
            Product.<span class="hl-keyword">class</span>, <span class="hl-string">"category = pCategory"</span>, <span class="hl-string">"String category"</span>, <span class="hl-keyword">new</span> Object[] {category});
    }
}</pre><p>As alternative to working with Spring's
        <code class="classname">JdoTemplate</code>, you can also code Spring-based
        DAOs at the JDO API level, explicitly opening and closing a
        <code class="interfacename">PersistenceManager</code>. As elaborated in
        the corresponding Hibernate section, the main advantage of this
        approach is that your data access code is able to throw checked
        exceptions. <code class="classname">JdoDaoSupport</code> offers a variety of
        support methods for this scenario, for fetching and releasing a
        transactional <code class="interfacename">PersistenceManager</code> as
        well as for converting exceptions.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-spring-jpa"></a>A.1.3&nbsp;JPA</h3></div></div></div><p>For the currently recommended usage patterns for JPA see <a class="xref" href="#orm-jpa" title="14.5&nbsp;JPA">Section&nbsp;14.5, &#8220;JPA&#8221;</a></p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jpa-template"></a>A.1.3.1&nbsp;<code class="classname">JpaTemplate</code> and
        <code class="classname">JpaDaoSupport</code></h4></div></div></div><p>Each JPA-based DAO will then receive a
        <code class="interfacename">EntityManagerFactory</code> via dependency
        injection. Such a DAO can be coded against plain JPA and work with the
        given <code class="interfacename">EntityManagerFactory</code> or through
        Spring's <code class="classname">JpaTemplate</code>:</p><pre class="programlisting">&lt;<span class="hl-tag">beans</span>&gt;

  &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myProductDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"product.ProductDaoImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"entityManagerFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myEmf"</span>/&gt;
  &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JpaProductDao <span class="hl-keyword">implements</span> ProductDao {
  
    <span class="hl-keyword">private</span> JpaTemplate jpaTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setEntityManagerFactory(EntityManagerFactory emf) {
        <span class="hl-keyword">this</span>.jpaTemplate = <span class="hl-keyword">new</span> JpaTemplate(emf);
    }

    <span class="hl-keyword">public</span> Collection loadProductsByCategory(<span class="hl-keyword">final</span> String category) <span class="hl-keyword">throws</span> DataAccessException {
        <span class="hl-keyword">return</span> (Collection) <span class="hl-keyword">this</span>.jpaTemplate.execute(<span class="hl-keyword">new</span> JpaCallback() {
            <span class="hl-keyword">public</span> Object doInJpa(EntityManager em) <span class="hl-keyword">throws</span> PersistenceException {
                Query query = em.createQuery(<span class="hl-string">"from Product as p where p.category = :category"</span>);
                query.setParameter(<span class="hl-string">"category"</span>, category);
                List result = query.getResultList(); 
                <span class="hl-comment">// do some further processing with the result list</span>
                <span class="hl-keyword">return</span> result;
            }
        });
    }
}</pre><p>The <code class="interfacename">JpaCallback</code> implementation
        allows any type of JPA data access. The
        <code class="classname">JpaTemplate</code> will ensure that
        <code class="interfacename">EntityManager</code>s are properly opened and
        closed and automatically participate in transactions. Moreover, the
        <code class="classname">JpaTemplate</code> properly handles exceptions, making
        sure resources are cleaned up and the appropriate transactions rolled
        back. The template instances are thread-safe and reusable and they can
        be kept as instance variable of the enclosing class. Note that
        <code class="classname">JpaTemplate</code> offers single-step actions such as
        find, load, merge, etc along with alternative convenience methods that
        can replace one line callback implementations.</p><p>Furthermore, Spring provides a convenient
        <code class="classname">JpaDaoSupport</code> base class that provides the
        <code class="literal">get/setEntityManagerFactory</code> and
        <code class="methodname">getJpaTemplate()</code> to be used by
        subclasses:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductDaoImpl <span class="hl-keyword">extends</span> JpaDaoSupport <span class="hl-keyword">implements</span> ProductDao {
  
    <span class="hl-keyword">public</span> Collection loadProductsByCategory(String category) <span class="hl-keyword">throws</span> DataAccessException {
        Map&lt;String, String&gt; params = <span class="hl-keyword">new</span> HashMap&lt;String, String&gt;();
        params.put(<span class="hl-string">"category"</span>, category);
        <span class="hl-keyword">return</span> getJpaTemplate().findByNamedParams(<span class="hl-string">"from Product as p where p.category = :category"</span>, params);
    }
}</pre><p>Besides working with Spring's
        <code class="classname">JpaTemplate</code>, one can also code Spring-based
        DAOs against the JPA, doing one's own explicit
        <code class="interfacename">EntityManager</code> handling. As also
        elaborated in the corresponding Hibernate section, the main advantage
        of this approach is that your data access code is able to throw
        checked exceptions. <code class="classname">JpaDaoSupport</code> offers a
        variety of support methods for this scenario, for retrieving and
        releasing a transaction <code class="interfacename">EntityManager</code>,
        as well as for converting exceptions.</p><p><span class="emphasis"><em>JpaTemplate mainly exists as a sibling of JdoTemplate
        and HibernateTemplate, offering the same style for people used to
        it.</em></span></p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="clasic-spring-mvc"></a>A.2&nbsp;Classic Spring MVC</h2></div></div></div><p>...</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e46579"></a>A.3&nbsp;JMS Usage</h2></div></div></div><p>One of the benefits of Spring's JMS support is to shield the user
    from differences between the JMS 1.0.2 and 1.1 APIs. (For a description of
    the differences between the two APIs see sidebar on Domain Unification).
    Since it is now common to encounter only the JMS 1.1 API the use of
    classes that are based on the JMS 1.0.2 API has been deprecated in Spring
    3.0. This section describes Spring JMS support for the JMS 1.0.2
    deprecated classes. </p><div class="sidebar"><p class="title"><b>Domain Unification</b></p><p>There are two major releases of the JMS specification, 1.0.2 and
      1.1.</p><p>JMS 1.0.2 defined two types of messaging domains, point-to-point
      (Queues) and publish/subscribe (Topics). The 1.0.2 API reflected these
      two messaging domains by providing a parallel class hierarchy for each
      domain. As a result, a client application became domain specific in its
      use of the JMS API. JMS 1.1 introduced the concept of domain unification
      that minimized both the functional differences and client API
      differences between the two domains. As an example of a functional
      difference that was removed, if you use a JMS 1.1 provider you can
      transactionally consume a message from one domain and produce a message
      on the other using the same
      <code class="interfacename">Session</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The JMS 1.1 specification was released in April 2002 and
        incorporated as part of J2EE 1.4 in November 2003. As a result, common
        J2EE 1.3 application servers which are still in widespread use (such
        as BEA WebLogic 8.1 and IBM WebSphere 5.1) are based on JMS
        1.0.2.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e46597"></a>A.3.1&nbsp;JmsTemplate</h3></div></div></div><p>Located in the package
      <code class="literal">org.springframework.jms.core</code> the class
      <code class="classname">JmsTemplate102</code> provides all of the features of
      the <code class="classname">JmsTemplate</code> described the JMS chapter, but is
      based on the JMS 1.0.2 API instead of the JMS 1.1 API. As a consequence,
      if you are using JmsTemplate102 you need to set the boolean property
      <span class="property">pubSubDomain</span> to configure the
      <code class="classname">JmsTemplate</code> with knowledge of what JMS domain is
      being used. By default the value of this property is false, indicating
      that the point-to-point domain, Queues, will be used.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e46617"></a>A.3.2&nbsp;Asynchronous Message Reception </h3></div></div></div><p><a class="link" href="#jms-receiving-async-message-listener-adapter" title="22.4.4&nbsp;The MessageListenerAdapter">MessageListenerAdapter's</a>
      are used in conjunction with Spring's <a class="link" href="#jms-mdp" title="22.2.4&nbsp;Message Listener Containers">message
      listener containers</a> to support asynchronous message reception by
      exposing almost any class as a Message-driven POJO. If you are using the
      JMS 1.0.2 API, you will want to use the 1.0.2 specific classes such as
      <code class="classname">MessageListenerAdapter102</code>,
      <code class="classname">SimpleMessageListenerContainer102</code>, and
      <code class="classname">DefaultMessageListenerContainer102</code>. These classes
      provide the same functionality as the JMS 1.1 based counterparts but
      rely only on the JMS 1.0.2 API. </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e46636"></a>A.3.3&nbsp;Connections</h3></div></div></div><p>The <code class="classname">ConnectionFactory</code> interface is part of
      the JMS specification and serves as the entry point for working with
      JMS. Spring provides an implementation of the
      <code class="classname">ConnectionFactory</code> interface,
      <code class="classname">SingleConnectionFactory102</code>, based on the JMS
      1.0.2 API that will return the same <code class="classname">Connection</code> on
      all <code class="methodname">createConnection()</code> calls and ignore calls to
      <code class="methodname">close()</code>. You will need to set the boolean
      property <span class="property">pubSubDomain</span> to indicate which messaging
      domain is used as <code class="classname">SingleConnectionFactory102</code> will
      always explicitly differentiate between a
      <code class="classname">javax.jms.QueueConnection</code> and a
      <code class="classname">javax.jmsTopicConnection</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e46671"></a>A.3.4&nbsp;Transaction Management</h3></div></div></div><p>In a JMS 1.0.2 environment the class
      <code class="classname">JmsTransactionManager102</code> provides support for
      managing JMS transactions for a single Connection Factory. Please refer
      to the reference documentation on <a class="link" href="#jms-tx" title="22.2.5&nbsp;Transaction management">JMS Transaction
      Management</a> for more information on this functionality.</p></div></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="classic-aop-spring"></a>Appendix&nbsp;B.&nbsp;Classic Spring AOP Usage</h2></div></div></div><p>In this appendix we discuss 
	the lower-level Spring AOP APIs and the AOP support used in Spring 1.2 applications.
	For new applications, we recommend the use of the Spring 2.0 AOP support 
	described in the <a class="link" href="#aop" title="8.&nbsp;Aspect Oriented Programming with Spring">AOP</a> chapter, but when working with existing applications,
	or when reading books and articles, you may come across Spring 1.2 style examples.
	Spring 2.0 is fully backwards compatible with Spring 1.2 and everything described
	in this appendix is fully supported in Spring 2.0.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="classic-aop-api-pointcuts"></a>B.1&nbsp;Pointcut API in Spring</h2></div></div></div><p>Let's look at how Spring handles the crucial pointcut concept.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-api-concepts"></a>B.1.1&nbsp;Concepts</h3></div></div></div><p>Spring's pointcut model enables pointcut reuse independent of
      advice types. It's possible to target different advice using the same
      pointcut.</p><p>The <code class="literal">org.springframework.aop.Pointcut</code> interface
      is the central interface, used to target advices to particular classes
      and methods. The complete interface is shown below:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Pointcut {

    ClassFilter getClassFilter();

    MethodMatcher getMethodMatcher();

}</pre><p>Splitting the <code class="interfacename">Pointcut</code> interface into two parts
      allows reuse of class and method matching parts, and fine-grained
      composition operations (such as performing a "union" with another method
      matcher).</p><p>The <code class="interfacename">ClassFilter</code> interface is used to restrict
      the pointcut to a given set of target classes. If the
      <code class="literal">matches()</code> method always returns true, all target
      classes will be matched:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ClassFilter {

    <span class="hl-keyword">boolean</span> matches(Class clazz);
}</pre><p>The <code class="interfacename">MethodMatcher</code> interface is normally more
      important. The complete interface is shown below:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MethodMatcher {

    <span class="hl-keyword">boolean</span> matches(Method m, Class targetClass);

    <span class="hl-keyword">boolean</span> isRuntime();

    <span class="hl-keyword">boolean</span> matches(Method m, Class targetClass, Object[] args);
}</pre><p>The <code class="literal">matches(Method, Class) </code>method is used to
      test whether this pointcut will ever match a given method on a target
      class. This evaluation can be performed when an AOP proxy is created, to
      avoid the need for a test on every method invocation. If the 2-argument
      matches method returns true for a given method, and the
      <code class="literal">isRuntime()</code> method for the MethodMatcher returns
      true, the 3-argument matches method will be invoked on every method
      invocation. This enables a pointcut to look at the arguments passed to
      the method invocation immediately before the target advice is to
      execute.</p><p>Most MethodMatchers are static, meaning that their
      <code class="literal">isRuntime()</code> method returns false. In this case, the
      3-argument matches method will never be invoked.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If possible, try to make pointcuts static, allowing the AOP
				framework to cache the results of pointcut evaluation when an AOP proxy
				is created.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-api-pointcut-ops"></a>B.1.2&nbsp;Operations on pointcuts</h3></div></div></div><p>Spring supports operations on pointcuts: notably,
      <span class="emphasis"><em>union</em></span> and <span class="emphasis"><em>intersection</em></span>.</p><div class="itemizedlist"><ul type="disc"><li><p>Union means the methods that either pointcut matches.</p></li><li><p>Intersection means the methods that both pointcuts match.</p></li><li><p>Union is usually more useful.</p></li><li><p>Pointcuts can be composed using the static methods in the
					<span class="emphasis"><em>org.springframework.aop.support.Pointcuts</em></span> class, or
					using the <span class="emphasis"><em>ComposablePointcut</em></span> class in the same
					package. However, using AspectJ pointcut expressions is usually a
					simpler approach.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-api-pointcuts-aspectj"></a>B.1.3&nbsp;AspectJ expression pointcuts</h3></div></div></div><p>Since 2.0, the most important type of pointcut used by Spring is
      <code class="literal">org.springframework.aop.aspectj.AspectJExpressionPointcut</code>.
      This is a pointcut that uses an AspectJ supplied library to parse an AspectJ
      pointcut expression string.</p><p>See the previous chapter for a discussion of supported AspectJ pointcut
      primitives.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-api-pointcuts-impls"></a>B.1.4&nbsp;Convenience pointcut implementations</h3></div></div></div><p>Spring provides several convenient pointcut implementations. Some
      can be used out of the box; others are intended to be subclassed in
      application-specific pointcuts.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="classic-aop-api-pointcuts-static"></a>B.1.4.1&nbsp;Static pointcuts</h4></div></div></div><p>Static pointcuts are based on method and target class, and
        cannot take into account the method's arguments. Static pointcuts are
        sufficient - <span class="emphasis"><em>and best</em></span> - for most usages. It's possible for Spring to
        evaluate a static pointcut only once, when a method is first invoked:
        after that, there is no need to evaluate the pointcut again with each
        method invocation.</p><p>Let's consider some static pointcut implementations included
        with Spring.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="classic-aop-api-pointcuts-regex"></a>Regular expression pointcuts</h5></div></div></div><p>One obvious way to specify static pointcuts is regular
          expressions. Several AOP frameworks besides Spring make this
          possible.
          <code class="literal">org.springframework.aop.support.Perl5RegexpMethodPointcut</code>
          is a generic regular expression pointcut, using Perl 5 regular
          expression syntax. The <code class="literal">Perl5RegexpMethodPointcut</code>
          class depends on Jakarta ORO for regular expression matching. Spring
          also provides the <code class="literal">JdkRegexpMethodPointcut</code> class
          that uses the regular expression support in JDK 1.4+.</p><p>Using the <code class="literal">Perl5RegexpMethodPointcut</code> class,
          you can provide a list of pattern Strings. If any of these is a
          match, the pointcut will evaluate to true. (So the result is
          effectively the union of these pointcuts.)</p><p>The usage is shown below:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"settersAndAbsquatulatePointcut"</span> 
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.support.Perl5RegexpMethodPointcut"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"patterns"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;.*set.*&lt;<span class="hl-tag">/value</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;.*absquatulate&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Spring provides a convenience class,
          <code class="literal">RegexpMethodPointcutAdvisor</code>, that allows us to
          also reference an Advice (remember that an Advice can be an
          interceptor, before advice, throws advice etc.). Behind the scenes,
          Spring will use a <code class="literal">JdkRegexpMethodPointcut</code>. Using
          <code class="literal">RegexpMethodPointcutAdvisor</code> simplifies wiring,
          as the one bean encapsulates both pointcut and advice, as shown
          below:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"settersAndAbsquatulateAdvisor"</span> 
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.support.RegexpMethodPointcutAdvisor"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"advice"</span>&gt;
        &lt;<span class="hl-tag">ref</span> <span class="hl-attribute">local</span>=<span class="hl-value">"beanNameOfAopAllianceInterceptor"</span>/&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"patterns"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;.*set.*&lt;<span class="hl-tag">/value</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;.*absquatulate&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p><span class="emphasis"><em>RegexpMethodPointcutAdvisor</em></span> can be used
          with any Advice type.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="classic-aop-api-pointcuts-attribute-driven"></a>Attribute-driven pointcuts</h5></div></div></div><p>An important type of static pointcut is a
          <span class="emphasis"><em>metadata-driven</em></span> pointcut. This uses the values
          of metadata attributes: typically, source-level metadata.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="classic-aop-api-pointcuts-dynamic"></a>B.1.4.2&nbsp;Dynamic pointcuts</h4></div></div></div><p>Dynamic pointcuts are costlier to evaluate than static
        pointcuts. They take into account method
        <span class="emphasis"><em>arguments</em></span>, as well as static information. This
        means that they must be evaluated with every method invocation; the
        result cannot be cached, as arguments will vary.</p><p>The main example is the <code class="literal">control flow</code>
        pointcut.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="classic-aop-api-pointcuts-cflow"></a>Control flow pointcuts</h5></div></div></div><p>Spring control flow pointcuts are conceptually similar to
          AspectJ <span class="emphasis"><em>cflow</em></span> pointcuts, although less
          powerful. (There is currently no way to specify that a pointcut
          executes below a join point matched by another pointcut.) 
          A control flow pointcut matches
          the current call stack. For example, it might fire if the join point
          was invoked by a method in the <code class="literal">com.mycompany.web</code>
          package, or by the <code class="literal">SomeCaller</code> class. Control flow
          pointcuts are specified using the
          <code class="literal">org.springframework.aop.support.ControlFlowPointcut
          </code>class.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Control flow pointcuts are significantly more expensive to
              evaluate at runtime than even other dynamic pointcuts. In Java 1.4,
              the cost is about 5 times that of other dynamic pointcuts.</p></td></tr></table></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-api-pointcuts-superclasses"></a>B.1.5&nbsp;Pointcut superclasses</h3></div></div></div><p>Spring provides useful pointcut superclasses to help you to
      implement your own pointcuts.</p><p>Because static pointcuts are most useful, you'll probably subclass
      StaticMethodMatcherPointcut, as shown below. This requires implementing
      just one abstract method (although it's possible to override other
      methods to customize behavior):</p><pre class="programlisting"><span class="hl-keyword">class</span> TestStaticPointcut <span class="hl-keyword">extends</span> StaticMethodMatcherPointcut {

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> matches(Method m, Class targetClass) {
        <span class="hl-comment">// return true if custom criteria match</span>
    }
}</pre><p>There are also superclasses for dynamic pointcuts.</p><p>You can use custom pointcuts with any advice type in Spring 1.0
      RC2 and above.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-api-pointcuts-custom"></a>B.1.6&nbsp;Custom pointcuts</h3></div></div></div><p>Because pointcuts in Spring AOP are Java classes, rather than
      language features (as in AspectJ) it's possible to declare custom
      pointcuts, whether static or dynamic. Custom pointcuts in Spring can be
      arbitrarily complex. However, using the AspectJ pointcut expression
      language is recommended if possible.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Later versions of Spring may offer support for "semantic
				pointcuts" as offered by JAC: for example, "all methods that change
				instance variables in the target object."</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="classic-aop-api-advice"></a>B.2&nbsp;Advice API in Spring</h2></div></div></div><p>Let's now look at how Spring AOP handles advice.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-api-advice-lifecycle"></a>B.2.1&nbsp;Advice lifecycles</h3></div></div></div><p>Each advice is a Spring bean. An advice instance can be shared across all 
      advised objects, or unique
      to each advised object. This corresponds to
      <span class="emphasis"><em>per-class</em></span> or <span class="emphasis"><em>per-instance</em></span>
      advice.</p><p>Per-class advice is used most often. It is appropriate for generic
      advice such as transaction advisors. These do not depend on the state of
      the proxied object or add new state; they merely act on the method and
      arguments.</p><p>Per-instance advice is appropriate for introductions, to support
      mixins. In this case, the advice adds state to the proxied
      object.</p><p>It's possible to use a mix of shared and per-instance advice in
      the same AOP proxy.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-api-advice-types"></a>B.2.2&nbsp;Advice types in Spring</h3></div></div></div><p>Spring provides several advice types out of the box, and is
      extensible to support arbitrary advice types. Let us look at the basic
      concepts and standard advice types.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="classic-aop-api-advice-around"></a>B.2.2.1&nbsp;Interception around advice</h4></div></div></div><p>The most fundamental advice type in Spring is
        <span class="emphasis"><em>interception around advice</em></span>.</p><p>Spring is compliant with the AOP Alliance interface for around
        advice using method interception. MethodInterceptors implementing
        around advice should implement the following interface:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MethodInterceptor <span class="hl-keyword">extends</span> Interceptor {
  
    Object invoke(MethodInvocation invocation) <span class="hl-keyword">throws</span> Throwable;
}</pre><p>The <code class="classname">MethodInvocation</code> argument to the
        <code class="methodname">invoke()</code> method exposes the method being invoked;
        the target join point; the AOP proxy; and the arguments to the method.
        The <code class="methodname">invoke()</code> method should return the
        invocation's result: the return value of the join point.</p><p>A simple <code class="classname">MethodInterceptor</code> implementation
        looks as follows:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DebugInterceptor <span class="hl-keyword">implements</span> MethodInterceptor {

    <span class="hl-keyword">public</span> Object invoke(MethodInvocation invocation) <span class="hl-keyword">throws</span> Throwable {
        System.out.println(<span class="hl-string">"Before: invocation=["</span> + invocation + <span class="hl-string">"]"</span>);
        Object rval = invocation.proceed();
        System.out.println(<span class="hl-string">"Invocation returned"</span>);
        <span class="hl-keyword">return</span> rval;
    }
}</pre><p>Note the call to the MethodInvocation's
        <code class="methodname">proceed()</code> method. This proceeds down the
        interceptor chain towards the join point. Most interceptors will invoke
        this method, and return its return value. However, a
        MethodInterceptor, like any around advice, can return a different
        value or throw an exception rather than invoke the proceed method.
        However, you don't want to do this without good reason!</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>MethodInterceptors offer interoperability with other AOP
        Alliance-compliant AOP implementations. The other advice types
        discussed in the remainder of this section implement common AOP
        concepts, but in a Spring-specific way. While there is an advantage in
        using the most specific advice type, stick with MethodInterceptor
        around advice if you are likely to want to run the aspect in another
        AOP framework. Note that pointcuts are not currently interoperable
        between frameworks, and the AOP Alliance does not currently define
        pointcut interfaces.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="classic-aop-api-advice-before"></a>B.2.2.2&nbsp;Before advice</h4></div></div></div><p>A simpler advice type is a <span class="bold"><strong>before
        advice</strong></span>. This does not need a
        <code class="literal">MethodInvocation</code> object, since it will only be
        called before entering the method.</p><p>The main advantage of a before advice is that there is no need
        to invoke the <code class="literal">proceed() </code>method, and therefore no
        possibility of inadvertently failing to proceed down the interceptor
        chain.</p><p>The <code class="literal">MethodBeforeAdvice</code> interface is shown
        below. (Spring's API design would allow for field before advice,
        although the usual objects apply to field interception and it's
        unlikely that Spring will ever implement it).</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MethodBeforeAdvice <span class="hl-keyword">extends</span> BeforeAdvice {

    <span class="hl-keyword">void</span> before(Method m, Object[] args, Object target) <span class="hl-keyword">throws</span> Throwable;
}</pre><p>Note the return type is <code class="literal">void</code>. Before
        advice can insert custom behavior before the join point executes, but
        cannot change the return value. If a before advice throws an
        exception, this will abort further execution of the interceptor chain.
        The exception will propagate back up the interceptor chain. If it is
        unchecked, or on the signature of the invoked method, it will be
        passed directly to the client; otherwise it will be wrapped in an
        unchecked exception by the AOP proxy.</p><p>An example of a before advice in Spring, which counts all method
        invocations:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CountingBeforeAdvice <span class="hl-keyword">implements</span> MethodBeforeAdvice {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> count;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> before(Method m, Object[] args, Object target) <span class="hl-keyword">throws</span> Throwable {
        ++count;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getCount() { 
        <span class="hl-keyword">return</span> count; 
    }
}</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Before advice can be used with any pointcut.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="classic-aop-api-advice-throws"></a>B.2.2.3&nbsp;Throws advice</h4></div></div></div><p><span class="bold"><strong>Throws advice</strong></span> is invoked after
        the return of the join point if the join point threw an exception.
        Spring offers typed throws advice. Note that this means that the
        <code class="literal">org.springframework.aop.ThrowsAdvice</code> interface does
        not contain any methods: It is a tag interface identifying that the
        given object implements one or more typed throws advice methods. These
        should be in the form of:</p><pre class="programlisting">afterThrowing([Method, args, target], subclassOfThrowable) </pre><p>Only the last argument is required. The method signatures may
        have either one or four arguments, depending on whether the advice
        method is interested in the method and arguments. The following
        classes are examples of throws advice.</p><p>The advice below is invoked if a <code class="exceptionname">RemoteException</code>
    		is thrown (including subclasses):</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RemoteThrowsAdvice <span class="hl-keyword">implements</span> ThrowsAdvice {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(RemoteException ex) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-comment">// Do something with remote exception</span>
    }
}</pre><p>The following advice is invoked if a
        <code class="exceptionname">ServletException</code> is thrown. Unlike the above
        advice, it declares 4 arguments, so that it has access to the invoked
        method, method arguments and target object:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServletThrowsAdviceWithArguments <span class="hl-keyword">implements</span> ThrowsAdvice {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        <span class="hl-comment">// Do something with all arguments</span>
    }
}</pre><p>The final example illustrates how these two methods could be
        used in a single class, which handles both
        <code class="literal">RemoteException</code> and
        <code class="literal">ServletException</code>. Any number of throws advice
        methods can be combined in a single class.</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> CombinedThrowsAdvice <span class="hl-keyword">implements</span> ThrowsAdvice {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(RemoteException ex) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-comment">// Do something with remote exception</span>
    }
 
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        <span class="hl-comment">// Do something with all arguments</span>
    }
}</pre><p><span class="emphasis"><em>Note:</em></span> If a throws-advice method throws an exception itself,
        it will override the original exception (i.e. change the exception thrown to the user).
        The overriding exception will typically be a RuntimeException; this is compatible with
        any method signature. However, if a throws-advice method throws a checked exception,
        it will have to match the declared exceptions of the target method and is hence to some
        degree coupled to specific target method signatures. <span class="emphasis"><em>Do not throw an undeclared
        checked exception that is incompatible with the target method's signature!</em></span></p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Throws advice can be used with any pointcut.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="classic-aop-api-advice-after-returning"></a>B.2.2.4&nbsp;After Returning advice</h4></div></div></div><p>An after returning advice in Spring must implement the
        <span class="emphasis"><em>org.springframework.aop.AfterReturningAdvice</em></span>
        interface, shown below:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> AfterReturningAdvice <span class="hl-keyword">extends</span> Advice {

    <span class="hl-keyword">void</span> afterReturning(Object returnValue, Method m, Object[] args, Object target) 
            <span class="hl-keyword">throws</span> Throwable;
}</pre><p>An after returning advice has access to the return value (which
        it cannot modify), invoked method, methods arguments and
        target.</p><p>The following after returning advice counts all successful
        method invocations that have not thrown exceptions:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CountingAfterReturningAdvice <span class="hl-keyword">implements</span> AfterReturningAdvice {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> count;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterReturning(Object returnValue, Method m, Object[] args, Object target)
            <span class="hl-keyword">throws</span> Throwable {
        ++count;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getCount() {
        <span class="hl-keyword">return</span> count;
    }
}</pre><p>This advice doesn't change the execution path. If it throws an
        exception, this will be thrown up the interceptor chain instead of the
        return value.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>After returning advice can be used with any pointcut.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="classic-aop-api-advice-introduction"></a>B.2.2.5&nbsp;Introduction advice</h4></div></div></div><p>Spring treats introduction advice as a special kind of
        interception advice.</p><p>Introduction requires an <code class="literal">IntroductionAdvisor</code>,
        and an <code class="literal">IntroductionInterceptor</code>, implementing the
        following interface:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IntroductionInterceptor <span class="hl-keyword">extends</span> MethodInterceptor {

    <span class="hl-keyword">boolean</span> implementsInterface(Class intf);
}</pre><p>The <code class="literal">invoke() </code>method inherited from the AOP
        Alliance <code class="literal">MethodInterceptor</code> interface must implement
        the introduction: that is, if the invoked method is on an introduced
        interface, the introduction interceptor is responsible for handling
        the method call - it cannot invoke <code class="literal">proceed()</code>.</p><p>Introduction advice cannot be used with any pointcut, as it
        applies only at class, rather than method, level. You can only use
        introduction advice with the <code class="literal">IntroductionAdvisor</code>,
        which has the following methods:</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IntroductionAdvisor <span class="hl-keyword">extends</span> Advisor, IntroductionInfo {

	ClassFilter getClassFilter();

	<span class="hl-keyword">void</span> validateInterfaces() <span class="hl-keyword">throws</span> IllegalArgumentException;
}

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IntroductionInfo {

	Class[] getInterfaces();
}</pre><p>There is no <code class="interfacename">MethodMatcher</code>, and hence no
        <code class="interfacename">Pointcut</code>, associated with introduction advice. Only
        class filtering is logical.</p><p>The <code class="literal">getInterfaces()</code> method returns the
        interfaces introduced by this advisor.</p>

         The 

        <code class="literal">validateInterfaces()</code>

         method is used internally to see whether or not the introduced interfaces can be implemented by the configured 

        <code class="literal">IntroductionInterceptor</code>

         . 

        <p>Let's look at a simple example from the Spring test suite. Let's
        suppose we want to introduce the following interface to one or more
        objects:</p><p>
          </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Lockable {
    <span class="hl-keyword">void</span> lock();
    <span class="hl-keyword">void</span> unlock();
    <span class="hl-keyword">boolean</span> locked();
}</pre><p>
        </p><p>This illustrates a <span class="bold"><strong>mixin</strong></span>. We
        want to be able to cast advised objects to Lockable, whatever their
        type, and call lock and unlock methods. If we call the lock() method,
        we want all setter methods to throw a
        <code class="literal">LockedException</code>. Thus we can add an aspect that
        provides the ability to make objects immutable, without them having
        any knowledge of it: a good example of AOP.</p><p>Firstly, we'll need an
        <code class="literal">IntroductionInterceptor</code> that does the heavy
        lifting. In this case, we extend the
        <code class="literal">org.springframework.aop.support.DelegatingIntroductionInterceptor</code>
        convenience class. We could implement IntroductionInterceptor
        directly, but using
        <code class="literal">DelegatingIntroductionInterceptor</code> is best for most
        cases.</p><p>The <code class="literal">DelegatingIntroductionInterceptor</code> is
        designed to delegate an introduction to an actual implementation of
        the introduced interface(s), concealing the use of interception to do
        so. The delegate can be set to any object using a constructor
        argument; the default delegate (when the no-arg constructor is used)
        is this. Thus in the example below, the delegate is the
        <code class="literal">LockMixin</code> subclass of
        <code class="literal">DelegatingIntroductionInterceptor</code>. Given a delegate
        (by default itself), a
        <code class="literal">DelegatingIntroductionInterceptor</code> instance looks
        for all interfaces implemented by the delegate (other than
        IntroductionInterceptor), and will support introductions against any
        of them. It's possible for subclasses such as
        <code class="literal">LockMixin</code> to call the
        <code class="literal">suppressInterface(Class intf) </code>method to suppress
        interfaces that should not be exposed. However, no matter how many
        interfaces an <code class="literal">IntroductionInterceptor</code> is prepared
        to support, the <code class="literal">IntroductionAdvisor</code> used will
        control which interfaces are actually exposed. An introduced interface
        will conceal any implementation of the same interface by the
        target.</p><p>Thus LockMixin subclasses
        <code class="literal">DelegatingIntroductionInterceptor</code> and implements
        Lockable itself. The superclass automatically picks up that Lockable
        can be supported for introduction, so we don't need to specify that.
        We could introduce any number of interfaces in this way.</p><p>Note the use of the <code class="literal">locked</code> instance variable.
        This effectively adds additional state to that held in the target
        object.</p><p>
          </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> LockMixin <span class="hl-keyword">extends</span> DelegatingIntroductionInterceptor 
    <span class="hl-keyword">implements</span> Lockable {

    <span class="hl-keyword">private</span> <span class="hl-keyword">boolean</span> locked;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> lock() {
        <span class="hl-keyword">this</span>.locked = true;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> unlock() {
        <span class="hl-keyword">this</span>.locked = false;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> locked() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.locked;
    }

    <span class="hl-keyword">public</span> Object invoke(MethodInvocation invocation) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-keyword">if</span> (locked() &amp;&amp; invocation.getMethod().getName().indexOf(<span class="hl-string">"set"</span>) == 0)
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> LockedException();
        <span class="hl-keyword">return</span> <span class="hl-keyword">super</span>.invoke(invocation);
    }

}</pre><p>
        </p><p>Often it isn't necessary to override the <code class="literal">invoke()
        </code>method: the
        <code class="literal">DelegatingIntroductionInterceptor</code>
        implementation - which calls the delegate method if the method is
        introduced, otherwise proceeds towards the join point - is usually
        sufficient. In the present case, we need to add a check: no setter
        method can be invoked if in locked mode.</p><p>The introduction advisor required is simple. All it needs to do
        is hold a distinct <code class="literal">LockMixin</code> instance, and specify
        the introduced interfaces - in this case, just
        <code class="literal">Lockable</code>. A more complex example might take a
        reference to the introduction interceptor (which would be defined as a
        prototype): in this case, there's no configuration relevant for a
        <code class="literal">LockMixin</code>, so we simply create it using
        <code class="literal">new</code>.</p><p>
          </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> LockMixinAdvisor <span class="hl-keyword">extends</span> DefaultIntroductionAdvisor {

    <span class="hl-keyword">public</span> LockMixinAdvisor() {
        <span class="hl-keyword">super</span>(<span class="hl-keyword">new</span> LockMixin(), Lockable.<span class="hl-keyword">class</span>);
    }
}</pre><p>
        </p><p>We can apply this advisor very simply: it requires no
        configuration. (However, it <span class="emphasis"><em>is</em></span> necessary: It's
        impossible to use an <code class="literal">IntroductionInterceptor</code>
        without an <span class="emphasis"><em>IntroductionAdvisor</em></span>.) As usual with
        introductions, the advisor must be per-instance, as it is stateful. We
        need a different instance of <code class="literal">LockMixinAdvisor</code>, and
        hence <code class="literal">LockMixin</code>, for each advised object. The
        advisor comprises part of the advised object's state.</p><p>We can apply this advisor programmatically, using the
        <code class="literal">Advised.addAdvisor() </code>method, or (the recommended
        way) in XML configuration, like any other advisor. All proxy creation
        choices discussed below, including "auto proxy creators," correctly
        handle introductions and stateful mixins.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="classic-aop-api-advisor"></a>B.3&nbsp;Advisor API in Spring</h2></div></div></div><p>In Spring, an Advisor is an aspect that contains just a single advice
    object associated with a pointcut expression.</p><p>Apart from the special case of introductions, any advisor can be
    used with any advice.
    <code class="literal">org.springframework.aop.support.DefaultPointcutAdvisor</code>
    is the most commonly used advisor class. For example, it can be used with
    a <code class="literal">MethodInterceptor</code>, <code class="literal">BeforeAdvice</code> or
    <code class="literal">ThrowsAdvice</code>.</p><p>It is possible to mix advisor and advice types in Spring in the same
    AOP proxy. For example, you could use a interception around advice, throws
    advice and before advice in one proxy configuration: Spring will
    automatically create the necessary interceptor chain.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="classic-aop-pfb"></a>B.4&nbsp;Using the ProxyFactoryBean to create AOP proxies</h2></div></div></div><p>If you're using the Spring IoC container (an ApplicationContext or
    BeanFactory) for your business objects - and you should be! - you will want
    to use one of Spring's AOP FactoryBeans. (Remember that a factory bean
    introduces a layer of indirection, enabling it to create objects of a
    different type.)</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The Spring 2.0 AOP support also uses factory beans under the covers.</p></td></tr></table></div><p>The basic way to create an AOP proxy in Spring is to use the
    <span class="emphasis"><em>org.springframework.aop.framework.ProxyFactoryBean</em></span>.
    This gives complete control over the pointcuts and advice that will apply,
    and their ordering. However, there are simpler options that are preferable
    if you don't need such control.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-pfb-1"></a>B.4.1&nbsp;Basics</h3></div></div></div><p>The <code class="literal">ProxyFactoryBean</code>, like other Spring
      <code class="literal">FactoryBean</code> implementations, introduces a level of
      indirection. If you define a <code class="literal">ProxyFactoryBean</code> with
      name <code class="literal">foo</code>, what objects referencing
      <code class="literal">foo</code> see is not the
      <code class="literal">ProxyFactoryBean</code> instance itself, but an object
      created by the <code class="literal">ProxyFactoryBean</code>'s implementation of
      the <code class="literal">getObject() </code>method. This method will create an
      AOP proxy wrapping a target object.</p><p>One of the most important benefits of using a
      <code class="literal">ProxyFactoryBean</code> or another IoC-aware class to create
      AOP proxies, is that it means that advices and pointcuts can also be
      managed by IoC. This is a powerful feature, enabling certain approaches
      that are hard to achieve with other AOP frameworks. For example, an
      advice may itself reference application objects (besides the target,
      which should be available in any AOP framework), benefiting from all the
      pluggability provided by Dependency Injection.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-pfb-2"></a>B.4.2&nbsp;JavaBean properties</h3></div></div></div><p>
		In common with most <code class="interfacename">FactoryBean</code> implementations
		provided with Spring, the <code class="classname">ProxyFactoryBean</code> class is
		itself a JavaBean. Its properties are used to:
	  </p><div class="itemizedlist"><ul type="disc"><li><p>Specify the target you want to proxy.</p></li><li><p>Specify whether to use CGLIB (see below and also
			<a class="xref" href="#aop-pfb-proxy-types" title="9.5.3&nbsp;JDK- and CGLIB-based proxies">Section&nbsp;9.5.3, &#8220;JDK- and CGLIB-based proxies&#8221;</a>).</p></li></ul></div><p>
		Some key properties are inherited from
		<code class="classname">org.springframework.aop.framework.ProxyConfig</code> (the
		superclass for all AOP proxy factories in Spring). These key properties include:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
			<code class="literal">proxyTargetClass</code>: <code class="literal">true</code> if the
			target class is to be proxied, rather than the target class' interfaces.
			If this property value is set to <code class="literal">true</code>, then CGLIB proxies
			will be created (but see also below <a class="xref" href="#aop-pfb-proxy-types" title="9.5.3&nbsp;JDK- and CGLIB-based proxies">Section&nbsp;9.5.3, &#8220;JDK- and CGLIB-based proxies&#8221;</a>).
		  </p></li><li><p>
			<code class="literal">optimize</code>: controls whether or not aggressive
			optimizations are applied to proxies <span class="emphasis"><em>created via CGLIB</em></span>.
			One should not blithely use this setting unless one fully understands
			how the relevant AOP proxy handles optimization. This is currently used only
			for CGLIB proxies; it has no effect with JDK dynamic proxies.
          </p></li><li><p><code class="literal">frozen</code>: if a proxy configuration is <code class="literal">frozen</code>,
			then changes to the configuration are no longer allowed. This is useful both as
			a slight optimization and for those cases when you don't want callers to be able
			to manipulate the proxy (via the <code class="interfacename">Advised</code> interface)
			after the proxy has been created. The default value of this property is
			<code class="literal">false</code>, so changes such as adding additional advice are allowed.</p></li><li><p>
			<code class="literal">exposeProxy</code>: determines whether or not the current
			proxy should be exposed in a <code class="classname">ThreadLocal</code> so that
			it can be accessed by the target. If a target needs to obtain
			the proxy and the <code class="literal">exposeProxy</code> property is set to
			<code class="literal">true</code>, the target can use the
			<code class="methodname">AopContext.currentProxy()</code> method.
          </p></li><li><p>
			<code class="literal">aopProxyFactory</code>: the implementation of
			<code class="interfacename">AopProxyFactory</code> to use. Offers a way of
			customizing whether to use dynamic proxies, CGLIB or any other proxy
			strategy. The default implementation will choose dynamic proxies or
			CGLIB appropriately. There should be no need to use this property;
			it is intended to allow the addition of new proxy types in Spring 1.1.
          </p></li></ul></div><p>
		Other properties specific to <code class="classname">ProxyFactoryBean</code> include:
	  </p><div class="itemizedlist"><ul type="disc"><li><p>
			<code class="literal">proxyInterfaces</code>: array of String interface
			names. If this isn't supplied, a CGLIB proxy for the target class
			will be used (but see also below <a class="xref" href="#aop-pfb-proxy-types" title="9.5.3&nbsp;JDK- and CGLIB-based proxies">Section&nbsp;9.5.3, &#8220;JDK- and CGLIB-based proxies&#8221;</a>).
          </p></li><li><p>
			<code class="literal">interceptorNames</code>: String array of
			<code class="interfacename">Advisor</code>, interceptor or other advice
			names to apply. Ordering is significant, on a first come-first served
			basis. That is to say that the first interceptor in the list
			will be the first to be able to intercept the invocation.
          </p><p>
			The names are bean names in the current factory, including
			bean names from ancestor factories. You can't mention bean
			references here since doing so would result in the
			<code class="classname">ProxyFactoryBean</code> ignoring the singleton
			setting of the advice.
          </p><p>
			You can append an interceptor name with an asterisk
			(<code class="literal">*</code>). This will result in the application of all
			advisor beans with names starting with the part before the asterisk
			to be applied. An example of using this feature can be found in
			<a class="xref" href="#aop-global-advisors" title="9.5.6&nbsp;Using 'global' advisors">Section&nbsp;9.5.6, &#8220;Using 'global' advisors&#8221;</a>.
          </p></li><li><p>
			singleton: whether or not the factory should return a single
			object, no matter how often the <code class="literal">getObject()</code>
			method is called. Several <code class="interfacename">FactoryBean</code>
			implementations offer such a method. The default value is
			<code class="literal">true</code>. If you	want to use stateful advice - 
			for example, for stateful mixins - use	prototype advices along
			with a singleton value of <code class="literal">false</code>.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-pfb-proxy-types"></a>B.4.3&nbsp;JDK- and CGLIB-based proxies</h3></div></div></div><p>
			This section serves as the definitive documentation on how the
			<code class="classname">ProxyFactoryBean</code> chooses to create one of
			either a JDK- and CGLIB-based proxy for a particular target object
			(that is to be proxied).
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
				The behavior of the <code class="classname">ProxyFactoryBean</code> with regard
				to creating JDK- or CGLIB-based proxies changed between versions 1.2.x and
				2.0 of Spring. The <code class="classname">ProxyFactoryBean</code> now
				exhibits similar semantics with regard to auto-detecting interfaces
				as those of the <code class="classname">TransactionProxyFactoryBean</code> class.		
			</p></td></tr></table></div><p>
			If the class of a target object that is to be proxied (hereafter simply
			referred to as the target class) doesn't implement any interfaces, then
			a CGLIB-based proxy will be created. This is the easiest scenario, because
			JDK proxies are interface based, and no interfaces means JDK proxying
			isn't even possible. One simply plugs in the target bean, and specifies the
			list of interceptors via the <code class="literal">interceptorNames</code> property.
			Note that a CGLIB-based proxy will be created even if the
			<code class="literal">proxyTargetClass</code> property of the
			<code class="classname">ProxyFactoryBean</code> has been set to <code class="literal">false</code>.
			(Obviously this makes no sense, and is best removed from the bean
			definition because it is at best redundant, and at worst confusing.)
		</p><p>
			If the target class implements one (or more) interfaces, then the type of
			proxy that is created depends on the configuration of the
			<code class="classname">ProxyFactoryBean</code>.
		</p><p>
			If the <code class="literal">proxyTargetClass</code> property of the
			<code class="classname">ProxyFactoryBean</code> has been set to <code class="literal">true</code>,
			then a CGLIB-based proxy will be created. This makes sense, and is in
			keeping with the principle of least surprise. Even if the
			<code class="literal">proxyInterfaces</code> property of the
			<code class="classname">ProxyFactoryBean</code> has been set to one or more
			fully qualified interface names, the fact that the
			<code class="literal">proxyTargetClass</code> property is set to 
			<code class="literal">true</code> <span class="emphasis"><em>will</em></span> cause
			CGLIB-based proxying to be in effect.
		</p><p>
			If the <code class="literal">proxyInterfaces</code> property of the
			<code class="classname">ProxyFactoryBean</code> has been set to one or more
			fully qualified interface names, then a JDK-based proxy will be created.
			The created proxy will implement all of the interfaces that were specified
			in the <code class="literal">proxyInterfaces</code> property; if the target class
			happens to implement a whole lot more interfaces than those specified in
			the <code class="literal">proxyInterfaces</code> property, that is all well and
			good but those additional interfaces will not be implemented by the
			returned proxy.
		</p><p>
			If the <code class="literal">proxyInterfaces</code> property of the
			<code class="classname">ProxyFactoryBean</code> has <span class="emphasis"><em>not</em></span> been
			set, but the target class <span class="emphasis"><em>does implement one (or more)</em></span>
			interfaces, then the <code class="classname">ProxyFactoryBean</code> will auto-detect
			the fact that the target class does actually implement at least one interface,
			and a JDK-based proxy will be created. The interfaces that are actually
			proxied will be <span class="emphasis"><em>all</em></span> of the interfaces that the target
			class implements; in effect, this is the same as simply supplying a list
			of each and every interface that the target class implements to the
			<code class="literal">proxyInterfaces</code> property. However, it is significantly less
			work, and less prone to typos.
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-api-proxying-intf"></a>B.4.4&nbsp;Proxying interfaces</h3></div></div></div><p>
		Let's look at a simple example of <code class="classname">ProxyFactoryBean</code>
		in action. This example involves:
      </p><div class="itemizedlist"><ul type="disc"><li><p>A <span class="emphasis"><em>target bean</em></span> that will be proxied. This
          is the "personTarget" bean definition in the example below.</p></li><li><p>An Advisor and an Interceptor used to provide advice.</p></li><li><p>An AOP proxy bean definition specifying the target object (the
          personTarget bean) and the interfaces to proxy, along with the
          advices to apply.</p></li></ul></div><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"personTarget"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.PersonImpl"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span>&gt;&lt;<span class="hl-tag">value</span>&gt;Tony&lt;<span class="hl-tag">/value</span>&gt;&lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span>&gt;&lt;<span class="hl-tag">value</span>&gt;51&lt;<span class="hl-tag">/value</span>&gt;&lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.MyAdvisor"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someProperty"</span>&gt;&lt;<span class="hl-tag">value</span>&gt;Custom string property value&lt;<span class="hl-tag">/value</span>&gt;&lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"debugInterceptor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.interceptor.DebugInterceptor"</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"person"</span> 
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"proxyInterfaces"</span>&gt;&lt;<span class="hl-tag">value</span>&gt;com.mycompany.Person&lt;<span class="hl-tag">/value</span>&gt;&lt;<span class="hl-tag">/property</span>&gt;

    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span>&gt;&lt;<span class="hl-tag">ref</span> <span class="hl-attribute">local</span>=<span class="hl-value">"personTarget"</span>/&gt;&lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span>&gt;
        &lt;<span class="hl-tag">list</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;myAdvisor&lt;<span class="hl-tag">/value</span>&gt;
            &lt;<span class="hl-tag">value</span>&gt;debugInterceptor&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">/list</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Note that the <code class="literal">interceptorNames</code> property takes a
      list of String: the bean names of the interceptor or advisors in the
      current factory. Advisors, interceptors, before, after returning and
      throws advice objects can be used. The ordering of advisors is
      significant.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You might be wondering why the list doesn't hold bean
				references. The reason for this is that if the ProxyFactoryBean's
				singleton property is set to false, it must be able to return
				independent proxy instances. If any of the advisors is itself a
				prototype, an independent instance would need to be returned, so it's
				necessary to be able to obtain an instance of the prototype from the
				factory; holding a reference isn't sufficient.</p></td></tr></table></div><p>The "person" bean definition above can be used in place of a
      Person implementation, as follows:</p><pre class="programlisting">Person person = (Person) factory.getBean(<span class="hl-string">"person"</span>);</pre><p>Other beans in the same IoC context can express a strongly typed
      dependency on it, as with an ordinary Java object:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"personUser"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.PersonUser"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"person"</span>&gt;&lt;<span class="hl-tag">ref</span> <span class="hl-attribute">local</span>=<span class="hl-value">"person"</span> /&gt;&lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The <code class="literal">PersonUser</code> class in this example would
      expose a property of type Person. As far as it's concerned, the AOP
      proxy can be used transparently in place of a "real" person
      implementation. However, its class would be a dynamic proxy class. It
      would be possible to cast it to the <code class="literal">Advised</code> interface
      (discussed below).</p><p>It's possible to conceal the distinction between target and proxy
      using an anonymous <span class="emphasis"><em>inner bean</em></span>, as follows. Only the
      <code class="literal">ProxyFactoryBean</code> definition is different; the advice
      is included only for completeness:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.MyAdvisor"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someProperty"</span>&gt;&lt;<span class="hl-tag">value</span>&gt;Custom string property value&lt;<span class="hl-tag">/value</span>&gt;&lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"debugInterceptor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.interceptor.DebugInterceptor"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"person"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"proxyInterfaces"</span>&gt;&lt;<span class="hl-tag">value</span>&gt;com.mycompany.Person&lt;<span class="hl-tag">/value</span>&gt;&lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-comment">!-- Use inner bean, not local reference to target --</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.PersonImpl"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span>&gt;&lt;<span class="hl-tag">value</span>&gt;Tony&lt;<span class="hl-tag">/value</span>&gt;&lt;<span class="hl-tag">/property</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span>&gt;&lt;<span class="hl-tag">value</span>&gt;51&lt;<span class="hl-tag">/value</span>&gt;&lt;<span class="hl-tag">/property</span>&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span>&gt;
    &lt;<span class="hl-tag">list</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;myAdvisor&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;debugInterceptor&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>This has the advantage that there's only one object of type
      <code class="literal">Person</code>: useful if we want to prevent users of the
      application context from obtaining a reference to the un-advised object, or
      need to avoid any ambiguity with Spring IoC
      <span class="emphasis"><em>autowiring</em></span>. There's also arguably an advantage in
      that the ProxyFactoryBean definition is self-contained. However, there
      are times when being able to obtain the un-advised target from the
      factory might actually be an <span class="emphasis"><em>advantage</em></span>: for
      example, in certain test scenarios.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-api-proxying-class"></a>B.4.5&nbsp;Proxying classes</h3></div></div></div><p>What if you need to proxy a class, rather than one or more
      interfaces?</p><p>Imagine that in our example above, there was no
      <code class="literal">Person</code> interface: we needed to advise a class called
      <code class="literal">Person</code> that didn't implement any business interface.
      In this case, you can configure Spring to use CGLIB proxying, rather
      than dynamic proxies. Simply set the <code class="literal">proxyTargetClass</code>
      property on the ProxyFactoryBean above to true. While it's best to
      program to interfaces, rather than classes, the ability to advise
      classes that don't implement interfaces can be useful when working with
      legacy code. (In general, Spring isn't prescriptive. While it makes it
      easy to apply good practices, it avoids forcing a particular
      approach.)</p><p>If you want to, you can force the use of CGLIB in any case, even if
      you do have interfaces.</p><p>CGLIB proxying works by generating a subclass of the target class
      at runtime. Spring configures this generated subclass to delegate method
      calls to the original target: the subclass is used to implement the
      <span class="emphasis"><em>Decorator</em></span> pattern, weaving in the advice.</p><p>CGLIB proxying should generally be transparent to users. However,
      there are some issues to consider:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">Final</code> methods can't be advised, as they
          can't be overridden.</p></li><li><p>You'll need the CGLIB 2 binaries on your classpath; dynamic
          proxies are available with the JDK.</p></li></ul></div><p>There's little performance difference between CGLIB proxying and
      dynamic proxies. As of Spring 1.0, dynamic proxies are slightly faster.
      However, this may change in the future. Performance should not be a
      decisive consideration in this case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-global-advisors"></a>B.4.6&nbsp;Using 'global' advisors</h3></div></div></div><p>By appending an asterisk to an interceptor name, all advisors with
      bean names matching the part before the asterisk, will be added to the
      advisor chain. This can come in handy if you need to add a standard set
      of 'global' advisors: </p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"proxy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"service"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span>&gt;
    &lt;<span class="hl-tag">list</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;global*&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"global_debug"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.interceptor.DebugInterceptor"</span>/&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"global_performance"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.interceptor.PerformanceMonitorInterceptor"</span>/&gt;
</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="classic-aop-concise-proxy"></a>B.5&nbsp;Concise proxy definitions</h2></div></div></div><p>Especially when defining transactional proxies, you may end up with
    many similar proxy definitions. The use of parent and child bean
    definitions, along with inner bean definitions, can result in much cleaner
    and more concise proxy definitions.</p><p>First a parent, <span class="emphasis"><em>template</em></span>, bean definition is
    created for the proxy:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txProxyTemplate"</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">"true"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributes"</span>&gt;
    &lt;<span class="hl-tag">props</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"*"</span>&gt;PROPAGATION_REQUIRED&lt;<span class="hl-tag">/prop</span>&gt;
    &lt;<span class="hl-tag">/props</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>This will never be instantiated itself, so may actually be
    incomplete. Then each proxy which needs to be created is just a child bean
    definition, which wraps the target of the proxy as an inner bean
    definition, since the target will never be used on its own
    anyway.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myService"</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"txProxyTemplate"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.MyServiceImpl"</span>&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>It is of course possible to override properties from the parent
    template, such as in this case, the transaction propagation
    settings:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mySpecialService"</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"txProxyTemplate"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.MySpecialServiceImpl"</span>&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributes"</span>&gt;
    &lt;<span class="hl-tag">props</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"get*"</span>&gt;PROPAGATION_REQUIRED,readOnly&lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"find*"</span>&gt;PROPAGATION_REQUIRED,readOnly&lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"load*"</span>&gt;PROPAGATION_REQUIRED,readOnly&lt;<span class="hl-tag">/prop</span>&gt;
      &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"store*"</span>&gt;PROPAGATION_REQUIRED&lt;<span class="hl-tag">/prop</span>&gt;
    &lt;<span class="hl-tag">/props</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Note that in the example above, we have explicitly marked the parent
    bean definition as <span class="emphasis"><em>abstract</em></span> by using the
    <span class="emphasis"><em>abstract</em></span> attribute, as described <a class="link" href="#beans-child-bean-definitions" title="4.7&nbsp;Bean definition inheritance">previously</a>, so that it may
    not actually ever be instantiated. Application contexts (but not simple
    bean factories) will by default pre-instantiate all singletons. It is therefore
    important (at least for singleton beans) that if you have a (parent)
    bean definition which you intend to use only as a template, and this
    definition specifies a class, you must make sure to set the
    <span class="emphasis"><em>abstract</em></span> attribute to <span class="emphasis"><em>true</em></span>,
    otherwise the application context will actually try to pre-instantiate
    it.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="classic-aop-prog"></a>B.6&nbsp;Creating AOP proxies programmatically with the ProxyFactory</h2></div></div></div><p>It's easy to create AOP proxies programmatically using Spring. This
    enables you to use Spring AOP without dependency on Spring IoC.</p><p>The following listing shows creation of a proxy for a target object,
    with one interceptor and one advisor. The interfaces implemented by the
    target object will automatically be proxied:</p><pre class="programlisting">ProxyFactory factory = <span class="hl-keyword">new</span> ProxyFactory(myBusinessInterfaceImpl);
factory.addInterceptor(myMethodInterceptor);
factory.addAdvisor(myAdvisor);
MyBusinessInterface tb = (MyBusinessInterface) factory.getProxy();</pre><p>The first step is to construct an object of type
    <code class="literal">org.springframework.aop.framework.ProxyFactory</code>. You can
    create this with a target object, as in the above example, or specify the
    interfaces to be proxied in an alternate constructor.</p><p>You can add interceptors or advisors, and manipulate them for the
    life of the ProxyFactory. If you add an
    IntroductionInterceptionAroundAdvisor you can cause the proxy to implement
    additional interfaces.</p><p>There are also convenience methods on ProxyFactory (inherited from
    <code class="classname">AdvisedSupport</code>) which allow you to add other advice types 
		such as before and throws advice. AdvisedSupport is the superclass of both 
    ProxyFactory and ProxyFactoryBean.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Integrating AOP proxy creation with the IoC framework is best
			practice in most applications. We recommend that you externalize
			configuration from Java code with AOP, as in general.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="classic-aop-api-advised"></a>B.7&nbsp;Manipulating advised objects</h2></div></div></div><p>However you create AOP proxies, you can manipulate them using the
    <code class="literal">org.springframework.aop.framework.Advised</code> interface.
    Any AOP proxy can be cast to this interface, whichever other interfaces it
    implements. This interface includes the following methods:</p><pre class="programlisting">Advisor[] getAdvisors();

<span class="hl-keyword">void</span> addAdvice(Advice advice) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> addAdvice(<span class="hl-keyword">int</span> pos, Advice advice) 
        <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> addAdvisor(Advisor advisor) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> addAdvisor(<span class="hl-keyword">int</span> pos, Advisor advisor) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">int</span> indexOf(Advisor advisor);

<span class="hl-keyword">boolean</span> removeAdvisor(Advisor advisor) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> removeAdvisor(<span class="hl-keyword">int</span> index) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">boolean</span> replaceAdvisor(Advisor a, Advisor b) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">boolean</span> isFrozen();</pre><p>The <code class="literal">getAdvisors()</code> method will return an Advisor
    for every advisor, interceptor or other advice type that has been added to
    the factory. If you added an Advisor, the returned advisor at this index
    will be the object that you added. If you added an interceptor or other
    advice type, Spring will have wrapped this in an advisor with a pointcut
    that always returns true. Thus if you added a
    <code class="literal">MethodInterceptor</code>, the advisor returned for this index
    will be an <code class="literal">DefaultPointcutAdvisor</code> returning your
    <code class="literal">MethodInterceptor</code> and a pointcut that matches all
    classes and methods.</p><p>The <code class="literal">addAdvisor()</code> methods can be used to add any
    Advisor. Usually the advisor holding pointcut and advice will be the
    generic <code class="literal">DefaultPointcutAdvisor</code>, which can be used with
    any advice or pointcut (but not for introductions).</p><p>By default, it's possible to add or remove advisors or interceptors
    even once a proxy has been created. The only restriction is that it's
    impossible to add or remove an introduction advisor, as existing proxies
    from the factory will not show the interface change. (You can obtain a new
    proxy from the factory to avoid this problem.)</p><p>A simple example of casting an AOP proxy to the
    <code class="literal">Advised</code> interface and examining and manipulating its
    advice:</p><pre class="programlisting">Advised advised = (Advised) myObject;
Advisor[] advisors = advised.getAdvisors();
<span class="hl-keyword">int</span> oldAdvisorCount = advisors.length;
System.out.println(oldAdvisorCount + <span class="hl-string">" advisors"</span>);

<span class="hl-comment">// Add an advice like an interceptor without a pointcut</span>
<span class="hl-comment">// Will match all proxied methods</span>
<span class="hl-comment">// Can use for interceptors, before, after returning or throws advice</span>
advised.addAdvice(<span class="hl-keyword">new</span> DebugInterceptor());

<span class="hl-comment">// Add selective advice using a pointcut</span>
advised.addAdvisor(<span class="hl-keyword">new</span> DefaultPointcutAdvisor(mySpecialPointcut, myAdvice));

assertEquals(<span class="hl-string">"Added two advisors"</span>,
     oldAdvisorCount + 2, advised.getAdvisors().length);</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>It's questionable whether it's advisable (no pun intended) to
			modify advice on a business object in production, although there are no
			doubt legitimate usage cases. However, it can be very useful in
			development: for example, in tests. I have sometimes found it very useful
			to be able to add test code in the form of an interceptor or other advice,
			getting inside a method invocation I want to test. (For example, the
			advice can get inside a transaction created for that method: for example,
			to run SQL to check that a database was correctly updated, before marking
			the transaction for roll back.)</p></td></tr></table></div><p>Depending on how you created the proxy, you can usually set a
    <code class="literal">frozen</code> flag, in which case the
    <code class="literal">Advised</code> <code class="literal">isFrozen()</code> method will
    return true, and any attempts to modify advice through addition or removal
    will result in an <code class="literal">AopConfigException</code>. The ability to
    freeze the state of an advised object is useful in some cases, for
    example, to prevent calling code removing a security interceptor. It may
    also be used in Spring 1.1 to allow aggressive optimization if runtime
    advice modification is known not to be required.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="classic-aop-autoproxy"></a>B.8&nbsp;Using the "autoproxy" facility</h2></div></div></div><p>So far we've considered explicit creation of AOP proxies using a
    <code class="literal">ProxyFactoryBean</code> or similar factory bean.</p><p>Spring also allows us to use "autoproxy" bean definitions, which can
    automatically proxy selected bean definitions. This is built on Spring
    "bean post processor" infrastructure, which enables modification of any
    bean definition as the container loads.</p><p>In this model, you set up some special bean definitions in your XML
    bean definition file to configure the auto proxy infrastructure. This
    allows you just to declare the targets eligible for autoproxying: you
    don't need to use <code class="literal">ProxyFactoryBean</code>.</p><p>There are two ways to do this:</p><div class="itemizedlist"><ul type="disc"><li><p>Using an autoproxy creator that refers to specific beans in the
        current context.</p></li><li><p>A special case of autoproxy creation that deserves to be
        considered separately; autoproxy creation driven by source-level
        metadata attributes.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-autoproxy-choices"></a>B.8.1&nbsp;Autoproxy bean definitions</h3></div></div></div><p>The <code class="literal">org.springframework.aop.framework.autoproxy</code>
      package provides the following standard autoproxy creators.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="classic-aop-api-autoproxy"></a>B.8.1.1&nbsp;BeanNameAutoProxyCreator</h4></div></div></div><p>The <code class="literal">BeanNameAutoProxyCreator</code> class is a
        <code class="literal">BeanPostProcessor</code> that automatically creates AOP proxies
        for beans with names matching literal values or wildcards.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beanNames"</span>&gt;&lt;<span class="hl-tag">value</span>&gt;jdk*,onlyJdk&lt;<span class="hl-tag">/value</span>&gt;&lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span>&gt;
    &lt;<span class="hl-tag">list</span>&gt;
      &lt;<span class="hl-tag">value</span>&gt;myInterceptor&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>As with <code class="literal">ProxyFactoryBean</code>, there is an
        <code class="literal">interceptorNames</code> property rather than a list of interceptors, to allow
        correct behavior for prototype advisors. Named "interceptors" can be
        advisors or any advice type.</p><p>As with auto proxying in general, the main point of using
        <code class="literal">BeanNameAutoProxyCreator</code> is to apply the same
        configuration consistently to multiple objects, with minimal
        volume of configuration. It is a popular choice for applying
        declarative transactions to multiple objects.</p><p>Bean definitions whose names match, such as "jdkMyBean" and
        "onlyJdk" in the above example, are plain old bean definitions with
        the target class. An AOP proxy will be created automatically by the
        <code class="literal">BeanNameAutoProxyCreator</code>. The same advice will be
        applied to all matching beans. Note that if advisors are used (rather
        than the interceptor in the above example), the pointcuts may apply
        differently to different beans.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="classic-aop-api-autoproxy-default"></a>B.8.1.2&nbsp;DefaultAdvisorAutoProxyCreator</h4></div></div></div><p>A more general and extremely powerful auto proxy creator is
        <code class="literal">DefaultAdvisorAutoProxyCreator</code>. This will
        automagically apply eligible advisors in the current context, without
        the need to include specific bean names in the autoproxy advisor's
        bean definition. It offers the same merit of consistent configuration
        and avoidance of duplication as
        <code class="literal">BeanNameAutoProxyCreator</code>.</p><p>Using this mechanism involves:</p><div class="itemizedlist"><ul type="disc"><li><p>Specifying a
            <code class="literal">DefaultAdvisorAutoProxyCreator</code> bean
            definition.</p></li><li><p>Specifying any number of Advisors in the same or related
            contexts. Note that these <span class="emphasis"><em>must</em></span> be Advisors,
            not just interceptors or other advices. This is necessary because
            there must be a pointcut to evaluate, to check the eligibility of
            each advice to candidate bean definitions.</p></li></ul></div><p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> will
        automatically evaluate the pointcut contained in each advisor, to see
        what (if any) advice it should apply to each business object (such as
        "businessObject1" and "businessObject2" in the example).</p><p>This means that any number of advisors can be applied
        automatically to each business object. If no pointcut in any of the
        advisors matches any method in a business object, the object will not
        be proxied. As bean definitions are added for new business objects,
        they will automatically be proxied if necessary.</p><p>Autoproxying in general has the advantage of making it
        impossible for callers or dependencies to obtain an un-advised object.
        Calling getBean("businessObject1") on this ApplicationContext will
        return an AOP proxy, not the target business object. (The "inner bean"
        idiom shown earlier also offers this benefit.)</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionInterceptor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionInterceptor"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"customAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.MyAdvisor"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessObject1"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.BusinessObject1"</span>&gt;
  &lt;<span class="hl-comment">!-- Properties omitted --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessObject2"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.BusinessObject2"</span>/&gt;
</pre><p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> is very
        useful if you want to apply the same advice consistently to many
        business objects. Once the infrastructure definitions are in place,
        you can simply add new business objects without including specific
        proxy configuration. You can also drop in additional aspects very
        easily - for example, tracing or performance monitoring aspects - with
        minimal change to configuration.</p><p>The DefaultAdvisorAutoProxyCreator offers support for filtering
        (using a naming convention so that only certain advisors are
        evaluated, allowing use of multiple, differently configured,
        AdvisorAutoProxyCreators in the same factory) and ordering. Advisors
        can implement the <code class="literal">org.springframework.core.Ordered</code>
        interface to ensure correct ordering if this is an issue. The
        TransactionAttributeSourceAdvisor used in the above example has a
        configurable order value; the default setting is unordered.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="classic-aop-api-autoproxy-abstract"></a>B.8.1.3&nbsp;AbstractAdvisorAutoProxyCreator</h4></div></div></div><p>This is the superclass of DefaultAdvisorAutoProxyCreator. You
        can create your own autoproxy creators by subclassing this class, in
        the unlikely event that advisor definitions offer insufficient
        customization to the behavior of the framework
        <code class="literal">DefaultAdvisorAutoProxyCreator</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-autoproxy-metadata"></a>B.8.2&nbsp;Using metadata-driven auto-proxying</h3></div></div></div><p>A particularly important type of autoproxying is driven by
      metadata. This produces a similar programming model to .NET
      <code class="literal">ServicedComponents</code>. Instead of using XML deployment
      descriptors as in EJB, configuration for transaction management and
      other enterprise services is held in source-level attributes.</p><p>In this case, you use the
      <code class="literal">DefaultAdvisorAutoProxyCreator</code>, in combination with
      Advisors that understand metadata attributes. The metadata specifics are
      held in the pointcut part of the candidate advisors, rather than in the
      autoproxy creation class itself.</p><p>This is really a special case of the
      <code class="literal">DefaultAdvisorAutoProxyCreator</code>, but deserves
      consideration on its own. (The metadata-aware code is in the pointcuts
      contained in the advisors, not the AOP framework itself.)</p><p>The <code class="literal">/attributes</code> directory of the JPetStore
      sample application shows the use of attribute-driven autoproxying. In
      this case, there's no need to use the
      <code class="literal">TransactionProxyFactoryBean</code>. Simply defining
      transactional attributes on business objects is sufficient, because of
      the use of metadata-aware pointcuts. The bean definitions include the
      following code, in <code class="literal">/WEB-INF/declarativeServices.xml</code>.
      Note that this is generic, and can be used outside the JPetStore:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionInterceptor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionInterceptor"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionInterceptor"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionInterceptor"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributeSource"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.AttributesTransactionAttributeSource"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"attributes"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"attributes"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"attributes"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.metadata.commons.CommonsAttributes"</span>/&gt;</pre><p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> bean
      definition (the name is not significant, hence it can even be omitted)
      will pick up all eligible pointcuts in the current application context.
      In this case, the "transactionAdvisor" bean definition, of type
      <code class="literal">TransactionAttributeSourceAdvisor</code>, will apply to
      classes or methods carrying a transaction attribute. The
      TransactionAttributeSourceAdvisor depends on a TransactionInterceptor,
      via constructor dependency. The example resolves this via autowiring.
      The <code class="literal">AttributesTransactionAttributeSource</code> depends on
      an implementation of the
      <code class="literal">org.springframework.metadata.Attributes</code> interface. In
      this fragment, the "attributes" bean satisfies this, using the Jakarta
      Commons Attributes API to obtain attribute information. (The application
      code must have been compiled using the Commons Attributes compilation
      task.)</p><p>The <code class="literal">/annotation</code> directory of the JPetStore
      sample application contains an analogous example for auto-proxying
      driven by JDK 1.5+ annotations. The following configuration enables
      automatic detection of Spring's <code class="literal">Transactional</code>
      annotation, leading to implicit proxies for beans containing that
      annotation:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionInterceptor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionInterceptor"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionInterceptor"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionInterceptor"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributeSource"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.annotation.AnnotationTransactionAttributeSource"</span>/&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The <code class="literal">TransactionInterceptor</code> defined here depends
      on a <code class="literal">PlatformTransactionManager</code> definition, which is
      not included in this generic file (although it could be) because it will
      be specific to the application's transaction requirements (typically
      JTA, as in this example, or Hibernate, JDO or JDBC):</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionManager"</span> 
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.jta.JtaTransactionManager"</span>/&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you require only declarative transaction management, using
				these generic XML definitions will result in Spring automatically
				proxying all classes or methods with transaction attributes. You won't
				need to work directly with AOP, and the programming model is similar to
				that of .NET ServicedComponents.</p></td></tr></table></div><p>This mechanism is extensible. It's possible to do autoproxying
      based on custom attributes. You need to:</p><div class="itemizedlist"><ul type="disc"><li><p>Define your custom attribute.</p></li><li><p>Specify an Advisor with the necessary advice, including a
          pointcut that is triggered by the presence of the custom attribute
          on a class or method. You may be able to use an existing advice,
          merely implementing a static pointcut that picks up the custom
          attribute.</p></li></ul></div><p>It's possible for such advisors to be unique to each advised class
      (for example, mixins): they simply need to be defined as prototype,
      rather than singleton, bean definitions. For example, the
      <code class="literal">LockMixin</code> introduction interceptor from the Spring
      test suite, shown above, could be used in conjunction with an
      attribute-driven pointcut to target a mixin, as shown here. We use the
      generic <code class="literal">DefaultPointcutAdvisor</code>, configured using
      JavaBean properties:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"lockMixin"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.LockMixin"</span>
    <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"lockableAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.support.DefaultPointcutAdvisor"</span>
    <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"pointcut"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myAttributeAwarePointcut"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"advice"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"lockMixin"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anyBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"anyclass"</span> <span class="hl-attribute">...</span></pre><p>If the attribute aware pointcut matches any methods in the
      <code class="literal">anyBean</code> or other bean definitions, the mixin will be
      applied. Note that both <code class="literal">lockMixin</code> and
      <code class="literal">lockableAdvisor</code> definitions are prototypes. The
      <code class="literal">myAttributeAwarePointcut</code> pointcut can be a singleton
      definition, as it doesn't hold state for individual advised
      objects.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="classic-aop-targetsource"></a>B.9&nbsp;Using TargetSources</h2></div></div></div><p>Spring offers the concept of a <span class="emphasis"><em>TargetSource</em></span>,
    expressed in the <code class="literal">org.springframework.aop.TargetSource</code>
    interface. This interface is responsible for returning the "target object"
    implementing the join point. The <code class="literal">TargetSource</code>
    implementation is asked for a target instance each time the AOP proxy
    handles a method invocation.</p><p>Developers using Spring AOP don't normally need to work directly
    with TargetSources, but this provides a powerful means of supporting
    pooling, hot swappable and other sophisticated targets. For example, a
    pooling TargetSource can return a different target instance for each
    invocation, using a pool to manage instances.</p><p>If you do not specify a TargetSource, a default implementation is
    used that wraps a local object. The same target is returned for each
    invocation (as you would expect).</p><p>Let's look at the standard target sources provided with Spring, and
    how you can use them.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>When using a custom target source, your target will usually need
			to be a prototype rather than a singleton bean definition. This allows
			Spring to create a new target instance when required.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-ts-swap"></a>B.9.1&nbsp;Hot swappable target sources</h3></div></div></div><p>The
      <code class="literal">org.springframework.aop.target.HotSwappableTargetSource</code>
      exists to allow the target of an AOP proxy to be switched while allowing
      callers to keep their references to it.</p><p>Changing the target source's target takes effect immediately. The
      <code class="literal">HotSwappableTargetSource</code> is threadsafe.</p><p>You can change the target via the <code class="literal">swap()</code> method
      on HotSwappableTargetSource as follows:</p><pre class="programlisting">HotSwappableTargetSource swapper = 
    (HotSwappableTargetSource) beanFactory.getBean(<span class="hl-string">"swapper"</span>);
Object oldTarget = swapper.swap(newTarget);</pre><p>The XML definitions required look as follows:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"initialTarget"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mycompany.OldTarget"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"swapper"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.target.HotSwappableTargetSource"</span>&gt;
  &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"initialTarget"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"swappable"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"swapper"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The above <code class="literal">swap()</code> call changes the target of the
      swappable bean. Clients who hold a reference to that bean will be
      unaware of the change, but will immediately start hitting the new
      target.</p><p>Although this example doesn't add any advice - and it's not
      necessary to add advice to use a <code class="literal">TargetSource</code> - of
      course any <code class="literal">TargetSource</code> can be used in conjunction
      with arbitrary advice.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-ts-pool"></a>B.9.2&nbsp;Pooling target sources</h3></div></div></div><p>Using a pooling target source provides a similar programming model
      to stateless session EJBs, in which a pool of identical instances is
      maintained, with method invocations going to free objects in the
      pool.</p><p>A crucial difference between Spring pooling and SLSB pooling is
      that Spring pooling can be applied to any POJO. As with Spring in
      general, this service can be applied in a non-invasive way.</p><p>Spring provides out-of-the-box support for Jakarta Commons Pool
      1.3, which provides a fairly efficient pooling implementation. You'll
      need the commons-pool Jar on your application's classpath to use this
      feature. It's also possible to subclass
      <code class="literal">org.springframework.aop.target.AbstractPoolingTargetSource</code>
      to support any other pooling API.</p><p>Sample configuration is shown below:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessObjectTarget"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.MyBusinessObject"</span> 
    <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span>&gt;
  ... properties omitted
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"poolTargetSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.target.CommonsPoolTargetSource"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetBeanName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"businessObjectTarget"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"maxSize"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"25"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessObject"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"poolTargetSource"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"myInterceptor"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>Note that the target object - "businessObjectTarget" in the
      example - <span class="emphasis"><em>must</em></span> be a prototype. This allows the
      <code class="literal">PoolingTargetSource</code> implementation to create new
      instances of the target to grow the pool as necessary. See the havadoc
      for <code class="literal">AbstractPoolingTargetSource</code> and the concrete
      subclass you wish to use for information about its properties: "maxSize"
      is the most basic, and always guaranteed to be present.</p><p>In this case, "myInterceptor" is the name of an interceptor that
      would need to be defined in the same IoC context. However, it isn't
      necessary to specify interceptors to use pooling. If you want only
      pooling, and no other advice, don't set the interceptorNames property at
      all.</p><p>It's possible to configure Spring so as to be able to cast any
      pooled object to the
      <code class="literal">org.springframework.aop.target.PoolingConfig</code>
      interface, which exposes information about the configuration and current
      size of the pool through an introduction. You'll need to define an
      advisor like this:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"poolConfigAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.MethodInvokingFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetObject"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"poolTargetSource"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetMethod"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"getPoolingConfigMixin"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>This advisor is obtained by calling a convenience method on the
      <code class="literal">AbstractPoolingTargetSource</code> class, hence the use of
      MethodInvokingFactoryBean. This advisor's name ("poolConfigAdvisor"
      here) must be in the list of interceptors names in the ProxyFactoryBean
      exposing the pooled object.</p><p>The cast will look as follows:</p><pre class="programlisting">PoolingConfig conf = (PoolingConfig) beanFactory.getBean(<span class="hl-string">"businessObject"</span>);
System.out.println(<span class="hl-string">"Max pool size is "</span> + conf.getMaxSize());</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Pooling stateless service objects is not usually necessary. We
				don't believe it should be the default choice, as most stateless objects
				are naturally thread safe, and instance pooling is problematic if
				resources are cached.</p></td></tr></table></div><p>Simpler pooling is available using autoproxying. It's possible to
      set the TargetSources used by any autoproxy creator.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-ts-prototype"></a>B.9.3&nbsp;Prototype target sources</h3></div></div></div><p>Setting up a "prototype" target source is similar to a pooling
      TargetSource. In this case, a new instance of the target will be created
      on every method invocation. Although the cost of creating a new object
      isn't high in a modern JVM, the cost of wiring up the new object
      (satisfying its IoC dependencies) may be more expensive. Thus you
      shouldn't use this approach without very good reason.</p><p>To do this, you could modify the
      <code class="literal">poolTargetSource</code> definition shown above as follows.
      (I've also changed the name, for clarity.)</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"prototypeTargetSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.target.PrototypeTargetSource"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetBeanName"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"businessObjectTarget"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>There's only one property: the name of the target bean.
      Inheritance is used in the TargetSource implementations to ensure
      consistent naming. As with the pooling target source, the target bean
      must be a prototype bean definition.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="classic-aop-ts-threadlocal"></a>B.9.4&nbsp;<code class="classname">ThreadLocal</code> target sources</h3></div></div></div><p><code class="classname">ThreadLocal</code> target sources are useful if you need an object to be
      created for each incoming request (per thread that is). The concept of a
      <code class="classname">ThreadLocal</code> provide a JDK-wide facility to
      transparently store resource alongside a thread. Setting up a
      <code class="classname">ThreadLocalTargetSource</code> is pretty much the same as was explained for the
      other types of target source:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"threadlocalTargetSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.target.ThreadLocalTargetSource"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetBeanName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"businessObjectTarget"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>ThreadLocals come with serious issues (potentially
				resulting in memory leaks) when incorrectly using them in a
				multi-threaded and multi-classloader environments. One should always
				consider wrapping a threadlocal in some other class and never directly
				use the <code class="classname">ThreadLocal</code> itself (except of course in the wrapper class).
				Also, one should always remember to correctly set and unset (where the
				latter simply involved a call to <code class="literal">ThreadLocal.set(null)</code>) the resource
				local to the thread. Unsetting should be done in any case since not
				unsetting it might result in problematic behavior. Spring's ThreadLocal
				support does this for you and should always be considered in favor
				of using ThreadLocals without other proper handling
				code.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="classic-aop-extensibility"></a>B.10&nbsp;Defining new <code class="interfacename">Advice</code> types</h2></div></div></div><p>Spring AOP is designed to be extensible. While the interception
    implementation strategy is presently used internally, it is possible to
    support arbitrary advice types in addition to the out-of-the-box interception around advice,
    before, throws advice and after returning advice.</p><p>The <code class="literal">org.springframework.aop.framework.adapter</code>
    package is an SPI package allowing support for new custom advice types to
    be added without changing the core framework. The only constraint on a
    custom <code class="interfacename">Advice</code> type is that it must implement the
    <code class="interfacename">org.aopalliance.aop.Advice</code> tag interface.</p><p>Please refer to the
    <code class="literal">org.springframework.aop.framework.adapter</code> package's
    Javadocs for further information.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="classic-aop-api-resources"></a>B.11&nbsp;Further resources</h2></div></div></div><p>Please refer to the Spring sample applications for further examples
    of Spring AOP:</p><div class="itemizedlist"><ul type="disc"><li><p>The JPetStore's default configuration illustrates the use of the
        <code class="classname">TransactionProxyFactoryBean</code> for declarative transaction
        management.</p></li><li><p>The <code class="literal">/attributes</code> directory of the JPetStore
        illustrates the use of attribute-driven declarative transaction management.</p></li></ul></div></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xsd-config"></a>Appendix&nbsp;C.&nbsp;XML Schema-based configuration</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xsd-config-introduction"></a>C.1&nbsp;Introduction</h2></div></div></div><p>This appendix details the XML Schema-based configuration introduced in Spring 2.0 and enhanced and extended in Spring 2.5 and 3.0.</p><div class="sidebar"><p class="title"><b>DTD support?</b></p><p>Authoring Spring configuration files using the older DTD style
            is still fully supported.</p><p>Nothing will break if you forego the use of the new XML Schema-based
            approach to authoring Spring XML configuration files. All that you lose
            out on is the opportunity to have more succinct and clearer configuration.
            Regardless of whether the XML configuration is DTD- or Schema-based, in the end
            it all boils down to the same object model in the container (namely one or
            more <code class="interfacename">BeanDefinition</code> instances).</p></div><p>The central motivation for moving to XML Schema based configuration files was
        to make Spring XML configuration easier. The <span class="emphasis"><em>'classic'</em></span>
        <code class="literal">&lt;bean/&gt;</code>-based approach is good, but its generic-nature comes
        with a price in terms of configuration overhead.</p><p>From the Spring IoC containers point-of-view, <span class="emphasis"><em>everything</em></span>
        is a bean. That's great news for the Spring IoC container, because if everything is
        a bean then everything can be treated in the exact same fashion. The same, however,
        is not true from a developer's point-of-view. The objects defined in a Spring
        XML configuration file are not all generic, vanilla beans. Usually, each bean requires
        some degree of specific configuration.</p><p>Spring 2.0's new XML Schema-based configuration addresses this issue.
        The <code class="literal">&lt;bean/&gt;</code> element is still present, and if you
        wanted to, you could continue to write the <span class="emphasis"><em>exact same</em></span>
        style of Spring XML configuration using only <code class="literal">&lt;bean/&gt;</code>
        elements. The new XML Schema-based configuration does, however, make
        Spring XML configuration files substantially clearer to read. In addition, it allows
        you to express the intent of a bean definition.</p><p>The key thing to remember is that the new custom tags work best for infrastructure
        or integration beans: for example, AOP, collections, transactions, integration with
        3rd-party frameworks such as Mule, etc., while the existing bean tags are best suited to
        application-specific beans, such as DAOs, service layer objects, validators, etc.</p><p>The examples included below will hopefully convince you that the inclusion
        of XML Schema support in Spring 2.0 was a good idea. The reception in the community
        has been encouraging; also, please note the fact that this new configuration mechanism
        is totally customisable and extensible. This means you can write your own domain-specific
        configuration tags that would better represent your application's domain; the process
        involved in doing so is covered in the appendix entitled <a class="xref" href="#extensible-xml" title="Appendix&nbsp;D.&nbsp;Extensible XML authoring">Appendix&nbsp;D, <i>Extensible XML authoring</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xsd-config-body"></a>C.2&nbsp;XML Schema-based configuration</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-referencing"></a>C.2.1&nbsp;Referencing the schemas</h3></div></div></div><p>To switch over from the DTD-style to the new XML Schema-style, you need
            to make the following change.</p><pre class="programlisting">
&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">!DOCTYPE</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">PUBLIC</span> <span class="hl-attribute">"-//SPRING//DTD</span> <span class="hl-attribute">BEAN</span> <span class="hl-attribute">2.0//EN"</span>
    <span class="hl-attribute">"http://www.springframework.org/dtd/spring-beans-2.0.dtd"&gt;</span>

<span class="hl-attribute">&lt;beans&gt;</span>

<span class="hl-attribute">&lt;!--</span> <span class="hl-attribute">&lt;bean/&gt;</span> <span class="hl-attribute">definitions</span> <span class="hl-attribute">here</span> <span class="hl-attribute">--&gt;</span>

<span class="hl-attribute">&lt;/beans&gt;</span></pre><p>The equivalent file in the XML Schema-style would be...</p><pre class="programlisting">
&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

&lt;<span class="hl-comment">!-- &lt;bean/&gt; definitions here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">'xsi:schemaLocation'</code> fragment is not actually required,
                but can be included to reference a local copy of a schema (which can be useful
                during development).</p></td></tr></table></div><p>The above Spring XML configuration fragment is boilerplate that you can copy and paste
            (!) and then plug <code class="literal">&lt;bean/&gt;</code> definitions into like you have always
            done. However, the entire point of switching over is to
            take advantage of the new Spring 2.0 XML tags since they make configuration easier. The
            section entitled <a class="xref" href="#xsd-config-body-schemas-util" title="C.2.2&nbsp;The util schema">Section&nbsp;C.2.2, &#8220;The util schema&#8221;</a> demonstrates how you can
            start immediately by using some of the more common utility tags.</p></div><p>The rest of this chapter is devoted to showing examples of the new Spring XML Schema
        based configuration, with at least one example for every new tag. The format follows
        a before and after style, with a <span class="emphasis"><em>before</em></span> snippet of XML showing
        the old (but still 100% legal and supported) style, followed immediately
        by an <span class="emphasis"><em>after</em></span> example showing the equivalent in the new XML Schema-based
        style.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-util"></a>C.2.2&nbsp;The <code class="literal">util</code> schema</h3></div></div></div><p>First up is coverage of the <code class="literal">util</code> tags. As the name
            implies, the <code class="literal">util</code> tags deal with common, <span class="emphasis"><em>utility</em></span>
            configuration issues, such as configuring collections, referencing constants,
            and suchlike.</p><p>To use the tags in the <code class="literal">util</code> schema, you need to have
            the following preamble at the top of your Spring XML configuration file;
            the text in the snippet below references the correct schema so that
            the tags in the <code class="literal">util</code> namespace are available to you.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:util</span>=<span class="hl-value">"http://www.springframework.org/schema/util"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd"</span>&gt;

&lt;<span class="hl-comment">!-- &lt;bean/&gt; definitions here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-util-constant"></a>C.2.2.1&nbsp;<code class="literal">&lt;util:constant/&gt;</code></h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"isolation"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"java.sql.Connection.TRANSACTION_SERIALIZABLE"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.FieldRetrievingFactoryBean"</span> /&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The above configuration uses a Spring <code class="interfacename">FactoryBean</code>
                implementation, the <code class="classname">FieldRetrievingFactoryBean</code>, to
                set the value of the <code class="literal">'isolation'</code> property on a bean
                to the value of the <code class="literal">'java.sql.Connection.TRANSACTION_SERIALIZABLE'</code>
                constant. This is all well and good, but it is a tad verbose and (unneccessarily)
                exposes Spring's internal plumbing to the end user.
                </p><p>The following XML Schema-based version is more concise
                and clearly expresses the developer's intent (<span class="emphasis"><em>'inject this constant
                value'</em></span>), and it just reads better.
                </p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"isolation"</span>&gt;
    &lt;<span class="hl-tag">util:constant</span> <span class="hl-attribute">static-field</span>=<span class="hl-value">"java.sql.Connection.TRANSACTION_SERIALIZABLE"</span>/&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="xsd-config-body-schemas-util-frfb"></a>Setting a bean property or constructor arg from a field value</h5></div></div></div><p>
                        <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/beans/factory/config/FieldRetrievingFactoryBean.html" target="_top"><code class="classname">FieldRetrievingFactoryBean</code></a>
                        is a <code class="interfacename">FactoryBean</code> which retrieves a
                        <code class="literal">static</code> or non-static field value. It is typically
                        used for retrieving <code class="literal">public</code> <code class="literal">static</code>
                        <code class="literal">final</code> constants, which may then be used to set a
                        property value or constructor arg for another bean.
                    </p><p>
                        Find below an example which shows how a <code class="literal">static</code> field is exposed, by
                        using the <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/beans/factory/config/FieldRetrievingFactoryBean.html#setStaticField(java.lang.String)" target="_top"><code class="literal">staticField</code></a>
                        property:
                    </p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myField"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.FieldRetrievingFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"staticField"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"java.sql.Connection.TRANSACTION_SERIALIZABLE"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>There is also a convenience usage form where the <code class="literal">static</code>
                    field is specified as the bean name:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"java.sql.Connection.TRANSACTION_SERIALIZABLE"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.FieldRetrievingFactoryBean"</span>/&gt;</pre><p>
                        This does mean that there is no longer any choice in what the bean id is (so
                        any other bean that refers to it will also have to use this longer name),
                        but this form is very concise to define, and very convenient to use as an
                        inner bean since the id doesn't have to be specified for the bean
                        reference:
                    </p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"isolation"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"java.sql.Connection.TRANSACTION_SERIALIZABLE"</span>
          <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.FieldRetrievingFactoryBean"</span> /&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>
                        It is also possible to access a non-static (instance) field of another bean,
                        as described in the API documentation for the
                        <a class="ulink" href="http://static.springframework.org/spring/docs/3.0.x/javadoc-api/org/springframework/beans/factory/config/FieldRetrievingFactoryBean.html" target="_top"><code class="classname">FieldRetrievingFactoryBean</code></a>
                        class.
                    </p><p>
                        Injecting enum values into beans as either property or constructor arguments is very
                        easy to do in Spring, in that you don't actually have to <span class="emphasis"><em>do</em></span>
                        anything or know anything about the Spring internals (or even about classes such
                        as the <code class="classname">FieldRetrievingFactoryBean</code>). Let's look at an example
                        to see how easy injecting an enum value is; consider this JDK 5 enum:
                    </p><pre class="programlisting"><span class="hl-keyword">package</span> javax.persistence;

<span class="hl-keyword">public</span> enum PersistenceContextType {

    TRANSACTION,
    EXTENDED

}</pre><p>Now consider a setter of type <code class="classname">PersistenceContextType</code>:</p><pre class="programlisting"><span class="hl-keyword">package</span> example;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Client {

    <span class="hl-keyword">private</span> PersistenceContextType persistenceContextType;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setPersistenceContextType(PersistenceContextType type) {
        <span class="hl-keyword">this</span>.persistenceContextType = type;
    }
}</pre><p>.. and the corresponding bean definition:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.Client"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"persistenceContextType"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"TRANSACTION"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>
                        This works for classic type-safe emulated enums (on JDK 1.4 and JDK 1.3) as well;
                        Spring will automatically attempt to match the string property value to a constant
                        on the enum class.
                    </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-util-property-path"></a>C.2.2.2&nbsp;<code class="literal">&lt;util:property-path/&gt;</code></h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;<span class="hl-comment">!-- target bean to be referenced by name --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.TestBean"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"10"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"spouse"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.TestBean"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"11"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-comment">!-- will result in 10, which is the value of property 'age' of bean 'testBean' --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean.age"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.PropertyPathFactoryBean"</span>/&gt;</pre><p>The above configuration uses a Spring <code class="interfacename">FactoryBean</code>
                implementation, the <code class="classname">PropertyPathFactoryBean</code>, to
                create a bean (of type <code class="classname">int</code>) called
                <code class="literal">'testBean.age'</code> that has a value equal to the <code class="literal">'age'</code>
                property of the <code class="literal">'testBean'</code> bean.
                </p><p>After...</p><pre class="programlisting">&lt;<span class="hl-comment">!-- target bean to be referenced by name --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"testBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.TestBean"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"10"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"spouse"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.TestBean"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"11"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-comment">!-- will result in 10, which is the value of property 'age' of bean 'testBean' --</span>&gt;
&lt;<span class="hl-tag">util:property-path</span> <span class="hl-attribute">id</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">path</span>=<span class="hl-value">"testBean.age"</span>/&gt;</pre><p>The value of the <code class="literal">'path'</code> attribute of the
                <code class="literal">&lt;property-path/&gt;</code> tag follows the form <code class="literal">'beanName.beanProperty'</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="xsd-config-body-schemas-util-property-path-dependency"></a>Using <code class="literal">&lt;util:property-path/&gt;</code> to set a bean property or constructor-argument</h5></div></div></div><p><code class="classname">PropertyPathFactoryBean</code> is a
                    <code class="interfacename">FactoryBean</code> that evaluates a property path on a given
                    target object. The target object can be specified directly or via a bean
                    name. This value may then be used in another bean definition as a property
                    value or constructor argument.</p><p>Here's an example where a path is used against another bean, by name:</p><pre class="programlisting">// target bean to be referenced by name
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"person"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.TestBean"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"10"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"spouse"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.TestBean"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"11"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

// will result in 11, which is the value of property 'spouse.age' of bean 'person'
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"theAge"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.PropertyPathFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetBeanName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"person"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"propertyPath"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"spouse.age"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>In this example, a path is evaluated against an inner bean:</p><pre class="programlisting">&lt;<span class="hl-comment">!-- will result in 12, which is the value of property 'age' of the inner bean --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"theAge"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.PropertyPathFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetObject"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.TestBean"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"12"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"propertyPath"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"age"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>There is also a shortcut form, where the bean name is the property path.</p><pre class="programlisting">&lt;<span class="hl-comment">!-- will result in 10, which is the value of property 'age' of bean 'person' --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"person.age"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.PropertyPathFactoryBean"</span>/&gt;</pre><p>This form does mean that there is no choice in the name of the bean.
                    Any reference to it will also have to use the same id, which is the path.
                    Of course, if used as an inner bean, there is no need to refer to it at
                    all:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span>&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"person.age"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.PropertyPathFactoryBean"</span>/&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The result type may be specifically set in the actual definition.
                    This is not necessary for most use cases, but can be of use for some.
                    Please see the Javadocs for more info on this feature.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-util-properties"></a>C.2.2.3&nbsp;<code class="literal">&lt;util:properties/&gt;</code></h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;<span class="hl-comment">!-- creates a java.util.Properties instance with values loaded from the supplied location --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jdbcConfiguration"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.PropertiesFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"location"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"classpath:com/foo/jdbc-production.properties"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The above configuration uses a Spring <code class="interfacename">FactoryBean</code>
                implementation, the <code class="classname">PropertiesFactoryBean</code>, to
                instantiate a <code class="classname">java.util.Properties</code> instance with values loaded from
                the supplied <a class="link" href="#resources" title="5.&nbsp;Resources"><code class="interfacename">Resource</code></a> location).
                </p><p>After...</p><pre class="programlisting">&lt;<span class="hl-comment">!-- creates a java.util.Properties instance with values loaded from the supplied location --</span>&gt;
&lt;<span class="hl-tag">util:properties</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jdbcConfiguration"</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:com/foo/jdbc-production.properties"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-util-list"></a>C.2.2.4&nbsp;<code class="literal">&lt;util:list/&gt;</code></h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;<span class="hl-comment">!-- creates a java.util.List instance with values loaded from the supplied 'sourceList' --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emails"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.ListFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sourceList"</span>&gt;
      &lt;<span class="hl-tag">list</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;pechorin@hero.org&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;raskolnikov@slums.org&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;stavrogin@gov.org&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;porfiry@gov.org&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">/list</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The above configuration uses a Spring <code class="interfacename">FactoryBean</code>
                implementation, the <code class="classname">ListFactoryBean</code>, to
                create a <code class="classname">java.util.List</code> instance initialized
                with values taken from the supplied <code class="literal">'sourceList'</code>.
                </p><p>After...</p><pre class="programlisting">&lt;<span class="hl-comment">!-- creates a java.util.List instance with the supplied values --</span>&gt;
&lt;<span class="hl-tag">util:list</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emails"</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;pechorin@hero.org&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;raskolnikov@slums.org&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;stavrogin@gov.org&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;porfiry@gov.org&lt;<span class="hl-tag">/value</span>&gt;
&lt;<span class="hl-tag">/util:list</span>&gt;</pre><p>You can also explicitly control the exact type of <code class="interfacename">List</code>
                that will be instantiated and populated via the use of the <code class="literal">'list-class'</code>
                attribute on the <code class="literal">&lt;util:list/&gt;</code> element. For example, if we
                really need a <code class="classname">java.util.LinkedList</code> to be instantiated, we could
                use the following configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">util:list</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emails"</span> <span class="hl-attribute">list-class</span>=<span class="hl-value">"java.util.LinkedList"</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;jackshaftoe@vagabond.org&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;eliza@thinkingmanscrumpet.org&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;vanhoek@pirate.org&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;d'Arcachon@nemesis.org&lt;<span class="hl-tag">/value</span>&gt;
&lt;<span class="hl-tag">/util:list</span>&gt;</pre><p>If no <code class="literal">'list-class'</code> attribute is supplied, a
                <code class="interfacename">List</code> implementation will be chosen by the container.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-util-map"></a>C.2.2.5&nbsp;<code class="literal">&lt;util:map/&gt;</code></h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;<span class="hl-comment">!-- creates a java.util.Map instance with values loaded from the supplied 'sourceMap' --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emails"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.MapFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sourceMap"</span>&gt;
      &lt;<span class="hl-tag">map</span>&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"pechorin"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"pechorin@hero.org"</span>/&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"raskolnikov"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"raskolnikov@slums.org"</span>/&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"stavrogin"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"stavrogin@gov.org"</span>/&gt;
        &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"porfiry"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"porfiry@gov.org"</span>/&gt;
      &lt;<span class="hl-tag">/map</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The above configuration uses a Spring <code class="interfacename">FactoryBean</code>
                implementation, the <code class="classname">MapFactoryBean</code>, to
                create a <code class="classname">java.util.Map</code> instance initialized
                with key-value pairs taken from the supplied <code class="literal">'sourceMap'</code>.
                </p><p>After...</p><pre class="programlisting">&lt;<span class="hl-comment">!-- creates a java.util.Map instance with the supplied key-value pairs --</span>&gt;
&lt;<span class="hl-tag">util:map</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emails"</span>&gt;
    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"pechorin"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"pechorin@hero.org"</span>/&gt;
    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"raskolnikov"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"raskolnikov@slums.org"</span>/&gt;
    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"stavrogin"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"stavrogin@gov.org"</span>/&gt;
    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"porfiry"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"porfiry@gov.org"</span>/&gt;
&lt;<span class="hl-tag">/util:map</span>&gt;</pre><p>You can also explicitly control the exact type of <code class="interfacename">Map</code>
                that will be instantiated and populated via the use of the <code class="literal">'map-class'</code>
                attribute on the <code class="literal">&lt;util:map/&gt;</code> element. For example, if we
                really need a <code class="classname">java.util.TreeMap</code> to be instantiated, we could
                use the following configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">util:map</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emails"</span> <span class="hl-attribute">map-class</span>=<span class="hl-value">"java.util.TreeMap"</span>&gt;
    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"pechorin"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"pechorin@hero.org"</span>/&gt;
    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"raskolnikov"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"raskolnikov@slums.org"</span>/&gt;
    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"stavrogin"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"stavrogin@gov.org"</span>/&gt;
    &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"porfiry"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"porfiry@gov.org"</span>/&gt;
&lt;<span class="hl-tag">/util:map</span>&gt;</pre><p>If no <code class="literal">'map-class'</code> attribute is supplied, a
                <code class="interfacename">Map</code> implementation will be chosen by the container.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-util-set"></a>C.2.2.6&nbsp;<code class="literal">&lt;util:set/&gt;</code></h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;<span class="hl-comment">!-- creates a java.util.Set instance with values loaded from the supplied 'sourceSet' --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emails"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.SetFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sourceSet"</span>&gt;
      &lt;<span class="hl-tag">set</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;pechorin@hero.org&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;raskolnikov@slums.org&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;stavrogin@gov.org&lt;<span class="hl-tag">/value</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;porfiry@gov.org&lt;<span class="hl-tag">/value</span>&gt;
      &lt;<span class="hl-tag">/set</span>&gt;
  &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>The above configuration uses a Spring <code class="interfacename">FactoryBean</code>
                implementation, the <code class="classname">SetFactoryBean</code>, to
                create a <code class="classname">java.util.Set</code> instance initialized
                with values taken from the supplied <code class="literal">'sourceSet'</code>.
                </p><p>After...</p><pre class="programlisting">&lt;<span class="hl-comment">!-- creates a java.util.Set instance with the supplied values --</span>&gt;
&lt;<span class="hl-tag">util:set</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emails"</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;pechorin@hero.org&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;raskolnikov@slums.org&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;stavrogin@gov.org&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;porfiry@gov.org&lt;<span class="hl-tag">/value</span>&gt;
&lt;<span class="hl-tag">/util:set</span>&gt;</pre><p>You can also explicitly control the exact type of <code class="interfacename">Set</code>
                that will be instantiated and populated via the use of the <code class="literal">'set-class'</code>
                attribute on the <code class="literal">&lt;util:set/&gt;</code> element. For example, if we
                really need a <code class="classname">java.util.TreeSet</code> to be instantiated, we could
                use the following configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">util:set</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emails"</span> <span class="hl-attribute">set-class</span>=<span class="hl-value">"java.util.TreeSet"</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;pechorin@hero.org&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;raskolnikov@slums.org&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;stavrogin@gov.org&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;porfiry@gov.org&lt;<span class="hl-tag">/value</span>&gt;
&lt;<span class="hl-tag">/util:set</span>&gt;</pre><p>If no <code class="literal">'set-class'</code> attribute is supplied, a
                <code class="interfacename">Set</code> implementation will be chosen by the container.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-jee"></a>C.2.3&nbsp;The <code class="literal">jee</code> schema</h3></div></div></div><p>The <code class="literal">jee</code> tags deal with Java EE (Java Enterprise Edition)-related
            configuration issues, such as looking up a JNDI object and defining EJB references.</p><p>To use the tags in the <code class="literal">jee</code> schema, you need to have
            the following preamble at the top of your Spring XML configuration file;
            the text in the following snippet references the correct schema so that
            the tags in the <code class="literal">jee</code> namespace are available to you.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:jee</span>=<span class="hl-value">"http://www.springframework.org/schema/jee"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-3.0.xsd"</span>&gt;

&lt;<span class="hl-comment">!-- &lt;bean/&gt; definitions here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-jndi-lookup"></a>C.2.3.1&nbsp;<code class="literal">&lt;jee:jndi-lookup/&gt;</code> (simple)</h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jndi.JndiObjectFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jndiName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc/MyDataSource"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.JdbcUserDao"</span>&gt;
    &lt;<span class="hl-comment">!-- Spring will do the cast automatically (as usual) --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>After...</p><pre class="programlisting">&lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"jdbc/MyDataSource"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.JdbcUserDao"</span>&gt;
    &lt;<span class="hl-comment">!-- Spring will do the cast automatically (as usual) --</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-jndi-lookup-environment-single"></a>C.2.3.2&nbsp;<code class="literal">&lt;jee:jndi-lookup/&gt;</code> (with single JNDI environment setting)</h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"simple"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jndi.JndiObjectFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jndiName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc/MyDataSource"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jndiEnvironment"</span>&gt;
        &lt;<span class="hl-tag">props</span>&gt;
            &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"foo"</span>&gt;bar&lt;<span class="hl-tag">/prop</span>&gt;
        &lt;<span class="hl-tag">/props</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>After...</p><pre class="programlisting">&lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"simple"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"jdbc/MyDataSource"</span>&gt;
    &lt;<span class="hl-tag">jee:environment</span>&gt;foo=bar&lt;<span class="hl-tag">/jee:environment</span>&gt;
&lt;<span class="hl-tag">/jee:jndi-lookup</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-jndi-lookup-evironment-multiple"></a>C.2.3.3&nbsp;<code class="literal">&lt;jee:jndi-lookup/&gt;</code> (with multiple JNDI environment settings)</h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"simple"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jndi.JndiObjectFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jndiName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc/MyDataSource"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jndiEnvironment"</span>&gt;
        &lt;<span class="hl-tag">props</span>&gt;
            &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"foo"</span>&gt;bar&lt;<span class="hl-tag">/prop</span>&gt;
            &lt;<span class="hl-tag">prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"ping"</span>&gt;pong&lt;<span class="hl-tag">/prop</span>&gt;
        &lt;<span class="hl-tag">/props</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>After...</p><pre class="programlisting">&lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"simple"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"jdbc/MyDataSource"</span>&gt;
    &lt;<span class="hl-comment">!-- newline-separated, key-value pairs for the environment (standard Properties format) --</span>&gt;
    &lt;<span class="hl-tag">jee:environment</span>&gt;
        foo=bar
        ping=pong
    &lt;<span class="hl-tag">/jee:environment</span>&gt;
&lt;<span class="hl-tag">/jee:jndi-lookup</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-jndi-lookup-complex"></a>C.2.3.4&nbsp;<code class="literal">&lt;jee:jndi-lookup/&gt;</code> (complex)</h4></div></div></div><p>Before...</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"simple"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jndi.JndiObjectFactoryBean"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jndiName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc/MyDataSource"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"cache"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"resourceRef"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lookupOnStartup"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"false"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"expectedType"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.myapp.DefaultFoo"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"proxyInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.myapp.Foo"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>After...</p><pre class="programlisting">&lt;<span class="hl-tag">jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"simple"</span>
             <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"jdbc/MyDataSource"</span>
             <span class="hl-attribute">cache</span>=<span class="hl-value">"true"</span>
             <span class="hl-attribute">resource-ref</span>=<span class="hl-value">"true"</span>
             <span class="hl-attribute">lookup-on-startup</span>=<span class="hl-value">"false"</span>
             <span class="hl-attribute">expected-type</span>=<span class="hl-value">"com.myapp.DefaultFoo"</span>
             <span class="hl-attribute">proxy-interface</span>=<span class="hl-value">"com.myapp.Foo"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-local-slsb"></a>C.2.3.5&nbsp;<code class="literal">&lt;jee:local-slsb/&gt;</code> (simple)</h4></div></div></div><p>The <code class="literal">&lt;jee:local-slsb/&gt;</code> tag configures a
                reference to an EJB Stateless SessionBean.</p><p>Before...</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"simple"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jndiName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"ejb/RentalServiceBean"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"businessInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.foo.service.RentalService"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>After...</p><pre class="programlisting">&lt;<span class="hl-tag">jee:local-slsb</span> <span class="hl-attribute">id</span>=<span class="hl-value">"simpleSlsb"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"ejb/RentalServiceBean"</span>
    <span class="hl-attribute">business-interface</span>=<span class="hl-value">"com.foo.service.RentalService"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-local-slsb-complex"></a>C.2.3.6&nbsp;<code class="literal">&lt;jee:local-slsb/&gt;</code> (complex)</h4></div></div></div><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"complexLocalEjb"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jndiName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"ejb/RentalServiceBean"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"businessInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.foo.service.RentalService"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"cacheHome"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lookupHomeOnStartup"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"resourceRef"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>After...</p><pre class="programlisting">&lt;<span class="hl-tag">jee:local-slsb</span> <span class="hl-attribute">id</span>=<span class="hl-value">"complexLocalEjb"</span>
    <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"ejb/RentalServiceBean"</span>
    <span class="hl-attribute">business-interface</span>=<span class="hl-value">"com.foo.service.RentalService"</span>
    <span class="hl-attribute">cache-home</span>=<span class="hl-value">"true"</span>
    <span class="hl-attribute">lookup-home-on-startup</span>=<span class="hl-value">"true"</span>
    <span class="hl-attribute">resource-ref</span>=<span class="hl-value">"true"</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-jee-remote-slsb"></a>C.2.3.7&nbsp;<code class="literal">&lt;jee:remote-slsb/&gt;</code></h4></div></div></div><p>The <code class="literal">&lt;jee:remote-slsb/&gt;</code> tag configures a
                reference to a <code class="literal">remote</code> EJB Stateless SessionBean.</p><p>Before...</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"complexRemoteEjb"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.ejb.access.SimpleRemoteStatelessSessionProxyFactoryBean"</span>&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jndiName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"ejb/MyRemoteBean"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"businessInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.foo.service.RentalService"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"cacheHome"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lookupHomeOnStartup"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"resourceRef"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"homeInterface"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.foo.service.RentalService"</span>/&gt;
  &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"refreshHomeOnConnectFailure"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>After...</p><pre class="programlisting">&lt;<span class="hl-tag">jee:remote-slsb</span> <span class="hl-attribute">id</span>=<span class="hl-value">"complexRemoteEjb"</span>
    <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"ejb/MyRemoteBean"</span>
    <span class="hl-attribute">business-interface</span>=<span class="hl-value">"com.foo.service.RentalService"</span>
    <span class="hl-attribute">cache-home</span>=<span class="hl-value">"true"</span>
    <span class="hl-attribute">lookup-home-on-startup</span>=<span class="hl-value">"true"</span>
    <span class="hl-attribute">resource-ref</span>=<span class="hl-value">"true"</span>
    <span class="hl-attribute">home-interface</span>=<span class="hl-value">"com.foo.service.RentalService"</span>
    <span class="hl-attribute">refresh-home-on-connect-failure</span>=<span class="hl-value">"true"</span>&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-lang"></a>C.2.4&nbsp;The <code class="literal">lang</code> schema</h3></div></div></div><p>The <code class="literal">lang</code> tags deal with exposing objects that have been
            written in a dynamic language such as JRuby or Groovy as beans in the Spring
            container.</p><p>These tags (and the dynamic language support) are comprehensively covered
            in the chapter entitled <a class="xref" href="#dynamic-language" title="27.&nbsp;Dynamic language support">Chapter&nbsp;27, <i>Dynamic language support</i></a>. Please do consult that
            chapter for full details on this support and the <code class="literal">lang</code> tags
            themselves.</p><p>In the interest of completeness, to use the tags in the <code class="literal">lang</code>
            schema, you need to have the following preamble at the top of your Spring XML
            configuration file; the text in the following snippet references the
            correct schema so that the tags in the <code class="literal">lang</code> namespace are
            available to you.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:lang</span>=<span class="hl-value">"http://www.springframework.org/schema/lang"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang-3.0.xsd"</span>&gt;

&lt;<span class="hl-comment">!-- &lt;bean/&gt; definitions here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-jms"></a>C.2.5&nbsp;The <code class="literal">jms</code> schema</h3></div></div></div><p>The <code class="literal">jms</code> tags deal with configuring JMS-related
            beans such as Spring's <a class="link" href="#jms-mdp" title="22.2.4&nbsp;Message Listener Containers">MessageListenerContainers</a>.
            These tags are detailed in the section of the <a class="link" href="#jms" title="22.&nbsp;JMS (Java Message Service)">JMS chapter</a>
            entitled <a class="xref" href="#jms-namespace" title="22.6&nbsp;JMS Namespace Support">Section&nbsp;22.6, &#8220;JMS Namespace Support&#8221;</a>. Please do consult that
            chapter for full details on this support and the <code class="literal">jms</code> tags
            themselves.</p><p>In the interest of completeness, to use the tags in the <code class="literal">jms</code>
            schema, you need to have the following preamble at the top of your Spring XML
            configuration file; the text in the following snippet references the
            correct schema so that the tags in the <code class="literal">jms</code> namespace are
            available to you.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:jms</span>=<span class="hl-value">"http://www.springframework.org/schema/jms"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms-3.0.xsd"</span>&gt;

&lt;<span class="hl-comment">!-- &lt;bean/&gt; definitions here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-tx"></a>C.2.6&nbsp;The <code class="literal">tx</code> (transaction) schema</h3></div></div></div><p>The <code class="literal">tx</code> tags deal with configuring all of those
            beans in Spring's comprehensive support for transactions. These tags are
            covered in the chapter entitled <a class="xref" href="#transaction" title="11.&nbsp;Transaction Management">Chapter&nbsp;11, <i>Transaction Management</i></a>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You are strongly encouraged to look at the
                <code class="filename">'spring-tx-3.0.xsd'</code> file that ships with the Spring
                distribution. This file is (of course), the XML Schema for Spring's
                transaction configuration, and covers all of the various tags in the
                <code class="literal">tx</code> namespace, including attribute defaults and
                suchlike. This file is documented inline, and thus the information is
                not repeated here in the interests of adhering to the DRY (Don't Repeat
                Yourself) principle.</p></td></tr></table></div><p>In the interest of completeness, to use the tags in the <code class="literal">tx</code>
            schema, you need to have the following preamble at the top of your Spring XML
            configuration file; the text in the following snippet references the
            correct schema so that the tags in the <code class="literal">tx</code> namespace are
            available to you.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
       <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;

&lt;<span class="hl-comment">!-- &lt;bean/&gt; definitions here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Often when using the tags in the <code class="literal">tx</code> namespace you will also be using
                the tags from the <code class="literal">aop</code> namespace (since the declarative transaction support in Spring is implemented using
                AOP). The above XML snippet contains the relevant lines needed to reference the <code class="literal">aop</code> schema
                so that the tags in the <code class="literal">aop</code> namespace are available to you.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-aop"></a>C.2.7&nbsp;The <code class="literal">aop</code> schema</h3></div></div></div><p>The <code class="literal">aop</code> tags deal with configuring all things
            AOP in Spring: this includes Spring's own proxy-based AOP framework and Spring's
            integration with the AspectJ AOP framework. These tags are
            comprehensively covered in the chapter entitled <a class="xref" href="#aop" title="8.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;8, <i>Aspect Oriented Programming with Spring</i></a>.</p><p>In the interest of completeness, to use the tags in the <code class="literal">aop</code>
            schema, you need to have the following preamble at the top of your Spring XML
            configuration file; the text in the following snippet references the
            correct schema so that the tags in the <code class="literal">aop</code> namespace are
            available to you.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;

&lt;<span class="hl-comment">!-- &lt;bean/&gt; definitions here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-context"></a>C.2.8&nbsp;The <code class="literal">context</code> schema</h3></div></div></div><p>The <code class="literal">context</code> tags deal with <code class="interfacename">ApplicationContext</code>
            configuration that relates to plumbing - that is, not usually beans that are important to an end-user
            but rather beans that do a lot of grunt work in Spring, such as <code class="interfacename">BeanfactoryPostProcessors</code>.
            The following snippet references the correct schema so that the tags in the <code class="literal">context</code>
            namespace are available to you.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;

&lt;<span class="hl-comment">!-- &lt;bean/&gt; definitions here --</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">context</code> schema was only introduced in Spring 2.5.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-context-pphc"></a>C.2.8.1&nbsp;<code class="literal">&lt;property-placeholder/&gt;</code></h4></div></div></div><p>This element activates the replacement of <code class="literal">${...}</code> placeholders, resolved
                against the specified properties file (as a <a class="link" href="#resources" title="5.&nbsp;Resources">Spring resource location</a>).
                This element is a convenience mechanism that sets up a
                <a class="link" href="#beans-factory-placeholderconfigurer" title="4.8.2.1&nbsp;Example: the PropertyPlaceholderConfigurer"><code class="classname">PropertyPlaceholderConfigurer</code></a>
                for you; if you need more control over the <code class="classname">PropertyPlaceholderConfigurer</code>, just
                define one yourself explicitly.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-context-ac"></a>C.2.8.2&nbsp;<code class="literal">&lt;annotation-config/&gt;</code></h4></div></div></div><p>Activates the Spring infrastructure for various annotations to be detected in bean classes:
                Spring's <a class="link" href="#beans-required-annotation" title="4.9.1&nbsp;@Required"><code class="interfacename">@Required</code></a>
                and <a class="link" href="#beans-annotation-config" title="4.9&nbsp;Annotation-based container configuration"><code class="interfacename">@Autowired</code></a>, as well as
                JSR 250's <code class="interfacename">@PostConstruct</code>, <code class="interfacename">@PreDestroy</code> and
                <code class="interfacename">@Resource</code> (if available), and JPA's
                <code class="interfacename">@PersistenceContext</code> and <code class="interfacename">@PersistenceUnit</code>
                (if available). Alternatively, you can choose to activate the individual
                <code class="interfacename">BeanPostProcessors</code> for those annotations explictly.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>This element does <span class="emphasis"><em>not</em></span> activate processing of Spring's
                    <a class="link" href="#transaction-declarative-annotations" title="11.5.6&nbsp;Using @Transactional"><code class="interfacename">@Transactional</code></a>
                    annotation. Use the
                    <a class="link" href="#tx-decl-explained" title="11.5.1&nbsp;Understanding the Spring Framework's declarative transaction implementation"><code class="literal">&lt;tx:annotation-driven/&gt;</code></a> element
                    for that purpose.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-context-component-scan"></a>C.2.8.3&nbsp;<code class="literal">&lt;component-scan/&gt;</code></h4></div></div></div><p>This element is detailed in <a class="xref" href="#beans-annotation-config" title="4.9&nbsp;Annotation-based container configuration">Section&nbsp;4.9, &#8220;Annotation-based container configuration&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-context-ltw"></a>C.2.8.4&nbsp;<code class="literal">&lt;load-time-weaver/&gt;</code></h4></div></div></div><p>This element is detailed in <a class="xref" href="#aop-aj-ltw" title="8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;8.8.4, &#8220;Load-time weaving with AspectJ in the Spring Framework&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-context-sc"></a>C.2.8.5&nbsp;<code class="literal">&lt;spring-configured/&gt;</code></h4></div></div></div><p>This element is detailed in <a class="xref" href="#aop-atconfigurable" title="8.8.1&nbsp;Using AspectJ to dependency inject domain objects with Spring">Section&nbsp;8.8.1, &#8220;Using AspectJ to dependency inject domain objects with
      Spring&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xsd-config-body-schemas-context-mbe"></a>C.2.8.6&nbsp;<code class="literal">&lt;mbean-export/&gt;</code></h4></div></div></div><p>This element is detailed in <a class="xref" href="#jmx-context-mbeanexport" title="23.4.3&nbsp;The <context:mbean-export/&gt; element">Section&nbsp;23.4.3, &#8220;The &lt;context:mbean-export/&gt; element&#8221;</a>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-tool"></a>C.2.9&nbsp;The <code class="literal">tool</code> schema</h3></div></div></div><p>The <code class="literal">tool</code> tags are for use when you want to add
            tooling-specific metadata to your custom configuration elements. This metadata
            can then be consumed by tools that are aware of this metadata, and the tools can
            then do pretty much whatever they want with it (validation, etc.).</p><p>The <code class="literal">tool</code> tags are not documented in this release of
            Spring as they are currently undergoing review. If you are a third party tool
            vendor and you would like to contribute to this review process, then do mail
            the Spring mailing list. The currently supported <code class="literal">tool</code>
            tags can be found in the file <code class="literal">'spring-tool-3.0.xsd'</code> in the
            <code class="literal">'src/org/springframework/beans/factory/xml'</code> directory of the
            Spring source distribution.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xsd-config-body-schemas-beans"></a>C.2.10&nbsp;The <code class="literal">beans</code> schema</h3></div></div></div><p>Last but not least we have the tags in the <code class="literal">beans</code> schema.
            These are the same tags that have been in Spring since the very dawn of the framework.
            Examples of the various tags in the <code class="literal">beans</code> schema are not shown here
            because they are quite comprehensively covered in <a class="xref" href="#beans-factory-properties-detailed" title="4.4.2&nbsp;Dependencies and configuration in detail">Section&nbsp;4.4.2, &#8220;Dependencies and configuration in detail&#8221;</a>
            (and indeed in that entire <a class="link" href="#beans" title="4.&nbsp;The IoC container">chapter</a>).</p><p>One thing that is new to the beans tags themselves in Spring 2.0 is the idea
            of arbitrary bean metadata. In Spring 2.0 it is now possible to add zero or more
            key / value pairs to <code class="literal">&lt;bean/&gt;</code> XML definitions. What, if
            anything, is done with this extra metadata is totally up to your own custom logic (and
            so is typically only of use if you are writing your own custom tags as described in
            the appendix entitled <a class="xref" href="#extensible-xml" title="Appendix&nbsp;D.&nbsp;Extensible XML authoring">Appendix&nbsp;D, <i>Extensible XML authoring</i></a>).</p><p>Find below an example of the <code class="literal">&lt;meta/&gt;</code> tag in the context
            of a surrounding <code class="literal">&lt;bean/&gt;</code> (please note that without any logic
            to interpret it the metadata is effectively useless as-is).</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Foo"</span>&gt;
        &lt;<span class="hl-tag">meta</span> <span class="hl-attribute">key</span>=<span class="hl-value">"cacheName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"foo"</span>/&gt;
        &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Rick"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>In the case of the above example, you would assume that there is some
            logic that will consume the bean definition and set up some caching infrastructure
            using the supplied metadata.</p></div></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="extensible-xml"></a>Appendix&nbsp;D.&nbsp;Extensible XML authoring</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-introduction"></a>D.1&nbsp;Introduction</h2></div></div></div><p>Since version 2.0, Spring has featured a mechanism for schema-based extensions
        to the basic Spring XML format for defining and configuring beans. This section is
        devoted to detailing how you would go about writing your own custom XML bean definition
        parsers and integrating such parsers into the Spring IoC container.</p><p>To facilitate the authoring of configuration files using a schema-aware XML editor,
    	Spring's extensible XML configuration mechanism is based on XML Schema. If you are
    	not familiar with Spring's current XML configuration extensions that come with the
    	standard Spring distribution, please first read the appendix entitled
    	<a class="xref" href="#xsd-config" title="Appendix&nbsp;C.&nbsp;XML Schema-based configuration">Appendix&nbsp;C, <i>XML Schema-based configuration</i></a>.</p><p>Creating new XML configuration extensions can be done by following these (relatively)
    	simple steps:</p><p>
    	    </p><div class="orderedlist"><ol type="1"><li><p><a class="link" href="#extensible-xml-schema" title="D.2&nbsp;Authoring the schema">Authoring</a> an XML schema to describe your custom element(s).</p></li><li><p><a class="link" href="#extensible-xml-namespacehandler" title="D.3&nbsp;Coding a NamespaceHandler">Coding</a> a custom <code class="interfacename">NamespaceHandler</code>
                    implementation (this is an easy step, don't worry).</p></li><li><p><a class="link" href="#extensible-xml-parser" title="D.4&nbsp;Coding a BeanDefinitionParser">Coding</a> one or more <code class="interfacename">BeanDefinitionParser</code>
                    implementations (this is where the real work is done).</p></li><li><p><a class="link" href="#extensible-xml-registration" title="D.5&nbsp;Registering the handler and the schema">Registering</a> the above artifacts with Spring (this too is an easy step).</p></li></ol></div><p>
    	</p><p>What follows is a description of each of these steps. For the example, we will create
    	an XML extension (a custom XML element) that allows us to configure objects of the type
    	<code class="classname">SimpleDateFormat</code> (from the <code class="literal">java.text</code> package)
    	in an easy manner. When we are done, we will be able to define bean definitions of type
    	<code class="classname">SimpleDateFormat</code> like this:</p><pre class="programlisting">&lt;<span class="hl-tag">myns:dateformat</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dateFormat"</span> 
    <span class="hl-attribute">pattern</span>=<span class="hl-value">"yyyy-MM-dd HH:mm"</span>
    <span class="hl-attribute">lenient</span>=<span class="hl-value">"true"</span>/&gt;
</pre><p><span class="emphasis"><em>(Don't worry about the fact that this example is very simple; much more
        detailed examples follow afterwards. The intent in this first simple example is to walk
        you through the basic steps involved.)</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-schema"></a>D.2&nbsp;Authoring the schema</h2></div></div></div><p>Creating an XML configuration extension for use with Spring's IoC container
    	starts with authoring an XML Schema to describe the extension. What follows
    	is the schema we'll use to configure <code class="classname">SimpleDateFormat</code>
    	objects.</p><pre class="programlisting">&lt;<span class="hl-comment">!-- myns.xsd (inside package org/springframework/samples/xml) --</span>&gt;

&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">xsd:schema</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.mycompany.com/schema/myns"</span>
    <span class="hl-attribute">xmlns:xsd</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema"</span>
    <span class="hl-attribute">xmlns:beans</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">targetNamespace</span>=<span class="hl-value">"http://www.mycompany.com/schema/myns"</span>
    <span class="hl-attribute">elementFormDefault</span>=<span class="hl-value">"qualified"</span>
    <span class="hl-attribute">attributeFormDefault</span>=<span class="hl-value">"unqualified"</span>&gt;

   &lt;<span class="hl-tag">xsd:import</span> <span class="hl-attribute">namespace</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>/&gt;

   &lt;<span class="hl-tag">xsd:element</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dateformat"</span>&gt;
      &lt;<span class="hl-tag">xsd:complexType</span>&gt;
         &lt;<span class="hl-tag">xsd:complexContent</span>&gt;
            &lt;<span class="hl-tag">xsd:extension</span> <span class="hl-attribute">base</span>=<span class="hl-value">"beans:identifiedType"</span>&gt;
               &lt;<span class="hl-tag">xsd:attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lenient"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"xsd:boolean"</span>/&gt;
               &lt;<span class="hl-tag">xsd:attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"pattern"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"xsd:string"</span> <span class="hl-attribute">use</span>=<span class="hl-value">"required"</span>/&gt;
            &lt;<span class="hl-tag">/xsd:extension</span>&gt;
         &lt;<span class="hl-tag">/xsd:complexContent</span>&gt;
      &lt;<span class="hl-tag">/xsd:complexType</span>&gt;
   &lt;<span class="hl-tag">/xsd:element</span>&gt;

&lt;<span class="hl-tag">/xsd:schema</span>&gt;</pre><p>(The emphasized line contains an extension base for all tags that
    	will be identifiable (meaning they have an <code class="literal">id</code> attribute
    	that will be used as the bean identifier in the container). We are able to use this
    	attribute because we imported the Spring-provided <code class="literal">'beans'</code>
    	namespace.)</p><p>The above schema will be used to configure <code class="classname">SimpleDateFormat</code>
		objects, directly in an XML application context file using the
		<code class="literal">&lt;myns:dateformat/&gt;</code> element.</p><pre class="programlisting">&lt;<span class="hl-tag">myns:dateformat</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dateFormat"</span> 
    <span class="hl-attribute">pattern</span>=<span class="hl-value">"yyyy-MM-dd HH:mm"</span>
    <span class="hl-attribute">lenient</span>=<span class="hl-value">"true"</span>/&gt;
</pre><p>Note that after we've created the infrastructure classes, the above snippet of XML
		will essentially be exactly the same as the following XML snippet. In other words,
		we're just creating a bean in the container, identified by the name
		<code class="literal">'dateFormat'</code> of type <code class="classname">SimpleDateFormat</code>, with a
		couple of properties set.</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dateFormat"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"java.text.SimpleDateFormat"</span>&gt;
    &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">"yyyy-HH-dd HH:mm"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lenient"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The schema-based approach to creating configuration format allows for
			tight integration with an IDE that has a schema-aware XML editor. Using a properly
			authored schema, you can use autocompletion to have a user choose between several
			configuration options defined in the enumeration.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-namespacehandler"></a>D.3&nbsp;Coding a <code class="interfacename">NamespaceHandler</code></h2></div></div></div><p>In addition to the schema, we need a <code class="interfacename">NamespaceHandler</code>
		that will parse all elements of this specific namespace Spring encounters
		while parsing configuration files. The <code class="interfacename">NamespaceHandler</code>
		should in our case take care of the parsing of the <code class="literal">myns:dateformat</code>
		element.</p><p>The <code class="interfacename">NamespaceHandler</code> interface is pretty simple in that 
		it features just three methods:</p><div class="itemizedlist"><ul type="disc" compact><li><p><code class="methodname">init()</code> - allows for initialization of
				the <code class="interfacename">NamespaceHandler</code> and will be called by Spring
				before the handler is used</p></li><li><p><code class="methodname">BeanDefinition parse(Element, ParserContext)</code> - 
				called when Spring encounters a top-level element (not nested inside a bean definition
				or a different namespace). This method can register bean definitions itself and/or
				return a bean definition.</p></li><li><p><code class="methodname">BeanDefinitionHolder decorate(Node, BeanDefinitionHolder, ParserContext)</code> -
				called when Spring encounters an attribute or nested element of a different namespace.
				The decoration of one or more bean definitions is used for example with the
				<a class="link" href="#beans-factory-scopes" title="4.5&nbsp;Bean scopes">out-of-the-box	scopes Spring 2.0 supports</a>.
				We'll start by highlighting a simple example, without using decoration, after which
				we will	show decoration in a somewhat more advanced example.</p></li></ul></div><p>Although it is perfectly possible to code your own
		<code class="interfacename">NamespaceHandler</code> for the entire namespace
		(and hence provide code that parses each and every element in the namespace),
		it is often the case that each top-level XML element in a Spring XML
		configuration file results in a single bean definition (as in our
		case, where a single <code class="literal">&lt;myns:dateformat/&gt;</code> element
		results in a single <code class="classname">SimpleDateFormat</code> bean definition).
		Spring features a number of convenience classes that support this scenario.
		In this example, we'll make use the <code class="classname">NamespaceHandlerSupport</code> class:</p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.samples.xml;

<span class="hl-keyword">import</span> org.springframework.beans.factory.xml.NamespaceHandlerSupport;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyNamespaceHandler <span class="hl-keyword">extends</span> NamespaceHandlerSupport {
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init() {
        registerBeanDefinitionParser(<span class="hl-string">"dateformat"</span>, <span class="hl-keyword">new</span> SimpleDateFormatBeanDefinitionParser());        
    }
}</pre><p>The observant reader will notice that there isn't actually a whole lot of
        parsing logic in this class. Indeed... the <code class="classname">NamespaceHandlerSupport</code>
        class has a built in notion of delegation. It supports the registration of any number
        of <code class="interfacename">BeanDefinitionParser</code> instances, to which it will delegate
        to when it needs to parse an element in its namespace. This clean separation of concerns
        allows a <code class="interfacename">NamespaceHandler</code> to handle the orchestration
        of the parsing of <span class="emphasis"><em>all</em></span> of the custom elements in its namespace,
        while delegating to <code class="literal">BeanDefinitionParsers</code> to do the grunt work of the
        XML parsing; this means that each <code class="interfacename">BeanDefinitionParser</code> will
        contain just the logic for parsing a single custom element, as we can see in the next step</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-parser"></a>D.4&nbsp;Coding a <code class="interfacename">BeanDefinitionParser</code></h2></div></div></div><p>A <code class="interfacename">BeanDefinitionParser</code> will be used if the
		<code class="interfacename">NamespaceHandler</code> encounters an XML element of the type
		that has been mapped to the specific bean definition parser (which is <code class="literal">'dateformat'</code>
		in this case). In other words, the <code class="interfacename">BeanDefinitionParser</code> is
		responsible for parsing <span class="emphasis"><em>one</em></span> distinct top-level XML element defined in the
		schema. In the parser, we'll have access to the XML element (and thus its subelements too)
		so that we can parse our custom XML content, as can be seen in the following example:</p><pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.samples.xml;

<span class="hl-keyword">import</span> org.springframework.beans.factory.support.BeanDefinitionBuilder;
<span class="hl-keyword">import</span> org.springframework.beans.factory.xml.AbstractSingleBeanDefinitionParser;
<span class="hl-keyword">import</span> org.springframework.util.StringUtils;
<span class="hl-keyword">import</span> org.w3c.dom.Element;

<span class="hl-keyword">import</span> java.text.SimpleDateFormat;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleDateFormatBeanDefinitionParser <span class="hl-keyword">extends</span> AbstractSingleBeanDefinitionParser { 

   <span class="hl-keyword">protected</span> Class getBeanClass(Element element) {
      <span class="hl-keyword">return</span> SimpleDateFormat.<span class="hl-keyword">class</span>; 
   }

   <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> doParse(Element element, BeanDefinitionBuilder bean) {
      <span class="hl-comment">// this will never be null since the schema explicitly requires that a value be supplied</span>
      String pattern = element.getAttribute(<span class="hl-string">"pattern"</span>);
      bean.addConstructorArg(pattern);

      <span class="hl-comment">// this however is an optional property</span>
      String lenient = element.getAttribute(<span class="hl-string">"lenient"</span>);
      <span class="hl-keyword">if</span> (StringUtils.hasText(lenient)) {
         bean.addPropertyValue(<span class="hl-string">"lenient"</span>, Boolean.valueOf(lenient));
      }
   }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#extensible-xml-parser-simpledateformat-co-1"><img src="images/callouts/1.gif" alt="1" border="0"></a> </p></td><td valign="top" align="left"><p>We use the Spring-provided <code class="classname">AbstractSingleBeanDefinitionParser</code>
			    to handle a lot of the basic grunt work of creating a <span class="emphasis"><em>single</em></span>
			    <code class="interfacename">BeanDefinition</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#extensible-xml-parser-simpledateformat-co-2"><img src="images/callouts/2.gif" alt="2" border="0"></a> </p></td><td valign="top" align="left"><p>We supply the <code class="classname">AbstractSingleBeanDefinitionParser</code> superclass
			    with the type that our single <code class="interfacename">BeanDefinition</code> will represent.</p></td></tr></table></div><p>In this simple case, this is all that we need to do. The creation of our single
		<code class="interfacename">BeanDefinition</code> is handled by the <code class="classname">AbstractSingleBeanDefinitionParser</code>
		superclass, as is the extraction and setting of the bean definition's unique identifier.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-registration"></a>D.5&nbsp;Registering the handler and the schema</h2></div></div></div><p>The coding is finished! All that remains to be done is to somehow make the Spring XML
		parsing infrastructure aware of our custom element; we do this by registering our custom
		<code class="interfacename">namespaceHandler</code> and custom XSD file in two special purpose
		properties files. These properties files are both placed in a
		<code class="filename">'META-INF'</code> directory in your application, and can, for
		example, be distributed alongside your binary classes in a JAR file. The Spring XML parsing
		infrastructurewill automatically pick up your new extension by consuming these special
		properties files, the formats of which are detailed below.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="extensible-xml-registration-spring-handlers"></a>D.5.1&nbsp;<code class="filename">'META-INF/spring.handlers'</code></h3></div></div></div><p>The properties file called <code class="filename">'spring.handlers'</code> contains a mapping
			of XML Schema URIs to namespace handler classes. So for our example, we need to write the
			following:</p><pre class="programlisting">http\://www.mycompany.com/schema/myns=org.springframework.samples.xml.MyNamespaceHandler</pre><p><span class="emphasis"><em>(The <code class="literal">':'</code> character is a valid delimiter in the Java properties format,
			and so the <code class="literal">':'</code> character in the URI needs to be escaped with a backslash.)</em></span></p><p>The first part (the key) of the key-value pair is the URI associated with your custom namespace
			extension, and needs to <span class="emphasis"><em>match exactly</em></span> the value of the
			<code class="literal">'targetNamespace'</code> attribute as specified in your custom XSD schema.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="extensible-xml-registration-spring-schemas"></a>D.5.2&nbsp;<code class="filename">'META-INF/spring.schemas'</code></h3></div></div></div><p>The properties file called <code class="filename">'spring.schemas'</code> contains a mapping
			of XML Schema locations (referred to along with the schema declaration in XML files
			that use the schema as part of the <code class="literal">'xsi:schemaLocation'</code> attribute)
			to <span class="emphasis"><em>classpath</em></span> resources. This file is needed to prevent Spring from
			absolutely having to use a default <code class="interfacename">EntityResolver</code> that requires
			Internet access to retrieve the schema file. If you specify the mapping in this properties file,
			Spring will search for the schema on the classpath (in this case <code class="literal">'myns.xsd'</code>
			in the <code class="literal">'org.springframework.samples.xml'</code> package):</p><pre class="programlisting">http\://www.mycompany.com/schema/myns/myns.xsd=org/springframework/samples/xml/myns.xsd</pre><p>The upshot of this is that you are encouraged to deploy your XSD file(s) right alongside
			the <code class="interfacename">NamespaceHandler</code> and <code class="interfacename">BeanDefinitionParser</code>
			classes on the classpath.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-using"></a>D.6&nbsp;Using a custom extension in your Spring XML configuration</h2></div></div></div><p>Using a custom extension that you yourself have implemented is no different from
		using one of the 'custom' extensions that Spring provides straight out of the box. Find below
		an example of using the custom <code class="literal">&lt;dateformat/&gt;</code> element developed in the
		previous steps in a Spring XML configuration file.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xmlns:myns</span>=<span class="hl-value">"http://www.mycompany.com/schema/myns"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.mycompany.com/schema/myns http://www.mycompany.com/schema/myns/myns.xsd"</span>&gt;

   &lt;<span class="hl-comment">!-- as a top-level bean --</span>&gt;
   &lt;<span class="hl-tag">myns:dateformat</span> <span class="hl-attribute">id</span>=<span class="hl-value">"defaultDateFormat"</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"yyyy-MM-dd HH:mm"</span> <span class="hl-attribute">lenient</span>=<span class="hl-value">"true"</span>/&gt;

   &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jobDetailTemplate"</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">"true"</span>&gt;
      &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dateFormat"</span>&gt;
         &lt;<span class="hl-comment">!-- as an inner bean --</span>&gt;
         &lt;<span class="hl-tag">myns:dateformat</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"HH:mm MM-dd-yyyy"</span>/&gt;
      &lt;<span class="hl-tag">/property</span>&gt;
   &lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-meat"></a>D.7&nbsp;Meatier examples</h2></div></div></div><p>Find below some much meatier examples of custom XML extensions.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="extensible-xml-custom-nested"></a>D.7.1&nbsp;Nesting custom tags within custom tags</h3></div></div></div><p>This example illustrates how you might go about writing the various artifacts
		    required to satisfy a target of the following configuration:</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xmlns:foo</span>=<span class="hl-value">"http://www.foo.com/schema/component"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.foo.com/schema/component http://www.foo.com/schema/component/component.xsd"</span>&gt;

   &lt;<span class="hl-tag">foo:component</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bionic-family"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Bionic-1"</span>&gt;
      &lt;<span class="hl-tag">foo:component</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Mother-1"</span>&gt;
        &lt;<span class="hl-tag">foo:component</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Karate-1"</span>/&gt;
        &lt;<span class="hl-tag">foo:component</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Sport-1"</span>/&gt;
      &lt;<span class="hl-tag">/foo:component</span>&gt;
      &lt;<span class="hl-tag">foo:component</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Rock-1"</span>/&gt;
   &lt;<span class="hl-tag">/foo:component</span>&gt;

&lt;<span class="hl-tag">/beans</span>&gt;</pre><p>The above configuration actually nests custom extensions within each other. The class
            that is actually configured by the above <code class="literal">&lt;foo:component/&gt;</code>
            element is the <code class="classname">Component</code> class (shown directly below). Notice
            how the <code class="classname">Component</code> class does <span class="emphasis"><em>not</em></span> expose
            a setter method for the <code class="literal">'components'</code> property; this makes it hard
            (or rather impossible) to configure a bean definition for the <code class="classname">Component</code>
            class using setter injection.</p><pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">import</span> java.util.ArrayList;
<span class="hl-keyword">import</span> java.util.List;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Component {

   <span class="hl-keyword">private</span> String name;
   <span class="hl-keyword">private</span> List&lt;Component&gt; components = <span class="hl-keyword">new</span> ArrayList&lt;Component&gt; ();

   <span class="hl-comment">// mmm, there is no setter method for the 'components'</span>
   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addComponent(Component component) {
      <span class="hl-keyword">this</span>.components.add(component);
   }

   <span class="hl-keyword">public</span> List&lt;Component&gt; getComponents() {
      <span class="hl-keyword">return</span> components;
   }

   <span class="hl-keyword">public</span> String getName() {
      <span class="hl-keyword">return</span> name;
   }

   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
      <span class="hl-keyword">this</span>.name = name;
   }
}</pre><p>The typical solution to this issue is to create a custom <code class="interfacename">FactoryBean</code>
            that exposes a setter property for the <code class="literal">'components'</code> property.</p><pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">import</span> org.springframework.beans.factory.FactoryBean;

<span class="hl-keyword">import</span> java.util.List;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ComponentFactoryBean <span class="hl-keyword">implements</span> FactoryBean&lt;Component&gt; {

   <span class="hl-keyword">private</span> Component parent;
   <span class="hl-keyword">private</span> List&lt;Component&gt; children;

   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setParent(Component parent) {
      <span class="hl-keyword">this</span>.parent = parent;
   }

   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setChildren(List&lt;Component&gt; children) {
      <span class="hl-keyword">this</span>.children = children;
   }

   <span class="hl-keyword">public</span> Component getObject() <span class="hl-keyword">throws</span> Exception {
      <span class="hl-keyword">if</span> (<span class="hl-keyword">this</span>.children != null &amp;&amp; <span class="hl-keyword">this</span>.children.size() &gt; 0) {
         <span class="hl-keyword">for</span> (Component child : children) {
            <span class="hl-keyword">this</span>.parent.addComponent(child);
         }
      }
      <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.parent;
   }

   <span class="hl-keyword">public</span> Class&lt;Component&gt; getObjectType() {
      <span class="hl-keyword">return</span> Component.<span class="hl-keyword">class</span>;
   }

   <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> isSingleton() {
      <span class="hl-keyword">return</span> true;
   }
}</pre><p>This is all very well, and does work nicely, but exposes a lot of Spring plumbing to the
            end user. What we are going to do is write a custom extension that hides away all of this
            Spring plumbing. If we stick to <a class="link" href="#extensible-xml-introduction" title="D.1&nbsp;Introduction">the steps described
            previously</a>, we'll start off by creating the XSD schema to define the structure of
            our custom tag.</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8" standalone="no"?</span>&gt;

&lt;<span class="hl-tag">xsd:schema</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.foo.com/schema/component"</span>
         <span class="hl-attribute">xmlns:xsd</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema"</span>
         <span class="hl-attribute">targetNamespace</span>=<span class="hl-value">"http://www.foo.com/schema/component"</span>
         <span class="hl-attribute">elementFormDefault</span>=<span class="hl-value">"qualified"</span>
         <span class="hl-attribute">attributeFormDefault</span>=<span class="hl-value">"unqualified"</span>&gt;

   &lt;<span class="hl-tag">xsd:element</span> <span class="hl-attribute">name</span>=<span class="hl-value">"component"</span>&gt;
      &lt;<span class="hl-tag">xsd:complexType</span>&gt;
         &lt;<span class="hl-tag">xsd:choice</span> <span class="hl-attribute">minOccurs</span>=<span class="hl-value">"0"</span> <span class="hl-attribute">maxOccurs</span>=<span class="hl-value">"unbounded"</span>&gt;
            &lt;<span class="hl-tag">xsd:element</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"component"</span>/&gt;
         &lt;<span class="hl-tag">/xsd:choice</span>&gt;
         &lt;<span class="hl-tag">xsd:attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"id"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"xsd:ID"</span>/&gt;
         &lt;<span class="hl-tag">xsd:attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">use</span>=<span class="hl-value">"required"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"xsd:string"</span>/&gt;
      &lt;<span class="hl-tag">/xsd:complexType</span>&gt;
   &lt;<span class="hl-tag">/xsd:element</span>&gt;

&lt;<span class="hl-tag">/xsd:schema</span>&gt;
</pre><p>We'll then create a custom <code class="interfacename">NamespaceHandler</code>.</p><pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">import</span> org.springframework.beans.factory.xml.NamespaceHandlerSupport;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ComponentNamespaceHandler <span class="hl-keyword">extends</span> NamespaceHandlerSupport {

   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init() {
      registerBeanDefinitionParser(<span class="hl-string">"component"</span>, <span class="hl-keyword">new</span> ComponentBeanDefinitionParser());
   }
}</pre><p>Next up is the custom <code class="interfacename">BeanDefinitionParser</code>. Remember
            that what we are creating is a <code class="interfacename">BeanDefinition</code> describing
            a <code class="classname">ComponentFactoryBean</code>.</p><pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">import</span> org.springframework.beans.factory.config.BeanDefinition;
<span class="hl-keyword">import</span> org.springframework.beans.factory.support.AbstractBeanDefinition;
<span class="hl-keyword">import</span> org.springframework.beans.factory.support.BeanDefinitionBuilder;
<span class="hl-keyword">import</span> org.springframework.beans.factory.support.ManagedList;
<span class="hl-keyword">import</span> org.springframework.beans.factory.xml.AbstractBeanDefinitionParser;
<span class="hl-keyword">import</span> org.springframework.beans.factory.xml.ParserContext;
<span class="hl-keyword">import</span> org.springframework.util.xml.DomUtils;
<span class="hl-keyword">import</span> org.w3c.dom.Element;

<span class="hl-keyword">import</span> java.util.List;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ComponentBeanDefinitionParser <span class="hl-keyword">extends</span> AbstractBeanDefinitionParser {

   <span class="hl-keyword">protected</span> AbstractBeanDefinition parseInternal(Element element, ParserContext parserContext) {
      <span class="hl-keyword">return</span> parseComponentElement(element);
   }
   
   <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> AbstractBeanDefinition parseComponentElement(Element element) {
      BeanDefinitionBuilder factory = BeanDefinitionBuilder.rootBeanDefinition(ComponentFactoryBean.<span class="hl-keyword">class</span>);
      factory.addPropertyValue(<span class="hl-string">"parent"</span>, parseComponent(element));
      
      List&lt;Element&gt; childElements = DomUtils.getChildElementsByTagName(element, <span class="hl-string">"component"</span>);
      <span class="hl-keyword">if</span> (childElements != null &amp;&amp; childElements.size() &gt; 0) {
         parseChildComponents(childElements, factory);
      }

      <span class="hl-keyword">return</span> factory.getBeanDefinition();
   }

   <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> BeanDefinition parseComponent(Element element) {
      BeanDefinitionBuilder component = BeanDefinitionBuilder.rootBeanDefinition(Component.<span class="hl-keyword">class</span>);
      component.addPropertyValue(<span class="hl-string">"name"</span>, element.getAttribute(<span class="hl-string">"name"</span>));
      <span class="hl-keyword">return</span> component.getBeanDefinition();
   }
   
   <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> parseChildComponents(List&lt;Element&gt; childElements, BeanDefinitionBuilder factory) {
      ManagedList&lt;BeanDefinition&gt; children = <span class="hl-keyword">new</span> ManagedList&lt;BeanDefinition&gt;(childElements.size());
     
      <span class="hl-keyword">for</span> (Element element : childElements) {
         children.add(parseComponentElement(element));
      }
     
      factory.addPropertyValue(<span class="hl-string">"children"</span>, children);
   }
}</pre><p>Lastly, the various artifacts need to be registered with the Spring XML infrastructure.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation"># in <code class="filename">'META-INF/spring.handlers'</code></span></em>
http\://www.foo.com/schema/component=com.foo.ComponentNamespaceHandler</pre><pre class="programlisting"><em class="lineannotation"><span class="lineannotation"># in <code class="filename">'META-INF/spring.schemas'</code></span></em>
http\://www.foo.com/schema/component/component.xsd=com/foo/component.xsd</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="extensible-xml-custom-just-attributes"></a>D.7.2&nbsp;Custom attributes on 'normal' elements</h3></div></div></div><p>Writing your own custom parser and the associated artifacts isn't hard, but sometimes it
		    is not the right thing to do. Consider the scenario where you need to add metadata to already
		    existing bean definitions. In this case you certainly don't want to have to go off and write
		    your own entire custom extension; rather you just want to add an additional attribute
		    to the existing bean definition element.</p><p>By way of another example, let's say that the service class that you are defining a bean
		    definition for a service object that will (unknown to it) be accessing a clustered
		    <a class="ulink" href="http://jcp.org/en/jsr/detail?id=107" target="_top">JCache</a>, and you want to ensure that
		    the named JCache instance is eagerly started within the surrounding cluster:</p><pre class="programlisting">&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"checkingAccountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.DefaultCheckingAccountService"</span>
      <span class="hl-attribute">jcache:cache-name</span>=<span class="hl-value">"checking.account"</span>&gt;
   &lt;<span class="hl-comment">!-- other dependencies here... --</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;</pre><p>What we are going to do here is create another <code class="interfacename">BeanDefinition</code>
            when the <code class="literal">'jcache:cache-name'</code> attribute is parsed; this
            <code class="interfacename">BeanDefinition</code> will then initialize the named JCache
            for us. We will also modify the existing <code class="interfacename">BeanDefinition</code> for the
            <code class="literal">'checkingAccountService'</code> so that it will have a dependency on this
            new JCache-initializing <code class="interfacename">BeanDefinition</code>.</p><pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JCacheInitializer {

   <span class="hl-keyword">private</span> String name;

   <span class="hl-keyword">public</span> JCacheInitializer(String name) {
      <span class="hl-keyword">this</span>.name = name;
   }

   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> initialize() {
      <span class="hl-comment">// lots of JCache API calls to initialize the named cache...</span>
   }
}</pre><p>Now onto the custom extension. Firstly, the authoring of the XSD schema describing the
            custom attribute (quite easy in this case).</p><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8" standalone="no"?</span>&gt;

&lt;<span class="hl-tag">xsd:schema</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.foo.com/schema/jcache"</span>
            <span class="hl-attribute">xmlns:xsd</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema"</span>
            <span class="hl-attribute">targetNamespace</span>=<span class="hl-value">"http://www.foo.com/schema/jcache"</span>
            <span class="hl-attribute">elementFormDefault</span>=<span class="hl-value">"qualified"</span>&gt;

   &lt;<span class="hl-tag">xsd:attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"cache-name"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"xsd:string"</span>/&gt;

&lt;<span class="hl-tag">/xsd:schema</span>&gt;
</pre><p>Next, the associated <code class="interfacename">NamespaceHandler</code>.</p><pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">import</span> org.springframework.beans.factory.xml.NamespaceHandlerSupport;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JCacheNamespaceHandler <span class="hl-keyword">extends</span> NamespaceHandlerSupport {

   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init() {
      <span class="hl-keyword">super</span>.registerBeanDefinitionDecoratorForAttribute(<span class="hl-string">"cache-name"</span>,
            <span class="hl-keyword">new</span> JCacheInitializingBeanDefinitionDecorator());
   }
}
</pre><p>Next, the parser. Note that in this case, because we are going to be parsing an XML
            attribute, we write a <code class="interfacename">BeanDefinitionDecorator</code> rather than a
            <code class="interfacename">BeanDefinitionParser</code>.</p><pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">import</span> org.springframework.beans.factory.config.BeanDefinitionHolder;
<span class="hl-keyword">import</span> org.springframework.beans.factory.support.AbstractBeanDefinition;
<span class="hl-keyword">import</span> org.springframework.beans.factory.support.BeanDefinitionBuilder;
<span class="hl-keyword">import</span> org.springframework.beans.factory.xml.BeanDefinitionDecorator;
<span class="hl-keyword">import</span> org.springframework.beans.factory.xml.ParserContext;
<span class="hl-keyword">import</span> org.w3c.dom.Attr;
<span class="hl-keyword">import</span> org.w3c.dom.Node;

<span class="hl-keyword">import</span> java.util.ArrayList;
<span class="hl-keyword">import</span> java.util.Arrays;
<span class="hl-keyword">import</span> java.util.List;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JCacheInitializingBeanDefinitionDecorator <span class="hl-keyword">implements</span> BeanDefinitionDecorator {
   
   <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> String[] EMPTY_STRING_ARRAY = <span class="hl-keyword">new</span> String[0];

   <span class="hl-keyword">public</span> BeanDefinitionHolder decorate(
         Node source, BeanDefinitionHolder holder, ParserContext ctx) {
      String initializerBeanName = registerJCacheInitializer(source, ctx);
      createDependencyOnJCacheInitializer(holder, initializerBeanName);
      <span class="hl-keyword">return</span> holder;
   }

   <span class="hl-keyword">private</span> <span class="hl-keyword">void</span> createDependencyOnJCacheInitializer(BeanDefinitionHolder holder, String initializerBeanName) {
      AbstractBeanDefinition definition = ((AbstractBeanDefinition) holder.getBeanDefinition());
      String[] dependsOn = definition.getDependsOn();
      <span class="hl-keyword">if</span> (dependsOn == null) {
         dependsOn = <span class="hl-keyword">new</span> String[]{initializerBeanName};
      } <span class="hl-keyword">else</span> {
         List dependencies = <span class="hl-keyword">new</span> ArrayList(Arrays.asList(dependsOn));
         dependencies.add(initializerBeanName);
         dependsOn = (String[]) dependencies.toArray(EMPTY_STRING_ARRAY);
      }
      definition.setDependsOn(dependsOn);
   }

   <span class="hl-keyword">private</span> String registerJCacheInitializer(Node source, ParserContext ctx) {
      String cacheName = ((Attr) source).getValue();
      String beanName = cacheName + <span class="hl-string">"-initializer"</span>;
      <span class="hl-keyword">if</span> (!ctx.getRegistry().containsBeanDefinition(beanName)) {
         BeanDefinitionBuilder initializer = BeanDefinitionBuilder.rootBeanDefinition(JCacheInitializer.<span class="hl-keyword">class</span>);
         initializer.addConstructorArg(cacheName);
         ctx.getRegistry().registerBeanDefinition(beanName, initializer.getBeanDefinition());
      }
      <span class="hl-keyword">return</span> beanName;
   }
}
</pre><p>Lastly, the various artifacts need to be registered with the Spring XML infrastructure.</p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation"># in <code class="filename">'META-INF/spring.handlers'</code></span></em>
http\://www.foo.com/schema/jcache=com.foo.JCacheNamespaceHandler</pre><pre class="programlisting"><em class="lineannotation"><span class="lineannotation"># in <code class="filename">'META-INF/spring.schemas'</code></span></em>
http\://www.foo.com/schema/jcache/jcache.xsd=com/foo/jcache.xsd</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extensible-xml-resources"></a>D.8&nbsp;Further Resources</h2></div></div></div><p>Find below links to further resources concerning XML Schema and the extensible XML support
		described in this chapter.</p><div class="itemizedlist"><ul type="disc"><li><p>The <a class="ulink" href="http://www.w3.org/TR/2004/REC-xmlschema-1-20041028/" target="_top">XML Schema Part 1: Structures Second Edition</a></p></li><li><p>The <a class="ulink" href="http://www.w3.org/TR/2004/REC-xmlschema-2-20041028/" target="_top">XML Schema Part 2: Datatypes Second Edition</a></p></li></ul></div></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="springbeansdtd"></a>Appendix&nbsp;E.&nbsp;<code class="literal">spring-beans-2.0.dtd</code></h2></div></div></div><pre class="programlisting">&lt;<span class="hl-comment">!--
	Spring XML Beans DTD, version 2.0
	Authors: Rod Johnson, Juergen Hoeller, Alef Arendsen, Colin Sampaleanu, Rob Harrop

	This defines a simple and consistent way of creating a namespace
	of JavaBeans objects, managed by a Spring BeanFactory, read by
	XmlBeanDefinitionReader (with DefaultBeanDefinitionDocumentReader).

	This document type is used by most Spring functionality, including
	web application contexts, which are based on bean factories.

	Each "bean" element in this document defines a JavaBean.
	Typically the bean class is specified, along with JavaBean properties
	and/or constructor arguments.

	A bean instance can be a "singleton" (shared instance) or a "prototype"
	(independent instance). Further scopes can be provided by extended
	bean factories, for example in a web environment.

	References among beans are supported, that is, setting a JavaBean property
	or a constructor argument to refer to another bean in the same factory
	(or an ancestor factory).

	As alternative to bean references, "inner bean definitions" can be used.
	Singleton flags of such inner bean definitions are effectively ignored:
	Inner beans are typically anonymous prototypes.

	There is also support for lists, sets, maps, and java.util.Properties
	as bean property types or constructor argument types.

	For simple purposes, this DTD is sufficient. As of Spring 2.0,
	XSD-based bean definitions are supported as more powerful alternative.

	XML documents that conform to this DTD should declare the following doctype:

	&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN"
		"http://www.springframework.org/dtd/spring-beans-2.0.dtd"&gt;
--</span>&gt;


&lt;<span class="hl-comment">!--
	The document root. A document can contain bean definitions only,
	imports only, or a mixture of both (typically with imports first).
--</span>&gt;
&lt;<span class="hl-tag">!ELEMENT</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">(</span>
	<span class="hl-attribute">description?,</span>
	<span class="hl-attribute">(import</span> <span class="hl-attribute">|</span> <span class="hl-attribute">alias</span> <span class="hl-attribute">|</span> <span class="hl-attribute">bean)*</span>
<span class="hl-attribute">)&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Default</span> <span class="hl-attribute">values</span> <span class="hl-attribute">for</span> <span class="hl-attribute">all</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definitions.</span> <span class="hl-attribute">Can</span> <span class="hl-attribute">be</span> <span class="hl-attribute">overridden</span> <span class="hl-attribute">at</span>
	<span class="hl-attribute">the</span> <span class="hl-attribute">"bean"</span> <span class="hl-attribute">level.</span> <span class="hl-attribute">See</span> <span class="hl-attribute">those</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">definitions</span> <span class="hl-attribute">for</span> <span class="hl-attribute">details.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">default-lazy-init</span> <span class="hl-attribute">(true</span> <span class="hl-attribute">|</span> <span class="hl-attribute">false)</span> <span class="hl-attribute">"false"&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">default-autowire</span> <span class="hl-attribute">(no</span> <span class="hl-attribute">|</span> <span class="hl-attribute">byName</span> <span class="hl-attribute">|</span> <span class="hl-attribute">byType</span> <span class="hl-attribute">|</span> <span class="hl-attribute">constructor</span> <span class="hl-attribute">|</span> <span class="hl-attribute">autodetect)</span> <span class="hl-attribute">"no"&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">default-dependency-check</span> <span class="hl-attribute">(none</span> <span class="hl-attribute">|</span> <span class="hl-attribute">objects</span> <span class="hl-attribute">|</span> <span class="hl-attribute">simple</span> <span class="hl-attribute">|</span> <span class="hl-attribute">all)</span> <span class="hl-attribute">"none"&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">default-init-method</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">default-destroy-method</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">default-merge</span> <span class="hl-attribute">(true</span> <span class="hl-attribute">|</span> <span class="hl-attribute">false)</span> <span class="hl-attribute">"false"&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Element</span> <span class="hl-attribute">containing</span> <span class="hl-attribute">informative</span> <span class="hl-attribute">text</span> <span class="hl-attribute">describing</span> <span class="hl-attribute">the</span> <span class="hl-attribute">purpose</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">enclosing</span>
	<span class="hl-attribute">element.</span> <span class="hl-attribute">Always</span> <span class="hl-attribute">optional.</span>
	<span class="hl-attribute">Used</span> <span class="hl-attribute">primarily</span> <span class="hl-attribute">for</span> <span class="hl-attribute">user</span> <span class="hl-attribute">documentation</span> <span class="hl-attribute">of</span> <span class="hl-attribute">XML</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition</span> <span class="hl-attribute">documents.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">description</span> <span class="hl-attribute">(#PCDATA)&gt;</span>


<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Specifies</span> <span class="hl-attribute">an</span> <span class="hl-attribute">XML</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition</span> <span class="hl-attribute">resource</span> <span class="hl-attribute">to</span> <span class="hl-attribute">import.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">import</span> <span class="hl-attribute">EMPTY&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">relative</span> <span class="hl-attribute">resource</span> <span class="hl-attribute">location</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">XML</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition</span> <span class="hl-attribute">file</span> <span class="hl-attribute">to</span> <span class="hl-attribute">import,</span>
	<span class="hl-attribute">for</span> <span class="hl-attribute">example</span> <span class="hl-attribute">"myImport.xml"</span> <span class="hl-attribute">or</span> <span class="hl-attribute">"includes/myImport.xml"</span> <span class="hl-attribute">or</span> <span class="hl-attribute">"../myImport.xml".</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">import</span> <span class="hl-attribute">resource</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#REQUIRED&gt;</span>


<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Defines</span> <span class="hl-attribute">an</span> <span class="hl-attribute">alias</span> <span class="hl-attribute">for</span> <span class="hl-attribute">a</span> <span class="hl-attribute">bean,</span> <span class="hl-attribute">which</span> <span class="hl-attribute">can</span> <span class="hl-attribute">reside</span> <span class="hl-attribute">in</span> <span class="hl-attribute">a</span> <span class="hl-attribute">different</span> <span class="hl-attribute">definition</span> <span class="hl-attribute">file.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">alias</span> <span class="hl-attribute">EMPTY&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">to</span> <span class="hl-attribute">define</span> <span class="hl-attribute">an</span> <span class="hl-attribute">alias</span> <span class="hl-attribute">for.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">alias</span> <span class="hl-attribute">name</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#REQUIRED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">alias</span> <span class="hl-attribute">name</span> <span class="hl-attribute">to</span> <span class="hl-attribute">define</span> <span class="hl-attribute">for</span> <span class="hl-attribute">the</span> <span class="hl-attribute">bean.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">alias</span> <span class="hl-attribute">alias</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#REQUIRED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
  <span class="hl-attribute">Allows</span> <span class="hl-attribute">for</span> <span class="hl-attribute">arbitrary</span> <span class="hl-attribute">metadata</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">attached</span> <span class="hl-attribute">to</span> <span class="hl-attribute">a</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">meta</span> <span class="hl-attribute">EMPTY&gt;</span>

<span class="hl-attribute">&lt;!--</span>
  <span class="hl-attribute">Specifies</span> <span class="hl-attribute">the</span> <span class="hl-attribute">key</span> <span class="hl-attribute">name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">metadata</span> <span class="hl-attribute">parameter</span> <span class="hl-attribute">being</span> <span class="hl-attribute">defined.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">meta</span> <span class="hl-attribute">key</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#REQUIRED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
  <span class="hl-attribute">Specifies</span> <span class="hl-attribute">the</span> <span class="hl-attribute">value</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">metadata</span> <span class="hl-attribute">parameter</span> <span class="hl-attribute">being</span> <span class="hl-attribute">defined</span> <span class="hl-attribute">as</span> <span class="hl-attribute">a</span> <span class="hl-attribute">String.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">meta</span> <span class="hl-attribute">value</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#REQUIRED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Defines</span> <span class="hl-attribute">a</span> <span class="hl-attribute">single</span> <span class="hl-attribute">(usually</span> <span class="hl-attribute">named)</span> <span class="hl-attribute">bean.</span>

	<span class="hl-attribute">A</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition</span> <span class="hl-attribute">may</span> <span class="hl-attribute">contain</span> <span class="hl-attribute">nested</span> <span class="hl-attribute">tags</span> <span class="hl-attribute">for</span> <span class="hl-attribute">constructor</span> <span class="hl-attribute">arguments,</span>
	<span class="hl-attribute">property</span> <span class="hl-attribute">values,</span> <span class="hl-attribute">lookup</span> <span class="hl-attribute">methods,</span> <span class="hl-attribute">and</span> <span class="hl-attribute">replaced</span> <span class="hl-attribute">methods.</span> <span class="hl-attribute">Mixing</span> <span class="hl-attribute">constructor</span>
	<span class="hl-attribute">injection</span> <span class="hl-attribute">and</span> <span class="hl-attribute">setter</span> <span class="hl-attribute">injection</span> <span class="hl-attribute">on</span> <span class="hl-attribute">the</span> <span class="hl-attribute">same</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">is</span> <span class="hl-attribute">explicitly</span> <span class="hl-attribute">supported.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">(</span>
	<span class="hl-attribute">description?,</span>
	<span class="hl-attribute">(meta</span> <span class="hl-attribute">|</span> <span class="hl-attribute">constructor-arg</span> <span class="hl-attribute">|</span> <span class="hl-attribute">property</span> <span class="hl-attribute">|</span> <span class="hl-attribute">lookup-method</span> <span class="hl-attribute">|</span> <span class="hl-attribute">replaced-method)*</span>
<span class="hl-attribute">)&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Beans</span> <span class="hl-attribute">can</span> <span class="hl-attribute">be</span> <span class="hl-attribute">identified</span> <span class="hl-attribute">by</span> <span class="hl-attribute">an</span> <span class="hl-attribute">id,</span> <span class="hl-attribute">to</span> <span class="hl-attribute">enable</span> <span class="hl-attribute">reference</span> <span class="hl-attribute">checking.</span>

	<span class="hl-attribute">There</span> <span class="hl-attribute">are</span> <span class="hl-attribute">constraints</span> <span class="hl-attribute">on</span> <span class="hl-attribute">a</span> <span class="hl-attribute">valid</span> <span class="hl-attribute">XML</span> <span class="hl-attribute">id:</span> <span class="hl-attribute">if</span> <span class="hl-attribute">you</span> <span class="hl-attribute">want</span> <span class="hl-attribute">to</span> <span class="hl-attribute">reference</span> <span class="hl-attribute">your</span> <span class="hl-attribute">bean</span>
	<span class="hl-attribute">in</span> <span class="hl-attribute">Java</span> <span class="hl-attribute">code</span> <span class="hl-attribute">using</span> <span class="hl-attribute">a</span> <span class="hl-attribute">name</span> <span class="hl-attribute">that's</span> <span class="hl-attribute">illegal</span> <span class="hl-attribute">as</span> <span class="hl-attribute">an</span> <span class="hl-attribute">XML</span> <span class="hl-attribute">id,</span> <span class="hl-attribute">use</span> <span class="hl-attribute">the</span> <span class="hl-attribute">optional</span>
	<span class="hl-attribute">"name"</span> <span class="hl-attribute">attribute.</span> <span class="hl-attribute">If</span> <span class="hl-attribute">neither</span> <span class="hl-attribute">is</span> <span class="hl-attribute">given,</span> <span class="hl-attribute">the</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">class</span> <span class="hl-attribute">name</span> <span class="hl-attribute">is</span> <span class="hl-attribute">used</span> <span class="hl-attribute">as</span> <span class="hl-attribute">id</span>
	<span class="hl-attribute">(with</span> <span class="hl-attribute">an</span> <span class="hl-attribute">appended</span> <span class="hl-attribute">counter</span> <span class="hl-attribute">like</span> <span class="hl-attribute">"#2"</span> <span class="hl-attribute">if</span> <span class="hl-attribute">there</span> <span class="hl-attribute">is</span> <span class="hl-attribute">already</span> <span class="hl-attribute">a</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">with</span> <span class="hl-attribute">that</span> <span class="hl-attribute">name).</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">id</span> <span class="hl-attribute">ID</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Optional.</span> <span class="hl-attribute">Can</span> <span class="hl-attribute">be</span> <span class="hl-attribute">used</span> <span class="hl-attribute">to</span> <span class="hl-attribute">create</span> <span class="hl-attribute">one</span> <span class="hl-attribute">or</span> <span class="hl-attribute">more</span> <span class="hl-attribute">aliases</span> <span class="hl-attribute">illegal</span> <span class="hl-attribute">in</span> <span class="hl-attribute">an</span> <span class="hl-attribute">id.</span>
	<span class="hl-attribute">Multiple</span> <span class="hl-attribute">aliases</span> <span class="hl-attribute">can</span> <span class="hl-attribute">be</span> <span class="hl-attribute">separated</span> <span class="hl-attribute">by</span> <span class="hl-attribute">any</span> <span class="hl-attribute">number</span> <span class="hl-attribute">of</span> <span class="hl-attribute">spaces,</span> <span class="hl-attribute">commas,</span> <span class="hl-attribute">or</span>
	<span class="hl-attribute">semi-colons</span> <span class="hl-attribute">(or</span> <span class="hl-attribute">indeed</span> <span class="hl-attribute">any</span> <span class="hl-attribute">mixture</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">three).</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">name</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Each</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition</span> <span class="hl-attribute">must</span> <span class="hl-attribute">specify</span> <span class="hl-attribute">the</span> <span class="hl-attribute">fully</span> <span class="hl-attribute">qualified</span> <span class="hl-attribute">name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">class,</span>
	<span class="hl-attribute">except</span> <span class="hl-attribute">if</span> <span class="hl-attribute">it</span> <span class="hl-attribute">pure</span> <span class="hl-attribute">serves</span> <span class="hl-attribute">as</span> <span class="hl-attribute">parent</span> <span class="hl-attribute">for</span> <span class="hl-attribute">child</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definitions.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">class</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Optionally</span> <span class="hl-attribute">specify</span> <span class="hl-attribute">a</span> <span class="hl-attribute">parent</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition.</span>

	<span class="hl-attribute">Will</span> <span class="hl-attribute">use</span> <span class="hl-attribute">the</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">class</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">parent</span> <span class="hl-attribute">if</span> <span class="hl-attribute">none</span> <span class="hl-attribute">specified,</span> <span class="hl-attribute">but</span> <span class="hl-attribute">can</span>
	<span class="hl-attribute">also</span> <span class="hl-attribute">override</span> <span class="hl-attribute">it.</span> <span class="hl-attribute">In</span> <span class="hl-attribute">the</span> <span class="hl-attribute">latter</span> <span class="hl-attribute">case,</span> <span class="hl-attribute">the</span> <span class="hl-attribute">child</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">class</span> <span class="hl-attribute">must</span> <span class="hl-attribute">be</span>
	<span class="hl-attribute">compatible</span> <span class="hl-attribute">with</span> <span class="hl-attribute">the</span> <span class="hl-attribute">parent,</span> <span class="hl-attribute">i.e.</span> <span class="hl-attribute">accept</span> <span class="hl-attribute">the</span> <span class="hl-attribute">parent's</span> <span class="hl-attribute">property</span> <span class="hl-attribute">values</span>
	<span class="hl-attribute">and</span> <span class="hl-attribute">constructor</span> <span class="hl-attribute">argument</span> <span class="hl-attribute">values,</span> <span class="hl-attribute">if</span> <span class="hl-attribute">any.</span>

	<span class="hl-attribute">A</span> <span class="hl-attribute">child</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition</span> <span class="hl-attribute">will</span> <span class="hl-attribute">inherit</span> <span class="hl-attribute">constructor</span> <span class="hl-attribute">argument</span> <span class="hl-attribute">values,</span>
	<span class="hl-attribute">property</span> <span class="hl-attribute">values</span> <span class="hl-attribute">and</span> <span class="hl-attribute">method</span> <span class="hl-attribute">overrides</span> <span class="hl-attribute">from</span> <span class="hl-attribute">the</span> <span class="hl-attribute">parent,</span> <span class="hl-attribute">with</span> <span class="hl-attribute">the</span> <span class="hl-attribute">option</span>
	<span class="hl-attribute">to</span> <span class="hl-attribute">add</span> <span class="hl-attribute">new</span> <span class="hl-attribute">values.</span> <span class="hl-attribute">If</span> <span class="hl-attribute">init</span> <span class="hl-attribute">method,</span> <span class="hl-attribute">destroy</span> <span class="hl-attribute">method,</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">and/or</span> <span class="hl-attribute">factory</span>
	<span class="hl-attribute">method</span> <span class="hl-attribute">are</span> <span class="hl-attribute">specified,</span> <span class="hl-attribute">they</span> <span class="hl-attribute">will</span> <span class="hl-attribute">override</span> <span class="hl-attribute">the</span> <span class="hl-attribute">corresponding</span> <span class="hl-attribute">parent</span> <span class="hl-attribute">settings.</span>

	<span class="hl-attribute">The</span> <span class="hl-attribute">remaining</span> <span class="hl-attribute">settings</span> <span class="hl-attribute">will</span> <span class="hl-attribute">always</span> <span class="hl-attribute">be</span> <span class="hl-attribute">taken</span> <span class="hl-attribute">from</span> <span class="hl-attribute">the</span> <span class="hl-attribute">child</span> <span class="hl-attribute">definition:</span>
	<span class="hl-attribute">depends</span> <span class="hl-attribute">on,</span> <span class="hl-attribute">autowire</span> <span class="hl-attribute">mode,</span> <span class="hl-attribute">dependency</span> <span class="hl-attribute">check,</span> <span class="hl-attribute">scope,</span> <span class="hl-attribute">lazy</span> <span class="hl-attribute">init.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">parent</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">scope</span> <span class="hl-attribute">of</span> <span class="hl-attribute">this</span> <span class="hl-attribute">bean:</span> <span class="hl-attribute">typically</span> <span class="hl-attribute">"singleton"</span> <span class="hl-attribute">(one</span> <span class="hl-attribute">shared</span> <span class="hl-attribute">instance,</span>
	<span class="hl-attribute">which</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">returned</span> <span class="hl-attribute">by</span> <span class="hl-attribute">all</span> <span class="hl-attribute">calls</span> <span class="hl-attribute">to</span> <span class="hl-attribute">getBean()</span> <span class="hl-attribute">with</span> <span class="hl-attribute">the</span> <span class="hl-attribute">id),</span>
	<span class="hl-attribute">or</span> <span class="hl-attribute">"prototype"</span> <span class="hl-attribute">(independent</span> <span class="hl-attribute">instance</span> <span class="hl-attribute">resulting</span> <span class="hl-attribute">from</span> <span class="hl-attribute">each</span> <span class="hl-attribute">call</span> <span class="hl-attribute">to</span>
	<span class="hl-attribute">getBean().</span> <span class="hl-attribute">Default</span> <span class="hl-attribute">is</span> <span class="hl-attribute">"singleton".</span>

	<span class="hl-attribute">Singletons</span> <span class="hl-attribute">are</span> <span class="hl-attribute">most</span> <span class="hl-attribute">commonly</span> <span class="hl-attribute">used,</span> <span class="hl-attribute">and</span> <span class="hl-attribute">are</span> <span class="hl-attribute">ideal</span> <span class="hl-attribute">for</span> <span class="hl-attribute">multi-threaded</span>
	<span class="hl-attribute">service</span> <span class="hl-attribute">objects.</span> <span class="hl-attribute">Further</span> <span class="hl-attribute">scopes,</span> <span class="hl-attribute">such</span> <span class="hl-attribute">as</span> <span class="hl-attribute">"request"</span> <span class="hl-attribute">or</span> <span class="hl-attribute">"session",</span>
	<span class="hl-attribute">might</span> <span class="hl-attribute">be</span> <span class="hl-attribute">supported</span> <span class="hl-attribute">by</span> <span class="hl-attribute">extended</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">factories</span> <span class="hl-attribute">(for</span> <span class="hl-attribute">example,</span> <span class="hl-attribute">in</span> <span class="hl-attribute">a</span>
	<span class="hl-attribute">web</span> <span class="hl-attribute">environment).</span>

	<span class="hl-attribute">Note:</span> <span class="hl-attribute">This</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">will</span> <span class="hl-attribute">not</span> <span class="hl-attribute">be</span> <span class="hl-attribute">inherited</span> <span class="hl-attribute">by</span> <span class="hl-attribute">child</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definitions.</span>
	<span class="hl-attribute">Hence,</span> <span class="hl-attribute">it</span> <span class="hl-attribute">needs</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">specified</span> <span class="hl-attribute">per</span> <span class="hl-attribute">concrete</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition.</span>

	<span class="hl-attribute">Inner</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definitions</span> <span class="hl-attribute">inherit</span> <span class="hl-attribute">the</span> <span class="hl-attribute">singleton</span> <span class="hl-attribute">status</span> <span class="hl-attribute">of</span> <span class="hl-attribute">their</span> <span class="hl-attribute">containing</span>
	<span class="hl-attribute">bean</span> <span class="hl-attribute">definition,</span> <span class="hl-attribute">unless</span> <span class="hl-attribute">explicitly</span> <span class="hl-attribute">specified:</span> <span class="hl-attribute">The</span> <span class="hl-attribute">inner</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">a</span>
	<span class="hl-attribute">singleton</span> <span class="hl-attribute">if</span> <span class="hl-attribute">the</span> <span class="hl-attribute">containing</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">is</span> <span class="hl-attribute">a</span> <span class="hl-attribute">singleton,</span> <span class="hl-attribute">and</span> <span class="hl-attribute">a</span> <span class="hl-attribute">prototype</span> <span class="hl-attribute">if</span>
	<span class="hl-attribute">the</span> <span class="hl-attribute">containing</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">has</span> <span class="hl-attribute">any</span> <span class="hl-attribute">other</span> <span class="hl-attribute">scope.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">scope</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Is</span> <span class="hl-attribute">this</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">"abstract",</span> <span class="hl-attribute">i.e.</span> <span class="hl-attribute">not</span> <span class="hl-attribute">meant</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">instantiated</span> <span class="hl-attribute">itself</span> <span class="hl-attribute">but</span>
	<span class="hl-attribute">rather</span> <span class="hl-attribute">just</span> <span class="hl-attribute">serving</span> <span class="hl-attribute">as</span> <span class="hl-attribute">parent</span> <span class="hl-attribute">for</span> <span class="hl-attribute">concrete</span> <span class="hl-attribute">child</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definitions.</span>
	<span class="hl-attribute">Default</span> <span class="hl-attribute">is</span> <span class="hl-attribute">"false".</span> <span class="hl-attribute">Specify</span> <span class="hl-attribute">"true"</span> <span class="hl-attribute">to</span> <span class="hl-attribute">tell</span> <span class="hl-attribute">the</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">to</span> <span class="hl-attribute">not</span> <span class="hl-attribute">try</span> <span class="hl-attribute">to</span>
	<span class="hl-attribute">instantiate</span> <span class="hl-attribute">that</span> <span class="hl-attribute">particular</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">in</span> <span class="hl-attribute">any</span> <span class="hl-attribute">case.</span>

	<span class="hl-attribute">Note:</span> <span class="hl-attribute">This</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">will</span> <span class="hl-attribute">not</span> <span class="hl-attribute">be</span> <span class="hl-attribute">inherited</span> <span class="hl-attribute">by</span> <span class="hl-attribute">child</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definitions.</span>
	<span class="hl-attribute">Hence,</span> <span class="hl-attribute">it</span> <span class="hl-attribute">needs</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">specified</span> <span class="hl-attribute">per</span> <span class="hl-attribute">abstract</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">abstract</span> <span class="hl-attribute">(true</span> <span class="hl-attribute">|</span> <span class="hl-attribute">false)</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">If</span> <span class="hl-attribute">this</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">should</span> <span class="hl-attribute">be</span> <span class="hl-attribute">lazily</span> <span class="hl-attribute">initialized.</span>
	<span class="hl-attribute">If</span> <span class="hl-attribute">false,</span> <span class="hl-attribute">it</span> <span class="hl-attribute">will</span> <span class="hl-attribute">get</span> <span class="hl-attribute">instantiated</span> <span class="hl-attribute">on</span> <span class="hl-attribute">startup</span> <span class="hl-attribute">by</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">factories</span>
	<span class="hl-attribute">that</span> <span class="hl-attribute">perform</span> <span class="hl-attribute">eager</span> <span class="hl-attribute">initialization</span> <span class="hl-attribute">of</span> <span class="hl-attribute">singletons.</span>

	<span class="hl-attribute">Note:</span> <span class="hl-attribute">This</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">will</span> <span class="hl-attribute">not</span> <span class="hl-attribute">be</span> <span class="hl-attribute">inherited</span> <span class="hl-attribute">by</span> <span class="hl-attribute">child</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definitions.</span>
	<span class="hl-attribute">Hence,</span> <span class="hl-attribute">it</span> <span class="hl-attribute">needs</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">specified</span> <span class="hl-attribute">per</span> <span class="hl-attribute">concrete</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">lazy-init</span> <span class="hl-attribute">(true</span> <span class="hl-attribute">|</span> <span class="hl-attribute">false</span> <span class="hl-attribute">|</span> <span class="hl-attribute">default)</span> <span class="hl-attribute">"default"&gt;</span>

<span class="hl-attribute">&lt;!--</span>
  <span class="hl-attribute">Indicates</span> <span class="hl-attribute">whether</span> <span class="hl-attribute">or</span> <span class="hl-attribute">not</span> <span class="hl-attribute">this</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">should</span> <span class="hl-attribute">be</span> <span class="hl-attribute">considered</span> <span class="hl-attribute">when</span> <span class="hl-attribute">looking</span>
  <span class="hl-attribute">for</span> <span class="hl-attribute">candidates</span> <span class="hl-attribute">to</span> <span class="hl-attribute">satisfy</span> <span class="hl-attribute">another</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">autowiring</span> <span class="hl-attribute">requirements.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">autowire-candidate</span> <span class="hl-attribute">(true</span> <span class="hl-attribute">|</span> <span class="hl-attribute">false)</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Optional</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">controlling</span> <span class="hl-attribute">whether</span> <span class="hl-attribute">to</span> <span class="hl-attribute">"autowire"</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">properties.</span>
	<span class="hl-attribute">This</span> <span class="hl-attribute">is</span> <span class="hl-attribute">an</span> <span class="hl-attribute">automagical</span> <span class="hl-attribute">process</span> <span class="hl-attribute">in</span> <span class="hl-attribute">which</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">references</span> <span class="hl-attribute">don't</span> <span class="hl-attribute">need</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">coded</span>
	<span class="hl-attribute">explicitly</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">XML</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition</span> <span class="hl-attribute">file,</span> <span class="hl-attribute">but</span> <span class="hl-attribute">Spring</span> <span class="hl-attribute">works</span> <span class="hl-attribute">out</span> <span class="hl-attribute">dependencies.</span>

	<span class="hl-attribute">There</span> <span class="hl-attribute">are</span> <span class="hl-attribute">5</span> <span class="hl-attribute">modes:</span>

	<span class="hl-attribute">1.</span> <span class="hl-attribute">"no"</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">traditional</span> <span class="hl-attribute">Spring</span> <span class="hl-attribute">default.</span> <span class="hl-attribute">No</span> <span class="hl-attribute">automagical</span> <span class="hl-attribute">wiring.</span> <span class="hl-attribute">Bean</span> <span class="hl-attribute">references</span>
	<span class="hl-attribute">must</span> <span class="hl-attribute">be</span> <span class="hl-attribute">defined</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">XML</span> <span class="hl-attribute">file</span> <span class="hl-attribute">via</span> <span class="hl-attribute">the</span> <span class="hl-attribute">&lt;ref&gt;</span> <span class="hl-attribute">element.</span> <span class="hl-attribute">We</span> <span class="hl-attribute">recommend</span> <span class="hl-attribute">this</span>
	<span class="hl-attribute">in</span> <span class="hl-attribute">most</span> <span class="hl-attribute">cases</span> <span class="hl-attribute">as</span> <span class="hl-attribute">it</span> <span class="hl-attribute">makes</span> <span class="hl-attribute">documentation</span> <span class="hl-attribute">more</span> <span class="hl-attribute">explicit.</span>

	<span class="hl-attribute">2.</span> <span class="hl-attribute">"byName"</span>
	<span class="hl-attribute">Autowiring</span> <span class="hl-attribute">by</span> <span class="hl-attribute">property</span> <span class="hl-attribute">name.</span> <span class="hl-attribute">If</span> <span class="hl-attribute">a</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">of</span> <span class="hl-attribute">class</span> <span class="hl-attribute">Cat</span> <span class="hl-attribute">exposes</span> <span class="hl-attribute">a</span> <span class="hl-attribute">dog</span> <span class="hl-attribute">property,</span>
	<span class="hl-attribute">Spring</span> <span class="hl-attribute">will</span> <span class="hl-attribute">try</span> <span class="hl-attribute">to</span> <span class="hl-attribute">set</span> <span class="hl-attribute">this</span> <span class="hl-attribute">to</span> <span class="hl-attribute">the</span> <span class="hl-attribute">value</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">"dog"</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">current</span> <span class="hl-attribute">factory.</span>
	<span class="hl-attribute">If</span> <span class="hl-attribute">there</span> <span class="hl-attribute">is</span> <span class="hl-attribute">no</span> <span class="hl-attribute">matching</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">by</span> <span class="hl-attribute">name,</span> <span class="hl-attribute">nothing</span> <span class="hl-attribute">special</span> <span class="hl-attribute">happens;</span>
	<span class="hl-attribute">use</span> <span class="hl-attribute">dependency-check</span>=<span class="hl-value">"objects"</span> <span class="hl-attribute">to</span> <span class="hl-attribute">raise</span> <span class="hl-attribute">an</span> <span class="hl-attribute">error</span> <span class="hl-attribute">in</span> <span class="hl-attribute">that</span> <span class="hl-attribute">case.</span>

	<span class="hl-attribute">3.</span> <span class="hl-attribute">"byType"</span>
	<span class="hl-attribute">Autowiring</span> <span class="hl-attribute">if</span> <span class="hl-attribute">there</span> <span class="hl-attribute">is</span> <span class="hl-attribute">exactly</span> <span class="hl-attribute">one</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">property</span> <span class="hl-attribute">type</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">factory.</span>
	<span class="hl-attribute">If</span> <span class="hl-attribute">there</span> <span class="hl-attribute">is</span> <span class="hl-attribute">more</span> <span class="hl-attribute">than</span> <span class="hl-attribute">one,</span> <span class="hl-attribute">a</span> <span class="hl-attribute">fatal</span> <span class="hl-attribute">error</span> <span class="hl-attribute">is</span> <span class="hl-attribute">raised,</span> <span class="hl-attribute">and</span> <span class="hl-attribute">you</span> <span class="hl-attribute">can't</span> <span class="hl-attribute">use</span> <span class="hl-attribute">byType</span>
	<span class="hl-attribute">autowiring</span> <span class="hl-attribute">for</span> <span class="hl-attribute">that</span> <span class="hl-attribute">bean.</span> <span class="hl-attribute">If</span> <span class="hl-attribute">there</span> <span class="hl-attribute">is</span> <span class="hl-attribute">none,</span> <span class="hl-attribute">nothing</span> <span class="hl-attribute">special</span> <span class="hl-attribute">happens;</span>
	<span class="hl-attribute">use</span> <span class="hl-attribute">dependency-check</span>=<span class="hl-value">"objects"</span> <span class="hl-attribute">to</span> <span class="hl-attribute">raise</span> <span class="hl-attribute">an</span> <span class="hl-attribute">error</span> <span class="hl-attribute">in</span> <span class="hl-attribute">that</span> <span class="hl-attribute">case.</span>

	<span class="hl-attribute">4.</span> <span class="hl-attribute">"constructor"</span>
	<span class="hl-attribute">Analogous</span> <span class="hl-attribute">to</span> <span class="hl-attribute">"byType"</span> <span class="hl-attribute">for</span> <span class="hl-attribute">constructor</span> <span class="hl-attribute">arguments.</span> <span class="hl-attribute">If</span> <span class="hl-attribute">there</span> <span class="hl-attribute">isn't</span> <span class="hl-attribute">exactly</span> <span class="hl-attribute">one</span> <span class="hl-attribute">bean</span>
	<span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">constructor</span> <span class="hl-attribute">argument</span> <span class="hl-attribute">type</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">factory,</span> <span class="hl-attribute">a</span> <span class="hl-attribute">fatal</span> <span class="hl-attribute">error</span> <span class="hl-attribute">is</span> <span class="hl-attribute">raised.</span>

	<span class="hl-attribute">5.</span> <span class="hl-attribute">"autodetect"</span>
	<span class="hl-attribute">Chooses</span> <span class="hl-attribute">"constructor"</span> <span class="hl-attribute">or</span> <span class="hl-attribute">"byType"</span> <span class="hl-attribute">through</span> <span class="hl-attribute">introspection</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">class.</span>
	<span class="hl-attribute">If</span> <span class="hl-attribute">a</span> <span class="hl-attribute">default</span> <span class="hl-attribute">no-arg</span> <span class="hl-attribute">constructor</span> <span class="hl-attribute">is</span> <span class="hl-attribute">found,</span> <span class="hl-attribute">"byType"</span> <span class="hl-attribute">gets</span> <span class="hl-attribute">applied.</span>

	<span class="hl-attribute">The</span> <span class="hl-attribute">latter</span> <span class="hl-attribute">two</span> <span class="hl-attribute">are</span> <span class="hl-attribute">similar</span> <span class="hl-attribute">to</span> <span class="hl-attribute">PicoContainer</span> <span class="hl-attribute">and</span> <span class="hl-attribute">make</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">factories</span> <span class="hl-attribute">simple</span> <span class="hl-attribute">to</span>
	<span class="hl-attribute">configure</span> <span class="hl-attribute">for</span> <span class="hl-attribute">small</span> <span class="hl-attribute">namespaces,</span> <span class="hl-attribute">but</span> <span class="hl-attribute">doesn't</span> <span class="hl-attribute">work</span> <span class="hl-attribute">as</span> <span class="hl-attribute">well</span> <span class="hl-attribute">as</span> <span class="hl-attribute">standard</span> <span class="hl-attribute">Spring</span>
	<span class="hl-attribute">behaviour</span> <span class="hl-attribute">for</span> <span class="hl-attribute">bigger</span> <span class="hl-attribute">applications.</span>

	<span class="hl-attribute">Note</span> <span class="hl-attribute">that</span> <span class="hl-attribute">explicit</span> <span class="hl-attribute">dependencies,</span> <span class="hl-attribute">i.e.</span> <span class="hl-attribute">"property"</span> <span class="hl-attribute">and</span> <span class="hl-attribute">"constructor-arg"</span> <span class="hl-attribute">elements,</span>
	<span class="hl-attribute">always</span> <span class="hl-attribute">override</span> <span class="hl-attribute">autowiring.</span> <span class="hl-attribute">Autowire</span> <span class="hl-attribute">behavior</span> <span class="hl-attribute">can</span> <span class="hl-attribute">be</span> <span class="hl-attribute">combined</span> <span class="hl-attribute">with</span> <span class="hl-attribute">dependency</span>
	<span class="hl-attribute">checking,</span> <span class="hl-attribute">which</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">performed</span> <span class="hl-attribute">after</span> <span class="hl-attribute">all</span> <span class="hl-attribute">autowiring</span> <span class="hl-attribute">has</span> <span class="hl-attribute">been</span> <span class="hl-attribute">completed.</span>

	<span class="hl-attribute">Note:</span> <span class="hl-attribute">This</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">will</span> <span class="hl-attribute">not</span> <span class="hl-attribute">be</span> <span class="hl-attribute">inherited</span> <span class="hl-attribute">by</span> <span class="hl-attribute">child</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definitions.</span>
	<span class="hl-attribute">Hence,</span> <span class="hl-attribute">it</span> <span class="hl-attribute">needs</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">specified</span> <span class="hl-attribute">per</span> <span class="hl-attribute">concrete</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">autowire</span> <span class="hl-attribute">(no</span> <span class="hl-attribute">|</span> <span class="hl-attribute">byName</span> <span class="hl-attribute">|</span> <span class="hl-attribute">byType</span> <span class="hl-attribute">|</span> <span class="hl-attribute">constructor</span> <span class="hl-attribute">|</span> <span class="hl-attribute">autodetect</span> <span class="hl-attribute">|</span> <span class="hl-attribute">default)</span> <span class="hl-attribute">"default"&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Optional</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">controlling</span> <span class="hl-attribute">whether</span> <span class="hl-attribute">to</span> <span class="hl-attribute">check</span> <span class="hl-attribute">whether</span> <span class="hl-attribute">all</span> <span class="hl-attribute">this</span>
	<span class="hl-attribute">beans</span> <span class="hl-attribute">dependencies,</span> <span class="hl-attribute">expressed</span> <span class="hl-attribute">in</span> <span class="hl-attribute">its</span> <span class="hl-attribute">properties,</span> <span class="hl-attribute">are</span> <span class="hl-attribute">satisfied.</span>
	<span class="hl-attribute">Default</span> <span class="hl-attribute">is</span> <span class="hl-attribute">no</span> <span class="hl-attribute">dependency</span> <span class="hl-attribute">checking.</span>

	<span class="hl-attribute">"simple"</span> <span class="hl-attribute">type</span> <span class="hl-attribute">dependency</span> <span class="hl-attribute">checking</span> <span class="hl-attribute">includes</span> <span class="hl-attribute">primitives</span> <span class="hl-attribute">and</span> <span class="hl-attribute">String;</span>
	<span class="hl-attribute">"objects"</span> <span class="hl-attribute">includes</span> <span class="hl-attribute">collaborators</span> <span class="hl-attribute">(other</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">factory);</span>
	<span class="hl-attribute">"all"</span> <span class="hl-attribute">includes</span> <span class="hl-attribute">both</span> <span class="hl-attribute">types</span> <span class="hl-attribute">of</span> <span class="hl-attribute">dependency</span> <span class="hl-attribute">checking.</span>

	<span class="hl-attribute">Note:</span> <span class="hl-attribute">This</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">will</span> <span class="hl-attribute">not</span> <span class="hl-attribute">be</span> <span class="hl-attribute">inherited</span> <span class="hl-attribute">by</span> <span class="hl-attribute">child</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definitions.</span>
	<span class="hl-attribute">Hence,</span> <span class="hl-attribute">it</span> <span class="hl-attribute">needs</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">specified</span> <span class="hl-attribute">per</span> <span class="hl-attribute">concrete</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">dependency-check</span> <span class="hl-attribute">(none</span> <span class="hl-attribute">|</span> <span class="hl-attribute">objects</span> <span class="hl-attribute">|</span> <span class="hl-attribute">simple</span> <span class="hl-attribute">|</span> <span class="hl-attribute">all</span> <span class="hl-attribute">|</span> <span class="hl-attribute">default)</span> <span class="hl-attribute">"default"&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">names</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">that</span> <span class="hl-attribute">this</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">depends</span> <span class="hl-attribute">on</span> <span class="hl-attribute">being</span> <span class="hl-attribute">initialized.</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">will</span> <span class="hl-attribute">guarantee</span> <span class="hl-attribute">that</span> <span class="hl-attribute">these</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">get</span> <span class="hl-attribute">initialized</span> <span class="hl-attribute">before.</span>

	<span class="hl-attribute">Note</span> <span class="hl-attribute">that</span> <span class="hl-attribute">dependencies</span> <span class="hl-attribute">are</span> <span class="hl-attribute">normally</span> <span class="hl-attribute">expressed</span> <span class="hl-attribute">through</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">properties</span> <span class="hl-attribute">or</span>
	<span class="hl-attribute">constructor</span> <span class="hl-attribute">arguments.</span> <span class="hl-attribute">This</span> <span class="hl-attribute">property</span> <span class="hl-attribute">should</span> <span class="hl-attribute">just</span> <span class="hl-attribute">be</span> <span class="hl-attribute">necessary</span> <span class="hl-attribute">for</span> <span class="hl-attribute">other</span> <span class="hl-attribute">kinds</span>
	<span class="hl-attribute">of</span> <span class="hl-attribute">dependencies</span> <span class="hl-attribute">like</span> <span class="hl-attribute">statics</span> <span class="hl-attribute">(*ugh*)</span> <span class="hl-attribute">or</span> <span class="hl-attribute">database</span> <span class="hl-attribute">preparation</span> <span class="hl-attribute">on</span> <span class="hl-attribute">startup.</span>

	<span class="hl-attribute">Note:</span> <span class="hl-attribute">This</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">will</span> <span class="hl-attribute">not</span> <span class="hl-attribute">be</span> <span class="hl-attribute">inherited</span> <span class="hl-attribute">by</span> <span class="hl-attribute">child</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definitions.</span>
	<span class="hl-attribute">Hence,</span> <span class="hl-attribute">it</span> <span class="hl-attribute">needs</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">specified</span> <span class="hl-attribute">per</span> <span class="hl-attribute">concrete</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">definition.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">depends-on</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Optional</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">for</span> <span class="hl-attribute">the</span> <span class="hl-attribute">name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">custom</span> <span class="hl-attribute">initialization</span> <span class="hl-attribute">method</span>
	<span class="hl-attribute">to</span> <span class="hl-attribute">invoke</span> <span class="hl-attribute">after</span> <span class="hl-attribute">setting</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">properties.</span> <span class="hl-attribute">The</span> <span class="hl-attribute">method</span> <span class="hl-attribute">must</span> <span class="hl-attribute">have</span> <span class="hl-attribute">no</span> <span class="hl-attribute">arguments,</span>
	<span class="hl-attribute">but</span> <span class="hl-attribute">may</span> <span class="hl-attribute">throw</span> <span class="hl-attribute">any</span> <span class="hl-attribute">exception.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">init-method</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Optional</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">for</span> <span class="hl-attribute">the</span> <span class="hl-attribute">name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">custom</span> <span class="hl-attribute">destroy</span> <span class="hl-attribute">method</span> <span class="hl-attribute">to</span> <span class="hl-attribute">invoke</span>
	<span class="hl-attribute">on</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">shutdown.</span> <span class="hl-attribute">The</span> <span class="hl-attribute">method</span> <span class="hl-attribute">must</span> <span class="hl-attribute">have</span> <span class="hl-attribute">no</span> <span class="hl-attribute">arguments,</span>
	<span class="hl-attribute">but</span> <span class="hl-attribute">may</span> <span class="hl-attribute">throw</span> <span class="hl-attribute">any</span> <span class="hl-attribute">exception.</span>

	<span class="hl-attribute">Note:</span> <span class="hl-attribute">Only</span> <span class="hl-attribute">invoked</span> <span class="hl-attribute">on</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">whose</span> <span class="hl-attribute">lifecycle</span> <span class="hl-attribute">is</span> <span class="hl-attribute">under</span> <span class="hl-attribute">full</span> <span class="hl-attribute">control</span>
	<span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">-</span> <span class="hl-attribute">which</span> <span class="hl-attribute">is</span> <span class="hl-attribute">always</span> <span class="hl-attribute">the</span> <span class="hl-attribute">case</span> <span class="hl-attribute">for</span> <span class="hl-attribute">singletons,</span> <span class="hl-attribute">but</span> <span class="hl-attribute">not</span>
	<span class="hl-attribute">guaranteed</span> <span class="hl-attribute">for</span> <span class="hl-attribute">any</span> <span class="hl-attribute">other</span> <span class="hl-attribute">scope.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">destroy-method</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Optional</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">specifying</span> <span class="hl-attribute">the</span> <span class="hl-attribute">name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">a</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">method</span> <span class="hl-attribute">to</span> <span class="hl-attribute">use</span> <span class="hl-attribute">to</span>
	<span class="hl-attribute">create</span> <span class="hl-attribute">this</span> <span class="hl-attribute">object.</span> <span class="hl-attribute">Use</span> <span class="hl-attribute">constructor-arg</span> <span class="hl-attribute">elements</span> <span class="hl-attribute">to</span> <span class="hl-attribute">specify</span> <span class="hl-attribute">arguments</span>
	<span class="hl-attribute">to</span> <span class="hl-attribute">the</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">method,</span> <span class="hl-attribute">if</span> <span class="hl-attribute">it</span> <span class="hl-attribute">takes</span> <span class="hl-attribute">arguments.</span> <span class="hl-attribute">Autowiring</span> <span class="hl-attribute">does</span> <span class="hl-attribute">not</span> <span class="hl-attribute">apply</span>
	<span class="hl-attribute">to</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">methods.</span>

	<span class="hl-attribute">If</span> <span class="hl-attribute">the</span> <span class="hl-attribute">"class"</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">is</span> <span class="hl-attribute">present,</span> <span class="hl-attribute">the</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">method</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">a</span> <span class="hl-attribute">static</span>
	<span class="hl-attribute">method</span> <span class="hl-attribute">on</span> <span class="hl-attribute">the</span> <span class="hl-attribute">class</span> <span class="hl-attribute">specified</span> <span class="hl-attribute">by</span> <span class="hl-attribute">the</span> <span class="hl-attribute">"class"</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">on</span> <span class="hl-attribute">this</span> <span class="hl-attribute">bean</span>
	<span class="hl-attribute">definition.</span> <span class="hl-attribute">Often</span> <span class="hl-attribute">this</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">the</span> <span class="hl-attribute">same</span> <span class="hl-attribute">class</span> <span class="hl-attribute">as</span> <span class="hl-attribute">that</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">constructed</span>
	<span class="hl-attribute">object</span> <span class="hl-attribute">-</span> <span class="hl-attribute">for</span> <span class="hl-attribute">example,</span> <span class="hl-attribute">when</span> <span class="hl-attribute">the</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">method</span> <span class="hl-attribute">is</span> <span class="hl-attribute">used</span> <span class="hl-attribute">as</span> <span class="hl-attribute">an</span> <span class="hl-attribute">alternative</span>
	<span class="hl-attribute">to</span> <span class="hl-attribute">a</span> <span class="hl-attribute">constructor.</span> <span class="hl-attribute">However,</span> <span class="hl-attribute">it</span> <span class="hl-attribute">may</span> <span class="hl-attribute">be</span> <span class="hl-attribute">on</span> <span class="hl-attribute">a</span> <span class="hl-attribute">different</span> <span class="hl-attribute">class.</span> <span class="hl-attribute">In</span> <span class="hl-attribute">that</span> <span class="hl-attribute">case,</span>
	<span class="hl-attribute">the</span> <span class="hl-attribute">created</span> <span class="hl-attribute">object</span> <span class="hl-attribute">will</span> <span class="hl-attribute">*not*</span> <span class="hl-attribute">be</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">class</span> <span class="hl-attribute">specified</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">"class"</span>
	<span class="hl-attribute">attribute.</span> <span class="hl-attribute">This</span> <span class="hl-attribute">is</span> <span class="hl-attribute">analogous</span> <span class="hl-attribute">to</span> <span class="hl-attribute">FactoryBean</span> <span class="hl-attribute">behavior.</span>

	<span class="hl-attribute">If</span> <span class="hl-attribute">the</span> <span class="hl-attribute">"factory-bean"</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">is</span> <span class="hl-attribute">present,</span> <span class="hl-attribute">the</span> <span class="hl-attribute">"class"</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">is</span> <span class="hl-attribute">not</span>
	<span class="hl-attribute">used,</span> <span class="hl-attribute">and</span> <span class="hl-attribute">the</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">method</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">an</span> <span class="hl-attribute">instance</span> <span class="hl-attribute">method</span> <span class="hl-attribute">on</span> <span class="hl-attribute">the</span> <span class="hl-attribute">object</span>
	<span class="hl-attribute">returned</span> <span class="hl-attribute">from</span> <span class="hl-attribute">a</span> <span class="hl-attribute">getBean</span> <span class="hl-attribute">call</span> <span class="hl-attribute">with</span> <span class="hl-attribute">the</span> <span class="hl-attribute">specified</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">name.</span> <span class="hl-attribute">The</span> <span class="hl-attribute">factory</span>
	<span class="hl-attribute">bean</span> <span class="hl-attribute">may</span> <span class="hl-attribute">be</span> <span class="hl-attribute">defined</span> <span class="hl-attribute">as</span> <span class="hl-attribute">a</span> <span class="hl-attribute">singleton</span> <span class="hl-attribute">or</span> <span class="hl-attribute">a</span> <span class="hl-attribute">prototype.</span>

	<span class="hl-attribute">The</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">method</span> <span class="hl-attribute">can</span> <span class="hl-attribute">have</span> <span class="hl-attribute">any</span> <span class="hl-attribute">number</span> <span class="hl-attribute">of</span> <span class="hl-attribute">arguments.</span> <span class="hl-attribute">Autowiring</span> <span class="hl-attribute">is</span> <span class="hl-attribute">not</span>
	<span class="hl-attribute">supported.</span> <span class="hl-attribute">Use</span> <span class="hl-attribute">indexed</span> <span class="hl-attribute">constructor-arg</span> <span class="hl-attribute">elements</span> <span class="hl-attribute">in</span> <span class="hl-attribute">conjunction</span> <span class="hl-attribute">with</span> <span class="hl-attribute">the</span>
	<span class="hl-attribute">factory-method</span> <span class="hl-attribute">attribute.</span>

	<span class="hl-attribute">Setter</span> <span class="hl-attribute">Injection</span> <span class="hl-attribute">can</span> <span class="hl-attribute">be</span> <span class="hl-attribute">used</span> <span class="hl-attribute">in</span> <span class="hl-attribute">conjunction</span> <span class="hl-attribute">with</span> <span class="hl-attribute">a</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">method.</span>
	<span class="hl-attribute">Method</span> <span class="hl-attribute">Injection</span> <span class="hl-attribute">cannot,</span> <span class="hl-attribute">as</span> <span class="hl-attribute">the</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">method</span> <span class="hl-attribute">returns</span> <span class="hl-attribute">an</span> <span class="hl-attribute">instance,</span>
	<span class="hl-attribute">which</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">used</span> <span class="hl-attribute">when</span> <span class="hl-attribute">the</span> <span class="hl-attribute">container</span> <span class="hl-attribute">creates</span> <span class="hl-attribute">the</span> <span class="hl-attribute">bean.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">factory-method</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Alternative</span> <span class="hl-attribute">to</span> <span class="hl-attribute">class</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">for</span> <span class="hl-attribute">factory-method</span> <span class="hl-attribute">usage.</span>
	<span class="hl-attribute">If</span> <span class="hl-attribute">this</span> <span class="hl-attribute">is</span> <span class="hl-attribute">specified,</span> <span class="hl-attribute">no</span> <span class="hl-attribute">class</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">should</span> <span class="hl-attribute">be</span> <span class="hl-attribute">used.</span>
	<span class="hl-attribute">This</span> <span class="hl-attribute">should</span> <span class="hl-attribute">be</span> <span class="hl-attribute">set</span> <span class="hl-attribute">to</span> <span class="hl-attribute">the</span> <span class="hl-attribute">name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">a</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">current</span> <span class="hl-attribute">or</span>
	<span class="hl-attribute">ancestor</span> <span class="hl-attribute">factories</span> <span class="hl-attribute">that</span> <span class="hl-attribute">contains</span> <span class="hl-attribute">the</span> <span class="hl-attribute">relevant</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">method.</span>
	<span class="hl-attribute">This</span> <span class="hl-attribute">allows</span> <span class="hl-attribute">the</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">itself</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">configured</span> <span class="hl-attribute">using</span> <span class="hl-attribute">Dependency</span>
	<span class="hl-attribute">Injection,</span> <span class="hl-attribute">and</span> <span class="hl-attribute">an</span> <span class="hl-attribute">instance</span> <span class="hl-attribute">(rather</span> <span class="hl-attribute">than</span> <span class="hl-attribute">static)</span> <span class="hl-attribute">method</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">used.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">factory-bean</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Bean</span> <span class="hl-attribute">definitions</span> <span class="hl-attribute">can</span> <span class="hl-attribute">specify</span> <span class="hl-attribute">zero</span> <span class="hl-attribute">or</span> <span class="hl-attribute">more</span> <span class="hl-attribute">constructor</span> <span class="hl-attribute">arguments.</span>
	<span class="hl-attribute">This</span> <span class="hl-attribute">is</span> <span class="hl-attribute">an</span> <span class="hl-attribute">alternative</span> <span class="hl-attribute">to</span> <span class="hl-attribute">"autowire</span> <span class="hl-attribute">constructor".</span>
	<span class="hl-attribute">Arguments</span> <span class="hl-attribute">correspond</span> <span class="hl-attribute">to</span> <span class="hl-attribute">either</span> <span class="hl-attribute">a</span> <span class="hl-attribute">specific</span> <span class="hl-attribute">index</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">constructor</span> <span class="hl-attribute">argument</span>
	<span class="hl-attribute">list</span> <span class="hl-attribute">or</span> <span class="hl-attribute">are</span> <span class="hl-attribute">supposed</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">matched</span> <span class="hl-attribute">generically</span> <span class="hl-attribute">by</span> <span class="hl-attribute">type.</span>

	<span class="hl-attribute">Note:</span> <span class="hl-attribute">A</span> <span class="hl-attribute">single</span> <span class="hl-attribute">generic</span> <span class="hl-attribute">argument</span> <span class="hl-attribute">value</span> <span class="hl-attribute">will</span> <span class="hl-attribute">just</span> <span class="hl-attribute">be</span> <span class="hl-attribute">used</span> <span class="hl-attribute">once,</span> <span class="hl-attribute">rather</span> <span class="hl-attribute">than</span>
	<span class="hl-attribute">potentially</span> <span class="hl-attribute">matched</span> <span class="hl-attribute">multiple</span> <span class="hl-attribute">times</span> <span class="hl-attribute">(as</span> <span class="hl-attribute">of</span> <span class="hl-attribute">Spring</span> <span class="hl-attribute">1.1).</span>

	<span class="hl-attribute">constructor-arg</span> <span class="hl-attribute">elements</span> <span class="hl-attribute">are</span> <span class="hl-attribute">also</span> <span class="hl-attribute">used</span> <span class="hl-attribute">in</span> <span class="hl-attribute">conjunction</span> <span class="hl-attribute">with</span> <span class="hl-attribute">the</span> <span class="hl-attribute">factory-method</span>
	<span class="hl-attribute">element</span> <span class="hl-attribute">to</span> <span class="hl-attribute">construct</span> <span class="hl-attribute">beans</span> <span class="hl-attribute">using</span> <span class="hl-attribute">static</span> <span class="hl-attribute">or</span> <span class="hl-attribute">instance</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">methods.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">constructor-arg</span> <span class="hl-attribute">(</span>
	<span class="hl-attribute">description?,</span>
	<span class="hl-attribute">(bean</span> <span class="hl-attribute">|</span> <span class="hl-attribute">ref</span> <span class="hl-attribute">|</span> <span class="hl-attribute">idref</span> <span class="hl-attribute">|</span> <span class="hl-attribute">value</span> <span class="hl-attribute">|</span> <span class="hl-attribute">null</span> <span class="hl-attribute">|</span> <span class="hl-attribute">list</span> <span class="hl-attribute">|</span> <span class="hl-attribute">set</span> <span class="hl-attribute">|</span> <span class="hl-attribute">map</span> <span class="hl-attribute">|</span> <span class="hl-attribute">props)?</span>
<span class="hl-attribute">)&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">constructor-arg</span> <span class="hl-attribute">tag</span> <span class="hl-attribute">can</span> <span class="hl-attribute">have</span> <span class="hl-attribute">an</span> <span class="hl-attribute">optional</span> <span class="hl-attribute">index</span> <span class="hl-attribute">attribute,</span>
	<span class="hl-attribute">to</span> <span class="hl-attribute">specify</span> <span class="hl-attribute">the</span> <span class="hl-attribute">exact</span> <span class="hl-attribute">index</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">constructor</span> <span class="hl-attribute">argument</span> <span class="hl-attribute">list.</span> <span class="hl-attribute">Only</span> <span class="hl-attribute">needed</span>
	<span class="hl-attribute">to</span> <span class="hl-attribute">avoid</span> <span class="hl-attribute">ambiguities,</span> <span class="hl-attribute">e.g.</span> <span class="hl-attribute">in</span> <span class="hl-attribute">case</span> <span class="hl-attribute">of</span> <span class="hl-attribute">2</span> <span class="hl-attribute">arguments</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">same</span> <span class="hl-attribute">type.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">constructor-arg</span> <span class="hl-attribute">index</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">constructor-arg</span> <span class="hl-attribute">tag</span> <span class="hl-attribute">can</span> <span class="hl-attribute">have</span> <span class="hl-attribute">an</span> <span class="hl-attribute">optional</span> <span class="hl-attribute">type</span> <span class="hl-attribute">attribute,</span>
	<span class="hl-attribute">to</span> <span class="hl-attribute">specify</span> <span class="hl-attribute">the</span> <span class="hl-attribute">exact</span> <span class="hl-attribute">type</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">constructor</span> <span class="hl-attribute">argument.</span> <span class="hl-attribute">Only</span> <span class="hl-attribute">needed</span>
	<span class="hl-attribute">to</span> <span class="hl-attribute">avoid</span> <span class="hl-attribute">ambiguities,</span> <span class="hl-attribute">e.g.</span> <span class="hl-attribute">in</span> <span class="hl-attribute">case</span> <span class="hl-attribute">of</span> <span class="hl-attribute">2</span> <span class="hl-attribute">single</span> <span class="hl-attribute">argument</span> <span class="hl-attribute">constructors</span>
	<span class="hl-attribute">that</span> <span class="hl-attribute">can</span> <span class="hl-attribute">both</span> <span class="hl-attribute">be</span> <span class="hl-attribute">converted</span> <span class="hl-attribute">from</span> <span class="hl-attribute">a</span> <span class="hl-attribute">String.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">constructor-arg</span> <span class="hl-attribute">type</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
  <span class="hl-attribute">A</span> <span class="hl-attribute">short-cut</span> <span class="hl-attribute">alternative</span> <span class="hl-attribute">to</span> <span class="hl-attribute">a</span> <span class="hl-attribute">child</span> <span class="hl-attribute">element</span> <span class="hl-attribute">"ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">".
--&gt;
&lt;!ATTLIST constructor-arg ref CDATA #IMPLIED&gt;

&lt;!--
  A short-cut alternative to a child element "</span><span class="hl-attribute">value".</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">constructor-arg</span> <span class="hl-attribute">value</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>


<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Bean</span> <span class="hl-attribute">definitions</span> <span class="hl-attribute">can</span> <span class="hl-attribute">have</span> <span class="hl-attribute">zero</span> <span class="hl-attribute">or</span> <span class="hl-attribute">more</span> <span class="hl-attribute">properties.</span>
	<span class="hl-attribute">Property</span> <span class="hl-attribute">elements</span> <span class="hl-attribute">correspond</span> <span class="hl-attribute">to</span> <span class="hl-attribute">JavaBean</span> <span class="hl-attribute">setter</span> <span class="hl-attribute">methods</span> <span class="hl-attribute">exposed</span>
	<span class="hl-attribute">by</span> <span class="hl-attribute">the</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">classes.</span> <span class="hl-attribute">Spring</span> <span class="hl-attribute">supports</span> <span class="hl-attribute">primitives,</span> <span class="hl-attribute">references</span> <span class="hl-attribute">to</span> <span class="hl-attribute">other</span>
	<span class="hl-attribute">beans</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">same</span> <span class="hl-attribute">or</span> <span class="hl-attribute">related</span> <span class="hl-attribute">factories,</span> <span class="hl-attribute">lists,</span> <span class="hl-attribute">maps</span> <span class="hl-attribute">and</span> <span class="hl-attribute">properties.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">property</span> <span class="hl-attribute">(</span>
	<span class="hl-attribute">description?,</span> <span class="hl-attribute">meta*,</span>
	<span class="hl-attribute">(bean</span> <span class="hl-attribute">|</span> <span class="hl-attribute">ref</span> <span class="hl-attribute">|</span> <span class="hl-attribute">idref</span> <span class="hl-attribute">|</span> <span class="hl-attribute">value</span> <span class="hl-attribute">|</span> <span class="hl-attribute">null</span> <span class="hl-attribute">|</span> <span class="hl-attribute">list</span> <span class="hl-attribute">|</span> <span class="hl-attribute">set</span> <span class="hl-attribute">|</span> <span class="hl-attribute">map</span> <span class="hl-attribute">|</span> <span class="hl-attribute">props)?</span>
<span class="hl-attribute">)&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">property</span> <span class="hl-attribute">name</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">is</span> <span class="hl-attribute">the</span> <span class="hl-attribute">name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">JavaBean</span> <span class="hl-attribute">property.</span>
	<span class="hl-attribute">This</span> <span class="hl-attribute">follows</span> <span class="hl-attribute">JavaBean</span> <span class="hl-attribute">conventions:</span> <span class="hl-attribute">a</span> <span class="hl-attribute">name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">"age"</span> <span class="hl-attribute">would</span> <span class="hl-attribute">correspond</span>
	<span class="hl-attribute">to</span> <span class="hl-attribute">setAge()/optional</span> <span class="hl-attribute">getAge()</span> <span class="hl-attribute">methods.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">property</span> <span class="hl-attribute">name</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#REQUIRED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
  <span class="hl-attribute">A</span> <span class="hl-attribute">short-cut</span> <span class="hl-attribute">alternative</span> <span class="hl-attribute">to</span> <span class="hl-attribute">a</span> <span class="hl-attribute">child</span> <span class="hl-attribute">element</span> <span class="hl-attribute">"ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">".
--&gt;
&lt;!ATTLIST property ref CDATA #IMPLIED&gt;

&lt;!--
  A short-cut alternative to a child element "</span><span class="hl-attribute">value".</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">property</span> <span class="hl-attribute">value</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>


<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">A</span> <span class="hl-attribute">lookup</span> <span class="hl-attribute">method</span> <span class="hl-attribute">causes</span> <span class="hl-attribute">the</span> <span class="hl-attribute">IoC</span> <span class="hl-attribute">container</span> <span class="hl-attribute">to</span> <span class="hl-attribute">override</span> <span class="hl-attribute">the</span> <span class="hl-attribute">given</span> <span class="hl-attribute">method</span> <span class="hl-attribute">and</span> <span class="hl-attribute">return</span>
	<span class="hl-attribute">the</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">with</span> <span class="hl-attribute">the</span> <span class="hl-attribute">name</span> <span class="hl-attribute">given</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">attribute.</span> <span class="hl-attribute">This</span> <span class="hl-attribute">is</span> <span class="hl-attribute">a</span> <span class="hl-attribute">form</span> <span class="hl-attribute">of</span> <span class="hl-attribute">Method</span> <span class="hl-attribute">Injection.</span>
	<span class="hl-attribute">It's</span> <span class="hl-attribute">particularly</span> <span class="hl-attribute">useful</span> <span class="hl-attribute">as</span> <span class="hl-attribute">an</span> <span class="hl-attribute">alternative</span> <span class="hl-attribute">to</span> <span class="hl-attribute">implementing</span> <span class="hl-attribute">the</span> <span class="hl-attribute">BeanFactoryAware</span>
	<span class="hl-attribute">interface,</span> <span class="hl-attribute">in</span> <span class="hl-attribute">order</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">able</span> <span class="hl-attribute">to</span> <span class="hl-attribute">make</span> <span class="hl-attribute">getBean()</span> <span class="hl-attribute">calls</span> <span class="hl-attribute">for</span> <span class="hl-attribute">non-singleton</span> <span class="hl-attribute">instances</span>
	<span class="hl-attribute">at</span> <span class="hl-attribute">runtime.</span> <span class="hl-attribute">In</span> <span class="hl-attribute">this</span> <span class="hl-attribute">case,</span> <span class="hl-attribute">Method</span> <span class="hl-attribute">Injection</span> <span class="hl-attribute">is</span> <span class="hl-attribute">a</span> <span class="hl-attribute">less</span> <span class="hl-attribute">invasive</span> <span class="hl-attribute">alternative.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">lookup-method</span> <span class="hl-attribute">EMPTY&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">a</span> <span class="hl-attribute">lookup</span> <span class="hl-attribute">method.</span> <span class="hl-attribute">This</span> <span class="hl-attribute">method</span> <span class="hl-attribute">should</span> <span class="hl-attribute">take</span> <span class="hl-attribute">no</span> <span class="hl-attribute">arguments.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">lookup-method</span> <span class="hl-attribute">name</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">current</span> <span class="hl-attribute">or</span> <span class="hl-attribute">ancestor</span> <span class="hl-attribute">factories</span> <span class="hl-attribute">that</span> <span class="hl-attribute">the</span> <span class="hl-attribute">lookup</span> <span class="hl-attribute">method</span>
	<span class="hl-attribute">should</span> <span class="hl-attribute">resolve</span> <span class="hl-attribute">to.</span> <span class="hl-attribute">Often</span> <span class="hl-attribute">this</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">a</span> <span class="hl-attribute">prototype,</span> <span class="hl-attribute">in</span> <span class="hl-attribute">which</span> <span class="hl-attribute">case</span> <span class="hl-attribute">the</span>
	<span class="hl-attribute">lookup</span> <span class="hl-attribute">method</span> <span class="hl-attribute">will</span> <span class="hl-attribute">return</span> <span class="hl-attribute">a</span> <span class="hl-attribute">distinct</span> <span class="hl-attribute">instance</span> <span class="hl-attribute">on</span> <span class="hl-attribute">every</span> <span class="hl-attribute">invocation.</span> <span class="hl-attribute">This</span>
	<span class="hl-attribute">is</span> <span class="hl-attribute">useful</span> <span class="hl-attribute">for</span> <span class="hl-attribute">single-threaded</span> <span class="hl-attribute">objects.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">lookup-method</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>


<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Similar</span> <span class="hl-attribute">to</span> <span class="hl-attribute">the</span> <span class="hl-attribute">lookup</span> <span class="hl-attribute">method</span> <span class="hl-attribute">mechanism,</span> <span class="hl-attribute">the</span> <span class="hl-attribute">replaced-method</span> <span class="hl-attribute">element</span> <span class="hl-attribute">is</span> <span class="hl-attribute">used</span> <span class="hl-attribute">to</span> <span class="hl-attribute">control</span>
	<span class="hl-attribute">IoC</span> <span class="hl-attribute">container</span> <span class="hl-attribute">method</span> <span class="hl-attribute">overriding:</span> <span class="hl-attribute">Method</span> <span class="hl-attribute">Injection.</span> <span class="hl-attribute">This</span> <span class="hl-attribute">mechanism</span> <span class="hl-attribute">allows</span> <span class="hl-attribute">the</span> <span class="hl-attribute">overriding</span>
	<span class="hl-attribute">of</span> <span class="hl-attribute">a</span> <span class="hl-attribute">method</span> <span class="hl-attribute">with</span> <span class="hl-attribute">arbitrary</span> <span class="hl-attribute">code.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">replaced-method</span> <span class="hl-attribute">(</span>
	<span class="hl-attribute">(arg-type)*</span>
<span class="hl-attribute">)&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">method</span> <span class="hl-attribute">whose</span> <span class="hl-attribute">implementation</span> <span class="hl-attribute">should</span> <span class="hl-attribute">be</span> <span class="hl-attribute">replaced</span> <span class="hl-attribute">by</span> <span class="hl-attribute">the</span> <span class="hl-attribute">IoC</span> <span class="hl-attribute">container.</span>
	<span class="hl-attribute">If</span> <span class="hl-attribute">this</span> <span class="hl-attribute">method</span> <span class="hl-attribute">is</span> <span class="hl-attribute">not</span> <span class="hl-attribute">overloaded,</span> <span class="hl-attribute">there's</span> <span class="hl-attribute">no</span> <span class="hl-attribute">need</span> <span class="hl-attribute">to</span> <span class="hl-attribute">use</span> <span class="hl-attribute">arg-type</span> <span class="hl-attribute">subelements.</span>
	<span class="hl-attribute">If</span> <span class="hl-attribute">this</span> <span class="hl-attribute">method</span> <span class="hl-attribute">is</span> <span class="hl-attribute">overloaded,</span> <span class="hl-attribute">arg-type</span> <span class="hl-attribute">subelements</span> <span class="hl-attribute">must</span> <span class="hl-attribute">be</span> <span class="hl-attribute">used</span> <span class="hl-attribute">for</span> <span class="hl-attribute">all</span>
	<span class="hl-attribute">override</span> <span class="hl-attribute">definitions</span> <span class="hl-attribute">for</span> <span class="hl-attribute">the</span> <span class="hl-attribute">method.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">replaced-method</span> <span class="hl-attribute">name</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Bean</span> <span class="hl-attribute">name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">an</span> <span class="hl-attribute">implementation</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">MethodReplacer</span> <span class="hl-attribute">interface</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">current</span>
	<span class="hl-attribute">or</span> <span class="hl-attribute">ancestor</span> <span class="hl-attribute">factories.</span> <span class="hl-attribute">This</span> <span class="hl-attribute">may</span> <span class="hl-attribute">be</span> <span class="hl-attribute">a</span> <span class="hl-attribute">singleton</span> <span class="hl-attribute">or</span> <span class="hl-attribute">prototype</span> <span class="hl-attribute">bean.</span> <span class="hl-attribute">If</span> <span class="hl-attribute">it's</span>
	<span class="hl-attribute">a</span> <span class="hl-attribute">prototype,</span> <span class="hl-attribute">a</span> <span class="hl-attribute">new</span> <span class="hl-attribute">instance</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">used</span> <span class="hl-attribute">for</span> <span class="hl-attribute">each</span> <span class="hl-attribute">method</span> <span class="hl-attribute">replacement.</span>
	<span class="hl-attribute">Singleton</span> <span class="hl-attribute">usage</span> <span class="hl-attribute">is</span> <span class="hl-attribute">the</span> <span class="hl-attribute">norm.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">replaced-method</span> <span class="hl-attribute">replacer</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Subelement</span> <span class="hl-attribute">of</span> <span class="hl-attribute">replaced-method</span> <span class="hl-attribute">identifying</span> <span class="hl-attribute">an</span> <span class="hl-attribute">argument</span> <span class="hl-attribute">for</span> <span class="hl-attribute">a</span> <span class="hl-attribute">replaced</span> <span class="hl-attribute">method</span>
	<span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">event</span> <span class="hl-attribute">of</span> <span class="hl-attribute">method</span> <span class="hl-attribute">overloading.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">arg-type</span> <span class="hl-attribute">(#PCDATA)&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Specification</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">type</span> <span class="hl-attribute">of</span> <span class="hl-attribute">an</span> <span class="hl-attribute">overloaded</span> <span class="hl-attribute">method</span> <span class="hl-attribute">argument</span> <span class="hl-attribute">as</span> <span class="hl-attribute">a</span> <span class="hl-attribute">String.</span>
	<span class="hl-attribute">For</span> <span class="hl-attribute">convenience,</span> <span class="hl-attribute">this</span> <span class="hl-attribute">may</span> <span class="hl-attribute">be</span> <span class="hl-attribute">a</span> <span class="hl-attribute">substring</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">FQN.</span> <span class="hl-attribute">E.g.</span> <span class="hl-attribute">all</span> <span class="hl-attribute">the</span>
	<span class="hl-attribute">following</span> <span class="hl-attribute">would</span> <span class="hl-attribute">match</span> <span class="hl-attribute">"java.lang.String":</span>
	<span class="hl-attribute">-</span> <span class="hl-attribute">java.lang.String</span>
	<span class="hl-attribute">-</span> <span class="hl-attribute">String</span>
	<span class="hl-attribute">-</span> <span class="hl-attribute">Str</span>

	<span class="hl-attribute">As</span> <span class="hl-attribute">the</span> <span class="hl-attribute">number</span> <span class="hl-attribute">of</span> <span class="hl-attribute">arguments</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">checked</span> <span class="hl-attribute">also,</span> <span class="hl-attribute">this</span> <span class="hl-attribute">convenience</span> <span class="hl-attribute">can</span> <span class="hl-attribute">often</span>
	<span class="hl-attribute">be</span> <span class="hl-attribute">used</span> <span class="hl-attribute">to</span> <span class="hl-attribute">save</span> <span class="hl-attribute">typing.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">arg-type</span> <span class="hl-attribute">match</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>


<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Defines</span> <span class="hl-attribute">a</span> <span class="hl-attribute">reference</span> <span class="hl-attribute">to</span> <span class="hl-attribute">another</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">in</span> <span class="hl-attribute">this</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">or</span> <span class="hl-attribute">an</span> <span class="hl-attribute">external</span>
	<span class="hl-attribute">factory</span> <span class="hl-attribute">(parent</span> <span class="hl-attribute">or</span> <span class="hl-attribute">included</span> <span class="hl-attribute">factory).</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">ref</span> <span class="hl-attribute">EMPTY&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">References</span> <span class="hl-attribute">must</span> <span class="hl-attribute">specify</span> <span class="hl-attribute">a</span> <span class="hl-attribute">name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">target</span> <span class="hl-attribute">bean.</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">"bean"</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">can</span> <span class="hl-attribute">reference</span> <span class="hl-attribute">any</span> <span class="hl-attribute">name</span> <span class="hl-attribute">from</span> <span class="hl-attribute">any</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">context,</span>
	<span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">checked</span> <span class="hl-attribute">at</span> <span class="hl-attribute">runtime.</span>
	<span class="hl-attribute">Local</span> <span class="hl-attribute">references,</span> <span class="hl-attribute">using</span> <span class="hl-attribute">the</span> <span class="hl-attribute">"local"</span> <span class="hl-attribute">attribute,</span> <span class="hl-attribute">have</span> <span class="hl-attribute">to</span> <span class="hl-attribute">use</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">ids;</span>
	<span class="hl-attribute">they</span> <span class="hl-attribute">can</span> <span class="hl-attribute">be</span> <span class="hl-attribute">checked</span> <span class="hl-attribute">by</span> <span class="hl-attribute">this</span> <span class="hl-attribute">DTD,</span> <span class="hl-attribute">thus</span> <span class="hl-attribute">should</span> <span class="hl-attribute">be</span> <span class="hl-attribute">preferred</span> <span class="hl-attribute">for</span> <span class="hl-attribute">references</span>
	<span class="hl-attribute">within</span> <span class="hl-attribute">the</span> <span class="hl-attribute">same</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">XML</span> <span class="hl-attribute">file.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">ref</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">ref</span> <span class="hl-attribute">local</span> <span class="hl-attribute">IDREF</span> <span class="hl-attribute">#IMPLIED&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">ref</span> <span class="hl-attribute">parent</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>


<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Defines</span> <span class="hl-attribute">a</span> <span class="hl-attribute">string</span> <span class="hl-attribute">property</span> <span class="hl-attribute">value,</span> <span class="hl-attribute">which</span> <span class="hl-attribute">must</span> <span class="hl-attribute">also</span> <span class="hl-attribute">be</span> <span class="hl-attribute">the</span> <span class="hl-attribute">id</span> <span class="hl-attribute">of</span> <span class="hl-attribute">another</span>
	<span class="hl-attribute">bean</span> <span class="hl-attribute">in</span> <span class="hl-attribute">this</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">or</span> <span class="hl-attribute">an</span> <span class="hl-attribute">external</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">(parent</span> <span class="hl-attribute">or</span> <span class="hl-attribute">included</span> <span class="hl-attribute">factory).</span>
	<span class="hl-attribute">While</span> <span class="hl-attribute">a</span> <span class="hl-attribute">regular</span> <span class="hl-attribute">'value'</span> <span class="hl-attribute">element</span> <span class="hl-attribute">could</span> <span class="hl-attribute">instead</span> <span class="hl-attribute">be</span> <span class="hl-attribute">used</span> <span class="hl-attribute">for</span> <span class="hl-attribute">the</span> <span class="hl-attribute">same</span> <span class="hl-attribute">effect,</span>
	<span class="hl-attribute">using</span> <span class="hl-attribute">idref</span> <span class="hl-attribute">in</span> <span class="hl-attribute">this</span> <span class="hl-attribute">case</span> <span class="hl-attribute">allows</span> <span class="hl-attribute">validation</span> <span class="hl-attribute">of</span> <span class="hl-attribute">local</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">ids</span> <span class="hl-attribute">by</span> <span class="hl-attribute">the</span> <span class="hl-attribute">XML</span>
	<span class="hl-attribute">parser,</span> <span class="hl-attribute">and</span> <span class="hl-attribute">name</span> <span class="hl-attribute">completion</span> <span class="hl-attribute">by</span> <span class="hl-attribute">supporting</span> <span class="hl-attribute">tools.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">idref</span> <span class="hl-attribute">EMPTY&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">ID</span> <span class="hl-attribute">refs</span> <span class="hl-attribute">must</span> <span class="hl-attribute">specify</span> <span class="hl-attribute">a</span> <span class="hl-attribute">name</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">target</span> <span class="hl-attribute">bean.</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">"bean"</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">can</span> <span class="hl-attribute">reference</span> <span class="hl-attribute">any</span> <span class="hl-attribute">name</span> <span class="hl-attribute">from</span> <span class="hl-attribute">any</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">in</span> <span class="hl-attribute">the</span> <span class="hl-attribute">context,</span>
	<span class="hl-attribute">potentially</span> <span class="hl-attribute">to</span> <span class="hl-attribute">be</span> <span class="hl-attribute">checked</span> <span class="hl-attribute">at</span> <span class="hl-attribute">runtime</span> <span class="hl-attribute">by</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">implementations.</span>
	<span class="hl-attribute">Local</span> <span class="hl-attribute">references,</span> <span class="hl-attribute">using</span> <span class="hl-attribute">the</span> <span class="hl-attribute">"local"</span> <span class="hl-attribute">attribute,</span> <span class="hl-attribute">have</span> <span class="hl-attribute">to</span> <span class="hl-attribute">use</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">ids;</span>
	<span class="hl-attribute">they</span> <span class="hl-attribute">can</span> <span class="hl-attribute">be</span> <span class="hl-attribute">checked</span> <span class="hl-attribute">by</span> <span class="hl-attribute">this</span> <span class="hl-attribute">DTD,</span> <span class="hl-attribute">thus</span> <span class="hl-attribute">should</span> <span class="hl-attribute">be</span> <span class="hl-attribute">preferred</span> <span class="hl-attribute">for</span> <span class="hl-attribute">references</span>
	<span class="hl-attribute">within</span> <span class="hl-attribute">the</span> <span class="hl-attribute">same</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">factory</span> <span class="hl-attribute">XML</span> <span class="hl-attribute">file.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">idref</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">idref</span> <span class="hl-attribute">local</span> <span class="hl-attribute">IDREF</span> <span class="hl-attribute">#IMPLIED&gt;</span>


<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Contains</span> <span class="hl-attribute">a</span> <span class="hl-attribute">string</span> <span class="hl-attribute">representation</span> <span class="hl-attribute">of</span> <span class="hl-attribute">a</span> <span class="hl-attribute">property</span> <span class="hl-attribute">value.</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">property</span> <span class="hl-attribute">may</span> <span class="hl-attribute">be</span> <span class="hl-attribute">a</span> <span class="hl-attribute">string,</span> <span class="hl-attribute">or</span> <span class="hl-attribute">may</span> <span class="hl-attribute">be</span> <span class="hl-attribute">converted</span> <span class="hl-attribute">to</span> <span class="hl-attribute">the</span> <span class="hl-attribute">required</span>
	<span class="hl-attribute">type</span> <span class="hl-attribute">using</span> <span class="hl-attribute">the</span> <span class="hl-attribute">JavaBeans</span> <span class="hl-attribute">PropertyEditor</span> <span class="hl-attribute">machinery.</span> <span class="hl-attribute">This</span> <span class="hl-attribute">makes</span> <span class="hl-attribute">it</span>
	<span class="hl-attribute">possible</span> <span class="hl-attribute">for</span> <span class="hl-attribute">application</span> <span class="hl-attribute">developers</span> <span class="hl-attribute">to</span> <span class="hl-attribute">write</span> <span class="hl-attribute">custom</span> <span class="hl-attribute">PropertyEditor</span>
	<span class="hl-attribute">implementations</span> <span class="hl-attribute">that</span> <span class="hl-attribute">can</span> <span class="hl-attribute">convert</span> <span class="hl-attribute">strings</span> <span class="hl-attribute">to</span> <span class="hl-attribute">arbitrary</span> <span class="hl-attribute">target</span> <span class="hl-attribute">objects.</span>

	<span class="hl-attribute">Note</span> <span class="hl-attribute">that</span> <span class="hl-attribute">this</span> <span class="hl-attribute">is</span> <span class="hl-attribute">recommended</span> <span class="hl-attribute">for</span> <span class="hl-attribute">simple</span> <span class="hl-attribute">objects</span> <span class="hl-attribute">only.</span>
	<span class="hl-attribute">Configure</span> <span class="hl-attribute">more</span> <span class="hl-attribute">complex</span> <span class="hl-attribute">objects</span> <span class="hl-attribute">by</span> <span class="hl-attribute">populating</span> <span class="hl-attribute">JavaBean</span>
	<span class="hl-attribute">properties</span> <span class="hl-attribute">with</span> <span class="hl-attribute">references</span> <span class="hl-attribute">to</span> <span class="hl-attribute">other</span> <span class="hl-attribute">beans.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">value</span> <span class="hl-attribute">(#PCDATA)&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">value</span> <span class="hl-attribute">tag</span> <span class="hl-attribute">can</span> <span class="hl-attribute">have</span> <span class="hl-attribute">an</span> <span class="hl-attribute">optional</span> <span class="hl-attribute">type</span> <span class="hl-attribute">attribute,</span> <span class="hl-attribute">to</span> <span class="hl-attribute">specify</span> <span class="hl-attribute">the</span>
	<span class="hl-attribute">exact</span> <span class="hl-attribute">type</span> <span class="hl-attribute">that</span> <span class="hl-attribute">the</span> <span class="hl-attribute">value</span> <span class="hl-attribute">should</span> <span class="hl-attribute">be</span> <span class="hl-attribute">converted</span> <span class="hl-attribute">to.</span> <span class="hl-attribute">Only</span> <span class="hl-attribute">needed</span>
	<span class="hl-attribute">if</span> <span class="hl-attribute">the</span> <span class="hl-attribute">type</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">target</span> <span class="hl-attribute">property</span> <span class="hl-attribute">or</span> <span class="hl-attribute">constructor</span> <span class="hl-attribute">argument</span> <span class="hl-attribute">is</span>
	<span class="hl-attribute">too</span> <span class="hl-attribute">generic:</span> <span class="hl-attribute">for</span> <span class="hl-attribute">example,</span> <span class="hl-attribute">in</span> <span class="hl-attribute">case</span> <span class="hl-attribute">of</span> <span class="hl-attribute">a</span> <span class="hl-attribute">collection</span> <span class="hl-attribute">element.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">value</span> <span class="hl-attribute">type</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Denotes</span> <span class="hl-attribute">a</span> <span class="hl-attribute">Java</span> <span class="hl-attribute">null</span> <span class="hl-attribute">value.</span> <span class="hl-attribute">Necessary</span> <span class="hl-attribute">because</span> <span class="hl-attribute">an</span> <span class="hl-attribute">empty</span> <span class="hl-attribute">"value"</span> <span class="hl-attribute">tag</span>
	<span class="hl-attribute">will</span> <span class="hl-attribute">resolve</span> <span class="hl-attribute">to</span> <span class="hl-attribute">an</span> <span class="hl-attribute">empty</span> <span class="hl-attribute">String,</span> <span class="hl-attribute">which</span> <span class="hl-attribute">will</span> <span class="hl-attribute">not</span> <span class="hl-attribute">be</span> <span class="hl-attribute">resolved</span> <span class="hl-attribute">to</span> <span class="hl-attribute">a</span>
	<span class="hl-attribute">null</span> <span class="hl-attribute">value</span> <span class="hl-attribute">unless</span> <span class="hl-attribute">a</span> <span class="hl-attribute">special</span> <span class="hl-attribute">PropertyEditor</span> <span class="hl-attribute">does</span> <span class="hl-attribute">so.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">null</span> <span class="hl-attribute">(#PCDATA)&gt;</span>


<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">A</span> <span class="hl-attribute">list</span> <span class="hl-attribute">can</span> <span class="hl-attribute">contain</span> <span class="hl-attribute">multiple</span> <span class="hl-attribute">inner</span> <span class="hl-attribute">bean,</span> <span class="hl-attribute">ref,</span> <span class="hl-attribute">collection,</span> <span class="hl-attribute">or</span> <span class="hl-attribute">value</span> <span class="hl-attribute">elements.</span>
	<span class="hl-attribute">Java</span> <span class="hl-attribute">lists</span> <span class="hl-attribute">are</span> <span class="hl-attribute">untyped,</span> <span class="hl-attribute">pending</span> <span class="hl-attribute">generics</span> <span class="hl-attribute">support</span> <span class="hl-attribute">in</span> <span class="hl-attribute">Java</span> <span class="hl-attribute">1.5,</span>
	<span class="hl-attribute">although</span> <span class="hl-attribute">references</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">strongly</span> <span class="hl-attribute">typed.</span>
	<span class="hl-attribute">A</span> <span class="hl-attribute">list</span> <span class="hl-attribute">can</span> <span class="hl-attribute">also</span> <span class="hl-attribute">map</span> <span class="hl-attribute">to</span> <span class="hl-attribute">an</span> <span class="hl-attribute">array</span> <span class="hl-attribute">type.</span> <span class="hl-attribute">The</span> <span class="hl-attribute">necessary</span> <span class="hl-attribute">conversion</span>
	<span class="hl-attribute">is</span> <span class="hl-attribute">automatically</span> <span class="hl-attribute">performed</span> <span class="hl-attribute">by</span> <span class="hl-attribute">the</span> <span class="hl-attribute">BeanFactory.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">list</span> <span class="hl-attribute">(</span>
	<span class="hl-attribute">(bean</span> <span class="hl-attribute">|</span> <span class="hl-attribute">ref</span> <span class="hl-attribute">|</span> <span class="hl-attribute">idref</span> <span class="hl-attribute">|</span> <span class="hl-attribute">value</span> <span class="hl-attribute">|</span> <span class="hl-attribute">null</span> <span class="hl-attribute">|</span> <span class="hl-attribute">list</span> <span class="hl-attribute">|</span> <span class="hl-attribute">set</span> <span class="hl-attribute">|</span> <span class="hl-attribute">map</span> <span class="hl-attribute">|</span> <span class="hl-attribute">props)*</span>
<span class="hl-attribute">)&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Enable/disable</span> <span class="hl-attribute">merging</span> <span class="hl-attribute">for</span> <span class="hl-attribute">collections</span> <span class="hl-attribute">when</span> <span class="hl-attribute">using</span> <span class="hl-attribute">parent/child</span> <span class="hl-attribute">beans.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">list</span> <span class="hl-attribute">merge</span> <span class="hl-attribute">(true</span> <span class="hl-attribute">|</span> <span class="hl-attribute">false</span> <span class="hl-attribute">|</span> <span class="hl-attribute">default)</span> <span class="hl-attribute">"default"&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Specify</span> <span class="hl-attribute">the</span> <span class="hl-attribute">default</span> <span class="hl-attribute">Java</span> <span class="hl-attribute">type</span> <span class="hl-attribute">for</span> <span class="hl-attribute">nested</span> <span class="hl-attribute">values.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">list</span> <span class="hl-attribute">value-type</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>


<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">A</span> <span class="hl-attribute">set</span> <span class="hl-attribute">can</span> <span class="hl-attribute">contain</span> <span class="hl-attribute">multiple</span> <span class="hl-attribute">inner</span> <span class="hl-attribute">bean,</span> <span class="hl-attribute">ref,</span> <span class="hl-attribute">collection,</span> <span class="hl-attribute">or</span> <span class="hl-attribute">value</span> <span class="hl-attribute">elements.</span>
	<span class="hl-attribute">Java</span> <span class="hl-attribute">sets</span> <span class="hl-attribute">are</span> <span class="hl-attribute">untyped,</span> <span class="hl-attribute">pending</span> <span class="hl-attribute">generics</span> <span class="hl-attribute">support</span> <span class="hl-attribute">in</span> <span class="hl-attribute">Java</span> <span class="hl-attribute">1.5,</span>
	<span class="hl-attribute">although</span> <span class="hl-attribute">references</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">strongly</span> <span class="hl-attribute">typed.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">set</span> <span class="hl-attribute">(</span>
	<span class="hl-attribute">(bean</span> <span class="hl-attribute">|</span> <span class="hl-attribute">ref</span> <span class="hl-attribute">|</span> <span class="hl-attribute">idref</span> <span class="hl-attribute">|</span> <span class="hl-attribute">value</span> <span class="hl-attribute">|</span> <span class="hl-attribute">null</span> <span class="hl-attribute">|</span> <span class="hl-attribute">list</span> <span class="hl-attribute">|</span> <span class="hl-attribute">set</span> <span class="hl-attribute">|</span> <span class="hl-attribute">map</span> <span class="hl-attribute">|</span> <span class="hl-attribute">props)*</span>
<span class="hl-attribute">)&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Enable/disable</span> <span class="hl-attribute">merging</span> <span class="hl-attribute">for</span> <span class="hl-attribute">collections</span> <span class="hl-attribute">when</span> <span class="hl-attribute">using</span> <span class="hl-attribute">parent/child</span> <span class="hl-attribute">beans.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">set</span> <span class="hl-attribute">merge</span> <span class="hl-attribute">(true</span> <span class="hl-attribute">|</span> <span class="hl-attribute">false</span> <span class="hl-attribute">|</span> <span class="hl-attribute">default)</span> <span class="hl-attribute">"default"&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Specify</span> <span class="hl-attribute">the</span> <span class="hl-attribute">default</span> <span class="hl-attribute">Java</span> <span class="hl-attribute">type</span> <span class="hl-attribute">for</span> <span class="hl-attribute">nested</span> <span class="hl-attribute">values.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">set</span> <span class="hl-attribute">value-type</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>


<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">A</span> <span class="hl-attribute">Spring</span> <span class="hl-attribute">map</span> <span class="hl-attribute">is</span> <span class="hl-attribute">a</span> <span class="hl-attribute">mapping</span> <span class="hl-attribute">from</span> <span class="hl-attribute">a</span> <span class="hl-attribute">string</span> <span class="hl-attribute">key</span> <span class="hl-attribute">to</span> <span class="hl-attribute">object.</span>
	<span class="hl-attribute">Maps</span> <span class="hl-attribute">may</span> <span class="hl-attribute">be</span> <span class="hl-attribute">empty.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">map</span> <span class="hl-attribute">(</span>
	<span class="hl-attribute">(entry)*</span>
<span class="hl-attribute">)&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Enable/disable</span> <span class="hl-attribute">merging</span> <span class="hl-attribute">for</span> <span class="hl-attribute">collections</span> <span class="hl-attribute">when</span> <span class="hl-attribute">using</span> <span class="hl-attribute">parent/child</span> <span class="hl-attribute">beans.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">map</span> <span class="hl-attribute">merge</span> <span class="hl-attribute">(true</span> <span class="hl-attribute">|</span> <span class="hl-attribute">false</span> <span class="hl-attribute">|</span> <span class="hl-attribute">default)</span> <span class="hl-attribute">"default"&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Specify</span> <span class="hl-attribute">the</span> <span class="hl-attribute">default</span> <span class="hl-attribute">Java</span> <span class="hl-attribute">type</span> <span class="hl-attribute">for</span> <span class="hl-attribute">nested</span> <span class="hl-attribute">entry</span> <span class="hl-attribute">keys.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">map</span> <span class="hl-attribute">key-type</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Specify</span> <span class="hl-attribute">the</span> <span class="hl-attribute">default</span> <span class="hl-attribute">Java</span> <span class="hl-attribute">type</span> <span class="hl-attribute">for</span> <span class="hl-attribute">nested</span> <span class="hl-attribute">entry</span> <span class="hl-attribute">values.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">map</span> <span class="hl-attribute">value-type</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">A</span> <span class="hl-attribute">map</span> <span class="hl-attribute">entry</span> <span class="hl-attribute">can</span> <span class="hl-attribute">be</span> <span class="hl-attribute">an</span> <span class="hl-attribute">inner</span> <span class="hl-attribute">bean,</span> <span class="hl-attribute">ref,</span> <span class="hl-attribute">value,</span> <span class="hl-attribute">or</span> <span class="hl-attribute">collection.</span>
	<span class="hl-attribute">The</span> <span class="hl-attribute">key</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">entry</span> <span class="hl-attribute">is</span> <span class="hl-attribute">given</span> <span class="hl-attribute">by</span> <span class="hl-attribute">the</span> <span class="hl-attribute">"key"</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">or</span> <span class="hl-attribute">child</span> <span class="hl-attribute">element.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">entry</span> <span class="hl-attribute">(</span>
  <span class="hl-attribute">key?,</span>
	<span class="hl-attribute">(bean</span> <span class="hl-attribute">|</span> <span class="hl-attribute">ref</span> <span class="hl-attribute">|</span> <span class="hl-attribute">idref</span> <span class="hl-attribute">|</span> <span class="hl-attribute">value</span> <span class="hl-attribute">|</span> <span class="hl-attribute">null</span> <span class="hl-attribute">|</span> <span class="hl-attribute">list</span> <span class="hl-attribute">|</span> <span class="hl-attribute">set</span> <span class="hl-attribute">|</span> <span class="hl-attribute">map</span> <span class="hl-attribute">|</span> <span class="hl-attribute">props)?</span>
<span class="hl-attribute">)&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Each</span> <span class="hl-attribute">map</span> <span class="hl-attribute">element</span> <span class="hl-attribute">must</span> <span class="hl-attribute">specify</span> <span class="hl-attribute">its</span> <span class="hl-attribute">key</span> <span class="hl-attribute">as</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">or</span> <span class="hl-attribute">as</span> <span class="hl-attribute">child</span> <span class="hl-attribute">element.</span>
	<span class="hl-attribute">A</span> <span class="hl-attribute">key</span> <span class="hl-attribute">attribute</span> <span class="hl-attribute">is</span> <span class="hl-attribute">always</span> <span class="hl-attribute">a</span> <span class="hl-attribute">String</span> <span class="hl-attribute">value.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">entry</span> <span class="hl-attribute">key</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
  <span class="hl-attribute">A</span> <span class="hl-attribute">short-cut</span> <span class="hl-attribute">alternative</span> <span class="hl-attribute">to</span> <span class="hl-attribute">a</span> <span class="hl-attribute">"key"</span> <span class="hl-attribute">element</span> <span class="hl-attribute">with</span> <span class="hl-attribute">a</span> <span class="hl-attribute">"ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">" child element.
--&gt;
&lt;!ATTLIST entry key-ref CDATA #IMPLIED&gt;

&lt;!--
  A short-cut alternative to a child element "</span><span class="hl-attribute">value".</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">entry</span> <span class="hl-attribute">value</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#IMPLIED&gt;</span>

<span class="hl-attribute">&lt;!--</span>
  <span class="hl-attribute">A</span> <span class="hl-attribute">short-cut</span> <span class="hl-attribute">alternative</span> <span class="hl-attribute">to</span> <span class="hl-attribute">a</span> <span class="hl-attribute">child</span> <span class="hl-attribute">element</span> <span class="hl-attribute">"ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">".
--&gt;
&lt;!ATTLIST entry value-ref CDATA #IMPLIED&gt;

&lt;!--
	A key element can contain an inner bean, ref, value, or collection.
--&gt;
&lt;!ELEMENT key (
	(bean | ref | idref | value | null | list | set | map | props)
)&gt;


&lt;!--
	Props elements differ from map elements in that values must be strings.
	Props may be empty.
--&gt;
&lt;!ELEMENT props (
	(prop)*
)&gt;

&lt;!--
	Enable/disable merging for collections when using parent/child beans.
--&gt;
&lt;!ATTLIST props merge (true | false | default) "</span><span class="hl-attribute">default"&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Element</span> <span class="hl-attribute">content</span> <span class="hl-attribute">is</span> <span class="hl-attribute">the</span> <span class="hl-attribute">string</span> <span class="hl-attribute">value</span> <span class="hl-attribute">of</span> <span class="hl-attribute">the</span> <span class="hl-attribute">property.</span>
	<span class="hl-attribute">Note</span> <span class="hl-attribute">that</span> <span class="hl-attribute">whitespace</span> <span class="hl-attribute">is</span> <span class="hl-attribute">trimmed</span> <span class="hl-attribute">off</span> <span class="hl-attribute">to</span> <span class="hl-attribute">avoid</span> <span class="hl-attribute">unwanted</span> <span class="hl-attribute">whitespace</span>
	<span class="hl-attribute">caused</span> <span class="hl-attribute">by</span> <span class="hl-attribute">typical</span> <span class="hl-attribute">XML</span> <span class="hl-attribute">formatting.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ELEMENT</span> <span class="hl-attribute">prop</span> <span class="hl-attribute">(#PCDATA)&gt;</span>

<span class="hl-attribute">&lt;!--</span>
	<span class="hl-attribute">Each</span> <span class="hl-attribute">property</span> <span class="hl-attribute">element</span> <span class="hl-attribute">must</span> <span class="hl-attribute">specify</span> <span class="hl-attribute">its</span> <span class="hl-attribute">key.</span>
<span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;!ATTLIST</span> <span class="hl-attribute">prop</span> <span class="hl-attribute">key</span> <span class="hl-attribute">CDATA</span> <span class="hl-attribute">#REQUIRED&gt;</span></pre></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="spring.tld"></a>Appendix&nbsp;F.&nbsp;spring.tld</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld-intro"></a>F.1&nbsp;Introduction</h2></div></div></div></div><p>One of the view technologies you can use with the Spring Framework
			    is Java Server Pages (JSPs). To help you implement views using Java Server Pages
			    the Spring Framework provides you with some tags for evaluating errors, setting
			    themes and outputting internationalized messages.</p><p>Please note that the various tags generated by this form tag library
                are compliant with the <a class="ulink" href="http://www.w3.org/TR/xhtml1/" target="_top">XHTML-1.0-Strict specification</a> and attendant <a class="ulink" href="http://www.w3.org/TR/xhtml1/dtds.html#a_dtd_XHTML-1.0-Strict" target="_top">DTD</a>.</p><p>This appendix describes the <code class="literal">spring.tld</code> tag library.</p><div class="itemizedlist"><ul type="disc"><li><a class="xref" href="#spring.tld.bind" title="F.2&nbsp;The bind tag">Section&nbsp;F.2, &#8220;The bind tag&#8221;</a></li><li><a class="xref" href="#spring.tld.escapeBody" title="F.3&nbsp;The escapeBody tag">Section&nbsp;F.3, &#8220;The escapeBody tag&#8221;</a></li><li><a class="xref" href="#spring.tld.hasBindErrors" title="F.4&nbsp;The hasBindErrors tag">Section&nbsp;F.4, &#8220;The hasBindErrors tag&#8221;</a></li><li><a class="xref" href="#spring.tld.htmlEscape" title="F.5&nbsp;The htmlEscape tag">Section&nbsp;F.5, &#8220;The htmlEscape tag&#8221;</a></li><li><a class="xref" href="#spring.tld.message" title="F.6&nbsp;The message tag">Section&nbsp;F.6, &#8220;The message tag&#8221;</a></li><li><a class="xref" href="#spring.tld.nestedPath" title="F.7&nbsp;The nestedPath tag">Section&nbsp;F.7, &#8220;The nestedPath tag&#8221;</a></li><li><a class="xref" href="#spring.tld.theme" title="F.8&nbsp;The theme tag">Section&nbsp;F.8, &#8220;The theme tag&#8221;</a></li><li><a class="xref" href="#spring.tld.transform" title="F.9&nbsp;The transform tag">Section&nbsp;F.9, &#8220;The transform tag&#8221;</a></li><li><a class="xref" href="#spring.tld.url" title="F.10&nbsp;The url tag">Section&nbsp;F.10, &#8220;The url tag&#8221;</a></li><li><a class="xref" href="#spring.tld.eval" title="F.11&nbsp;The eval tag">Section&nbsp;F.11, &#8220;The eval tag&#8221;</a></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.bind"></a>F.2&nbsp;The <code class="literal">bind</code> tag</h2></div></div></div><p>
			Provides BindStatus object for the given bind path.
			The HTML escaping flag participates in a page-wide or application-wide setting
			(i.e. by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).
		</p><div class="table"><a name="spring.tld.bind.table"></a><p class="title"><b>Table&nbsp;F.1.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Set HTML escaping for this tag, as boolean value. Overrides
			the default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ignoreNestedPath</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Set whether to ignore a nested path, if any. Default is to not ignore.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>path</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>The path to the bean or bean property to bind status
			information for. For instance account.name, company.address.zipCode
			or just employee. The status object will exported to the page scope,
			specifically for this bean or bean property</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.escapeBody"></a>F.3&nbsp;The <code class="literal">escapeBody</code> tag</h2></div></div></div><p>
			Escapes its enclosed body content, applying HTML escaping and/or JavaScript escaping.
			The HTML escaping flag participates in a page-wide or application-wide setting
			(i.e. by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).
		</p><div class="table"><a name="spring.tld.escapeBody.table"></a><p class="title"><b>Table&nbsp;F.2.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Set HTML escaping for this tag, as boolean value. Overrides the
			default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>javaScriptEscape</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>Set JavaScript escaping for this tag, as boolean value.
			Default is false.</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.hasBindErrors"></a>F.4&nbsp;The <code class="literal">hasBindErrors</code> tag</h2></div></div></div><p>
			Provides Errors instance in case of bind errors.
			The HTML escaping flag participates in a page-wide or application-wide setting
			(i.e. by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).
		</p><div class="table"><a name="spring.tld.hasBindErrors.table"></a><p class="title"><b>Table&nbsp;F.3.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Set HTML escaping for this tag, as boolean value.
			Overrides the default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>name</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>The name of the bean in the request, that needs to be
			inspected for errors. If errors are available for this bean, they
			will be bound under the 'errors' key.</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.htmlEscape"></a>F.5&nbsp;The <code class="literal">htmlEscape</code> tag</h2></div></div></div><p>
			Sets default HTML escape value for the current page.
			Overrides a "defaultHtmlEscape" context-param in web.xml, if any.
		</p><div class="table"><a name="spring.tld.htmlEscape.table"></a><p class="title"><b>Table&nbsp;F.4.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>defaultHtmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>Set the default value for HTML escaping, to be put
				into the current PageContext.</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.message"></a>F.6&nbsp;The <code class="literal">message</code> tag</h2></div></div></div><p>
			Retrieves the message with the given code, or text if code isn't resolvable.
			The HTML escaping flag participates in a page-wide or application-wide setting
			(i.e. by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).
		</p><div class="table"><a name="spring.tld.message.table"></a><p class="title"><b>Table&nbsp;F.5.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>arguments</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Set optional message arguments for this tag, as a
			(comma-)delimited String (each String argument can contain JSP EL),
			an Object array (used as argument array), or a single Object (used
			as single argument).</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>argumentSeparator</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The separator character to be used for splitting the
			arguments string value; defaults to a 'comma' (',').</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>code</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The code (key) to use when looking up the message.
			If code is not provided, the text attribute will be used.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Set HTML escaping for this tag, as boolean value.
			Overrides the default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>javaScriptEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Set JavaScript escaping for this tag, as boolean value. Default is false.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>message</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>A MessageSourceResolvable argument (direct or through JSP EL).
				Fits nicely when used in conjunction with Spring's own validation error
				classes which all implement the MessageSourceResolvable interface. For
				example, this allows you to iterate over all of the errors in a form,
				passing each error (using a runtime expression) as the value of this
				'message' attribute, thus effecting the easy display of such error
				messages.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>scope</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The scope to use when exporting the result to a variable.
			This attribute is only used when var is also set. Possible values are
			page, request, session and application.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>text</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Default text to output when a message for the given code
			could not be found. If both text and code are not set, the tag will
			output null.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>var</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>The string to use when binding the result to the page,
			request, session or application scope. If not specified, the result
			gets outputted to the writer (i.e. typically directly to the JSP).</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.nestedPath"></a>F.7&nbsp;The <code class="literal">nestedPath</code> tag</h2></div></div></div><p>
			Sets a nested path to be used by the bind tag's path.
		</p><div class="table"><a name="spring.tld.nestedPath.table"></a><p class="title"><b>Table&nbsp;F.6.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>path</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>Set the path that this tag should apply. E.g. 'customer'
			to allow bind paths like 'address.street' rather than
			'customer.address.street'.</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.theme"></a>F.8&nbsp;The <code class="literal">theme</code> tag</h2></div></div></div><p>
			Retrieves the theme message with the given code, or text if code isn't resolvable.
			The HTML escaping flag participates in a page-wide or application-wide setting
			(i.e. by HtmlEscapeTag or a "defaultHtmlEscape" context-param in web.xml).
		</p><div class="table"><a name="spring.tld.theme.table"></a><p class="title"><b>Table&nbsp;F.7.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>arguments</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Set optional message arguments for this tag, as a
			(comma-)delimited String (each String argument can contain JSP EL),
			an Object array (used as argument array), or a single Object (used
			as single argument).</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>argumentSeparator</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The separator character to be used for splitting the
			arguments string value; defaults to a 'comma' (',').</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>code</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The code (key) to use when looking up the message.
			If code is not provided, the text attribute will be used.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Set HTML escaping for this tag, as boolean value.
			Overrides the default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>javaScriptEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Set JavaScript escaping for this tag, as boolean value. Default is false.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>message</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>A MessageSourceResolvable argument (direct or through JSP EL).</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>scope</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The scope to use when exporting the result to a variable.
			This attribute is only used when var is also set. Possible values are
			page, request, session and application.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>text</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Default text to output when a message for the given code
			could not be found. If both text and code are not set, the tag will
			output null.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>var</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>The string to use when binding the result to the page,
			request, session or application scope. If not specified, the result
			gets outputted to the writer (i.e. typically directly to the JSP).</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.transform"></a>F.9&nbsp;The <code class="literal">transform</code> tag</h2></div></div></div><p>
			Provides transformation of variables to Strings, using an appropriate
			custom PropertyEditor from BindTag (can only be used inside BindTag).
			The HTML escaping flag participates in a page-wide or application-wide setting
			(i.e. by HtmlEscapeTag or a 'defaultHtmlEscape' context-param in web.xml).
		</p><div class="table"><a name="spring.tld.transform.table"></a><p class="title"><b>Table&nbsp;F.8.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Set HTML escaping for this tag, as boolean value. Overrides
			the default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>scope</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The scope to use when exported the result to a variable.
			This attribute is only used when var is also set. Possible values are
			page, request, session and application.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>value</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The value to transform. This is the actual object you want
			to have transformed (for instance a Date). Using the PropertyEditor that
			is currently in use by the 'spring:bind' tag.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>var</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>The string to use when binding the result to the page,
			request, session or application scope. If not specified, the result gets
			outputted to the writer (i.e. typically directly to the JSP).</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.url"></a>F.10&nbsp;The <code class="literal">url</code> tag</h2></div></div></div><p>
			Creates URLs with support for URI template variables, HTML/XML escaping, and Javascript escaping.
			Modeled after the JSTL c:url tag with backwards compatibility in mind.
		</p><div class="table"><a name="spring.tld.url.table"></a><p class="title"><b>Table&nbsp;F.9.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>url</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The URL to build. This value can include template {placeholders} 
			that are replaced with the URL encoded value of the named parameter.  Parameters 
			must be defined using the param tag inside the body of this tag.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>context</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Specifies a remote application context path.  The default is the 
			current application context path.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>var</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The name of the variable to export the URL value to.
                     If not specified the URL is written as output.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>scope</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The scope for the var.  'application', 'session', 'request' and 
			'page' scopes are supported.  Defaults to page scope.  This attribute has no 
			effect unless the var attribute is also defined.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Set HTML escaping for this tag, as a boolean value. Overrides the
			default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>javascriptEncoding</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>Set JavaScript escaping for this tag, as a boolean value.
			Default is false.</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring.tld.eval"></a>F.11&nbsp;The <code class="literal">eval</code> tag</h2></div></div></div><p>
			Evaluates a Spring expression (SpEL) and either prints the result or assigns it to a variable.
		</p><div class="table"><a name="spring.tld.eval.table"></a><p class="title"><b>Table&nbsp;F.10.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>expression</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The expression to evaluate.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>var</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The name of the variable to export the evaluation result to.
                     If not specified the evaluation result is converted to a String and written as output.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>scope</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The scope for the var.  'application', 'session', 'request' and 
			'page' scopes are supported.  Defaults to page scope.  This attribute has no 
			effect unless the var attribute is also defined.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Set HTML escaping for this tag, as a boolean value. Overrides the
			default HTML escaping setting for the current page.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>javascriptEncoding</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>Set JavaScript escaping for this tag, as a boolean value.
			Default is false.</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="spring-form.tld"></a>Appendix&nbsp;G.&nbsp;spring-form.tld</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld-intro"></a>G.1&nbsp;Introduction</h2></div></div></div></div><p>One of the view technologies you can use with the Spring Framework
			    is Java Server Pages (JSPs). To help you implement views using Java Server Pages
			    the Spring Framework provides you with some tags for evaluating errors, setting
			    themes and outputting internationalized messages.</p><p>Please note that the various tags generated by this form tag library
                are compliant with the <a class="ulink" href="http://www.w3.org/TR/xhtml1/" target="_top">XHTML-1.0-Strict specification</a> and attendant <a class="ulink" href="http://www.w3.org/TR/xhtml1/dtds.html#a_dtd_XHTML-1.0-Strict" target="_top">DTD</a>.</p><p>This appendix describes the <code class="literal">spring-form.tld</code> tag library.</p><div class="itemizedlist"><ul type="disc"><li><a class="xref" href="#spring-form.tld.checkbox" title="G.2&nbsp;The checkbox tag">Section&nbsp;G.2, &#8220;The checkbox tag&#8221;</a></li><li><a class="xref" href="#spring-form.tld.checkboxes" title="G.3&nbsp;The checkboxes tag">Section&nbsp;G.3, &#8220;The checkboxes tag&#8221;</a></li><li><a class="xref" href="#spring-form.tld.errors" title="G.4&nbsp;The errors tag">Section&nbsp;G.4, &#8220;The errors tag&#8221;</a></li><li><a class="xref" href="#spring-form.tld.form" title="G.5&nbsp;The form tag">Section&nbsp;G.5, &#8220;The form tag&#8221;</a></li><li><a class="xref" href="#spring-form.tld.hidden" title="G.6&nbsp;The hidden tag">Section&nbsp;G.6, &#8220;The hidden tag&#8221;</a></li><li><a class="xref" href="#spring-form.tld.input" title="G.7&nbsp;The input tag">Section&nbsp;G.7, &#8220;The input tag&#8221;</a></li><li><a class="xref" href="#spring-form.tld.label" title="G.8&nbsp;The label tag">Section&nbsp;G.8, &#8220;The label tag&#8221;</a></li><li><a class="xref" href="#spring-form.tld.option" title="G.9&nbsp;The option tag">Section&nbsp;G.9, &#8220;The option tag&#8221;</a></li><li><a class="xref" href="#spring-form.tld.options" title="G.10&nbsp;The options tag">Section&nbsp;G.10, &#8220;The options tag&#8221;</a></li><li><a class="xref" href="#spring-form.tld.password" title="G.11&nbsp;The password tag">Section&nbsp;G.11, &#8220;The password tag&#8221;</a></li><li><a class="xref" href="#spring-form.tld.radiobutton" title="G.12&nbsp;The radiobutton tag">Section&nbsp;G.12, &#8220;The radiobutton tag&#8221;</a></li><li><a class="xref" href="#spring-form.tld.radiobuttons" title="G.13&nbsp;The radiobuttons tag">Section&nbsp;G.13, &#8220;The radiobuttons tag&#8221;</a></li><li><a class="xref" href="#spring-form.tld.select" title="G.14&nbsp;The select tag">Section&nbsp;G.14, &#8220;The select tag&#8221;</a></li><li><a class="xref" href="#spring-form.tld.textarea" title="G.15&nbsp;The textarea tag">Section&nbsp;G.15, &#8220;The textarea tag&#8221;</a></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.checkbox"></a>G.2&nbsp;The <code class="literal">checkbox</code> tag</h2></div></div></div><p>Renders an HTML 'input' tag with type 'checkbox'.</p><div class="table"><a name="spring-form.tld.checkbox.table"></a><p class="title"><b>Table&nbsp;G.1.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>accesskey</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssErrorClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssStyle</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>dir</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>disabled</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>label</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Value to be displayed as part of the tag</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>lang</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onblur</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onchange</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ondblclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onfocus</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeydown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeypress</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeyup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousedown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousemove</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseout</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseover</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>path</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>tabindex</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>title</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>value</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.checkboxes"></a>G.3&nbsp;The <code class="literal">checkboxes</code> tag</h2></div></div></div><p>Renders multiple HTML 'input' tags with type 'checkbox'.</p><div class="table"><a name="spring-form.tld.checkboxes.table"></a><p class="title"><b>Table&nbsp;G.2.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>accesskey</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssErrorClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssStyle</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>delimiter</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Delimiter to use between each 'input' tag with type 'checkbox'. There is no delimiter by default.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>dir</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>disabled</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>element</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Specifies the HTML element that is used to enclose each 'input' tag with type 'checkbox'.  Defaults to 'span'.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>itemLabel</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Value to be displayed as part of the 'input' tags with type 'checkbox'</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>items</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The Collection, Map or array of objects used to generate the 'input' tags with type 'checkbox'</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>itemValue</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Name of the property mapped to 'value' attribute of the 'input' tags with type 'checkbox'</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>lang</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onblur</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onchange</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ondblclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onfocus</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeydown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeypress</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeyup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousedown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousemove</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseout</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseover</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>path</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>tabindex</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>title</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.errors"></a>G.4&nbsp;The <code class="literal">errors</code> tag</h2></div></div></div><p>Renders field errors in an HTML 'span' tag.</p><div class="table"><a name="spring-form.tld.errors.table"></a><p class="title"><b>Table&nbsp;G.3.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssStyle</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>delimiter</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Delimiter for displaying multiple error messages. Defaults to the br tag.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>dir</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>element</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Specifies the HTML element that is used to render the enclosing errors.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>lang</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ondblclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeydown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeypress</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeyup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousedown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousemove</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseout</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseover</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>path</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Path to errors object for data binding</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>tabindex</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>title</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.form"></a>G.5&nbsp;The <code class="literal">form</code> tag</h2></div></div></div><p>Renders an HTML 'form' tag and exposes a binding path to inner tags for binding.</p><div class="table"><a name="spring-form.tld.form.table"></a><p class="title"><b>Table&nbsp;G.4.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>acceptCharset</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Specifies the list of character encodings for input data that is accepted by the server processing this form. The value is a space- and/or comma-delimited list of charset values. The client must interpret this list as an exclusive-or list, i.e., the server is able to accept any single character encoding per entity received.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>action</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Required Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>commandName</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Name of the model attribute under which the form object is exposed.
				Defaults to 'command'.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssStyle</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>dir</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>enctype</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>lang</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>method</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>modelAttribute</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Name of the model attribute under which the form object is exposed.
				Defaults to 'command'.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>name</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute - added for backwards compatibility cases</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ondblclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeydown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeypress</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeyup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousedown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousemove</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseout</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseover</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onreset</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onsubmit</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>target</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>title</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.hidden"></a>G.6&nbsp;The <code class="literal">hidden</code> tag</h2></div></div></div><p>Renders an HTML 'input' tag with type 'hidden' using the bound value.</p><div class="table"><a name="spring-form.tld.hidden.table"></a><p class="title"><b>Table&nbsp;G.5.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>path</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>Path to property for data binding</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.input"></a>G.7&nbsp;The <code class="literal">input</code> tag</h2></div></div></div><p>Renders an HTML 'input' tag with type 'text' using the bound value.</p><div class="table"><a name="spring-form.tld.input.table"></a><p class="title"><b>Table&nbsp;G.6.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>accesskey</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>alt</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>autocomplete</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Common Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssErrorClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssStyle</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>dir</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>disabled</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>lang</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>maxlength</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onblur</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onchange</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ondblclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onfocus</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeydown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeypress</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeyup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousedown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousemove</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseout</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseover</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onselect</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>path</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>readonly</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will make the HTML element readonly.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>size</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>tabindex</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>title</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.label"></a>G.8&nbsp;The <code class="literal">label</code> tag</h2></div></div></div><p>Renders a form field label in an HTML 'label' tag.</p><div class="table"><a name="spring-form.tld.label.table"></a><p class="title"><b>Table&nbsp;G.7.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssErrorClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used only when errors are present.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssStyle</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>dir</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>for</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>lang</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ondblclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeydown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeypress</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeyup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousedown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousemove</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseout</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseover</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>path</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Path to errors object for data binding</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>tabindex</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>title</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.option"></a>G.9&nbsp;The <code class="literal">option</code> tag</h2></div></div></div><p>Renders a single HTML 'option'. Sets 'selected' as appropriate based on bound value.</p><div class="table"><a name="spring-form.tld.option.table"></a><p class="title"><b>Table&nbsp;G.8.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssErrorClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssStyle</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>dir</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>disabled</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>label</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>lang</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ondblclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeydown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeypress</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeyup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousedown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousemove</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseout</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseover</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>tabindex</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>title</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>value</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.options"></a>G.10&nbsp;The <code class="literal">options</code> tag</h2></div></div></div><p>Renders a list of HTML 'option' tags. Sets 'selected' as appropriate based on bound value.</p><div class="table"><a name="spring-form.tld.options.table"></a><p class="title"><b>Table&nbsp;G.9.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssErrorClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssStyle</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>dir</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>disabled</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>itemLabel</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Name of the property mapped to the inner text of the 'option' tag</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>items</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The Collection, Map or array of objects used to generate the inner 'option' tags</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>itemValue</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Name of the property mapped to 'value' attribute of the 'option' tag</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>lang</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ondblclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeydown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeypress</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeyup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousedown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousemove</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseout</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseover</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>tabindex</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>title</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.password"></a>G.11&nbsp;The <code class="literal">password</code> tag</h2></div></div></div><p>Renders an HTML 'input' tag with type 'password' using the bound value.</p><div class="table"><a name="spring-form.tld.password.table"></a><p class="title"><b>Table&nbsp;G.10.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>accesskey</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>alt</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>autocomplete</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Common Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssErrorClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssStyle</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>dir</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>disabled</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>lang</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>maxlength</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onblur</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onchange</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ondblclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onfocus</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeydown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeypress</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeyup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousedown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousemove</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseout</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseover</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onselect</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>path</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>readonly</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will make the HTML element readonly.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>showPassword</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Is the password value to be shown? Defaults to false.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>size</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>tabindex</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>title</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.radiobutton"></a>G.12&nbsp;The <code class="literal">radiobutton</code> tag</h2></div></div></div><p>Renders an HTML 'input' tag with type 'radio'.</p><div class="table"><a name="spring-form.tld.radiobutton.table"></a><p class="title"><b>Table&nbsp;G.11.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>accesskey</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssErrorClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssStyle</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>dir</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>disabled</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>label</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Value to be displayed as part of the tag</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>lang</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onblur</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onchange</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ondblclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onfocus</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeydown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeypress</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeyup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousedown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousemove</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseout</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseover</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>path</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>tabindex</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>title</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>value</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.radiobuttons"></a>G.13&nbsp;The <code class="literal">radiobuttons</code> tag</h2></div></div></div><p>Renders multiple HTML 'input' tags with type 'radio'.</p><div class="table"><a name="spring-form.tld.radiobuttons.table"></a><p class="title"><b>Table&nbsp;G.12.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>accesskey</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssErrorClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssStyle</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>delimiter</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Delimiter to use between each 'input' tag with type 'radio'. There is no delimiter by default.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>dir</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>disabled</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>element</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Specifies the HTML element that is used to enclose each 'input' tag with type 'radio'.  Defaults to 'span'.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>itemLabel</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Value to be displayed as part of the 'input' tags with type 'radio'</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>items</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The Collection, Map or array of objects used to generate the 'input' tags with type 'radio'</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>itemValue</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Name of the property mapped to 'value' attribute of the 'input' tags with type 'radio'</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>lang</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onblur</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onchange</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ondblclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onfocus</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeydown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeypress</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeyup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousedown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousemove</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseout</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseover</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>path</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>tabindex</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>title</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.select"></a>G.14&nbsp;The <code class="literal">select</code> tag</h2></div></div></div><p>Renders an HTML 'select' element. Supports databinding to the selected option.</p><div class="table"><a name="spring-form.tld.select.table"></a><p class="title"><b>Table&nbsp;G.13.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>accesskey</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssErrorClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssStyle</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>dir</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>disabled</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>itemLabel</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Name of the property mapped to the inner text of the 'option' tag</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>items</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>The Collection, Map or array of objects used to generate the inner 'option' tags</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>itemValue</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Name of the property mapped to 'value' attribute of the 'option' tag</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>lang</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>multiple</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onblur</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onchange</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ondblclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onfocus</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeydown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeypress</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeyup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousedown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousemove</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseout</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseover</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>path</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>size</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>tabindex</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>title</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-form.tld.textarea"></a>G.15&nbsp;The <code class="literal">textarea</code> tag</h2></div></div></div><p>Renders an HTML 'textarea'.</p><div class="table"><a name="spring-form.tld.textarea.table"></a><p class="title"><b>Table&nbsp;G.14.&nbsp;Attributes</b></p><div class="table-contents"><table summary="Attributes" style="border-collapse: collapse;border-top: 1.0pt solid ; border-bottom: 1.0pt solid ; border-left: 1.0pt solid ; border-right: 1.0pt solid ; "><colgroup><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Attribute</th><th style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">Required?</th><th style="border-bottom: 1.0pt solid ; " align="center">Runtime Expression?</th><th style="border-bottom: 1.0pt solid ; " align="left">Description</th></tr></thead><tbody><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>accesskey</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cols</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Required Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssErrorClass</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "class" - HTML Optional Attribute. Used when the bound field has errors.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>cssStyle</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Equivalent to "style" - HTML Optional Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>dir</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>disabled</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will disable the HTML element.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>htmlEscape</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Enable/disable HTML escaping of rendered values.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>id</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>lang</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onblur</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onchange</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>ondblclick</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onfocus</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeydown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeypress</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onkeyup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousedown</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmousemove</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseout</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseover</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onmouseup</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>onselect</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Event Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>path</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>Path to property for data binding</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>readonly</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Optional Attribute. Setting the value of this attribute to 'true' (without the quotes) will make the HTML element readonly.</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>rows</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Required Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>tabindex</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; border-bottom: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="border-bottom: 1.0pt solid ; " align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr><tr><td style="border-right: 1.0pt solid ; " align="center">
                     <p>title</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>false</p>
                  </td><td style="border-right: 1.0pt solid ; " align="center">
                     <p>true</p>
                  </td><td style="" align="left">
                     <p>HTML Standard Attribute</p>
                  </td></tr></tbody></table></div></div><br class="table-break"></div></div></div></div><!--Begin LoopFuse code--><script src="http://loopfuse.net/webrecorder/js/listen.js" type="text/javascript"></script><script type="text/javascript">
			_lf_cid = "LF_48be82fa";
			_lf_remora();
		</script><!--End LoopFuse code--></body></html>